module.exports =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 191);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(module) {var __WEBPACK_AMD_DEFINE_RESULT__;var _typeof=typeof Symbol===\"function\"&&typeof Symbol.iterator===\"symbol\"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol===\"function\"&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj;};/**\n * @license\n * Lodash <https://lodash.com/>\n * Copyright JS Foundation and other contributors <https://js.foundation/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */;(function(){/** Used as a safe reference for `undefined` in pre-ES5 environments. */var undefined;/** Used as the semantic version number. */var VERSION='4.17.4';/** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/** Error message constants. */var CORE_ERROR_TEXT='Unsupported core-js use. Try https://npms.io/search?q=ponyfill.',FUNC_ERROR_TEXT='Expected a function';/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used as the maximum memoize cache size. */var MAX_MEMOIZE_SIZE=500;/** Used as the internal argument placeholder. */var PLACEHOLDER='__lodash_placeholder__';/** Used to compose bitmasks for cloning. */var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;/** Used to compose bitmasks for value comparisons. */var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;/** Used to compose bitmasks for function metadata. */var WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512;/** Used as default options for `_.truncate`. */var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION='...';/** Used to detect hot functions by number of calls within a span of milliseconds. */var HOT_COUNT=800,HOT_SPAN=16;/** Used to indicate the type of lazy iteratees. */var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;/** Used as references for various `Number` constants. */var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e+308,NAN=0/0;/** Used as references for the maximum length and index of an array. */var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;/** Used to associate wrap methods with their bit flags. */var wrapFlags=[['ary',WRAP_ARY_FLAG],['bind',WRAP_BIND_FLAG],['bindKey',WRAP_BIND_KEY_FLAG],['curry',WRAP_CURRY_FLAG],['curryRight',WRAP_CURRY_RIGHT_FLAG],['flip',WRAP_FLIP_FLAG],['partial',WRAP_PARTIAL_FLAG],['partialRight',WRAP_PARTIAL_RIGHT_FLAG],['rearg',WRAP_REARG_FLAG]];/** `Object#toString` result references. */var argsTag='[object Arguments]',arrayTag='[object Array]',asyncTag='[object AsyncFunction]',boolTag='[object Boolean]',dateTag='[object Date]',domExcTag='[object DOMException]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',nullTag='[object Null]',objectTag='[object Object]',promiseTag='[object Promise]',proxyTag='[object Proxy]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',symbolTag='[object Symbol]',undefinedTag='[object Undefined]',weakMapTag='[object WeakMap]',weakSetTag='[object WeakSet]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/** Used to match empty string literals in compiled template source. */var reEmptyStringLeading=/\\b__p \\+= '';/g,reEmptyStringMiddle=/\\b(__p \\+=) '' \\+/g,reEmptyStringTrailing=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n'';/g;/** Used to match HTML entities and HTML characters. */var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>\"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);/** Used to match template delimiters. */var reEscape=/<%-([\\s\\S]+?)%>/g,reEvaluate=/<%([\\s\\S]+?)%>/g,reInterpolate=/<%=([\\s\\S]+?)%>/g;/** Used to match property names within property paths. */var reIsDeepProp=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,reIsPlainProp=/^\\w*$/,reLeadingDot=/^\\./,rePropName=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;/**\n   * Used to match `RegExp`\n   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n   */var reRegExpChar=/[\\\\^$.*+?()[\\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);/** Used to match leading and trailing whitespace. */var reTrim=/^\\s+|\\s+$/g,reTrimStart=/^\\s+/,reTrimEnd=/\\s+$/;/** Used to match wrap detail comments. */var reWrapComment=/\\{(?:\\n\\/\\* \\[wrapped with .+\\] \\*\\/)?\\n?/,reWrapDetails=/\\{\\n\\/\\* \\[wrapped with (.+)\\] \\*/,reSplitDetails=/,? & /;/** Used to match words composed of alphanumeric characters. */var reAsciiWord=/[^\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\x7f]+/g;/** Used to match backslashes in property paths. */var reEscapeChar=/\\\\(\\\\)?/g;/**\n   * Used to match\n   * [ES template delimiters](http://ecma-international.org/ecma-262/7.0/#sec-template-literal-lexical-components).\n   */var reEsTemplate=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g;/** Used to match `RegExp` flags from their coerced string values. */var reFlags=/\\w*$/;/** Used to detect bad signed hexadecimal string values. */var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;/** Used to detect binary string values. */var reIsBinary=/^0b[01]+$/i;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\\[object .+?Constructor\\]$/;/** Used to detect octal string values. */var reIsOctal=/^0o[0-7]+$/i;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\\d*)$/;/** Used to match Latin Unicode letters (excluding mathematical operators). */var reLatin=/[\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\xff\\u0100-\\u017f]/g;/** Used to ensure capturing order of template delimiters. */var reNoMatch=/($^)/;/** Used to match unescaped characters in compiled string literals. */var reUnescapedString=/['\\n\\r\\u2028\\u2029\\\\]/g;/** Used to compose unicode character classes. */var rsAstralRange='\\\\ud800-\\\\udfff',rsComboMarksRange='\\\\u0300-\\\\u036f',reComboHalfMarksRange='\\\\ufe20-\\\\ufe2f',rsComboSymbolsRange='\\\\u20d0-\\\\u20ff',rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange='\\\\u2700-\\\\u27bf',rsLowerRange='a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff',rsMathOpRange='\\\\xac\\\\xb1\\\\xd7\\\\xf7',rsNonCharRange='\\\\x00-\\\\x2f\\\\x3a-\\\\x40\\\\x5b-\\\\x60\\\\x7b-\\\\xbf',rsPunctuationRange='\\\\u2000-\\\\u206f',rsSpaceRange=' \\\\t\\\\x0b\\\\f\\\\xa0\\\\ufeff\\\\n\\\\r\\\\u2028\\\\u2029\\\\u1680\\\\u180e\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200a\\\\u202f\\\\u205f\\\\u3000',rsUpperRange='A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde',rsVarRange='\\\\ufe0e\\\\ufe0f',rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;/** Used to compose unicode capture groups. */var rsApos='[\\'\\u2019]',rsAstral='['+rsAstralRange+']',rsBreak='['+rsBreakRange+']',rsCombo='['+rsComboRange+']',rsDigits='\\\\d+',rsDingbat='['+rsDingbatRange+']',rsLower='['+rsLowerRange+']',rsMisc='[^'+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+']',rsFitz='\\\\ud83c[\\\\udffb-\\\\udfff]',rsModifier='(?:'+rsCombo+'|'+rsFitz+')',rsNonAstral='[^'+rsAstralRange+']',rsRegional='(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}',rsSurrPair='[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]',rsUpper='['+rsUpperRange+']',rsZWJ='\\\\u200d';/** Used to compose unicode regexes. */var rsMiscLower='(?:'+rsLower+'|'+rsMisc+')',rsMiscUpper='(?:'+rsUpper+'|'+rsMisc+')',rsOptContrLower='(?:'+rsApos+'(?:d|ll|m|re|s|t|ve))?',rsOptContrUpper='(?:'+rsApos+'(?:D|LL|M|RE|S|T|VE))?',reOptMod=rsModifier+'?',rsOptVar='['+rsVarRange+']?',rsOptJoin='(?:'+rsZWJ+'(?:'+[rsNonAstral,rsRegional,rsSurrPair].join('|')+')'+rsOptVar+reOptMod+')*',rsOrdLower='\\\\d*(?:(?:1st|2nd|3rd|(?![123])\\\\dth)\\\\b)',rsOrdUpper='\\\\d*(?:(?:1ST|2ND|3RD|(?![123])\\\\dTH)\\\\b)',rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji='(?:'+[rsDingbat,rsRegional,rsSurrPair].join('|')+')'+rsSeq,rsSymbol='(?:'+[rsNonAstral+rsCombo+'?',rsCombo,rsRegional,rsSurrPair,rsAstral].join('|')+')';/** Used to match apostrophes. */var reApos=RegExp(rsApos,'g');/**\n   * Used to match [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks) and\n   * [combining diacritical marks for symbols](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_for_Symbols).\n   */var reComboMark=RegExp(rsCombo,'g');/** Used to match [string symbols](https://mathiasbynens.be/notes/javascript-unicode). */var reUnicode=RegExp(rsFitz+'(?='+rsFitz+')|'+rsSymbol+rsSeq,'g');/** Used to match complex or compound words. */var reUnicodeWord=RegExp([rsUpper+'?'+rsLower+'+'+rsOptContrLower+'(?='+[rsBreak,rsUpper,'$'].join('|')+')',rsMiscUpper+'+'+rsOptContrUpper+'(?='+[rsBreak,rsUpper+rsMiscLower,'$'].join('|')+')',rsUpper+'?'+rsMiscLower+'+'+rsOptContrLower,rsUpper+'+'+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join('|'),'g');/** Used to detect strings with [zero-width joiners or code points from the astral planes](http://eev.ee/blog/2015/09/12/dark-corners-of-unicode/). */var reHasUnicode=RegExp('['+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+']');/** Used to detect strings that need a more robust regexp to match words. */var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;/** Used to assign default `context` object properties. */var contextProps=['Array','Buffer','DataView','Date','Error','Float32Array','Float64Array','Function','Int8Array','Int16Array','Int32Array','Map','Math','Object','Promise','RegExp','Set','String','Symbol','TypeError','Uint8Array','Uint8ClampedArray','Uint16Array','Uint32Array','WeakMap','_','clearTimeout','isFinite','parseInt','setTimeout'];/** Used to make template sourceURLs easier to identify. */var templateCounter=-1;/** Used to identify `toStringTag` values of typed arrays. */var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;/** Used to identify `toStringTag` values supported by `_.clone`. */var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;/** Used to map Latin Unicode letters to basic Latin letters. */var deburredLetters={// Latin-1 Supplement block.\n'\\xc0':'A','\\xc1':'A','\\xc2':'A','\\xc3':'A','\\xc4':'A','\\xc5':'A','\\xe0':'a','\\xe1':'a','\\xe2':'a','\\xe3':'a','\\xe4':'a','\\xe5':'a','\\xc7':'C','\\xe7':'c','\\xd0':'D','\\xf0':'d','\\xc8':'E','\\xc9':'E','\\xca':'E','\\xcb':'E','\\xe8':'e','\\xe9':'e','\\xea':'e','\\xeb':'e','\\xcc':'I','\\xcd':'I','\\xce':'I','\\xcf':'I','\\xec':'i','\\xed':'i','\\xee':'i','\\xef':'i','\\xd1':'N','\\xf1':'n','\\xd2':'O','\\xd3':'O','\\xd4':'O','\\xd5':'O','\\xd6':'O','\\xd8':'O','\\xf2':'o','\\xf3':'o','\\xf4':'o','\\xf5':'o','\\xf6':'o','\\xf8':'o','\\xd9':'U','\\xda':'U','\\xdb':'U','\\xdc':'U','\\xf9':'u','\\xfa':'u','\\xfb':'u','\\xfc':'u','\\xdd':'Y','\\xfd':'y','\\xff':'y','\\xc6':'Ae','\\xe6':'ae','\\xde':'Th','\\xfe':'th','\\xdf':'ss',// Latin Extended-A block.\n'\\u0100':'A','\\u0102':'A','\\u0104':'A','\\u0101':'a','\\u0103':'a','\\u0105':'a','\\u0106':'C','\\u0108':'C','\\u010A':'C','\\u010C':'C','\\u0107':'c','\\u0109':'c','\\u010B':'c','\\u010D':'c','\\u010E':'D','\\u0110':'D','\\u010F':'d','\\u0111':'d','\\u0112':'E','\\u0114':'E','\\u0116':'E','\\u0118':'E','\\u011A':'E','\\u0113':'e','\\u0115':'e','\\u0117':'e','\\u0119':'e','\\u011B':'e','\\u011C':'G','\\u011E':'G','\\u0120':'G','\\u0122':'G','\\u011D':'g','\\u011F':'g','\\u0121':'g','\\u0123':'g','\\u0124':'H','\\u0126':'H','\\u0125':'h','\\u0127':'h','\\u0128':'I','\\u012A':'I','\\u012C':'I','\\u012E':'I','\\u0130':'I','\\u0129':'i','\\u012B':'i','\\u012D':'i','\\u012F':'i','\\u0131':'i','\\u0134':'J','\\u0135':'j','\\u0136':'K','\\u0137':'k','\\u0138':'k','\\u0139':'L','\\u013B':'L','\\u013D':'L','\\u013F':'L','\\u0141':'L','\\u013A':'l','\\u013C':'l','\\u013E':'l','\\u0140':'l','\\u0142':'l','\\u0143':'N','\\u0145':'N','\\u0147':'N','\\u014A':'N','\\u0144':'n','\\u0146':'n','\\u0148':'n','\\u014B':'n','\\u014C':'O','\\u014E':'O','\\u0150':'O','\\u014D':'o','\\u014F':'o','\\u0151':'o','\\u0154':'R','\\u0156':'R','\\u0158':'R','\\u0155':'r','\\u0157':'r','\\u0159':'r','\\u015A':'S','\\u015C':'S','\\u015E':'S','\\u0160':'S','\\u015B':'s','\\u015D':'s','\\u015F':'s','\\u0161':'s','\\u0162':'T','\\u0164':'T','\\u0166':'T','\\u0163':'t','\\u0165':'t','\\u0167':'t','\\u0168':'U','\\u016A':'U','\\u016C':'U','\\u016E':'U','\\u0170':'U','\\u0172':'U','\\u0169':'u','\\u016B':'u','\\u016D':'u','\\u016F':'u','\\u0171':'u','\\u0173':'u','\\u0174':'W','\\u0175':'w','\\u0176':'Y','\\u0177':'y','\\u0178':'Y','\\u0179':'Z','\\u017B':'Z','\\u017D':'Z','\\u017A':'z','\\u017C':'z','\\u017E':'z','\\u0132':'IJ','\\u0133':'ij','\\u0152':'Oe','\\u0153':'oe','\\u0149':\"'n\",'\\u017F':'s'};/** Used to map characters to HTML entities. */var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'};/** Used to map HTML entities to characters. */var htmlUnescapes={'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'\"','&#39;':\"'\"};/** Used to escape characters for inclusion in compiled string literals. */var stringEscapes={'\\\\':'\\\\',\"'\":\"'\",'\\n':'n','\\r':'r','\\u2028':'u2028','\\u2029':'u2029'};/** Built-in method references without a dependency on `root`. */var freeParseFloat=parseFloat,freeParseInt=parseInt;/** Detect free variable `global` from Node.js. */var freeGlobal=(typeof global==='undefined'?'undefined':_typeof(global))=='object'&&global&&global.Object===Object&&global;/** Detect free variable `self`. */var freeSelf=(typeof self==='undefined'?'undefined':_typeof(self))=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root=freeGlobal||freeSelf||Function('return this')();/** Detect free variable `exports`. */var freeExports=( false?'undefined':_typeof(exports))=='object'&&exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&( false?'undefined':_typeof(module))=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/** Detect free variable `process` from Node.js. */var freeProcess=moduleExports&&freeGlobal.process;/** Used to access faster Node.js helpers. */var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding('util');}catch(e){}}();/* Node.js helper references. */var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;/*--------------------------------------------------------------------------*//**\n   * Adds the key-value `pair` to `map`.\n   *\n   * @private\n   * @param {Object} map The map to modify.\n   * @param {Array} pair The key-value pair to add.\n   * @returns {Object} Returns `map`.\n   */function addMapEntry(map,pair){// Don't return `map.set` because it's not chainable in IE 11.\nmap.set(pair[0],pair[1]);return map;}/**\n   * Adds `value` to `set`.\n   *\n   * @private\n   * @param {Object} set The set to modify.\n   * @param {*} value The value to add.\n   * @returns {Object} Returns `set`.\n   */function addSetEntry(set,value){// Don't return `set.add` because it's not chainable in IE 11.\nset.add(value);return set;}/**\n   * A faster alternative to `Function#apply`, this function invokes `func`\n   * with the `this` binding of `thisArg` and the arguments of `args`.\n   *\n   * @private\n   * @param {Function} func The function to invoke.\n   * @param {*} thisArg The `this` binding of `func`.\n   * @param {Array} args The arguments to invoke `func` with.\n   * @returns {*} Returns the result of `func`.\n   */function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2]);}return func.apply(thisArg,args);}/**\n   * A specialized version of `baseAggregator` for arrays.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} setter The function to set `accumulator` values.\n   * @param {Function} iteratee The iteratee to transform keys.\n   * @param {Object} accumulator The initial aggregated object.\n   * @returns {Function} Returns `accumulator`.\n   */function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array);}return accumulator;}/**\n   * A specialized version of `_.forEach` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {Array} Returns `array`.\n   */function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}return array;}/**\n   * A specialized version of `_.forEachRight` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {Array} Returns `array`.\n   */function arrayEachRight(array,iteratee){var length=array==null?0:array.length;while(length--){if(iteratee(array[length],length,array)===false){break;}}return array;}/**\n   * A specialized version of `_.every` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} predicate The function invoked per iteration.\n   * @returns {boolean} Returns `true` if all elements pass the predicate check,\n   *  else `false`.\n   */function arrayEvery(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(!predicate(array[index],index,array)){return false;}}return true;}/**\n   * A specialized version of `_.filter` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} predicate The function invoked per iteration.\n   * @returns {Array} Returns the new filtered array.\n   */function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value;}}return result;}/**\n   * A specialized version of `_.includes` for arrays without support for\n   * specifying an index to search from.\n   *\n   * @private\n   * @param {Array} [array] The array to inspect.\n   * @param {*} target The value to search for.\n   * @returns {boolean} Returns `true` if `target` is found, else `false`.\n   */function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1;}/**\n   * This function is like `arrayIncludes` except that it accepts a comparator.\n   *\n   * @private\n   * @param {Array} [array] The array to inspect.\n   * @param {*} target The value to search for.\n   * @param {Function} comparator The comparator invoked per element.\n   * @returns {boolean} Returns `true` if `target` is found, else `false`.\n   */function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true;}}return false;}/**\n   * A specialized version of `_.map` for arrays without support for iteratee\n   * shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {Array} Returns the new mapped array.\n   */function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array);}return result;}/**\n   * Appends the elements of `values` to `array`.\n   *\n   * @private\n   * @param {Array} array The array to modify.\n   * @param {Array} values The values to append.\n   * @returns {Array} Returns `array`.\n   */function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}/**\n   * A specialized version of `_.reduce` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @param {*} [accumulator] The initial value.\n   * @param {boolean} [initAccum] Specify using the first element of `array` as\n   *  the initial value.\n   * @returns {*} Returns the accumulated value.\n   */function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index];}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}return accumulator;}/**\n   * A specialized version of `_.reduceRight` for arrays without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @param {*} [accumulator] The initial value.\n   * @param {boolean} [initAccum] Specify using the last element of `array` as\n   *  the initial value.\n   * @returns {*} Returns the accumulated value.\n   */function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array==null?0:array.length;if(initAccum&&length){accumulator=array[--length];}while(length--){accumulator=iteratee(accumulator,array[length],length,array);}return accumulator;}/**\n   * A specialized version of `_.some` for arrays without support for iteratee\n   * shorthands.\n   *\n   * @private\n   * @param {Array} [array] The array to iterate over.\n   * @param {Function} predicate The function invoked per iteration.\n   * @returns {boolean} Returns `true` if any element passes the predicate check,\n   *  else `false`.\n   */function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true;}}return false;}/**\n   * Gets the size of an ASCII `string`.\n   *\n   * @private\n   * @param {string} string The string inspect.\n   * @returns {number} Returns the string size.\n   */var asciiSize=baseProperty('length');/**\n   * Converts an ASCII `string` to an array.\n   *\n   * @private\n   * @param {string} string The string to convert.\n   * @returns {Array} Returns the converted array.\n   */function asciiToArray(string){return string.split('');}/**\n   * Splits an ASCII `string` into an array of its words.\n   *\n   * @private\n   * @param {string} The string to inspect.\n   * @returns {Array} Returns the words of `string`.\n   */function asciiWords(string){return string.match(reAsciiWord)||[];}/**\n   * The base implementation of methods like `_.findKey` and `_.findLastKey`,\n   * without support for iteratee shorthands, which iterates over `collection`\n   * using `eachFunc`.\n   *\n   * @private\n   * @param {Array|Object} collection The collection to inspect.\n   * @param {Function} predicate The function invoked per iteration.\n   * @param {Function} eachFunc The function to iterate over `collection`.\n   * @returns {*} Returns the found element or its key, else `undefined`.\n   */function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false;}});return result;}/**\n   * The base implementation of `_.findIndex` and `_.findLastIndex` without\n   * support for iteratee shorthands.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {Function} predicate The function invoked per iteration.\n   * @param {number} fromIndex The index to search from.\n   * @param {boolean} [fromRight] Specify iterating from right to left.\n   * @returns {number} Returns the index of the matched value, else `-1`.\n   */function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index;}}return-1;}/**\n   * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {*} value The value to search for.\n   * @param {number} fromIndex The index to search from.\n   * @returns {number} Returns the index of the matched value, else `-1`.\n   */function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex);}/**\n   * This function is like `baseIndexOf` except that it accepts a comparator.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {*} value The value to search for.\n   * @param {number} fromIndex The index to search from.\n   * @param {Function} comparator The comparator invoked per element.\n   * @returns {number} Returns the index of the matched value, else `-1`.\n   */function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index;}}return-1;}/**\n   * The base implementation of `_.isNaN` without support for number objects.\n   *\n   * @private\n   * @param {*} value The value to check.\n   * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n   */function baseIsNaN(value){return value!==value;}/**\n   * The base implementation of `_.mean` and `_.meanBy` without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} array The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {number} Returns the mean.\n   */function baseMean(array,iteratee){var length=array==null?0:array.length;return length?baseSum(array,iteratee)/length:NAN;}/**\n   * The base implementation of `_.property` without support for deep paths.\n   *\n   * @private\n   * @param {string} key The key of the property to get.\n   * @returns {Function} Returns the new accessor function.\n   */function baseProperty(key){return function(object){return object==null?undefined:object[key];};}/**\n   * The base implementation of `_.propertyOf` without support for deep paths.\n   *\n   * @private\n   * @param {Object} object The object to query.\n   * @returns {Function} Returns the new accessor function.\n   */function basePropertyOf(object){return function(key){return object==null?undefined:object[key];};}/**\n   * The base implementation of `_.reduce` and `_.reduceRight`, without support\n   * for iteratee shorthands, which iterates over `collection` using `eachFunc`.\n   *\n   * @private\n   * @param {Array|Object} collection The collection to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @param {*} accumulator The initial value.\n   * @param {boolean} initAccum Specify using the first or last element of\n   *  `collection` as the initial value.\n   * @param {Function} eachFunc The function to iterate over `collection`.\n   * @returns {*} Returns the accumulated value.\n   */function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection);});return accumulator;}/**\n   * The base implementation of `_.sortBy` which uses `comparer` to define the\n   * sort order of `array` and replaces criteria objects with their corresponding\n   * values.\n   *\n   * @private\n   * @param {Array} array The array to sort.\n   * @param {Function} comparer The function to define sort order.\n   * @returns {Array} Returns `array`.\n   */function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value;}return array;}/**\n   * The base implementation of `_.sum` and `_.sumBy` without support for\n   * iteratee shorthands.\n   *\n   * @private\n   * @param {Array} array The array to iterate over.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {number} Returns the sum.\n   */function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current;}}return result;}/**\n   * The base implementation of `_.times` without support for iteratee shorthands\n   * or max array length checks.\n   *\n   * @private\n   * @param {number} n The number of times to invoke `iteratee`.\n   * @param {Function} iteratee The function invoked per iteration.\n   * @returns {Array} Returns the array of results.\n   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}/**\n   * The base implementation of `_.toPairs` and `_.toPairsIn` which creates an array\n   * of key-value pairs for `object` corresponding to the property names of `props`.\n   *\n   * @private\n   * @param {Object} object The object to query.\n   * @param {Array} props The property names to get values for.\n   * @returns {Object} Returns the key-value pairs.\n   */function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]];});}/**\n   * The base implementation of `_.unary` without support for storing metadata.\n   *\n   * @private\n   * @param {Function} func The function to cap arguments for.\n   * @returns {Function} Returns the new capped function.\n   */function baseUnary(func){return function(value){return func(value);};}/**\n   * The base implementation of `_.values` and `_.valuesIn` which creates an\n   * array of `object` property values corresponding to the property names\n   * of `props`.\n   *\n   * @private\n   * @param {Object} object The object to query.\n   * @param {Array} props The property names to get values for.\n   * @returns {Object} Returns the array of property values.\n   */function baseValues(object,props){return arrayMap(props,function(key){return object[key];});}/**\n   * Checks if a `cache` value for `key` exists.\n   *\n   * @private\n   * @param {Object} cache The cache to query.\n   * @param {string} key The key of the entry to check.\n   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n   */function cacheHas(cache,key){return cache.has(key);}/**\n   * Used by `_.trim` and `_.trimStart` to get the index of the first string symbol\n   * that is not found in the character symbols.\n   *\n   * @private\n   * @param {Array} strSymbols The string symbols to inspect.\n   * @param {Array} chrSymbols The character symbols to find.\n   * @returns {number} Returns the index of the first unmatched string symbol.\n   */function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index;}/**\n   * Used by `_.trim` and `_.trimEnd` to get the index of the last string symbol\n   * that is not found in the character symbols.\n   *\n   * @private\n   * @param {Array} strSymbols The string symbols to inspect.\n   * @param {Array} chrSymbols The character symbols to find.\n   * @returns {number} Returns the index of the last unmatched string symbol.\n   */function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index;}/**\n   * Gets the number of `placeholder` occurrences in `array`.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {*} placeholder The placeholder to search for.\n   * @returns {number} Returns the placeholder count.\n   */function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){++result;}}return result;}/**\n   * Used by `_.deburr` to convert Latin-1 Supplement and Latin Extended-A\n   * letters to basic Latin letters.\n   *\n   * @private\n   * @param {string} letter The matched letter to deburr.\n   * @returns {string} Returns the deburred letter.\n   */var deburrLetter=basePropertyOf(deburredLetters);/**\n   * Used by `_.escape` to convert characters to HTML entities.\n   *\n   * @private\n   * @param {string} chr The matched character to escape.\n   * @returns {string} Returns the escaped character.\n   */var escapeHtmlChar=basePropertyOf(htmlEscapes);/**\n   * Used by `_.template` to escape characters for inclusion in compiled string literals.\n   *\n   * @private\n   * @param {string} chr The matched character to escape.\n   * @returns {string} Returns the escaped character.\n   */function escapeStringChar(chr){return'\\\\'+stringEscapes[chr];}/**\n   * Gets the value at `key` of `object`.\n   *\n   * @private\n   * @param {Object} [object] The object to query.\n   * @param {string} key The key of the property to get.\n   * @returns {*} Returns the property value.\n   */function getValue(object,key){return object==null?undefined:object[key];}/**\n   * Checks if `string` contains Unicode symbols.\n   *\n   * @private\n   * @param {string} string The string to inspect.\n   * @returns {boolean} Returns `true` if a symbol is found, else `false`.\n   */function hasUnicode(string){return reHasUnicode.test(string);}/**\n   * Checks if `string` contains a word composed of Unicode symbols.\n   *\n   * @private\n   * @param {string} string The string to inspect.\n   * @returns {boolean} Returns `true` if a word is found, else `false`.\n   */function hasUnicodeWord(string){return reHasUnicodeWord.test(string);}/**\n   * Converts `iterator` to an array.\n   *\n   * @private\n   * @param {Object} iterator The iterator to convert.\n   * @returns {Array} Returns the converted array.\n   */function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value);}return result;}/**\n   * Converts `map` to its key-value pairs.\n   *\n   * @private\n   * @param {Object} map The map to convert.\n   * @returns {Array} Returns the key-value pairs.\n   */function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value];});return result;}/**\n   * Creates a unary function that invokes `func` with its argument transformed.\n   *\n   * @private\n   * @param {Function} func The function to wrap.\n   * @param {Function} transform The argument transform.\n   * @returns {Function} Returns the new function.\n   */function overArg(func,transform){return function(arg){return func(transform(arg));};}/**\n   * Replaces all `placeholder` elements in `array` with an internal placeholder\n   * and returns an array of their indexes.\n   *\n   * @private\n   * @param {Array} array The array to modify.\n   * @param {*} placeholder The placeholder to replace.\n   * @returns {Array} Returns the new array of placeholder indexes.\n   */function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index;}}return result;}/**\n   * Converts `set` to an array of its values.\n   *\n   * @private\n   * @param {Object} set The set to convert.\n   * @returns {Array} Returns the values.\n   */function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}/**\n   * Converts `set` to its value-value pairs.\n   *\n   * @private\n   * @param {Object} set The set to convert.\n   * @returns {Array} Returns the value-value pairs.\n   */function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value];});return result;}/**\n   * A specialized version of `_.indexOf` which performs strict equality\n   * comparisons of values, i.e. `===`.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {*} value The value to search for.\n   * @param {number} fromIndex The index to search from.\n   * @returns {number} Returns the index of the matched value, else `-1`.\n   */function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index;}}return-1;}/**\n   * A specialized version of `_.lastIndexOf` which performs strict equality\n   * comparisons of values, i.e. `===`.\n   *\n   * @private\n   * @param {Array} array The array to inspect.\n   * @param {*} value The value to search for.\n   * @param {number} fromIndex The index to search from.\n   * @returns {number} Returns the index of the matched value, else `-1`.\n   */function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--){if(array[index]===value){return index;}}return index;}/**\n   * Gets the number of symbols in `string`.\n   *\n   * @private\n   * @param {string} string The string to inspect.\n   * @returns {number} Returns the string size.\n   */function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string);}/**\n   * Converts `string` to an array.\n   *\n   * @private\n   * @param {string} string The string to convert.\n   * @returns {Array} Returns the converted array.\n   */function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string);}/**\n   * Used by `_.unescape` to convert HTML entities to characters.\n   *\n   * @private\n   * @param {string} chr The matched character to unescape.\n   * @returns {string} Returns the unescaped character.\n   */var unescapeHtmlChar=basePropertyOf(htmlUnescapes);/**\n   * Gets the size of a Unicode `string`.\n   *\n   * @private\n   * @param {string} string The string inspect.\n   * @returns {number} Returns the string size.\n   */function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result;}return result;}/**\n   * Converts a Unicode `string` to an array.\n   *\n   * @private\n   * @param {string} string The string to convert.\n   * @returns {Array} Returns the converted array.\n   */function unicodeToArray(string){return string.match(reUnicode)||[];}/**\n   * Splits a Unicode `string` into an array of its words.\n   *\n   * @private\n   * @param {string} The string to inspect.\n   * @returns {Array} Returns the words of `string`.\n   */function unicodeWords(string){return string.match(reUnicodeWord)||[];}/*--------------------------------------------------------------------------*//**\n   * Create a new pristine `lodash` function using the `context` object.\n   *\n   * @static\n   * @memberOf _\n   * @since 1.1.0\n   * @category Util\n   * @param {Object} [context=root] The context object.\n   * @returns {Function} Returns a new `lodash` function.\n   * @example\n   *\n   * _.mixin({ 'foo': _.constant('foo') });\n   *\n   * var lodash = _.runInContext();\n   * lodash.mixin({ 'bar': lodash.constant('bar') });\n   *\n   * _.isFunction(_.foo);\n   * // => true\n   * _.isFunction(_.bar);\n   * // => false\n   *\n   * lodash.isFunction(lodash.foo);\n   * // => false\n   * lodash.isFunction(lodash.bar);\n   * // => true\n   *\n   * // Create a suped-up `defer` in Node.js.\n   * var defer = _.runInContext({ 'setTimeout': setImmediate }).defer;\n   */var runInContext=function runInContext(context){context=context==null?root:_.defaults(root.Object(),context,_.pick(root,contextProps));/** Built-in constructor references. */var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;/** Used for built-in method references. */var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;/** Used to detect overreaching core-js shims. */var coreJsData=context['__core-js_shared__'];/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/** Used to check objects for own properties. */var hasOwnProperty=objectProto.hasOwnProperty;/** Used to generate unique IDs. */var idCounter=0;/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/**\n     * Used to resolve the\n     * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n     * of values.\n     */var nativeObjectToString=objectProto.toString;/** Used to infer the `Object` constructor. */var objectCtorString=funcToString.call(Object);/** Used to restore the original `_` reference in `_.noConflict`. */var oldDash=root._;/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\\\$&').replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,'$1.*?')+'$');/** Built-in value references. */var Buffer=moduleExports?context.Buffer:undefined,_Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=_Symbol?_Symbol.isConcatSpreadable:undefined,symIterator=_Symbol?_Symbol.iterator:undefined,symToStringTag=_Symbol?_Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,'defineProperty');func({},'',{});return func;}catch(e){}}();/** Mocked built-ins. */var ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;/* Built-in method references that are verified to be native. */var DataView=getNative(context,'DataView'),Map=getNative(context,'Map'),Promise=getNative(context,'Promise'),Set=getNative(context,'Set'),WeakMap=getNative(context,'WeakMap'),nativeCreate=getNative(Object,'create');/** Used to store function metadata. */var metaMap=WeakMap&&new WeakMap();/** Used to lookup unminified function names. */var realNames={};/** Used to detect maps, sets, and weakmaps. */var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);/** Used to convert symbols to primitives and strings. */var symbolProto=_Symbol?_Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;/*------------------------------------------------------------------------*//**\n     * Creates a `lodash` object which wraps `value` to enable implicit method\n     * chain sequences. Methods that operate on and return arrays, collections,\n     * and functions can be chained together. Methods that retrieve a single value\n     * or may return a primitive value will automatically end the chain sequence\n     * and return the unwrapped value. Otherwise, the value must be unwrapped\n     * with `_#value`.\n     *\n     * Explicit chain sequences, which must be unwrapped with `_#value`, may be\n     * enabled using `_.chain`.\n     *\n     * The execution of chained methods is lazy, that is, it's deferred until\n     * `_#value` is implicitly or explicitly called.\n     *\n     * Lazy evaluation allows several methods to support shortcut fusion.\n     * Shortcut fusion is an optimization to merge iteratee calls; this avoids\n     * the creation of intermediate arrays and can greatly reduce the number of\n     * iteratee executions. Sections of a chain sequence qualify for shortcut\n     * fusion if the section is applied to an array and iteratees accept only\n     * one argument. The heuristic for whether a section qualifies for shortcut\n     * fusion is subject to change.\n     *\n     * Chaining is supported in custom builds as long as the `_#value` method is\n     * directly or indirectly included in the build.\n     *\n     * In addition to lodash methods, wrappers have `Array` and `String` methods.\n     *\n     * The wrapper `Array` methods are:\n     * `concat`, `join`, `pop`, `push`, `shift`, `sort`, `splice`, and `unshift`\n     *\n     * The wrapper `String` methods are:\n     * `replace` and `split`\n     *\n     * The wrapper methods that support shortcut fusion are:\n     * `at`, `compact`, `drop`, `dropRight`, `dropWhile`, `filter`, `find`,\n     * `findLast`, `head`, `initial`, `last`, `map`, `reject`, `reverse`, `slice`,\n     * `tail`, `take`, `takeRight`, `takeRightWhile`, `takeWhile`, and `toArray`\n     *\n     * The chainable wrapper methods are:\n     * `after`, `ary`, `assign`, `assignIn`, `assignInWith`, `assignWith`, `at`,\n     * `before`, `bind`, `bindAll`, `bindKey`, `castArray`, `chain`, `chunk`,\n     * `commit`, `compact`, `concat`, `conforms`, `constant`, `countBy`, `create`,\n     * `curry`, `debounce`, `defaults`, `defaultsDeep`, `defer`, `delay`,\n     * `difference`, `differenceBy`, `differenceWith`, `drop`, `dropRight`,\n     * `dropRightWhile`, `dropWhile`, `extend`, `extendWith`, `fill`, `filter`,\n     * `flatMap`, `flatMapDeep`, `flatMapDepth`, `flatten`, `flattenDeep`,\n     * `flattenDepth`, `flip`, `flow`, `flowRight`, `fromPairs`, `functions`,\n     * `functionsIn`, `groupBy`, `initial`, `intersection`, `intersectionBy`,\n     * `intersectionWith`, `invert`, `invertBy`, `invokeMap`, `iteratee`, `keyBy`,\n     * `keys`, `keysIn`, `map`, `mapKeys`, `mapValues`, `matches`, `matchesProperty`,\n     * `memoize`, `merge`, `mergeWith`, `method`, `methodOf`, `mixin`, `negate`,\n     * `nthArg`, `omit`, `omitBy`, `once`, `orderBy`, `over`, `overArgs`,\n     * `overEvery`, `overSome`, `partial`, `partialRight`, `partition`, `pick`,\n     * `pickBy`, `plant`, `property`, `propertyOf`, `pull`, `pullAll`, `pullAllBy`,\n     * `pullAllWith`, `pullAt`, `push`, `range`, `rangeRight`, `rearg`, `reject`,\n     * `remove`, `rest`, `reverse`, `sampleSize`, `set`, `setWith`, `shuffle`,\n     * `slice`, `sort`, `sortBy`, `splice`, `spread`, `tail`, `take`, `takeRight`,\n     * `takeRightWhile`, `takeWhile`, `tap`, `throttle`, `thru`, `toArray`,\n     * `toPairs`, `toPairsIn`, `toPath`, `toPlainObject`, `transform`, `unary`,\n     * `union`, `unionBy`, `unionWith`, `uniq`, `uniqBy`, `uniqWith`, `unset`,\n     * `unshift`, `unzip`, `unzipWith`, `update`, `updateWith`, `values`,\n     * `valuesIn`, `without`, `wrap`, `xor`, `xorBy`, `xorWith`, `zip`,\n     * `zipObject`, `zipObjectDeep`, and `zipWith`\n     *\n     * The wrapper methods that are **not** chainable by default are:\n     * `add`, `attempt`, `camelCase`, `capitalize`, `ceil`, `clamp`, `clone`,\n     * `cloneDeep`, `cloneDeepWith`, `cloneWith`, `conformsTo`, `deburr`,\n     * `defaultTo`, `divide`, `each`, `eachRight`, `endsWith`, `eq`, `escape`,\n     * `escapeRegExp`, `every`, `find`, `findIndex`, `findKey`, `findLast`,\n     * `findLastIndex`, `findLastKey`, `first`, `floor`, `forEach`, `forEachRight`,\n     * `forIn`, `forInRight`, `forOwn`, `forOwnRight`, `get`, `gt`, `gte`, `has`,\n     * `hasIn`, `head`, `identity`, `includes`, `indexOf`, `inRange`, `invoke`,\n     * `isArguments`, `isArray`, `isArrayBuffer`, `isArrayLike`, `isArrayLikeObject`,\n     * `isBoolean`, `isBuffer`, `isDate`, `isElement`, `isEmpty`, `isEqual`,\n     * `isEqualWith`, `isError`, `isFinite`, `isFunction`, `isInteger`, `isLength`,\n     * `isMap`, `isMatch`, `isMatchWith`, `isNaN`, `isNative`, `isNil`, `isNull`,\n     * `isNumber`, `isObject`, `isObjectLike`, `isPlainObject`, `isRegExp`,\n     * `isSafeInteger`, `isSet`, `isString`, `isUndefined`, `isTypedArray`,\n     * `isWeakMap`, `isWeakSet`, `join`, `kebabCase`, `last`, `lastIndexOf`,\n     * `lowerCase`, `lowerFirst`, `lt`, `lte`, `max`, `maxBy`, `mean`, `meanBy`,\n     * `min`, `minBy`, `multiply`, `noConflict`, `noop`, `now`, `nth`, `pad`,\n     * `padEnd`, `padStart`, `parseInt`, `pop`, `random`, `reduce`, `reduceRight`,\n     * `repeat`, `result`, `round`, `runInContext`, `sample`, `shift`, `size`,\n     * `snakeCase`, `some`, `sortedIndex`, `sortedIndexBy`, `sortedLastIndex`,\n     * `sortedLastIndexBy`, `startCase`, `startsWith`, `stubArray`, `stubFalse`,\n     * `stubObject`, `stubString`, `stubTrue`, `subtract`, `sum`, `sumBy`,\n     * `template`, `times`, `toFinite`, `toInteger`, `toJSON`, `toLength`,\n     * `toLower`, `toNumber`, `toSafeInteger`, `toString`, `toUpper`, `trim`,\n     * `trimEnd`, `trimStart`, `truncate`, `unescape`, `uniqueId`, `upperCase`,\n     * `upperFirst`, `value`, and `words`\n     *\n     * @name _\n     * @constructor\n     * @category Seq\n     * @param {*} value The value to wrap in a `lodash` instance.\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * var wrapped = _([1, 2, 3]);\n     *\n     * // Returns an unwrapped value.\n     * wrapped.reduce(_.add);\n     * // => 6\n     *\n     * // Returns a wrapped value.\n     * var squares = wrapped.map(square);\n     *\n     * _.isArray(squares);\n     * // => false\n     *\n     * _.isArray(squares.value());\n     * // => true\n     */function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value;}if(hasOwnProperty.call(value,'__wrapped__')){return wrapperClone(value);}}return new LodashWrapper(value);}/**\n     * The base implementation of `_.create` without support for assigning\n     * properties to the created object.\n     *\n     * @private\n     * @param {Object} proto The object to inherit from.\n     * @returns {Object} Returns the new object.\n     */var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{};}if(objectCreate){return objectCreate(proto);}object.prototype=proto;var result=new object();object.prototype=undefined;return result;};}();/**\n     * The function whose prototype chain sequence wrappers inherit from.\n     *\n     * @private\n     */function baseLodash(){}// No operation performed.\n/**\n     * The base constructor for creating `lodash` wrapper objects.\n     *\n     * @private\n     * @param {*} value The value to wrap.\n     * @param {boolean} [chainAll] Enable explicit method chain sequences.\n     */function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined;}/**\n     * By default, the template delimiters used by lodash are like those in\n     * embedded Ruby (ERB) as well as ES2015 template strings. Change the\n     * following template settings to use alternative delimiters.\n     *\n     * @static\n     * @memberOf _\n     * @type {Object}\n     */lodash.templateSettings={/**\n       * Used to detect `data` property values to be HTML-escaped.\n       *\n       * @memberOf _.templateSettings\n       * @type {RegExp}\n       */'escape':reEscape,/**\n       * Used to detect code to be evaluated.\n       *\n       * @memberOf _.templateSettings\n       * @type {RegExp}\n       */'evaluate':reEvaluate,/**\n       * Used to detect `data` property values to inject.\n       *\n       * @memberOf _.templateSettings\n       * @type {RegExp}\n       */'interpolate':reInterpolate,/**\n       * Used to reference the data object in the template text.\n       *\n       * @memberOf _.templateSettings\n       * @type {string}\n       */'variable':'',/**\n       * Used to import variables into the compiled template.\n       *\n       * @memberOf _.templateSettings\n       * @type {Object}\n       */'imports':{/**\n         * A reference to the `lodash` function.\n         *\n         * @memberOf _.templateSettings.imports\n         * @type {Function}\n         */'_':lodash}};// Ensure wrappers are instances of `baseLodash`.\nlodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;/*------------------------------------------------------------------------*//**\n     * Creates a lazy wrapper object which wraps `value` to enable lazy evaluation.\n     *\n     * @private\n     * @constructor\n     * @param {*} value The value to wrap.\n     */function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[];}/**\n     * Creates a clone of the lazy wrapper object.\n     *\n     * @private\n     * @name clone\n     * @memberOf LazyWrapper\n     * @returns {Object} Returns the cloned `LazyWrapper` object.\n     */function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result;}/**\n     * Reverses the direction of lazy iteration.\n     *\n     * @private\n     * @name reverse\n     * @memberOf LazyWrapper\n     * @returns {Object} Returns the new reversed `LazyWrapper` object.\n     */function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true;}else{result=this.clone();result.__dir__*=-1;}return result;}/**\n     * Extracts the unwrapped value from its lazy wrapper.\n     *\n     * @private\n     * @name value\n     * @memberOf LazyWrapper\n     * @returns {*} Returns the unwrapped value.\n     */function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__);}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed;}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer;}else{break outer;}}}result[resIndex++]=value;}return result;}// Ensure `LazyWrapper` is an instance of `baseLodash`.\nLazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;/*------------------------------------------------------------------------*//**\n     * Creates a hash object.\n     *\n     * @private\n     * @constructor\n     * @param {Array} [entries] The key-value pairs to cache.\n     */function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**\n     * Removes all key-value entries from the hash.\n     *\n     * @private\n     * @name clear\n     * @memberOf Hash\n     */function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0;}/**\n     * Removes `key` and its value from the hash.\n     *\n     * @private\n     * @name delete\n     * @memberOf Hash\n     * @param {Object} hash The hash to modify.\n     * @param {string} key The key of the value to remove.\n     * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n     */function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result;}/**\n     * Gets the hash value for `key`.\n     *\n     * @private\n     * @name get\n     * @memberOf Hash\n     * @param {string} key The key of the value to get.\n     * @returns {*} Returns the entry value.\n     */function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty.call(data,key)?data[key]:undefined;}/**\n     * Checks if a hash value for `key` exists.\n     *\n     * @private\n     * @name has\n     * @memberOf Hash\n     * @param {string} key The key of the entry to check.\n     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n     */function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key);}/**\n     * Sets the hash `key` to `value`.\n     *\n     * @private\n     * @name set\n     * @memberOf Hash\n     * @param {string} key The key of the value to set.\n     * @param {*} value The value to set.\n     * @returns {Object} Returns the hash instance.\n     */function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this;}// Add methods to `Hash`.\nHash.prototype.clear=hashClear;Hash.prototype['delete']=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;/*------------------------------------------------------------------------*//**\n     * Creates an list cache object.\n     *\n     * @private\n     * @constructor\n     * @param {Array} [entries] The key-value pairs to cache.\n     */function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**\n     * Removes all key-value entries from the list cache.\n     *\n     * @private\n     * @name clear\n     * @memberOf ListCache\n     */function listCacheClear(){this.__data__=[];this.size=0;}/**\n     * Removes `key` and its value from the list cache.\n     *\n     * @private\n     * @name delete\n     * @memberOf ListCache\n     * @param {string} key The key of the value to remove.\n     * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n     */function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}--this.size;return true;}/**\n     * Gets the list cache value for `key`.\n     *\n     * @private\n     * @name get\n     * @memberOf ListCache\n     * @param {string} key The key of the value to get.\n     * @returns {*} Returns the entry value.\n     */function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1];}/**\n     * Checks if a list cache value for `key` exists.\n     *\n     * @private\n     * @name has\n     * @memberOf ListCache\n     * @param {string} key The key of the entry to check.\n     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n     */function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1;}/**\n     * Sets the list cache `key` to `value`.\n     *\n     * @private\n     * @name set\n     * @memberOf ListCache\n     * @param {string} key The key of the value to set.\n     * @param {*} value The value to set.\n     * @returns {Object} Returns the list cache instance.\n     */function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value]);}else{data[index][1]=value;}return this;}// Add methods to `ListCache`.\nListCache.prototype.clear=listCacheClear;ListCache.prototype['delete']=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;/*------------------------------------------------------------------------*//**\n     * Creates a map cache object to store key-value pairs.\n     *\n     * @private\n     * @constructor\n     * @param {Array} [entries] The key-value pairs to cache.\n     */function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**\n     * Removes all key-value entries from the map.\n     *\n     * @private\n     * @name clear\n     * @memberOf MapCache\n     */function mapCacheClear(){this.size=0;this.__data__={'hash':new Hash(),'map':new(Map||ListCache)(),'string':new Hash()};}/**\n     * Removes `key` and its value from the map.\n     *\n     * @private\n     * @name delete\n     * @memberOf MapCache\n     * @param {string} key The key of the value to remove.\n     * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n     */function mapCacheDelete(key){var result=getMapData(this,key)['delete'](key);this.size-=result?1:0;return result;}/**\n     * Gets the map value for `key`.\n     *\n     * @private\n     * @name get\n     * @memberOf MapCache\n     * @param {string} key The key of the value to get.\n     * @returns {*} Returns the entry value.\n     */function mapCacheGet(key){return getMapData(this,key).get(key);}/**\n     * Checks if a map value for `key` exists.\n     *\n     * @private\n     * @name has\n     * @memberOf MapCache\n     * @param {string} key The key of the entry to check.\n     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n     */function mapCacheHas(key){return getMapData(this,key).has(key);}/**\n     * Sets the map `key` to `value`.\n     *\n     * @private\n     * @name set\n     * @memberOf MapCache\n     * @param {string} key The key of the value to set.\n     * @param {*} value The value to set.\n     * @returns {Object} Returns the map cache instance.\n     */function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this;}// Add methods to `MapCache`.\nMapCache.prototype.clear=mapCacheClear;MapCache.prototype['delete']=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;/*------------------------------------------------------------------------*//**\n     *\n     * Creates an array cache object to store unique values.\n     *\n     * @private\n     * @constructor\n     * @param {Array} [values] The values to cache.\n     */function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache();while(++index<length){this.add(values[index]);}}/**\n     * Adds `value` to the array cache.\n     *\n     * @private\n     * @name add\n     * @memberOf SetCache\n     * @alias push\n     * @param {*} value The value to cache.\n     * @returns {Object} Returns the cache instance.\n     */function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this;}/**\n     * Checks if `value` is in the array cache.\n     *\n     * @private\n     * @name has\n     * @memberOf SetCache\n     * @param {*} value The value to search for.\n     * @returns {number} Returns `true` if `value` is found, else `false`.\n     */function setCacheHas(value){return this.__data__.has(value);}// Add methods to `SetCache`.\nSetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;/*------------------------------------------------------------------------*//**\n     * Creates a stack cache object to store key-value pairs.\n     *\n     * @private\n     * @constructor\n     * @param {Array} [entries] The key-value pairs to cache.\n     */function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size;}/**\n     * Removes all key-value entries from the stack.\n     *\n     * @private\n     * @name clear\n     * @memberOf Stack\n     */function stackClear(){this.__data__=new ListCache();this.size=0;}/**\n     * Removes `key` and its value from the stack.\n     *\n     * @private\n     * @name delete\n     * @memberOf Stack\n     * @param {string} key The key of the value to remove.\n     * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n     */function stackDelete(key){var data=this.__data__,result=data['delete'](key);this.size=data.size;return result;}/**\n     * Gets the stack value for `key`.\n     *\n     * @private\n     * @name get\n     * @memberOf Stack\n     * @param {string} key The key of the value to get.\n     * @returns {*} Returns the entry value.\n     */function stackGet(key){return this.__data__.get(key);}/**\n     * Checks if a stack value for `key` exists.\n     *\n     * @private\n     * @name has\n     * @memberOf Stack\n     * @param {string} key The key of the entry to check.\n     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n     */function stackHas(key){return this.__data__.has(key);}/**\n     * Sets the stack `key` to `value`.\n     *\n     * @private\n     * @name set\n     * @memberOf Stack\n     * @param {string} key The key of the value to set.\n     * @param {*} value The value to set.\n     * @returns {Object} Returns the stack cache instance.\n     */function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this;}data=this.__data__=new MapCache(pairs);}data.set(key,value);this.size=data.size;return this;}// Add methods to `Stack`.\nStack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;/*------------------------------------------------------------------------*//**\n     * Creates an array of the enumerable property names of the array-like `value`.\n     *\n     * @private\n     * @param {*} value The value to query.\n     * @param {boolean} inherited Specify returning inherited property names.\n     * @returns {Array} Returns the array of property names.\n     */function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(// Safari 9 has enumerable `arguments.length` in strict mode.\nkey=='length'||// Node.js 0.10 has enumerable non-index properties on buffers.\nisBuff&&(key=='offset'||key=='parent')||// PhantomJS 2 has enumerable non-index properties on typed arrays.\nisType&&(key=='buffer'||key=='byteLength'||key=='byteOffset')||// Skip index properties.\nisIndex(key,length)))){result.push(key);}}return result;}/**\n     * A specialized version of `_.sample` for arrays.\n     *\n     * @private\n     * @param {Array} array The array to sample.\n     * @returns {*} Returns the random element.\n     */function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined;}/**\n     * A specialized version of `_.sampleSize` for arrays.\n     *\n     * @private\n     * @param {Array} array The array to sample.\n     * @param {number} n The number of elements to sample.\n     * @returns {Array} Returns the random elements.\n     */function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length));}/**\n     * A specialized version of `_.shuffle` for arrays.\n     *\n     * @private\n     * @param {Array} array The array to shuffle.\n     * @returns {Array} Returns the new shuffled array.\n     */function arrayShuffle(array){return shuffleSelf(copyArray(array));}/**\n     * This function is like `assignValue` except that it doesn't assign\n     * `undefined` values.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {string} key The key of the property to assign.\n     * @param {*} value The value to assign.\n     */function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value);}}/**\n     * Assigns `value` to `key` of `object` if the existing value is not equivalent\n     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {string} key The key of the property to assign.\n     * @param {*} value The value to assign.\n     */function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value);}}/**\n     * Gets the index at which the `key` is found in `array` of key-value pairs.\n     *\n     * @private\n     * @param {Array} array The array to inspect.\n     * @param {*} key The key to search for.\n     * @returns {number} Returns the index of the matched value, else `-1`.\n     */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}return-1;}/**\n     * Aggregates elements of `collection` on `accumulator` with keys transformed\n     * by `iteratee` and values set by `setter`.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} setter The function to set `accumulator` values.\n     * @param {Function} iteratee The iteratee to transform keys.\n     * @param {Object} accumulator The initial aggregated object.\n     * @returns {Function} Returns `accumulator`.\n     */function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection);});return accumulator;}/**\n     * The base implementation of `_.assign` without support for multiple sources\n     * or `customizer` functions.\n     *\n     * @private\n     * @param {Object} object The destination object.\n     * @param {Object} source The source object.\n     * @returns {Object} Returns `object`.\n     */function baseAssign(object,source){return object&&copyObject(source,keys(source),object);}/**\n     * The base implementation of `_.assignIn` without support for multiple sources\n     * or `customizer` functions.\n     *\n     * @private\n     * @param {Object} object The destination object.\n     * @param {Object} source The source object.\n     * @returns {Object} Returns `object`.\n     */function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object);}/**\n     * The base implementation of `assignValue` and `assignMergeValue` without\n     * value checks.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {string} key The key of the property to assign.\n     * @param {*} value The value to assign.\n     */function baseAssignValue(object,key,value){if(key=='__proto__'&&defineProperty){defineProperty(object,key,{'configurable':true,'enumerable':true,'value':value,'writable':true});}else{object[key]=value;}}/**\n     * The base implementation of `_.at` without support for individual paths.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {string[]} paths The property paths to pick.\n     * @returns {Array} Returns the picked elements.\n     */function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=object==null;while(++index<length){result[index]=skip?undefined:get(object,paths[index]);}return result;}/**\n     * The base implementation of `_.clamp` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {number} number The number to clamp.\n     * @param {number} [lower] The lower bound.\n     * @param {number} upper The upper bound.\n     * @returns {number} Returns the clamped number.\n     */function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper;}if(lower!==undefined){number=number>=lower?number:lower;}}return number;}/**\n     * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n     * traversed objects.\n     *\n     * @private\n     * @param {*} value The value to clone.\n     * @param {boolean} bitmask The bitmask flags.\n     *  1 - Deep clone\n     *  2 - Flatten inherited properties\n     *  4 - Clone symbols\n     * @param {Function} [customizer] The function to customize cloning.\n     * @param {string} [key] The key of `value`.\n     * @param {Object} [object] The parent object of `value`.\n     * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n     * @returns {*} Returns the cloned value.\n     */function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value);}if(result!==undefined){return result;}if(!isObject(value)){return value;}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result);}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep);}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value));}}else{if(!cloneableTags[tag]){return object?value:{};}result=initCloneByTag(value,tag,baseClone,isDeep);}}// Check for circular references and return its corresponding clone.\nstack||(stack=new Stack());var stacked=stack.get(value);if(stacked){return stacked;}stack.set(value,result);var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key];}// Recursively populate clone (susceptible to call stack limits).\nassignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack));});return result;}/**\n     * The base implementation of `_.conforms` which doesn't clone `source`.\n     *\n     * @private\n     * @param {Object} source The object of property predicates to conform to.\n     * @returns {Function} Returns the new spec function.\n     */function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props);};}/**\n     * The base implementation of `_.conformsTo` which accepts `props` to check.\n     *\n     * @private\n     * @param {Object} object The object to inspect.\n     * @param {Object} source The object of property predicates to conform to.\n     * @returns {boolean} Returns `true` if `object` conforms, else `false`.\n     */function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length;}object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value)){return false;}}return true;}/**\n     * The base implementation of `_.delay` and `_.defer` which accepts `args`\n     * to provide to `func`.\n     *\n     * @private\n     * @param {Function} func The function to delay.\n     * @param {number} wait The number of milliseconds to delay invocation.\n     * @param {Array} args The arguments to provide to `func`.\n     * @returns {number|Object} Returns the timer id or timeout object.\n     */function baseDelay(func,wait,args){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}return setTimeout(function(){func.apply(undefined,args);},wait);}/**\n     * The base implementation of methods like `_.difference` without support\n     * for excluding multiple arrays or iteratee shorthands.\n     *\n     * @private\n     * @param {Array} array The array to inspect.\n     * @param {Array} values The values to exclude.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of filtered values.\n     */function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result;}if(iteratee){values=arrayMap(values,baseUnary(iteratee));}if(comparator){includes=arrayIncludesWith;isCommon=false;}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values);}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer;}}result.push(value);}else if(!includes(values,computed,comparator)){result.push(value);}}return result;}/**\n     * The base implementation of `_.forEach` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @returns {Array|Object} Returns `collection`.\n     */var baseEach=createBaseEach(baseForOwn);/**\n     * The base implementation of `_.forEachRight` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @returns {Array|Object} Returns `collection`.\n     */var baseEachRight=createBaseEach(baseForOwnRight,true);/**\n     * The base implementation of `_.every` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} predicate The function invoked per iteration.\n     * @returns {boolean} Returns `true` if all elements pass the predicate check,\n     *  else `false`\n     */function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result;});return result;}/**\n     * The base implementation of methods like `_.max` and `_.min` which accepts a\n     * `comparator` to determine the extremum value.\n     *\n     * @private\n     * @param {Array} array The array to iterate over.\n     * @param {Function} iteratee The iteratee invoked per iteration.\n     * @param {Function} comparator The comparator used to compare values.\n     * @returns {*} Returns the extremum value.\n     */function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value;}}return result;}/**\n     * The base implementation of `_.fill` without an iteratee call guard.\n     *\n     * @private\n     * @param {Array} array The array to fill.\n     * @param {*} value The value to fill `array` with.\n     * @param {number} [start=0] The start position.\n     * @param {number} [end=array.length] The end position.\n     * @returns {Array} Returns `array`.\n     */function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start;}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length;}end=start>end?0:toLength(end);while(start<end){array[start++]=value;}return array;}/**\n     * The base implementation of `_.filter` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} predicate The function invoked per iteration.\n     * @returns {Array} Returns the new filtered array.\n     */function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value);}});return result;}/**\n     * The base implementation of `_.flatten` with support for restricting flattening.\n     *\n     * @private\n     * @param {Array} array The array to flatten.\n     * @param {number} depth The maximum recursion depth.\n     * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n     * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n     * @param {Array} [result=[]] The initial result value.\n     * @returns {Array} Returns the new flattened array.\n     */function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){// Recursively flatten arrays (susceptible to call stack limits).\nbaseFlatten(value,depth-1,predicate,isStrict,result);}else{arrayPush(result,value);}}else if(!isStrict){result[result.length]=value;}}return result;}/**\n     * The base implementation of `baseForOwn` which iterates over `object`\n     * properties returned by `keysFunc` and invokes `iteratee` for each property.\n     * Iteratee functions may exit iteration early by explicitly returning `false`.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @param {Function} keysFunc The function to get the keys of `object`.\n     * @returns {Object} Returns `object`.\n     */var baseFor=createBaseFor();/**\n     * This function is like `baseFor` except that it iterates over properties\n     * in the opposite order.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @param {Function} keysFunc The function to get the keys of `object`.\n     * @returns {Object} Returns `object`.\n     */var baseForRight=createBaseFor(true);/**\n     * The base implementation of `_.forOwn` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     */function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys);}/**\n     * The base implementation of `_.forOwnRight` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     */function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys);}/**\n     * The base implementation of `_.functions` which creates an array of\n     * `object` function property names filtered from `props`.\n     *\n     * @private\n     * @param {Object} object The object to inspect.\n     * @param {Array} props The property names to filter.\n     * @returns {Array} Returns the function names.\n     */function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key]);});}/**\n     * The base implementation of `_.get` without support for default values.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path of the property to get.\n     * @returns {*} Returns the resolved value.\n     */function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])];}return index&&index==length?object:undefined;}/**\n     * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n     * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n     * symbols of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {Function} keysFunc The function to get the keys of `object`.\n     * @param {Function} symbolsFunc The function to get the symbols of `object`.\n     * @returns {Array} Returns the array of property names and symbols.\n     */function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object));}/**\n     * The base implementation of `getTag` without fallbacks for buggy environments.\n     *\n     * @private\n     * @param {*} value The value to query.\n     * @returns {string} Returns the `toStringTag`.\n     */function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag;}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value);}/**\n     * The base implementation of `_.gt` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is greater than `other`,\n     *  else `false`.\n     */function baseGt(value,other){return value>other;}/**\n     * The base implementation of `_.has` without support for deep paths.\n     *\n     * @private\n     * @param {Object} [object] The object to query.\n     * @param {Array|string} key The key to check.\n     * @returns {boolean} Returns `true` if `key` exists, else `false`.\n     */function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key);}/**\n     * The base implementation of `_.hasIn` without support for deep paths.\n     *\n     * @private\n     * @param {Object} [object] The object to query.\n     * @param {Array|string} key The key to check.\n     * @returns {boolean} Returns `true` if `key` exists, else `false`.\n     */function baseHasIn(object,key){return object!=null&&key in Object(object);}/**\n     * The base implementation of `_.inRange` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {number} number The number to check.\n     * @param {number} start The start of the range.\n     * @param {number} end The end of the range.\n     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.\n     */function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end);}/**\n     * The base implementation of methods like `_.intersection`, without support\n     * for iteratee shorthands, that accepts an array of arrays to inspect.\n     *\n     * @private\n     * @param {Array} arrays The arrays to inspect.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of shared values.\n     */function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee));}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined;}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer;}}if(seen){seen.push(computed);}result.push(value);}}return result;}/**\n     * The base implementation of `_.invert` and `_.invertBy` which inverts\n     * `object` with values transformed by `iteratee` and set by `setter`.\n     *\n     * @private\n     * @param {Object} object The object to iterate over.\n     * @param {Function} setter The function to set `accumulator` values.\n     * @param {Function} iteratee The iteratee to transform values.\n     * @param {Object} accumulator The initial inverted object.\n     * @returns {Function} Returns `accumulator`.\n     */function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object);});return accumulator;}/**\n     * The base implementation of `_.invoke` without support for individual\n     * method arguments.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path of the method to invoke.\n     * @param {Array} args The arguments to invoke the method with.\n     * @returns {*} Returns the result of the invoked method.\n     */function baseInvoke(object,path,args){path=castPath(path,object);object=parent(object,path);var func=object==null?object:object[toKey(last(path))];return func==null?undefined:apply(func,object,args);}/**\n     * The base implementation of `_.isArguments`.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n     */function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag;}/**\n     * The base implementation of `_.isArrayBuffer` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n     */function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag;}/**\n     * The base implementation of `_.isDate` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.\n     */function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag;}/**\n     * The base implementation of `_.isEqual` which supports partial comparisons\n     * and tracks traversed objects.\n     *\n     * @private\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @param {boolean} bitmask The bitmask flags.\n     *  1 - Unordered comparison\n     *  2 - Partial comparison\n     * @param {Function} [customizer] The function to customize comparisons.\n     * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n     */function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true;}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other;}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack);}/**\n     * A specialized version of `baseIsEqual` for arrays and objects which performs\n     * deep comparisons and tracks traversed objects enabling objects with circular\n     * references to be compared.\n     *\n     * @private\n     * @param {Object} object The object to compare.\n     * @param {Object} other The other object to compare.\n     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n     * @param {Function} customizer The function to customize comparisons.\n     * @param {Function} equalFunc The function to determine equivalents of values.\n     * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n     */function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false;}objIsArr=true;objIsObj=false;}if(isSameTag&&!objIsObj){stack||(stack=new Stack());return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,'__wrapped__'),othIsWrapped=othIsObj&&hasOwnProperty.call(other,'__wrapped__');if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack());return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack);}}if(!isSameTag){return false;}stack||(stack=new Stack());return equalObjects(object,other,bitmask,customizer,equalFunc,stack);}/**\n     * The base implementation of `_.isMap` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n     */function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag;}/**\n     * The base implementation of `_.isMatch` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Object} object The object to inspect.\n     * @param {Object} source The object of property values to match.\n     * @param {Array} matchData The property names, values, and compare flags to match.\n     * @param {Function} [customizer] The function to customize comparisons.\n     * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n     */function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length;}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false;}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false;}}else{var stack=new Stack();if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack);}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false;}}}return true;}/**\n     * The base implementation of `_.isNative` without bad shim checks.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a native function,\n     *  else `false`.\n     */function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false;}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value));}/**\n     * The base implementation of `_.isRegExp` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.\n     */function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag;}/**\n     * The base implementation of `_.isSet` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n     */function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag;}/**\n     * The base implementation of `_.isTypedArray` without Node.js optimizations.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n     */function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)];}/**\n     * The base implementation of `_.iteratee`.\n     *\n     * @private\n     * @param {*} [value=_.identity] The value to convert to an iteratee.\n     * @returns {Function} Returns the iteratee.\n     */function baseIteratee(value){// Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.\n// See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.\nif(typeof value=='function'){return value;}if(value==null){return identity;}if((typeof value==='undefined'?'undefined':_typeof(value))=='object'){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value);}return property(value);}/**\n     * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names.\n     */function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object);}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!='constructor'){result.push(key);}}return result;}/**\n     * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names.\n     */function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object);}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=='constructor'&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key);}}return result;}/**\n     * The base implementation of `_.lt` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is less than `other`,\n     *  else `false`.\n     */function baseLt(value,other){return value<other;}/**\n     * The base implementation of `_.map` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} iteratee The function invoked per iteration.\n     * @returns {Array} Returns the new mapped array.\n     */function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection);});return result;}/**\n     * The base implementation of `_.matches` which doesn't clone `source`.\n     *\n     * @private\n     * @param {Object} source The object of property values to match.\n     * @returns {Function} Returns the new spec function.\n     */function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1]);}return function(object){return object===source||baseIsMatch(object,source,matchData);};}/**\n     * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.\n     *\n     * @private\n     * @param {string} path The path of the property to get.\n     * @param {*} srcValue The value to match.\n     * @returns {Function} Returns the new spec function.\n     */function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue);}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG);};}/**\n     * The base implementation of `_.merge` without support for multiple sources.\n     *\n     * @private\n     * @param {Object} object The destination object.\n     * @param {Object} source The source object.\n     * @param {number} srcIndex The index of `source`.\n     * @param {Function} [customizer] The function to customize merged values.\n     * @param {Object} [stack] Tracks traversed source values and their merged\n     *  counterparts.\n     */function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return;}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack());baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);}else{var newValue=customizer?customizer(object[key],srcValue,key+'',object,source,stack):undefined;if(newValue===undefined){newValue=srcValue;}assignMergeValue(object,key,newValue);}},keysIn);}/**\n     * A specialized version of `baseMerge` for arrays and objects which performs\n     * deep merges and tracks traversed objects enabling objects with circular\n     * references to be merged.\n     *\n     * @private\n     * @param {Object} object The destination object.\n     * @param {Object} source The source object.\n     * @param {string} key The key of the value to merge.\n     * @param {number} srcIndex The index of `source`.\n     * @param {Function} mergeFunc The function to merge values.\n     * @param {Function} [customizer] The function to customize assigned values.\n     * @param {Object} [stack] Tracks traversed source values and their merged\n     *  counterparts.\n     */function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return;}var newValue=customizer?customizer(objValue,srcValue,key+'',object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue;}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue);}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true);}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true);}else{newValue=[];}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue);}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue);}}else{isCommon=false;}}if(isCommon){// Recursively merge objects and arrays (susceptible to call stack limits).\nstack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack['delete'](srcValue);}assignMergeValue(object,key,newValue);}/**\n     * The base implementation of `_.nth` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {Array} array The array to query.\n     * @param {number} n The index of the element to return.\n     * @returns {*} Returns the nth element of `array`.\n     */function baseNth(array,n){var length=array.length;if(!length){return;}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined;}/**\n     * The base implementation of `_.orderBy` without param guards.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function[]|Object[]|string[]} iteratees The iteratees to sort by.\n     * @param {string[]} orders The sort orders of `iteratees`.\n     * @returns {Array} Returns the new sorted array.\n     */function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value);});return{'criteria':criteria,'index':++index,'value':value};});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders);});}/**\n     * The base implementation of `_.pick` without support for individual\n     * property identifiers.\n     *\n     * @private\n     * @param {Object} object The source object.\n     * @param {string[]} paths The property paths to pick.\n     * @returns {Object} Returns the new object.\n     */function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path);});}/**\n     * The base implementation of  `_.pickBy` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Object} object The source object.\n     * @param {string[]} paths The property paths to pick.\n     * @param {Function} predicate The function invoked per property.\n     * @returns {Object} Returns the new object.\n     */function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value);}}return result;}/**\n     * A specialized version of `baseProperty` which supports deep paths.\n     *\n     * @private\n     * @param {Array|string} path The path of the property to get.\n     * @returns {Function} Returns the new accessor function.\n     */function basePropertyDeep(path){return function(object){return baseGet(object,path);};}/**\n     * The base implementation of `_.pullAllBy` without support for iteratee\n     * shorthands.\n     *\n     * @private\n     * @param {Array} array The array to modify.\n     * @param {Array} values The values to remove.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns `array`.\n     */function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values);}if(iteratee){seen=arrayMap(array,baseUnary(iteratee));}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1);}splice.call(array,fromIndex,1);}}return array;}/**\n     * The base implementation of `_.pullAt` without support for individual\n     * indexes or capturing the removed elements.\n     *\n     * @private\n     * @param {Array} array The array to modify.\n     * @param {number[]} indexes The indexes of elements to remove.\n     * @returns {Array} Returns `array`.\n     */function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1);}else{baseUnset(array,index);}}}return array;}/**\n     * The base implementation of `_.random` without support for returning\n     * floating-point numbers.\n     *\n     * @private\n     * @param {number} lower The lower bound.\n     * @param {number} upper The upper bound.\n     * @returns {number} Returns the random number.\n     */function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1));}/**\n     * The base implementation of `_.range` and `_.rangeRight` which doesn't\n     * coerce arguments.\n     *\n     * @private\n     * @param {number} start The start of the range.\n     * @param {number} end The end of the range.\n     * @param {number} step The value to increment or decrement by.\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Array} Returns the range of numbers.\n     */function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step;}return result;}/**\n     * The base implementation of `_.repeat` which doesn't coerce arguments.\n     *\n     * @private\n     * @param {string} string The string to repeat.\n     * @param {number} n The number of times to repeat the string.\n     * @returns {string} Returns the repeated string.\n     */function baseRepeat(string,n){var result='';if(!string||n<1||n>MAX_SAFE_INTEGER){return result;}// Leverage the exponentiation by squaring algorithm for a faster repeat.\n// See https://en.wikipedia.org/wiki/Exponentiation_by_squaring for more details.\ndo{if(n%2){result+=string;}n=nativeFloor(n/2);if(n){string+=string;}}while(n);return result;}/**\n     * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n     *\n     * @private\n     * @param {Function} func The function to apply a rest parameter to.\n     * @param {number} [start=func.length-1] The start position of the rest parameter.\n     * @returns {Function} Returns the new function.\n     */function baseRest(func,start){return setToString(overRest(func,start,identity),func+'');}/**\n     * The base implementation of `_.sample`.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to sample.\n     * @returns {*} Returns the random element.\n     */function baseSample(collection){return arraySample(values(collection));}/**\n     * The base implementation of `_.sampleSize` without param guards.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to sample.\n     * @param {number} n The number of elements to sample.\n     * @returns {Array} Returns the random elements.\n     */function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length));}/**\n     * The base implementation of `_.set`.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to set.\n     * @param {*} value The value to set.\n     * @param {Function} [customizer] The function to customize path creation.\n     * @returns {Object} Returns `object`.\n     */function baseSet(object,path,value,customizer){if(!isObject(object)){return object;}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{};}}assignValue(nested,key,newValue);nested=nested[key];}return object;}/**\n     * The base implementation of `setData` without support for hot loop shorting.\n     *\n     * @private\n     * @param {Function} func The function to associate metadata with.\n     * @param {*} data The metadata.\n     * @returns {Function} Returns `func`.\n     */var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func;};/**\n     * The base implementation of `setToString` without support for hot loop shorting.\n     *\n     * @private\n     * @param {Function} func The function to modify.\n     * @param {Function} string The `toString` result.\n     * @returns {Function} Returns `func`.\n     */var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,'toString',{'configurable':true,'enumerable':false,'value':constant(string),'writable':true});};/**\n     * The base implementation of `_.shuffle`.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to shuffle.\n     * @returns {Array} Returns the new shuffled array.\n     */function baseShuffle(collection){return shuffleSelf(values(collection));}/**\n     * The base implementation of `_.slice` without an iteratee call guard.\n     *\n     * @private\n     * @param {Array} array The array to slice.\n     * @param {number} [start=0] The start position.\n     * @param {number} [end=array.length] The end position.\n     * @returns {Array} Returns the slice of `array`.\n     */function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start;}end=end>length?length:end;if(end<0){end+=length;}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start];}return result;}/**\n     * The base implementation of `_.some` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} predicate The function invoked per iteration.\n     * @returns {boolean} Returns `true` if any element passes the predicate check,\n     *  else `false`.\n     */function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result;});return!!result;}/**\n     * The base implementation of `_.sortedIndex` and `_.sortedLastIndex` which\n     * performs a binary search of `array` to determine the index at which `value`\n     * should be inserted into `array` in order to maintain its sort order.\n     *\n     * @private\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @param {boolean} [retHighest] Specify returning the highest qualified index.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     */function baseSortedIndex(array,value,retHighest){var low=0,high=array==null?low:array.length;if(typeof value=='number'&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1;}else{high=mid;}}return high;}return baseSortedIndexBy(array,value,identity,retHighest);}/**\n     * The base implementation of `_.sortedIndexBy` and `_.sortedLastIndexBy`\n     * which invokes `iteratee` for `value` and each element of `array` to compute\n     * their sort ranking. The iteratee is invoked with one argument; (value).\n     *\n     * @private\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @param {Function} iteratee The iteratee invoked per element.\n     * @param {boolean} [retHighest] Specify returning the highest qualified index.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     */function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array==null?0:array.length,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive;}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined);}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull);}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol);}else if(othIsNull||othIsSymbol){setLow=false;}else{setLow=retHighest?computed<=value:computed<value;}if(setLow){low=mid+1;}else{high=mid;}}return nativeMin(high,MAX_ARRAY_INDEX);}/**\n     * The base implementation of `_.sortedUniq` and `_.sortedUniqBy` without\n     * support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array} array The array to inspect.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @returns {Array} Returns the new duplicate free array.\n     */function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value;}}return result;}/**\n     * The base implementation of `_.toNumber` which doesn't ensure correct\n     * conversions of binary, hexadecimal, or octal string values.\n     *\n     * @private\n     * @param {*} value The value to process.\n     * @returns {number} Returns the number.\n     */function baseToNumber(value){if(typeof value=='number'){return value;}if(isSymbol(value)){return NAN;}return+value;}/**\n     * The base implementation of `_.toString` which doesn't convert nullish\n     * values to empty strings.\n     *\n     * @private\n     * @param {*} value The value to process.\n     * @returns {string} Returns the string.\n     */function baseToString(value){// Exit early for strings to avoid a performance hit in some environments.\nif(typeof value=='string'){return value;}if(isArray(value)){// Recursively convert values (susceptible to call stack limits).\nreturn arrayMap(value,baseToString)+'';}if(isSymbol(value)){return symbolToString?symbolToString.call(value):'';}var result=value+'';return result=='0'&&1/value==-INFINITY?'-0':result;}/**\n     * The base implementation of `_.uniqBy` without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array} array The array to inspect.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new duplicate free array.\n     */function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith;}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set);}isCommon=false;includes=cacheHas;seen=new SetCache();}else{seen=iteratee?[]:result;}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer;}}if(iteratee){seen.push(computed);}result.push(value);}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed);}result.push(value);}}return result;}/**\n     * The base implementation of `_.unset`.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The property path to unset.\n     * @returns {boolean} Returns `true` if the property is deleted, else `false`.\n     */function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))];}/**\n     * The base implementation of `_.update`.\n     *\n     * @private\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to update.\n     * @param {Function} updater The function to produce the updated value.\n     * @param {Function} [customizer] The function to customize path creation.\n     * @returns {Object} Returns `object`.\n     */function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer);}/**\n     * The base implementation of methods like `_.dropWhile` and `_.takeWhile`\n     * without support for iteratee shorthands.\n     *\n     * @private\n     * @param {Array} array The array to query.\n     * @param {Function} predicate The function invoked per iteration.\n     * @param {boolean} [isDrop] Specify dropping elements instead of taking them.\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Array} Returns the slice of `array`.\n     */function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index);}/**\n     * The base implementation of `wrapperValue` which returns the result of\n     * performing a sequence of actions on the unwrapped `value`, where each\n     * successive action is supplied the return value of the previous.\n     *\n     * @private\n     * @param {*} value The unwrapped value.\n     * @param {Array} actions Actions to perform to resolve the unwrapped value.\n     * @returns {*} Returns the resolved value.\n     */function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value();}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args));},result);}/**\n     * The base implementation of methods like `_.xor`, without support for\n     * iteratee shorthands, that accepts an array of arrays to inspect.\n     *\n     * @private\n     * @param {Array} arrays The arrays to inspect.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of values.\n     */function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?baseUniq(arrays[0]):[];}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator);}}}return baseUniq(baseFlatten(result,1),iteratee,comparator);}/**\n     * This base implementation of `_.zipObject` which assigns values using `assignFunc`.\n     *\n     * @private\n     * @param {Array} props The property identifiers.\n     * @param {Array} values The property values.\n     * @param {Function} assignFunc The function to assign values.\n     * @returns {Object} Returns the new object.\n     */function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value);}return result;}/**\n     * Casts `value` to an empty array if it's not an array like object.\n     *\n     * @private\n     * @param {*} value The value to inspect.\n     * @returns {Array|Object} Returns the cast array-like object.\n     */function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[];}/**\n     * Casts `value` to `identity` if it's not a function.\n     *\n     * @private\n     * @param {*} value The value to inspect.\n     * @returns {Function} Returns cast function.\n     */function castFunction(value){return typeof value=='function'?value:identity;}/**\n     * Casts `value` to a path array if it's not one.\n     *\n     * @private\n     * @param {*} value The value to inspect.\n     * @param {Object} [object] The object to query keys on.\n     * @returns {Array} Returns the cast property path array.\n     */function castPath(value,object){if(isArray(value)){return value;}return isKey(value,object)?[value]:stringToPath(toString(value));}/**\n     * A `baseRest` alias which can be replaced with `identity` by module\n     * replacement plugins.\n     *\n     * @private\n     * @type {Function}\n     * @param {Function} func The function to apply a rest parameter to.\n     * @returns {Function} Returns the new function.\n     */var castRest=baseRest;/**\n     * Casts `array` to a slice if it's needed.\n     *\n     * @private\n     * @param {Array} array The array to inspect.\n     * @param {number} start The start position.\n     * @param {number} [end=array.length] The end position.\n     * @returns {Array} Returns the cast slice.\n     */function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end);}/**\n     * A simple wrapper around the global [`clearTimeout`](https://mdn.io/clearTimeout).\n     *\n     * @private\n     * @param {number|Object} id The timer id or timeout object of the timer to clear.\n     */var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id);};/**\n     * Creates a clone of  `buffer`.\n     *\n     * @private\n     * @param {Buffer} buffer The buffer to clone.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Buffer} Returns the cloned buffer.\n     */function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice();}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result;}/**\n     * Creates a clone of `arrayBuffer`.\n     *\n     * @private\n     * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n     * @returns {ArrayBuffer} Returns the cloned array buffer.\n     */function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result;}/**\n     * Creates a clone of `dataView`.\n     *\n     * @private\n     * @param {Object} dataView The data view to clone.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Object} Returns the cloned data view.\n     */function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength);}/**\n     * Creates a clone of `map`.\n     *\n     * @private\n     * @param {Object} map The map to clone.\n     * @param {Function} cloneFunc The function to clone values.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Object} Returns the cloned map.\n     */function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),CLONE_DEEP_FLAG):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor());}/**\n     * Creates a clone of `regexp`.\n     *\n     * @private\n     * @param {Object} regexp The regexp to clone.\n     * @returns {Object} Returns the cloned regexp.\n     */function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result;}/**\n     * Creates a clone of `set`.\n     *\n     * @private\n     * @param {Object} set The set to clone.\n     * @param {Function} cloneFunc The function to clone values.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Object} Returns the cloned set.\n     */function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),CLONE_DEEP_FLAG):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor());}/**\n     * Creates a clone of the `symbol` object.\n     *\n     * @private\n     * @param {Object} symbol The symbol object to clone.\n     * @returns {Object} Returns the cloned symbol object.\n     */function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{};}/**\n     * Creates a clone of `typedArray`.\n     *\n     * @private\n     * @param {Object} typedArray The typed array to clone.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Object} Returns the cloned typed array.\n     */function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length);}/**\n     * Compares values to sort them in ascending order.\n     *\n     * @private\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {number} Returns the sort order indicator for `value`.\n     */function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1;}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1;}}return 0;}/**\n     * Used by `_.orderBy` to compare multiple properties of a value to another\n     * and stable sort them.\n     *\n     * If `orders` is unspecified, all values are sorted in ascending order. Otherwise,\n     * specify an order of \"desc\" for descending or \"asc\" for ascending sort order\n     * of corresponding values.\n     *\n     * @private\n     * @param {Object} object The object to compare.\n     * @param {Object} other The other object to compare.\n     * @param {boolean[]|string[]} orders The order to sort by for each property.\n     * @returns {number} Returns the sort order indicator for `object`.\n     */function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result;}var order=orders[index];return result*(order=='desc'?-1:1);}}// Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications\n// that causes it, under certain circumstances, to provide the same value for\n// `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247\n// for more details.\n//\n// This also ensures a stable sort in V8 and other engines.\n// See https://bugs.chromium.org/p/v8/issues/detail?id=90 for more details.\nreturn object.index-other.index;}/**\n     * Creates an array that is the composition of partially applied arguments,\n     * placeholders, and provided arguments into a single array of arguments.\n     *\n     * @private\n     * @param {Array} args The provided arguments.\n     * @param {Array} partials The arguments to prepend to those provided.\n     * @param {Array} holders The `partials` placeholder indexes.\n     * @params {boolean} [isCurried] Specify composing for a curried function.\n     * @returns {Array} Returns the new array of composed arguments.\n     */function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex];}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex];}}while(rangeLength--){result[leftIndex++]=args[argsIndex++];}return result;}/**\n     * This function is like `composeArgs` except that the arguments composition\n     * is tailored for `_.partialRight`.\n     *\n     * @private\n     * @param {Array} args The provided arguments.\n     * @param {Array} partials The arguments to append to those provided.\n     * @param {Array} holders The `partials` placeholder indexes.\n     * @params {boolean} [isCurried] Specify composing for a curried function.\n     * @returns {Array} Returns the new array of composed arguments.\n     */function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex];}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex];}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++];}}return result;}/**\n     * Copies the values of `source` to `array`.\n     *\n     * @private\n     * @param {Array} source The array to copy values from.\n     * @param {Array} [array=[]] The array to copy values to.\n     * @returns {Array} Returns `array`.\n     */function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}return array;}/**\n     * Copies properties of `source` to `object`.\n     *\n     * @private\n     * @param {Object} source The object to copy properties from.\n     * @param {Array} props The property identifiers to copy.\n     * @param {Object} [object={}] The object to copy properties to.\n     * @param {Function} [customizer] The function to customize copied values.\n     * @returns {Object} Returns `object`.\n     */function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key];}if(isNew){baseAssignValue(object,key,newValue);}else{assignValue(object,key,newValue);}}return object;}/**\n     * Copies own symbols of `source` to `object`.\n     *\n     * @private\n     * @param {Object} source The object to copy symbols from.\n     * @param {Object} [object={}] The object to copy symbols to.\n     * @returns {Object} Returns `object`.\n     */function copySymbols(source,object){return copyObject(source,getSymbols(source),object);}/**\n     * Copies own and inherited symbols of `source` to `object`.\n     *\n     * @private\n     * @param {Object} source The object to copy symbols from.\n     * @param {Object} [object={}] The object to copy symbols to.\n     * @returns {Object} Returns `object`.\n     */function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object);}/**\n     * Creates a function like `_.groupBy`.\n     *\n     * @private\n     * @param {Function} setter The function to set accumulator values.\n     * @param {Function} [initializer] The accumulator object initializer.\n     * @returns {Function} Returns the new aggregator function.\n     */function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator);};}/**\n     * Creates a function like `_.assign`.\n     *\n     * @private\n     * @param {Function} assigner The function to assign values.\n     * @returns {Function} Returns the new assigner function.\n     */function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=='function'?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1;}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer);}}return object;});}/**\n     * Creates a `baseEach` or `baseEachRight` function.\n     *\n     * @private\n     * @param {Function} eachFunc The function to iterate over a collection.\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Function} Returns the new base function.\n     */function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection;}if(!isArrayLike(collection)){return eachFunc(collection,iteratee);}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break;}}return collection;};}/**\n     * Creates a base function for methods like `_.forIn` and `_.forOwn`.\n     *\n     * @private\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Function} Returns the new base function.\n     */function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break;}}return object;};}/**\n     * Creates a function that wraps `func` to invoke it with the optional `this`\n     * binding of `thisArg`.\n     *\n     * @private\n     * @param {Function} func The function to wrap.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @param {*} [thisArg] The `this` binding of `func`.\n     * @returns {Function} Returns the new wrapped function.\n     */function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments);}return wrapper;}/**\n     * Creates a function like `_.lowerFirst`.\n     *\n     * @private\n     * @param {string} methodName The name of the `String` case method to use.\n     * @returns {Function} Returns the new case function.\n     */function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(''):string.slice(1);return chr[methodName]()+trailing;};}/**\n     * Creates a function like `_.camelCase`.\n     *\n     * @private\n     * @param {Function} callback The function to combine each word.\n     * @returns {Function} Returns the new compounder function.\n     */function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,'')),callback,'');};}/**\n     * Creates a function that produces an instance of `Ctor` regardless of\n     * whether it was invoked as part of a `new` expression or by `call` or `apply`.\n     *\n     * @private\n     * @param {Function} Ctor The constructor to wrap.\n     * @returns {Function} Returns the new wrapped function.\n     */function createCtor(Ctor){return function(){// Use a `switch` statement to work with class constructors. See\n// http://ecma-international.org/ecma-262/7.0/#sec-ecmascript-function-objects-call-thisargument-argumentslist\n// for more details.\nvar args=arguments;switch(args.length){case 0:return new Ctor();case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6]);}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);// Mimic the constructor's `return` behavior.\n// See https://es5.github.io/#x13.2.2 for more details.\nreturn isObject(result)?result:thisBinding;};}/**\n     * Creates a function that wraps `func` to enable currying.\n     *\n     * @private\n     * @param {Function} func The function to wrap.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @param {number} arity The arity of `func`.\n     * @returns {Function} Returns the new wrapped function.\n     */function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index];}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length);}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args);}return wrapper;}/**\n     * Creates a `_.find` or `_.findLast` function.\n     *\n     * @private\n     * @param {Function} findIndexFunc The function to find the collection index.\n     * @returns {Function} Returns the new find function.\n     */function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function predicate(key){return iteratee(iterable[key],key,iterable);};}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined;};}/**\n     * Creates a `_.flow` or `_.flowRight` function.\n     *\n     * @private\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Function} Returns the new flow function.\n     */function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse();}while(index--){var func=funcs[index];if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}if(prereq&&!wrapper&&getFuncName(func)=='wrapper'){var wrapper=new LodashWrapper([],true);}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=='wrapper'?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3]);}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func);}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)){return wrapper.plant(value).value();}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result);}return result;};});}/**\n     * Creates a function that wraps `func` to invoke it with optional `this`\n     * binding of `thisArg`, partial application, and currying.\n     *\n     * @private\n     * @param {Function|string} func The function or method name to wrap.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @param {*} [thisArg] The `this` binding of `func`.\n     * @param {Array} [partials] The arguments to prepend to those provided to\n     *  the new function.\n     * @param {Array} [holders] The `partials` placeholder indexes.\n     * @param {Array} [partialsRight] The arguments to append to those provided\n     *  to the new function.\n     * @param {Array} [holdersRight] The `partialsRight` placeholder indexes.\n     * @param {Array} [argPos] The argument positions of the new function.\n     * @param {number} [ary] The arity cap of `func`.\n     * @param {number} [arity] The arity of `func`.\n     * @returns {Function} Returns the new wrapped function.\n     */function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index];}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder);}if(partials){args=composeArgs(args,partials,holders,isCurried);}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried);}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length);}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos);}else if(isFlip&&length>1){args.reverse();}if(isAry&&ary<length){args.length=ary;}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn);}return fn.apply(thisBinding,args);}return wrapper;}/**\n     * Creates a function like `_.invertBy`.\n     *\n     * @private\n     * @param {Function} setter The function to set accumulator values.\n     * @param {Function} toIteratee The function to resolve iteratees.\n     * @returns {Function} Returns the new inverter function.\n     */function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{});};}/**\n     * Creates a function that performs a mathematical operation on two values.\n     *\n     * @private\n     * @param {Function} operator The function to perform the operation.\n     * @param {number} [defaultValue] The value used for `undefined` arguments.\n     * @returns {Function} Returns the new mathematical operation function.\n     */function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue;}if(value!==undefined){result=value;}if(other!==undefined){if(result===undefined){return other;}if(typeof value=='string'||typeof other=='string'){value=baseToString(value);other=baseToString(other);}else{value=baseToNumber(value);other=baseToNumber(other);}result=operator(value,other);}return result;};}/**\n     * Creates a function like `_.over`.\n     *\n     * @private\n     * @param {Function} arrayFunc The function to iterate over iteratees.\n     * @returns {Function} Returns the new over function.\n     */function createOver(arrayFunc){return flatRest(function(iteratees){iteratees=arrayMap(iteratees,baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args);});});});}/**\n     * Creates the padding for `string` based on `length`. The `chars` string\n     * is truncated if the number of characters exceeds `length`.\n     *\n     * @private\n     * @param {number} length The padding length.\n     * @param {string} [chars=' '] The string used as padding.\n     * @returns {string} Returns the padding for `string`.\n     */function createPadding(length,chars){chars=chars===undefined?' ':baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars;}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(''):result.slice(0,length);}/**\n     * Creates a function that wraps `func` to invoke it with the `this` binding\n     * of `thisArg` and `partials` prepended to the arguments it receives.\n     *\n     * @private\n     * @param {Function} func The function to wrap.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @param {*} thisArg The `this` binding of `func`.\n     * @param {Array} partials The arguments to prepend to those provided to\n     *  the new function.\n     * @returns {Function} Returns the new wrapped function.\n     */function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex];}while(argsLength--){args[leftIndex++]=arguments[++argsIndex];}return apply(fn,isBind?thisArg:this,args);}return wrapper;}/**\n     * Creates a `_.range` or `_.rangeRight` function.\n     *\n     * @private\n     * @param {boolean} [fromRight] Specify iterating from right to left.\n     * @returns {Function} Returns the new range function.\n     */function createRange(fromRight){return function(start,end,step){if(step&&typeof step!='number'&&isIterateeCall(start,end,step)){end=step=undefined;}// Ensure the sign of `-0` is preserved.\nstart=toFinite(start);if(end===undefined){end=start;start=0;}else{end=toFinite(end);}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight);};}/**\n     * Creates a function that performs a relational operation on two values.\n     *\n     * @private\n     * @param {Function} operator The function to perform the operation.\n     * @returns {Function} Returns the new relational operation function.\n     */function createRelationalOperation(operator){return function(value,other){if(!(typeof value=='string'&&typeof other=='string')){value=toNumber(value);other=toNumber(other);}return operator(value,other);};}/**\n     * Creates a function that wraps `func` to continue currying.\n     *\n     * @private\n     * @param {Function} func The function to wrap.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @param {Function} wrapFunc The function to create the `func` wrapper.\n     * @param {*} placeholder The placeholder value.\n     * @param {*} [thisArg] The `this` binding of `func`.\n     * @param {Array} [partials] The arguments to prepend to those provided to\n     *  the new function.\n     * @param {Array} [holders] The `partials` placeholder indexes.\n     * @param {Array} [argPos] The argument positions of the new function.\n     * @param {number} [ary] The arity cap of `func`.\n     * @param {number} [arity] The arity of `func`.\n     * @returns {Function} Returns the new wrapped function.\n     */function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG);if(!(bitmask&WRAP_CURRY_BOUND_FLAG)){bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG);}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData);}result.placeholder=placeholder;return setWrapToString(result,func,bitmask);}/**\n     * Creates a function like `_.round`.\n     *\n     * @private\n     * @param {string} methodName The name of the `Math` method to use when rounding.\n     * @returns {Function} Returns the new round function.\n     */function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=precision==null?0:nativeMin(toInteger(precision),292);if(precision){// Shift with exponential notation to avoid floating-point issues.\n// See [MDN](https://mdn.io/round#Examples) for more details.\nvar pair=(toString(number)+'e').split('e'),value=func(pair[0]+'e'+(+pair[1]+precision));pair=(toString(value)+'e').split('e');return+(pair[0]+'e'+(+pair[1]-precision));}return func(number);};}/**\n     * Creates a set object of `values`.\n     *\n     * @private\n     * @param {Array} values The values to add to the set.\n     * @returns {Object} Returns the new set.\n     */var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values);};/**\n     * Creates a `_.toPairs` or `_.toPairsIn` function.\n     *\n     * @private\n     * @param {Function} keysFunc The function to get the keys of a given object.\n     * @returns {Function} Returns the new pairs function.\n     */function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object);}if(tag==setTag){return setToPairs(object);}return baseToPairs(object,keysFunc(object));};}/**\n     * Creates a function that either curries or invokes `func` with optional\n     * `this` binding and partially applied arguments.\n     *\n     * @private\n     * @param {Function|string} func The function or method name to wrap.\n     * @param {number} bitmask The bitmask flags.\n     *    1 - `_.bind`\n     *    2 - `_.bindKey`\n     *    4 - `_.curry` or `_.curryRight` of a bound function\n     *    8 - `_.curry`\n     *   16 - `_.curryRight`\n     *   32 - `_.partial`\n     *   64 - `_.partialRight`\n     *  128 - `_.rearg`\n     *  256 - `_.ary`\n     *  512 - `_.flip`\n     * @param {*} [thisArg] The `this` binding of `func`.\n     * @param {Array} [partials] The arguments to be partially applied.\n     * @param {Array} [holders] The `partials` placeholder indexes.\n     * @param {Array} [argPos] The argument positions of the new function.\n     * @param {number} [ary] The arity cap of `func`.\n     * @param {number} [arity] The arity of `func`.\n     * @returns {Function} Returns the new wrapped function.\n     */function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}var length=partials?partials.length:0;if(!length){bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG);partials=holders=undefined;}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined;}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data);}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)){bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG);}if(!bitmask||bitmask==WRAP_BIND_FLAG){var result=createBind(func,bitmask,thisArg);}else if(bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity);}else if((bitmask==WRAP_PARTIAL_FLAG||bitmask==(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials);}else{result=createHybrid.apply(undefined,newData);}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask);}/**\n     * Used by `_.defaults` to customize its `_.assignIn` use to assign properties\n     * of source objects to the destination object for all destination properties\n     * that resolve to `undefined`.\n     *\n     * @private\n     * @param {*} objValue The destination value.\n     * @param {*} srcValue The source value.\n     * @param {string} key The key of the property to assign.\n     * @param {Object} object The parent object of `objValue`.\n     * @returns {*} Returns the value to assign.\n     */function customDefaultsAssignIn(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue;}return objValue;}/**\n     * Used by `_.defaultsDeep` to customize its `_.merge` use to merge source\n     * objects into destination objects that are passed thru.\n     *\n     * @private\n     * @param {*} objValue The destination value.\n     * @param {*} srcValue The source value.\n     * @param {string} key The key of the property to merge.\n     * @param {Object} object The parent object of `objValue`.\n     * @param {Object} source The parent object of `srcValue`.\n     * @param {Object} [stack] Tracks traversed source values and their merged\n     *  counterparts.\n     * @returns {*} Returns the value to assign.\n     */function customDefaultsMerge(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){// Recursively merge objects and arrays (susceptible to call stack limits).\nstack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack);stack['delete'](srcValue);}return objValue;}/**\n     * Used by `_.omit` to customize its `_.cloneDeep` use to only clone plain\n     * objects.\n     *\n     * @private\n     * @param {*} value The value to inspect.\n     * @param {string} key The key of the property to inspect.\n     * @returns {*} Returns the uncloned value or `undefined` to defer cloning to `_.cloneDeep`.\n     */function customOmitClone(value){return isPlainObject(value)?undefined:value;}/**\n     * A specialized version of `baseIsEqualDeep` for arrays with support for\n     * partial deep comparisons.\n     *\n     * @private\n     * @param {Array} array The array to compare.\n     * @param {Array} other The other array to compare.\n     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n     * @param {Function} customizer The function to customize comparisons.\n     * @param {Function} equalFunc The function to determine equivalents of values.\n     * @param {Object} stack Tracks traversed `array` and `other` objects.\n     * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n     */function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false;}// Assume cyclic values are equal.\nvar stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other;}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache():undefined;stack.set(array,other);stack.set(other,array);// Ignore non-index properties.\nwhile(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);}if(compared!==undefined){if(compared){continue;}result=false;break;}// Recursively compare arrays (susceptible to call stack limits).\nif(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex);}})){result=false;break;}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break;}}stack['delete'](array);stack['delete'](other);return result;}/**\n     * A specialized version of `baseIsEqualDeep` for comparing objects of\n     * the same `toStringTag`.\n     *\n     * **Note:** This function only supports comparing values with tags of\n     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n     *\n     * @private\n     * @param {Object} object The object to compare.\n     * @param {Object} other The other object to compare.\n     * @param {string} tag The `toStringTag` of the objects to compare.\n     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n     * @param {Function} customizer The function to customize comparisons.\n     * @param {Function} equalFunc The function to determine equivalents of values.\n     * @param {Object} stack Tracks traversed `object` and `other` objects.\n     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n     */function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false;}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false;}return true;case boolTag:case dateTag:case numberTag:// Coerce booleans to `1` or `0` and dates to milliseconds.\n// Invalid dates are coerced to `NaN`.\nreturn eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:// Coerce regexes to strings and treat strings, primitives and objects,\n// as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n// for more details.\nreturn object==other+'';case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false;}// Assume cyclic values are equal.\nvar stacked=stack.get(object);if(stacked){return stacked==other;}bitmask|=COMPARE_UNORDERED_FLAG;// Recursively compare objects (susceptible to call stack limits).\nstack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack['delete'](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other);}}return false;}/**\n     * A specialized version of `baseIsEqualDeep` for objects with support for\n     * partial deep comparisons.\n     *\n     * @private\n     * @param {Object} object The object to compare.\n     * @param {Object} other The other object to compare.\n     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n     * @param {Function} customizer The function to customize comparisons.\n     * @param {Function} equalFunc The function to determine equivalents of values.\n     * @param {Object} stack Tracks traversed `object` and `other` objects.\n     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n     */function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false;}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false;}}// Assume cyclic values are equal.\nvar stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other;}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);}// Recursively compare objects (susceptible to call stack limits).\nif(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break;}skipCtor||(skipCtor=key=='constructor');}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;// Non `Object` object instances with different constructors are not equal.\nif(objCtor!=othCtor&&'constructor'in object&&'constructor'in other&&!(typeof objCtor=='function'&&objCtor instanceof objCtor&&typeof othCtor=='function'&&othCtor instanceof othCtor)){result=false;}}stack['delete'](object);stack['delete'](other);return result;}/**\n     * A specialized version of `baseRest` which flattens the rest array.\n     *\n     * @private\n     * @param {Function} func The function to apply a rest parameter to.\n     * @returns {Function} Returns the new function.\n     */function flatRest(func){return setToString(overRest(func,undefined,flatten),func+'');}/**\n     * Creates an array of own enumerable property names and symbols of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names and symbols.\n     */function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols);}/**\n     * Creates an array of own and inherited enumerable property names and\n     * symbols of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names and symbols.\n     */function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn);}/**\n     * Gets metadata for `func`.\n     *\n     * @private\n     * @param {Function} func The function to query.\n     * @returns {*} Returns the metadata for `func`.\n     */var getData=!metaMap?noop:function(func){return metaMap.get(func);};/**\n     * Gets the name of `func`.\n     *\n     * @private\n     * @param {Function} func The function to query.\n     * @returns {string} Returns the function name.\n     */function getFuncName(func){var result=func.name+'',array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name;}}return result;}/**\n     * Gets the argument placeholder value for `func`.\n     *\n     * @private\n     * @param {Function} func The function to inspect.\n     * @returns {*} Returns the placeholder value.\n     */function getHolder(func){var object=hasOwnProperty.call(lodash,'placeholder')?lodash:func;return object.placeholder;}/**\n     * Gets the appropriate \"iteratee\" function. If `_.iteratee` is customized,\n     * this function returns the custom method, otherwise it returns `baseIteratee`.\n     * If arguments are provided, the chosen function is invoked with them and\n     * its result is returned.\n     *\n     * @private\n     * @param {*} [value] The value to convert to an iteratee.\n     * @param {number} [arity] The arity of the created iteratee.\n     * @returns {Function} Returns the chosen function or its result.\n     */function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result;}/**\n     * Gets the data for `map`.\n     *\n     * @private\n     * @param {Object} map The map to query.\n     * @param {string} key The reference key.\n     * @returns {*} Returns the map data.\n     */function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}/**\n     * Gets the property names, values, and compare flags of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the match data of `object`.\n     */function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)];}return result;}/**\n     * Gets the native function at `key` of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {string} key The key of the method to get.\n     * @returns {*} Returns the function if it's native, else `undefined`.\n     */function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined;}/**\n     * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n     *\n     * @private\n     * @param {*} value The value to query.\n     * @returns {string} Returns the raw `toStringTag`.\n     */function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true;}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag;}else{delete value[symToStringTag];}}return result;}/**\n     * Creates an array of the own enumerable symbols of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of symbols.\n     */var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[];}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol);});};/**\n     * Creates an array of the own and inherited enumerable symbols of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of symbols.\n     */var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object);}return result;};/**\n     * Gets the `toStringTag` of `value`.\n     *\n     * @private\n     * @param {*} value The value to query.\n     * @returns {string} Returns the `toStringTag`.\n     */var getTag=baseGetTag;// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map())!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set())!=setTag||WeakMap&&getTag(new WeakMap())!=weakMapTag){getTag=function getTag(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):'';if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag;}}return result;};}/**\n     * Gets the view, applying any `transforms` to the `start` and `end` positions.\n     *\n     * @private\n     * @param {number} start The start of the view.\n     * @param {number} end The end of the view.\n     * @param {Array} transforms The transformations to apply to the view.\n     * @returns {Object} Returns an object containing the `start` and `end`\n     *  positions of the view.\n     */function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case'drop':start+=size;break;case'dropRight':end-=size;break;case'take':end=nativeMin(end,start+size);break;case'takeRight':start=nativeMax(start,end-size);break;}}return{'start':start,'end':end};}/**\n     * Extracts wrapper details from the `source` body comment.\n     *\n     * @private\n     * @param {string} source The source to inspect.\n     * @returns {Array} Returns the wrapper details.\n     */function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[];}/**\n     * Checks if `path` exists on `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path to check.\n     * @param {Function} hasFunc The function to check properties.\n     * @returns {boolean} Returns `true` if `path` exists, else `false`.\n     */function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break;}object=object[key];}if(result||++index!=length){return result;}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object));}/**\n     * Initializes an array clone.\n     *\n     * @private\n     * @param {Array} array The array to clone.\n     * @returns {Array} Returns the initialized clone.\n     */function initCloneArray(array){var length=array.length,result=array.constructor(length);// Add properties assigned by `RegExp#exec`.\nif(length&&typeof array[0]=='string'&&hasOwnProperty.call(array,'index')){result.index=array.index;result.input=array.input;}return result;}/**\n     * Initializes an object clone.\n     *\n     * @private\n     * @param {Object} object The object to clone.\n     * @returns {Object} Returns the initialized clone.\n     */function initCloneObject(object){return typeof object.constructor=='function'&&!isPrototype(object)?baseCreate(getPrototype(object)):{};}/**\n     * Initializes an object clone based on its `toStringTag`.\n     *\n     * **Note:** This function only supports cloning values with tags of\n     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n     *\n     * @private\n     * @param {Object} object The object to clone.\n     * @param {string} tag The `toStringTag` of the object to clone.\n     * @param {Function} cloneFunc The function to clone values.\n     * @param {boolean} [isDeep] Specify a deep clone.\n     * @returns {Object} Returns the initialized clone.\n     */function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object);}}/**\n     * Inserts wrapper `details` in a comment at the top of the `source` body.\n     *\n     * @private\n     * @param {string} source The source to modify.\n     * @returns {Array} details The details to insert.\n     * @returns {string} Returns the modified source.\n     */function insertWrapDetails(source,details){var length=details.length;if(!length){return source;}var lastIndex=length-1;details[lastIndex]=(length>1?'& ':'')+details[lastIndex];details=details.join(length>2?', ':' ');return source.replace(reWrapComment,'{\\n/* [wrapped with '+details+'] */\\n');}/**\n     * Checks if `value` is a flattenable `arguments` object or array.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n     */function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol]);}/**\n     * Checks if `value` is a valid array-like index.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n     * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n     */function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=='number'||reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}/**\n     * Checks if the given arguments are from an iteratee call.\n     *\n     * @private\n     * @param {*} value The potential iteratee value argument.\n     * @param {*} index The potential iteratee index or key argument.\n     * @param {*} object The potential iteratee object argument.\n     * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n     *  else `false`.\n     */function isIterateeCall(value,index,object){if(!isObject(object)){return false;}var type=typeof index==='undefined'?'undefined':_typeof(index);if(type=='number'?isArrayLike(object)&&isIndex(index,object.length):type=='string'&&index in object){return eq(object[index],value);}return false;}/**\n     * Checks if `value` is a property name and not a property path.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @param {Object} [object] The object to query keys on.\n     * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n     */function isKey(value,object){if(isArray(value)){return false;}var type=typeof value==='undefined'?'undefined':_typeof(value);if(type=='number'||type=='symbol'||type=='boolean'||value==null||isSymbol(value)){return true;}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object);}/**\n     * Checks if `value` is suitable for use as unique object key.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n     */function isKeyable(value){var type=typeof value==='undefined'?'undefined':_typeof(value);return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}/**\n     * Checks if `func` has a lazy counterpart.\n     *\n     * @private\n     * @param {Function} func The function to check.\n     * @returns {boolean} Returns `true` if `func` has a lazy counterpart,\n     *  else `false`.\n     */function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!='function'||!(funcName in LazyWrapper.prototype)){return false;}if(func===other){return true;}var data=getData(other);return!!data&&func===data[0];}/**\n     * Checks if `func` has its source masked.\n     *\n     * @private\n     * @param {Function} func The function to check.\n     * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n     */function isMasked(func){return!!maskSrcKey&&maskSrcKey in func;}/**\n     * Checks if `func` is capable of being masked.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `func` is maskable, else `false`.\n     */var isMaskable=coreJsData?isFunction:stubFalse;/**\n     * Checks if `value` is likely a prototype object.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n     */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto;return value===proto;}/**\n     * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.\n     *\n     * @private\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` if suitable for strict\n     *  equality comparisons, else `false`.\n     */function isStrictComparable(value){return value===value&&!isObject(value);}/**\n     * A specialized version of `matchesProperty` for source values suitable\n     * for strict equality comparisons, i.e. `===`.\n     *\n     * @private\n     * @param {string} key The key of the property to get.\n     * @param {*} srcValue The value to match.\n     * @returns {Function} Returns the new spec function.\n     */function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false;}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object));};}/**\n     * A specialized version of `_.memoize` which clears the memoized function's\n     * cache when it exceeds `MAX_MEMOIZE_SIZE`.\n     *\n     * @private\n     * @param {Function} func The function to have its output memoized.\n     * @returns {Function} Returns the new memoized function.\n     */function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear();}return key;});var cache=result.cache;return result;}/**\n     * Merges the function metadata of `source` into `data`.\n     *\n     * Merging metadata reduces the number of wrappers used to invoke a function.\n     * This is possible because methods like `_.bind`, `_.curry`, and `_.partial`\n     * may be applied regardless of execution order. Methods like `_.ary` and\n     * `_.rearg` modify function arguments, making the order in which they are\n     * executed important, preventing the merging of metadata. However, we make\n     * an exception for a safe combined case where curried functions have `_.ary`\n     * and or `_.rearg` applied.\n     *\n     * @private\n     * @param {Array} data The destination metadata.\n     * @param {Array} source The source metadata.\n     * @returns {Array} Returns `data`.\n     */function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG);var isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;// Exit early if metadata can't be merged.\nif(!(isCommon||isCombo)){return data;}// Use source `thisArg` if available.\nif(srcBitmask&WRAP_BIND_FLAG){data[2]=source[2];// Set when currying a bound function.\nnewBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG;}// Compose partial arguments.\nvar value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4];}// Compose partial right arguments.\nvalue=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6];}// Use source `argPos` if available.\nvalue=source[7];if(value){data[7]=value;}// Use source `ary` if it's smaller.\nif(srcBitmask&WRAP_ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8]);}// Use source `arity` if one is not provided.\nif(data[9]==null){data[9]=source[9];}// Use source `func` and merge bitmasks.\ndata[0]=source[0];data[1]=newBitmask;return data;}/**\n     * This function is like\n     * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n     * except that it includes inherited enumerable properties.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names.\n     */function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key);}}return result;}/**\n     * Converts `value` to a string using `Object.prototype.toString`.\n     *\n     * @private\n     * @param {*} value The value to convert.\n     * @returns {string} Returns the converted string.\n     */function objectToString(value){return nativeObjectToString.call(value);}/**\n     * A specialized version of `baseRest` which transforms the rest array.\n     *\n     * @private\n     * @param {Function} func The function to apply a rest parameter to.\n     * @param {number} [start=func.length-1] The start position of the rest parameter.\n     * @param {Function} transform The rest array transform.\n     * @returns {Function} Returns the new function.\n     */function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index];}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index];}otherArgs[start]=transform(array);return apply(func,this,otherArgs);};}/**\n     * Gets the parent value at `path` of `object`.\n     *\n     * @private\n     * @param {Object} object The object to query.\n     * @param {Array} path The path to get the parent value of.\n     * @returns {*} Returns the parent value.\n     */function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1));}/**\n     * Reorder `array` according to the specified indexes where the element at\n     * the first index is assigned as the first element, the element at\n     * the second index is assigned as the second element, and so on.\n     *\n     * @private\n     * @param {Array} array The array to reorder.\n     * @param {Array} indexes The arranged array indexes.\n     * @returns {Array} Returns `array`.\n     */function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined;}return array;}/**\n     * Sets metadata for `func`.\n     *\n     * **Note:** If this function becomes hot, i.e. is invoked a lot in a short\n     * period of time, it will trip its breaker and transition to an identity\n     * function to avoid garbage collection pauses in V8. See\n     * [V8 issue 2070](https://bugs.chromium.org/p/v8/issues/detail?id=2070)\n     * for more details.\n     *\n     * @private\n     * @param {Function} func The function to associate metadata with.\n     * @param {*} data The metadata.\n     * @returns {Function} Returns `func`.\n     */var setData=shortOut(baseSetData);/**\n     * A simple wrapper around the global [`setTimeout`](https://mdn.io/setTimeout).\n     *\n     * @private\n     * @param {Function} func The function to delay.\n     * @param {number} wait The number of milliseconds to delay invocation.\n     * @returns {number|Object} Returns the timer id or timeout object.\n     */var setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait);};/**\n     * Sets the `toString` method of `func` to return `string`.\n     *\n     * @private\n     * @param {Function} func The function to modify.\n     * @param {Function} string The `toString` result.\n     * @returns {Function} Returns `func`.\n     */var setToString=shortOut(baseSetToString);/**\n     * Sets the `toString` method of `wrapper` to mimic the source of `reference`\n     * with wrapper details in a comment at the top of the source body.\n     *\n     * @private\n     * @param {Function} wrapper The function to modify.\n     * @param {Function} reference The reference function.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @returns {Function} Returns `wrapper`.\n     */function setWrapToString(wrapper,reference,bitmask){var source=reference+'';return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)));}/**\n     * Creates a function that'll short out and invoke `identity` instead\n     * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n     * milliseconds.\n     *\n     * @private\n     * @param {Function} func The function to restrict.\n     * @returns {Function} Returns the new shortable function.\n     */function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0];}}else{count=0;}return func.apply(undefined,arguments);};}/**\n     * A specialized version of `_.shuffle` which mutates and sets the size of `array`.\n     *\n     * @private\n     * @param {Array} array The array to shuffle.\n     * @param {number} [size=array.length] The size of `array`.\n     * @returns {Array} Returns `array`.\n     */function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index];array[index]=value;}array.length=size;return array;}/**\n     * Converts `string` to a property path array.\n     *\n     * @private\n     * @param {string} string The string to convert.\n     * @returns {Array} Returns the property path array.\n     */var stringToPath=memoizeCapped(function(string){var result=[];if(reLeadingDot.test(string)){result.push('');}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,'$1'):number||match);});return result;});/**\n     * Converts `value` to a string key if it's not a string or symbol.\n     *\n     * @private\n     * @param {*} value The value to inspect.\n     * @returns {string|symbol} Returns the key.\n     */function toKey(value){if(typeof value=='string'||isSymbol(value)){return value;}var result=value+'';return result=='0'&&1/value==-INFINITY?'-0':result;}/**\n     * Converts `func` to its source code.\n     *\n     * @private\n     * @param {Function} func The function to convert.\n     * @returns {string} Returns the source code.\n     */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return'';}/**\n     * Updates wrapper `details` based on `bitmask` flags.\n     *\n     * @private\n     * @returns {Array} details The details to modify.\n     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.\n     * @returns {Array} Returns `details`.\n     */function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value='_.'+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value);}});return details.sort();}/**\n     * Creates a clone of `wrapper`.\n     *\n     * @private\n     * @param {Object} wrapper The wrapper to clone.\n     * @returns {Object} Returns the cloned wrapper.\n     */function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone();}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result;}/*------------------------------------------------------------------------*//**\n     * Creates an array of elements split into groups the length of `size`.\n     * If `array` can't be split evenly, the final chunk will be the remaining\n     * elements.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to process.\n     * @param {number} [size=1] The length of each chunk\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the new array of chunks.\n     * @example\n     *\n     * _.chunk(['a', 'b', 'c', 'd'], 2);\n     * // => [['a', 'b'], ['c', 'd']]\n     *\n     * _.chunk(['a', 'b', 'c', 'd'], 3);\n     * // => [['a', 'b', 'c'], ['d']]\n     */function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1;}else{size=nativeMax(toInteger(size),0);}var length=array==null?0:array.length;if(!length||size<1){return[];}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size);}return result;}/**\n     * Creates an array with all falsey values removed. The values `false`, `null`,\n     * `0`, `\"\"`, `undefined`, and `NaN` are falsey.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to compact.\n     * @returns {Array} Returns the new array of filtered values.\n     * @example\n     *\n     * _.compact([0, 1, false, 2, '', 3]);\n     * // => [1, 2, 3]\n     */function compact(array){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value;}}return result;}/**\n     * Creates a new array concatenating `array` with any additional arrays\n     * and/or values.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to concatenate.\n     * @param {...*} [values] The values to concatenate.\n     * @returns {Array} Returns the new concatenated array.\n     * @example\n     *\n     * var array = [1];\n     * var other = _.concat(array, 2, [3], [[4]]);\n     *\n     * console.log(other);\n     * // => [1, 2, 3, [4]]\n     *\n     * console.log(array);\n     * // => [1]\n     */function concat(){var length=arguments.length;if(!length){return[];}var args=Array(length-1),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index];}return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1));}/**\n     * Creates an array of `array` values not included in the other given arrays\n     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons. The order and references of result values are\n     * determined by the first array.\n     *\n     * **Note:** Unlike `_.pullAll`, this method returns a new array.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {...Array} [values] The values to exclude.\n     * @returns {Array} Returns the new array of filtered values.\n     * @see _.without, _.xor\n     * @example\n     *\n     * _.difference([2, 1], [2, 3]);\n     * // => [1]\n     */var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[];});/**\n     * This method is like `_.difference` except that it accepts `iteratee` which\n     * is invoked for each element of `array` and `values` to generate the criterion\n     * by which they're compared. The order and references of result values are\n     * determined by the first array. The iteratee is invoked with one argument:\n     * (value).\n     *\n     * **Note:** Unlike `_.pullAllBy`, this method returns a new array.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {...Array} [values] The values to exclude.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns the new array of filtered values.\n     * @example\n     *\n     * _.differenceBy([2.1, 1.2], [2.3, 3.4], Math.floor);\n     * // => [1.2]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.differenceBy([{ 'x': 2 }, { 'x': 1 }], [{ 'x': 1 }], 'x');\n     * // => [{ 'x': 2 }]\n     */var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined;}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[];});/**\n     * This method is like `_.difference` except that it accepts `comparator`\n     * which is invoked to compare elements of `array` to `values`. The order and\n     * references of result values are determined by the first array. The comparator\n     * is invoked with two arguments: (arrVal, othVal).\n     *\n     * **Note:** Unlike `_.pullAllWith`, this method returns a new array.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {...Array} [values] The values to exclude.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of filtered values.\n     * @example\n     *\n     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];\n     *\n     * _.differenceWith(objects, [{ 'x': 1, 'y': 2 }], _.isEqual);\n     * // => [{ 'x': 2, 'y': 1 }]\n     */var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined;}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[];});/**\n     * Creates a slice of `array` with `n` elements dropped from the beginning.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.5.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {number} [n=1] The number of elements to drop.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.drop([1, 2, 3]);\n     * // => [2, 3]\n     *\n     * _.drop([1, 2, 3], 2);\n     * // => [3]\n     *\n     * _.drop([1, 2, 3], 5);\n     * // => []\n     *\n     * _.drop([1, 2, 3], 0);\n     * // => [1, 2, 3]\n     */function drop(array,n,guard){var length=array==null?0:array.length;if(!length){return[];}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length);}/**\n     * Creates a slice of `array` with `n` elements dropped from the end.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {number} [n=1] The number of elements to drop.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.dropRight([1, 2, 3]);\n     * // => [1, 2]\n     *\n     * _.dropRight([1, 2, 3], 2);\n     * // => [1]\n     *\n     * _.dropRight([1, 2, 3], 5);\n     * // => []\n     *\n     * _.dropRight([1, 2, 3], 0);\n     * // => [1, 2, 3]\n     */function dropRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[];}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n);}/**\n     * Creates a slice of `array` excluding elements dropped from the end.\n     * Elements are dropped until `predicate` returns falsey. The predicate is\n     * invoked with three arguments: (value, index, array).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': true },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': false }\n     * ];\n     *\n     * _.dropRightWhile(users, function(o) { return !o.active; });\n     * // => objects for ['barney']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.dropRightWhile(users, { 'user': 'pebbles', 'active': false });\n     * // => objects for ['barney', 'fred']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.dropRightWhile(users, ['active', false]);\n     * // => objects for ['barney']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.dropRightWhile(users, 'active');\n     * // => objects for ['barney', 'fred', 'pebbles']\n     */function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[];}/**\n     * Creates a slice of `array` excluding elements dropped from the beginning.\n     * Elements are dropped until `predicate` returns falsey. The predicate is\n     * invoked with three arguments: (value, index, array).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': false },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': true }\n     * ];\n     *\n     * _.dropWhile(users, function(o) { return !o.active; });\n     * // => objects for ['pebbles']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.dropWhile(users, { 'user': 'barney', 'active': false });\n     * // => objects for ['fred', 'pebbles']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.dropWhile(users, ['active', false]);\n     * // => objects for ['pebbles']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.dropWhile(users, 'active');\n     * // => objects for ['barney', 'fred', 'pebbles']\n     */function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[];}/**\n     * Fills elements of `array` with `value` from `start` up to, but not\n     * including, `end`.\n     *\n     * **Note:** This method mutates `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.2.0\n     * @category Array\n     * @param {Array} array The array to fill.\n     * @param {*} value The value to fill `array` with.\n     * @param {number} [start=0] The start position.\n     * @param {number} [end=array.length] The end position.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = [1, 2, 3];\n     *\n     * _.fill(array, 'a');\n     * console.log(array);\n     * // => ['a', 'a', 'a']\n     *\n     * _.fill(Array(3), 2);\n     * // => [2, 2, 2]\n     *\n     * _.fill([4, 6, 8, 10], '*', 1, 3);\n     * // => [4, '*', '*', 10]\n     */function fill(array,value,start,end){var length=array==null?0:array.length;if(!length){return[];}if(start&&typeof start!='number'&&isIterateeCall(array,value,start)){start=0;end=length;}return baseFill(array,value,start,end);}/**\n     * This method is like `_.find` except that it returns the index of the first\n     * element `predicate` returns truthy for instead of the element itself.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param {number} [fromIndex=0] The index to search from.\n     * @returns {number} Returns the index of the found element, else `-1`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': false },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': true }\n     * ];\n     *\n     * _.findIndex(users, function(o) { return o.user == 'barney'; });\n     * // => 0\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.findIndex(users, { 'user': 'fred', 'active': false });\n     * // => 1\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.findIndex(users, ['active', false]);\n     * // => 0\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.findIndex(users, 'active');\n     * // => 2\n     */function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1;}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0);}return baseFindIndex(array,getIteratee(predicate,3),index);}/**\n     * This method is like `_.findIndex` except that it iterates over elements\n     * of `collection` from right to left.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param {number} [fromIndex=array.length-1] The index to search from.\n     * @returns {number} Returns the index of the found element, else `-1`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': true },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': false }\n     * ];\n     *\n     * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n     * // => 2\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n     * // => 0\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.findLastIndex(users, ['active', false]);\n     * // => 2\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.findLastIndex(users, 'active');\n     * // => 0\n     */function findLastIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1;}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1);}return baseFindIndex(array,getIteratee(predicate,3),index,true);}/**\n     * Flattens `array` a single level deep.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to flatten.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * _.flatten([1, [2, [3, [4]], 5]]);\n     * // => [1, 2, [3, [4]], 5]\n     */function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[];}/**\n     * Recursively flattens `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to flatten.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * _.flattenDeep([1, [2, [3, [4]], 5]]);\n     * // => [1, 2, 3, 4, 5]\n     */function flattenDeep(array){var length=array==null?0:array.length;return length?baseFlatten(array,INFINITY):[];}/**\n     * Recursively flatten `array` up to `depth` times.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.4.0\n     * @category Array\n     * @param {Array} array The array to flatten.\n     * @param {number} [depth=1] The maximum recursion depth.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * var array = [1, [2, [3, [4]], 5]];\n     *\n     * _.flattenDepth(array, 1);\n     * // => [1, 2, [3, [4]], 5]\n     *\n     * _.flattenDepth(array, 2);\n     * // => [1, 2, 3, [4], 5]\n     */function flattenDepth(array,depth){var length=array==null?0:array.length;if(!length){return[];}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth);}/**\n     * The inverse of `_.toPairs`; this method returns an object composed\n     * from key-value `pairs`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} pairs The key-value pairs.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * _.fromPairs([['a', 1], ['b', 2]]);\n     * // => { 'a': 1, 'b': 2 }\n     */function fromPairs(pairs){var index=-1,length=pairs==null?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1];}return result;}/**\n     * Gets the first element of `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @alias first\n     * @category Array\n     * @param {Array} array The array to query.\n     * @returns {*} Returns the first element of `array`.\n     * @example\n     *\n     * _.head([1, 2, 3]);\n     * // => 1\n     *\n     * _.head([]);\n     * // => undefined\n     */function head(array){return array&&array.length?array[0]:undefined;}/**\n     * Gets the index at which the first occurrence of `value` is found in `array`\n     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons. If `fromIndex` is negative, it's used as the\n     * offset from the end of `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {*} value The value to search for.\n     * @param {number} [fromIndex=0] The index to search from.\n     * @returns {number} Returns the index of the matched value, else `-1`.\n     * @example\n     *\n     * _.indexOf([1, 2, 1, 2], 2);\n     * // => 1\n     *\n     * // Search from the `fromIndex`.\n     * _.indexOf([1, 2, 1, 2], 2, 2);\n     * // => 3\n     */function indexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1;}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0);}return baseIndexOf(array,value,index);}/**\n     * Gets all but the last element of `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.initial([1, 2, 3]);\n     * // => [1, 2]\n     */function initial(array){var length=array==null?0:array.length;return length?baseSlice(array,0,-1):[];}/**\n     * Creates an array of unique values that are included in all given arrays\n     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons. The order and references of result values are\n     * determined by the first array.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @returns {Array} Returns the new array of intersecting values.\n     * @example\n     *\n     * _.intersection([2, 1], [2, 3]);\n     * // => [2]\n     */var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[];});/**\n     * This method is like `_.intersection` except that it accepts `iteratee`\n     * which is invoked for each element of each `arrays` to generate the criterion\n     * by which they're compared. The order and references of result values are\n     * determined by the first array. The iteratee is invoked with one argument:\n     * (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns the new array of intersecting values.\n     * @example\n     *\n     * _.intersectionBy([2.1, 1.2], [2.3, 3.4], Math.floor);\n     * // => [2.1]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.intersectionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');\n     * // => [{ 'x': 1 }]\n     */var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined;}else{mapped.pop();}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[];});/**\n     * This method is like `_.intersection` except that it accepts `comparator`\n     * which is invoked to compare elements of `arrays`. The order and references\n     * of result values are determined by the first array. The comparator is\n     * invoked with two arguments: (arrVal, othVal).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of intersecting values.\n     * @example\n     *\n     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];\n     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];\n     *\n     * _.intersectionWith(objects, others, _.isEqual);\n     * // => [{ 'x': 1, 'y': 2 }]\n     */var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);comparator=typeof comparator=='function'?comparator:undefined;if(comparator){mapped.pop();}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[];});/**\n     * Converts all elements in `array` into a string separated by `separator`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to convert.\n     * @param {string} [separator=','] The element separator.\n     * @returns {string} Returns the joined string.\n     * @example\n     *\n     * _.join(['a', 'b', 'c'], '~');\n     * // => 'a~b~c'\n     */function join(array,separator){return array==null?'':nativeJoin.call(array,separator);}/**\n     * Gets the last element of `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @returns {*} Returns the last element of `array`.\n     * @example\n     *\n     * _.last([1, 2, 3]);\n     * // => 3\n     */function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined;}/**\n     * This method is like `_.indexOf` except that it iterates over elements of\n     * `array` from right to left.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {*} value The value to search for.\n     * @param {number} [fromIndex=array.length-1] The index to search from.\n     * @returns {number} Returns the index of the matched value, else `-1`.\n     * @example\n     *\n     * _.lastIndexOf([1, 2, 1, 2], 2);\n     * // => 3\n     *\n     * // Search from the `fromIndex`.\n     * _.lastIndexOf([1, 2, 1, 2], 2, 2);\n     * // => 1\n     */function lastIndexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1;}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=index<0?nativeMax(length+index,0):nativeMin(index,length-1);}return value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,true);}/**\n     * Gets the element at index `n` of `array`. If `n` is negative, the nth\n     * element from the end is returned.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.11.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {number} [n=0] The index of the element to return.\n     * @returns {*} Returns the nth element of `array`.\n     * @example\n     *\n     * var array = ['a', 'b', 'c', 'd'];\n     *\n     * _.nth(array, 1);\n     * // => 'b'\n     *\n     * _.nth(array, -2);\n     * // => 'c';\n     */function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined;}/**\n     * Removes all given values from `array` using\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons.\n     *\n     * **Note:** Unlike `_.without`, this method mutates `array`. Use `_.remove`\n     * to remove elements from an array by predicate.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {...*} [values] The values to remove.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];\n     *\n     * _.pull(array, 'a', 'c');\n     * console.log(array);\n     * // => ['b', 'b']\n     */var pull=baseRest(pullAll);/**\n     * This method is like `_.pull` except that it accepts an array of values to remove.\n     *\n     * **Note:** Unlike `_.difference`, this method mutates `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {Array} values The values to remove.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];\n     *\n     * _.pullAll(array, ['a', 'c']);\n     * console.log(array);\n     * // => ['b', 'b']\n     */function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array;}/**\n     * This method is like `_.pullAll` except that it accepts `iteratee` which is\n     * invoked for each element of `array` and `values` to generate the criterion\n     * by which they're compared. The iteratee is invoked with one argument: (value).\n     *\n     * **Note:** Unlike `_.differenceBy`, this method mutates `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {Array} values The values to remove.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = [{ 'x': 1 }, { 'x': 2 }, { 'x': 3 }, { 'x': 1 }];\n     *\n     * _.pullAllBy(array, [{ 'x': 1 }, { 'x': 3 }], 'x');\n     * console.log(array);\n     * // => [{ 'x': 2 }]\n     */function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array;}/**\n     * This method is like `_.pullAll` except that it accepts `comparator` which\n     * is invoked to compare elements of `array` to `values`. The comparator is\n     * invoked with two arguments: (arrVal, othVal).\n     *\n     * **Note:** Unlike `_.differenceWith`, this method mutates `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.6.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {Array} values The values to remove.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = [{ 'x': 1, 'y': 2 }, { 'x': 3, 'y': 4 }, { 'x': 5, 'y': 6 }];\n     *\n     * _.pullAllWith(array, [{ 'x': 3, 'y': 4 }], _.isEqual);\n     * console.log(array);\n     * // => [{ 'x': 1, 'y': 2 }, { 'x': 5, 'y': 6 }]\n     */function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array;}/**\n     * Removes elements from `array` corresponding to `indexes` and returns an\n     * array of removed elements.\n     *\n     * **Note:** Unlike `_.at`, this method mutates `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {...(number|number[])} [indexes] The indexes of elements to remove.\n     * @returns {Array} Returns the new array of removed elements.\n     * @example\n     *\n     * var array = ['a', 'b', 'c', 'd'];\n     * var pulled = _.pullAt(array, [1, 3]);\n     *\n     * console.log(array);\n     * // => ['a', 'c']\n     *\n     * console.log(pulled);\n     * // => ['b', 'd']\n     */var pullAt=flatRest(function(array,indexes){var length=array==null?0:array.length,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index;}).sort(compareAscending));return result;});/**\n     * Removes all elements from `array` that `predicate` returns truthy for\n     * and returns an array of the removed elements. The predicate is invoked\n     * with three arguments: (value, index, array).\n     *\n     * **Note:** Unlike `_.filter`, this method mutates `array`. Use `_.pull`\n     * to pull elements from an array by value.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new array of removed elements.\n     * @example\n     *\n     * var array = [1, 2, 3, 4];\n     * var evens = _.remove(array, function(n) {\n     *   return n % 2 == 0;\n     * });\n     *\n     * console.log(array);\n     * // => [1, 3]\n     *\n     * console.log(evens);\n     * // => [2, 4]\n     */function remove(array,predicate){var result=[];if(!(array&&array.length)){return result;}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index);}}basePullAt(array,indexes);return result;}/**\n     * Reverses `array` so that the first element becomes the last, the second\n     * element becomes the second to last, and so on.\n     *\n     * **Note:** This method mutates `array` and is based on\n     * [`Array#reverse`](https://mdn.io/Array/reverse).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to modify.\n     * @returns {Array} Returns `array`.\n     * @example\n     *\n     * var array = [1, 2, 3];\n     *\n     * _.reverse(array);\n     * // => [3, 2, 1]\n     *\n     * console.log(array);\n     * // => [3, 2, 1]\n     */function reverse(array){return array==null?array:nativeReverse.call(array);}/**\n     * Creates a slice of `array` from `start` up to, but not including, `end`.\n     *\n     * **Note:** This method is used instead of\n     * [`Array#slice`](https://mdn.io/Array/slice) to ensure dense arrays are\n     * returned.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to slice.\n     * @param {number} [start=0] The start position.\n     * @param {number} [end=array.length] The end position.\n     * @returns {Array} Returns the slice of `array`.\n     */function slice(array,start,end){var length=array==null?0:array.length;if(!length){return[];}if(end&&typeof end!='number'&&isIterateeCall(array,start,end)){start=0;end=length;}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end);}return baseSlice(array,start,end);}/**\n     * Uses a binary search to determine the lowest index at which `value`\n     * should be inserted into `array` in order to maintain its sort order.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     * @example\n     *\n     * _.sortedIndex([30, 50], 40);\n     * // => 1\n     */function sortedIndex(array,value){return baseSortedIndex(array,value);}/**\n     * This method is like `_.sortedIndex` except that it accepts `iteratee`\n     * which is invoked for `value` and each element of `array` to compute their\n     * sort ranking. The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     * @example\n     *\n     * var objects = [{ 'x': 4 }, { 'x': 5 }];\n     *\n     * _.sortedIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });\n     * // => 0\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.sortedIndexBy(objects, { 'x': 4 }, 'x');\n     * // => 0\n     */function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2));}/**\n     * This method is like `_.indexOf` except that it performs a binary\n     * search on a sorted `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {*} value The value to search for.\n     * @returns {number} Returns the index of the matched value, else `-1`.\n     * @example\n     *\n     * _.sortedIndexOf([4, 5, 5, 5, 6], 5);\n     * // => 1\n     */function sortedIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index;}}return-1;}/**\n     * This method is like `_.sortedIndex` except that it returns the highest\n     * index at which `value` should be inserted into `array` in order to\n     * maintain its sort order.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     * @example\n     *\n     * _.sortedLastIndex([4, 5, 5, 5, 6], 5);\n     * // => 4\n     */function sortedLastIndex(array,value){return baseSortedIndex(array,value,true);}/**\n     * This method is like `_.sortedLastIndex` except that it accepts `iteratee`\n     * which is invoked for `value` and each element of `array` to compute their\n     * sort ranking. The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The sorted array to inspect.\n     * @param {*} value The value to evaluate.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {number} Returns the index at which `value` should be inserted\n     *  into `array`.\n     * @example\n     *\n     * var objects = [{ 'x': 4 }, { 'x': 5 }];\n     *\n     * _.sortedLastIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });\n     * // => 1\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.sortedLastIndexBy(objects, { 'x': 4 }, 'x');\n     * // => 1\n     */function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true);}/**\n     * This method is like `_.lastIndexOf` except that it performs a binary\n     * search on a sorted `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {*} value The value to search for.\n     * @returns {number} Returns the index of the matched value, else `-1`.\n     * @example\n     *\n     * _.sortedLastIndexOf([4, 5, 5, 5, 6], 5);\n     * // => 3\n     */function sortedLastIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index;}}return-1;}/**\n     * This method is like `_.uniq` except that it's designed and optimized\n     * for sorted arrays.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @returns {Array} Returns the new duplicate free array.\n     * @example\n     *\n     * _.sortedUniq([1, 1, 2]);\n     * // => [1, 2]\n     */function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[];}/**\n     * This method is like `_.uniqBy` except that it's designed and optimized\n     * for sorted arrays.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {Function} [iteratee] The iteratee invoked per element.\n     * @returns {Array} Returns the new duplicate free array.\n     * @example\n     *\n     * _.sortedUniqBy([1.1, 1.2, 2.3, 2.4], Math.floor);\n     * // => [1.1, 2.3]\n     */function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[];}/**\n     * Gets all but the first element of `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.tail([1, 2, 3]);\n     * // => [2, 3]\n     */function tail(array){var length=array==null?0:array.length;return length?baseSlice(array,1,length):[];}/**\n     * Creates a slice of `array` with `n` elements taken from the beginning.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {number} [n=1] The number of elements to take.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.take([1, 2, 3]);\n     * // => [1]\n     *\n     * _.take([1, 2, 3], 2);\n     * // => [1, 2]\n     *\n     * _.take([1, 2, 3], 5);\n     * // => [1, 2, 3]\n     *\n     * _.take([1, 2, 3], 0);\n     * // => []\n     */function take(array,n,guard){if(!(array&&array.length)){return[];}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n);}/**\n     * Creates a slice of `array` with `n` elements taken from the end.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {number} [n=1] The number of elements to take.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * _.takeRight([1, 2, 3]);\n     * // => [3]\n     *\n     * _.takeRight([1, 2, 3], 2);\n     * // => [2, 3]\n     *\n     * _.takeRight([1, 2, 3], 5);\n     * // => [1, 2, 3]\n     *\n     * _.takeRight([1, 2, 3], 0);\n     * // => []\n     */function takeRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[];}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length);}/**\n     * Creates a slice of `array` with elements taken from the end. Elements are\n     * taken until `predicate` returns falsey. The predicate is invoked with\n     * three arguments: (value, index, array).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': true },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': false }\n     * ];\n     *\n     * _.takeRightWhile(users, function(o) { return !o.active; });\n     * // => objects for ['fred', 'pebbles']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.takeRightWhile(users, { 'user': 'pebbles', 'active': false });\n     * // => objects for ['pebbles']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.takeRightWhile(users, ['active', false]);\n     * // => objects for ['fred', 'pebbles']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.takeRightWhile(users, 'active');\n     * // => []\n     */function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[];}/**\n     * Creates a slice of `array` with elements taken from the beginning. Elements\n     * are taken until `predicate` returns falsey. The predicate is invoked with\n     * three arguments: (value, index, array).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Array\n     * @param {Array} array The array to query.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the slice of `array`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'active': false },\n     *   { 'user': 'fred',    'active': false },\n     *   { 'user': 'pebbles', 'active': true }\n     * ];\n     *\n     * _.takeWhile(users, function(o) { return !o.active; });\n     * // => objects for ['barney', 'fred']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.takeWhile(users, { 'user': 'barney', 'active': false });\n     * // => objects for ['barney']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.takeWhile(users, ['active', false]);\n     * // => objects for ['barney', 'fred']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.takeWhile(users, 'active');\n     * // => []\n     */function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[];}/**\n     * Creates an array of unique values, in order, from all given arrays using\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @returns {Array} Returns the new array of combined values.\n     * @example\n     *\n     * _.union([2], [1, 2]);\n     * // => [2, 1]\n     */var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true));});/**\n     * This method is like `_.union` except that it accepts `iteratee` which is\n     * invoked for each element of each `arrays` to generate the criterion by\n     * which uniqueness is computed. Result values are chosen from the first\n     * array in which the value occurs. The iteratee is invoked with one argument:\n     * (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns the new array of combined values.\n     * @example\n     *\n     * _.unionBy([2.1], [1.2, 2.3], Math.floor);\n     * // => [2.1, 1.2]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.unionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');\n     * // => [{ 'x': 1 }, { 'x': 2 }]\n     */var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined;}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2));});/**\n     * This method is like `_.union` except that it accepts `comparator` which\n     * is invoked to compare elements of `arrays`. Result values are chosen from\n     * the first array in which the value occurs. The comparator is invoked\n     * with two arguments: (arrVal, othVal).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of combined values.\n     * @example\n     *\n     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];\n     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];\n     *\n     * _.unionWith(objects, others, _.isEqual);\n     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]\n     */var unionWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=='function'?comparator:undefined;return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator);});/**\n     * Creates a duplicate-free version of an array, using\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons, in which only the first occurrence of each element\n     * is kept. The order of result values is determined by the order they occur\n     * in the array.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @returns {Array} Returns the new duplicate free array.\n     * @example\n     *\n     * _.uniq([2, 1, 2]);\n     * // => [2, 1]\n     */function uniq(array){return array&&array.length?baseUniq(array):[];}/**\n     * This method is like `_.uniq` except that it accepts `iteratee` which is\n     * invoked for each element in `array` to generate the criterion by which\n     * uniqueness is computed. The order of result values is determined by the\n     * order they occur in the array. The iteratee is invoked with one argument:\n     * (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns the new duplicate free array.\n     * @example\n     *\n     * _.uniqBy([2.1, 1.2, 2.3], Math.floor);\n     * // => [2.1, 1.2]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.uniqBy([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');\n     * // => [{ 'x': 1 }, { 'x': 2 }]\n     */function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[];}/**\n     * This method is like `_.uniq` except that it accepts `comparator` which\n     * is invoked to compare elements of `array`. The order of result values is\n     * determined by the order they occur in the array.The comparator is invoked\n     * with two arguments: (arrVal, othVal).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new duplicate free array.\n     * @example\n     *\n     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 2 }];\n     *\n     * _.uniqWith(objects, _.isEqual);\n     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }]\n     */function uniqWith(array,comparator){comparator=typeof comparator=='function'?comparator:undefined;return array&&array.length?baseUniq(array,undefined,comparator):[];}/**\n     * This method is like `_.zip` except that it accepts an array of grouped\n     * elements and creates an array regrouping the elements to their pre-zip\n     * configuration.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.2.0\n     * @category Array\n     * @param {Array} array The array of grouped elements to process.\n     * @returns {Array} Returns the new array of regrouped elements.\n     * @example\n     *\n     * var zipped = _.zip(['a', 'b'], [1, 2], [true, false]);\n     * // => [['a', 1, true], ['b', 2, false]]\n     *\n     * _.unzip(zipped);\n     * // => [['a', 'b'], [1, 2], [true, false]]\n     */function unzip(array){if(!(array&&array.length)){return[];}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true;}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index));});}/**\n     * This method is like `_.unzip` except that it accepts `iteratee` to specify\n     * how regrouped values should be combined. The iteratee is invoked with the\n     * elements of each group: (...group).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.8.0\n     * @category Array\n     * @param {Array} array The array of grouped elements to process.\n     * @param {Function} [iteratee=_.identity] The function to combine\n     *  regrouped values.\n     * @returns {Array} Returns the new array of regrouped elements.\n     * @example\n     *\n     * var zipped = _.zip([1, 2], [10, 20], [100, 200]);\n     * // => [[1, 10, 100], [2, 20, 200]]\n     *\n     * _.unzipWith(zipped, _.add);\n     * // => [3, 30, 300]\n     */function unzipWith(array,iteratee){if(!(array&&array.length)){return[];}var result=unzip(array);if(iteratee==null){return result;}return arrayMap(result,function(group){return apply(iteratee,undefined,group);});}/**\n     * Creates an array excluding all given values using\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * for equality comparisons.\n     *\n     * **Note:** Unlike `_.pull`, this method returns a new array.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {Array} array The array to inspect.\n     * @param {...*} [values] The values to exclude.\n     * @returns {Array} Returns the new array of filtered values.\n     * @see _.difference, _.xor\n     * @example\n     *\n     * _.without([2, 1, 2, 3], 1, 2);\n     * // => [3]\n     */var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[];});/**\n     * Creates an array of unique values that is the\n     * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)\n     * of the given arrays. The order of result values is determined by the order\n     * they occur in the arrays.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.4.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @returns {Array} Returns the new array of filtered values.\n     * @see _.difference, _.without\n     * @example\n     *\n     * _.xor([2, 1], [2, 3]);\n     * // => [1, 3]\n     */var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject));});/**\n     * This method is like `_.xor` except that it accepts `iteratee` which is\n     * invoked for each element of each `arrays` to generate the criterion by\n     * which by which they're compared. The order of result values is determined\n     * by the order they occur in the arrays. The iteratee is invoked with one\n     * argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Array} Returns the new array of filtered values.\n     * @example\n     *\n     * _.xorBy([2.1, 1.2], [2.3, 3.4], Math.floor);\n     * // => [1.2, 3.4]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.xorBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');\n     * // => [{ 'x': 2 }]\n     */var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined;}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2));});/**\n     * This method is like `_.xor` except that it accepts `comparator` which is\n     * invoked to compare elements of `arrays`. The order of result values is\n     * determined by the order they occur in the arrays. The comparator is invoked\n     * with two arguments: (arrVal, othVal).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to inspect.\n     * @param {Function} [comparator] The comparator invoked per element.\n     * @returns {Array} Returns the new array of filtered values.\n     * @example\n     *\n     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];\n     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];\n     *\n     * _.xorWith(objects, others, _.isEqual);\n     * // => [{ 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]\n     */var xorWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=='function'?comparator:undefined;return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator);});/**\n     * Creates an array of grouped elements, the first of which contains the\n     * first elements of the given arrays, the second of which contains the\n     * second elements of the given arrays, and so on.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to process.\n     * @returns {Array} Returns the new array of grouped elements.\n     * @example\n     *\n     * _.zip(['a', 'b'], [1, 2], [true, false]);\n     * // => [['a', 1, true], ['b', 2, false]]\n     */var zip=baseRest(unzip);/**\n     * This method is like `_.fromPairs` except that it accepts two arrays,\n     * one of property identifiers and one of corresponding values.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.4.0\n     * @category Array\n     * @param {Array} [props=[]] The property identifiers.\n     * @param {Array} [values=[]] The property values.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * _.zipObject(['a', 'b'], [1, 2]);\n     * // => { 'a': 1, 'b': 2 }\n     */function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue);}/**\n     * This method is like `_.zipObject` except that it supports property paths.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.1.0\n     * @category Array\n     * @param {Array} [props=[]] The property identifiers.\n     * @param {Array} [values=[]] The property values.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * _.zipObjectDeep(['a.b[0].c', 'a.b[1].d'], [1, 2]);\n     * // => { 'a': { 'b': [{ 'c': 1 }, { 'd': 2 }] } }\n     */function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet);}/**\n     * This method is like `_.zip` except that it accepts `iteratee` to specify\n     * how grouped values should be combined. The iteratee is invoked with the\n     * elements of each group: (...group).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.8.0\n     * @category Array\n     * @param {...Array} [arrays] The arrays to process.\n     * @param {Function} [iteratee=_.identity] The function to combine\n     *  grouped values.\n     * @returns {Array} Returns the new array of grouped elements.\n     * @example\n     *\n     * _.zipWith([1, 2], [10, 20], [100, 200], function(a, b, c) {\n     *   return a + b + c;\n     * });\n     * // => [111, 222]\n     */var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=='function'?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee);});/*------------------------------------------------------------------------*//**\n     * Creates a `lodash` wrapper instance that wraps `value` with explicit method\n     * chain sequences enabled. The result of such sequences must be unwrapped\n     * with `_#value`.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.3.0\n     * @category Seq\n     * @param {*} value The value to wrap.\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'age': 36 },\n     *   { 'user': 'fred',    'age': 40 },\n     *   { 'user': 'pebbles', 'age': 1 }\n     * ];\n     *\n     * var youngest = _\n     *   .chain(users)\n     *   .sortBy('age')\n     *   .map(function(o) {\n     *     return o.user + ' is ' + o.age;\n     *   })\n     *   .head()\n     *   .value();\n     * // => 'pebbles is 1'\n     */function chain(value){var result=lodash(value);result.__chain__=true;return result;}/**\n     * This method invokes `interceptor` and returns `value`. The interceptor\n     * is invoked with one argument; (value). The purpose of this method is to\n     * \"tap into\" a method chain sequence in order to modify intermediate results.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Seq\n     * @param {*} value The value to provide to `interceptor`.\n     * @param {Function} interceptor The function to invoke.\n     * @returns {*} Returns `value`.\n     * @example\n     *\n     * _([1, 2, 3])\n     *  .tap(function(array) {\n     *    // Mutate input array.\n     *    array.pop();\n     *  })\n     *  .reverse()\n     *  .value();\n     * // => [2, 1]\n     */function tap(value,interceptor){interceptor(value);return value;}/**\n     * This method is like `_.tap` except that it returns the result of `interceptor`.\n     * The purpose of this method is to \"pass thru\" values replacing intermediate\n     * results in a method chain sequence.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Seq\n     * @param {*} value The value to provide to `interceptor`.\n     * @param {Function} interceptor The function to invoke.\n     * @returns {*} Returns the result of `interceptor`.\n     * @example\n     *\n     * _('  abc  ')\n     *  .chain()\n     *  .trim()\n     *  .thru(function(value) {\n     *    return [value];\n     *  })\n     *  .value();\n     * // => ['abc']\n     */function thru(value,interceptor){return interceptor(value);}/**\n     * This method is the wrapper version of `_.at`.\n     *\n     * @name at\n     * @memberOf _\n     * @since 1.0.0\n     * @category Seq\n     * @param {...(string|string[])} [paths] The property paths to pick.\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };\n     *\n     * _(object).at(['a[0].b.c', 'a[1]']).value();\n     * // => [3, 4]\n     */var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function interceptor(object){return baseAt(object,paths);};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor);}value=value.slice(start,+start+(length?1:0));value.__actions__.push({'func':thru,'args':[interceptor],'thisArg':undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined);}return array;});});/**\n     * Creates a `lodash` wrapper instance with explicit method chain sequences enabled.\n     *\n     * @name chain\n     * @memberOf _\n     * @since 0.1.0\n     * @category Seq\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney', 'age': 36 },\n     *   { 'user': 'fred',   'age': 40 }\n     * ];\n     *\n     * // A sequence without explicit chaining.\n     * _(users).head();\n     * // => { 'user': 'barney', 'age': 36 }\n     *\n     * // A sequence with explicit chaining.\n     * _(users)\n     *   .chain()\n     *   .head()\n     *   .pick('user')\n     *   .value();\n     * // => { 'user': 'barney' }\n     */function wrapperChain(){return chain(this);}/**\n     * Executes the chain sequence and returns the wrapped result.\n     *\n     * @name commit\n     * @memberOf _\n     * @since 3.2.0\n     * @category Seq\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * var array = [1, 2];\n     * var wrapped = _(array).push(3);\n     *\n     * console.log(array);\n     * // => [1, 2]\n     *\n     * wrapped = wrapped.commit();\n     * console.log(array);\n     * // => [1, 2, 3]\n     *\n     * wrapped.last();\n     * // => 3\n     *\n     * console.log(array);\n     * // => [1, 2, 3]\n     */function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__);}/**\n     * Gets the next value on a wrapped object following the\n     * [iterator protocol](https://mdn.io/iteration_protocols#iterator).\n     *\n     * @name next\n     * @memberOf _\n     * @since 4.0.0\n     * @category Seq\n     * @returns {Object} Returns the next iterator value.\n     * @example\n     *\n     * var wrapped = _([1, 2]);\n     *\n     * wrapped.next();\n     * // => { 'done': false, 'value': 1 }\n     *\n     * wrapped.next();\n     * // => { 'done': false, 'value': 2 }\n     *\n     * wrapped.next();\n     * // => { 'done': true, 'value': undefined }\n     */function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value());}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{'done':done,'value':value};}/**\n     * Enables the wrapper to be iterable.\n     *\n     * @name Symbol.iterator\n     * @memberOf _\n     * @since 4.0.0\n     * @category Seq\n     * @returns {Object} Returns the wrapper object.\n     * @example\n     *\n     * var wrapped = _([1, 2]);\n     *\n     * wrapped[Symbol.iterator]() === wrapped;\n     * // => true\n     *\n     * Array.from(wrapped);\n     * // => [1, 2]\n     */function wrapperToIterator(){return this;}/**\n     * Creates a clone of the chain sequence planting `value` as the wrapped value.\n     *\n     * @name plant\n     * @memberOf _\n     * @since 3.2.0\n     * @category Seq\n     * @param {*} value The value to plant.\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * var wrapped = _([1, 2]).map(square);\n     * var other = wrapped.plant([3, 4]);\n     *\n     * other.value();\n     * // => [9, 16]\n     *\n     * wrapped.value();\n     * // => [1, 4]\n     */function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone;}else{result=clone;}var previous=clone;parent=parent.__wrapped__;}previous.__wrapped__=value;return result;}/**\n     * This method is the wrapper version of `_.reverse`.\n     *\n     * **Note:** This method mutates the wrapped array.\n     *\n     * @name reverse\n     * @memberOf _\n     * @since 0.1.0\n     * @category Seq\n     * @returns {Object} Returns the new `lodash` wrapper instance.\n     * @example\n     *\n     * var array = [1, 2, 3];\n     *\n     * _(array).reverse().value()\n     * // => [3, 2, 1]\n     *\n     * console.log(array);\n     * // => [3, 2, 1]\n     */function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this);}wrapped=wrapped.reverse();wrapped.__actions__.push({'func':thru,'args':[reverse],'thisArg':undefined});return new LodashWrapper(wrapped,this.__chain__);}return this.thru(reverse);}/**\n     * Executes the chain sequence to resolve the unwrapped value.\n     *\n     * @name value\n     * @memberOf _\n     * @since 0.1.0\n     * @alias toJSON, valueOf\n     * @category Seq\n     * @returns {*} Returns the resolved unwrapped value.\n     * @example\n     *\n     * _([1, 2, 3]).value();\n     * // => [1, 2, 3]\n     */function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__);}/*------------------------------------------------------------------------*//**\n     * Creates an object composed of keys generated from the results of running\n     * each element of `collection` thru `iteratee`. The corresponding value of\n     * each key is the number of times the key was returned by `iteratee`. The\n     * iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.5.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.\n     * @returns {Object} Returns the composed aggregate object.\n     * @example\n     *\n     * _.countBy([6.1, 4.2, 6.3], Math.floor);\n     * // => { '4': 1, '6': 2 }\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.countBy(['one', 'two', 'three'], 'length');\n     * // => { '3': 2, '5': 1 }\n     */var countBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){++result[key];}else{baseAssignValue(result,key,1);}});/**\n     * Checks if `predicate` returns truthy for **all** elements of `collection`.\n     * Iteration is stopped once `predicate` returns falsey. The predicate is\n     * invoked with three arguments: (value, index|key, collection).\n     *\n     * **Note:** This method returns `true` for\n     * [empty collections](https://en.wikipedia.org/wiki/Empty_set) because\n     * [everything is true](https://en.wikipedia.org/wiki/Vacuous_truth) of\n     * elements of empty collections.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {boolean} Returns `true` if all elements pass the predicate check,\n     *  else `false`.\n     * @example\n     *\n     * _.every([true, 1, null, 'yes'], Boolean);\n     * // => false\n     *\n     * var users = [\n     *   { 'user': 'barney', 'age': 36, 'active': false },\n     *   { 'user': 'fred',   'age': 40, 'active': false }\n     * ];\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.every(users, { 'user': 'barney', 'active': false });\n     * // => false\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.every(users, ['active', false]);\n     * // => true\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.every(users, 'active');\n     * // => false\n     */function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined;}return func(collection,getIteratee(predicate,3));}/**\n     * Iterates over elements of `collection`, returning an array of all elements\n     * `predicate` returns truthy for. The predicate is invoked with three\n     * arguments: (value, index|key, collection).\n     *\n     * **Note:** Unlike `_.remove`, this method returns a new array.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new filtered array.\n     * @see _.reject\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney', 'age': 36, 'active': true },\n     *   { 'user': 'fred',   'age': 40, 'active': false }\n     * ];\n     *\n     * _.filter(users, function(o) { return !o.active; });\n     * // => objects for ['fred']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.filter(users, { 'age': 36, 'active': true });\n     * // => objects for ['barney']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.filter(users, ['active', false]);\n     * // => objects for ['fred']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.filter(users, 'active');\n     * // => objects for ['barney']\n     */function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3));}/**\n     * Iterates over elements of `collection`, returning the first element\n     * `predicate` returns truthy for. The predicate is invoked with three\n     * arguments: (value, index|key, collection).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param {number} [fromIndex=0] The index to search from.\n     * @returns {*} Returns the matched element, else `undefined`.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'age': 36, 'active': true },\n     *   { 'user': 'fred',    'age': 40, 'active': false },\n     *   { 'user': 'pebbles', 'age': 1,  'active': true }\n     * ];\n     *\n     * _.find(users, function(o) { return o.age < 40; });\n     * // => object for 'barney'\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.find(users, { 'age': 1, 'active': true });\n     * // => object for 'pebbles'\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.find(users, ['active', false]);\n     * // => object for 'fred'\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.find(users, 'active');\n     * // => object for 'barney'\n     */var find=createFind(findIndex);/**\n     * This method is like `_.find` except that it iterates over elements of\n     * `collection` from right to left.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param {number} [fromIndex=collection.length-1] The index to search from.\n     * @returns {*} Returns the matched element, else `undefined`.\n     * @example\n     *\n     * _.findLast([1, 2, 3, 4], function(n) {\n     *   return n % 2 == 1;\n     * });\n     * // => 3\n     */var findLast=createFind(findLastIndex);/**\n     * Creates a flattened array of values by running each element in `collection`\n     * thru `iteratee` and flattening the mapped results. The iteratee is invoked\n     * with three arguments: (value, index|key, collection).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * function duplicate(n) {\n     *   return [n, n];\n     * }\n     *\n     * _.flatMap([1, 2], duplicate);\n     * // => [1, 1, 2, 2]\n     */function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1);}/**\n     * This method is like `_.flatMap` except that it recursively flattens the\n     * mapped results.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.7.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * function duplicate(n) {\n     *   return [[[n, n]]];\n     * }\n     *\n     * _.flatMapDeep([1, 2], duplicate);\n     * // => [1, 1, 2, 2]\n     */function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY);}/**\n     * This method is like `_.flatMap` except that it recursively flattens the\n     * mapped results up to `depth` times.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.7.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @param {number} [depth=1] The maximum recursion depth.\n     * @returns {Array} Returns the new flattened array.\n     * @example\n     *\n     * function duplicate(n) {\n     *   return [[[n, n]]];\n     * }\n     *\n     * _.flatMapDepth([1, 2], duplicate, 2);\n     * // => [[1, 1], [2, 2]]\n     */function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth);}/**\n     * Iterates over elements of `collection` and invokes `iteratee` for each element.\n     * The iteratee is invoked with three arguments: (value, index|key, collection).\n     * Iteratee functions may exit iteration early by explicitly returning `false`.\n     *\n     * **Note:** As with other \"Collections\" methods, objects with a \"length\"\n     * property are iterated like arrays. To avoid this behavior use `_.forIn`\n     * or `_.forOwn` for object iteration.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @alias each\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array|Object} Returns `collection`.\n     * @see _.forEachRight\n     * @example\n     *\n     * _.forEach([1, 2], function(value) {\n     *   console.log(value);\n     * });\n     * // => Logs `1` then `2`.\n     *\n     * _.forEach({ 'a': 1, 'b': 2 }, function(value, key) {\n     *   console.log(key);\n     * });\n     * // => Logs 'a' then 'b' (iteration order is not guaranteed).\n     */function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3));}/**\n     * This method is like `_.forEach` except that it iterates over elements of\n     * `collection` from right to left.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @alias eachRight\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array|Object} Returns `collection`.\n     * @see _.forEach\n     * @example\n     *\n     * _.forEachRight([1, 2], function(value) {\n     *   console.log(value);\n     * });\n     * // => Logs `2` then `1`.\n     */function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3));}/**\n     * Creates an object composed of keys generated from the results of running\n     * each element of `collection` thru `iteratee`. The order of grouped values\n     * is determined by the order they occur in `collection`. The corresponding\n     * value of each key is an array of elements responsible for generating the\n     * key. The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.\n     * @returns {Object} Returns the composed aggregate object.\n     * @example\n     *\n     * _.groupBy([6.1, 4.2, 6.3], Math.floor);\n     * // => { '4': [4.2], '6': [6.1, 6.3] }\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.groupBy(['one', 'two', 'three'], 'length');\n     * // => { '3': ['one', 'two'], '5': ['three'] }\n     */var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value);}else{baseAssignValue(result,key,[value]);}});/**\n     * Checks if `value` is in `collection`. If `collection` is a string, it's\n     * checked for a substring of `value`, otherwise\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * is used for equality comparisons. If `fromIndex` is negative, it's used as\n     * the offset from the end of `collection`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object|string} collection The collection to inspect.\n     * @param {*} value The value to search for.\n     * @param {number} [fromIndex=0] The index to search from.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.\n     * @returns {boolean} Returns `true` if `value` is found, else `false`.\n     * @example\n     *\n     * _.includes([1, 2, 3], 1);\n     * // => true\n     *\n     * _.includes([1, 2, 3], 1, 2);\n     * // => false\n     *\n     * _.includes({ 'a': 1, 'b': 2 }, 1);\n     * // => true\n     *\n     * _.includes('abcd', 'bc');\n     * // => true\n     */function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0);}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1;}/**\n     * Invokes the method at `path` of each element in `collection`, returning\n     * an array of the results of each invoked method. Any additional arguments\n     * are provided to each invoked method. If `path` is a function, it's invoked\n     * for, and `this` bound to, each element in `collection`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Array|Function|string} path The path of the method to invoke or\n     *  the function invoked per iteration.\n     * @param {...*} [args] The arguments to invoke each method with.\n     * @returns {Array} Returns the array of results.\n     * @example\n     *\n     * _.invokeMap([[5, 1, 7], [3, 2, 1]], 'sort');\n     * // => [[1, 5, 7], [1, 2, 3]]\n     *\n     * _.invokeMap([123, 456], String.prototype.split, '');\n     * // => [['1', '2', '3'], ['4', '5', '6']]\n     */var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=='function',result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args);});return result;});/**\n     * Creates an object composed of keys generated from the results of running\n     * each element of `collection` thru `iteratee`. The corresponding value of\n     * each key is the last element responsible for generating the key. The\n     * iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.\n     * @returns {Object} Returns the composed aggregate object.\n     * @example\n     *\n     * var array = [\n     *   { 'dir': 'left', 'code': 97 },\n     *   { 'dir': 'right', 'code': 100 }\n     * ];\n     *\n     * _.keyBy(array, function(o) {\n     *   return String.fromCharCode(o.code);\n     * });\n     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }\n     *\n     * _.keyBy(array, 'dir');\n     * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }\n     */var keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value);});/**\n     * Creates an array of values by running each element in `collection` thru\n     * `iteratee`. The iteratee is invoked with three arguments:\n     * (value, index|key, collection).\n     *\n     * Many lodash methods are guarded to work as iteratees for methods like\n     * `_.every`, `_.filter`, `_.map`, `_.mapValues`, `_.reject`, and `_.some`.\n     *\n     * The guarded methods are:\n     * `ary`, `chunk`, `curry`, `curryRight`, `drop`, `dropRight`, `every`,\n     * `fill`, `invert`, `parseInt`, `random`, `range`, `rangeRight`, `repeat`,\n     * `sampleSize`, `slice`, `some`, `sortBy`, `split`, `take`, `takeRight`,\n     * `template`, `trim`, `trimEnd`, `trimStart`, and `words`\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new mapped array.\n     * @example\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * _.map([4, 8], square);\n     * // => [16, 64]\n     *\n     * _.map({ 'a': 4, 'b': 8 }, square);\n     * // => [16, 64] (iteration order is not guaranteed)\n     *\n     * var users = [\n     *   { 'user': 'barney' },\n     *   { 'user': 'fred' }\n     * ];\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.map(users, 'user');\n     * // => ['barney', 'fred']\n     */function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3));}/**\n     * This method is like `_.sortBy` except that it allows specifying the sort\n     * orders of the iteratees to sort by. If `orders` is unspecified, all values\n     * are sorted in ascending order. Otherwise, specify an order of \"desc\" for\n     * descending or \"asc\" for ascending sort order of corresponding values.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Array[]|Function[]|Object[]|string[]} [iteratees=[_.identity]]\n     *  The iteratees to sort by.\n     * @param {string[]} [orders] The sort orders of `iteratees`.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.\n     * @returns {Array} Returns the new sorted array.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'fred',   'age': 48 },\n     *   { 'user': 'barney', 'age': 34 },\n     *   { 'user': 'fred',   'age': 40 },\n     *   { 'user': 'barney', 'age': 36 }\n     * ];\n     *\n     * // Sort by `user` in ascending order and by `age` in descending order.\n     * _.orderBy(users, ['user', 'age'], ['asc', 'desc']);\n     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]\n     */function orderBy(collection,iteratees,orders,guard){if(collection==null){return[];}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees];}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders];}return baseOrderBy(collection,iteratees,orders);}/**\n     * Creates an array of elements split into two groups, the first of which\n     * contains elements `predicate` returns truthy for, the second of which\n     * contains elements `predicate` returns falsey for. The predicate is\n     * invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the array of grouped elements.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney',  'age': 36, 'active': false },\n     *   { 'user': 'fred',    'age': 40, 'active': true },\n     *   { 'user': 'pebbles', 'age': 1,  'active': false }\n     * ];\n     *\n     * _.partition(users, function(o) { return o.active; });\n     * // => objects for [['fred'], ['barney', 'pebbles']]\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.partition(users, { 'age': 1, 'active': false });\n     * // => objects for [['pebbles'], ['barney', 'fred']]\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.partition(users, ['active', false]);\n     * // => objects for [['barney', 'pebbles'], ['fred']]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.partition(users, 'active');\n     * // => objects for [['fred'], ['barney', 'pebbles']]\n     */var partition=createAggregator(function(result,value,key){result[key?0:1].push(value);},function(){return[[],[]];});/**\n     * Reduces `collection` to a value which is the accumulated result of running\n     * each element in `collection` thru `iteratee`, where each successive\n     * invocation is supplied the return value of the previous. If `accumulator`\n     * is not given, the first element of `collection` is used as the initial\n     * value. The iteratee is invoked with four arguments:\n     * (accumulator, value, index|key, collection).\n     *\n     * Many lodash methods are guarded to work as iteratees for methods like\n     * `_.reduce`, `_.reduceRight`, and `_.transform`.\n     *\n     * The guarded methods are:\n     * `assign`, `defaults`, `defaultsDeep`, `includes`, `merge`, `orderBy`,\n     * and `sortBy`\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @param {*} [accumulator] The initial value.\n     * @returns {*} Returns the accumulated value.\n     * @see _.reduceRight\n     * @example\n     *\n     * _.reduce([1, 2], function(sum, n) {\n     *   return sum + n;\n     * }, 0);\n     * // => 3\n     *\n     * _.reduce({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {\n     *   (result[value] || (result[value] = [])).push(key);\n     *   return result;\n     * }, {});\n     * // => { '1': ['a', 'c'], '2': ['b'] } (iteration order is not guaranteed)\n     */function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach);}/**\n     * This method is like `_.reduce` except that it iterates over elements of\n     * `collection` from right to left.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @param {*} [accumulator] The initial value.\n     * @returns {*} Returns the accumulated value.\n     * @see _.reduce\n     * @example\n     *\n     * var array = [[0, 1], [2, 3], [4, 5]];\n     *\n     * _.reduceRight(array, function(flattened, other) {\n     *   return flattened.concat(other);\n     * }, []);\n     * // => [4, 5, 2, 3, 0, 1]\n     */function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight);}/**\n     * The opposite of `_.filter`; this method returns the elements of `collection`\n     * that `predicate` does **not** return truthy for.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the new filtered array.\n     * @see _.filter\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney', 'age': 36, 'active': false },\n     *   { 'user': 'fred',   'age': 40, 'active': true }\n     * ];\n     *\n     * _.reject(users, function(o) { return !o.active; });\n     * // => objects for ['fred']\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.reject(users, { 'age': 40, 'active': true });\n     * // => objects for ['barney']\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.reject(users, ['active', false]);\n     * // => objects for ['fred']\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.reject(users, 'active');\n     * // => objects for ['barney']\n     */function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)));}/**\n     * Gets a random element from `collection`.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to sample.\n     * @returns {*} Returns the random element.\n     * @example\n     *\n     * _.sample([1, 2, 3, 4]);\n     * // => 2\n     */function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection);}/**\n     * Gets `n` random elements at unique keys from `collection` up to the\n     * size of `collection`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to sample.\n     * @param {number} [n=1] The number of elements to sample.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the random elements.\n     * @example\n     *\n     * _.sampleSize([1, 2, 3], 2);\n     * // => [3, 1]\n     *\n     * _.sampleSize([1, 2, 3], 4);\n     * // => [2, 3, 1]\n     */function sampleSize(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1;}else{n=toInteger(n);}var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n);}/**\n     * Creates an array of shuffled values, using a version of the\n     * [Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher-Yates_shuffle).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to shuffle.\n     * @returns {Array} Returns the new shuffled array.\n     * @example\n     *\n     * _.shuffle([1, 2, 3, 4]);\n     * // => [4, 1, 3, 2]\n     */function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection);}/**\n     * Gets the size of `collection` by returning its length for array-like\n     * values or the number of own enumerable string keyed properties for objects.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object|string} collection The collection to inspect.\n     * @returns {number} Returns the collection size.\n     * @example\n     *\n     * _.size([1, 2, 3]);\n     * // => 3\n     *\n     * _.size({ 'a': 1, 'b': 2 });\n     * // => 2\n     *\n     * _.size('pebbles');\n     * // => 7\n     */function size(collection){if(collection==null){return 0;}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length;}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size;}return baseKeys(collection).length;}/**\n     * Checks if `predicate` returns truthy for **any** element of `collection`.\n     * Iteration is stopped once `predicate` returns truthy. The predicate is\n     * invoked with three arguments: (value, index|key, collection).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {boolean} Returns `true` if any element passes the predicate check,\n     *  else `false`.\n     * @example\n     *\n     * _.some([null, 0, 'yes', false], Boolean);\n     * // => true\n     *\n     * var users = [\n     *   { 'user': 'barney', 'active': true },\n     *   { 'user': 'fred',   'active': false }\n     * ];\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.some(users, { 'user': 'barney', 'active': false });\n     * // => false\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.some(users, ['active', false]);\n     * // => true\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.some(users, 'active');\n     * // => true\n     */function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined;}return func(collection,getIteratee(predicate,3));}/**\n     * Creates an array of elements, sorted in ascending order by the results of\n     * running each element in a collection thru each iteratee. This method\n     * performs a stable sort, that is, it preserves the original sort order of\n     * equal elements. The iteratees are invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Collection\n     * @param {Array|Object} collection The collection to iterate over.\n     * @param {...(Function|Function[])} [iteratees=[_.identity]]\n     *  The iteratees to sort by.\n     * @returns {Array} Returns the new sorted array.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'fred',   'age': 48 },\n     *   { 'user': 'barney', 'age': 36 },\n     *   { 'user': 'fred',   'age': 40 },\n     *   { 'user': 'barney', 'age': 34 }\n     * ];\n     *\n     * _.sortBy(users, [function(o) { return o.user; }]);\n     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]\n     *\n     * _.sortBy(users, ['user', 'age']);\n     * // => objects for [['barney', 34], ['barney', 36], ['fred', 40], ['fred', 48]]\n     */var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[];}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[];}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]];}return baseOrderBy(collection,baseFlatten(iteratees,1),[]);});/*------------------------------------------------------------------------*//**\n     * Gets the timestamp of the number of milliseconds that have elapsed since\n     * the Unix epoch (1 January 1970 00:00:00 UTC).\n     *\n     * @static\n     * @memberOf _\n     * @since 2.4.0\n     * @category Date\n     * @returns {number} Returns the timestamp.\n     * @example\n     *\n     * _.defer(function(stamp) {\n     *   console.log(_.now() - stamp);\n     * }, _.now());\n     * // => Logs the number of milliseconds it took for the deferred invocation.\n     */var now=ctxNow||function(){return root.Date.now();};/*------------------------------------------------------------------------*//**\n     * The opposite of `_.before`; this method creates a function that invokes\n     * `func` once it's called `n` or more times.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {number} n The number of calls before `func` is invoked.\n     * @param {Function} func The function to restrict.\n     * @returns {Function} Returns the new restricted function.\n     * @example\n     *\n     * var saves = ['profile', 'settings'];\n     *\n     * var done = _.after(saves.length, function() {\n     *   console.log('done saving!');\n     * });\n     *\n     * _.forEach(saves, function(type) {\n     *   asyncSave({ 'type': type, 'complete': done });\n     * });\n     * // => Logs 'done saving!' after the two async saves have completed.\n     */function after(n,func){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments);}};}/**\n     * Creates a function that invokes `func`, with up to `n` arguments,\n     * ignoring any additional arguments.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Function\n     * @param {Function} func The function to cap arguments for.\n     * @param {number} [n=func.length] The arity cap.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Function} Returns the new capped function.\n     * @example\n     *\n     * _.map(['6', '8', '10'], _.ary(parseInt, 1));\n     * // => [6, 8, 10]\n     */function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n);}/**\n     * Creates a function that invokes `func`, with the `this` binding and arguments\n     * of the created function, while it's called less than `n` times. Subsequent\n     * calls to the created function return the result of the last `func` invocation.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Function\n     * @param {number} n The number of calls at which `func` is no longer invoked.\n     * @param {Function} func The function to restrict.\n     * @returns {Function} Returns the new restricted function.\n     * @example\n     *\n     * jQuery(element).on('click', _.before(5, addContactToList));\n     * // => Allows adding up to 4 contacts to the list.\n     */function before(n,func){var result;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments);}if(n<=1){func=undefined;}return result;};}/**\n     * Creates a function that invokes `func` with the `this` binding of `thisArg`\n     * and `partials` prepended to the arguments it receives.\n     *\n     * The `_.bind.placeholder` value, which defaults to `_` in monolithic builds,\n     * may be used as a placeholder for partially applied arguments.\n     *\n     * **Note:** Unlike native `Function#bind`, this method doesn't set the \"length\"\n     * property of bound functions.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to bind.\n     * @param {*} thisArg The `this` binding of `func`.\n     * @param {...*} [partials] The arguments to be partially applied.\n     * @returns {Function} Returns the new bound function.\n     * @example\n     *\n     * function greet(greeting, punctuation) {\n     *   return greeting + ' ' + this.user + punctuation;\n     * }\n     *\n     * var object = { 'user': 'fred' };\n     *\n     * var bound = _.bind(greet, object, 'hi');\n     * bound('!');\n     * // => 'hi fred!'\n     *\n     * // Bound with placeholders.\n     * var bound = _.bind(greet, object, _, '!');\n     * bound('hi');\n     * // => 'hi fred!'\n     */var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG;}return createWrap(func,bitmask,thisArg,partials,holders);});/**\n     * Creates a function that invokes the method at `object[key]` with `partials`\n     * prepended to the arguments it receives.\n     *\n     * This method differs from `_.bind` by allowing bound functions to reference\n     * methods that may be redefined or don't yet exist. See\n     * [Peter Michaux's article](http://peter.michaux.ca/articles/lazy-function-definition-pattern)\n     * for more details.\n     *\n     * The `_.bindKey.placeholder` value, which defaults to `_` in monolithic\n     * builds, may be used as a placeholder for partially applied arguments.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.10.0\n     * @category Function\n     * @param {Object} object The object to invoke the method on.\n     * @param {string} key The key of the method.\n     * @param {...*} [partials] The arguments to be partially applied.\n     * @returns {Function} Returns the new bound function.\n     * @example\n     *\n     * var object = {\n     *   'user': 'fred',\n     *   'greet': function(greeting, punctuation) {\n     *     return greeting + ' ' + this.user + punctuation;\n     *   }\n     * };\n     *\n     * var bound = _.bindKey(object, 'greet', 'hi');\n     * bound('!');\n     * // => 'hi fred!'\n     *\n     * object.greet = function(greeting, punctuation) {\n     *   return greeting + 'ya ' + this.user + punctuation;\n     * };\n     *\n     * bound('!');\n     * // => 'hiya fred!'\n     *\n     * // Bound with placeholders.\n     * var bound = _.bindKey(object, 'greet', _, '!');\n     * bound('hi');\n     * // => 'hiya fred!'\n     */var bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG;}return createWrap(key,bitmask,object,partials,holders);});/**\n     * Creates a function that accepts arguments of `func` and either invokes\n     * `func` returning its result, if at least `arity` number of arguments have\n     * been provided, or returns a function that accepts the remaining `func`\n     * arguments, and so on. The arity of `func` may be specified if `func.length`\n     * is not sufficient.\n     *\n     * The `_.curry.placeholder` value, which defaults to `_` in monolithic builds,\n     * may be used as a placeholder for provided arguments.\n     *\n     * **Note:** This method doesn't set the \"length\" property of curried functions.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Function\n     * @param {Function} func The function to curry.\n     * @param {number} [arity=func.length] The arity of `func`.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Function} Returns the new curried function.\n     * @example\n     *\n     * var abc = function(a, b, c) {\n     *   return [a, b, c];\n     * };\n     *\n     * var curried = _.curry(abc);\n     *\n     * curried(1)(2)(3);\n     * // => [1, 2, 3]\n     *\n     * curried(1, 2)(3);\n     * // => [1, 2, 3]\n     *\n     * curried(1, 2, 3);\n     * // => [1, 2, 3]\n     *\n     * // Curried with placeholders.\n     * curried(1)(_, 3)(2);\n     * // => [1, 2, 3]\n     */function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result;}/**\n     * This method is like `_.curry` except that arguments are applied to `func`\n     * in the manner of `_.partialRight` instead of `_.partial`.\n     *\n     * The `_.curryRight.placeholder` value, which defaults to `_` in monolithic\n     * builds, may be used as a placeholder for provided arguments.\n     *\n     * **Note:** This method doesn't set the \"length\" property of curried functions.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Function\n     * @param {Function} func The function to curry.\n     * @param {number} [arity=func.length] The arity of `func`.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Function} Returns the new curried function.\n     * @example\n     *\n     * var abc = function(a, b, c) {\n     *   return [a, b, c];\n     * };\n     *\n     * var curried = _.curryRight(abc);\n     *\n     * curried(3)(2)(1);\n     * // => [1, 2, 3]\n     *\n     * curried(2, 3)(1);\n     * // => [1, 2, 3]\n     *\n     * curried(1, 2, 3);\n     * // => [1, 2, 3]\n     *\n     * // Curried with placeholders.\n     * curried(3)(1, _)(2);\n     * // => [1, 2, 3]\n     */function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result;}/**\n     * Creates a debounced function that delays invoking `func` until after `wait`\n     * milliseconds have elapsed since the last time the debounced function was\n     * invoked. The debounced function comes with a `cancel` method to cancel\n     * delayed `func` invocations and a `flush` method to immediately invoke them.\n     * Provide `options` to indicate whether `func` should be invoked on the\n     * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n     * with the last arguments provided to the debounced function. Subsequent\n     * calls to the debounced function return the result of the last `func`\n     * invocation.\n     *\n     * **Note:** If `leading` and `trailing` options are `true`, `func` is\n     * invoked on the trailing edge of the timeout only if the debounced function\n     * is invoked more than once during the `wait` timeout.\n     *\n     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n     * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n     *\n     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n     * for details over the differences between `_.debounce` and `_.throttle`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to debounce.\n     * @param {number} [wait=0] The number of milliseconds to delay.\n     * @param {Object} [options={}] The options object.\n     * @param {boolean} [options.leading=false]\n     *  Specify invoking on the leading edge of the timeout.\n     * @param {number} [options.maxWait]\n     *  The maximum time `func` is allowed to be delayed before it's invoked.\n     * @param {boolean} [options.trailing=true]\n     *  Specify invoking on the trailing edge of the timeout.\n     * @returns {Function} Returns the new debounced function.\n     * @example\n     *\n     * // Avoid costly calculations while the window size is in flux.\n     * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n     *\n     * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n     * jQuery(element).on('click', _.debounce(sendMail, 300, {\n     *   'leading': true,\n     *   'trailing': false\n     * }));\n     *\n     * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n     * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n     * var source = new EventSource('/stream');\n     * jQuery(source).on('message', debounced);\n     *\n     * // Cancel the trailing debounced invocation.\n     * jQuery(window).on('popstate', debounced.cancel);\n     */function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing='maxWait'in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing='trailing'in options?!!options.trailing:trailing;}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result;}function leadingEdge(time){// Reset any `maxWait` timer.\nlastInvokeTime=time;// Start the timer for the trailing edge.\ntimerId=setTimeout(timerExpired,wait);// Invoke the leading edge.\nreturn leading?invokeFunc(time):result;}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result;}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;// Either this is the first call, activity has stopped and we're at the\n// trailing edge, the system time has gone backwards and we're treating\n// it as the trailing edge, or we've hit the `maxWait` limit.\nreturn lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait;}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time);}// Restart the timer.\ntimerId=setTimeout(timerExpired,remainingWait(time));}function trailingEdge(time){timerId=undefined;// Only invoke if we have `lastArgs` which means `func` has been\n// debounced at least once.\nif(trailing&&lastArgs){return invokeFunc(time);}lastArgs=lastThis=undefined;return result;}function cancel(){if(timerId!==undefined){clearTimeout(timerId);}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined;}function flush(){return timerId===undefined?result:trailingEdge(now());}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime);}if(maxing){// Handle invocations in a tight loop.\ntimerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime);}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait);}return result;}debounced.cancel=cancel;debounced.flush=flush;return debounced;}/**\n     * Defers invoking the `func` until the current call stack has cleared. Any\n     * additional arguments are provided to `func` when it's invoked.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to defer.\n     * @param {...*} [args] The arguments to invoke `func` with.\n     * @returns {number} Returns the timer id.\n     * @example\n     *\n     * _.defer(function(text) {\n     *   console.log(text);\n     * }, 'deferred');\n     * // => Logs 'deferred' after one millisecond.\n     */var defer=baseRest(function(func,args){return baseDelay(func,1,args);});/**\n     * Invokes `func` after `wait` milliseconds. Any additional arguments are\n     * provided to `func` when it's invoked.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to delay.\n     * @param {number} wait The number of milliseconds to delay invocation.\n     * @param {...*} [args] The arguments to invoke `func` with.\n     * @returns {number} Returns the timer id.\n     * @example\n     *\n     * _.delay(function(text) {\n     *   console.log(text);\n     * }, 1000, 'later');\n     * // => Logs 'later' after one second.\n     */var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args);});/**\n     * Creates a function that invokes `func` with arguments reversed.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Function\n     * @param {Function} func The function to flip arguments for.\n     * @returns {Function} Returns the new flipped function.\n     * @example\n     *\n     * var flipped = _.flip(function() {\n     *   return _.toArray(arguments);\n     * });\n     *\n     * flipped('a', 'b', 'c', 'd');\n     * // => ['d', 'c', 'b', 'a']\n     */function flip(func){return createWrap(func,WRAP_FLIP_FLAG);}/**\n     * Creates a function that memoizes the result of `func`. If `resolver` is\n     * provided, it determines the cache key for storing the result based on the\n     * arguments provided to the memoized function. By default, the first argument\n     * provided to the memoized function is used as the map cache key. The `func`\n     * is invoked with the `this` binding of the memoized function.\n     *\n     * **Note:** The cache is exposed as the `cache` property on the memoized\n     * function. Its creation may be customized by replacing the `_.memoize.Cache`\n     * constructor with one whose instances implement the\n     * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n     * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to have its output memoized.\n     * @param {Function} [resolver] The function to resolve the cache key.\n     * @returns {Function} Returns the new memoized function.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': 2 };\n     * var other = { 'c': 3, 'd': 4 };\n     *\n     * var values = _.memoize(_.values);\n     * values(object);\n     * // => [1, 2]\n     *\n     * values(other);\n     * // => [3, 4]\n     *\n     * object.a = 2;\n     * values(object);\n     * // => [1, 2]\n     *\n     * // Modify the result cache.\n     * values.cache.set(object, ['a', 'b']);\n     * values(object);\n     * // => ['a', 'b']\n     *\n     * // Replace `_.memoize.Cache`.\n     * _.memoize.Cache = WeakMap;\n     */function memoize(func,resolver){if(typeof func!='function'||resolver!=null&&typeof resolver!='function'){throw new TypeError(FUNC_ERROR_TEXT);}var memoized=function memoized(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key);}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result;};memoized.cache=new(memoize.Cache||MapCache)();return memoized;}// Expose `MapCache`.\nmemoize.Cache=MapCache;/**\n     * Creates a function that negates the result of the predicate `func`. The\n     * `func` predicate is invoked with the `this` binding and arguments of the\n     * created function.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Function\n     * @param {Function} predicate The predicate to negate.\n     * @returns {Function} Returns the new negated function.\n     * @example\n     *\n     * function isEven(n) {\n     *   return n % 2 == 0;\n     * }\n     *\n     * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));\n     * // => [1, 3, 5]\n     */function negate(predicate){if(typeof predicate!='function'){throw new TypeError(FUNC_ERROR_TEXT);}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2]);}return!predicate.apply(this,args);};}/**\n     * Creates a function that is restricted to invoking `func` once. Repeat calls\n     * to the function return the value of the first invocation. The `func` is\n     * invoked with the `this` binding and arguments of the created function.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to restrict.\n     * @returns {Function} Returns the new restricted function.\n     * @example\n     *\n     * var initialize = _.once(createApplication);\n     * initialize();\n     * initialize();\n     * // => `createApplication` is invoked once\n     */function once(func){return before(2,func);}/**\n     * Creates a function that invokes `func` with its arguments transformed.\n     *\n     * @static\n     * @since 4.0.0\n     * @memberOf _\n     * @category Function\n     * @param {Function} func The function to wrap.\n     * @param {...(Function|Function[])} [transforms=[_.identity]]\n     *  The argument transforms.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * function doubled(n) {\n     *   return n * 2;\n     * }\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * var func = _.overArgs(function(x, y) {\n     *   return [x, y];\n     * }, [square, doubled]);\n     *\n     * func(9, 3);\n     * // => [81, 6]\n     *\n     * func(10, 5);\n     * // => [100, 10]\n     */var overArgs=castRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index]);}return apply(func,this,args);});});/**\n     * Creates a function that invokes `func` with `partials` prepended to the\n     * arguments it receives. This method is like `_.bind` except it does **not**\n     * alter the `this` binding.\n     *\n     * The `_.partial.placeholder` value, which defaults to `_` in monolithic\n     * builds, may be used as a placeholder for partially applied arguments.\n     *\n     * **Note:** This method doesn't set the \"length\" property of partially\n     * applied functions.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.2.0\n     * @category Function\n     * @param {Function} func The function to partially apply arguments to.\n     * @param {...*} [partials] The arguments to be partially applied.\n     * @returns {Function} Returns the new partially applied function.\n     * @example\n     *\n     * function greet(greeting, name) {\n     *   return greeting + ' ' + name;\n     * }\n     *\n     * var sayHelloTo = _.partial(greet, 'hello');\n     * sayHelloTo('fred');\n     * // => 'hello fred'\n     *\n     * // Partially applied with placeholders.\n     * var greetFred = _.partial(greet, _, 'fred');\n     * greetFred('hi');\n     * // => 'hi fred'\n     */var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders);});/**\n     * This method is like `_.partial` except that partially applied arguments\n     * are appended to the arguments it receives.\n     *\n     * The `_.partialRight.placeholder` value, which defaults to `_` in monolithic\n     * builds, may be used as a placeholder for partially applied arguments.\n     *\n     * **Note:** This method doesn't set the \"length\" property of partially\n     * applied functions.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.0.0\n     * @category Function\n     * @param {Function} func The function to partially apply arguments to.\n     * @param {...*} [partials] The arguments to be partially applied.\n     * @returns {Function} Returns the new partially applied function.\n     * @example\n     *\n     * function greet(greeting, name) {\n     *   return greeting + ' ' + name;\n     * }\n     *\n     * var greetFred = _.partialRight(greet, 'fred');\n     * greetFred('hi');\n     * // => 'hi fred'\n     *\n     * // Partially applied with placeholders.\n     * var sayHelloTo = _.partialRight(greet, 'hello', _);\n     * sayHelloTo('fred');\n     * // => 'hello fred'\n     */var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders);});/**\n     * Creates a function that invokes `func` with arguments arranged according\n     * to the specified `indexes` where the argument value at the first index is\n     * provided as the first argument, the argument value at the second index is\n     * provided as the second argument, and so on.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Function\n     * @param {Function} func The function to rearrange arguments for.\n     * @param {...(number|number[])} indexes The arranged argument indexes.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var rearged = _.rearg(function(a, b, c) {\n     *   return [a, b, c];\n     * }, [2, 0, 1]);\n     *\n     * rearged('b', 'c', 'a')\n     * // => ['a', 'b', 'c']\n     */var rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes);});/**\n     * Creates a function that invokes `func` with the `this` binding of the\n     * created function and arguments from `start` and beyond provided as\n     * an array.\n     *\n     * **Note:** This method is based on the\n     * [rest parameter](https://mdn.io/rest_parameters).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Function\n     * @param {Function} func The function to apply a rest parameter to.\n     * @param {number} [start=func.length-1] The start position of the rest parameter.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var say = _.rest(function(what, names) {\n     *   return what + ' ' + _.initial(names).join(', ') +\n     *     (_.size(names) > 1 ? ', & ' : '') + _.last(names);\n     * });\n     *\n     * say('hello', 'fred', 'barney', 'pebbles');\n     * // => 'hello fred, barney, & pebbles'\n     */function rest(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}start=start===undefined?start:toInteger(start);return baseRest(func,start);}/**\n     * Creates a function that invokes `func` with the `this` binding of the\n     * create function and an array of arguments much like\n     * [`Function#apply`](http://www.ecma-international.org/ecma-262/7.0/#sec-function.prototype.apply).\n     *\n     * **Note:** This method is based on the\n     * [spread operator](https://mdn.io/spread_operator).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.2.0\n     * @category Function\n     * @param {Function} func The function to spread arguments over.\n     * @param {number} [start=0] The start position of the spread.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var say = _.spread(function(who, what) {\n     *   return who + ' says ' + what;\n     * });\n     *\n     * say(['fred', 'hello']);\n     * // => 'fred says hello'\n     *\n     * var numbers = Promise.all([\n     *   Promise.resolve(40),\n     *   Promise.resolve(36)\n     * ]);\n     *\n     * numbers.then(_.spread(function(x, y) {\n     *   return x + y;\n     * }));\n     * // => a Promise of 76\n     */function spread(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}start=start==null?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array);}return apply(func,this,otherArgs);});}/**\n     * Creates a throttled function that only invokes `func` at most once per\n     * every `wait` milliseconds. The throttled function comes with a `cancel`\n     * method to cancel delayed `func` invocations and a `flush` method to\n     * immediately invoke them. Provide `options` to indicate whether `func`\n     * should be invoked on the leading and/or trailing edge of the `wait`\n     * timeout. The `func` is invoked with the last arguments provided to the\n     * throttled function. Subsequent calls to the throttled function return the\n     * result of the last `func` invocation.\n     *\n     * **Note:** If `leading` and `trailing` options are `true`, `func` is\n     * invoked on the trailing edge of the timeout only if the throttled function\n     * is invoked more than once during the `wait` timeout.\n     *\n     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n     * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n     *\n     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n     * for details over the differences between `_.throttle` and `_.debounce`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {Function} func The function to throttle.\n     * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n     * @param {Object} [options={}] The options object.\n     * @param {boolean} [options.leading=true]\n     *  Specify invoking on the leading edge of the timeout.\n     * @param {boolean} [options.trailing=true]\n     *  Specify invoking on the trailing edge of the timeout.\n     * @returns {Function} Returns the new throttled function.\n     * @example\n     *\n     * // Avoid excessively updating the position while scrolling.\n     * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n     *\n     * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n     * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n     * jQuery(element).on('click', throttled);\n     *\n     * // Cancel the trailing throttled invocation.\n     * jQuery(window).on('popstate', throttled.cancel);\n     */function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}if(isObject(options)){leading='leading'in options?!!options.leading:leading;trailing='trailing'in options?!!options.trailing:trailing;}return debounce(func,wait,{'leading':leading,'maxWait':wait,'trailing':trailing});}/**\n     * Creates a function that accepts up to one argument, ignoring any\n     * additional arguments.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Function\n     * @param {Function} func The function to cap arguments for.\n     * @returns {Function} Returns the new capped function.\n     * @example\n     *\n     * _.map(['6', '8', '10'], _.unary(parseInt));\n     * // => [6, 8, 10]\n     */function unary(func){return ary(func,1);}/**\n     * Creates a function that provides `value` to `wrapper` as its first\n     * argument. Any additional arguments provided to the function are appended\n     * to those provided to the `wrapper`. The wrapper is invoked with the `this`\n     * binding of the created function.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Function\n     * @param {*} value The value to wrap.\n     * @param {Function} [wrapper=identity] The wrapper function.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var p = _.wrap(_.escape, function(func, text) {\n     *   return '<p>' + func(text) + '</p>';\n     * });\n     *\n     * p('fred, barney, & pebbles');\n     * // => '<p>fred, barney, &amp; pebbles</p>'\n     */function wrap(value,wrapper){return partial(castFunction(wrapper),value);}/*------------------------------------------------------------------------*//**\n     * Casts `value` as an array if it's not one.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.4.0\n     * @category Lang\n     * @param {*} value The value to inspect.\n     * @returns {Array} Returns the cast array.\n     * @example\n     *\n     * _.castArray(1);\n     * // => [1]\n     *\n     * _.castArray({ 'a': 1 });\n     * // => [{ 'a': 1 }]\n     *\n     * _.castArray('abc');\n     * // => ['abc']\n     *\n     * _.castArray(null);\n     * // => [null]\n     *\n     * _.castArray(undefined);\n     * // => [undefined]\n     *\n     * _.castArray();\n     * // => []\n     *\n     * var array = [1, 2, 3];\n     * console.log(_.castArray(array) === array);\n     * // => true\n     */function castArray(){if(!arguments.length){return[];}var value=arguments[0];return isArray(value)?value:[value];}/**\n     * Creates a shallow clone of `value`.\n     *\n     * **Note:** This method is loosely based on the\n     * [structured clone algorithm](https://mdn.io/Structured_clone_algorithm)\n     * and supports cloning arrays, array buffers, booleans, date objects, maps,\n     * numbers, `Object` objects, regexes, sets, strings, symbols, and typed\n     * arrays. The own enumerable properties of `arguments` objects are cloned\n     * as plain objects. An empty object is returned for uncloneable values such\n     * as error objects, functions, DOM nodes, and WeakMaps.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to clone.\n     * @returns {*} Returns the cloned value.\n     * @see _.cloneDeep\n     * @example\n     *\n     * var objects = [{ 'a': 1 }, { 'b': 2 }];\n     *\n     * var shallow = _.clone(objects);\n     * console.log(shallow[0] === objects[0]);\n     * // => true\n     */function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG);}/**\n     * This method is like `_.clone` except that it accepts `customizer` which\n     * is invoked to produce the cloned value. If `customizer` returns `undefined`,\n     * cloning is handled by the method instead. The `customizer` is invoked with\n     * up to four arguments; (value [, index|key, object, stack]).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to clone.\n     * @param {Function} [customizer] The function to customize cloning.\n     * @returns {*} Returns the cloned value.\n     * @see _.cloneDeepWith\n     * @example\n     *\n     * function customizer(value) {\n     *   if (_.isElement(value)) {\n     *     return value.cloneNode(false);\n     *   }\n     * }\n     *\n     * var el = _.cloneWith(document.body, customizer);\n     *\n     * console.log(el === document.body);\n     * // => false\n     * console.log(el.nodeName);\n     * // => 'BODY'\n     * console.log(el.childNodes.length);\n     * // => 0\n     */function cloneWith(value,customizer){customizer=typeof customizer=='function'?customizer:undefined;return baseClone(value,CLONE_SYMBOLS_FLAG,customizer);}/**\n     * This method is like `_.clone` except that it recursively clones `value`.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.0.0\n     * @category Lang\n     * @param {*} value The value to recursively clone.\n     * @returns {*} Returns the deep cloned value.\n     * @see _.clone\n     * @example\n     *\n     * var objects = [{ 'a': 1 }, { 'b': 2 }];\n     *\n     * var deep = _.cloneDeep(objects);\n     * console.log(deep[0] === objects[0]);\n     * // => false\n     */function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG);}/**\n     * This method is like `_.cloneWith` except that it recursively clones `value`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to recursively clone.\n     * @param {Function} [customizer] The function to customize cloning.\n     * @returns {*} Returns the deep cloned value.\n     * @see _.cloneWith\n     * @example\n     *\n     * function customizer(value) {\n     *   if (_.isElement(value)) {\n     *     return value.cloneNode(true);\n     *   }\n     * }\n     *\n     * var el = _.cloneDeepWith(document.body, customizer);\n     *\n     * console.log(el === document.body);\n     * // => false\n     * console.log(el.nodeName);\n     * // => 'BODY'\n     * console.log(el.childNodes.length);\n     * // => 20\n     */function cloneDeepWith(value,customizer){customizer=typeof customizer=='function'?customizer:undefined;return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer);}/**\n     * Checks if `object` conforms to `source` by invoking the predicate\n     * properties of `source` with the corresponding property values of `object`.\n     *\n     * **Note:** This method is equivalent to `_.conforms` when `source` is\n     * partially applied.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.14.0\n     * @category Lang\n     * @param {Object} object The object to inspect.\n     * @param {Object} source The object of property predicates to conform to.\n     * @returns {boolean} Returns `true` if `object` conforms, else `false`.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': 2 };\n     *\n     * _.conformsTo(object, { 'b': function(n) { return n > 1; } });\n     * // => true\n     *\n     * _.conformsTo(object, { 'b': function(n) { return n > 2; } });\n     * // => false\n     */function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source));}/**\n     * Performs a\n     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n     * comparison between two values to determine if they are equivalent.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n     * @example\n     *\n     * var object = { 'a': 1 };\n     * var other = { 'a': 1 };\n     *\n     * _.eq(object, object);\n     * // => true\n     *\n     * _.eq(object, other);\n     * // => false\n     *\n     * _.eq('a', 'a');\n     * // => true\n     *\n     * _.eq('a', Object('a'));\n     * // => false\n     *\n     * _.eq(NaN, NaN);\n     * // => true\n     */function eq(value,other){return value===other||value!==value&&other!==other;}/**\n     * Checks if `value` is greater than `other`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.9.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is greater than `other`,\n     *  else `false`.\n     * @see _.lt\n     * @example\n     *\n     * _.gt(3, 1);\n     * // => true\n     *\n     * _.gt(3, 3);\n     * // => false\n     *\n     * _.gt(1, 3);\n     * // => false\n     */var gt=createRelationalOperation(baseGt);/**\n     * Checks if `value` is greater than or equal to `other`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.9.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is greater than or equal to\n     *  `other`, else `false`.\n     * @see _.lte\n     * @example\n     *\n     * _.gte(3, 1);\n     * // => true\n     *\n     * _.gte(3, 3);\n     * // => true\n     *\n     * _.gte(1, 3);\n     * // => false\n     */var gte=createRelationalOperation(function(value,other){return value>=other;});/**\n     * Checks if `value` is likely an `arguments` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n     *  else `false`.\n     * @example\n     *\n     * _.isArguments(function() { return arguments; }());\n     * // => true\n     *\n     * _.isArguments([1, 2, 3]);\n     * // => false\n     */var isArguments=baseIsArguments(function(){return arguments;}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');};/**\n     * Checks if `value` is classified as an `Array` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n     * @example\n     *\n     * _.isArray([1, 2, 3]);\n     * // => true\n     *\n     * _.isArray(document.body.children);\n     * // => false\n     *\n     * _.isArray('abc');\n     * // => false\n     *\n     * _.isArray(_.noop);\n     * // => false\n     */var isArray=Array.isArray;/**\n     * Checks if `value` is classified as an `ArrayBuffer` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n     * @example\n     *\n     * _.isArrayBuffer(new ArrayBuffer(2));\n     * // => true\n     *\n     * _.isArrayBuffer(new Array(2));\n     * // => false\n     */var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;/**\n     * Checks if `value` is array-like. A value is considered array-like if it's\n     * not a function and has a `value.length` that's an integer greater than or\n     * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n     * @example\n     *\n     * _.isArrayLike([1, 2, 3]);\n     * // => true\n     *\n     * _.isArrayLike(document.body.children);\n     * // => true\n     *\n     * _.isArrayLike('abc');\n     * // => true\n     *\n     * _.isArrayLike(_.noop);\n     * // => false\n     */function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value);}/**\n     * This method is like `_.isArrayLike` except that it also checks if `value`\n     * is an object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an array-like object,\n     *  else `false`.\n     * @example\n     *\n     * _.isArrayLikeObject([1, 2, 3]);\n     * // => true\n     *\n     * _.isArrayLikeObject(document.body.children);\n     * // => true\n     *\n     * _.isArrayLikeObject('abc');\n     * // => false\n     *\n     * _.isArrayLikeObject(_.noop);\n     * // => false\n     */function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value);}/**\n     * Checks if `value` is classified as a boolean primitive or object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a boolean, else `false`.\n     * @example\n     *\n     * _.isBoolean(false);\n     * // => true\n     *\n     * _.isBoolean(null);\n     * // => false\n     */function isBoolean(value){return value===true||value===false||isObjectLike(value)&&baseGetTag(value)==boolTag;}/**\n     * Checks if `value` is a buffer.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n     * @example\n     *\n     * _.isBuffer(new Buffer(2));\n     * // => true\n     *\n     * _.isBuffer(new Uint8Array(2));\n     * // => false\n     */var isBuffer=nativeIsBuffer||stubFalse;/**\n     * Checks if `value` is classified as a `Date` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.\n     * @example\n     *\n     * _.isDate(new Date);\n     * // => true\n     *\n     * _.isDate('Mon April 23 2012');\n     * // => false\n     */var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;/**\n     * Checks if `value` is likely a DOM element.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a DOM element, else `false`.\n     * @example\n     *\n     * _.isElement(document.body);\n     * // => true\n     *\n     * _.isElement('<body>');\n     * // => false\n     */function isElement(value){return isObjectLike(value)&&value.nodeType===1&&!isPlainObject(value);}/**\n     * Checks if `value` is an empty object, collection, map, or set.\n     *\n     * Objects are considered empty if they have no own enumerable string keyed\n     * properties.\n     *\n     * Array-like values such as `arguments` objects, arrays, buffers, strings, or\n     * jQuery-like collections are considered empty if they have a `length` of `0`.\n     * Similarly, maps and sets are considered empty if they have a `size` of `0`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is empty, else `false`.\n     * @example\n     *\n     * _.isEmpty(null);\n     * // => true\n     *\n     * _.isEmpty(true);\n     * // => true\n     *\n     * _.isEmpty(1);\n     * // => true\n     *\n     * _.isEmpty([1, 2, 3]);\n     * // => false\n     *\n     * _.isEmpty({ 'a': 1 });\n     * // => false\n     */function isEmpty(value){if(value==null){return true;}if(isArrayLike(value)&&(isArray(value)||typeof value=='string'||typeof value.splice=='function'||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length;}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size;}if(isPrototype(value)){return!baseKeys(value).length;}for(var key in value){if(hasOwnProperty.call(value,key)){return false;}}return true;}/**\n     * Performs a deep comparison between two values to determine if they are\n     * equivalent.\n     *\n     * **Note:** This method supports comparing arrays, array buffers, booleans,\n     * date objects, error objects, maps, numbers, `Object` objects, regexes,\n     * sets, strings, symbols, and typed arrays. `Object` objects are compared\n     * by their own, not inherited, enumerable properties. Functions and DOM\n     * nodes are compared by strict equality, i.e. `===`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n     * @example\n     *\n     * var object = { 'a': 1 };\n     * var other = { 'a': 1 };\n     *\n     * _.isEqual(object, other);\n     * // => true\n     *\n     * object === other;\n     * // => false\n     */function isEqual(value,other){return baseIsEqual(value,other);}/**\n     * This method is like `_.isEqual` except that it accepts `customizer` which\n     * is invoked to compare values. If `customizer` returns `undefined`, comparisons\n     * are handled by the method instead. The `customizer` is invoked with up to\n     * six arguments: (objValue, othValue [, index|key, object, other, stack]).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @param {Function} [customizer] The function to customize comparisons.\n     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n     * @example\n     *\n     * function isGreeting(value) {\n     *   return /^h(?:i|ello)$/.test(value);\n     * }\n     *\n     * function customizer(objValue, othValue) {\n     *   if (isGreeting(objValue) && isGreeting(othValue)) {\n     *     return true;\n     *   }\n     * }\n     *\n     * var array = ['hello', 'goodbye'];\n     * var other = ['hi', 'goodbye'];\n     *\n     * _.isEqualWith(array, other, customizer);\n     * // => true\n     */function isEqualWith(value,other,customizer){customizer=typeof customizer=='function'?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result;}/**\n     * Checks if `value` is an `Error`, `EvalError`, `RangeError`, `ReferenceError`,\n     * `SyntaxError`, `TypeError`, or `URIError` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an error object, else `false`.\n     * @example\n     *\n     * _.isError(new Error);\n     * // => true\n     *\n     * _.isError(Error);\n     * // => false\n     */function isError(value){if(!isObjectLike(value)){return false;}var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||typeof value.message=='string'&&typeof value.name=='string'&&!isPlainObject(value);}/**\n     * Checks if `value` is a finite primitive number.\n     *\n     * **Note:** This method is based on\n     * [`Number.isFinite`](https://mdn.io/Number/isFinite).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a finite number, else `false`.\n     * @example\n     *\n     * _.isFinite(3);\n     * // => true\n     *\n     * _.isFinite(Number.MIN_VALUE);\n     * // => true\n     *\n     * _.isFinite(Infinity);\n     * // => false\n     *\n     * _.isFinite('3');\n     * // => false\n     */function isFinite(value){return typeof value=='number'&&nativeIsFinite(value);}/**\n     * Checks if `value` is classified as a `Function` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n     * @example\n     *\n     * _.isFunction(_);\n     * // => true\n     *\n     * _.isFunction(/abc/);\n     * // => false\n     */function isFunction(value){if(!isObject(value)){return false;}// The use of `Object#toString` avoids issues with the `typeof` operator\n// in Safari 9 which returns 'object' for typed arrays and other constructors.\nvar tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag;}/**\n     * Checks if `value` is an integer.\n     *\n     * **Note:** This method is based on\n     * [`Number.isInteger`](https://mdn.io/Number/isInteger).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an integer, else `false`.\n     * @example\n     *\n     * _.isInteger(3);\n     * // => true\n     *\n     * _.isInteger(Number.MIN_VALUE);\n     * // => false\n     *\n     * _.isInteger(Infinity);\n     * // => false\n     *\n     * _.isInteger('3');\n     * // => false\n     */function isInteger(value){return typeof value=='number'&&value==toInteger(value);}/**\n     * Checks if `value` is a valid array-like length.\n     *\n     * **Note:** This method is loosely based on\n     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n     * @example\n     *\n     * _.isLength(3);\n     * // => true\n     *\n     * _.isLength(Number.MIN_VALUE);\n     * // => false\n     *\n     * _.isLength(Infinity);\n     * // => false\n     *\n     * _.isLength('3');\n     * // => false\n     */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}/**\n     * Checks if `value` is the\n     * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n     * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n     * @example\n     *\n     * _.isObject({});\n     * // => true\n     *\n     * _.isObject([1, 2, 3]);\n     * // => true\n     *\n     * _.isObject(_.noop);\n     * // => true\n     *\n     * _.isObject(null);\n     * // => false\n     */function isObject(value){var type=typeof value==='undefined'?'undefined':_typeof(value);return value!=null&&(type=='object'||type=='function');}/**\n     * Checks if `value` is object-like. A value is object-like if it's not `null`\n     * and has a `typeof` result of \"object\".\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n     * @example\n     *\n     * _.isObjectLike({});\n     * // => true\n     *\n     * _.isObjectLike([1, 2, 3]);\n     * // => true\n     *\n     * _.isObjectLike(_.noop);\n     * // => false\n     *\n     * _.isObjectLike(null);\n     * // => false\n     */function isObjectLike(value){return value!=null&&(typeof value==='undefined'?'undefined':_typeof(value))=='object';}/**\n     * Checks if `value` is classified as a `Map` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n     * @example\n     *\n     * _.isMap(new Map);\n     * // => true\n     *\n     * _.isMap(new WeakMap);\n     * // => false\n     */var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;/**\n     * Performs a partial deep comparison between `object` and `source` to\n     * determine if `object` contains equivalent property values.\n     *\n     * **Note:** This method is equivalent to `_.matches` when `source` is\n     * partially applied.\n     *\n     * Partial comparisons will match empty array and empty object `source`\n     * values against any array or object value, respectively. See `_.isEqual`\n     * for a list of supported value comparisons.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Lang\n     * @param {Object} object The object to inspect.\n     * @param {Object} source The object of property values to match.\n     * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': 2 };\n     *\n     * _.isMatch(object, { 'b': 2 });\n     * // => true\n     *\n     * _.isMatch(object, { 'b': 1 });\n     * // => false\n     */function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source));}/**\n     * This method is like `_.isMatch` except that it accepts `customizer` which\n     * is invoked to compare values. If `customizer` returns `undefined`, comparisons\n     * are handled by the method instead. The `customizer` is invoked with five\n     * arguments: (objValue, srcValue, index|key, object, source).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {Object} object The object to inspect.\n     * @param {Object} source The object of property values to match.\n     * @param {Function} [customizer] The function to customize comparisons.\n     * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n     * @example\n     *\n     * function isGreeting(value) {\n     *   return /^h(?:i|ello)$/.test(value);\n     * }\n     *\n     * function customizer(objValue, srcValue) {\n     *   if (isGreeting(objValue) && isGreeting(srcValue)) {\n     *     return true;\n     *   }\n     * }\n     *\n     * var object = { 'greeting': 'hello' };\n     * var source = { 'greeting': 'hi' };\n     *\n     * _.isMatchWith(object, source, customizer);\n     * // => true\n     */function isMatchWith(object,source,customizer){customizer=typeof customizer=='function'?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer);}/**\n     * Checks if `value` is `NaN`.\n     *\n     * **Note:** This method is based on\n     * [`Number.isNaN`](https://mdn.io/Number/isNaN) and is not the same as\n     * global [`isNaN`](https://mdn.io/isNaN) which returns `true` for\n     * `undefined` and other non-number values.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n     * @example\n     *\n     * _.isNaN(NaN);\n     * // => true\n     *\n     * _.isNaN(new Number(NaN));\n     * // => true\n     *\n     * isNaN(undefined);\n     * // => true\n     *\n     * _.isNaN(undefined);\n     * // => false\n     */function isNaN(value){// An `NaN` primitive is the only value that is not equal to itself.\n// Perform the `toStringTag` check first to avoid errors with some\n// ActiveX objects in IE.\nreturn isNumber(value)&&value!=+value;}/**\n     * Checks if `value` is a pristine native function.\n     *\n     * **Note:** This method can't reliably detect native functions in the presence\n     * of the core-js package because core-js circumvents this kind of detection.\n     * Despite multiple requests, the core-js maintainer has made it clear: any\n     * attempt to fix the detection will be obstructed. As a result, we're left\n     * with little choice but to throw an error. Unfortunately, this also affects\n     * packages, like [babel-polyfill](https://www.npmjs.com/package/babel-polyfill),\n     * which rely on core-js.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a native function,\n     *  else `false`.\n     * @example\n     *\n     * _.isNative(Array.prototype.push);\n     * // => true\n     *\n     * _.isNative(_);\n     * // => false\n     */function isNative(value){if(isMaskable(value)){throw new Error(CORE_ERROR_TEXT);}return baseIsNative(value);}/**\n     * Checks if `value` is `null`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is `null`, else `false`.\n     * @example\n     *\n     * _.isNull(null);\n     * // => true\n     *\n     * _.isNull(void 0);\n     * // => false\n     */function isNull(value){return value===null;}/**\n     * Checks if `value` is `null` or `undefined`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is nullish, else `false`.\n     * @example\n     *\n     * _.isNil(null);\n     * // => true\n     *\n     * _.isNil(void 0);\n     * // => true\n     *\n     * _.isNil(NaN);\n     * // => false\n     */function isNil(value){return value==null;}/**\n     * Checks if `value` is classified as a `Number` primitive or object.\n     *\n     * **Note:** To exclude `Infinity`, `-Infinity`, and `NaN`, which are\n     * classified as numbers, use the `_.isFinite` method.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a number, else `false`.\n     * @example\n     *\n     * _.isNumber(3);\n     * // => true\n     *\n     * _.isNumber(Number.MIN_VALUE);\n     * // => true\n     *\n     * _.isNumber(Infinity);\n     * // => true\n     *\n     * _.isNumber('3');\n     * // => false\n     */function isNumber(value){return typeof value=='number'||isObjectLike(value)&&baseGetTag(value)==numberTag;}/**\n     * Checks if `value` is a plain object, that is, an object created by the\n     * `Object` constructor or one with a `[[Prototype]]` of `null`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.8.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     * }\n     *\n     * _.isPlainObject(new Foo);\n     * // => false\n     *\n     * _.isPlainObject([1, 2, 3]);\n     * // => false\n     *\n     * _.isPlainObject({ 'x': 0, 'y': 0 });\n     * // => true\n     *\n     * _.isPlainObject(Object.create(null));\n     * // => true\n     */function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false;}var proto=getPrototype(value);if(proto===null){return true;}var Ctor=hasOwnProperty.call(proto,'constructor')&&proto.constructor;return typeof Ctor=='function'&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString;}/**\n     * Checks if `value` is classified as a `RegExp` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.1.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.\n     * @example\n     *\n     * _.isRegExp(/abc/);\n     * // => true\n     *\n     * _.isRegExp('/abc/');\n     * // => false\n     */var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;/**\n     * Checks if `value` is a safe integer. An integer is safe if it's an IEEE-754\n     * double precision number which isn't the result of a rounded unsafe integer.\n     *\n     * **Note:** This method is based on\n     * [`Number.isSafeInteger`](https://mdn.io/Number/isSafeInteger).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a safe integer, else `false`.\n     * @example\n     *\n     * _.isSafeInteger(3);\n     * // => true\n     *\n     * _.isSafeInteger(Number.MIN_VALUE);\n     * // => false\n     *\n     * _.isSafeInteger(Infinity);\n     * // => false\n     *\n     * _.isSafeInteger('3');\n     * // => false\n     */function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER;}/**\n     * Checks if `value` is classified as a `Set` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n     * @example\n     *\n     * _.isSet(new Set);\n     * // => true\n     *\n     * _.isSet(new WeakSet);\n     * // => false\n     */var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;/**\n     * Checks if `value` is classified as a `String` primitive or object.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a string, else `false`.\n     * @example\n     *\n     * _.isString('abc');\n     * // => true\n     *\n     * _.isString(1);\n     * // => false\n     */function isString(value){return typeof value=='string'||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag;}/**\n     * Checks if `value` is classified as a `Symbol` primitive or object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n     * @example\n     *\n     * _.isSymbol(Symbol.iterator);\n     * // => true\n     *\n     * _.isSymbol('abc');\n     * // => false\n     */function isSymbol(value){return(typeof value==='undefined'?'undefined':_typeof(value))=='symbol'||isObjectLike(value)&&baseGetTag(value)==symbolTag;}/**\n     * Checks if `value` is classified as a typed array.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n     * @example\n     *\n     * _.isTypedArray(new Uint8Array);\n     * // => true\n     *\n     * _.isTypedArray([]);\n     * // => false\n     */var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;/**\n     * Checks if `value` is `undefined`.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.\n     * @example\n     *\n     * _.isUndefined(void 0);\n     * // => true\n     *\n     * _.isUndefined(null);\n     * // => false\n     */function isUndefined(value){return value===undefined;}/**\n     * Checks if `value` is classified as a `WeakMap` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a weak map, else `false`.\n     * @example\n     *\n     * _.isWeakMap(new WeakMap);\n     * // => true\n     *\n     * _.isWeakMap(new Map);\n     * // => false\n     */function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag;}/**\n     * Checks if `value` is classified as a `WeakSet` object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.3.0\n     * @category Lang\n     * @param {*} value The value to check.\n     * @returns {boolean} Returns `true` if `value` is a weak set, else `false`.\n     * @example\n     *\n     * _.isWeakSet(new WeakSet);\n     * // => true\n     *\n     * _.isWeakSet(new Set);\n     * // => false\n     */function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag;}/**\n     * Checks if `value` is less than `other`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.9.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is less than `other`,\n     *  else `false`.\n     * @see _.gt\n     * @example\n     *\n     * _.lt(1, 3);\n     * // => true\n     *\n     * _.lt(3, 3);\n     * // => false\n     *\n     * _.lt(3, 1);\n     * // => false\n     */var lt=createRelationalOperation(baseLt);/**\n     * Checks if `value` is less than or equal to `other`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.9.0\n     * @category Lang\n     * @param {*} value The value to compare.\n     * @param {*} other The other value to compare.\n     * @returns {boolean} Returns `true` if `value` is less than or equal to\n     *  `other`, else `false`.\n     * @see _.gte\n     * @example\n     *\n     * _.lte(1, 3);\n     * // => true\n     *\n     * _.lte(3, 3);\n     * // => true\n     *\n     * _.lte(3, 1);\n     * // => false\n     */var lte=createRelationalOperation(function(value,other){return value<=other;});/**\n     * Converts `value` to an array.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {Array} Returns the converted array.\n     * @example\n     *\n     * _.toArray({ 'a': 1, 'b': 2 });\n     * // => [1, 2]\n     *\n     * _.toArray('abc');\n     * // => ['a', 'b', 'c']\n     *\n     * _.toArray(1);\n     * // => []\n     *\n     * _.toArray(null);\n     * // => []\n     */function toArray(value){if(!value){return[];}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value);}if(symIterator&&value[symIterator]){return iteratorToArray(value[symIterator]());}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value);}/**\n     * Converts `value` to a finite number.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.12.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {number} Returns the converted number.\n     * @example\n     *\n     * _.toFinite(3.2);\n     * // => 3.2\n     *\n     * _.toFinite(Number.MIN_VALUE);\n     * // => 5e-324\n     *\n     * _.toFinite(Infinity);\n     * // => 1.7976931348623157e+308\n     *\n     * _.toFinite('3.2');\n     * // => 3.2\n     */function toFinite(value){if(!value){return value===0?value:0;}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER;}return value===value?value:0;}/**\n     * Converts `value` to an integer.\n     *\n     * **Note:** This method is loosely based on\n     * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {number} Returns the converted integer.\n     * @example\n     *\n     * _.toInteger(3.2);\n     * // => 3\n     *\n     * _.toInteger(Number.MIN_VALUE);\n     * // => 0\n     *\n     * _.toInteger(Infinity);\n     * // => 1.7976931348623157e+308\n     *\n     * _.toInteger('3.2');\n     * // => 3\n     */function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0;}/**\n     * Converts `value` to an integer suitable for use as the length of an\n     * array-like object.\n     *\n     * **Note:** This method is based on\n     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {number} Returns the converted integer.\n     * @example\n     *\n     * _.toLength(3.2);\n     * // => 3\n     *\n     * _.toLength(Number.MIN_VALUE);\n     * // => 0\n     *\n     * _.toLength(Infinity);\n     * // => 4294967295\n     *\n     * _.toLength('3.2');\n     * // => 3\n     */function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0;}/**\n     * Converts `value` to a number.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to process.\n     * @returns {number} Returns the number.\n     * @example\n     *\n     * _.toNumber(3.2);\n     * // => 3.2\n     *\n     * _.toNumber(Number.MIN_VALUE);\n     * // => 5e-324\n     *\n     * _.toNumber(Infinity);\n     * // => Infinity\n     *\n     * _.toNumber('3.2');\n     * // => 3.2\n     */function toNumber(value){if(typeof value=='number'){return value;}if(isSymbol(value)){return NAN;}if(isObject(value)){var other=typeof value.valueOf=='function'?value.valueOf():value;value=isObject(other)?other+'':other;}if(typeof value!='string'){return value===0?value:+value;}value=value.replace(reTrim,'');var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value;}/**\n     * Converts `value` to a plain object flattening inherited enumerable string\n     * keyed properties of `value` to own properties of the plain object.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {Object} Returns the converted plain object.\n     * @example\n     *\n     * function Foo() {\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.assign({ 'a': 1 }, new Foo);\n     * // => { 'a': 1, 'b': 2 }\n     *\n     * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));\n     * // => { 'a': 1, 'b': 2, 'c': 3 }\n     */function toPlainObject(value){return copyObject(value,keysIn(value));}/**\n     * Converts `value` to a safe integer. A safe integer can be compared and\n     * represented correctly.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {number} Returns the converted integer.\n     * @example\n     *\n     * _.toSafeInteger(3.2);\n     * // => 3\n     *\n     * _.toSafeInteger(Number.MIN_VALUE);\n     * // => 0\n     *\n     * _.toSafeInteger(Infinity);\n     * // => 9007199254740991\n     *\n     * _.toSafeInteger('3.2');\n     * // => 3\n     */function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):value===0?value:0;}/**\n     * Converts `value` to a string. An empty string is returned for `null`\n     * and `undefined` values. The sign of `-0` is preserved.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Lang\n     * @param {*} value The value to convert.\n     * @returns {string} Returns the converted string.\n     * @example\n     *\n     * _.toString(null);\n     * // => ''\n     *\n     * _.toString(-0);\n     * // => '-0'\n     *\n     * _.toString([1, 2, 3]);\n     * // => '1,2,3'\n     */function toString(value){return value==null?'':baseToString(value);}/*------------------------------------------------------------------------*//**\n     * Assigns own enumerable string keyed properties of source objects to the\n     * destination object. Source objects are applied from left to right.\n     * Subsequent sources overwrite property assignments of previous sources.\n     *\n     * **Note:** This method mutates `object` and is loosely based on\n     * [`Object.assign`](https://mdn.io/Object/assign).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.10.0\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} [sources] The source objects.\n     * @returns {Object} Returns `object`.\n     * @see _.assignIn\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     * }\n     *\n     * function Bar() {\n     *   this.c = 3;\n     * }\n     *\n     * Foo.prototype.b = 2;\n     * Bar.prototype.d = 4;\n     *\n     * _.assign({ 'a': 0 }, new Foo, new Bar);\n     * // => { 'a': 1, 'c': 3 }\n     */var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return;}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key]);}}});/**\n     * This method is like `_.assign` except that it iterates over own and\n     * inherited source properties.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @alias extend\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} [sources] The source objects.\n     * @returns {Object} Returns `object`.\n     * @see _.assign\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     * }\n     *\n     * function Bar() {\n     *   this.c = 3;\n     * }\n     *\n     * Foo.prototype.b = 2;\n     * Bar.prototype.d = 4;\n     *\n     * _.assignIn({ 'a': 0 }, new Foo, new Bar);\n     * // => { 'a': 1, 'b': 2, 'c': 3, 'd': 4 }\n     */var assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object);});/**\n     * This method is like `_.assignIn` except that it accepts `customizer`\n     * which is invoked to produce the assigned values. If `customizer` returns\n     * `undefined`, assignment is handled by the method instead. The `customizer`\n     * is invoked with five arguments: (objValue, srcValue, key, object, source).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @alias extendWith\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} sources The source objects.\n     * @param {Function} [customizer] The function to customize assigned values.\n     * @returns {Object} Returns `object`.\n     * @see _.assignWith\n     * @example\n     *\n     * function customizer(objValue, srcValue) {\n     *   return _.isUndefined(objValue) ? srcValue : objValue;\n     * }\n     *\n     * var defaults = _.partialRight(_.assignInWith, customizer);\n     *\n     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });\n     * // => { 'a': 1, 'b': 2 }\n     */var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer);});/**\n     * This method is like `_.assign` except that it accepts `customizer`\n     * which is invoked to produce the assigned values. If `customizer` returns\n     * `undefined`, assignment is handled by the method instead. The `customizer`\n     * is invoked with five arguments: (objValue, srcValue, key, object, source).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} sources The source objects.\n     * @param {Function} [customizer] The function to customize assigned values.\n     * @returns {Object} Returns `object`.\n     * @see _.assignInWith\n     * @example\n     *\n     * function customizer(objValue, srcValue) {\n     *   return _.isUndefined(objValue) ? srcValue : objValue;\n     * }\n     *\n     * var defaults = _.partialRight(_.assignWith, customizer);\n     *\n     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });\n     * // => { 'a': 1, 'b': 2 }\n     */var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer);});/**\n     * Creates an array of values corresponding to `paths` of `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.0.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {...(string|string[])} [paths] The property paths to pick.\n     * @returns {Array} Returns the picked values.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };\n     *\n     * _.at(object, ['a[0].b.c', 'a[1]']);\n     * // => [3, 4]\n     */var at=flatRest(baseAt);/**\n     * Creates an object that inherits from the `prototype` object. If a\n     * `properties` object is given, its own enumerable string keyed properties\n     * are assigned to the created object.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.3.0\n     * @category Object\n     * @param {Object} prototype The object to inherit from.\n     * @param {Object} [properties] The properties to assign to the object.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * function Shape() {\n     *   this.x = 0;\n     *   this.y = 0;\n     * }\n     *\n     * function Circle() {\n     *   Shape.call(this);\n     * }\n     *\n     * Circle.prototype = _.create(Shape.prototype, {\n     *   'constructor': Circle\n     * });\n     *\n     * var circle = new Circle;\n     * circle instanceof Circle;\n     * // => true\n     *\n     * circle instanceof Shape;\n     * // => true\n     */function create(prototype,properties){var result=baseCreate(prototype);return properties==null?result:baseAssign(result,properties);}/**\n     * Assigns own and inherited enumerable string keyed properties of source\n     * objects to the destination object for all destination properties that\n     * resolve to `undefined`. Source objects are applied from left to right.\n     * Once a property is set, additional values of the same property are ignored.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} [sources] The source objects.\n     * @returns {Object} Returns `object`.\n     * @see _.defaultsDeep\n     * @example\n     *\n     * _.defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });\n     * // => { 'a': 1, 'b': 2 }\n     */var defaults=baseRest(function(args){args.push(undefined,customDefaultsAssignIn);return apply(assignInWith,undefined,args);});/**\n     * This method is like `_.defaults` except that it recursively assigns\n     * default properties.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.10.0\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} [sources] The source objects.\n     * @returns {Object} Returns `object`.\n     * @see _.defaults\n     * @example\n     *\n     * _.defaultsDeep({ 'a': { 'b': 2 } }, { 'a': { 'b': 1, 'c': 3 } });\n     * // => { 'a': { 'b': 2, 'c': 3 } }\n     */var defaultsDeep=baseRest(function(args){args.push(undefined,customDefaultsMerge);return apply(mergeWith,undefined,args);});/**\n     * This method is like `_.find` except that it returns the key of the first\n     * element `predicate` returns truthy for instead of the element itself.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.1.0\n     * @category Object\n     * @param {Object} object The object to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {string|undefined} Returns the key of the matched element,\n     *  else `undefined`.\n     * @example\n     *\n     * var users = {\n     *   'barney':  { 'age': 36, 'active': true },\n     *   'fred':    { 'age': 40, 'active': false },\n     *   'pebbles': { 'age': 1,  'active': true }\n     * };\n     *\n     * _.findKey(users, function(o) { return o.age < 40; });\n     * // => 'barney' (iteration order is not guaranteed)\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.findKey(users, { 'age': 1, 'active': true });\n     * // => 'pebbles'\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.findKey(users, ['active', false]);\n     * // => 'fred'\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.findKey(users, 'active');\n     * // => 'barney'\n     */function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn);}/**\n     * This method is like `_.findKey` except that it iterates over elements of\n     * a collection in the opposite order.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Object\n     * @param {Object} object The object to inspect.\n     * @param {Function} [predicate=_.identity] The function invoked per iteration.\n     * @returns {string|undefined} Returns the key of the matched element,\n     *  else `undefined`.\n     * @example\n     *\n     * var users = {\n     *   'barney':  { 'age': 36, 'active': true },\n     *   'fred':    { 'age': 40, 'active': false },\n     *   'pebbles': { 'age': 1,  'active': true }\n     * };\n     *\n     * _.findLastKey(users, function(o) { return o.age < 40; });\n     * // => returns 'pebbles' assuming `_.findKey` returns 'barney'\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.findLastKey(users, { 'age': 36, 'active': true });\n     * // => 'barney'\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.findLastKey(users, ['active', false]);\n     * // => 'fred'\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.findLastKey(users, 'active');\n     * // => 'pebbles'\n     */function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight);}/**\n     * Iterates over own and inherited enumerable string keyed properties of an\n     * object and invokes `iteratee` for each property. The iteratee is invoked\n     * with three arguments: (value, key, object). Iteratee functions may exit\n     * iteration early by explicitly returning `false`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.3.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     * @see _.forInRight\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.forIn(new Foo, function(value, key) {\n     *   console.log(key);\n     * });\n     * // => Logs 'a', 'b', then 'c' (iteration order is not guaranteed).\n     */function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn);}/**\n     * This method is like `_.forIn` except that it iterates over properties of\n     * `object` in the opposite order.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     * @see _.forIn\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.forInRight(new Foo, function(value, key) {\n     *   console.log(key);\n     * });\n     * // => Logs 'c', 'b', then 'a' assuming `_.forIn` logs 'a', 'b', then 'c'.\n     */function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn);}/**\n     * Iterates over own enumerable string keyed properties of an object and\n     * invokes `iteratee` for each property. The iteratee is invoked with three\n     * arguments: (value, key, object). Iteratee functions may exit iteration\n     * early by explicitly returning `false`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.3.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     * @see _.forOwnRight\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.forOwn(new Foo, function(value, key) {\n     *   console.log(key);\n     * });\n     * // => Logs 'a' then 'b' (iteration order is not guaranteed).\n     */function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3));}/**\n     * This method is like `_.forOwn` except that it iterates over properties of\n     * `object` in the opposite order.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.0.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns `object`.\n     * @see _.forOwn\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.forOwnRight(new Foo, function(value, key) {\n     *   console.log(key);\n     * });\n     * // => Logs 'b' then 'a' assuming `_.forOwn` logs 'a' then 'b'.\n     */function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3));}/**\n     * Creates an array of function property names from own enumerable properties\n     * of `object`.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The object to inspect.\n     * @returns {Array} Returns the function names.\n     * @see _.functionsIn\n     * @example\n     *\n     * function Foo() {\n     *   this.a = _.constant('a');\n     *   this.b = _.constant('b');\n     * }\n     *\n     * Foo.prototype.c = _.constant('c');\n     *\n     * _.functions(new Foo);\n     * // => ['a', 'b']\n     */function functions(object){return object==null?[]:baseFunctions(object,keys(object));}/**\n     * Creates an array of function property names from own and inherited\n     * enumerable properties of `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The object to inspect.\n     * @returns {Array} Returns the function names.\n     * @see _.functions\n     * @example\n     *\n     * function Foo() {\n     *   this.a = _.constant('a');\n     *   this.b = _.constant('b');\n     * }\n     *\n     * Foo.prototype.c = _.constant('c');\n     *\n     * _.functionsIn(new Foo);\n     * // => ['a', 'b', 'c']\n     */function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object));}/**\n     * Gets the value at `path` of `object`. If the resolved value is\n     * `undefined`, the `defaultValue` is returned in its place.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.7.0\n     * @category Object\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path of the property to get.\n     * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n     * @returns {*} Returns the resolved value.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n     *\n     * _.get(object, 'a[0].b.c');\n     * // => 3\n     *\n     * _.get(object, ['a', '0', 'b', 'c']);\n     * // => 3\n     *\n     * _.get(object, 'a.b.c', 'default');\n     * // => 'default'\n     */function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result;}/**\n     * Checks if `path` is a direct property of `object`.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path to check.\n     * @returns {boolean} Returns `true` if `path` exists, else `false`.\n     * @example\n     *\n     * var object = { 'a': { 'b': 2 } };\n     * var other = _.create({ 'a': _.create({ 'b': 2 }) });\n     *\n     * _.has(object, 'a');\n     * // => true\n     *\n     * _.has(object, 'a.b');\n     * // => true\n     *\n     * _.has(object, ['a', 'b']);\n     * // => true\n     *\n     * _.has(other, 'a');\n     * // => false\n     */function has(object,path){return object!=null&&hasPath(object,path,baseHas);}/**\n     * Checks if `path` is a direct or inherited property of `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path to check.\n     * @returns {boolean} Returns `true` if `path` exists, else `false`.\n     * @example\n     *\n     * var object = _.create({ 'a': _.create({ 'b': 2 }) });\n     *\n     * _.hasIn(object, 'a');\n     * // => true\n     *\n     * _.hasIn(object, 'a.b');\n     * // => true\n     *\n     * _.hasIn(object, ['a', 'b']);\n     * // => true\n     *\n     * _.hasIn(object, 'b');\n     * // => false\n     */function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn);}/**\n     * Creates an object composed of the inverted keys and values of `object`.\n     * If `object` contains duplicate values, subsequent values overwrite\n     * property assignments of previous values.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.7.0\n     * @category Object\n     * @param {Object} object The object to invert.\n     * @returns {Object} Returns the new inverted object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': 2, 'c': 1 };\n     *\n     * _.invert(object);\n     * // => { '1': 'c', '2': 'b' }\n     */var invert=createInverter(function(result,value,key){result[value]=key;},constant(identity));/**\n     * This method is like `_.invert` except that the inverted object is generated\n     * from the results of running each element of `object` thru `iteratee`. The\n     * corresponding inverted value of each inverted key is an array of keys\n     * responsible for generating the inverted value. The iteratee is invoked\n     * with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.1.0\n     * @category Object\n     * @param {Object} object The object to invert.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {Object} Returns the new inverted object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': 2, 'c': 1 };\n     *\n     * _.invertBy(object);\n     * // => { '1': ['a', 'c'], '2': ['b'] }\n     *\n     * _.invertBy(object, function(value) {\n     *   return 'group' + value;\n     * });\n     * // => { 'group1': ['a', 'c'], 'group2': ['b'] }\n     */var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key);}else{result[value]=[key];}},getIteratee);/**\n     * Invokes the method at `path` of `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path of the method to invoke.\n     * @param {...*} [args] The arguments to invoke the method with.\n     * @returns {*} Returns the result of the invoked method.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': [1, 2, 3, 4] } }] };\n     *\n     * _.invoke(object, 'a[0].b.c.slice', 1, 3);\n     * // => [2, 3]\n     */var invoke=baseRest(baseInvoke);/**\n     * Creates an array of the own enumerable property names of `object`.\n     *\n     * **Note:** Non-object values are coerced to objects. See the\n     * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n     * for more details.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.keys(new Foo);\n     * // => ['a', 'b'] (iteration order is not guaranteed)\n     *\n     * _.keys('hi');\n     * // => ['0', '1']\n     */function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object);}/**\n     * Creates an array of the own and inherited enumerable property names of `object`.\n     *\n     * **Note:** Non-object values are coerced to objects.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property names.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.keysIn(new Foo);\n     * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n     */function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object);}/**\n     * The opposite of `_.mapValues`; this method creates an object with the\n     * same values as `object` and keys generated by running each own enumerable\n     * string keyed property of `object` thru `iteratee`. The iteratee is invoked\n     * with three arguments: (value, key, object).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.8.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns the new mapped object.\n     * @see _.mapValues\n     * @example\n     *\n     * _.mapKeys({ 'a': 1, 'b': 2 }, function(value, key) {\n     *   return key + value;\n     * });\n     * // => { 'a1': 1, 'b2': 2 }\n     */function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value);});return result;}/**\n     * Creates an object with the same keys as `object` and values generated\n     * by running each own enumerable string keyed property of `object` thru\n     * `iteratee`. The iteratee is invoked with three arguments:\n     * (value, key, object).\n     *\n     * @static\n     * @memberOf _\n     * @since 2.4.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Object} Returns the new mapped object.\n     * @see _.mapKeys\n     * @example\n     *\n     * var users = {\n     *   'fred':    { 'user': 'fred',    'age': 40 },\n     *   'pebbles': { 'user': 'pebbles', 'age': 1 }\n     * };\n     *\n     * _.mapValues(users, function(o) { return o.age; });\n     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.mapValues(users, 'age');\n     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n     */function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object));});return result;}/**\n     * This method is like `_.assign` except that it recursively merges own and\n     * inherited enumerable string keyed properties of source objects into the\n     * destination object. Source properties that resolve to `undefined` are\n     * skipped if a destination value exists. Array and plain object properties\n     * are merged recursively. Other objects and value types are overridden by\n     * assignment. Source objects are applied from left to right. Subsequent\n     * sources overwrite property assignments of previous sources.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.5.0\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} [sources] The source objects.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var object = {\n     *   'a': [{ 'b': 2 }, { 'd': 4 }]\n     * };\n     *\n     * var other = {\n     *   'a': [{ 'c': 3 }, { 'e': 5 }]\n     * };\n     *\n     * _.merge(object, other);\n     * // => { 'a': [{ 'b': 2, 'c': 3 }, { 'd': 4, 'e': 5 }] }\n     */var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex);});/**\n     * This method is like `_.merge` except that it accepts `customizer` which\n     * is invoked to produce the merged values of the destination and source\n     * properties. If `customizer` returns `undefined`, merging is handled by the\n     * method instead. The `customizer` is invoked with six arguments:\n     * (objValue, srcValue, key, object, source, stack).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The destination object.\n     * @param {...Object} sources The source objects.\n     * @param {Function} customizer The function to customize assigned values.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * function customizer(objValue, srcValue) {\n     *   if (_.isArray(objValue)) {\n     *     return objValue.concat(srcValue);\n     *   }\n     * }\n     *\n     * var object = { 'a': [1], 'b': [2] };\n     * var other = { 'a': [3], 'b': [4] };\n     *\n     * _.mergeWith(object, other, customizer);\n     * // => { 'a': [1, 3], 'b': [2, 4] }\n     */var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer);});/**\n     * The opposite of `_.pick`; this method creates an object composed of the\n     * own and inherited enumerable property paths of `object` that are not omitted.\n     *\n     * **Note:** This method is considerably slower than `_.pick`.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The source object.\n     * @param {...(string|string[])} [paths] The property paths to omit.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': '2', 'c': 3 };\n     *\n     * _.omit(object, ['a', 'c']);\n     * // => { 'b': '2' }\n     */var omit=flatRest(function(object,paths){var result={};if(object==null){return result;}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path;});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone);}var length=paths.length;while(length--){baseUnset(result,paths[length]);}return result;});/**\n     * The opposite of `_.pickBy`; this method creates an object composed of\n     * the own and inherited enumerable string keyed properties of `object` that\n     * `predicate` doesn't return truthy for. The predicate is invoked with two\n     * arguments: (value, key).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The source object.\n     * @param {Function} [predicate=_.identity] The function invoked per property.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': '2', 'c': 3 };\n     *\n     * _.omitBy(object, _.isNumber);\n     * // => { 'b': '2' }\n     */function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)));}/**\n     * Creates an object composed of the picked `object` properties.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The source object.\n     * @param {...(string|string[])} [paths] The property paths to pick.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': '2', 'c': 3 };\n     *\n     * _.pick(object, ['a', 'c']);\n     * // => { 'a': 1, 'c': 3 }\n     */var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths);});/**\n     * Creates an object composed of the `object` properties `predicate` returns\n     * truthy for. The predicate is invoked with two arguments: (value, key).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The source object.\n     * @param {Function} [predicate=_.identity] The function invoked per property.\n     * @returns {Object} Returns the new object.\n     * @example\n     *\n     * var object = { 'a': 1, 'b': '2', 'c': 3 };\n     *\n     * _.pickBy(object, _.isNumber);\n     * // => { 'a': 1, 'c': 3 }\n     */function pickBy(object,predicate){if(object==null){return{};}var props=arrayMap(getAllKeysIn(object),function(prop){return[prop];});predicate=getIteratee(predicate);return basePickBy(object,props,function(value,path){return predicate(value,path[0]);});}/**\n     * This method is like `_.get` except that if the resolved value is a\n     * function it's invoked with the `this` binding of its parent object and\n     * its result is returned.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The object to query.\n     * @param {Array|string} path The path of the property to resolve.\n     * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n     * @returns {*} Returns the resolved value.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c1': 3, 'c2': _.constant(4) } }] };\n     *\n     * _.result(object, 'a[0].b.c1');\n     * // => 3\n     *\n     * _.result(object, 'a[0].b.c2');\n     * // => 4\n     *\n     * _.result(object, 'a[0].b.c3', 'default');\n     * // => 'default'\n     *\n     * _.result(object, 'a[0].b.c3', _.constant('default'));\n     * // => 'default'\n     */function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;// Ensure the loop is entered when path is empty.\nif(!length){length=1;object=undefined;}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue;}object=isFunction(value)?value.call(object):value;}return object;}/**\n     * Sets the value at `path` of `object`. If a portion of `path` doesn't exist,\n     * it's created. Arrays are created for missing index properties while objects\n     * are created for all other missing properties. Use `_.setWith` to customize\n     * `path` creation.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.7.0\n     * @category Object\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to set.\n     * @param {*} value The value to set.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n     *\n     * _.set(object, 'a[0].b.c', 4);\n     * console.log(object.a[0].b.c);\n     * // => 4\n     *\n     * _.set(object, ['x', '0', 'y', 'z'], 5);\n     * console.log(object.x[0].y.z);\n     * // => 5\n     */function set(object,path,value){return object==null?object:baseSet(object,path,value);}/**\n     * This method is like `_.set` except that it accepts `customizer` which is\n     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`\n     * path creation is handled by the method instead. The `customizer` is invoked\n     * with three arguments: (nsValue, key, nsObject).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to set.\n     * @param {*} value The value to set.\n     * @param {Function} [customizer] The function to customize assigned values.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var object = {};\n     *\n     * _.setWith(object, '[0][1]', 'a', Object);\n     * // => { '0': { '1': 'a' } }\n     */function setWith(object,path,value,customizer){customizer=typeof customizer=='function'?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer);}/**\n     * Creates an array of own enumerable string keyed-value pairs for `object`\n     * which can be consumed by `_.fromPairs`. If `object` is a map or set, its\n     * entries are returned.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @alias entries\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the key-value pairs.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.toPairs(new Foo);\n     * // => [['a', 1], ['b', 2]] (iteration order is not guaranteed)\n     */var toPairs=createToPairs(keys);/**\n     * Creates an array of own and inherited enumerable string keyed-value pairs\n     * for `object` which can be consumed by `_.fromPairs`. If `object` is a map\n     * or set, its entries are returned.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @alias entriesIn\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the key-value pairs.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.toPairsIn(new Foo);\n     * // => [['a', 1], ['b', 2], ['c', 3]] (iteration order is not guaranteed)\n     */var toPairsIn=createToPairs(keysIn);/**\n     * An alternative to `_.reduce`; this method transforms `object` to a new\n     * `accumulator` object which is the result of running each of its own\n     * enumerable string keyed properties thru `iteratee`, with each invocation\n     * potentially mutating the `accumulator` object. If `accumulator` is not\n     * provided, a new object with the same `[[Prototype]]` will be used. The\n     * iteratee is invoked with four arguments: (accumulator, value, key, object).\n     * Iteratee functions may exit iteration early by explicitly returning `false`.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.3.0\n     * @category Object\n     * @param {Object} object The object to iterate over.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @param {*} [accumulator] The custom accumulator value.\n     * @returns {*} Returns the accumulated value.\n     * @example\n     *\n     * _.transform([2, 3, 4], function(result, n) {\n     *   result.push(n *= n);\n     *   return n % 2 == 0;\n     * }, []);\n     * // => [4, 9]\n     *\n     * _.transform({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {\n     *   (result[value] || (result[value] = [])).push(key);\n     * }, {});\n     * // => { '1': ['a', 'c'], '2': ['b'] }\n     */function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor():[];}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{};}else{accumulator={};}}(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object);});return accumulator;}/**\n     * Removes the property at `path` of `object`.\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Object\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to unset.\n     * @returns {boolean} Returns `true` if the property is deleted, else `false`.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 7 } }] };\n     * _.unset(object, 'a[0].b.c');\n     * // => true\n     *\n     * console.log(object);\n     * // => { 'a': [{ 'b': {} }] };\n     *\n     * _.unset(object, ['a', '0', 'b', 'c']);\n     * // => true\n     *\n     * console.log(object);\n     * // => { 'a': [{ 'b': {} }] };\n     */function unset(object,path){return object==null?true:baseUnset(object,path);}/**\n     * This method is like `_.set` except that accepts `updater` to produce the\n     * value to set. Use `_.updateWith` to customize `path` creation. The `updater`\n     * is invoked with one argument: (value).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.6.0\n     * @category Object\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to set.\n     * @param {Function} updater The function to produce the updated value.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n     *\n     * _.update(object, 'a[0].b.c', function(n) { return n * n; });\n     * console.log(object.a[0].b.c);\n     * // => 9\n     *\n     * _.update(object, 'x[0].y.z', function(n) { return n ? n + 1 : 0; });\n     * console.log(object.x[0].y.z);\n     * // => 0\n     */function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater));}/**\n     * This method is like `_.update` except that it accepts `customizer` which is\n     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`\n     * path creation is handled by the method instead. The `customizer` is invoked\n     * with three arguments: (nsValue, key, nsObject).\n     *\n     * **Note:** This method mutates `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.6.0\n     * @category Object\n     * @param {Object} object The object to modify.\n     * @param {Array|string} path The path of the property to set.\n     * @param {Function} updater The function to produce the updated value.\n     * @param {Function} [customizer] The function to customize assigned values.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var object = {};\n     *\n     * _.updateWith(object, '[0][1]', _.constant('a'), Object);\n     * // => { '0': { '1': 'a' } }\n     */function updateWith(object,path,updater,customizer){customizer=typeof customizer=='function'?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer);}/**\n     * Creates an array of the own enumerable string keyed property values of `object`.\n     *\n     * **Note:** Non-object values are coerced to objects.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property values.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.values(new Foo);\n     * // => [1, 2] (iteration order is not guaranteed)\n     *\n     * _.values('hi');\n     * // => ['h', 'i']\n     */function values(object){return object==null?[]:baseValues(object,keys(object));}/**\n     * Creates an array of the own and inherited enumerable string keyed property\n     * values of `object`.\n     *\n     * **Note:** Non-object values are coerced to objects.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Object\n     * @param {Object} object The object to query.\n     * @returns {Array} Returns the array of property values.\n     * @example\n     *\n     * function Foo() {\n     *   this.a = 1;\n     *   this.b = 2;\n     * }\n     *\n     * Foo.prototype.c = 3;\n     *\n     * _.valuesIn(new Foo);\n     * // => [1, 2, 3] (iteration order is not guaranteed)\n     */function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object));}/*------------------------------------------------------------------------*//**\n     * Clamps `number` within the inclusive `lower` and `upper` bounds.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Number\n     * @param {number} number The number to clamp.\n     * @param {number} [lower] The lower bound.\n     * @param {number} upper The upper bound.\n     * @returns {number} Returns the clamped number.\n     * @example\n     *\n     * _.clamp(-10, -5, 5);\n     * // => -5\n     *\n     * _.clamp(10, -5, 5);\n     * // => 5\n     */function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined;}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0;}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0;}return baseClamp(toNumber(number),lower,upper);}/**\n     * Checks if `n` is between `start` and up to, but not including, `end`. If\n     * `end` is not specified, it's set to `start` with `start` then set to `0`.\n     * If `start` is greater than `end` the params are swapped to support\n     * negative ranges.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.3.0\n     * @category Number\n     * @param {number} number The number to check.\n     * @param {number} [start=0] The start of the range.\n     * @param {number} end The end of the range.\n     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.\n     * @see _.range, _.rangeRight\n     * @example\n     *\n     * _.inRange(3, 2, 4);\n     * // => true\n     *\n     * _.inRange(4, 8);\n     * // => true\n     *\n     * _.inRange(4, 2);\n     * // => false\n     *\n     * _.inRange(2, 2);\n     * // => false\n     *\n     * _.inRange(1.2, 2);\n     * // => true\n     *\n     * _.inRange(5.2, 4);\n     * // => false\n     *\n     * _.inRange(-3, -2, -6);\n     * // => true\n     */function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0;}else{end=toFinite(end);}number=toNumber(number);return baseInRange(number,start,end);}/**\n     * Produces a random number between the inclusive `lower` and `upper` bounds.\n     * If only one argument is provided a number between `0` and the given number\n     * is returned. If `floating` is `true`, or either `lower` or `upper` are\n     * floats, a floating-point number is returned instead of an integer.\n     *\n     * **Note:** JavaScript follows the IEEE-754 standard for resolving\n     * floating-point values which can produce unexpected results.\n     *\n     * @static\n     * @memberOf _\n     * @since 0.7.0\n     * @category Number\n     * @param {number} [lower=0] The lower bound.\n     * @param {number} [upper=1] The upper bound.\n     * @param {boolean} [floating] Specify returning a floating-point number.\n     * @returns {number} Returns the random number.\n     * @example\n     *\n     * _.random(0, 5);\n     * // => an integer between 0 and 5\n     *\n     * _.random(5);\n     * // => also an integer between 0 and 5\n     *\n     * _.random(5, true);\n     * // => a floating-point number between 0 and 5\n     *\n     * _.random(1.2, 5.2);\n     * // => a floating-point number between 1.2 and 5.2\n     */function random(lower,upper,floating){if(floating&&typeof floating!='boolean'&&isIterateeCall(lower,upper,floating)){upper=floating=undefined;}if(floating===undefined){if(typeof upper=='boolean'){floating=upper;upper=undefined;}else if(typeof lower=='boolean'){floating=lower;lower=undefined;}}if(lower===undefined&&upper===undefined){lower=0;upper=1;}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0;}else{upper=toFinite(upper);}}if(lower>upper){var temp=lower;lower=upper;upper=temp;}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat('1e-'+((rand+'').length-1))),upper);}return baseRandom(lower,upper);}/*------------------------------------------------------------------------*//**\n     * Converts `string` to [camel case](https://en.wikipedia.org/wiki/CamelCase).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the camel cased string.\n     * @example\n     *\n     * _.camelCase('Foo Bar');\n     * // => 'fooBar'\n     *\n     * _.camelCase('--foo-bar--');\n     * // => 'fooBar'\n     *\n     * _.camelCase('__FOO_BAR__');\n     * // => 'fooBar'\n     */var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word);});/**\n     * Converts the first character of `string` to upper case and the remaining\n     * to lower case.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to capitalize.\n     * @returns {string} Returns the capitalized string.\n     * @example\n     *\n     * _.capitalize('FRED');\n     * // => 'Fred'\n     */function capitalize(string){return upperFirst(toString(string).toLowerCase());}/**\n     * Deburrs `string` by converting\n     * [Latin-1 Supplement](https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block)#Character_table)\n     * and [Latin Extended-A](https://en.wikipedia.org/wiki/Latin_Extended-A)\n     * letters to basic Latin letters and removing\n     * [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to deburr.\n     * @returns {string} Returns the deburred string.\n     * @example\n     *\n     * _.deburr('déjà vu');\n     * // => 'deja vu'\n     */function deburr(string){string=toString(string);return string&&string.replace(reLatin,deburrLetter).replace(reComboMark,'');}/**\n     * Checks if `string` ends with the given target string.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to inspect.\n     * @param {string} [target] The string to search for.\n     * @param {number} [position=string.length] The position to search up to.\n     * @returns {boolean} Returns `true` if `string` ends with `target`,\n     *  else `false`.\n     * @example\n     *\n     * _.endsWith('abc', 'c');\n     * // => true\n     *\n     * _.endsWith('abc', 'b');\n     * // => false\n     *\n     * _.endsWith('abc', 'b', 2);\n     * // => true\n     */function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target;}/**\n     * Converts the characters \"&\", \"<\", \">\", '\"', and \"'\" in `string` to their\n     * corresponding HTML entities.\n     *\n     * **Note:** No other characters are escaped. To escape additional\n     * characters use a third-party library like [_he_](https://mths.be/he).\n     *\n     * Though the \">\" character is escaped for symmetry, characters like\n     * \">\" and \"/\" don't need escaping in HTML and have no special meaning\n     * unless they're part of a tag or unquoted attribute value. See\n     * [Mathias Bynens's article](https://mathiasbynens.be/notes/ambiguous-ampersands)\n     * (under \"semi-related fun fact\") for more details.\n     *\n     * When working with HTML you should always\n     * [quote attribute values](http://wonko.com/post/html-escaping) to reduce\n     * XSS vectors.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category String\n     * @param {string} [string=''] The string to escape.\n     * @returns {string} Returns the escaped string.\n     * @example\n     *\n     * _.escape('fred, barney, & pebbles');\n     * // => 'fred, barney, &amp; pebbles'\n     */function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string;}/**\n     * Escapes the `RegExp` special characters \"^\", \"$\", \"\\\", \".\", \"*\", \"+\",\n     * \"?\", \"(\", \")\", \"[\", \"]\", \"{\", \"}\", and \"|\" in `string`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to escape.\n     * @returns {string} Returns the escaped string.\n     * @example\n     *\n     * _.escapeRegExp('[lodash](https://lodash.com/)');\n     * // => '\\[lodash\\]\\(https://lodash\\.com/\\)'\n     */function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,'\\\\$&'):string;}/**\n     * Converts `string` to\n     * [kebab case](https://en.wikipedia.org/wiki/Letter_case#Special_case_styles).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the kebab cased string.\n     * @example\n     *\n     * _.kebabCase('Foo Bar');\n     * // => 'foo-bar'\n     *\n     * _.kebabCase('fooBar');\n     * // => 'foo-bar'\n     *\n     * _.kebabCase('__FOO_BAR__');\n     * // => 'foo-bar'\n     */var kebabCase=createCompounder(function(result,word,index){return result+(index?'-':'')+word.toLowerCase();});/**\n     * Converts `string`, as space separated words, to lower case.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the lower cased string.\n     * @example\n     *\n     * _.lowerCase('--Foo-Bar--');\n     * // => 'foo bar'\n     *\n     * _.lowerCase('fooBar');\n     * // => 'foo bar'\n     *\n     * _.lowerCase('__FOO_BAR__');\n     * // => 'foo bar'\n     */var lowerCase=createCompounder(function(result,word,index){return result+(index?' ':'')+word.toLowerCase();});/**\n     * Converts the first character of `string` to lower case.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the converted string.\n     * @example\n     *\n     * _.lowerFirst('Fred');\n     * // => 'fred'\n     *\n     * _.lowerFirst('FRED');\n     * // => 'fRED'\n     */var lowerFirst=createCaseFirst('toLowerCase');/**\n     * Pads `string` on the left and right sides if it's shorter than `length`.\n     * Padding characters are truncated if they can't be evenly divided by `length`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to pad.\n     * @param {number} [length=0] The padding length.\n     * @param {string} [chars=' '] The string used as padding.\n     * @returns {string} Returns the padded string.\n     * @example\n     *\n     * _.pad('abc', 8);\n     * // => '  abc   '\n     *\n     * _.pad('abc', 8, '_-');\n     * // => '_-abc_-_'\n     *\n     * _.pad('abc', 3);\n     * // => 'abc'\n     */function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string;}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars);}/**\n     * Pads `string` on the right side if it's shorter than `length`. Padding\n     * characters are truncated if they exceed `length`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to pad.\n     * @param {number} [length=0] The padding length.\n     * @param {string} [chars=' '] The string used as padding.\n     * @returns {string} Returns the padded string.\n     * @example\n     *\n     * _.padEnd('abc', 6);\n     * // => 'abc   '\n     *\n     * _.padEnd('abc', 6, '_-');\n     * // => 'abc_-_'\n     *\n     * _.padEnd('abc', 3);\n     * // => 'abc'\n     */function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string;}/**\n     * Pads `string` on the left side if it's shorter than `length`. Padding\n     * characters are truncated if they exceed `length`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to pad.\n     * @param {number} [length=0] The padding length.\n     * @param {string} [chars=' '] The string used as padding.\n     * @returns {string} Returns the padded string.\n     * @example\n     *\n     * _.padStart('abc', 6);\n     * // => '   abc'\n     *\n     * _.padStart('abc', 6, '_-');\n     * // => '_-_abc'\n     *\n     * _.padStart('abc', 3);\n     * // => 'abc'\n     */function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string;}/**\n     * Converts `string` to an integer of the specified radix. If `radix` is\n     * `undefined` or `0`, a `radix` of `10` is used unless `value` is a\n     * hexadecimal, in which case a `radix` of `16` is used.\n     *\n     * **Note:** This method aligns with the\n     * [ES5 implementation](https://es5.github.io/#x15.1.2.2) of `parseInt`.\n     *\n     * @static\n     * @memberOf _\n     * @since 1.1.0\n     * @category String\n     * @param {string} string The string to convert.\n     * @param {number} [radix=10] The radix to interpret `value` by.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {number} Returns the converted integer.\n     * @example\n     *\n     * _.parseInt('08');\n     * // => 8\n     *\n     * _.map(['6', '08', '10'], _.parseInt);\n     * // => [6, 8, 10]\n     */function parseInt(string,radix,guard){if(guard||radix==null){radix=0;}else if(radix){radix=+radix;}return nativeParseInt(toString(string).replace(reTrimStart,''),radix||0);}/**\n     * Repeats the given string `n` times.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to repeat.\n     * @param {number} [n=1] The number of times to repeat the string.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {string} Returns the repeated string.\n     * @example\n     *\n     * _.repeat('*', 3);\n     * // => '***'\n     *\n     * _.repeat('abc', 2);\n     * // => 'abcabc'\n     *\n     * _.repeat('abc', 0);\n     * // => ''\n     */function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1;}else{n=toInteger(n);}return baseRepeat(toString(string),n);}/**\n     * Replaces matches for `pattern` in `string` with `replacement`.\n     *\n     * **Note:** This method is based on\n     * [`String#replace`](https://mdn.io/String/replace).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to modify.\n     * @param {RegExp|string} pattern The pattern to replace.\n     * @param {Function|string} replacement The match replacement.\n     * @returns {string} Returns the modified string.\n     * @example\n     *\n     * _.replace('Hi Fred', 'Fred', 'Barney');\n     * // => 'Hi Barney'\n     */function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2]);}/**\n     * Converts `string` to\n     * [snake case](https://en.wikipedia.org/wiki/Snake_case).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the snake cased string.\n     * @example\n     *\n     * _.snakeCase('Foo Bar');\n     * // => 'foo_bar'\n     *\n     * _.snakeCase('fooBar');\n     * // => 'foo_bar'\n     *\n     * _.snakeCase('--FOO-BAR--');\n     * // => 'foo_bar'\n     */var snakeCase=createCompounder(function(result,word,index){return result+(index?'_':'')+word.toLowerCase();});/**\n     * Splits `string` by `separator`.\n     *\n     * **Note:** This method is based on\n     * [`String#split`](https://mdn.io/String/split).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to split.\n     * @param {RegExp|string} separator The separator pattern to split by.\n     * @param {number} [limit] The length to truncate results to.\n     * @returns {Array} Returns the string segments.\n     * @example\n     *\n     * _.split('a-b-c', '-', 2);\n     * // => ['a', 'b']\n     */function split(string,separator,limit){if(limit&&typeof limit!='number'&&isIterateeCall(string,separator,limit)){separator=limit=undefined;}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[];}string=toString(string);if(string&&(typeof separator=='string'||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(!separator&&hasUnicode(string)){return castSlice(stringToArray(string),0,limit);}}return string.split(separator,limit);}/**\n     * Converts `string` to\n     * [start case](https://en.wikipedia.org/wiki/Letter_case#Stylistic_or_specialised_usage).\n     *\n     * @static\n     * @memberOf _\n     * @since 3.1.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the start cased string.\n     * @example\n     *\n     * _.startCase('--foo-bar--');\n     * // => 'Foo Bar'\n     *\n     * _.startCase('fooBar');\n     * // => 'Foo Bar'\n     *\n     * _.startCase('__FOO_BAR__');\n     * // => 'FOO BAR'\n     */var startCase=createCompounder(function(result,word,index){return result+(index?' ':'')+upperFirst(word);});/**\n     * Checks if `string` starts with the given target string.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to inspect.\n     * @param {string} [target] The string to search for.\n     * @param {number} [position=0] The position to search from.\n     * @returns {boolean} Returns `true` if `string` starts with `target`,\n     *  else `false`.\n     * @example\n     *\n     * _.startsWith('abc', 'a');\n     * // => true\n     *\n     * _.startsWith('abc', 'b');\n     * // => false\n     *\n     * _.startsWith('abc', 'b', 1);\n     * // => true\n     */function startsWith(string,target,position){string=toString(string);position=position==null?0:baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target;}/**\n     * Creates a compiled template function that can interpolate data properties\n     * in \"interpolate\" delimiters, HTML-escape interpolated data properties in\n     * \"escape\" delimiters, and execute JavaScript in \"evaluate\" delimiters. Data\n     * properties may be accessed as free variables in the template. If a setting\n     * object is given, it takes precedence over `_.templateSettings` values.\n     *\n     * **Note:** In the development build `_.template` utilizes\n     * [sourceURLs](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl)\n     * for easier debugging.\n     *\n     * For more information on precompiling templates see\n     * [lodash's custom builds documentation](https://lodash.com/custom-builds).\n     *\n     * For more information on Chrome extension sandboxes see\n     * [Chrome's extensions documentation](https://developer.chrome.com/extensions/sandboxingEval).\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category String\n     * @param {string} [string=''] The template string.\n     * @param {Object} [options={}] The options object.\n     * @param {RegExp} [options.escape=_.templateSettings.escape]\n     *  The HTML \"escape\" delimiter.\n     * @param {RegExp} [options.evaluate=_.templateSettings.evaluate]\n     *  The \"evaluate\" delimiter.\n     * @param {Object} [options.imports=_.templateSettings.imports]\n     *  An object to import into the template as free variables.\n     * @param {RegExp} [options.interpolate=_.templateSettings.interpolate]\n     *  The \"interpolate\" delimiter.\n     * @param {string} [options.sourceURL='lodash.templateSources[n]']\n     *  The sourceURL of the compiled template.\n     * @param {string} [options.variable='obj']\n     *  The data object variable name.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Function} Returns the compiled template function.\n     * @example\n     *\n     * // Use the \"interpolate\" delimiter to create a compiled template.\n     * var compiled = _.template('hello <%= user %>!');\n     * compiled({ 'user': 'fred' });\n     * // => 'hello fred!'\n     *\n     * // Use the HTML \"escape\" delimiter to escape data property values.\n     * var compiled = _.template('<b><%- value %></b>');\n     * compiled({ 'value': '<script>' });\n     * // => '<b>&lt;script&gt;</b>'\n     *\n     * // Use the \"evaluate\" delimiter to execute JavaScript and generate HTML.\n     * var compiled = _.template('<% _.forEach(users, function(user) { %><li><%- user %></li><% }); %>');\n     * compiled({ 'users': ['fred', 'barney'] });\n     * // => '<li>fred</li><li>barney</li>'\n     *\n     * // Use the internal `print` function in \"evaluate\" delimiters.\n     * var compiled = _.template('<% print(\"hello \" + user); %>!');\n     * compiled({ 'user': 'barney' });\n     * // => 'hello barney!'\n     *\n     * // Use the ES template literal delimiter as an \"interpolate\" delimiter.\n     * // Disable support by replacing the \"interpolate\" delimiter.\n     * var compiled = _.template('hello ${ user }!');\n     * compiled({ 'user': 'pebbles' });\n     * // => 'hello pebbles!'\n     *\n     * // Use backslashes to treat delimiters as plain text.\n     * var compiled = _.template('<%= \"\\\\<%- value %\\\\>\" %>');\n     * compiled({ 'value': 'ignored' });\n     * // => '<%- value %>'\n     *\n     * // Use the `imports` option to import `jQuery` as `jq`.\n     * var text = '<% jq.each(users, function(user) { %><li><%- user %></li><% }); %>';\n     * var compiled = _.template(text, { 'imports': { 'jq': jQuery } });\n     * compiled({ 'users': ['fred', 'barney'] });\n     * // => '<li>fred</li><li>barney</li>'\n     *\n     * // Use the `sourceURL` option to specify a custom sourceURL for the template.\n     * var compiled = _.template('hello <%= user %>!', { 'sourceURL': '/basic/greeting.jst' });\n     * compiled(data);\n     * // => Find the source of \"greeting.jst\" under the Sources tab or Resources panel of the web inspector.\n     *\n     * // Use the `variable` option to ensure a with-statement isn't used in the compiled template.\n     * var compiled = _.template('hi <%= data.user %>!', { 'variable': 'data' });\n     * compiled.source;\n     * // => function(data) {\n     * //   var __t, __p = '';\n     * //   __p += 'hi ' + ((__t = ( data.user )) == null ? '' : __t) + '!';\n     * //   return __p;\n     * // }\n     *\n     * // Use custom template delimiters.\n     * _.templateSettings.interpolate = /{{([\\s\\S]+?)}}/g;\n     * var compiled = _.template('hello {{ user }}!');\n     * compiled({ 'user': 'mustache' });\n     * // => 'hello mustache!'\n     *\n     * // Use the `source` property to inline compiled templates for meaningful\n     * // line numbers in error messages and stack traces.\n     * fs.writeFileSync(path.join(process.cwd(), 'jst.js'), '\\\n     *   var JST = {\\\n     *     \"main\": ' + _.template(mainText).source + '\\\n     *   };\\\n     * ');\n     */function template(string,options,guard){// Based on John Resig's `tmpl` implementation\n// (http://ejohn.org/blog/javascript-micro-templating/)\n// and Laura Doktorova's doT.js (https://github.com/olado/doT).\nvar settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined;}string=toString(string);options=assignInWith({},options,settings,customDefaultsAssignIn);var imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source=\"__p += '\";// Compile the regexp to match each delimiter.\nvar reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+interpolate.source+'|'+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+'|'+(options.evaluate||reNoMatch).source+'|$','g');// Use a sourceURL for easier debugging.\nvar sourceURL='//# sourceURL='+('sourceURL'in options?options.sourceURL:'lodash.templateSources['+ ++templateCounter+']')+'\\n';string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);// Escape characters that can't be included in string literals.\nsource+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);// Replace delimiters with snippets.\nif(escapeValue){isEscaping=true;source+=\"' +\\n__e(\"+escapeValue+\") +\\n'\";}if(evaluateValue){isEvaluating=true;source+=\"';\\n\"+evaluateValue+\";\\n__p += '\";}if(interpolateValue){source+=\"' +\\n((__t = (\"+interpolateValue+\")) == null ? '' : __t) +\\n'\";}index=offset+match.length;// The JS engine embedded in Adobe products needs `match` returned in\n// order to produce the correct `offset` value.\nreturn match;});source+=\"';\\n\";// If `variable` is not specified wrap a with-statement around the generated\n// code to add the data object to the top of the scope chain.\nvar variable=options.variable;if(!variable){source='with (obj) {\\n'+source+'\\n}\\n';}// Cleanup code by stripping empty strings.\nsource=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');// Frame code as the function body.\nsource='function('+(variable||'obj')+') {\\n'+(variable?'':'obj || (obj = {});\\n')+\"var __t, __p = ''\"+(isEscaping?', __e = _.escape':'')+(isEvaluating?', __j = Array.prototype.join;\\n'+\"function print() { __p += __j.call(arguments, '') }\\n\":';\\n')+source+'return __p\\n}';var result=attempt(function(){return Function(importsKeys,sourceURL+'return '+source).apply(undefined,importsValues);});// Provide the compiled function's source by its `toString` method or\n// the `source` property as a convenience for inlining compiled templates.\nresult.source=source;if(isError(result)){throw result;}return result;}/**\n     * Converts `string`, as a whole, to lower case just like\n     * [String#toLowerCase](https://mdn.io/toLowerCase).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the lower cased string.\n     * @example\n     *\n     * _.toLower('--Foo-Bar--');\n     * // => '--foo-bar--'\n     *\n     * _.toLower('fooBar');\n     * // => 'foobar'\n     *\n     * _.toLower('__FOO_BAR__');\n     * // => '__foo_bar__'\n     */function toLower(value){return toString(value).toLowerCase();}/**\n     * Converts `string`, as a whole, to upper case just like\n     * [String#toUpperCase](https://mdn.io/toUpperCase).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the upper cased string.\n     * @example\n     *\n     * _.toUpper('--foo-bar--');\n     * // => '--FOO-BAR--'\n     *\n     * _.toUpper('fooBar');\n     * // => 'FOOBAR'\n     *\n     * _.toUpper('__foo_bar__');\n     * // => '__FOO_BAR__'\n     */function toUpper(value){return toString(value).toUpperCase();}/**\n     * Removes leading and trailing whitespace or specified characters from `string`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to trim.\n     * @param {string} [chars=whitespace] The characters to trim.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {string} Returns the trimmed string.\n     * @example\n     *\n     * _.trim('  abc  ');\n     * // => 'abc'\n     *\n     * _.trim('-_-abc-_-', '_-');\n     * // => 'abc'\n     *\n     * _.map(['  foo  ', '  bar  '], _.trim);\n     * // => ['foo', 'bar']\n     */function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,'');}if(!string||!(chars=baseToString(chars))){return string;}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join('');}/**\n     * Removes trailing whitespace or specified characters from `string`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to trim.\n     * @param {string} [chars=whitespace] The characters to trim.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {string} Returns the trimmed string.\n     * @example\n     *\n     * _.trimEnd('  abc  ');\n     * // => '  abc'\n     *\n     * _.trimEnd('-_-abc-_-', '_-');\n     * // => '-_-abc'\n     */function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,'');}if(!string||!(chars=baseToString(chars))){return string;}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join('');}/**\n     * Removes leading whitespace or specified characters from `string`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to trim.\n     * @param {string} [chars=whitespace] The characters to trim.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {string} Returns the trimmed string.\n     * @example\n     *\n     * _.trimStart('  abc  ');\n     * // => 'abc  '\n     *\n     * _.trimStart('-_-abc-_-', '_-');\n     * // => 'abc-_-'\n     */function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,'');}if(!string||!(chars=baseToString(chars))){return string;}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join('');}/**\n     * Truncates `string` if it's longer than the given maximum string length.\n     * The last characters of the truncated string are replaced with the omission\n     * string which defaults to \"...\".\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to truncate.\n     * @param {Object} [options={}] The options object.\n     * @param {number} [options.length=30] The maximum string length.\n     * @param {string} [options.omission='...'] The string to indicate text is omitted.\n     * @param {RegExp|string} [options.separator] The separator pattern to truncate to.\n     * @returns {string} Returns the truncated string.\n     * @example\n     *\n     * _.truncate('hi-diddly-ho there, neighborino');\n     * // => 'hi-diddly-ho there, neighbo...'\n     *\n     * _.truncate('hi-diddly-ho there, neighborino', {\n     *   'length': 24,\n     *   'separator': ' '\n     * });\n     * // => 'hi-diddly-ho there,...'\n     *\n     * _.truncate('hi-diddly-ho there, neighborino', {\n     *   'length': 24,\n     *   'separator': /,? +/\n     * });\n     * // => 'hi-diddly-ho there...'\n     *\n     * _.truncate('hi-diddly-ho there, neighborino', {\n     *   'omission': ' [...]'\n     * });\n     * // => 'hi-diddly-ho there, neig [...]'\n     */function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator='separator'in options?options.separator:separator;length='length'in options?toInteger(options.length):length;omission='omission'in options?baseToString(options.omission):omission;}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length;}if(length>=strLength){return string;}var end=length-stringSize(omission);if(end<1){return omission;}var result=strSymbols?castSlice(strSymbols,0,end).join(''):string.slice(0,end);if(separator===undefined){return result+omission;}if(strSymbols){end+=result.length-end;}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+'g');}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index;}result=result.slice(0,newEnd===undefined?end:newEnd);}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index);}}return result+omission;}/**\n     * The inverse of `_.escape`; this method converts the HTML entities\n     * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to\n     * their corresponding characters.\n     *\n     * **Note:** No other HTML entities are unescaped. To unescape additional\n     * HTML entities use a third-party library like [_he_](https://mths.be/he).\n     *\n     * @static\n     * @memberOf _\n     * @since 0.6.0\n     * @category String\n     * @param {string} [string=''] The string to unescape.\n     * @returns {string} Returns the unescaped string.\n     * @example\n     *\n     * _.unescape('fred, barney, &amp; pebbles');\n     * // => 'fred, barney, & pebbles'\n     */function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string;}/**\n     * Converts `string`, as space separated words, to upper case.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the upper cased string.\n     * @example\n     *\n     * _.upperCase('--foo-bar');\n     * // => 'FOO BAR'\n     *\n     * _.upperCase('fooBar');\n     * // => 'FOO BAR'\n     *\n     * _.upperCase('__foo_bar__');\n     * // => 'FOO BAR'\n     */var upperCase=createCompounder(function(result,word,index){return result+(index?' ':'')+word.toUpperCase();});/**\n     * Converts the first character of `string` to upper case.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category String\n     * @param {string} [string=''] The string to convert.\n     * @returns {string} Returns the converted string.\n     * @example\n     *\n     * _.upperFirst('fred');\n     * // => 'Fred'\n     *\n     * _.upperFirst('FRED');\n     * // => 'FRED'\n     */var upperFirst=createCaseFirst('toUpperCase');/**\n     * Splits `string` into an array of its words.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category String\n     * @param {string} [string=''] The string to inspect.\n     * @param {RegExp|string} [pattern] The pattern to match words.\n     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n     * @returns {Array} Returns the words of `string`.\n     * @example\n     *\n     * _.words('fred, barney, & pebbles');\n     * // => ['fred', 'barney', 'pebbles']\n     *\n     * _.words('fred, barney, & pebbles', /[^, ]+/g);\n     * // => ['fred', 'barney', '&', 'pebbles']\n     */function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){return hasUnicodeWord(string)?unicodeWords(string):asciiWords(string);}return string.match(pattern)||[];}/*------------------------------------------------------------------------*//**\n     * Attempts to invoke `func`, returning either the result or the caught error\n     * object. Any additional arguments are provided to `func` when it's invoked.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Util\n     * @param {Function} func The function to attempt.\n     * @param {...*} [args] The arguments to invoke `func` with.\n     * @returns {*} Returns the `func` result or error object.\n     * @example\n     *\n     * // Avoid throwing errors for invalid selectors.\n     * var elements = _.attempt(function(selector) {\n     *   return document.querySelectorAll(selector);\n     * }, '>_>');\n     *\n     * if (_.isError(elements)) {\n     *   elements = [];\n     * }\n     */var attempt=baseRest(function(func,args){try{return apply(func,undefined,args);}catch(e){return isError(e)?e:new Error(e);}});/**\n     * Binds methods of an object to the object itself, overwriting the existing\n     * method.\n     *\n     * **Note:** This method doesn't set the \"length\" property of bound functions.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {Object} object The object to bind and assign the bound methods to.\n     * @param {...(string|string[])} methodNames The object method names to bind.\n     * @returns {Object} Returns `object`.\n     * @example\n     *\n     * var view = {\n     *   'label': 'docs',\n     *   'click': function() {\n     *     console.log('clicked ' + this.label);\n     *   }\n     * };\n     *\n     * _.bindAll(view, ['click']);\n     * jQuery(element).on('click', view.click);\n     * // => Logs 'clicked docs' when clicked.\n     */var bindAll=flatRest(function(object,methodNames){arrayEach(methodNames,function(key){key=toKey(key);baseAssignValue(object,key,bind(object[key],object));});return object;});/**\n     * Creates a function that iterates over `pairs` and invokes the corresponding\n     * function of the first predicate to return truthy. The predicate-function\n     * pairs are invoked with the `this` binding and arguments of the created\n     * function.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {Array} pairs The predicate-function pairs.\n     * @returns {Function} Returns the new composite function.\n     * @example\n     *\n     * var func = _.cond([\n     *   [_.matches({ 'a': 1 }),           _.constant('matches A')],\n     *   [_.conforms({ 'b': _.isNumber }), _.constant('matches B')],\n     *   [_.stubTrue,                      _.constant('no match')]\n     * ]);\n     *\n     * func({ 'a': 1, 'b': 2 });\n     * // => 'matches A'\n     *\n     * func({ 'a': 0, 'b': 1 });\n     * // => 'matches B'\n     *\n     * func({ 'a': '1', 'b': '2' });\n     * // => 'no match'\n     */function cond(pairs){var length=pairs==null?0:pairs.length,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!='function'){throw new TypeError(FUNC_ERROR_TEXT);}return[toIteratee(pair[0]),pair[1]];});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args);}}});}/**\n     * Creates a function that invokes the predicate properties of `source` with\n     * the corresponding property values of a given object, returning `true` if\n     * all predicates return truthy, else `false`.\n     *\n     * **Note:** The created function is equivalent to `_.conformsTo` with\n     * `source` partially applied.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {Object} source The object of property predicates to conform to.\n     * @returns {Function} Returns the new spec function.\n     * @example\n     *\n     * var objects = [\n     *   { 'a': 2, 'b': 1 },\n     *   { 'a': 1, 'b': 2 }\n     * ];\n     *\n     * _.filter(objects, _.conforms({ 'b': function(n) { return n > 1; } }));\n     * // => [{ 'a': 1, 'b': 2 }]\n     */function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG));}/**\n     * Creates a function that returns `value`.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.4.0\n     * @category Util\n     * @param {*} value The value to return from the new function.\n     * @returns {Function} Returns the new constant function.\n     * @example\n     *\n     * var objects = _.times(2, _.constant({ 'a': 1 }));\n     *\n     * console.log(objects);\n     * // => [{ 'a': 1 }, { 'a': 1 }]\n     *\n     * console.log(objects[0] === objects[1]);\n     * // => true\n     */function constant(value){return function(){return value;};}/**\n     * Checks `value` to determine whether a default value should be returned in\n     * its place. The `defaultValue` is returned if `value` is `NaN`, `null`,\n     * or `undefined`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.14.0\n     * @category Util\n     * @param {*} value The value to check.\n     * @param {*} defaultValue The default value.\n     * @returns {*} Returns the resolved value.\n     * @example\n     *\n     * _.defaultTo(1, 10);\n     * // => 1\n     *\n     * _.defaultTo(undefined, 10);\n     * // => 10\n     */function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value;}/**\n     * Creates a function that returns the result of invoking the given functions\n     * with the `this` binding of the created function, where each successive\n     * invocation is supplied the return value of the previous.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Util\n     * @param {...(Function|Function[])} [funcs] The functions to invoke.\n     * @returns {Function} Returns the new composite function.\n     * @see _.flowRight\n     * @example\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * var addSquare = _.flow([_.add, square]);\n     * addSquare(1, 2);\n     * // => 9\n     */var flow=createFlow();/**\n     * This method is like `_.flow` except that it creates a function that\n     * invokes the given functions from right to left.\n     *\n     * @static\n     * @since 3.0.0\n     * @memberOf _\n     * @category Util\n     * @param {...(Function|Function[])} [funcs] The functions to invoke.\n     * @returns {Function} Returns the new composite function.\n     * @see _.flow\n     * @example\n     *\n     * function square(n) {\n     *   return n * n;\n     * }\n     *\n     * var addSquare = _.flowRight([square, _.add]);\n     * addSquare(1, 2);\n     * // => 9\n     */var flowRight=createFlow(true);/**\n     * This method returns the first argument it receives.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {*} value Any value.\n     * @returns {*} Returns `value`.\n     * @example\n     *\n     * var object = { 'a': 1 };\n     *\n     * console.log(_.identity(object) === object);\n     * // => true\n     */function identity(value){return value;}/**\n     * Creates a function that invokes `func` with the arguments of the created\n     * function. If `func` is a property name, the created function returns the\n     * property value for a given element. If `func` is an array or object, the\n     * created function returns `true` for elements that contain the equivalent\n     * source properties, otherwise it returns `false`.\n     *\n     * @static\n     * @since 4.0.0\n     * @memberOf _\n     * @category Util\n     * @param {*} [func=_.identity] The value to convert to a callback.\n     * @returns {Function} Returns the callback.\n     * @example\n     *\n     * var users = [\n     *   { 'user': 'barney', 'age': 36, 'active': true },\n     *   { 'user': 'fred',   'age': 40, 'active': false }\n     * ];\n     *\n     * // The `_.matches` iteratee shorthand.\n     * _.filter(users, _.iteratee({ 'user': 'barney', 'active': true }));\n     * // => [{ 'user': 'barney', 'age': 36, 'active': true }]\n     *\n     * // The `_.matchesProperty` iteratee shorthand.\n     * _.filter(users, _.iteratee(['user', 'fred']));\n     * // => [{ 'user': 'fred', 'age': 40 }]\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.map(users, _.iteratee('user'));\n     * // => ['barney', 'fred']\n     *\n     * // Create custom iteratee shorthands.\n     * _.iteratee = _.wrap(_.iteratee, function(iteratee, func) {\n     *   return !_.isRegExp(func) ? iteratee(func) : function(string) {\n     *     return func.test(string);\n     *   };\n     * });\n     *\n     * _.filter(['abc', 'def'], /ef/);\n     * // => ['def']\n     */function iteratee(func){return baseIteratee(typeof func=='function'?func:baseClone(func,CLONE_DEEP_FLAG));}/**\n     * Creates a function that performs a partial deep comparison between a given\n     * object and `source`, returning `true` if the given object has equivalent\n     * property values, else `false`.\n     *\n     * **Note:** The created function is equivalent to `_.isMatch` with `source`\n     * partially applied.\n     *\n     * Partial comparisons will match empty array and empty object `source`\n     * values against any array or object value, respectively. See `_.isEqual`\n     * for a list of supported value comparisons.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Util\n     * @param {Object} source The object of property values to match.\n     * @returns {Function} Returns the new spec function.\n     * @example\n     *\n     * var objects = [\n     *   { 'a': 1, 'b': 2, 'c': 3 },\n     *   { 'a': 4, 'b': 5, 'c': 6 }\n     * ];\n     *\n     * _.filter(objects, _.matches({ 'a': 4, 'c': 6 }));\n     * // => [{ 'a': 4, 'b': 5, 'c': 6 }]\n     */function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG));}/**\n     * Creates a function that performs a partial deep comparison between the\n     * value at `path` of a given object to `srcValue`, returning `true` if the\n     * object value is equivalent, else `false`.\n     *\n     * **Note:** Partial comparisons will match empty array and empty object\n     * `srcValue` values against any array or object value, respectively. See\n     * `_.isEqual` for a list of supported value comparisons.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.2.0\n     * @category Util\n     * @param {Array|string} path The path of the property to get.\n     * @param {*} srcValue The value to match.\n     * @returns {Function} Returns the new spec function.\n     * @example\n     *\n     * var objects = [\n     *   { 'a': 1, 'b': 2, 'c': 3 },\n     *   { 'a': 4, 'b': 5, 'c': 6 }\n     * ];\n     *\n     * _.find(objects, _.matchesProperty('a', 4));\n     * // => { 'a': 4, 'b': 5, 'c': 6 }\n     */function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG));}/**\n     * Creates a function that invokes the method at `path` of a given object.\n     * Any additional arguments are provided to the invoked method.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.7.0\n     * @category Util\n     * @param {Array|string} path The path of the method to invoke.\n     * @param {...*} [args] The arguments to invoke the method with.\n     * @returns {Function} Returns the new invoker function.\n     * @example\n     *\n     * var objects = [\n     *   { 'a': { 'b': _.constant(2) } },\n     *   { 'a': { 'b': _.constant(1) } }\n     * ];\n     *\n     * _.map(objects, _.method('a.b'));\n     * // => [2, 1]\n     *\n     * _.map(objects, _.method(['a', 'b']));\n     * // => [2, 1]\n     */var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args);};});/**\n     * The opposite of `_.method`; this method creates a function that invokes\n     * the method at a given path of `object`. Any additional arguments are\n     * provided to the invoked method.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.7.0\n     * @category Util\n     * @param {Object} object The object to query.\n     * @param {...*} [args] The arguments to invoke the method with.\n     * @returns {Function} Returns the new invoker function.\n     * @example\n     *\n     * var array = _.times(3, _.constant),\n     *     object = { 'a': array, 'b': array, 'c': array };\n     *\n     * _.map(['a[2]', 'c[0]'], _.methodOf(object));\n     * // => [2, 0]\n     *\n     * _.map([['a', '2'], ['c', '0']], _.methodOf(object));\n     * // => [2, 0]\n     */var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args);};});/**\n     * Adds all own enumerable string keyed function properties of a source\n     * object to the destination object. If `object` is a function, then methods\n     * are added to its prototype as well.\n     *\n     * **Note:** Use `_.runInContext` to create a pristine `lodash` function to\n     * avoid conflicts caused by modifying the original.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {Function|Object} [object=lodash] The destination object.\n     * @param {Object} source The object of functions to add.\n     * @param {Object} [options={}] The options object.\n     * @param {boolean} [options.chain=true] Specify whether mixins are chainable.\n     * @returns {Function|Object} Returns `object`.\n     * @example\n     *\n     * function vowels(string) {\n     *   return _.filter(string, function(v) {\n     *     return /[aeiou]/i.test(v);\n     *   });\n     * }\n     *\n     * _.mixin({ 'vowels': vowels });\n     * _.vowels('fred');\n     * // => ['e']\n     *\n     * _('fred').vowels().value();\n     * // => ['e']\n     *\n     * _.mixin({ 'vowels': vowels }, { 'chain': false });\n     * _('fred').vowels();\n     * // => ['e']\n     */function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source));}var chain=!(isObject(options)&&'chain'in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({'func':func,'args':arguments,'thisArg':object});result.__chain__=chainAll;return result;}return func.apply(object,arrayPush([this.value()],arguments));};}});return object;}/**\n     * Reverts the `_` variable to its previous value and returns a reference to\n     * the `lodash` function.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @returns {Function} Returns the `lodash` function.\n     * @example\n     *\n     * var lodash = _.noConflict();\n     */function noConflict(){if(root._===this){root._=oldDash;}return this;}/**\n     * This method returns `undefined`.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.3.0\n     * @category Util\n     * @example\n     *\n     * _.times(2, _.noop);\n     * // => [undefined, undefined]\n     */function noop(){}// No operation performed.\n/**\n     * Creates a function that gets the argument at index `n`. If `n` is negative,\n     * the nth argument from the end is returned.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {number} [n=0] The index of the argument to return.\n     * @returns {Function} Returns the new pass-thru function.\n     * @example\n     *\n     * var func = _.nthArg(1);\n     * func('a', 'b', 'c', 'd');\n     * // => 'b'\n     *\n     * var func = _.nthArg(-2);\n     * func('a', 'b', 'c', 'd');\n     * // => 'c'\n     */function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n);});}/**\n     * Creates a function that invokes `iteratees` with the arguments it receives\n     * and returns their results.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {...(Function|Function[])} [iteratees=[_.identity]]\n     *  The iteratees to invoke.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var func = _.over([Math.max, Math.min]);\n     *\n     * func(1, 2, 3, 4);\n     * // => [4, 1]\n     */var over=createOver(arrayMap);/**\n     * Creates a function that checks if **all** of the `predicates` return\n     * truthy when invoked with the arguments it receives.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {...(Function|Function[])} [predicates=[_.identity]]\n     *  The predicates to check.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var func = _.overEvery([Boolean, isFinite]);\n     *\n     * func('1');\n     * // => true\n     *\n     * func(null);\n     * // => false\n     *\n     * func(NaN);\n     * // => false\n     */var overEvery=createOver(arrayEvery);/**\n     * Creates a function that checks if **any** of the `predicates` return\n     * truthy when invoked with the arguments it receives.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {...(Function|Function[])} [predicates=[_.identity]]\n     *  The predicates to check.\n     * @returns {Function} Returns the new function.\n     * @example\n     *\n     * var func = _.overSome([Boolean, isFinite]);\n     *\n     * func('1');\n     * // => true\n     *\n     * func(null);\n     * // => true\n     *\n     * func(NaN);\n     * // => false\n     */var overSome=createOver(arraySome);/**\n     * Creates a function that returns the value at `path` of a given object.\n     *\n     * @static\n     * @memberOf _\n     * @since 2.4.0\n     * @category Util\n     * @param {Array|string} path The path of the property to get.\n     * @returns {Function} Returns the new accessor function.\n     * @example\n     *\n     * var objects = [\n     *   { 'a': { 'b': 2 } },\n     *   { 'a': { 'b': 1 } }\n     * ];\n     *\n     * _.map(objects, _.property('a.b'));\n     * // => [2, 1]\n     *\n     * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');\n     * // => [1, 2]\n     */function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path);}/**\n     * The opposite of `_.property`; this method creates a function that returns\n     * the value at a given path of `object`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.0.0\n     * @category Util\n     * @param {Object} object The object to query.\n     * @returns {Function} Returns the new accessor function.\n     * @example\n     *\n     * var array = [0, 1, 2],\n     *     object = { 'a': array, 'b': array, 'c': array };\n     *\n     * _.map(['a[2]', 'c[0]'], _.propertyOf(object));\n     * // => [2, 0]\n     *\n     * _.map([['a', '2'], ['c', '0']], _.propertyOf(object));\n     * // => [2, 0]\n     */function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path);};}/**\n     * Creates an array of numbers (positive and/or negative) progressing from\n     * `start` up to, but not including, `end`. A step of `-1` is used if a negative\n     * `start` is specified without an `end` or `step`. If `end` is not specified,\n     * it's set to `start` with `start` then set to `0`.\n     *\n     * **Note:** JavaScript follows the IEEE-754 standard for resolving\n     * floating-point values which can produce unexpected results.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {number} [start=0] The start of the range.\n     * @param {number} end The end of the range.\n     * @param {number} [step=1] The value to increment or decrement by.\n     * @returns {Array} Returns the range of numbers.\n     * @see _.inRange, _.rangeRight\n     * @example\n     *\n     * _.range(4);\n     * // => [0, 1, 2, 3]\n     *\n     * _.range(-4);\n     * // => [0, -1, -2, -3]\n     *\n     * _.range(1, 5);\n     * // => [1, 2, 3, 4]\n     *\n     * _.range(0, 20, 5);\n     * // => [0, 5, 10, 15]\n     *\n     * _.range(0, -4, -1);\n     * // => [0, -1, -2, -3]\n     *\n     * _.range(1, 4, 0);\n     * // => [1, 1, 1]\n     *\n     * _.range(0);\n     * // => []\n     */var range=createRange();/**\n     * This method is like `_.range` except that it populates values in\n     * descending order.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {number} [start=0] The start of the range.\n     * @param {number} end The end of the range.\n     * @param {number} [step=1] The value to increment or decrement by.\n     * @returns {Array} Returns the range of numbers.\n     * @see _.inRange, _.range\n     * @example\n     *\n     * _.rangeRight(4);\n     * // => [3, 2, 1, 0]\n     *\n     * _.rangeRight(-4);\n     * // => [-3, -2, -1, 0]\n     *\n     * _.rangeRight(1, 5);\n     * // => [4, 3, 2, 1]\n     *\n     * _.rangeRight(0, 20, 5);\n     * // => [15, 10, 5, 0]\n     *\n     * _.rangeRight(0, -4, -1);\n     * // => [-3, -2, -1, 0]\n     *\n     * _.rangeRight(1, 4, 0);\n     * // => [1, 1, 1]\n     *\n     * _.rangeRight(0);\n     * // => []\n     */var rangeRight=createRange(true);/**\n     * This method returns a new empty array.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.13.0\n     * @category Util\n     * @returns {Array} Returns the new empty array.\n     * @example\n     *\n     * var arrays = _.times(2, _.stubArray);\n     *\n     * console.log(arrays);\n     * // => [[], []]\n     *\n     * console.log(arrays[0] === arrays[1]);\n     * // => false\n     */function stubArray(){return[];}/**\n     * This method returns `false`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.13.0\n     * @category Util\n     * @returns {boolean} Returns `false`.\n     * @example\n     *\n     * _.times(2, _.stubFalse);\n     * // => [false, false]\n     */function stubFalse(){return false;}/**\n     * This method returns a new empty object.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.13.0\n     * @category Util\n     * @returns {Object} Returns the new empty object.\n     * @example\n     *\n     * var objects = _.times(2, _.stubObject);\n     *\n     * console.log(objects);\n     * // => [{}, {}]\n     *\n     * console.log(objects[0] === objects[1]);\n     * // => false\n     */function stubObject(){return{};}/**\n     * This method returns an empty string.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.13.0\n     * @category Util\n     * @returns {string} Returns the empty string.\n     * @example\n     *\n     * _.times(2, _.stubString);\n     * // => ['', '']\n     */function stubString(){return'';}/**\n     * This method returns `true`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.13.0\n     * @category Util\n     * @returns {boolean} Returns `true`.\n     * @example\n     *\n     * _.times(2, _.stubTrue);\n     * // => [true, true]\n     */function stubTrue(){return true;}/**\n     * Invokes the iteratee `n` times, returning an array of the results of\n     * each invocation. The iteratee is invoked with one argument; (index).\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {number} n The number of times to invoke `iteratee`.\n     * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n     * @returns {Array} Returns the array of results.\n     * @example\n     *\n     * _.times(3, String);\n     * // => ['0', '1', '2']\n     *\n     *  _.times(4, _.constant(0));\n     * // => [0, 0, 0, 0]\n     */function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[];}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index);}return result;}/**\n     * Converts `value` to a property path array.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Util\n     * @param {*} value The value to convert.\n     * @returns {Array} Returns the new property path array.\n     * @example\n     *\n     * _.toPath('a.b.c');\n     * // => ['a', 'b', 'c']\n     *\n     * _.toPath('a[0].b.c');\n     * // => ['a', '0', 'b', 'c']\n     */function toPath(value){if(isArray(value)){return arrayMap(value,toKey);}return isSymbol(value)?[value]:copyArray(stringToPath(toString(value)));}/**\n     * Generates a unique ID. If `prefix` is given, the ID is appended to it.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Util\n     * @param {string} [prefix=''] The value to prefix the ID with.\n     * @returns {string} Returns the unique ID.\n     * @example\n     *\n     * _.uniqueId('contact_');\n     * // => 'contact_104'\n     *\n     * _.uniqueId();\n     * // => '105'\n     */function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id;}/*------------------------------------------------------------------------*//**\n     * Adds two numbers.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.4.0\n     * @category Math\n     * @param {number} augend The first number in an addition.\n     * @param {number} addend The second number in an addition.\n     * @returns {number} Returns the total.\n     * @example\n     *\n     * _.add(6, 4);\n     * // => 10\n     */var add=createMathOperation(function(augend,addend){return augend+addend;},0);/**\n     * Computes `number` rounded up to `precision`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.10.0\n     * @category Math\n     * @param {number} number The number to round up.\n     * @param {number} [precision=0] The precision to round up to.\n     * @returns {number} Returns the rounded up number.\n     * @example\n     *\n     * _.ceil(4.006);\n     * // => 5\n     *\n     * _.ceil(6.004, 2);\n     * // => 6.01\n     *\n     * _.ceil(6040, -2);\n     * // => 6100\n     */var ceil=createRound('ceil');/**\n     * Divide two numbers.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.7.0\n     * @category Math\n     * @param {number} dividend The first number in a division.\n     * @param {number} divisor The second number in a division.\n     * @returns {number} Returns the quotient.\n     * @example\n     *\n     * _.divide(6, 4);\n     * // => 1.5\n     */var divide=createMathOperation(function(dividend,divisor){return dividend/divisor;},1);/**\n     * Computes `number` rounded down to `precision`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.10.0\n     * @category Math\n     * @param {number} number The number to round down.\n     * @param {number} [precision=0] The precision to round down to.\n     * @returns {number} Returns the rounded down number.\n     * @example\n     *\n     * _.floor(4.006);\n     * // => 4\n     *\n     * _.floor(0.046, 2);\n     * // => 0.04\n     *\n     * _.floor(4060, -2);\n     * // => 4000\n     */var floor=createRound('floor');/**\n     * Computes the maximum value of `array`. If `array` is empty or falsey,\n     * `undefined` is returned.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @returns {*} Returns the maximum value.\n     * @example\n     *\n     * _.max([4, 2, 8, 6]);\n     * // => 8\n     *\n     * _.max([]);\n     * // => undefined\n     */function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined;}/**\n     * This method is like `_.max` except that it accepts `iteratee` which is\n     * invoked for each element in `array` to generate the criterion by which\n     * the value is ranked. The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {*} Returns the maximum value.\n     * @example\n     *\n     * var objects = [{ 'n': 1 }, { 'n': 2 }];\n     *\n     * _.maxBy(objects, function(o) { return o.n; });\n     * // => { 'n': 2 }\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.maxBy(objects, 'n');\n     * // => { 'n': 2 }\n     */function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined;}/**\n     * Computes the mean of the values in `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @returns {number} Returns the mean.\n     * @example\n     *\n     * _.mean([4, 2, 8, 6]);\n     * // => 5\n     */function mean(array){return baseMean(array,identity);}/**\n     * This method is like `_.mean` except that it accepts `iteratee` which is\n     * invoked for each element in `array` to generate the value to be averaged.\n     * The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.7.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {number} Returns the mean.\n     * @example\n     *\n     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];\n     *\n     * _.meanBy(objects, function(o) { return o.n; });\n     * // => 5\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.meanBy(objects, 'n');\n     * // => 5\n     */function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2));}/**\n     * Computes the minimum value of `array`. If `array` is empty or falsey,\n     * `undefined` is returned.\n     *\n     * @static\n     * @since 0.1.0\n     * @memberOf _\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @returns {*} Returns the minimum value.\n     * @example\n     *\n     * _.min([4, 2, 8, 6]);\n     * // => 2\n     *\n     * _.min([]);\n     * // => undefined\n     */function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined;}/**\n     * This method is like `_.min` except that it accepts `iteratee` which is\n     * invoked for each element in `array` to generate the criterion by which\n     * the value is ranked. The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {*} Returns the minimum value.\n     * @example\n     *\n     * var objects = [{ 'n': 1 }, { 'n': 2 }];\n     *\n     * _.minBy(objects, function(o) { return o.n; });\n     * // => { 'n': 1 }\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.minBy(objects, 'n');\n     * // => { 'n': 1 }\n     */function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined;}/**\n     * Multiply two numbers.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.7.0\n     * @category Math\n     * @param {number} multiplier The first number in a multiplication.\n     * @param {number} multiplicand The second number in a multiplication.\n     * @returns {number} Returns the product.\n     * @example\n     *\n     * _.multiply(6, 4);\n     * // => 24\n     */var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand;},1);/**\n     * Computes `number` rounded to `precision`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.10.0\n     * @category Math\n     * @param {number} number The number to round.\n     * @param {number} [precision=0] The precision to round to.\n     * @returns {number} Returns the rounded number.\n     * @example\n     *\n     * _.round(4.006);\n     * // => 4\n     *\n     * _.round(4.006, 2);\n     * // => 4.01\n     *\n     * _.round(4060, -2);\n     * // => 4100\n     */var round=createRound('round');/**\n     * Subtract two numbers.\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Math\n     * @param {number} minuend The first number in a subtraction.\n     * @param {number} subtrahend The second number in a subtraction.\n     * @returns {number} Returns the difference.\n     * @example\n     *\n     * _.subtract(6, 4);\n     * // => 2\n     */var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend;},0);/**\n     * Computes the sum of the values in `array`.\n     *\n     * @static\n     * @memberOf _\n     * @since 3.4.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @returns {number} Returns the sum.\n     * @example\n     *\n     * _.sum([4, 2, 8, 6]);\n     * // => 20\n     */function sum(array){return array&&array.length?baseSum(array,identity):0;}/**\n     * This method is like `_.sum` except that it accepts `iteratee` which is\n     * invoked for each element in `array` to generate the value to be summed.\n     * The iteratee is invoked with one argument: (value).\n     *\n     * @static\n     * @memberOf _\n     * @since 4.0.0\n     * @category Math\n     * @param {Array} array The array to iterate over.\n     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n     * @returns {number} Returns the sum.\n     * @example\n     *\n     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];\n     *\n     * _.sumBy(objects, function(o) { return o.n; });\n     * // => 20\n     *\n     * // The `_.property` iteratee shorthand.\n     * _.sumBy(objects, 'n');\n     * // => 20\n     */function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0;}/*------------------------------------------------------------------------*/// Add methods that return wrapped values in chain sequences.\nlodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;// Add aliases.\nlodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;// Add methods to `lodash.prototype`.\nmixin(lodash,lodash);/*------------------------------------------------------------------------*/// Add methods that return unwrapped values in chain sequences.\nlodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;// Add aliases.\nlodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func;}});return source;}(),{'chain':false});/*------------------------------------------------------------------------*//**\n     * The semantic version number.\n     *\n     * @static\n     * @memberOf _\n     * @type {string}\n     */lodash.VERSION=VERSION;// Assign default placeholders.\narrayEach(['bind','bindKey','curry','curryRight','partial','partialRight'],function(methodName){lodash[methodName].placeholder=lodash;});// Add `LazyWrapper` methods for `_.drop` and `_.take` variants.\narrayEach(['drop','take'],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();if(result.__filtered__){result.__takeCount__=nativeMin(n,result.__takeCount__);}else{result.__views__.push({'size':nativeMin(n,MAX_ARRAY_LENGTH),'type':methodName+(result.__dir__<0?'Right':'')});}return result;};LazyWrapper.prototype[methodName+'Right']=function(n){return this.reverse()[methodName](n).reverse();};});// Add `LazyWrapper` methods that accept an `iteratee` value.\narrayEach(['filter','map','takeWhile'],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({'iteratee':getIteratee(iteratee,3),'type':type});result.__filtered__=result.__filtered__||isFilter;return result;};});// Add `LazyWrapper` methods for `_.head` and `_.last`.\narrayEach(['head','last'],function(methodName,index){var takeName='take'+(index?'Right':'');LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0];};});// Add `LazyWrapper` methods for `_.initial` and `_.tail`.\narrayEach(['initial','tail'],function(methodName,index){var dropName='drop'+(index?'':'Right');LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1);};});LazyWrapper.prototype.compact=function(){return this.filter(identity);};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head();};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate);};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=='function'){return new LazyWrapper(this);}return this.map(function(value){return baseInvoke(value,path,args);});});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)));};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result);}if(start<0){result=result.takeRight(-start);}else if(start){result=result.drop(start);}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start);}return result;};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse();};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH);};// Add `LazyWrapper` methods to `lodash.prototype`.\nbaseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?'take'+(methodName=='last'?'Right':''):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return;}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function interceptor(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result;};if(useLazy&&checkIteratee&&typeof iteratee=='function'&&iteratee.length!=1){// Avoid lazy use if the iteratee has a \"length\" value other than `1`.\nisLazy=useLazy=false;}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({'func':thru,'args':[interceptor],'thisArg':undefined});return new LodashWrapper(result,chainAll);}if(isUnwrapped&&onlyLazy){return func.apply(this,args);}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result;};});// Add `Array` methods to `lodash.prototype`.\narrayEach(['pop','push','shift','sort','splice','unshift'],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?'tap':'thru',retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args);}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args);});};});// Map minified method names to their real names.\nbaseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+'',names=realNames[key]||(realNames[key]=[]);names.push({'name':methodName,'func':lodashFunc});}});realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{'name':'wrapper','func':undefined}];// Add methods to `LazyWrapper`.\nLazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;// Add chain sequence methods to the `lodash` wrapper.\nlodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;// Add lazy aliases.\nlodash.prototype.first=lodash.prototype.head;if(symIterator){lodash.prototype[symIterator]=wrapperToIterator;}return lodash;};/*--------------------------------------------------------------------------*/// Export lodash.\nvar _=runInContext();// Some AMD build optimizers, like r.js, check for condition patterns like:\nif(\"function\"=='function'&&_typeof(__webpack_require__(81))=='object'&&__webpack_require__(81)){// Expose Lodash on the global object to prevent errors when Lodash is\n// loaded by a script tag in the presence of an AMD loader.\n// See http://requirejs.org/docs/errors.html#mismatch for more details.\n// Use `_.noConflict` to remove Lodash from the global object.\nroot._=_;// Define as an anonymous module so, through path mapping, it can be\n// referenced as the \"underscore\" module.\n!(__WEBPACK_AMD_DEFINE_RESULT__ = function(){return _;}.call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));}// Check for `exports` after `define` in case a build optimizer adds it.\nelse if(freeModule){// Export for Node.js.\n(freeModule.exports=_)._=_;// Export for CommonJS support.\nfreeExports._=_;}else{// Export to the global object.\nroot._=_;}}).call(undefined);\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(189)(module)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvbGliL2xvZGFzaC5qcz85N2M4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIExvZGFzaCA8aHR0cHM6Ly9sb2Rhc2guY29tLz5cbiAqIENvcHlyaWdodCBKUyBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanMuZm91bmRhdGlvbi8+XG4gKiBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZSA8aHR0cHM6Ly9sb2Rhc2guY29tL2xpY2Vuc2U+XG4gKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuOC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZy9MSUNFTlNFPlxuICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzXG4gKi9cbjsoZnVuY3Rpb24oKSB7XG5cbiAgLyoqIFVzZWQgYXMgYSBzYWZlIHJlZmVyZW5jZSBmb3IgYHVuZGVmaW5lZGAgaW4gcHJlLUVTNSBlbnZpcm9ubWVudHMuICovXG4gIHZhciB1bmRlZmluZWQ7XG5cbiAgLyoqIFVzZWQgYXMgdGhlIHNlbWFudGljIHZlcnNpb24gbnVtYmVyLiAqL1xuICB2YXIgVkVSU0lPTiA9ICc0LjE3LjQnO1xuXG4gIC8qKiBVc2VkIGFzIHRoZSBzaXplIHRvIGVuYWJsZSBsYXJnZSBhcnJheSBvcHRpbWl6YXRpb25zLiAqL1xuICB2YXIgTEFSR0VfQVJSQVlfU0laRSA9IDIwMDtcblxuICAvKiogRXJyb3IgbWVzc2FnZSBjb25zdGFudHMuICovXG4gIHZhciBDT1JFX0VSUk9SX1RFWFQgPSAnVW5zdXBwb3J0ZWQgY29yZS1qcyB1c2UuIFRyeSBodHRwczovL25wbXMuaW8vc2VhcmNoP3E9cG9ueWZpbGwuJyxcbiAgICAgIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJztcblxuICAvKiogVXNlZCB0byBzdGFuZC1pbiBmb3IgYHVuZGVmaW5lZGAgaGFzaCB2YWx1ZXMuICovXG4gIHZhciBIQVNIX1VOREVGSU5FRCA9ICdfX2xvZGFzaF9oYXNoX3VuZGVmaW5lZF9fJztcblxuICAvKiogVXNlZCBhcyB0aGUgbWF4aW11bSBtZW1vaXplIGNhY2hlIHNpemUuICovXG4gIHZhciBNQVhfTUVNT0laRV9TSVpFID0gNTAwO1xuXG4gIC8qKiBVc2VkIGFzIHRoZSBpbnRlcm5hbCBhcmd1bWVudCBwbGFjZWhvbGRlci4gKi9cbiAgdmFyIFBMQUNFSE9MREVSID0gJ19fbG9kYXNoX3BsYWNlaG9sZGVyX18nO1xuXG4gIC8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIGNsb25pbmcuICovXG4gIHZhciBDTE9ORV9ERUVQX0ZMQUcgPSAxLFxuICAgICAgQ0xPTkVfRkxBVF9GTEFHID0gMixcbiAgICAgIENMT05FX1NZTUJPTFNfRkxBRyA9IDQ7XG5cbiAgLyoqIFVzZWQgdG8gY29tcG9zZSBiaXRtYXNrcyBmb3IgdmFsdWUgY29tcGFyaXNvbnMuICovXG4gIHZhciBDT01QQVJFX1BBUlRJQUxfRkxBRyA9IDEsXG4gICAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjtcblxuICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciBmdW5jdGlvbiBtZXRhZGF0YS4gKi9cbiAgdmFyIFdSQVBfQklORF9GTEFHID0gMSxcbiAgICAgIFdSQVBfQklORF9LRVlfRkxBRyA9IDIsXG4gICAgICBXUkFQX0NVUlJZX0JPVU5EX0ZMQUcgPSA0LFxuICAgICAgV1JBUF9DVVJSWV9GTEFHID0gOCxcbiAgICAgIFdSQVBfQ1VSUllfUklHSFRfRkxBRyA9IDE2LFxuICAgICAgV1JBUF9QQVJUSUFMX0ZMQUcgPSAzMixcbiAgICAgIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHID0gNjQsXG4gICAgICBXUkFQX0FSWV9GTEFHID0gMTI4LFxuICAgICAgV1JBUF9SRUFSR19GTEFHID0gMjU2LFxuICAgICAgV1JBUF9GTElQX0ZMQUcgPSA1MTI7XG5cbiAgLyoqIFVzZWQgYXMgZGVmYXVsdCBvcHRpb25zIGZvciBgXy50cnVuY2F0ZWAuICovXG4gIHZhciBERUZBVUxUX1RSVU5DX0xFTkdUSCA9IDMwLFxuICAgICAgREVGQVVMVF9UUlVOQ19PTUlTU0lPTiA9ICcuLi4nO1xuXG4gIC8qKiBVc2VkIHRvIGRldGVjdCBob3QgZnVuY3Rpb25zIGJ5IG51bWJlciBvZiBjYWxscyB3aXRoaW4gYSBzcGFuIG9mIG1pbGxpc2Vjb25kcy4gKi9cbiAgdmFyIEhPVF9DT1VOVCA9IDgwMCxcbiAgICAgIEhPVF9TUEFOID0gMTY7XG5cbiAgLyoqIFVzZWQgdG8gaW5kaWNhdGUgdGhlIHR5cGUgb2YgbGF6eSBpdGVyYXRlZXMuICovXG4gIHZhciBMQVpZX0ZJTFRFUl9GTEFHID0gMSxcbiAgICAgIExBWllfTUFQX0ZMQUcgPSAyLFxuICAgICAgTEFaWV9XSElMRV9GTEFHID0gMztcblxuICAvKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB2YXJpb3VzIGBOdW1iZXJgIGNvbnN0YW50cy4gKi9cbiAgdmFyIElORklOSVRZID0gMSAvIDAsXG4gICAgICBNQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MSxcbiAgICAgIE1BWF9JTlRFR0VSID0gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDgsXG4gICAgICBOQU4gPSAwIC8gMDtcblxuICAvKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB0aGUgbWF4aW11bSBsZW5ndGggYW5kIGluZGV4IG9mIGFuIGFycmF5LiAqL1xuICB2YXIgTUFYX0FSUkFZX0xFTkdUSCA9IDQyOTQ5NjcyOTUsXG4gICAgICBNQVhfQVJSQVlfSU5ERVggPSBNQVhfQVJSQVlfTEVOR1RIIC0gMSxcbiAgICAgIEhBTEZfTUFYX0FSUkFZX0xFTkdUSCA9IE1BWF9BUlJBWV9MRU5HVEggPj4+IDE7XG5cbiAgLyoqIFVzZWQgdG8gYXNzb2NpYXRlIHdyYXAgbWV0aG9kcyB3aXRoIHRoZWlyIGJpdCBmbGFncy4gKi9cbiAgdmFyIHdyYXBGbGFncyA9IFtcbiAgICBbJ2FyeScsIFdSQVBfQVJZX0ZMQUddLFxuICAgIFsnYmluZCcsIFdSQVBfQklORF9GTEFHXSxcbiAgICBbJ2JpbmRLZXknLCBXUkFQX0JJTkRfS0VZX0ZMQUddLFxuICAgIFsnY3VycnknLCBXUkFQX0NVUlJZX0ZMQUddLFxuICAgIFsnY3VycnlSaWdodCcsIFdSQVBfQ1VSUllfUklHSFRfRkxBR10sXG4gICAgWydmbGlwJywgV1JBUF9GTElQX0ZMQUddLFxuICAgIFsncGFydGlhbCcsIFdSQVBfUEFSVElBTF9GTEFHXSxcbiAgICBbJ3BhcnRpYWxSaWdodCcsIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHXSxcbiAgICBbJ3JlYXJnJywgV1JBUF9SRUFSR19GTEFHXVxuICBdO1xuXG4gIC8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi9cbiAgdmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJyxcbiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJyxcbiAgICAgIGFzeW5jVGFnID0gJ1tvYmplY3QgQXN5bmNGdW5jdGlvbl0nLFxuICAgICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJyxcbiAgICAgIGRhdGVUYWcgPSAnW29iamVjdCBEYXRlXScsXG4gICAgICBkb21FeGNUYWcgPSAnW29iamVjdCBET01FeGNlcHRpb25dJyxcbiAgICAgIGVycm9yVGFnID0gJ1tvYmplY3QgRXJyb3JdJyxcbiAgICAgIGZ1bmNUYWcgPSAnW29iamVjdCBGdW5jdGlvbl0nLFxuICAgICAgZ2VuVGFnID0gJ1tvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dJyxcbiAgICAgIG1hcFRhZyA9ICdbb2JqZWN0IE1hcF0nLFxuICAgICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsXG4gICAgICBudWxsVGFnID0gJ1tvYmplY3QgTnVsbF0nLFxuICAgICAgb2JqZWN0VGFnID0gJ1tvYmplY3QgT2JqZWN0XScsXG4gICAgICBwcm9taXNlVGFnID0gJ1tvYmplY3QgUHJvbWlzZV0nLFxuICAgICAgcHJveHlUYWcgPSAnW29iamVjdCBQcm94eV0nLFxuICAgICAgcmVnZXhwVGFnID0gJ1tvYmplY3QgUmVnRXhwXScsXG4gICAgICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJyxcbiAgICAgIHN0cmluZ1RhZyA9ICdbb2JqZWN0IFN0cmluZ10nLFxuICAgICAgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXScsXG4gICAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJyxcbiAgICAgIHdlYWtNYXBUYWcgPSAnW29iamVjdCBXZWFrTWFwXScsXG4gICAgICB3ZWFrU2V0VGFnID0gJ1tvYmplY3QgV2Vha1NldF0nO1xuXG4gIHZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsXG4gICAgICBkYXRhVmlld1RhZyA9ICdbb2JqZWN0IERhdGFWaWV3XScsXG4gICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsXG4gICAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsXG4gICAgICBpbnQ4VGFnID0gJ1tvYmplY3QgSW50OEFycmF5XScsXG4gICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJyxcbiAgICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLFxuICAgICAgdWludDhUYWcgPSAnW29iamVjdCBVaW50OEFycmF5XScsXG4gICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLFxuICAgICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJyxcbiAgICAgIHVpbnQzMlRhZyA9ICdbb2JqZWN0IFVpbnQzMkFycmF5XSc7XG5cbiAgLyoqIFVzZWQgdG8gbWF0Y2ggZW1wdHkgc3RyaW5nIGxpdGVyYWxzIGluIGNvbXBpbGVkIHRlbXBsYXRlIHNvdXJjZS4gKi9cbiAgdmFyIHJlRW1wdHlTdHJpbmdMZWFkaW5nID0gL1xcYl9fcCBcXCs9ICcnOy9nLFxuICAgICAgcmVFbXB0eVN0cmluZ01pZGRsZSA9IC9cXGIoX19wIFxcKz0pICcnIFxcKy9nLFxuICAgICAgcmVFbXB0eVN0cmluZ1RyYWlsaW5nID0gLyhfX2VcXCguKj9cXCl8XFxiX190XFwpKSBcXCtcXG4nJzsvZztcblxuICAvKiogVXNlZCB0byBtYXRjaCBIVE1MIGVudGl0aWVzIGFuZCBIVE1MIGNoYXJhY3RlcnMuICovXG4gIHZhciByZUVzY2FwZWRIdG1sID0gLyYoPzphbXB8bHR8Z3R8cXVvdHwjMzkpOy9nLFxuICAgICAgcmVVbmVzY2FwZWRIdG1sID0gL1smPD5cIiddL2csXG4gICAgICByZUhhc0VzY2FwZWRIdG1sID0gUmVnRXhwKHJlRXNjYXBlZEh0bWwuc291cmNlKSxcbiAgICAgIHJlSGFzVW5lc2NhcGVkSHRtbCA9IFJlZ0V4cChyZVVuZXNjYXBlZEh0bWwuc291cmNlKTtcblxuICAvKiogVXNlZCB0byBtYXRjaCB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLiAqL1xuICB2YXIgcmVFc2NhcGUgPSAvPCUtKFtcXHNcXFNdKz8pJT4vZyxcbiAgICAgIHJlRXZhbHVhdGUgPSAvPCUoW1xcc1xcU10rPyklPi9nLFxuICAgICAgcmVJbnRlcnBvbGF0ZSA9IC88JT0oW1xcc1xcU10rPyklPi9nO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIHByb3BlcnR5IG5hbWVzIHdpdGhpbiBwcm9wZXJ0eSBwYXRocy4gKi9cbiAgdmFyIHJlSXNEZWVwUHJvcCA9IC9cXC58XFxbKD86W15bXFxdXSp8KFtcIiddKSg/Oig/IVxcMSlbXlxcXFxdfFxcXFwuKSo/XFwxKVxcXS8sXG4gICAgICByZUlzUGxhaW5Qcm9wID0gL15cXHcqJC8sXG4gICAgICByZUxlYWRpbmdEb3QgPSAvXlxcLi8sXG4gICAgICByZVByb3BOYW1lID0gL1teLltcXF1dK3xcXFsoPzooLT9cXGQrKD86XFwuXFxkKyk/KXwoW1wiJ10pKCg/Oig/IVxcMilbXlxcXFxdfFxcXFwuKSo/KVxcMilcXF18KD89KD86XFwufFxcW1xcXSkoPzpcXC58XFxbXFxdfCQpKS9nO1xuXG4gIC8qKlxuICAgKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgXG4gICAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLlxuICAgKi9cbiAgdmFyIHJlUmVnRXhwQ2hhciA9IC9bXFxcXF4kLiorPygpW1xcXXt9fF0vZyxcbiAgICAgIHJlSGFzUmVnRXhwQ2hhciA9IFJlZ0V4cChyZVJlZ0V4cENoYXIuc291cmNlKTtcblxuICAvKiogVXNlZCB0byBtYXRjaCBsZWFkaW5nIGFuZCB0cmFpbGluZyB3aGl0ZXNwYWNlLiAqL1xuICB2YXIgcmVUcmltID0gL15cXHMrfFxccyskL2csXG4gICAgICByZVRyaW1TdGFydCA9IC9eXFxzKy8sXG4gICAgICByZVRyaW1FbmQgPSAvXFxzKyQvO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIHdyYXAgZGV0YWlsIGNvbW1lbnRzLiAqL1xuICB2YXIgcmVXcmFwQ29tbWVudCA9IC9cXHsoPzpcXG5cXC9cXCogXFxbd3JhcHBlZCB3aXRoIC4rXFxdIFxcKlxcLyk/XFxuPy8sXG4gICAgICByZVdyYXBEZXRhaWxzID0gL1xce1xcblxcL1xcKiBcXFt3cmFwcGVkIHdpdGggKC4rKVxcXSBcXCovLFxuICAgICAgcmVTcGxpdERldGFpbHMgPSAvLD8gJiAvO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIHdvcmRzIGNvbXBvc2VkIG9mIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzLiAqL1xuICB2YXIgcmVBc2NpaVdvcmQgPSAvW15cXHgwMC1cXHgyZlxceDNhLVxceDQwXFx4NWItXFx4NjBcXHg3Yi1cXHg3Zl0rL2c7XG5cbiAgLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovXG4gIHZhciByZUVzY2FwZUNoYXIgPSAvXFxcXChcXFxcKT8vZztcblxuICAvKipcbiAgICogVXNlZCB0byBtYXRjaFxuICAgKiBbRVMgdGVtcGxhdGUgZGVsaW1pdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdGVtcGxhdGUtbGl0ZXJhbC1sZXhpY2FsLWNvbXBvbmVudHMpLlxuICAgKi9cbiAgdmFyIHJlRXNUZW1wbGF0ZSA9IC9cXCRcXHsoW15cXFxcfV0qKD86XFxcXC5bXlxcXFx9XSopKilcXH0vZztcblxuICAvKiogVXNlZCB0byBtYXRjaCBgUmVnRXhwYCBmbGFncyBmcm9tIHRoZWlyIGNvZXJjZWQgc3RyaW5nIHZhbHVlcy4gKi9cbiAgdmFyIHJlRmxhZ3MgPSAvXFx3KiQvO1xuXG4gIC8qKiBVc2VkIHRvIGRldGVjdCBiYWQgc2lnbmVkIGhleGFkZWNpbWFsIHN0cmluZyB2YWx1ZXMuICovXG4gIHZhciByZUlzQmFkSGV4ID0gL15bLStdMHhbMC05YS1mXSskL2k7XG5cbiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGJpbmFyeSBzdHJpbmcgdmFsdWVzLiAqL1xuICB2YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTtcblxuICAvKiogVXNlZCB0byBkZXRlY3QgaG9zdCBjb25zdHJ1Y3RvcnMgKFNhZmFyaSkuICovXG4gIHZhciByZUlzSG9zdEN0b3IgPSAvXlxcW29iamVjdCAuKz9Db25zdHJ1Y3RvclxcXSQvO1xuXG4gIC8qKiBVc2VkIHRvIGRldGVjdCBvY3RhbCBzdHJpbmcgdmFsdWVzLiAqL1xuICB2YXIgcmVJc09jdGFsID0gL14wb1swLTddKyQvaTtcblxuICAvKiogVXNlZCB0byBkZXRlY3QgdW5zaWduZWQgaW50ZWdlciB2YWx1ZXMuICovXG4gIHZhciByZUlzVWludCA9IC9eKD86MHxbMS05XVxcZCopJC87XG5cbiAgLyoqIFVzZWQgdG8gbWF0Y2ggTGF0aW4gVW5pY29kZSBsZXR0ZXJzIChleGNsdWRpbmcgbWF0aGVtYXRpY2FsIG9wZXJhdG9ycykuICovXG4gIHZhciByZUxhdGluID0gL1tcXHhjMC1cXHhkNlxceGQ4LVxceGY2XFx4ZjgtXFx4ZmZcXHUwMTAwLVxcdTAxN2ZdL2c7XG5cbiAgLyoqIFVzZWQgdG8gZW5zdXJlIGNhcHR1cmluZyBvcmRlciBvZiB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLiAqL1xuICB2YXIgcmVOb01hdGNoID0gLygkXikvO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIHVuZXNjYXBlZCBjaGFyYWN0ZXJzIGluIGNvbXBpbGVkIHN0cmluZyBsaXRlcmFscy4gKi9cbiAgdmFyIHJlVW5lc2NhcGVkU3RyaW5nID0gL1snXFxuXFxyXFx1MjAyOFxcdTIwMjlcXFxcXS9nO1xuXG4gIC8qKiBVc2VkIHRvIGNvbXBvc2UgdW5pY29kZSBjaGFyYWN0ZXIgY2xhc3Nlcy4gKi9cbiAgdmFyIHJzQXN0cmFsUmFuZ2UgPSAnXFxcXHVkODAwLVxcXFx1ZGZmZicsXG4gICAgICByc0NvbWJvTWFya3NSYW5nZSA9ICdcXFxcdTAzMDAtXFxcXHUwMzZmJyxcbiAgICAgIHJlQ29tYm9IYWxmTWFya3NSYW5nZSA9ICdcXFxcdWZlMjAtXFxcXHVmZTJmJyxcbiAgICAgIHJzQ29tYm9TeW1ib2xzUmFuZ2UgPSAnXFxcXHUyMGQwLVxcXFx1MjBmZicsXG4gICAgICByc0NvbWJvUmFuZ2UgPSByc0NvbWJvTWFya3NSYW5nZSArIHJlQ29tYm9IYWxmTWFya3NSYW5nZSArIHJzQ29tYm9TeW1ib2xzUmFuZ2UsXG4gICAgICByc0RpbmdiYXRSYW5nZSA9ICdcXFxcdTI3MDAtXFxcXHUyN2JmJyxcbiAgICAgIHJzTG93ZXJSYW5nZSA9ICdhLXpcXFxceGRmLVxcXFx4ZjZcXFxceGY4LVxcXFx4ZmYnLFxuICAgICAgcnNNYXRoT3BSYW5nZSA9ICdcXFxceGFjXFxcXHhiMVxcXFx4ZDdcXFxceGY3JyxcbiAgICAgIHJzTm9uQ2hhclJhbmdlID0gJ1xcXFx4MDAtXFxcXHgyZlxcXFx4M2EtXFxcXHg0MFxcXFx4NWItXFxcXHg2MFxcXFx4N2ItXFxcXHhiZicsXG4gICAgICByc1B1bmN0dWF0aW9uUmFuZ2UgPSAnXFxcXHUyMDAwLVxcXFx1MjA2ZicsXG4gICAgICByc1NwYWNlUmFuZ2UgPSAnIFxcXFx0XFxcXHgwYlxcXFxmXFxcXHhhMFxcXFx1ZmVmZlxcXFxuXFxcXHJcXFxcdTIwMjhcXFxcdTIwMjlcXFxcdTE2ODBcXFxcdTE4MGVcXFxcdTIwMDBcXFxcdTIwMDFcXFxcdTIwMDJcXFxcdTIwMDNcXFxcdTIwMDRcXFxcdTIwMDVcXFxcdTIwMDZcXFxcdTIwMDdcXFxcdTIwMDhcXFxcdTIwMDlcXFxcdTIwMGFcXFxcdTIwMmZcXFxcdTIwNWZcXFxcdTMwMDAnLFxuICAgICAgcnNVcHBlclJhbmdlID0gJ0EtWlxcXFx4YzAtXFxcXHhkNlxcXFx4ZDgtXFxcXHhkZScsXG4gICAgICByc1ZhclJhbmdlID0gJ1xcXFx1ZmUwZVxcXFx1ZmUwZicsXG4gICAgICByc0JyZWFrUmFuZ2UgPSByc01hdGhPcFJhbmdlICsgcnNOb25DaGFyUmFuZ2UgKyByc1B1bmN0dWF0aW9uUmFuZ2UgKyByc1NwYWNlUmFuZ2U7XG5cbiAgLyoqIFVzZWQgdG8gY29tcG9zZSB1bmljb2RlIGNhcHR1cmUgZ3JvdXBzLiAqL1xuICB2YXIgcnNBcG9zID0gXCJbJ1xcdTIwMTldXCIsXG4gICAgICByc0FzdHJhbCA9ICdbJyArIHJzQXN0cmFsUmFuZ2UgKyAnXScsXG4gICAgICByc0JyZWFrID0gJ1snICsgcnNCcmVha1JhbmdlICsgJ10nLFxuICAgICAgcnNDb21ibyA9ICdbJyArIHJzQ29tYm9SYW5nZSArICddJyxcbiAgICAgIHJzRGlnaXRzID0gJ1xcXFxkKycsXG4gICAgICByc0RpbmdiYXQgPSAnWycgKyByc0RpbmdiYXRSYW5nZSArICddJyxcbiAgICAgIHJzTG93ZXIgPSAnWycgKyByc0xvd2VyUmFuZ2UgKyAnXScsXG4gICAgICByc01pc2MgPSAnW14nICsgcnNBc3RyYWxSYW5nZSArIHJzQnJlYWtSYW5nZSArIHJzRGlnaXRzICsgcnNEaW5nYmF0UmFuZ2UgKyByc0xvd2VyUmFuZ2UgKyByc1VwcGVyUmFuZ2UgKyAnXScsXG4gICAgICByc0ZpdHogPSAnXFxcXHVkODNjW1xcXFx1ZGZmYi1cXFxcdWRmZmZdJyxcbiAgICAgIHJzTW9kaWZpZXIgPSAnKD86JyArIHJzQ29tYm8gKyAnfCcgKyByc0ZpdHogKyAnKScsXG4gICAgICByc05vbkFzdHJhbCA9ICdbXicgKyByc0FzdHJhbFJhbmdlICsgJ10nLFxuICAgICAgcnNSZWdpb25hbCA9ICcoPzpcXFxcdWQ4M2NbXFxcXHVkZGU2LVxcXFx1ZGRmZl0pezJ9JyxcbiAgICAgIHJzU3VyclBhaXIgPSAnW1xcXFx1ZDgwMC1cXFxcdWRiZmZdW1xcXFx1ZGMwMC1cXFxcdWRmZmZdJyxcbiAgICAgIHJzVXBwZXIgPSAnWycgKyByc1VwcGVyUmFuZ2UgKyAnXScsXG4gICAgICByc1pXSiA9ICdcXFxcdTIwMGQnO1xuXG4gIC8qKiBVc2VkIHRvIGNvbXBvc2UgdW5pY29kZSByZWdleGVzLiAqL1xuICB2YXIgcnNNaXNjTG93ZXIgPSAnKD86JyArIHJzTG93ZXIgKyAnfCcgKyByc01pc2MgKyAnKScsXG4gICAgICByc01pc2NVcHBlciA9ICcoPzonICsgcnNVcHBlciArICd8JyArIHJzTWlzYyArICcpJyxcbiAgICAgIHJzT3B0Q29udHJMb3dlciA9ICcoPzonICsgcnNBcG9zICsgJyg/OmR8bGx8bXxyZXxzfHR8dmUpKT8nLFxuICAgICAgcnNPcHRDb250clVwcGVyID0gJyg/OicgKyByc0Fwb3MgKyAnKD86RHxMTHxNfFJFfFN8VHxWRSkpPycsXG4gICAgICByZU9wdE1vZCA9IHJzTW9kaWZpZXIgKyAnPycsXG4gICAgICByc09wdFZhciA9ICdbJyArIHJzVmFyUmFuZ2UgKyAnXT8nLFxuICAgICAgcnNPcHRKb2luID0gJyg/OicgKyByc1pXSiArICcoPzonICsgW3JzTm9uQXN0cmFsLCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyXS5qb2luKCd8JykgKyAnKScgKyByc09wdFZhciArIHJlT3B0TW9kICsgJykqJyxcbiAgICAgIHJzT3JkTG93ZXIgPSAnXFxcXGQqKD86KD86MXN0fDJuZHwzcmR8KD8hWzEyM10pXFxcXGR0aClcXFxcYiknLFxuICAgICAgcnNPcmRVcHBlciA9ICdcXFxcZCooPzooPzoxU1R8Mk5EfDNSRHwoPyFbMTIzXSlcXFxcZFRIKVxcXFxiKScsXG4gICAgICByc1NlcSA9IHJzT3B0VmFyICsgcmVPcHRNb2QgKyByc09wdEpvaW4sXG4gICAgICByc0Vtb2ppID0gJyg/OicgKyBbcnNEaW5nYmF0LCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyXS5qb2luKCd8JykgKyAnKScgKyByc1NlcSxcbiAgICAgIHJzU3ltYm9sID0gJyg/OicgKyBbcnNOb25Bc3RyYWwgKyByc0NvbWJvICsgJz8nLCByc0NvbWJvLCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyLCByc0FzdHJhbF0uam9pbignfCcpICsgJyknO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIGFwb3N0cm9waGVzLiAqL1xuICB2YXIgcmVBcG9zID0gUmVnRXhwKHJzQXBvcywgJ2cnKTtcblxuICAvKipcbiAgICogVXNlZCB0byBtYXRjaCBbY29tYmluaW5nIGRpYWNyaXRpY2FsIG1hcmtzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db21iaW5pbmdfRGlhY3JpdGljYWxfTWFya3MpIGFuZFxuICAgKiBbY29tYmluaW5nIGRpYWNyaXRpY2FsIG1hcmtzIGZvciBzeW1ib2xzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db21iaW5pbmdfRGlhY3JpdGljYWxfTWFya3NfZm9yX1N5bWJvbHMpLlxuICAgKi9cbiAgdmFyIHJlQ29tYm9NYXJrID0gUmVnRXhwKHJzQ29tYm8sICdnJyk7XG5cbiAgLyoqIFVzZWQgdG8gbWF0Y2ggW3N0cmluZyBzeW1ib2xzXShodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC11bmljb2RlKS4gKi9cbiAgdmFyIHJlVW5pY29kZSA9IFJlZ0V4cChyc0ZpdHogKyAnKD89JyArIHJzRml0eiArICcpfCcgKyByc1N5bWJvbCArIHJzU2VxLCAnZycpO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIGNvbXBsZXggb3IgY29tcG91bmQgd29yZHMuICovXG4gIHZhciByZVVuaWNvZGVXb3JkID0gUmVnRXhwKFtcbiAgICByc1VwcGVyICsgJz8nICsgcnNMb3dlciArICcrJyArIHJzT3B0Q29udHJMb3dlciArICcoPz0nICsgW3JzQnJlYWssIHJzVXBwZXIsICckJ10uam9pbignfCcpICsgJyknLFxuICAgIHJzTWlzY1VwcGVyICsgJysnICsgcnNPcHRDb250clVwcGVyICsgJyg/PScgKyBbcnNCcmVhaywgcnNVcHBlciArIHJzTWlzY0xvd2VyLCAnJCddLmpvaW4oJ3wnKSArICcpJyxcbiAgICByc1VwcGVyICsgJz8nICsgcnNNaXNjTG93ZXIgKyAnKycgKyByc09wdENvbnRyTG93ZXIsXG4gICAgcnNVcHBlciArICcrJyArIHJzT3B0Q29udHJVcHBlcixcbiAgICByc09yZFVwcGVyLFxuICAgIHJzT3JkTG93ZXIsXG4gICAgcnNEaWdpdHMsXG4gICAgcnNFbW9qaVxuICBdLmpvaW4oJ3wnKSwgJ2cnKTtcblxuICAvKiogVXNlZCB0byBkZXRlY3Qgc3RyaW5ncyB3aXRoIFt6ZXJvLXdpZHRoIGpvaW5lcnMgb3IgY29kZSBwb2ludHMgZnJvbSB0aGUgYXN0cmFsIHBsYW5lc10oaHR0cDovL2Vldi5lZS9ibG9nLzIwMTUvMDkvMTIvZGFyay1jb3JuZXJzLW9mLXVuaWNvZGUvKS4gKi9cbiAgdmFyIHJlSGFzVW5pY29kZSA9IFJlZ0V4cCgnWycgKyByc1pXSiArIHJzQXN0cmFsUmFuZ2UgICsgcnNDb21ib1JhbmdlICsgcnNWYXJSYW5nZSArICddJyk7XG5cbiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHN0cmluZ3MgdGhhdCBuZWVkIGEgbW9yZSByb2J1c3QgcmVnZXhwIHRvIG1hdGNoIHdvcmRzLiAqL1xuICB2YXIgcmVIYXNVbmljb2RlV29yZCA9IC9bYS16XVtBLVpdfFtBLVpdezIsfVthLXpdfFswLTldW2EtekEtWl18W2EtekEtWl1bMC05XXxbXmEtekEtWjAtOSBdLztcblxuICAvKiogVXNlZCB0byBhc3NpZ24gZGVmYXVsdCBgY29udGV4dGAgb2JqZWN0IHByb3BlcnRpZXMuICovXG4gIHZhciBjb250ZXh0UHJvcHMgPSBbXG4gICAgJ0FycmF5JywgJ0J1ZmZlcicsICdEYXRhVmlldycsICdEYXRlJywgJ0Vycm9yJywgJ0Zsb2F0MzJBcnJheScsICdGbG9hdDY0QXJyYXknLFxuICAgICdGdW5jdGlvbicsICdJbnQ4QXJyYXknLCAnSW50MTZBcnJheScsICdJbnQzMkFycmF5JywgJ01hcCcsICdNYXRoJywgJ09iamVjdCcsXG4gICAgJ1Byb21pc2UnLCAnUmVnRXhwJywgJ1NldCcsICdTdHJpbmcnLCAnU3ltYm9sJywgJ1R5cGVFcnJvcicsICdVaW50OEFycmF5JyxcbiAgICAnVWludDhDbGFtcGVkQXJyYXknLCAnVWludDE2QXJyYXknLCAnVWludDMyQXJyYXknLCAnV2Vha01hcCcsXG4gICAgJ18nLCAnY2xlYXJUaW1lb3V0JywgJ2lzRmluaXRlJywgJ3BhcnNlSW50JywgJ3NldFRpbWVvdXQnXG4gIF07XG5cbiAgLyoqIFVzZWQgdG8gbWFrZSB0ZW1wbGF0ZSBzb3VyY2VVUkxzIGVhc2llciB0byBpZGVudGlmeS4gKi9cbiAgdmFyIHRlbXBsYXRlQ291bnRlciA9IC0xO1xuXG4gIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi9cbiAgdmFyIHR5cGVkQXJyYXlUYWdzID0ge307XG4gIHR5cGVkQXJyYXlUYWdzW2Zsb2F0MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbZmxvYXQ2NFRhZ10gPVxuICB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9XG4gIHR5cGVkQXJyYXlUYWdzW2ludDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4VGFnXSA9XG4gIHR5cGVkQXJyYXlUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50MTZUYWddID1cbiAgdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7XG4gIHR5cGVkQXJyYXlUYWdzW2FyZ3NUYWddID0gdHlwZWRBcnJheVRhZ3NbYXJyYXlUYWddID1cbiAgdHlwZWRBcnJheVRhZ3NbYXJyYXlCdWZmZXJUYWddID0gdHlwZWRBcnJheVRhZ3NbYm9vbFRhZ10gPVxuICB0eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9XG4gIHR5cGVkQXJyYXlUYWdzW2Vycm9yVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Z1bmNUYWddID1cbiAgdHlwZWRBcnJheVRhZ3NbbWFwVGFnXSA9IHR5cGVkQXJyYXlUYWdzW251bWJlclRhZ10gPVxuICB0eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9XG4gIHR5cGVkQXJyYXlUYWdzW3NldFRhZ10gPSB0eXBlZEFycmF5VGFnc1tzdHJpbmdUYWddID1cbiAgdHlwZWRBcnJheVRhZ3Nbd2Vha01hcFRhZ10gPSBmYWxzZTtcblxuICAvKiogVXNlZCB0byBpZGVudGlmeSBgdG9TdHJpbmdUYWdgIHZhbHVlcyBzdXBwb3J0ZWQgYnkgYF8uY2xvbmVgLiAqL1xuICB2YXIgY2xvbmVhYmxlVGFncyA9IHt9O1xuICBjbG9uZWFibGVUYWdzW2FyZ3NUYWddID0gY2xvbmVhYmxlVGFnc1thcnJheVRhZ10gPVxuICBjbG9uZWFibGVUYWdzW2FycmF5QnVmZmVyVGFnXSA9IGNsb25lYWJsZVRhZ3NbZGF0YVZpZXdUYWddID1cbiAgY2xvbmVhYmxlVGFnc1tib29sVGFnXSA9IGNsb25lYWJsZVRhZ3NbZGF0ZVRhZ10gPVxuICBjbG9uZWFibGVUYWdzW2Zsb2F0MzJUYWddID0gY2xvbmVhYmxlVGFnc1tmbG9hdDY0VGFnXSA9XG4gIGNsb25lYWJsZVRhZ3NbaW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW2ludDE2VGFnXSA9XG4gIGNsb25lYWJsZVRhZ3NbaW50MzJUYWddID0gY2xvbmVhYmxlVGFnc1ttYXBUYWddID1cbiAgY2xvbmVhYmxlVGFnc1tudW1iZXJUYWddID0gY2xvbmVhYmxlVGFnc1tvYmplY3RUYWddID1cbiAgY2xvbmVhYmxlVGFnc1tyZWdleHBUYWddID0gY2xvbmVhYmxlVGFnc1tzZXRUYWddID1cbiAgY2xvbmVhYmxlVGFnc1tzdHJpbmdUYWddID0gY2xvbmVhYmxlVGFnc1tzeW1ib2xUYWddID1cbiAgY2xvbmVhYmxlVGFnc1t1aW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPVxuICBjbG9uZWFibGVUYWdzW3VpbnQxNlRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQzMlRhZ10gPSB0cnVlO1xuICBjbG9uZWFibGVUYWdzW2Vycm9yVGFnXSA9IGNsb25lYWJsZVRhZ3NbZnVuY1RhZ10gPVxuICBjbG9uZWFibGVUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7XG5cbiAgLyoqIFVzZWQgdG8gbWFwIExhdGluIFVuaWNvZGUgbGV0dGVycyB0byBiYXNpYyBMYXRpbiBsZXR0ZXJzLiAqL1xuICB2YXIgZGVidXJyZWRMZXR0ZXJzID0ge1xuICAgIC8vIExhdGluLTEgU3VwcGxlbWVudCBibG9jay5cbiAgICAnXFx4YzAnOiAnQScsICAnXFx4YzEnOiAnQScsICdcXHhjMic6ICdBJywgJ1xceGMzJzogJ0EnLCAnXFx4YzQnOiAnQScsICdcXHhjNSc6ICdBJyxcbiAgICAnXFx4ZTAnOiAnYScsICAnXFx4ZTEnOiAnYScsICdcXHhlMic6ICdhJywgJ1xceGUzJzogJ2EnLCAnXFx4ZTQnOiAnYScsICdcXHhlNSc6ICdhJyxcbiAgICAnXFx4YzcnOiAnQycsICAnXFx4ZTcnOiAnYycsXG4gICAgJ1xceGQwJzogJ0QnLCAgJ1xceGYwJzogJ2QnLFxuICAgICdcXHhjOCc6ICdFJywgICdcXHhjOSc6ICdFJywgJ1xceGNhJzogJ0UnLCAnXFx4Y2InOiAnRScsXG4gICAgJ1xceGU4JzogJ2UnLCAgJ1xceGU5JzogJ2UnLCAnXFx4ZWEnOiAnZScsICdcXHhlYic6ICdlJyxcbiAgICAnXFx4Y2MnOiAnSScsICAnXFx4Y2QnOiAnSScsICdcXHhjZSc6ICdJJywgJ1xceGNmJzogJ0knLFxuICAgICdcXHhlYyc6ICdpJywgICdcXHhlZCc6ICdpJywgJ1xceGVlJzogJ2knLCAnXFx4ZWYnOiAnaScsXG4gICAgJ1xceGQxJzogJ04nLCAgJ1xceGYxJzogJ24nLFxuICAgICdcXHhkMic6ICdPJywgICdcXHhkMyc6ICdPJywgJ1xceGQ0JzogJ08nLCAnXFx4ZDUnOiAnTycsICdcXHhkNic6ICdPJywgJ1xceGQ4JzogJ08nLFxuICAgICdcXHhmMic6ICdvJywgICdcXHhmMyc6ICdvJywgJ1xceGY0JzogJ28nLCAnXFx4ZjUnOiAnbycsICdcXHhmNic6ICdvJywgJ1xceGY4JzogJ28nLFxuICAgICdcXHhkOSc6ICdVJywgICdcXHhkYSc6ICdVJywgJ1xceGRiJzogJ1UnLCAnXFx4ZGMnOiAnVScsXG4gICAgJ1xceGY5JzogJ3UnLCAgJ1xceGZhJzogJ3UnLCAnXFx4ZmInOiAndScsICdcXHhmYyc6ICd1JyxcbiAgICAnXFx4ZGQnOiAnWScsICAnXFx4ZmQnOiAneScsICdcXHhmZic6ICd5JyxcbiAgICAnXFx4YzYnOiAnQWUnLCAnXFx4ZTYnOiAnYWUnLFxuICAgICdcXHhkZSc6ICdUaCcsICdcXHhmZSc6ICd0aCcsXG4gICAgJ1xceGRmJzogJ3NzJyxcbiAgICAvLyBMYXRpbiBFeHRlbmRlZC1BIGJsb2NrLlxuICAgICdcXHUwMTAwJzogJ0EnLCAgJ1xcdTAxMDInOiAnQScsICdcXHUwMTA0JzogJ0EnLFxuICAgICdcXHUwMTAxJzogJ2EnLCAgJ1xcdTAxMDMnOiAnYScsICdcXHUwMTA1JzogJ2EnLFxuICAgICdcXHUwMTA2JzogJ0MnLCAgJ1xcdTAxMDgnOiAnQycsICdcXHUwMTBhJzogJ0MnLCAnXFx1MDEwYyc6ICdDJyxcbiAgICAnXFx1MDEwNyc6ICdjJywgICdcXHUwMTA5JzogJ2MnLCAnXFx1MDEwYic6ICdjJywgJ1xcdTAxMGQnOiAnYycsXG4gICAgJ1xcdTAxMGUnOiAnRCcsICAnXFx1MDExMCc6ICdEJywgJ1xcdTAxMGYnOiAnZCcsICdcXHUwMTExJzogJ2QnLFxuICAgICdcXHUwMTEyJzogJ0UnLCAgJ1xcdTAxMTQnOiAnRScsICdcXHUwMTE2JzogJ0UnLCAnXFx1MDExOCc6ICdFJywgJ1xcdTAxMWEnOiAnRScsXG4gICAgJ1xcdTAxMTMnOiAnZScsICAnXFx1MDExNSc6ICdlJywgJ1xcdTAxMTcnOiAnZScsICdcXHUwMTE5JzogJ2UnLCAnXFx1MDExYic6ICdlJyxcbiAgICAnXFx1MDExYyc6ICdHJywgICdcXHUwMTFlJzogJ0cnLCAnXFx1MDEyMCc6ICdHJywgJ1xcdTAxMjInOiAnRycsXG4gICAgJ1xcdTAxMWQnOiAnZycsICAnXFx1MDExZic6ICdnJywgJ1xcdTAxMjEnOiAnZycsICdcXHUwMTIzJzogJ2cnLFxuICAgICdcXHUwMTI0JzogJ0gnLCAgJ1xcdTAxMjYnOiAnSCcsICdcXHUwMTI1JzogJ2gnLCAnXFx1MDEyNyc6ICdoJyxcbiAgICAnXFx1MDEyOCc6ICdJJywgICdcXHUwMTJhJzogJ0knLCAnXFx1MDEyYyc6ICdJJywgJ1xcdTAxMmUnOiAnSScsICdcXHUwMTMwJzogJ0knLFxuICAgICdcXHUwMTI5JzogJ2knLCAgJ1xcdTAxMmInOiAnaScsICdcXHUwMTJkJzogJ2knLCAnXFx1MDEyZic6ICdpJywgJ1xcdTAxMzEnOiAnaScsXG4gICAgJ1xcdTAxMzQnOiAnSicsICAnXFx1MDEzNSc6ICdqJyxcbiAgICAnXFx1MDEzNic6ICdLJywgICdcXHUwMTM3JzogJ2snLCAnXFx1MDEzOCc6ICdrJyxcbiAgICAnXFx1MDEzOSc6ICdMJywgICdcXHUwMTNiJzogJ0wnLCAnXFx1MDEzZCc6ICdMJywgJ1xcdTAxM2YnOiAnTCcsICdcXHUwMTQxJzogJ0wnLFxuICAgICdcXHUwMTNhJzogJ2wnLCAgJ1xcdTAxM2MnOiAnbCcsICdcXHUwMTNlJzogJ2wnLCAnXFx1MDE0MCc6ICdsJywgJ1xcdTAxNDInOiAnbCcsXG4gICAgJ1xcdTAxNDMnOiAnTicsICAnXFx1MDE0NSc6ICdOJywgJ1xcdTAxNDcnOiAnTicsICdcXHUwMTRhJzogJ04nLFxuICAgICdcXHUwMTQ0JzogJ24nLCAgJ1xcdTAxNDYnOiAnbicsICdcXHUwMTQ4JzogJ24nLCAnXFx1MDE0Yic6ICduJyxcbiAgICAnXFx1MDE0Yyc6ICdPJywgICdcXHUwMTRlJzogJ08nLCAnXFx1MDE1MCc6ICdPJyxcbiAgICAnXFx1MDE0ZCc6ICdvJywgICdcXHUwMTRmJzogJ28nLCAnXFx1MDE1MSc6ICdvJyxcbiAgICAnXFx1MDE1NCc6ICdSJywgICdcXHUwMTU2JzogJ1InLCAnXFx1MDE1OCc6ICdSJyxcbiAgICAnXFx1MDE1NSc6ICdyJywgICdcXHUwMTU3JzogJ3InLCAnXFx1MDE1OSc6ICdyJyxcbiAgICAnXFx1MDE1YSc6ICdTJywgICdcXHUwMTVjJzogJ1MnLCAnXFx1MDE1ZSc6ICdTJywgJ1xcdTAxNjAnOiAnUycsXG4gICAgJ1xcdTAxNWInOiAncycsICAnXFx1MDE1ZCc6ICdzJywgJ1xcdTAxNWYnOiAncycsICdcXHUwMTYxJzogJ3MnLFxuICAgICdcXHUwMTYyJzogJ1QnLCAgJ1xcdTAxNjQnOiAnVCcsICdcXHUwMTY2JzogJ1QnLFxuICAgICdcXHUwMTYzJzogJ3QnLCAgJ1xcdTAxNjUnOiAndCcsICdcXHUwMTY3JzogJ3QnLFxuICAgICdcXHUwMTY4JzogJ1UnLCAgJ1xcdTAxNmEnOiAnVScsICdcXHUwMTZjJzogJ1UnLCAnXFx1MDE2ZSc6ICdVJywgJ1xcdTAxNzAnOiAnVScsICdcXHUwMTcyJzogJ1UnLFxuICAgICdcXHUwMTY5JzogJ3UnLCAgJ1xcdTAxNmInOiAndScsICdcXHUwMTZkJzogJ3UnLCAnXFx1MDE2Zic6ICd1JywgJ1xcdTAxNzEnOiAndScsICdcXHUwMTczJzogJ3UnLFxuICAgICdcXHUwMTc0JzogJ1cnLCAgJ1xcdTAxNzUnOiAndycsXG4gICAgJ1xcdTAxNzYnOiAnWScsICAnXFx1MDE3Nyc6ICd5JywgJ1xcdTAxNzgnOiAnWScsXG4gICAgJ1xcdTAxNzknOiAnWicsICAnXFx1MDE3Yic6ICdaJywgJ1xcdTAxN2QnOiAnWicsXG4gICAgJ1xcdTAxN2EnOiAneicsICAnXFx1MDE3Yyc6ICd6JywgJ1xcdTAxN2UnOiAneicsXG4gICAgJ1xcdTAxMzInOiAnSUonLCAnXFx1MDEzMyc6ICdpaicsXG4gICAgJ1xcdTAxNTInOiAnT2UnLCAnXFx1MDE1Myc6ICdvZScsXG4gICAgJ1xcdTAxNDknOiBcIiduXCIsICdcXHUwMTdmJzogJ3MnXG4gIH07XG5cbiAgLyoqIFVzZWQgdG8gbWFwIGNoYXJhY3RlcnMgdG8gSFRNTCBlbnRpdGllcy4gKi9cbiAgdmFyIGh0bWxFc2NhcGVzID0ge1xuICAgICcmJzogJyZhbXA7JyxcbiAgICAnPCc6ICcmbHQ7JyxcbiAgICAnPic6ICcmZ3Q7JyxcbiAgICAnXCInOiAnJnF1b3Q7JyxcbiAgICBcIidcIjogJyYjMzk7J1xuICB9O1xuXG4gIC8qKiBVc2VkIHRvIG1hcCBIVE1MIGVudGl0aWVzIHRvIGNoYXJhY3RlcnMuICovXG4gIHZhciBodG1sVW5lc2NhcGVzID0ge1xuICAgICcmYW1wOyc6ICcmJyxcbiAgICAnJmx0Oyc6ICc8JyxcbiAgICAnJmd0Oyc6ICc+JyxcbiAgICAnJnF1b3Q7JzogJ1wiJyxcbiAgICAnJiMzOTsnOiBcIidcIlxuICB9O1xuXG4gIC8qKiBVc2VkIHRvIGVzY2FwZSBjaGFyYWN0ZXJzIGZvciBpbmNsdXNpb24gaW4gY29tcGlsZWQgc3RyaW5nIGxpdGVyYWxzLiAqL1xuICB2YXIgc3RyaW5nRXNjYXBlcyA9IHtcbiAgICAnXFxcXCc6ICdcXFxcJyxcbiAgICBcIidcIjogXCInXCIsXG4gICAgJ1xcbic6ICduJyxcbiAgICAnXFxyJzogJ3InLFxuICAgICdcXHUyMDI4JzogJ3UyMDI4JyxcbiAgICAnXFx1MjAyOSc6ICd1MjAyOSdcbiAgfTtcblxuICAvKiogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgd2l0aG91dCBhIGRlcGVuZGVuY3kgb24gYHJvb3RgLiAqL1xuICB2YXIgZnJlZVBhcnNlRmxvYXQgPSBwYXJzZUZsb2F0LFxuICAgICAgZnJlZVBhcnNlSW50ID0gcGFyc2VJbnQ7XG5cbiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi9cbiAgdmFyIGZyZWVHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCAmJiBnbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgZ2xvYmFsO1xuXG4gIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgc2VsZmAuICovXG4gIHZhciBmcmVlU2VsZiA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgPT09IE9iamVjdCAmJiBzZWxmO1xuXG4gIC8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqL1xuICB2YXIgcm9vdCA9IGZyZWVHbG9iYWwgfHwgZnJlZVNlbGYgfHwgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblxuICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGV4cG9ydHNgLiAqL1xuICB2YXIgZnJlZUV4cG9ydHMgPSB0eXBlb2YgZXhwb3J0cyA9PSAnb2JqZWN0JyAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7XG5cbiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBtb2R1bGVgLiAqL1xuICB2YXIgZnJlZU1vZHVsZSA9IGZyZWVFeHBvcnRzICYmIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlO1xuXG4gIC8qKiBEZXRlY3QgdGhlIHBvcHVsYXIgQ29tbW9uSlMgZXh0ZW5zaW9uIGBtb2R1bGUuZXhwb3J0c2AuICovXG4gIHZhciBtb2R1bGVFeHBvcnRzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLmV4cG9ydHMgPT09IGZyZWVFeHBvcnRzO1xuXG4gIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgcHJvY2Vzc2AgZnJvbSBOb2RlLmpzLiAqL1xuICB2YXIgZnJlZVByb2Nlc3MgPSBtb2R1bGVFeHBvcnRzICYmIGZyZWVHbG9iYWwucHJvY2VzcztcblxuICAvKiogVXNlZCB0byBhY2Nlc3MgZmFzdGVyIE5vZGUuanMgaGVscGVycy4gKi9cbiAgdmFyIG5vZGVVdGlsID0gKGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZnJlZVByb2Nlc3MgJiYgZnJlZVByb2Nlc3MuYmluZGluZyAmJiBmcmVlUHJvY2Vzcy5iaW5kaW5nKCd1dGlsJyk7XG4gICAgfSBjYXRjaCAoZSkge31cbiAgfSgpKTtcblxuICAvKiBOb2RlLmpzIGhlbHBlciByZWZlcmVuY2VzLiAqL1xuICB2YXIgbm9kZUlzQXJyYXlCdWZmZXIgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc0FycmF5QnVmZmVyLFxuICAgICAgbm9kZUlzRGF0ZSA9IG5vZGVVdGlsICYmIG5vZGVVdGlsLmlzRGF0ZSxcbiAgICAgIG5vZGVJc01hcCA9IG5vZGVVdGlsICYmIG5vZGVVdGlsLmlzTWFwLFxuICAgICAgbm9kZUlzUmVnRXhwID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNSZWdFeHAsXG4gICAgICBub2RlSXNTZXQgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc1NldCxcbiAgICAgIG5vZGVJc1R5cGVkQXJyYXkgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc1R5cGVkQXJyYXk7XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGtleS12YWx1ZSBgcGFpcmAgdG8gYG1hcGAuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBtb2RpZnkuXG4gICAqIEBwYXJhbSB7QXJyYXl9IHBhaXIgVGhlIGtleS12YWx1ZSBwYWlyIHRvIGFkZC5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgbWFwYC5cbiAgICovXG4gIGZ1bmN0aW9uIGFkZE1hcEVudHJ5KG1hcCwgcGFpcikge1xuICAgIC8vIERvbid0IHJldHVybiBgbWFwLnNldGAgYmVjYXVzZSBpdCdzIG5vdCBjaGFpbmFibGUgaW4gSUUgMTEuXG4gICAgbWFwLnNldChwYWlyWzBdLCBwYWlyWzFdKTtcbiAgICByZXR1cm4gbWFwO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYHZhbHVlYCB0byBgc2V0YC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIG1vZGlmeS5cbiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYWRkLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBzZXRgLlxuICAgKi9cbiAgZnVuY3Rpb24gYWRkU2V0RW50cnkoc2V0LCB2YWx1ZSkge1xuICAgIC8vIERvbid0IHJldHVybiBgc2V0LmFkZGAgYmVjYXVzZSBpdCdzIG5vdCBjaGFpbmFibGUgaW4gSUUgMTEuXG4gICAgc2V0LmFkZCh2YWx1ZSk7XG4gICAgcmV0dXJuIHNldDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGZhc3RlciBhbHRlcm5hdGl2ZSB0byBgRnVuY3Rpb24jYXBwbHlgLCB0aGlzIGZ1bmN0aW9uIGludm9rZXMgYGZ1bmNgXG4gICAqIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIGB0aGlzQXJnYCBhbmQgdGhlIGFyZ3VtZW50cyBvZiBgYXJnc2AuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGludm9rZS5cbiAgICogQHBhcmFtIHsqfSB0aGlzQXJnIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFyZ3MgVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgYGZ1bmNgIHdpdGguXG4gICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXN1bHQgb2YgYGZ1bmNgLlxuICAgKi9cbiAgZnVuY3Rpb24gYXBwbHkoZnVuYywgdGhpc0FyZywgYXJncykge1xuICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMDogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnKTtcbiAgICAgIGNhc2UgMTogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmdzWzBdKTtcbiAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgIGNhc2UgMzogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7XG4gIH1cblxuICAvKipcbiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlQWdncmVnYXRvcmAgZm9yIGFycmF5cy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZXR0ZXIgVGhlIGZ1bmN0aW9uIHRvIHNldCBgYWNjdW11bGF0b3JgIHZhbHVlcy5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGl0ZXJhdGVlIHRvIHRyYW5zZm9ybSBrZXlzLlxuICAgKiBAcGFyYW0ge09iamVjdH0gYWNjdW11bGF0b3IgVGhlIGluaXRpYWwgYWdncmVnYXRlZCBvYmplY3QuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgYWNjdW11bGF0b3JgLlxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlBZ2dyZWdhdG9yKGFycmF5LCBzZXR0ZXIsIGl0ZXJhdGVlLCBhY2N1bXVsYXRvcikge1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07XG4gICAgICBzZXR0ZXIoYWNjdW11bGF0b3IsIHZhbHVlLCBpdGVyYXRlZSh2YWx1ZSksIGFycmF5KTtcbiAgICB9XG4gICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5mb3JFYWNoYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3JcbiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5RWFjaChhcnJheSwgaXRlcmF0ZWUpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaFJpZ2h0YCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3JcbiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5RWFjaFJpZ2h0KGFycmF5LCBpdGVyYXRlZSkge1xuICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcblxuICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W2xlbmd0aF0sIGxlbmd0aCwgYXJyYXkpID09PSBmYWxzZSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5ldmVyeWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yXG4gICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbGwgZWxlbWVudHMgcGFzcyB0aGUgcHJlZGljYXRlIGNoZWNrLFxuICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlFdmVyeShhcnJheSwgcHJlZGljYXRlKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmICghcHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5maWx0ZXJgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvclxuICAgKiBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmaWx0ZXJlZCBhcnJheS5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5RmlsdGVyKGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsXG4gICAgICAgIHJlc0luZGV4ID0gMCxcbiAgICAgICAgcmVzdWx0ID0gW107XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGFycmF5KSkge1xuICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uaW5jbHVkZXNgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvclxuICAgKiBzcGVjaWZ5aW5nIGFuIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0geyp9IHRhcmdldCBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB0YXJnZXRgIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuXG4gICAqL1xuICBmdW5jdGlvbiBhcnJheUluY2x1ZGVzKGFycmF5LCB2YWx1ZSkge1xuICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICByZXR1cm4gISFsZW5ndGggJiYgYmFzZUluZGV4T2YoYXJyYXksIHZhbHVlLCAwKSA+IC0xO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZSBgYXJyYXlJbmNsdWRlc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhIGNvbXBhcmF0b3IuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAqIEBwYXJhbSB7Kn0gdGFyZ2V0IFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJhdG9yIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdGFyZ2V0YCBpcyBmb3VuZCwgZWxzZSBgZmFsc2VgLlxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlJbmNsdWRlc1dpdGgoYXJyYXksIHZhbHVlLCBjb21wYXJhdG9yKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmIChjb21wYXJhdG9yKHZhbHVlLCBhcnJheVtpbmRleF0pKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLm1hcGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlXG4gICAqIHNob3J0aGFuZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIGFycmF5LlxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlNYXAoYXJyYXksIGl0ZXJhdGVlKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoLFxuICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQXBwZW5kcyB0aGUgZWxlbWVudHMgb2YgYHZhbHVlc2AgdG8gYGFycmF5YC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gYXBwZW5kLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5UHVzaChhcnJheSwgdmFsdWVzKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGgsXG4gICAgICAgIG9mZnNldCA9IGFycmF5Lmxlbmd0aDtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICBhcnJheVtvZmZzZXQgKyBpbmRleF0gPSB2YWx1ZXNbaW5kZXhdO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICAvKipcbiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnJlZHVjZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yXG4gICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBpbml0aWFsIHZhbHVlLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbml0QWNjdW1dIFNwZWNpZnkgdXNpbmcgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YCBhc1xuICAgKiAgdGhlIGluaXRpYWwgdmFsdWUuXG4gICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5UmVkdWNlKGFycmF5LCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIGluaXRBY2N1bSkge1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcblxuICAgIGlmIChpbml0QWNjdW0gJiYgbGVuZ3RoKSB7XG4gICAgICBhY2N1bXVsYXRvciA9IGFycmF5WysraW5kZXhdO1xuICAgIH1cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgYWNjdW11bGF0b3IgPSBpdGVyYXRlZShhY2N1bXVsYXRvciwgYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpO1xuICAgIH1cbiAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gIH1cblxuICAvKipcbiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnJlZHVjZVJpZ2h0YCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3JcbiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0geyp9IFthY2N1bXVsYXRvcl0gVGhlIGluaXRpYWwgdmFsdWUuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2luaXRBY2N1bV0gU3BlY2lmeSB1c2luZyB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAgYXNcbiAgICogIHRoZSBpbml0aWFsIHZhbHVlLlxuICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuXG4gICAqL1xuICBmdW5jdGlvbiBhcnJheVJlZHVjZVJpZ2h0KGFycmF5LCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIGluaXRBY2N1bSkge1xuICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICBpZiAoaW5pdEFjY3VtICYmIGxlbmd0aCkge1xuICAgICAgYWNjdW11bGF0b3IgPSBhcnJheVstLWxlbmd0aF07XG4gICAgfVxuICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgYWNjdW11bGF0b3IgPSBpdGVyYXRlZShhY2N1bXVsYXRvciwgYXJyYXlbbGVuZ3RoXSwgbGVuZ3RoLCBhcnJheSk7XG4gICAgfVxuICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc29tZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlXG4gICAqIHNob3J0aGFuZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjayxcbiAgICogIGVsc2UgYGZhbHNlYC5cbiAgICovXG4gIGZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgc2l6ZSBvZiBhbiBBU0NJSSBgc3RyaW5nYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIGluc3BlY3QuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHN0cmluZyBzaXplLlxuICAgKi9cbiAgdmFyIGFzY2lpU2l6ZSA9IGJhc2VQcm9wZXJ0eSgnbGVuZ3RoJyk7XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGFuIEFTQ0lJIGBzdHJpbmdgIHRvIGFuIGFycmF5LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgYXJyYXkuXG4gICAqL1xuICBmdW5jdGlvbiBhc2NpaVRvQXJyYXkoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHN0cmluZy5zcGxpdCgnJyk7XG4gIH1cblxuICAvKipcbiAgICogU3BsaXRzIGFuIEFTQ0lJIGBzdHJpbmdgIGludG8gYW4gYXJyYXkgb2YgaXRzIHdvcmRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gVGhlIHN0cmluZyB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHdvcmRzIG9mIGBzdHJpbmdgLlxuICAgKi9cbiAgZnVuY3Rpb24gYXNjaWlXb3JkcyhzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLm1hdGNoKHJlQXNjaWlXb3JkKSB8fCBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZmluZEtleWAgYW5kIGBfLmZpbmRMYXN0S2V5YCxcbiAgICogd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLCB3aGljaCBpdGVyYXRlcyBvdmVyIGBjb2xsZWN0aW9uYFxuICAgKiB1c2luZyBgZWFjaEZ1bmNgLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZWFjaEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGl0ZXJhdGUgb3ZlciBgY29sbGVjdGlvbmAuXG4gICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBmb3VuZCBlbGVtZW50IG9yIGl0cyBrZXksIGVsc2UgYHVuZGVmaW5lZGAuXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlRmluZEtleShjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIGVhY2hGdW5jKSB7XG4gICAgdmFyIHJlc3VsdDtcbiAgICBlYWNoRnVuYyhjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSB7XG4gICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pKSB7XG4gICAgICAgIHJlc3VsdCA9IGtleTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZmluZEluZGV4YCBhbmQgYF8uZmluZExhc3RJbmRleGAgd2l0aG91dFxuICAgKiBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC5cbiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VGaW5kSW5kZXgoYXJyYXksIHByZWRpY2F0ZSwgZnJvbUluZGV4LCBmcm9tUmlnaHQpIHtcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICBpbmRleCA9IGZyb21JbmRleCArIChmcm9tUmlnaHQgPyAxIDogLTEpO1xuXG4gICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHtcbiAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7XG4gICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmluZGV4T2ZgIHdpdGhvdXQgYGZyb21JbmRleGAgYm91bmRzIGNoZWNrcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLlxuICAgKi9cbiAgZnVuY3Rpb24gYmFzZUluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlXG4gICAgICA/IHN0cmljdEluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpXG4gICAgICA6IGJhc2VGaW5kSW5kZXgoYXJyYXksIGJhc2VJc05hTiwgZnJvbUluZGV4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGxpa2UgYGJhc2VJbmRleE9mYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGEgY29tcGFyYXRvci5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJhdG9yIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlSW5kZXhPZldpdGgoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgsIGNvbXBhcmF0b3IpIHtcbiAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggLSAxLFxuICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgaWYgKGNvbXBhcmF0b3IoYXJyYXlbaW5kZXhdLCB2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNOYU5gIHdpdGhvdXQgc3VwcG9ydCBmb3IgbnVtYmVyIG9iamVjdHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgTmFOYCwgZWxzZSBgZmFsc2VgLlxuICAgKi9cbiAgZnVuY3Rpb24gYmFzZUlzTmFOKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5tZWFuYCBhbmQgYF8ubWVhbkJ5YCB3aXRob3V0IHN1cHBvcnQgZm9yXG4gICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIG1lYW4uXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlTWVhbihhcnJheSwgaXRlcmF0ZWUpIHtcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgcmV0dXJuIGxlbmd0aCA/IChiYXNlU3VtKGFycmF5LCBpdGVyYXRlZSkgLyBsZW5ndGgpIDogTkFOO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnByb3BlcnR5YCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VQcm9wZXJ0eShrZXkpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBvYmplY3Rba2V5XTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnByb3BlcnR5T2ZgIHdpdGhvdXQgc3VwcG9ydCBmb3IgZGVlcCBwYXRocy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VQcm9wZXJ0eU9mKG9iamVjdCkge1xuICAgIHJldHVybiBmdW5jdGlvbihrZXkpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucmVkdWNlYCBhbmQgYF8ucmVkdWNlUmlnaHRgLCB3aXRob3V0IHN1cHBvcnRcbiAgICogZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMsIHdoaWNoIGl0ZXJhdGVzIG92ZXIgYGNvbGxlY3Rpb25gIHVzaW5nIGBlYWNoRnVuY2AuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHsqfSBhY2N1bXVsYXRvciBUaGUgaW5pdGlhbCB2YWx1ZS5cbiAgICogQHBhcmFtIHtib29sZWFufSBpbml0QWNjdW0gU3BlY2lmeSB1c2luZyB0aGUgZmlyc3Qgb3IgbGFzdCBlbGVtZW50IG9mXG4gICAqICBgY29sbGVjdGlvbmAgYXMgdGhlIGluaXRpYWwgdmFsdWUuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGVhY2hGdW5jIFRoZSBmdW5jdGlvbiB0byBpdGVyYXRlIG92ZXIgYGNvbGxlY3Rpb25gLlxuICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlUmVkdWNlKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEFjY3VtLCBlYWNoRnVuYykge1xuICAgIGVhY2hGdW5jKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgYWNjdW11bGF0b3IgPSBpbml0QWNjdW1cbiAgICAgICAgPyAoaW5pdEFjY3VtID0gZmFsc2UsIHZhbHVlKVxuICAgICAgICA6IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pO1xuICAgIH0pO1xuICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zb3J0QnlgIHdoaWNoIHVzZXMgYGNvbXBhcmVyYCB0byBkZWZpbmUgdGhlXG4gICAqIHNvcnQgb3JkZXIgb2YgYGFycmF5YCBhbmQgcmVwbGFjZXMgY3JpdGVyaWEgb2JqZWN0cyB3aXRoIHRoZWlyIGNvcnJlc3BvbmRpbmdcbiAgICogdmFsdWVzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc29ydC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyZXIgVGhlIGZ1bmN0aW9uIHRvIGRlZmluZSBzb3J0IG9yZGVyLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VTb3J0QnkoYXJyYXksIGNvbXBhcmVyKSB7XG4gICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcblxuICAgIGFycmF5LnNvcnQoY29tcGFyZXIpO1xuICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgYXJyYXlbbGVuZ3RoXSA9IGFycmF5W2xlbmd0aF0udmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zdW1gIGFuZCBgXy5zdW1CeWAgd2l0aG91dCBzdXBwb3J0IGZvclxuICAgKiBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBzdW0uXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlU3VtKGFycmF5LCBpdGVyYXRlZSkge1xuICAgIHZhciByZXN1bHQsXG4gICAgICAgIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICB2YXIgY3VycmVudCA9IGl0ZXJhdGVlKGFycmF5W2luZGV4XSk7XG4gICAgICBpZiAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gY3VycmVudCA6IChyZXN1bHQgKyBjdXJyZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50aW1lc2Agd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzXG4gICAqIG9yIG1heCBhcnJheSBsZW5ndGggY2hlY2tzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIHRpbWVzIHRvIGludm9rZSBgaXRlcmF0ZWVgLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHJlc3VsdHMuXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlVGltZXMobiwgaXRlcmF0ZWUpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgcmVzdWx0ID0gQXJyYXkobik7XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IG4pIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udG9QYWlyc2AgYW5kIGBfLnRvUGFpcnNJbmAgd2hpY2ggY3JlYXRlcyBhbiBhcnJheVxuICAgKiBvZiBrZXktdmFsdWUgcGFpcnMgZm9yIGBvYmplY3RgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3BlcnR5IG5hbWVzIG9mIGBwcm9wc2AuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgVGhlIHByb3BlcnR5IG5hbWVzIHRvIGdldCB2YWx1ZXMgZm9yLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBrZXktdmFsdWUgcGFpcnMuXG4gICAqL1xuICBmdW5jdGlvbiBiYXNlVG9QYWlycyhvYmplY3QsIHByb3BzKSB7XG4gICAgcmV0dXJuIGFycmF5TWFwKHByb3BzLCBmdW5jdGlvbihrZXkpIHtcbiAgICAgIHJldHVybiBba2V5LCBvYmplY3Rba2V5XV07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udW5hcnlgIHdpdGhvdXQgc3VwcG9ydCBmb3Igc3RvcmluZyBtZXRhZGF0YS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2FwIGFyZ3VtZW50cyBmb3IuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGNhcHBlZCBmdW5jdGlvbi5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VVbmFyeShmdW5jKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gZnVuYyh2YWx1ZSk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy52YWx1ZXNgIGFuZCBgXy52YWx1ZXNJbmAgd2hpY2ggY3JlYXRlcyBhblxuICAgKiBhcnJheSBvZiBgb2JqZWN0YCBwcm9wZXJ0eSB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvcGVydHkgbmFtZXNcbiAgICogb2YgYHByb3BzYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgbmFtZXMgdG8gZ2V0IHZhbHVlcyBmb3IuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy5cbiAgICovXG4gIGZ1bmN0aW9uIGJhc2VWYWx1ZXMob2JqZWN0LCBwcm9wcykge1xuICAgIHJldHVybiBhcnJheU1hcChwcm9wcywgZnVuY3Rpb24oa2V5KSB7XG4gICAgICByZXR1cm4gb2JqZWN0W2tleV07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGEgYGNhY2hlYCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gY2FjaGUgVGhlIGNhY2hlIHRvIHF1ZXJ5LlxuICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLlxuICAgKi9cbiAgZnVuY3Rpb24gY2FjaGVIYXMoY2FjaGUsIGtleSkge1xuICAgIHJldHVybiBjYWNoZS5oYXMoa2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIGJ5IGBfLnRyaW1gIGFuZCBgXy50cmltU3RhcnRgIHRvIGdldCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IHN0cmluZyBzeW1ib2xcbiAgICogdGhhdCBpcyBub3QgZm91bmQgaW4gdGhlIGNoYXJhY3RlciBzeW1ib2xzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBzdHJTeW1ib2xzIFRoZSBzdHJpbmcgc3ltYm9scyB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0ge0FycmF5fSBjaHJTeW1ib2xzIFRoZSBjaGFyYWN0ZXIgc3ltYm9scyB0byBmaW5kLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgdW5tYXRjaGVkIHN0cmluZyBzeW1ib2wuXG4gICAqL1xuICBmdW5jdGlvbiBjaGFyc1N0YXJ0SW5kZXgoc3RyU3ltYm9scywgY2hyU3ltYm9scykge1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICBsZW5ndGggPSBzdHJTeW1ib2xzLmxlbmd0aDtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoICYmIGJhc2VJbmRleE9mKGNoclN5bWJvbHMsIHN0clN5bWJvbHNbaW5kZXhdLCAwKSA+IC0xKSB7fVxuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIGJ5IGBfLnRyaW1gIGFuZCBgXy50cmltRW5kYCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBsYXN0IHN0cmluZyBzeW1ib2xcbiAgICogdGhhdCBpcyBub3QgZm91bmQgaW4gdGhlIGNoYXJhY3RlciBzeW1ib2xzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBzdHJTeW1ib2xzIFRoZSBzdHJpbmcgc3ltYm9scyB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0ge0FycmF5fSBjaHJTeW1ib2xzIFRoZSBjaGFyYWN0ZXIgc3ltYm9scyB0byBmaW5kLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbGFzdCB1bm1hdGNoZWQgc3RyaW5nIHN5bWJvbC5cbiAgICovXG4gIGZ1bmN0aW9uIGNoYXJzRW5kSW5kZXgoc3RyU3ltYm9scywgY2hyU3ltYm9scykge1xuICAgIHZhciBpbmRleCA9IHN0clN5bWJvbHMubGVuZ3RoO1xuXG4gICAgd2hpbGUgKGluZGV4LS0gJiYgYmFzZUluZGV4T2YoY2hyU3ltYm9scywgc3RyU3ltYm9sc1tpbmRleF0sIDApID4gLTEpIHt9XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG51bWJlciBvZiBgcGxhY2Vob2xkZXJgIG9jY3VycmVuY2VzIGluIGBhcnJheWAuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0geyp9IHBsYWNlaG9sZGVyIFRoZSBwbGFjZWhvbGRlciB0byBzZWFyY2ggZm9yLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBwbGFjZWhvbGRlciBjb3VudC5cbiAgICovXG4gIGZ1bmN0aW9uIGNvdW50SG9sZGVycyhhcnJheSwgcGxhY2Vob2xkZXIpIHtcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICByZXN1bHQgPSAwO1xuXG4gICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICBpZiAoYXJyYXlbbGVuZ3RoXSA9PT0gcGxhY2Vob2xkZXIpIHtcbiAgICAgICAgKytyZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVXNlZCBieSBgXy5kZWJ1cnJgIHRvIGNvbnZlcnQgTGF0aW4tMSBTdXBwbGVtZW50IGFuZCBMYXRpbiBFeHRlbmRlZC1BXG4gICAqIGxldHRlcnMgdG8gYmFzaWMgTGF0aW4gbGV0dGVycy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxldHRlciBUaGUgbWF0Y2hlZCBsZXR0ZXIgdG8gZGVidXJyLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBkZWJ1cnJlZCBsZXR0ZXIuXG4gICAqL1xuICB2YXIgZGVidXJyTGV0dGVyID0gYmFzZVByb3BlcnR5T2YoZGVidXJyZWRMZXR0ZXJzKTtcblxuICAvKipcbiAgICogVXNlZCBieSBgXy5lc2NhcGVgIHRvIGNvbnZlcnQgY2hhcmFjdGVycyB0byBIVE1MIGVudGl0aWVzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2hyIFRoZSBtYXRjaGVkIGNoYXJhY3RlciB0byBlc2NhcGUuXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGVzY2FwZWQgY2hhcmFjdGVyLlxuICAgKi9cbiAgdmFyIGVzY2FwZUh0bWxDaGFyID0gYmFzZVByb3BlcnR5T2YoaHRtbEVzY2FwZXMpO1xuXG4gIC8qKlxuICAgKiBVc2VkIGJ5IGBfLnRlbXBsYXRlYCB0byBlc2NhcGUgY2hhcmFjdGVycyBmb3IgaW5jbHVzaW9uIGluIGNvbXBpbGVkIHN0cmluZyBsaXRlcmFscy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNociBUaGUgbWF0Y2hlZCBjaGFyYWN0ZXIgdG8gZXNjYXBlLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBlc2NhcGVkIGNoYXJhY3Rlci5cbiAgICovXG4gIGZ1bmN0aW9uIGVzY2FwZVN0cmluZ0NoYXIoY2hyKSB7XG4gICAgcmV0dXJuICdcXFxcJyArIHN0cmluZ0VzY2FwZXNbY2hyXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2YWx1ZSBhdCBga2V5YCBvZiBgb2JqZWN0YC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRWYWx1ZShvYmplY3QsIGtleSkge1xuICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgc3RyaW5nYCBjb250YWlucyBVbmljb2RlIHN5bWJvbHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYSBzeW1ib2wgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC5cbiAgICovXG4gIGZ1bmN0aW9uIGhhc1VuaWNvZGUoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHJlSGFzVW5pY29kZS50ZXN0KHN0cmluZyk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGBzdHJpbmdgIGNvbnRhaW5zIGEgd29yZCBjb21wb3NlZCBvZiBVbmljb2RlIHN5bWJvbHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYSB3b3JkIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuXG4gICAqL1xuICBmdW5jdGlvbiBoYXNVbmljb2RlV29yZChzdHJpbmcpIHtcbiAgICByZXR1cm4gcmVIYXNVbmljb2RlV29yZC50ZXN0KHN0cmluZyk7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYGl0ZXJhdG9yYCB0byBhbiBhcnJheS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IGl0ZXJhdG9yIFRoZSBpdGVyYXRvciB0byBjb252ZXJ0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS5cbiAgICovXG4gIGZ1bmN0aW9uIGl0ZXJhdG9yVG9BcnJheShpdGVyYXRvcikge1xuICAgIHZhciBkYXRhLFxuICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgIHdoaWxlICghKGRhdGEgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmUpIHtcbiAgICAgIHJlc3VsdC5wdXNoKGRhdGEudmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGBtYXBgIHRvIGl0cyBrZXktdmFsdWUgcGFpcnMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBjb252ZXJ0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGtleS12YWx1ZSBwYWlycy5cbiAgICovXG4gIGZ1bmN0aW9uIG1hcFRvQXJyYXkobWFwKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIHJlc3VsdCA9IEFycmF5KG1hcC5zaXplKTtcblxuICAgIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgIHJlc3VsdFsrK2luZGV4XSA9IFtrZXksIHZhbHVlXTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB1bmFyeSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggaXRzIGFyZ3VtZW50IHRyYW5zZm9ybWVkLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB0cmFuc2Zvcm0gVGhlIGFyZ3VtZW50IHRyYW5zZm9ybS5cbiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAqL1xuICBmdW5jdGlvbiBvdmVyQXJnKGZ1bmMsIHRyYW5zZm9ybSkge1xuICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHtcbiAgICAgIHJldHVybiBmdW5jKHRyYW5zZm9ybShhcmcpKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcGxhY2VzIGFsbCBgcGxhY2Vob2xkZXJgIGVsZW1lbnRzIGluIGBhcnJheWAgd2l0aCBhbiBpbnRlcm5hbCBwbGFjZWhvbGRlclxuICAgKiBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiB0aGVpciBpbmRleGVzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICAgKiBAcGFyYW0geyp9IHBsYWNlaG9sZGVyIFRoZSBwbGFjZWhvbGRlciB0byByZXBsYWNlLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBwbGFjZWhvbGRlciBpbmRleGVzLlxuICAgKi9cbiAgZnVuY3Rpb24gcmVwbGFjZUhvbGRlcnMoYXJyYXksIHBsYWNlaG9sZGVyKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgcmVzSW5kZXggPSAwLFxuICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07XG4gICAgICBpZiAodmFsdWUgPT09IHBsYWNlaG9sZGVyIHx8IHZhbHVlID09PSBQTEFDRUhPTERFUikge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBQTEFDRUhPTERFUjtcbiAgICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYHNldGAgdG8gYW4gYXJyYXkgb2YgaXRzIHZhbHVlcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIGNvbnZlcnQuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgdmFsdWVzLlxuICAgKi9cbiAgZnVuY3Rpb24gc2V0VG9BcnJheShzZXQpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgcmVzdWx0ID0gQXJyYXkoc2V0LnNpemUpO1xuXG4gICAgc2V0LmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJlc3VsdFsrK2luZGV4XSA9IHZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYHNldGAgdG8gaXRzIHZhbHVlLXZhbHVlIHBhaXJzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gc2V0IFRoZSBzZXQgdG8gY29udmVydC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB2YWx1ZS12YWx1ZSBwYWlycy5cbiAgICovXG4gIGZ1bmN0aW9uIHNldFRvUGFpcnMoc2V0KSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIHJlc3VsdCA9IEFycmF5KHNldC5zaXplKTtcblxuICAgIHNldC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXN1bHRbKytpbmRleF0gPSBbdmFsdWUsIHZhbHVlXTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5pbmRleE9mYCB3aGljaCBwZXJmb3JtcyBzdHJpY3QgZXF1YWxpdHlcbiAgICogY29tcGFyaXNvbnMgb2YgdmFsdWVzLCBpLmUuIGA9PT1gLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGZyb21JbmRleCBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuXG4gICAqL1xuICBmdW5jdGlvbiBzdHJpY3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7XG4gICAgdmFyIGluZGV4ID0gZnJvbUluZGV4IC0gMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmIChhcnJheVtpbmRleF0gPT09IHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5sYXN0SW5kZXhPZmAgd2hpY2ggcGVyZm9ybXMgc3RyaWN0IGVxdWFsaXR5XG4gICAqIGNvbXBhcmlzb25zIG9mIHZhbHVlcywgaS5lLiBgPT09YC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLlxuICAgKi9cbiAgZnVuY3Rpb24gc3RyaWN0TGFzdEluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggKyAxO1xuICAgIHdoaWxlIChpbmRleC0tKSB7XG4gICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBudW1iZXIgb2Ygc3ltYm9scyBpbiBgc3RyaW5nYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHN0cmluZyBzaXplLlxuICAgKi9cbiAgZnVuY3Rpb24gc3RyaW5nU2l6ZShzdHJpbmcpIHtcbiAgICByZXR1cm4gaGFzVW5pY29kZShzdHJpbmcpXG4gICAgICA/IHVuaWNvZGVTaXplKHN0cmluZylcbiAgICAgIDogYXNjaWlTaXplKHN0cmluZyk7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYW4gYXJyYXkuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS5cbiAgICovXG4gIGZ1bmN0aW9uIHN0cmluZ1RvQXJyYXkoc3RyaW5nKSB7XG4gICAgcmV0dXJuIGhhc1VuaWNvZGUoc3RyaW5nKVxuICAgICAgPyB1bmljb2RlVG9BcnJheShzdHJpbmcpXG4gICAgICA6IGFzY2lpVG9BcnJheShzdHJpbmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgYnkgYF8udW5lc2NhcGVgIHRvIGNvbnZlcnQgSFRNTCBlbnRpdGllcyB0byBjaGFyYWN0ZXJzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2hyIFRoZSBtYXRjaGVkIGNoYXJhY3RlciB0byB1bmVzY2FwZS5cbiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdW5lc2NhcGVkIGNoYXJhY3Rlci5cbiAgICovXG4gIHZhciB1bmVzY2FwZUh0bWxDaGFyID0gYmFzZVByb3BlcnR5T2YoaHRtbFVuZXNjYXBlcyk7XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNpemUgb2YgYSBVbmljb2RlIGBzdHJpbmdgLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgaW5zcGVjdC5cbiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc3RyaW5nIHNpemUuXG4gICAqL1xuICBmdW5jdGlvbiB1bmljb2RlU2l6ZShzdHJpbmcpIHtcbiAgICB2YXIgcmVzdWx0ID0gcmVVbmljb2RlLmxhc3RJbmRleCA9IDA7XG4gICAgd2hpbGUgKHJlVW5pY29kZS50ZXN0KHN0cmluZykpIHtcbiAgICAgICsrcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGEgVW5pY29kZSBgc3RyaW5nYCB0byBhbiBhcnJheS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LlxuICAgKi9cbiAgZnVuY3Rpb24gdW5pY29kZVRvQXJyYXkoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHN0cmluZy5tYXRjaChyZVVuaWNvZGUpIHx8IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFNwbGl0cyBhIFVuaWNvZGUgYHN0cmluZ2AgaW50byBhbiBhcnJheSBvZiBpdHMgd29yZHMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGluc3BlY3QuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgd29yZHMgb2YgYHN0cmluZ2AuXG4gICAqL1xuICBmdW5jdGlvbiB1bmljb2RlV29yZHMoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHN0cmluZy5tYXRjaChyZVVuaWNvZGVXb3JkKSB8fCBbXTtcbiAgfVxuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgcHJpc3RpbmUgYGxvZGFzaGAgZnVuY3Rpb24gdXNpbmcgdGhlIGBjb250ZXh0YCBvYmplY3QuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQHNpbmNlIDEuMS4wXG4gICAqIEBjYXRlZ29yeSBVdGlsXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbY29udGV4dD1yb290XSBUaGUgY29udGV4dCBvYmplY3QuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBhIG5ldyBgbG9kYXNoYCBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5taXhpbih7ICdmb28nOiBfLmNvbnN0YW50KCdmb28nKSB9KTtcbiAgICpcbiAgICogdmFyIGxvZGFzaCA9IF8ucnVuSW5Db250ZXh0KCk7XG4gICAqIGxvZGFzaC5taXhpbih7ICdiYXInOiBsb2Rhc2guY29uc3RhbnQoJ2JhcicpIH0pO1xuICAgKlxuICAgKiBfLmlzRnVuY3Rpb24oXy5mb28pO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqIF8uaXNGdW5jdGlvbihfLmJhcik7XG4gICAqIC8vID0+IGZhbHNlXG4gICAqXG4gICAqIGxvZGFzaC5pc0Z1bmN0aW9uKGxvZGFzaC5mb28pO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKiBsb2Rhc2guaXNGdW5jdGlvbihsb2Rhc2guYmFyKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKlxuICAgKiAvLyBDcmVhdGUgYSBzdXBlZC11cCBgZGVmZXJgIGluIE5vZGUuanMuXG4gICAqIHZhciBkZWZlciA9IF8ucnVuSW5Db250ZXh0KHsgJ3NldFRpbWVvdXQnOiBzZXRJbW1lZGlhdGUgfSkuZGVmZXI7XG4gICAqL1xuICB2YXIgcnVuSW5Db250ZXh0ID0gKGZ1bmN0aW9uIHJ1bkluQ29udGV4dChjb250ZXh0KSB7XG4gICAgY29udGV4dCA9IGNvbnRleHQgPT0gbnVsbCA/IHJvb3QgOiBfLmRlZmF1bHRzKHJvb3QuT2JqZWN0KCksIGNvbnRleHQsIF8ucGljayhyb290LCBjb250ZXh0UHJvcHMpKTtcblxuICAgIC8qKiBCdWlsdC1pbiBjb25zdHJ1Y3RvciByZWZlcmVuY2VzLiAqL1xuICAgIHZhciBBcnJheSA9IGNvbnRleHQuQXJyYXksXG4gICAgICAgIERhdGUgPSBjb250ZXh0LkRhdGUsXG4gICAgICAgIEVycm9yID0gY29udGV4dC5FcnJvcixcbiAgICAgICAgRnVuY3Rpb24gPSBjb250ZXh0LkZ1bmN0aW9uLFxuICAgICAgICBNYXRoID0gY29udGV4dC5NYXRoLFxuICAgICAgICBPYmplY3QgPSBjb250ZXh0Lk9iamVjdCxcbiAgICAgICAgUmVnRXhwID0gY29udGV4dC5SZWdFeHAsXG4gICAgICAgIFN0cmluZyA9IGNvbnRleHQuU3RyaW5nLFxuICAgICAgICBUeXBlRXJyb3IgPSBjb250ZXh0LlR5cGVFcnJvcjtcblxuICAgIC8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbiAgICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSxcbiAgICAgICAgZnVuY1Byb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlLFxuICAgICAgICBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbiAgICAvKiogVXNlZCB0byBkZXRlY3Qgb3ZlcnJlYWNoaW5nIGNvcmUtanMgc2hpbXMuICovXG4gICAgdmFyIGNvcmVKc0RhdGEgPSBjb250ZXh0WydfX2NvcmUtanNfc2hhcmVkX18nXTtcblxuICAgIC8qKiBVc2VkIHRvIHJlc29sdmUgdGhlIGRlY29tcGlsZWQgc291cmNlIG9mIGZ1bmN0aW9ucy4gKi9cbiAgICB2YXIgZnVuY1RvU3RyaW5nID0gZnVuY1Byb3RvLnRvU3RyaW5nO1xuXG4gICAgLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG4gICAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbiAgICAvKiogVXNlZCB0byBnZW5lcmF0ZSB1bmlxdWUgSURzLiAqL1xuICAgIHZhciBpZENvdW50ZXIgPSAwO1xuXG4gICAgLyoqIFVzZWQgdG8gZGV0ZWN0IG1ldGhvZHMgbWFzcXVlcmFkaW5nIGFzIG5hdGl2ZS4gKi9cbiAgICB2YXIgbWFza1NyY0tleSA9IChmdW5jdGlvbigpIHtcbiAgICAgIHZhciB1aWQgPSAvW14uXSskLy5leGVjKGNvcmVKc0RhdGEgJiYgY29yZUpzRGF0YS5rZXlzICYmIGNvcmVKc0RhdGEua2V5cy5JRV9QUk9UTyB8fCAnJyk7XG4gICAgICByZXR1cm4gdWlkID8gKCdTeW1ib2woc3JjKV8xLicgKyB1aWQpIDogJyc7XG4gICAgfSgpKTtcblxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gcmVzb2x2ZSB0aGVcbiAgICAgKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZylcbiAgICAgKiBvZiB2YWx1ZXMuXG4gICAgICovXG4gICAgdmFyIG5hdGl2ZU9iamVjdFRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7XG5cbiAgICAvKiogVXNlZCB0byBpbmZlciB0aGUgYE9iamVjdGAgY29uc3RydWN0b3IuICovXG4gICAgdmFyIG9iamVjdEN0b3JTdHJpbmcgPSBmdW5jVG9TdHJpbmcuY2FsbChPYmplY3QpO1xuXG4gICAgLyoqIFVzZWQgdG8gcmVzdG9yZSB0aGUgb3JpZ2luYWwgYF9gIHJlZmVyZW5jZSBpbiBgXy5ub0NvbmZsaWN0YC4gKi9cbiAgICB2YXIgb2xkRGFzaCA9IHJvb3QuXztcblxuICAgIC8qKiBVc2VkIHRvIGRldGVjdCBpZiBhIG1ldGhvZCBpcyBuYXRpdmUuICovXG4gICAgdmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICtcbiAgICAgIGZ1bmNUb1N0cmluZy5jYWxsKGhhc093blByb3BlcnR5KS5yZXBsYWNlKHJlUmVnRXhwQ2hhciwgJ1xcXFwkJicpXG4gICAgICAucmVwbGFjZSgvaGFzT3duUHJvcGVydHl8KGZ1bmN0aW9uKS4qPyg/PVxcXFxcXCgpfCBmb3IgLis/KD89XFxcXFxcXSkvZywgJyQxLio/JykgKyAnJCdcbiAgICApO1xuXG4gICAgLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovXG4gICAgdmFyIEJ1ZmZlciA9IG1vZHVsZUV4cG9ydHMgPyBjb250ZXh0LkJ1ZmZlciA6IHVuZGVmaW5lZCxcbiAgICAgICAgU3ltYm9sID0gY29udGV4dC5TeW1ib2wsXG4gICAgICAgIFVpbnQ4QXJyYXkgPSBjb250ZXh0LlVpbnQ4QXJyYXksXG4gICAgICAgIGFsbG9jVW5zYWZlID0gQnVmZmVyID8gQnVmZmVyLmFsbG9jVW5zYWZlIDogdW5kZWZpbmVkLFxuICAgICAgICBnZXRQcm90b3R5cGUgPSBvdmVyQXJnKE9iamVjdC5nZXRQcm90b3R5cGVPZiwgT2JqZWN0KSxcbiAgICAgICAgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSxcbiAgICAgICAgcHJvcGVydHlJc0VudW1lcmFibGUgPSBvYmplY3RQcm90by5wcm9wZXJ0eUlzRW51bWVyYWJsZSxcbiAgICAgICAgc3BsaWNlID0gYXJyYXlQcm90by5zcGxpY2UsXG4gICAgICAgIHNwcmVhZGFibGVTeW1ib2wgPSBTeW1ib2wgPyBTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlIDogdW5kZWZpbmVkLFxuICAgICAgICBzeW1JdGVyYXRvciA9IFN5bWJvbCA/IFN5bWJvbC5pdGVyYXRvciA6IHVuZGVmaW5lZCxcbiAgICAgICAgc3ltVG9TdHJpbmdUYWcgPSBTeW1ib2wgPyBTeW1ib2wudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7XG5cbiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSAoZnVuY3Rpb24oKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgZnVuYyA9IGdldE5hdGl2ZShPYmplY3QsICdkZWZpbmVQcm9wZXJ0eScpO1xuICAgICAgICBmdW5jKHt9LCAnJywge30pO1xuICAgICAgICByZXR1cm4gZnVuYztcbiAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgfSgpKTtcblxuICAgIC8qKiBNb2NrZWQgYnVpbHQtaW5zLiAqL1xuICAgIHZhciBjdHhDbGVhclRpbWVvdXQgPSBjb250ZXh0LmNsZWFyVGltZW91dCAhPT0gcm9vdC5jbGVhclRpbWVvdXQgJiYgY29udGV4dC5jbGVhclRpbWVvdXQsXG4gICAgICAgIGN0eE5vdyA9IERhdGUgJiYgRGF0ZS5ub3cgIT09IHJvb3QuRGF0ZS5ub3cgJiYgRGF0ZS5ub3csXG4gICAgICAgIGN0eFNldFRpbWVvdXQgPSBjb250ZXh0LnNldFRpbWVvdXQgIT09IHJvb3Quc2V0VGltZW91dCAmJiBjb250ZXh0LnNldFRpbWVvdXQ7XG5cbiAgICAvKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyBmb3IgdGhvc2Ugd2l0aCB0aGUgc2FtZSBuYW1lIGFzIG90aGVyIGBsb2Rhc2hgIG1ldGhvZHMuICovXG4gICAgdmFyIG5hdGl2ZUNlaWwgPSBNYXRoLmNlaWwsXG4gICAgICAgIG5hdGl2ZUZsb29yID0gTWF0aC5mbG9vcixcbiAgICAgICAgbmF0aXZlR2V0U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMsXG4gICAgICAgIG5hdGl2ZUlzQnVmZmVyID0gQnVmZmVyID8gQnVmZmVyLmlzQnVmZmVyIDogdW5kZWZpbmVkLFxuICAgICAgICBuYXRpdmVJc0Zpbml0ZSA9IGNvbnRleHQuaXNGaW5pdGUsXG4gICAgICAgIG5hdGl2ZUpvaW4gPSBhcnJheVByb3RvLmpvaW4sXG4gICAgICAgIG5hdGl2ZUtleXMgPSBvdmVyQXJnKE9iamVjdC5rZXlzLCBPYmplY3QpLFxuICAgICAgICBuYXRpdmVNYXggPSBNYXRoLm1heCxcbiAgICAgICAgbmF0aXZlTWluID0gTWF0aC5taW4sXG4gICAgICAgIG5hdGl2ZU5vdyA9IERhdGUubm93LFxuICAgICAgICBuYXRpdmVQYXJzZUludCA9IGNvbnRleHQucGFyc2VJbnQsXG4gICAgICAgIG5hdGl2ZVJhbmRvbSA9IE1hdGgucmFuZG9tLFxuICAgICAgICBuYXRpdmVSZXZlcnNlID0gYXJyYXlQcm90by5yZXZlcnNlO1xuXG4gICAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqL1xuICAgIHZhciBEYXRhVmlldyA9IGdldE5hdGl2ZShjb250ZXh0LCAnRGF0YVZpZXcnKSxcbiAgICAgICAgTWFwID0gZ2V0TmF0aXZlKGNvbnRleHQsICdNYXAnKSxcbiAgICAgICAgUHJvbWlzZSA9IGdldE5hdGl2ZShjb250ZXh0LCAnUHJvbWlzZScpLFxuICAgICAgICBTZXQgPSBnZXROYXRpdmUoY29udGV4dCwgJ1NldCcpLFxuICAgICAgICBXZWFrTWFwID0gZ2V0TmF0aXZlKGNvbnRleHQsICdXZWFrTWFwJyksXG4gICAgICAgIG5hdGl2ZUNyZWF0ZSA9IGdldE5hdGl2ZShPYmplY3QsICdjcmVhdGUnKTtcblxuICAgIC8qKiBVc2VkIHRvIHN0b3JlIGZ1bmN0aW9uIG1ldGFkYXRhLiAqL1xuICAgIHZhciBtZXRhTWFwID0gV2Vha01hcCAmJiBuZXcgV2Vha01hcDtcblxuICAgIC8qKiBVc2VkIHRvIGxvb2t1cCB1bm1pbmlmaWVkIGZ1bmN0aW9uIG5hbWVzLiAqL1xuICAgIHZhciByZWFsTmFtZXMgPSB7fTtcblxuICAgIC8qKiBVc2VkIHRvIGRldGVjdCBtYXBzLCBzZXRzLCBhbmQgd2Vha21hcHMuICovXG4gICAgdmFyIGRhdGFWaWV3Q3RvclN0cmluZyA9IHRvU291cmNlKERhdGFWaWV3KSxcbiAgICAgICAgbWFwQ3RvclN0cmluZyA9IHRvU291cmNlKE1hcCksXG4gICAgICAgIHByb21pc2VDdG9yU3RyaW5nID0gdG9Tb3VyY2UoUHJvbWlzZSksXG4gICAgICAgIHNldEN0b3JTdHJpbmcgPSB0b1NvdXJjZShTZXQpLFxuICAgICAgICB3ZWFrTWFwQ3RvclN0cmluZyA9IHRvU291cmNlKFdlYWtNYXApO1xuXG4gICAgLyoqIFVzZWQgdG8gY29udmVydCBzeW1ib2xzIHRvIHByaW1pdGl2ZXMgYW5kIHN0cmluZ3MuICovXG4gICAgdmFyIHN5bWJvbFByb3RvID0gU3ltYm9sID8gU3ltYm9sLnByb3RvdHlwZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZCxcbiAgICAgICAgc3ltYm9sVG9TdHJpbmcgPSBzeW1ib2xQcm90byA/IHN5bWJvbFByb3RvLnRvU3RyaW5nIDogdW5kZWZpbmVkO1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGBsb2Rhc2hgIG9iamVjdCB3aGljaCB3cmFwcyBgdmFsdWVgIHRvIGVuYWJsZSBpbXBsaWNpdCBtZXRob2RcbiAgICAgKiBjaGFpbiBzZXF1ZW5jZXMuIE1ldGhvZHMgdGhhdCBvcGVyYXRlIG9uIGFuZCByZXR1cm4gYXJyYXlzLCBjb2xsZWN0aW9ucyxcbiAgICAgKiBhbmQgZnVuY3Rpb25zIGNhbiBiZSBjaGFpbmVkIHRvZ2V0aGVyLiBNZXRob2RzIHRoYXQgcmV0cmlldmUgYSBzaW5nbGUgdmFsdWVcbiAgICAgKiBvciBtYXkgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlIHdpbGwgYXV0b21hdGljYWxseSBlbmQgdGhlIGNoYWluIHNlcXVlbmNlXG4gICAgICogYW5kIHJldHVybiB0aGUgdW53cmFwcGVkIHZhbHVlLiBPdGhlcndpc2UsIHRoZSB2YWx1ZSBtdXN0IGJlIHVud3JhcHBlZFxuICAgICAqIHdpdGggYF8jdmFsdWVgLlxuICAgICAqXG4gICAgICogRXhwbGljaXQgY2hhaW4gc2VxdWVuY2VzLCB3aGljaCBtdXN0IGJlIHVud3JhcHBlZCB3aXRoIGBfI3ZhbHVlYCwgbWF5IGJlXG4gICAgICogZW5hYmxlZCB1c2luZyBgXy5jaGFpbmAuXG4gICAgICpcbiAgICAgKiBUaGUgZXhlY3V0aW9uIG9mIGNoYWluZWQgbWV0aG9kcyBpcyBsYXp5LCB0aGF0IGlzLCBpdCdzIGRlZmVycmVkIHVudGlsXG4gICAgICogYF8jdmFsdWVgIGlzIGltcGxpY2l0bHkgb3IgZXhwbGljaXRseSBjYWxsZWQuXG4gICAgICpcbiAgICAgKiBMYXp5IGV2YWx1YXRpb24gYWxsb3dzIHNldmVyYWwgbWV0aG9kcyB0byBzdXBwb3J0IHNob3J0Y3V0IGZ1c2lvbi5cbiAgICAgKiBTaG9ydGN1dCBmdXNpb24gaXMgYW4gb3B0aW1pemF0aW9uIHRvIG1lcmdlIGl0ZXJhdGVlIGNhbGxzOyB0aGlzIGF2b2lkc1xuICAgICAqIHRoZSBjcmVhdGlvbiBvZiBpbnRlcm1lZGlhdGUgYXJyYXlzIGFuZCBjYW4gZ3JlYXRseSByZWR1Y2UgdGhlIG51bWJlciBvZlxuICAgICAqIGl0ZXJhdGVlIGV4ZWN1dGlvbnMuIFNlY3Rpb25zIG9mIGEgY2hhaW4gc2VxdWVuY2UgcXVhbGlmeSBmb3Igc2hvcnRjdXRcbiAgICAgKiBmdXNpb24gaWYgdGhlIHNlY3Rpb24gaXMgYXBwbGllZCB0byBhbiBhcnJheSBhbmQgaXRlcmF0ZWVzIGFjY2VwdCBvbmx5XG4gICAgICogb25lIGFyZ3VtZW50LiBUaGUgaGV1cmlzdGljIGZvciB3aGV0aGVyIGEgc2VjdGlvbiBxdWFsaWZpZXMgZm9yIHNob3J0Y3V0XG4gICAgICogZnVzaW9uIGlzIHN1YmplY3QgdG8gY2hhbmdlLlxuICAgICAqXG4gICAgICogQ2hhaW5pbmcgaXMgc3VwcG9ydGVkIGluIGN1c3RvbSBidWlsZHMgYXMgbG9uZyBhcyB0aGUgYF8jdmFsdWVgIG1ldGhvZCBpc1xuICAgICAqIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkgaW5jbHVkZWQgaW4gdGhlIGJ1aWxkLlxuICAgICAqXG4gICAgICogSW4gYWRkaXRpb24gdG8gbG9kYXNoIG1ldGhvZHMsIHdyYXBwZXJzIGhhdmUgYEFycmF5YCBhbmQgYFN0cmluZ2AgbWV0aG9kcy5cbiAgICAgKlxuICAgICAqIFRoZSB3cmFwcGVyIGBBcnJheWAgbWV0aG9kcyBhcmU6XG4gICAgICogYGNvbmNhdGAsIGBqb2luYCwgYHBvcGAsIGBwdXNoYCwgYHNoaWZ0YCwgYHNvcnRgLCBgc3BsaWNlYCwgYW5kIGB1bnNoaWZ0YFxuICAgICAqXG4gICAgICogVGhlIHdyYXBwZXIgYFN0cmluZ2AgbWV0aG9kcyBhcmU6XG4gICAgICogYHJlcGxhY2VgIGFuZCBgc3BsaXRgXG4gICAgICpcbiAgICAgKiBUaGUgd3JhcHBlciBtZXRob2RzIHRoYXQgc3VwcG9ydCBzaG9ydGN1dCBmdXNpb24gYXJlOlxuICAgICAqIGBhdGAsIGBjb21wYWN0YCwgYGRyb3BgLCBgZHJvcFJpZ2h0YCwgYGRyb3BXaGlsZWAsIGBmaWx0ZXJgLCBgZmluZGAsXG4gICAgICogYGZpbmRMYXN0YCwgYGhlYWRgLCBgaW5pdGlhbGAsIGBsYXN0YCwgYG1hcGAsIGByZWplY3RgLCBgcmV2ZXJzZWAsIGBzbGljZWAsXG4gICAgICogYHRhaWxgLCBgdGFrZWAsIGB0YWtlUmlnaHRgLCBgdGFrZVJpZ2h0V2hpbGVgLCBgdGFrZVdoaWxlYCwgYW5kIGB0b0FycmF5YFxuICAgICAqXG4gICAgICogVGhlIGNoYWluYWJsZSB3cmFwcGVyIG1ldGhvZHMgYXJlOlxuICAgICAqIGBhZnRlcmAsIGBhcnlgLCBgYXNzaWduYCwgYGFzc2lnbkluYCwgYGFzc2lnbkluV2l0aGAsIGBhc3NpZ25XaXRoYCwgYGF0YCxcbiAgICAgKiBgYmVmb3JlYCwgYGJpbmRgLCBgYmluZEFsbGAsIGBiaW5kS2V5YCwgYGNhc3RBcnJheWAsIGBjaGFpbmAsIGBjaHVua2AsXG4gICAgICogYGNvbW1pdGAsIGBjb21wYWN0YCwgYGNvbmNhdGAsIGBjb25mb3Jtc2AsIGBjb25zdGFudGAsIGBjb3VudEJ5YCwgYGNyZWF0ZWAsXG4gICAgICogYGN1cnJ5YCwgYGRlYm91bmNlYCwgYGRlZmF1bHRzYCwgYGRlZmF1bHRzRGVlcGAsIGBkZWZlcmAsIGBkZWxheWAsXG4gICAgICogYGRpZmZlcmVuY2VgLCBgZGlmZmVyZW5jZUJ5YCwgYGRpZmZlcmVuY2VXaXRoYCwgYGRyb3BgLCBgZHJvcFJpZ2h0YCxcbiAgICAgKiBgZHJvcFJpZ2h0V2hpbGVgLCBgZHJvcFdoaWxlYCwgYGV4dGVuZGAsIGBleHRlbmRXaXRoYCwgYGZpbGxgLCBgZmlsdGVyYCxcbiAgICAgKiBgZmxhdE1hcGAsIGBmbGF0TWFwRGVlcGAsIGBmbGF0TWFwRGVwdGhgLCBgZmxhdHRlbmAsIGBmbGF0dGVuRGVlcGAsXG4gICAgICogYGZsYXR0ZW5EZXB0aGAsIGBmbGlwYCwgYGZsb3dgLCBgZmxvd1JpZ2h0YCwgYGZyb21QYWlyc2AsIGBmdW5jdGlvbnNgLFxuICAgICAqIGBmdW5jdGlvbnNJbmAsIGBncm91cEJ5YCwgYGluaXRpYWxgLCBgaW50ZXJzZWN0aW9uYCwgYGludGVyc2VjdGlvbkJ5YCxcbiAgICAgKiBgaW50ZXJzZWN0aW9uV2l0aGAsIGBpbnZlcnRgLCBgaW52ZXJ0QnlgLCBgaW52b2tlTWFwYCwgYGl0ZXJhdGVlYCwgYGtleUJ5YCxcbiAgICAgKiBga2V5c2AsIGBrZXlzSW5gLCBgbWFwYCwgYG1hcEtleXNgLCBgbWFwVmFsdWVzYCwgYG1hdGNoZXNgLCBgbWF0Y2hlc1Byb3BlcnR5YCxcbiAgICAgKiBgbWVtb2l6ZWAsIGBtZXJnZWAsIGBtZXJnZVdpdGhgLCBgbWV0aG9kYCwgYG1ldGhvZE9mYCwgYG1peGluYCwgYG5lZ2F0ZWAsXG4gICAgICogYG50aEFyZ2AsIGBvbWl0YCwgYG9taXRCeWAsIGBvbmNlYCwgYG9yZGVyQnlgLCBgb3ZlcmAsIGBvdmVyQXJnc2AsXG4gICAgICogYG92ZXJFdmVyeWAsIGBvdmVyU29tZWAsIGBwYXJ0aWFsYCwgYHBhcnRpYWxSaWdodGAsIGBwYXJ0aXRpb25gLCBgcGlja2AsXG4gICAgICogYHBpY2tCeWAsIGBwbGFudGAsIGBwcm9wZXJ0eWAsIGBwcm9wZXJ0eU9mYCwgYHB1bGxgLCBgcHVsbEFsbGAsIGBwdWxsQWxsQnlgLFxuICAgICAqIGBwdWxsQWxsV2l0aGAsIGBwdWxsQXRgLCBgcHVzaGAsIGByYW5nZWAsIGByYW5nZVJpZ2h0YCwgYHJlYXJnYCwgYHJlamVjdGAsXG4gICAgICogYHJlbW92ZWAsIGByZXN0YCwgYHJldmVyc2VgLCBgc2FtcGxlU2l6ZWAsIGBzZXRgLCBgc2V0V2l0aGAsIGBzaHVmZmxlYCxcbiAgICAgKiBgc2xpY2VgLCBgc29ydGAsIGBzb3J0QnlgLCBgc3BsaWNlYCwgYHNwcmVhZGAsIGB0YWlsYCwgYHRha2VgLCBgdGFrZVJpZ2h0YCxcbiAgICAgKiBgdGFrZVJpZ2h0V2hpbGVgLCBgdGFrZVdoaWxlYCwgYHRhcGAsIGB0aHJvdHRsZWAsIGB0aHJ1YCwgYHRvQXJyYXlgLFxuICAgICAqIGB0b1BhaXJzYCwgYHRvUGFpcnNJbmAsIGB0b1BhdGhgLCBgdG9QbGFpbk9iamVjdGAsIGB0cmFuc2Zvcm1gLCBgdW5hcnlgLFxuICAgICAqIGB1bmlvbmAsIGB1bmlvbkJ5YCwgYHVuaW9uV2l0aGAsIGB1bmlxYCwgYHVuaXFCeWAsIGB1bmlxV2l0aGAsIGB1bnNldGAsXG4gICAgICogYHVuc2hpZnRgLCBgdW56aXBgLCBgdW56aXBXaXRoYCwgYHVwZGF0ZWAsIGB1cGRhdGVXaXRoYCwgYHZhbHVlc2AsXG4gICAgICogYHZhbHVlc0luYCwgYHdpdGhvdXRgLCBgd3JhcGAsIGB4b3JgLCBgeG9yQnlgLCBgeG9yV2l0aGAsIGB6aXBgLFxuICAgICAqIGB6aXBPYmplY3RgLCBgemlwT2JqZWN0RGVlcGAsIGFuZCBgemlwV2l0aGBcbiAgICAgKlxuICAgICAqIFRoZSB3cmFwcGVyIG1ldGhvZHMgdGhhdCBhcmUgKipub3QqKiBjaGFpbmFibGUgYnkgZGVmYXVsdCBhcmU6XG4gICAgICogYGFkZGAsIGBhdHRlbXB0YCwgYGNhbWVsQ2FzZWAsIGBjYXBpdGFsaXplYCwgYGNlaWxgLCBgY2xhbXBgLCBgY2xvbmVgLFxuICAgICAqIGBjbG9uZURlZXBgLCBgY2xvbmVEZWVwV2l0aGAsIGBjbG9uZVdpdGhgLCBgY29uZm9ybXNUb2AsIGBkZWJ1cnJgLFxuICAgICAqIGBkZWZhdWx0VG9gLCBgZGl2aWRlYCwgYGVhY2hgLCBgZWFjaFJpZ2h0YCwgYGVuZHNXaXRoYCwgYGVxYCwgYGVzY2FwZWAsXG4gICAgICogYGVzY2FwZVJlZ0V4cGAsIGBldmVyeWAsIGBmaW5kYCwgYGZpbmRJbmRleGAsIGBmaW5kS2V5YCwgYGZpbmRMYXN0YCxcbiAgICAgKiBgZmluZExhc3RJbmRleGAsIGBmaW5kTGFzdEtleWAsIGBmaXJzdGAsIGBmbG9vcmAsIGBmb3JFYWNoYCwgYGZvckVhY2hSaWdodGAsXG4gICAgICogYGZvckluYCwgYGZvckluUmlnaHRgLCBgZm9yT3duYCwgYGZvck93blJpZ2h0YCwgYGdldGAsIGBndGAsIGBndGVgLCBgaGFzYCxcbiAgICAgKiBgaGFzSW5gLCBgaGVhZGAsIGBpZGVudGl0eWAsIGBpbmNsdWRlc2AsIGBpbmRleE9mYCwgYGluUmFuZ2VgLCBgaW52b2tlYCxcbiAgICAgKiBgaXNBcmd1bWVudHNgLCBgaXNBcnJheWAsIGBpc0FycmF5QnVmZmVyYCwgYGlzQXJyYXlMaWtlYCwgYGlzQXJyYXlMaWtlT2JqZWN0YCxcbiAgICAgKiBgaXNCb29sZWFuYCwgYGlzQnVmZmVyYCwgYGlzRGF0ZWAsIGBpc0VsZW1lbnRgLCBgaXNFbXB0eWAsIGBpc0VxdWFsYCxcbiAgICAgKiBgaXNFcXVhbFdpdGhgLCBgaXNFcnJvcmAsIGBpc0Zpbml0ZWAsIGBpc0Z1bmN0aW9uYCwgYGlzSW50ZWdlcmAsIGBpc0xlbmd0aGAsXG4gICAgICogYGlzTWFwYCwgYGlzTWF0Y2hgLCBgaXNNYXRjaFdpdGhgLCBgaXNOYU5gLCBgaXNOYXRpdmVgLCBgaXNOaWxgLCBgaXNOdWxsYCxcbiAgICAgKiBgaXNOdW1iZXJgLCBgaXNPYmplY3RgLCBgaXNPYmplY3RMaWtlYCwgYGlzUGxhaW5PYmplY3RgLCBgaXNSZWdFeHBgLFxuICAgICAqIGBpc1NhZmVJbnRlZ2VyYCwgYGlzU2V0YCwgYGlzU3RyaW5nYCwgYGlzVW5kZWZpbmVkYCwgYGlzVHlwZWRBcnJheWAsXG4gICAgICogYGlzV2Vha01hcGAsIGBpc1dlYWtTZXRgLCBgam9pbmAsIGBrZWJhYkNhc2VgLCBgbGFzdGAsIGBsYXN0SW5kZXhPZmAsXG4gICAgICogYGxvd2VyQ2FzZWAsIGBsb3dlckZpcnN0YCwgYGx0YCwgYGx0ZWAsIGBtYXhgLCBgbWF4QnlgLCBgbWVhbmAsIGBtZWFuQnlgLFxuICAgICAqIGBtaW5gLCBgbWluQnlgLCBgbXVsdGlwbHlgLCBgbm9Db25mbGljdGAsIGBub29wYCwgYG5vd2AsIGBudGhgLCBgcGFkYCxcbiAgICAgKiBgcGFkRW5kYCwgYHBhZFN0YXJ0YCwgYHBhcnNlSW50YCwgYHBvcGAsIGByYW5kb21gLCBgcmVkdWNlYCwgYHJlZHVjZVJpZ2h0YCxcbiAgICAgKiBgcmVwZWF0YCwgYHJlc3VsdGAsIGByb3VuZGAsIGBydW5JbkNvbnRleHRgLCBgc2FtcGxlYCwgYHNoaWZ0YCwgYHNpemVgLFxuICAgICAqIGBzbmFrZUNhc2VgLCBgc29tZWAsIGBzb3J0ZWRJbmRleGAsIGBzb3J0ZWRJbmRleEJ5YCwgYHNvcnRlZExhc3RJbmRleGAsXG4gICAgICogYHNvcnRlZExhc3RJbmRleEJ5YCwgYHN0YXJ0Q2FzZWAsIGBzdGFydHNXaXRoYCwgYHN0dWJBcnJheWAsIGBzdHViRmFsc2VgLFxuICAgICAqIGBzdHViT2JqZWN0YCwgYHN0dWJTdHJpbmdgLCBgc3R1YlRydWVgLCBgc3VidHJhY3RgLCBgc3VtYCwgYHN1bUJ5YCxcbiAgICAgKiBgdGVtcGxhdGVgLCBgdGltZXNgLCBgdG9GaW5pdGVgLCBgdG9JbnRlZ2VyYCwgYHRvSlNPTmAsIGB0b0xlbmd0aGAsXG4gICAgICogYHRvTG93ZXJgLCBgdG9OdW1iZXJgLCBgdG9TYWZlSW50ZWdlcmAsIGB0b1N0cmluZ2AsIGB0b1VwcGVyYCwgYHRyaW1gLFxuICAgICAqIGB0cmltRW5kYCwgYHRyaW1TdGFydGAsIGB0cnVuY2F0ZWAsIGB1bmVzY2FwZWAsIGB1bmlxdWVJZGAsIGB1cHBlckNhc2VgLFxuICAgICAqIGB1cHBlckZpcnN0YCwgYHZhbHVlYCwgYW5kIGB3b3Jkc2BcbiAgICAgKlxuICAgICAqIEBuYW1lIF9cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VxXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gd3JhcCBpbiBhIGBsb2Rhc2hgIGluc3RhbmNlLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBgbG9kYXNoYCB3cmFwcGVyIGluc3RhbmNlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBzcXVhcmUobikge1xuICAgICAqICAgcmV0dXJuIG4gKiBuO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIHZhciB3cmFwcGVkID0gXyhbMSwgMiwgM10pO1xuICAgICAqXG4gICAgICogLy8gUmV0dXJucyBhbiB1bndyYXBwZWQgdmFsdWUuXG4gICAgICogd3JhcHBlZC5yZWR1Y2UoXy5hZGQpO1xuICAgICAqIC8vID0+IDZcbiAgICAgKlxuICAgICAqIC8vIFJldHVybnMgYSB3cmFwcGVkIHZhbHVlLlxuICAgICAqIHZhciBzcXVhcmVzID0gd3JhcHBlZC5tYXAoc3F1YXJlKTtcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheShzcXVhcmVzKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc0FycmF5KHNxdWFyZXMudmFsdWUoKSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxvZGFzaCh2YWx1ZSkge1xuICAgICAgaWYgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzQXJyYXkodmFsdWUpICYmICEodmFsdWUgaW5zdGFuY2VvZiBMYXp5V3JhcHBlcikpIHtcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTG9kYXNoV3JhcHBlcikge1xuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgJ19fd3JhcHBlZF9fJykpIHtcbiAgICAgICAgICByZXR1cm4gd3JhcHBlckNsb25lKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBMb2Rhc2hXcmFwcGVyKHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5jcmVhdGVgIHdpdGhvdXQgc3VwcG9ydCBmb3IgYXNzaWduaW5nXG4gICAgICogcHJvcGVydGllcyB0byB0aGUgY3JlYXRlZCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwcm90byBUaGUgb2JqZWN0IHRvIGluaGVyaXQgZnJvbS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LlxuICAgICAqL1xuICAgIHZhciBiYXNlQ3JlYXRlID0gKGZ1bmN0aW9uKCkge1xuICAgICAgZnVuY3Rpb24gb2JqZWN0KCkge31cbiAgICAgIHJldHVybiBmdW5jdGlvbihwcm90bykge1xuICAgICAgICBpZiAoIWlzT2JqZWN0KHByb3RvKSkge1xuICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqZWN0Q3JlYXRlKSB7XG4gICAgICAgICAgcmV0dXJuIG9iamVjdENyZWF0ZShwcm90byk7XG4gICAgICAgIH1cbiAgICAgICAgb2JqZWN0LnByb3RvdHlwZSA9IHByb3RvO1xuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IG9iamVjdDtcbiAgICAgICAgb2JqZWN0LnByb3RvdHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSgpKTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBmdW5jdGlvbiB3aG9zZSBwcm90b3R5cGUgY2hhaW4gc2VxdWVuY2Ugd3JhcHBlcnMgaW5oZXJpdCBmcm9tLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlTG9kYXNoKCkge1xuICAgICAgLy8gTm8gb3BlcmF0aW9uIHBlcmZvcm1lZC5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBjb25zdHJ1Y3RvciBmb3IgY3JlYXRpbmcgYGxvZGFzaGAgd3JhcHBlciBvYmplY3RzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NoYWluQWxsXSBFbmFibGUgZXhwbGljaXQgbWV0aG9kIGNoYWluIHNlcXVlbmNlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBMb2Rhc2hXcmFwcGVyKHZhbHVlLCBjaGFpbkFsbCkge1xuICAgICAgdGhpcy5fX3dyYXBwZWRfXyA9IHZhbHVlO1xuICAgICAgdGhpcy5fX2FjdGlvbnNfXyA9IFtdO1xuICAgICAgdGhpcy5fX2NoYWluX18gPSAhIWNoYWluQWxsO1xuICAgICAgdGhpcy5fX2luZGV4X18gPSAwO1xuICAgICAgdGhpcy5fX3ZhbHVlc19fID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ5IGRlZmF1bHQsIHRoZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzIHVzZWQgYnkgbG9kYXNoIGFyZSBsaWtlIHRob3NlIGluXG4gICAgICogZW1iZWRkZWQgUnVieSAoRVJCKSBhcyB3ZWxsIGFzIEVTMjAxNSB0ZW1wbGF0ZSBzdHJpbmdzLiBDaGFuZ2UgdGhlXG4gICAgICogZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKi9cbiAgICBsb2Rhc2gudGVtcGxhdGVTZXR0aW5ncyA9IHtcblxuICAgICAgLyoqXG4gICAgICAgKiBVc2VkIHRvIGRldGVjdCBgZGF0YWAgcHJvcGVydHkgdmFsdWVzIHRvIGJlIEhUTUwtZXNjYXBlZC5cbiAgICAgICAqXG4gICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzXG4gICAgICAgKiBAdHlwZSB7UmVnRXhwfVxuICAgICAgICovXG4gICAgICAnZXNjYXBlJzogcmVFc2NhcGUsXG5cbiAgICAgIC8qKlxuICAgICAgICogVXNlZCB0byBkZXRlY3QgY29kZSB0byBiZSBldmFsdWF0ZWQuXG4gICAgICAgKlxuICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5nc1xuICAgICAgICogQHR5cGUge1JlZ0V4cH1cbiAgICAgICAqL1xuICAgICAgJ2V2YWx1YXRlJzogcmVFdmFsdWF0ZSxcblxuICAgICAgLyoqXG4gICAgICAgKiBVc2VkIHRvIGRldGVjdCBgZGF0YWAgcHJvcGVydHkgdmFsdWVzIHRvIGluamVjdC5cbiAgICAgICAqXG4gICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzXG4gICAgICAgKiBAdHlwZSB7UmVnRXhwfVxuICAgICAgICovXG4gICAgICAnaW50ZXJwb2xhdGUnOiByZUludGVycG9sYXRlLFxuXG4gICAgICAvKipcbiAgICAgICAqIFVzZWQgdG8gcmVmZXJlbmNlIHRoZSBkYXRhIG9iamVjdCBpbiB0aGUgdGVtcGxhdGUgdGV4dC5cbiAgICAgICAqXG4gICAgICAgKiBAbWVtYmVyT2YgXy50ZW1wbGF0ZVNldHRpbmdzXG4gICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICovXG4gICAgICAndmFyaWFibGUnOiAnJyxcblxuICAgICAgLyoqXG4gICAgICAgKiBVc2VkIHRvIGltcG9ydCB2YXJpYWJsZXMgaW50byB0aGUgY29tcGlsZWQgdGVtcGxhdGUuXG4gICAgICAgKlxuICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5nc1xuICAgICAgICogQHR5cGUge09iamVjdH1cbiAgICAgICAqL1xuICAgICAgJ2ltcG9ydHMnOiB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgcmVmZXJlbmNlIHRvIHRoZSBgbG9kYXNoYCBmdW5jdGlvbi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5ncy5pbXBvcnRzXG4gICAgICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgICdfJzogbG9kYXNoXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEVuc3VyZSB3cmFwcGVycyBhcmUgaW5zdGFuY2VzIG9mIGBiYXNlTG9kYXNoYC5cbiAgICBsb2Rhc2gucHJvdG90eXBlID0gYmFzZUxvZGFzaC5wcm90b3R5cGU7XG4gICAgbG9kYXNoLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGxvZGFzaDtcblxuICAgIExvZGFzaFdyYXBwZXIucHJvdG90eXBlID0gYmFzZUNyZWF0ZShiYXNlTG9kYXNoLnByb3RvdHlwZSk7XG4gICAgTG9kYXNoV3JhcHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMb2Rhc2hXcmFwcGVyO1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGxhenkgd3JhcHBlciBvYmplY3Qgd2hpY2ggd3JhcHMgYHZhbHVlYCB0byBlbmFibGUgbGF6eSBldmFsdWF0aW9uLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIExhenlXcmFwcGVyKHZhbHVlKSB7XG4gICAgICB0aGlzLl9fd3JhcHBlZF9fID0gdmFsdWU7XG4gICAgICB0aGlzLl9fYWN0aW9uc19fID0gW107XG4gICAgICB0aGlzLl9fZGlyX18gPSAxO1xuICAgICAgdGhpcy5fX2ZpbHRlcmVkX18gPSBmYWxzZTtcbiAgICAgIHRoaXMuX19pdGVyYXRlZXNfXyA9IFtdO1xuICAgICAgdGhpcy5fX3Rha2VDb3VudF9fID0gTUFYX0FSUkFZX0xFTkdUSDtcbiAgICAgIHRoaXMuX192aWV3c19fID0gW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNsb25lIG9mIHRoZSBsYXp5IHdyYXBwZXIgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbmFtZSBjbG9uZVxuICAgICAqIEBtZW1iZXJPZiBMYXp5V3JhcHBlclxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCBgTGF6eVdyYXBwZXJgIG9iamVjdC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsYXp5Q2xvbmUoKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gbmV3IExhenlXcmFwcGVyKHRoaXMuX193cmFwcGVkX18pO1xuICAgICAgcmVzdWx0Ll9fYWN0aW9uc19fID0gY29weUFycmF5KHRoaXMuX19hY3Rpb25zX18pO1xuICAgICAgcmVzdWx0Ll9fZGlyX18gPSB0aGlzLl9fZGlyX187XG4gICAgICByZXN1bHQuX19maWx0ZXJlZF9fID0gdGhpcy5fX2ZpbHRlcmVkX187XG4gICAgICByZXN1bHQuX19pdGVyYXRlZXNfXyA9IGNvcHlBcnJheSh0aGlzLl9faXRlcmF0ZWVzX18pO1xuICAgICAgcmVzdWx0Ll9fdGFrZUNvdW50X18gPSB0aGlzLl9fdGFrZUNvdW50X187XG4gICAgICByZXN1bHQuX192aWV3c19fID0gY29weUFycmF5KHRoaXMuX192aWV3c19fKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV2ZXJzZXMgdGhlIGRpcmVjdGlvbiBvZiBsYXp5IGl0ZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgcmV2ZXJzZVxuICAgICAqIEBtZW1iZXJPZiBMYXp5V3JhcHBlclxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyByZXZlcnNlZCBgTGF6eVdyYXBwZXJgIG9iamVjdC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsYXp5UmV2ZXJzZSgpIHtcbiAgICAgIGlmICh0aGlzLl9fZmlsdGVyZWRfXykge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IExhenlXcmFwcGVyKHRoaXMpO1xuICAgICAgICByZXN1bHQuX19kaXJfXyA9IC0xO1xuICAgICAgICByZXN1bHQuX19maWx0ZXJlZF9fID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuY2xvbmUoKTtcbiAgICAgICAgcmVzdWx0Ll9fZGlyX18gKj0gLTE7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIHRoZSB1bndyYXBwZWQgdmFsdWUgZnJvbSBpdHMgbGF6eSB3cmFwcGVyLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbmFtZSB2YWx1ZVxuICAgICAqIEBtZW1iZXJPZiBMYXp5V3JhcHBlclxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSB1bndyYXBwZWQgdmFsdWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbGF6eVZhbHVlKCkge1xuICAgICAgdmFyIGFycmF5ID0gdGhpcy5fX3dyYXBwZWRfXy52YWx1ZSgpLFxuICAgICAgICAgIGRpciA9IHRoaXMuX19kaXJfXyxcbiAgICAgICAgICBpc0FyciA9IGlzQXJyYXkoYXJyYXkpLFxuICAgICAgICAgIGlzUmlnaHQgPSBkaXIgPCAwLFxuICAgICAgICAgIGFyckxlbmd0aCA9IGlzQXJyID8gYXJyYXkubGVuZ3RoIDogMCxcbiAgICAgICAgICB2aWV3ID0gZ2V0VmlldygwLCBhcnJMZW5ndGgsIHRoaXMuX192aWV3c19fKSxcbiAgICAgICAgICBzdGFydCA9IHZpZXcuc3RhcnQsXG4gICAgICAgICAgZW5kID0gdmlldy5lbmQsXG4gICAgICAgICAgbGVuZ3RoID0gZW5kIC0gc3RhcnQsXG4gICAgICAgICAgaW5kZXggPSBpc1JpZ2h0ID8gZW5kIDogKHN0YXJ0IC0gMSksXG4gICAgICAgICAgaXRlcmF0ZWVzID0gdGhpcy5fX2l0ZXJhdGVlc19fLFxuICAgICAgICAgIGl0ZXJMZW5ndGggPSBpdGVyYXRlZXMubGVuZ3RoLFxuICAgICAgICAgIHJlc0luZGV4ID0gMCxcbiAgICAgICAgICB0YWtlQ291bnQgPSBuYXRpdmVNaW4obGVuZ3RoLCB0aGlzLl9fdGFrZUNvdW50X18pO1xuXG4gICAgICBpZiAoIWlzQXJyIHx8ICghaXNSaWdodCAmJiBhcnJMZW5ndGggPT0gbGVuZ3RoICYmIHRha2VDb3VudCA9PSBsZW5ndGgpKSB7XG4gICAgICAgIHJldHVybiBiYXNlV3JhcHBlclZhbHVlKGFycmF5LCB0aGlzLl9fYWN0aW9uc19fKTtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSBbXTtcblxuICAgICAgb3V0ZXI6XG4gICAgICB3aGlsZSAobGVuZ3RoLS0gJiYgcmVzSW5kZXggPCB0YWtlQ291bnQpIHtcbiAgICAgICAgaW5kZXggKz0gZGlyO1xuXG4gICAgICAgIHZhciBpdGVySW5kZXggPSAtMSxcbiAgICAgICAgICAgIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuXG4gICAgICAgIHdoaWxlICgrK2l0ZXJJbmRleCA8IGl0ZXJMZW5ndGgpIHtcbiAgICAgICAgICB2YXIgZGF0YSA9IGl0ZXJhdGVlc1tpdGVySW5kZXhdLFxuICAgICAgICAgICAgICBpdGVyYXRlZSA9IGRhdGEuaXRlcmF0ZWUsXG4gICAgICAgICAgICAgIHR5cGUgPSBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUodmFsdWUpO1xuXG4gICAgICAgICAgaWYgKHR5cGUgPT0gTEFaWV9NQVBfRkxBRykge1xuICAgICAgICAgICAgdmFsdWUgPSBjb21wdXRlZDtcbiAgICAgICAgICB9IGVsc2UgaWYgKCFjb21wdXRlZCkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT0gTEFaWV9GSUxURVJfRkxBRykge1xuICAgICAgICAgICAgICBjb250aW51ZSBvdXRlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIGBMYXp5V3JhcHBlcmAgaXMgYW4gaW5zdGFuY2Ugb2YgYGJhc2VMb2Rhc2hgLlxuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZSA9IGJhc2VDcmVhdGUoYmFzZUxvZGFzaC5wcm90b3R5cGUpO1xuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExhenlXcmFwcGVyO1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGhhc2ggb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBIYXNoKGVudHJpZXMpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDtcblxuICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07XG4gICAgICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgaGFzaC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgY2xlYXJcbiAgICAgKiBAbWVtYmVyT2YgSGFzaFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhc2hDbGVhcigpIHtcbiAgICAgIHRoaXMuX19kYXRhX18gPSBuYXRpdmVDcmVhdGUgPyBuYXRpdmVDcmVhdGUobnVsbCkgOiB7fTtcbiAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGhhc2guXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGRlbGV0ZVxuICAgICAqIEBtZW1iZXJPZiBIYXNoXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGhhc2ggVGhlIGhhc2ggdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYXNoRGVsZXRlKGtleSkge1xuICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuaGFzKGtleSkgJiYgZGVsZXRlIHRoaXMuX19kYXRhX19ba2V5XTtcbiAgICAgIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgaGFzaCB2YWx1ZSBmb3IgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGdldFxuICAgICAqIEBtZW1iZXJPZiBIYXNoXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhc2hHZXQoa2V5KSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187XG4gICAgICBpZiAobmF0aXZlQ3JlYXRlKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBkYXRhW2tleV07XG4gICAgICAgIHJldHVybiByZXN1bHQgPT09IEhBU0hfVU5ERUZJTkVEID8gdW5kZWZpbmVkIDogcmVzdWx0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSA/IGRhdGFba2V5XSA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYSBoYXNoIHZhbHVlIGZvciBga2V5YCBleGlzdHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGhhc1xuICAgICAqIEBtZW1iZXJPZiBIYXNoXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhc2hIYXMoa2V5KSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187XG4gICAgICByZXR1cm4gbmF0aXZlQ3JlYXRlID8gKGRhdGFba2V5XSAhPT0gdW5kZWZpbmVkKSA6IGhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBoYXNoIGBrZXlgIHRvIGB2YWx1ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIHNldFxuICAgICAqIEBtZW1iZXJPZiBIYXNoXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGhhc2ggaW5zdGFuY2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzaFNldChrZXksIHZhbHVlKSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187XG4gICAgICB0aGlzLnNpemUgKz0gdGhpcy5oYXMoa2V5KSA/IDAgOiAxO1xuICAgICAgZGF0YVtrZXldID0gKG5hdGl2ZUNyZWF0ZSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IEhBU0hfVU5ERUZJTkVEIDogdmFsdWU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBBZGQgbWV0aG9kcyB0byBgSGFzaGAuXG4gICAgSGFzaC5wcm90b3R5cGUuY2xlYXIgPSBoYXNoQ2xlYXI7XG4gICAgSGFzaC5wcm90b3R5cGVbJ2RlbGV0ZSddID0gaGFzaERlbGV0ZTtcbiAgICBIYXNoLnByb3RvdHlwZS5nZXQgPSBoYXNoR2V0O1xuICAgIEhhc2gucHJvdG90eXBlLmhhcyA9IGhhc2hIYXM7XG4gICAgSGFzaC5wcm90b3R5cGUuc2V0ID0gaGFzaFNldDtcblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gbGlzdCBjYWNoZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIExpc3RDYWNoZShlbnRyaWVzKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7XG5cbiAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdO1xuICAgICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGxpc3QgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGNsZWFyXG4gICAgICogQG1lbWJlck9mIExpc3RDYWNoZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxpc3RDYWNoZUNsZWFyKCkge1xuICAgICAgdGhpcy5fX2RhdGFfXyA9IFtdO1xuICAgICAgdGhpcy5zaXplID0gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgbGlzdCBjYWNoZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgZGVsZXRlXG4gICAgICogQG1lbWJlck9mIExpc3RDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsaXN0Q2FjaGVEZWxldGUoa2V5KSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sXG4gICAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTtcblxuICAgICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgbGFzdEluZGV4ID0gZGF0YS5sZW5ndGggLSAxO1xuICAgICAgaWYgKGluZGV4ID09IGxhc3RJbmRleCkge1xuICAgICAgICBkYXRhLnBvcCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3BsaWNlLmNhbGwoZGF0YSwgaW5kZXgsIDEpO1xuICAgICAgfVxuICAgICAgLS10aGlzLnNpemU7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBsaXN0IGNhY2hlIHZhbHVlIGZvciBga2V5YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgZ2V0XG4gICAgICogQG1lbWJlck9mIExpc3RDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsaXN0Q2FjaGVHZXQoa2V5KSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sXG4gICAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTtcblxuICAgICAgcmV0dXJuIGluZGV4IDwgMCA/IHVuZGVmaW5lZCA6IGRhdGFbaW5kZXhdWzFdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBhIGxpc3QgY2FjaGUgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgaGFzXG4gICAgICogQG1lbWJlck9mIExpc3RDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsaXN0Q2FjaGVIYXMoa2V5KSB7XG4gICAgICByZXR1cm4gYXNzb2NJbmRleE9mKHRoaXMuX19kYXRhX18sIGtleSkgPiAtMTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBsaXN0IGNhY2hlIGBrZXlgIHRvIGB2YWx1ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIHNldFxuICAgICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbGlzdCBjYWNoZSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsaXN0Q2FjaGVTZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLFxuICAgICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7XG5cbiAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgKyt0aGlzLnNpemU7XG4gICAgICAgIGRhdGEucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YVtpbmRleF1bMV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEFkZCBtZXRob2RzIHRvIGBMaXN0Q2FjaGVgLlxuICAgIExpc3RDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBsaXN0Q2FjaGVDbGVhcjtcbiAgICBMaXN0Q2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IGxpc3RDYWNoZURlbGV0ZTtcbiAgICBMaXN0Q2FjaGUucHJvdG90eXBlLmdldCA9IGxpc3RDYWNoZUdldDtcbiAgICBMaXN0Q2FjaGUucHJvdG90eXBlLmhhcyA9IGxpc3RDYWNoZUhhcztcbiAgICBMaXN0Q2FjaGUucHJvdG90eXBlLnNldCA9IGxpc3RDYWNoZVNldDtcblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBtYXAgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gTWFwQ2FjaGUoZW50cmllcykge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoO1xuXG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTtcbiAgICAgICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFsbCBrZXktdmFsdWUgZW50cmllcyBmcm9tIHRoZSBtYXAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGNsZWFyXG4gICAgICogQG1lbWJlck9mIE1hcENhY2hlXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwQ2FjaGVDbGVhcigpIHtcbiAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgICB0aGlzLl9fZGF0YV9fID0ge1xuICAgICAgICAnaGFzaCc6IG5ldyBIYXNoLFxuICAgICAgICAnbWFwJzogbmV3IChNYXAgfHwgTGlzdENhY2hlKSxcbiAgICAgICAgJ3N0cmluZyc6IG5ldyBIYXNoXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBtYXAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGRlbGV0ZVxuICAgICAqIEBtZW1iZXJPZiBNYXBDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXBDYWNoZURlbGV0ZShrZXkpIHtcbiAgICAgIHZhciByZXN1bHQgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSlbJ2RlbGV0ZSddKGtleSk7XG4gICAgICB0aGlzLnNpemUgLT0gcmVzdWx0ID8gMSA6IDA7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG1hcCB2YWx1ZSBmb3IgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGdldFxuICAgICAqIEBtZW1iZXJPZiBNYXBDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXBDYWNoZUdldChrZXkpIHtcbiAgICAgIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuZ2V0KGtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgbWFwIHZhbHVlIGZvciBga2V5YCBleGlzdHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIGhhc1xuICAgICAqIEBtZW1iZXJPZiBNYXBDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXBDYWNoZUhhcyhrZXkpIHtcbiAgICAgIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuaGFzKGtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgbWFwIGBrZXlgIHRvIGB2YWx1ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBuYW1lIHNldFxuICAgICAqIEBtZW1iZXJPZiBNYXBDYWNoZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBtYXAgY2FjaGUgaW5zdGFuY2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwQ2FjaGVTZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgdmFyIGRhdGEgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSksXG4gICAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTtcblxuICAgICAgZGF0YS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB0aGlzLnNpemUgKz0gZGF0YS5zaXplID09IHNpemUgPyAwIDogMTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEFkZCBtZXRob2RzIHRvIGBNYXBDYWNoZWAuXG4gICAgTWFwQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gbWFwQ2FjaGVDbGVhcjtcbiAgICBNYXBDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbWFwQ2FjaGVEZWxldGU7XG4gICAgTWFwQ2FjaGUucHJvdG90eXBlLmdldCA9IG1hcENhY2hlR2V0O1xuICAgIE1hcENhY2hlLnByb3RvdHlwZS5oYXMgPSBtYXBDYWNoZUhhcztcbiAgICBNYXBDYWNoZS5wcm90b3R5cGUuc2V0ID0gbWFwQ2FjaGVTZXQ7XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIHVuaXF1ZSB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gY2FjaGUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gU2V0Q2FjaGUodmFsdWVzKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSB2YWx1ZXMgPT0gbnVsbCA/IDAgOiB2YWx1ZXMubGVuZ3RoO1xuXG4gICAgICB0aGlzLl9fZGF0YV9fID0gbmV3IE1hcENhY2hlO1xuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdGhpcy5hZGQodmFsdWVzW2luZGV4XSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBgdmFsdWVgIHRvIHRoZSBhcnJheSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgYWRkXG4gICAgICogQG1lbWJlck9mIFNldENhY2hlXG4gICAgICogQGFsaWFzIHB1c2hcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjYWNoZS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjYWNoZSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXRDYWNoZUFkZCh2YWx1ZSkge1xuICAgICAgdGhpcy5fX2RhdGFfXy5zZXQodmFsdWUsIEhBU0hfVU5ERUZJTkVEKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGluIHRoZSBhcnJheSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgaGFzXG4gICAgICogQG1lbWJlck9mIFNldENhY2hlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0Q2FjaGVIYXModmFsdWUpIHtcbiAgICAgIHJldHVybiB0aGlzLl9fZGF0YV9fLmhhcyh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIG1ldGhvZHMgdG8gYFNldENhY2hlYC5cbiAgICBTZXRDYWNoZS5wcm90b3R5cGUuYWRkID0gU2V0Q2FjaGUucHJvdG90eXBlLnB1c2ggPSBzZXRDYWNoZUFkZDtcbiAgICBTZXRDYWNoZS5wcm90b3R5cGUuaGFzID0gc2V0Q2FjaGVIYXM7XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc3RhY2sgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gU3RhY2soZW50cmllcykge1xuICAgICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fID0gbmV3IExpc3RDYWNoZShlbnRyaWVzKTtcbiAgICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFsbCBrZXktdmFsdWUgZW50cmllcyBmcm9tIHRoZSBzdGFjay5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgY2xlYXJcbiAgICAgKiBAbWVtYmVyT2YgU3RhY2tcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzdGFja0NsZWFyKCkge1xuICAgICAgdGhpcy5fX2RhdGFfXyA9IG5ldyBMaXN0Q2FjaGU7XG4gICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBzdGFjay5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQG5hbWUgZGVsZXRlXG4gICAgICogQG1lbWJlck9mIFN0YWNrXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN0YWNrRGVsZXRlKGtleSkge1xuICAgICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLFxuICAgICAgICAgIHJlc3VsdCA9IGRhdGFbJ2RlbGV0ZSddKGtleSk7XG5cbiAgICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgc3RhY2sgdmFsdWUgZm9yIGBrZXlgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbmFtZSBnZXRcbiAgICAgKiBAbWVtYmVyT2YgU3RhY2tcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3RhY2tHZXQoa2V5KSB7XG4gICAgICByZXR1cm4gdGhpcy5fX2RhdGFfXy5nZXQoa2V5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYSBzdGFjayB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbmFtZSBoYXNcbiAgICAgKiBAbWVtYmVyT2YgU3RhY2tcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3RhY2tIYXMoa2V5KSB7XG4gICAgICByZXR1cm4gdGhpcy5fX2RhdGFfXy5oYXMoa2V5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzdGFjayBga2V5YCB0byBgdmFsdWVgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbmFtZSBzZXRcbiAgICAgKiBAbWVtYmVyT2YgU3RhY2tcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgc3RhY2sgY2FjaGUgaW5zdGFuY2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3RhY2tTZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fO1xuICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBMaXN0Q2FjaGUpIHtcbiAgICAgICAgdmFyIHBhaXJzID0gZGF0YS5fX2RhdGFfXztcbiAgICAgICAgaWYgKCFNYXAgfHwgKHBhaXJzLmxlbmd0aCA8IExBUkdFX0FSUkFZX1NJWkUgLSAxKSkge1xuICAgICAgICAgIHBhaXJzLnB1c2goW2tleSwgdmFsdWVdKTtcbiAgICAgICAgICB0aGlzLnNpemUgPSArK2RhdGEuc2l6ZTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBkYXRhID0gdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZShwYWlycyk7XG4gICAgICB9XG4gICAgICBkYXRhLnNldChrZXksIHZhbHVlKTtcbiAgICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEFkZCBtZXRob2RzIHRvIGBTdGFja2AuXG4gICAgU3RhY2sucHJvdG90eXBlLmNsZWFyID0gc3RhY2tDbGVhcjtcbiAgICBTdGFjay5wcm90b3R5cGVbJ2RlbGV0ZSddID0gc3RhY2tEZWxldGU7XG4gICAgU3RhY2sucHJvdG90eXBlLmdldCA9IHN0YWNrR2V0O1xuICAgIFN0YWNrLnByb3RvdHlwZS5oYXMgPSBzdGFja0hhcztcbiAgICBTdGFjay5wcm90b3R5cGUuc2V0ID0gc3RhY2tTZXQ7XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBhcnJheS1saWtlIGB2YWx1ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFycmF5TGlrZUtleXModmFsdWUsIGluaGVyaXRlZCkge1xuICAgICAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSksXG4gICAgICAgICAgaXNBcmcgPSAhaXNBcnIgJiYgaXNBcmd1bWVudHModmFsdWUpLFxuICAgICAgICAgIGlzQnVmZiA9ICFpc0FyciAmJiAhaXNBcmcgJiYgaXNCdWZmZXIodmFsdWUpLFxuICAgICAgICAgIGlzVHlwZSA9ICFpc0FyciAmJiAhaXNBcmcgJiYgIWlzQnVmZiAmJiBpc1R5cGVkQXJyYXkodmFsdWUpLFxuICAgICAgICAgIHNraXBJbmRleGVzID0gaXNBcnIgfHwgaXNBcmcgfHwgaXNCdWZmIHx8IGlzVHlwZSxcbiAgICAgICAgICByZXN1bHQgPSBza2lwSW5kZXhlcyA/IGJhc2VUaW1lcyh2YWx1ZS5sZW5ndGgsIFN0cmluZykgOiBbXSxcbiAgICAgICAgICBsZW5ndGggPSByZXN1bHQubGVuZ3RoO1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHtcbiAgICAgICAgaWYgKChpbmhlcml0ZWQgfHwgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwga2V5KSkgJiZcbiAgICAgICAgICAgICEoc2tpcEluZGV4ZXMgJiYgKFxuICAgICAgICAgICAgICAgLy8gU2FmYXJpIDkgaGFzIGVudW1lcmFibGUgYGFyZ3VtZW50cy5sZW5ndGhgIGluIHN0cmljdCBtb2RlLlxuICAgICAgICAgICAgICAga2V5ID09ICdsZW5ndGgnIHx8XG4gICAgICAgICAgICAgICAvLyBOb2RlLmpzIDAuMTAgaGFzIGVudW1lcmFibGUgbm9uLWluZGV4IHByb3BlcnRpZXMgb24gYnVmZmVycy5cbiAgICAgICAgICAgICAgIChpc0J1ZmYgJiYgKGtleSA9PSAnb2Zmc2V0JyB8fCBrZXkgPT0gJ3BhcmVudCcpKSB8fFxuICAgICAgICAgICAgICAgLy8gUGhhbnRvbUpTIDIgaGFzIGVudW1lcmFibGUgbm9uLWluZGV4IHByb3BlcnRpZXMgb24gdHlwZWQgYXJyYXlzLlxuICAgICAgICAgICAgICAgKGlzVHlwZSAmJiAoa2V5ID09ICdidWZmZXInIHx8IGtleSA9PSAnYnl0ZUxlbmd0aCcgfHwga2V5ID09ICdieXRlT2Zmc2V0JykpIHx8XG4gICAgICAgICAgICAgICAvLyBTa2lwIGluZGV4IHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgICBpc0luZGV4KGtleSwgbGVuZ3RoKVxuICAgICAgICAgICAgKSkpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5zYW1wbGVgIGZvciBhcnJheXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzYW1wbGUuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJhbmRvbSBlbGVtZW50LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFycmF5U2FtcGxlKGFycmF5KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgcmV0dXJuIGxlbmd0aCA/IGFycmF5W2Jhc2VSYW5kb20oMCwgbGVuZ3RoIC0gMSldIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5zYW1wbGVTaXplYCBmb3IgYXJyYXlzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2FtcGxlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gc2FtcGxlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcmFuZG9tIGVsZW1lbnRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFycmF5U2FtcGxlU2l6ZShhcnJheSwgbikge1xuICAgICAgcmV0dXJuIHNodWZmbGVTZWxmKGNvcHlBcnJheShhcnJheSksIGJhc2VDbGFtcChuLCAwLCBhcnJheS5sZW5ndGgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc2h1ZmZsZWAgZm9yIGFycmF5cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNodWZmbGUuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgc2h1ZmZsZWQgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXJyYXlTaHVmZmxlKGFycmF5KSB7XG4gICAgICByZXR1cm4gc2h1ZmZsZVNlbGYoY29weUFycmF5KGFycmF5KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBhc3NpZ25WYWx1ZWAgZXhjZXB0IHRoYXQgaXQgZG9lc24ndCBhc3NpZ25cbiAgICAgKiBgdW5kZWZpbmVkYCB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBhc3NpZ24uXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYXNzaWduLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFzc2lnbk1lcmdlVmFsdWUob2JqZWN0LCBrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgIWVxKG9iamVjdFtrZXldLCB2YWx1ZSkpIHx8XG4gICAgICAgICAgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkpIHtcbiAgICAgICAgYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWducyBgdmFsdWVgIHRvIGBrZXlgIG9mIGBvYmplY3RgIGlmIHRoZSBleGlzdGluZyB2YWx1ZSBpcyBub3QgZXF1aXZhbGVudFxuICAgICAqIHVzaW5nIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pXG4gICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gYXNzaWduLlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGFzc2lnbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhc3NpZ25WYWx1ZShvYmplY3QsIGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBvYmpWYWx1ZSA9IG9iamVjdFtrZXldO1xuICAgICAgaWYgKCEoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYgZXEob2JqVmFsdWUsIHZhbHVlKSkgfHxcbiAgICAgICAgICAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSkge1xuICAgICAgICBiYXNlQXNzaWduVmFsdWUob2JqZWN0LCBrZXksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgYGtleWAgaXMgZm91bmQgaW4gYGFycmF5YCBvZiBrZXktdmFsdWUgcGFpcnMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFzc29jSW5kZXhPZihhcnJheSwga2V5KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIGlmIChlcShhcnJheVtsZW5ndGhdWzBdLCBrZXkpKSB7XG4gICAgICAgICAgcmV0dXJuIGxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFnZ3JlZ2F0ZXMgZWxlbWVudHMgb2YgYGNvbGxlY3Rpb25gIG9uIGBhY2N1bXVsYXRvcmAgd2l0aCBrZXlzIHRyYW5zZm9ybWVkXG4gICAgICogYnkgYGl0ZXJhdGVlYCBhbmQgdmFsdWVzIHNldCBieSBgc2V0dGVyYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHNldHRlciBUaGUgZnVuY3Rpb24gdG8gc2V0IGBhY2N1bXVsYXRvcmAgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBpdGVyYXRlZSB0byB0cmFuc2Zvcm0ga2V5cy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gYWNjdW11bGF0b3IgVGhlIGluaXRpYWwgYWdncmVnYXRlZCBvYmplY3QuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIGBhY2N1bXVsYXRvcmAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUFnZ3JlZ2F0b3IoY29sbGVjdGlvbiwgc2V0dGVyLCBpdGVyYXRlZSwgYWNjdW11bGF0b3IpIHtcbiAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgc2V0dGVyKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaXRlcmF0ZWUodmFsdWUpLCBjb2xsZWN0aW9uKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmFzc2lnbmAgd2l0aG91dCBzdXBwb3J0IGZvciBtdWx0aXBsZSBzb3VyY2VzXG4gICAgICogb3IgYGN1c3RvbWl6ZXJgIGZ1bmN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIHNvdXJjZSBvYmplY3QuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlQXNzaWduKG9iamVjdCwgc291cmNlKSB7XG4gICAgICByZXR1cm4gb2JqZWN0ICYmIGNvcHlPYmplY3Qoc291cmNlLCBrZXlzKHNvdXJjZSksIG9iamVjdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uYXNzaWduSW5gIHdpdGhvdXQgc3VwcG9ydCBmb3IgbXVsdGlwbGUgc291cmNlc1xuICAgICAqIG9yIGBjdXN0b21pemVyYCBmdW5jdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUFzc2lnbkluKG9iamVjdCwgc291cmNlKSB7XG4gICAgICByZXR1cm4gb2JqZWN0ICYmIGNvcHlPYmplY3Qoc291cmNlLCBrZXlzSW4oc291cmNlKSwgb2JqZWN0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgYXNzaWduVmFsdWVgIGFuZCBgYXNzaWduTWVyZ2VWYWx1ZWAgd2l0aG91dFxuICAgICAqIHZhbHVlIGNoZWNrcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGFzc2lnbi5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSkge1xuICAgICAgaWYgKGtleSA9PSAnX19wcm90b19fJyAmJiBkZWZpbmVQcm9wZXJ0eSkge1xuICAgICAgICBkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGtleSwge1xuICAgICAgICAgICdjb25maWd1cmFibGUnOiB0cnVlLFxuICAgICAgICAgICdlbnVtZXJhYmxlJzogdHJ1ZSxcbiAgICAgICAgICAndmFsdWUnOiB2YWx1ZSxcbiAgICAgICAgICAnd3JpdGFibGUnOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5hdGAgd2l0aG91dCBzdXBwb3J0IGZvciBpbmRpdmlkdWFsIHBhdGhzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHBhdGhzIFRoZSBwcm9wZXJ0eSBwYXRocyB0byBwaWNrLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcGlja2VkIGVsZW1lbnRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VBdChvYmplY3QsIHBhdGhzKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBwYXRocy5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKSxcbiAgICAgICAgICBza2lwID0gb2JqZWN0ID09IG51bGw7XG5cbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFtpbmRleF0gPSBza2lwID8gdW5kZWZpbmVkIDogZ2V0KG9iamVjdCwgcGF0aHNbaW5kZXhdKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2xhbXBgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlciBUaGUgbnVtYmVyIHRvIGNsYW1wLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbG93ZXJdIFRoZSBsb3dlciBib3VuZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXIgVGhlIHVwcGVyIGJvdW5kLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNsYW1wZWQgbnVtYmVyLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VDbGFtcChudW1iZXIsIGxvd2VyLCB1cHBlcikge1xuICAgICAgaWYgKG51bWJlciA9PT0gbnVtYmVyKSB7XG4gICAgICAgIGlmICh1cHBlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbnVtYmVyID0gbnVtYmVyIDw9IHVwcGVyID8gbnVtYmVyIDogdXBwZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvd2VyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBudW1iZXIgPSBudW1iZXIgPj0gbG93ZXIgPyBudW1iZXIgOiBsb3dlcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5jbG9uZWAgYW5kIGBfLmNsb25lRGVlcGAgd2hpY2ggdHJhY2tzXG4gICAgICogdHJhdmVyc2VkIG9iamVjdHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNsb25lLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy5cbiAgICAgKiAgMSAtIERlZXAgY2xvbmVcbiAgICAgKiAgMiAtIEZsYXR0ZW4gaW5oZXJpdGVkIHByb3BlcnRpZXNcbiAgICAgKiAgNCAtIENsb25lIHN5bWJvbHNcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBba2V5XSBUaGUga2V5IG9mIGB2YWx1ZWAuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBwYXJlbnQgb2JqZWN0IG9mIGB2YWx1ZWAuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGFuZCB0aGVpciBjbG9uZSBjb3VudGVycGFydHMuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGNsb25lZCB2YWx1ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlQ2xvbmUodmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGtleSwgb2JqZWN0LCBzdGFjaykge1xuICAgICAgdmFyIHJlc3VsdCxcbiAgICAgICAgICBpc0RlZXAgPSBiaXRtYXNrICYgQ0xPTkVfREVFUF9GTEFHLFxuICAgICAgICAgIGlzRmxhdCA9IGJpdG1hc2sgJiBDTE9ORV9GTEFUX0ZMQUcsXG4gICAgICAgICAgaXNGdWxsID0gYml0bWFzayAmIENMT05FX1NZTUJPTFNfRkxBRztcblxuICAgICAgaWYgKGN1c3RvbWl6ZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gb2JqZWN0ID8gY3VzdG9taXplcih2YWx1ZSwga2V5LCBvYmplY3QsIHN0YWNrKSA6IGN1c3RvbWl6ZXIodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHZhbHVlKTtcbiAgICAgIGlmIChpc0Fycikge1xuICAgICAgICByZXN1bHQgPSBpbml0Q2xvbmVBcnJheSh2YWx1ZSk7XG4gICAgICAgIGlmICghaXNEZWVwKSB7XG4gICAgICAgICAgcmV0dXJuIGNvcHlBcnJheSh2YWx1ZSwgcmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRhZyA9IGdldFRhZyh2YWx1ZSksXG4gICAgICAgICAgICBpc0Z1bmMgPSB0YWcgPT0gZnVuY1RhZyB8fCB0YWcgPT0gZ2VuVGFnO1xuXG4gICAgICAgIGlmIChpc0J1ZmZlcih2YWx1ZSkpIHtcbiAgICAgICAgICByZXR1cm4gY2xvbmVCdWZmZXIodmFsdWUsIGlzRGVlcCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhZyA9PSBvYmplY3RUYWcgfHwgdGFnID09IGFyZ3NUYWcgfHwgKGlzRnVuYyAmJiAhb2JqZWN0KSkge1xuICAgICAgICAgIHJlc3VsdCA9IChpc0ZsYXQgfHwgaXNGdW5jKSA/IHt9IDogaW5pdENsb25lT2JqZWN0KHZhbHVlKTtcbiAgICAgICAgICBpZiAoIWlzRGVlcCkge1xuICAgICAgICAgICAgcmV0dXJuIGlzRmxhdFxuICAgICAgICAgICAgICA/IGNvcHlTeW1ib2xzSW4odmFsdWUsIGJhc2VBc3NpZ25JbihyZXN1bHQsIHZhbHVlKSlcbiAgICAgICAgICAgICAgOiBjb3B5U3ltYm9scyh2YWx1ZSwgYmFzZUFzc2lnbihyZXN1bHQsIHZhbHVlKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghY2xvbmVhYmxlVGFnc1t0YWddKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0ID8gdmFsdWUgOiB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0ID0gaW5pdENsb25lQnlUYWcodmFsdWUsIHRhZywgYmFzZUNsb25lLCBpc0RlZXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBDaGVjayBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBhbmQgcmV0dXJuIGl0cyBjb3JyZXNwb25kaW5nIGNsb25lLlxuICAgICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTtcbiAgICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KHZhbHVlKTtcbiAgICAgIGlmIChzdGFja2VkKSB7XG4gICAgICAgIHJldHVybiBzdGFja2VkO1xuICAgICAgfVxuICAgICAgc3RhY2suc2V0KHZhbHVlLCByZXN1bHQpO1xuXG4gICAgICB2YXIga2V5c0Z1bmMgPSBpc0Z1bGxcbiAgICAgICAgPyAoaXNGbGF0ID8gZ2V0QWxsS2V5c0luIDogZ2V0QWxsS2V5cylcbiAgICAgICAgOiAoaXNGbGF0ID8ga2V5c0luIDoga2V5cyk7XG5cbiAgICAgIHZhciBwcm9wcyA9IGlzQXJyID8gdW5kZWZpbmVkIDoga2V5c0Z1bmModmFsdWUpO1xuICAgICAgYXJyYXlFYWNoKHByb3BzIHx8IHZhbHVlLCBmdW5jdGlvbihzdWJWYWx1ZSwga2V5KSB7XG4gICAgICAgIGlmIChwcm9wcykge1xuICAgICAgICAgIGtleSA9IHN1YlZhbHVlO1xuICAgICAgICAgIHN1YlZhbHVlID0gdmFsdWVba2V5XTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZWN1cnNpdmVseSBwb3B1bGF0ZSBjbG9uZSAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgICAgICBhc3NpZ25WYWx1ZShyZXN1bHQsIGtleSwgYmFzZUNsb25lKHN1YlZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBrZXksIHZhbHVlLCBzdGFjaykpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNvbmZvcm1zYCB3aGljaCBkb2Vzbid0IGNsb25lIGBzb3VyY2VgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgcHJlZGljYXRlcyB0byBjb25mb3JtIHRvLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUNvbmZvcm1zKHNvdXJjZSkge1xuICAgICAgdmFyIHByb3BzID0ga2V5cyhzb3VyY2UpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gYmFzZUNvbmZvcm1zVG8ob2JqZWN0LCBzb3VyY2UsIHByb3BzKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY29uZm9ybXNUb2Agd2hpY2ggYWNjZXB0cyBgcHJvcHNgIHRvIGNoZWNrLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgcHJlZGljYXRlcyB0byBjb25mb3JtIHRvLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBjb25mb3JtcywgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VDb25mb3Jtc1RvKG9iamVjdCwgc291cmNlLCBwcm9wcykge1xuICAgICAgdmFyIGxlbmd0aCA9IHByb3BzLmxlbmd0aDtcbiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gIWxlbmd0aDtcbiAgICAgIH1cbiAgICAgIG9iamVjdCA9IE9iamVjdChvYmplY3QpO1xuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIHZhciBrZXkgPSBwcm9wc1tsZW5ndGhdLFxuICAgICAgICAgICAgcHJlZGljYXRlID0gc291cmNlW2tleV0sXG4gICAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldO1xuXG4gICAgICAgIGlmICgodmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB8fCAhcHJlZGljYXRlKHZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZGVsYXlgIGFuZCBgXy5kZWZlcmAgd2hpY2ggYWNjZXB0cyBgYXJnc2BcbiAgICAgKiB0byBwcm92aWRlIHRvIGBmdW5jYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZGVsYXkuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdhaXQgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gZGVsYXkgaW52b2NhdGlvbi5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBhcmd1bWVudHMgdG8gcHJvdmlkZSB0byBgZnVuY2AuXG4gICAgICogQHJldHVybnMge251bWJlcnxPYmplY3R9IFJldHVybnMgdGhlIHRpbWVyIGlkIG9yIHRpbWVvdXQgb2JqZWN0LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VEZWxheShmdW5jLCB3YWl0LCBhcmdzKSB7XG4gICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHsgZnVuYy5hcHBseSh1bmRlZmluZWQsIGFyZ3MpOyB9LCB3YWl0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZGlmZmVyZW5jZWAgd2l0aG91dCBzdXBwb3J0XG4gICAgICogZm9yIGV4Y2x1ZGluZyBtdWx0aXBsZSBhcnJheXMgb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzLFxuICAgICAgICAgIGlzQ29tbW9uID0gdHJ1ZSxcbiAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0ID0gW10sXG4gICAgICAgICAgdmFsdWVzTGVuZ3RoID0gdmFsdWVzLmxlbmd0aDtcblxuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVyYXRlZSkge1xuICAgICAgICB2YWx1ZXMgPSBhcnJheU1hcCh2YWx1ZXMsIGJhc2VVbmFyeShpdGVyYXRlZSkpO1xuICAgICAgfVxuICAgICAgaWYgKGNvbXBhcmF0b3IpIHtcbiAgICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzV2l0aDtcbiAgICAgICAgaXNDb21tb24gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHZhbHVlcy5sZW5ndGggPj0gTEFSR0VfQVJSQVlfU0laRSkge1xuICAgICAgICBpbmNsdWRlcyA9IGNhY2hlSGFzO1xuICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICB2YWx1ZXMgPSBuZXcgU2V0Q2FjaGUodmFsdWVzKTtcbiAgICAgIH1cbiAgICAgIG91dGVyOlxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLFxuICAgICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA9PSBudWxsID8gdmFsdWUgOiBpdGVyYXRlZSh2YWx1ZSk7XG5cbiAgICAgICAgdmFsdWUgPSAoY29tcGFyYXRvciB8fCB2YWx1ZSAhPT0gMCkgPyB2YWx1ZSA6IDA7XG4gICAgICAgIGlmIChpc0NvbW1vbiAmJiBjb21wdXRlZCA9PT0gY29tcHV0ZWQpIHtcbiAgICAgICAgICB2YXIgdmFsdWVzSW5kZXggPSB2YWx1ZXNMZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKHZhbHVlc0luZGV4LS0pIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbdmFsdWVzSW5kZXhdID09PSBjb21wdXRlZCkge1xuICAgICAgICAgICAgICBjb250aW51ZSBvdXRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFpbmNsdWRlcyh2YWx1ZXMsIGNvbXB1dGVkLCBjb21wYXJhdG9yKSkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JFYWNoYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgYGNvbGxlY3Rpb25gLlxuICAgICAqL1xuICAgIHZhciBiYXNlRWFjaCA9IGNyZWF0ZUJhc2VFYWNoKGJhc2VGb3JPd24pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZm9yRWFjaFJpZ2h0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgYGNvbGxlY3Rpb25gLlxuICAgICAqL1xuICAgIHZhciBiYXNlRWFjaFJpZ2h0ID0gY3JlYXRlQmFzZUVhY2goYmFzZUZvck93blJpZ2h0LCB0cnVlKTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmV2ZXJ5YCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYWxsIGVsZW1lbnRzIHBhc3MgdGhlIHByZWRpY2F0ZSBjaGVjayxcbiAgICAgKiAgZWxzZSBgZmFsc2VgXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUV2ZXJ5KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSkge1xuICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmVzdWx0ID0gISFwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8ubWF4YCBhbmQgYF8ubWluYCB3aGljaCBhY2NlcHRzIGFcbiAgICAgKiBgY29tcGFyYXRvcmAgdG8gZGV0ZXJtaW5lIHRoZSBleHRyZW11bSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBhcmF0b3IgVGhlIGNvbXBhcmF0b3IgdXNlZCB0byBjb21wYXJlIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZXh0cmVtdW0gdmFsdWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUV4dHJlbXVtKGFycmF5LCBpdGVyYXRlZSwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sXG4gICAgICAgICAgICBjdXJyZW50ID0gaXRlcmF0ZWUodmFsdWUpO1xuXG4gICAgICAgIGlmIChjdXJyZW50ICE9IG51bGwgJiYgKGNvbXB1dGVkID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgPyAoY3VycmVudCA9PT0gY3VycmVudCAmJiAhaXNTeW1ib2woY3VycmVudCkpXG4gICAgICAgICAgICAgIDogY29tcGFyYXRvcihjdXJyZW50LCBjb21wdXRlZClcbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICB2YXIgY29tcHV0ZWQgPSBjdXJyZW50LFxuICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5maWxsYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG5cbiAgICAgIHN0YXJ0ID0gdG9JbnRlZ2VyKHN0YXJ0KTtcbiAgICAgIGlmIChzdGFydCA8IDApIHtcbiAgICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTtcbiAgICAgIH1cbiAgICAgIGVuZCA9IChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiBsZW5ndGgpID8gbGVuZ3RoIDogdG9JbnRlZ2VyKGVuZCk7XG4gICAgICBpZiAoZW5kIDwgMCkge1xuICAgICAgICBlbmQgKz0gbGVuZ3RoO1xuICAgICAgfVxuICAgICAgZW5kID0gc3RhcnQgPiBlbmQgPyAwIDogdG9MZW5ndGgoZW5kKTtcbiAgICAgIHdoaWxlIChzdGFydCA8IGVuZCkge1xuICAgICAgICBhcnJheVtzdGFydCsrXSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmZpbHRlcmAgd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmlsdGVyZWQgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUZpbHRlcihjb2xsZWN0aW9uLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikpIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mbGF0dGVuYCB3aXRoIHN1cHBvcnQgZm9yIHJlc3RyaWN0aW5nIGZsYXR0ZW5pbmcuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkZXB0aCBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbcHJlZGljYXRlPWlzRmxhdHRlbmFibGVdIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNTdHJpY3RdIFJlc3RyaWN0IHRvIHZhbHVlcyB0aGF0IHBhc3MgYHByZWRpY2F0ZWAgY2hlY2tzLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHQ9W11dIFRoZSBpbml0aWFsIHJlc3VsdCB2YWx1ZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUZsYXR0ZW4oYXJyYXksIGRlcHRoLCBwcmVkaWNhdGUsIGlzU3RyaWN0LCByZXN1bHQpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcblxuICAgICAgcHJlZGljYXRlIHx8IChwcmVkaWNhdGUgPSBpc0ZsYXR0ZW5hYmxlKTtcbiAgICAgIHJlc3VsdCB8fCAocmVzdWx0ID0gW10pO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07XG4gICAgICAgIGlmIChkZXB0aCA+IDAgJiYgcHJlZGljYXRlKHZhbHVlKSkge1xuICAgICAgICAgIGlmIChkZXB0aCA+IDEpIHtcbiAgICAgICAgICAgIC8vIFJlY3Vyc2l2ZWx5IGZsYXR0ZW4gYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgICAgICAgICBiYXNlRmxhdHRlbih2YWx1ZSwgZGVwdGggLSAxLCBwcmVkaWNhdGUsIGlzU3RyaWN0LCByZXN1bHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcnJheVB1c2gocmVzdWx0LCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFpc1N0cmljdCkge1xuICAgICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBiYXNlRm9yT3duYCB3aGljaCBpdGVyYXRlcyBvdmVyIGBvYmplY3RgXG4gICAgICogcHJvcGVydGllcyByZXR1cm5lZCBieSBga2V5c0Z1bmNgIGFuZCBpbnZva2VzIGBpdGVyYXRlZWAgZm9yIGVhY2ggcHJvcGVydHkuXG4gICAgICogSXRlcmF0ZWUgZnVuY3Rpb25zIG1heSBleGl0IGl0ZXJhdGlvbiBlYXJseSBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqL1xuICAgIHZhciBiYXNlRm9yID0gY3JlYXRlQmFzZUZvcigpO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBiYXNlRm9yYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIHByb3BlcnRpZXNcbiAgICAgKiBpbiB0aGUgb3Bwb3NpdGUgb3JkZXIuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlzRnVuYyBUaGUgZnVuY3Rpb24gdG8gZ2V0IHRoZSBrZXlzIG9mIGBvYmplY3RgLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgdmFyIGJhc2VGb3JSaWdodCA9IGNyZWF0ZUJhc2VGb3IodHJ1ZSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JPd25gIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUZvck93bihvYmplY3QsIGl0ZXJhdGVlKSB7XG4gICAgICByZXR1cm4gb2JqZWN0ICYmIGJhc2VGb3Iob2JqZWN0LCBpdGVyYXRlZSwga2V5cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZm9yT3duUmlnaHRgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUZvck93blJpZ2h0KG9iamVjdCwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiBvYmplY3QgJiYgYmFzZUZvclJpZ2h0KG9iamVjdCwgaXRlcmF0ZWUsIGtleXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmZ1bmN0aW9uc2Agd2hpY2ggY3JlYXRlcyBhbiBhcnJheSBvZlxuICAgICAqIGBvYmplY3RgIGZ1bmN0aW9uIHByb3BlcnR5IG5hbWVzIGZpbHRlcmVkIGZyb20gYHByb3BzYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgVGhlIHByb3BlcnR5IG5hbWVzIHRvIGZpbHRlci5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGZ1bmN0aW9uIG5hbWVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VGdW5jdGlvbnMob2JqZWN0LCBwcm9wcykge1xuICAgICAgcmV0dXJuIGFycmF5RmlsdGVyKHByb3BzLCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgcmV0dXJuIGlzRnVuY3Rpb24ob2JqZWN0W2tleV0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZ2V0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZmF1bHQgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUdldChvYmplY3QsIHBhdGgpIHtcbiAgICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpO1xuXG4gICAgICB2YXIgaW5kZXggPSAwLFxuICAgICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAob2JqZWN0ICE9IG51bGwgJiYgaW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgb2JqZWN0ID0gb2JqZWN0W3RvS2V5KHBhdGhbaW5kZXgrK10pXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoaW5kZXggJiYgaW5kZXggPT0gbGVuZ3RoKSA/IG9iamVjdCA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0QWxsS2V5c2AgYW5kIGBnZXRBbGxLZXlzSW5gIHdoaWNoIHVzZXNcbiAgICAgKiBga2V5c0Z1bmNgIGFuZCBgc3ltYm9sc0Z1bmNgIHRvIGdldCB0aGUgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmRcbiAgICAgKiBzeW1ib2xzIG9mIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzeW1ib2xzRnVuYyBUaGUgZnVuY3Rpb24gdG8gZ2V0IHRoZSBzeW1ib2xzIG9mIGBvYmplY3RgLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUdldEFsbEtleXMob2JqZWN0LCBrZXlzRnVuYywgc3ltYm9sc0Z1bmMpIHtcbiAgICAgIHZhciByZXN1bHQgPSBrZXlzRnVuYyhvYmplY3QpO1xuICAgICAgcmV0dXJuIGlzQXJyYXkob2JqZWN0KSA/IHJlc3VsdCA6IGFycmF5UHVzaChyZXN1bHQsIHN5bWJvbHNGdW5jKG9iamVjdCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBnZXRUYWdgIHdpdGhvdXQgZmFsbGJhY2tzIGZvciBidWdneSBlbnZpcm9ubWVudHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChzeW1Ub1N0cmluZ1RhZyAmJiBzeW1Ub1N0cmluZ1RhZyBpbiBPYmplY3QodmFsdWUpKVxuICAgICAgICA/IGdldFJhd1RhZyh2YWx1ZSlcbiAgICAgICAgOiBvYmplY3RUb1N0cmluZyh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZ3RgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGdyZWF0ZXIgdGhhbiBgb3RoZXJgLFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUd0KHZhbHVlLCBvdGhlcikge1xuICAgICAgcmV0dXJuIHZhbHVlID4gb3RoZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaGFzYCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBrZXkgVGhlIGtleSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUhhcyhvYmplY3QsIGtleSkge1xuICAgICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmhhc0luYCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBrZXkgVGhlIGtleSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUhhc0luKG9iamVjdCwga2V5KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYga2V5IGluIE9iamVjdChvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmluUmFuZ2VgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlciBUaGUgbnVtYmVyIHRvIGNoZWNrLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCBUaGUgc3RhcnQgb2YgdGhlIHJhbmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgcmFuZ2UuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBudW1iZXJgIGlzIGluIHRoZSByYW5nZSwgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VJblJhbmdlKG51bWJlciwgc3RhcnQsIGVuZCkge1xuICAgICAgcmV0dXJuIG51bWJlciA+PSBuYXRpdmVNaW4oc3RhcnQsIGVuZCkgJiYgbnVtYmVyIDwgbmF0aXZlTWF4KHN0YXJ0LCBlbmQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIG1ldGhvZHMgbGlrZSBgXy5pbnRlcnNlY3Rpb25gLCB3aXRob3V0IHN1cHBvcnRcbiAgICAgKiBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcywgdGhhdCBhY2NlcHRzIGFuIGFycmF5IG9mIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheXMgVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2Ygc2hhcmVkIHZhbHVlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSW50ZXJzZWN0aW9uKGFycmF5cywgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHZhciBpbmNsdWRlcyA9IGNvbXBhcmF0b3IgPyBhcnJheUluY2x1ZGVzV2l0aCA6IGFycmF5SW5jbHVkZXMsXG4gICAgICAgICAgbGVuZ3RoID0gYXJyYXlzWzBdLmxlbmd0aCxcbiAgICAgICAgICBvdGhMZW5ndGggPSBhcnJheXMubGVuZ3RoLFxuICAgICAgICAgIG90aEluZGV4ID0gb3RoTGVuZ3RoLFxuICAgICAgICAgIGNhY2hlcyA9IEFycmF5KG90aExlbmd0aCksXG4gICAgICAgICAgbWF4TGVuZ3RoID0gSW5maW5pdHksXG4gICAgICAgICAgcmVzdWx0ID0gW107XG5cbiAgICAgIHdoaWxlIChvdGhJbmRleC0tKSB7XG4gICAgICAgIHZhciBhcnJheSA9IGFycmF5c1tvdGhJbmRleF07XG4gICAgICAgIGlmIChvdGhJbmRleCAmJiBpdGVyYXRlZSkge1xuICAgICAgICAgIGFycmF5ID0gYXJyYXlNYXAoYXJyYXksIGJhc2VVbmFyeShpdGVyYXRlZSkpO1xuICAgICAgICB9XG4gICAgICAgIG1heExlbmd0aCA9IG5hdGl2ZU1pbihhcnJheS5sZW5ndGgsIG1heExlbmd0aCk7XG4gICAgICAgIGNhY2hlc1tvdGhJbmRleF0gPSAhY29tcGFyYXRvciAmJiAoaXRlcmF0ZWUgfHwgKGxlbmd0aCA+PSAxMjAgJiYgYXJyYXkubGVuZ3RoID49IDEyMCkpXG4gICAgICAgICAgPyBuZXcgU2V0Q2FjaGUob3RoSW5kZXggJiYgYXJyYXkpXG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBhcnJheSA9IGFycmF5c1swXTtcblxuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgc2VlbiA9IGNhY2hlc1swXTtcblxuICAgICAgb3V0ZXI6XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCAmJiByZXN1bHQubGVuZ3RoIDwgbWF4TGVuZ3RoKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XSxcbiAgICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSkgOiB2YWx1ZTtcblxuICAgICAgICB2YWx1ZSA9IChjb21wYXJhdG9yIHx8IHZhbHVlICE9PSAwKSA/IHZhbHVlIDogMDtcbiAgICAgICAgaWYgKCEoc2VlblxuICAgICAgICAgICAgICA/IGNhY2hlSGFzKHNlZW4sIGNvbXB1dGVkKVxuICAgICAgICAgICAgICA6IGluY2x1ZGVzKHJlc3VsdCwgY29tcHV0ZWQsIGNvbXBhcmF0b3IpXG4gICAgICAgICAgICApKSB7XG4gICAgICAgICAgb3RoSW5kZXggPSBvdGhMZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKC0tb3RoSW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBjYWNoZSA9IGNhY2hlc1tvdGhJbmRleF07XG4gICAgICAgICAgICBpZiAoIShjYWNoZVxuICAgICAgICAgICAgICAgICAgPyBjYWNoZUhhcyhjYWNoZSwgY29tcHV0ZWQpXG4gICAgICAgICAgICAgICAgICA6IGluY2x1ZGVzKGFycmF5c1tvdGhJbmRleF0sIGNvbXB1dGVkLCBjb21wYXJhdG9yKSlcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzZWVuKSB7XG4gICAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaW52ZXJ0YCBhbmQgYF8uaW52ZXJ0QnlgIHdoaWNoIGludmVydHNcbiAgICAgKiBgb2JqZWN0YCB3aXRoIHZhbHVlcyB0cmFuc2Zvcm1lZCBieSBgaXRlcmF0ZWVgIGFuZCBzZXQgYnkgYHNldHRlcmAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc2V0dGVyIFRoZSBmdW5jdGlvbiB0byBzZXQgYGFjY3VtdWxhdG9yYCB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGl0ZXJhdGVlIHRvIHRyYW5zZm9ybSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGFjY3VtdWxhdG9yIFRoZSBpbml0aWFsIGludmVydGVkIG9iamVjdC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgYGFjY3VtdWxhdG9yYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSW52ZXJ0ZXIob2JqZWN0LCBzZXR0ZXIsIGl0ZXJhdGVlLCBhY2N1bXVsYXRvcikge1xuICAgICAgYmFzZUZvck93bihvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iamVjdCkge1xuICAgICAgICBzZXR0ZXIoYWNjdW11bGF0b3IsIGl0ZXJhdGVlKHZhbHVlKSwga2V5LCBvYmplY3QpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaW52b2tlYCB3aXRob3V0IHN1cHBvcnQgZm9yIGluZGl2aWR1YWxcbiAgICAgKiBtZXRob2QgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIG1ldGhvZCB0byBpbnZva2UuXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJncyBUaGUgYXJndW1lbnRzIHRvIGludm9rZSB0aGUgbWV0aG9kIHdpdGguXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc3VsdCBvZiB0aGUgaW52b2tlZCBtZXRob2QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUludm9rZShvYmplY3QsIHBhdGgsIGFyZ3MpIHtcbiAgICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpO1xuICAgICAgb2JqZWN0ID0gcGFyZW50KG9iamVjdCwgcGF0aCk7XG4gICAgICB2YXIgZnVuYyA9IG9iamVjdCA9PSBudWxsID8gb2JqZWN0IDogb2JqZWN0W3RvS2V5KGxhc3QocGF0aCkpXTtcbiAgICAgIHJldHVybiBmdW5jID09IG51bGwgPyB1bmRlZmluZWQgOiBhcHBseShmdW5jLCBvYmplY3QsIGFyZ3MpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzQXJndW1lbnRzYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VJc0FyZ3VtZW50cyh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gYXJnc1RhZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc0FycmF5QnVmZmVyYCB3aXRob3V0IE5vZGUuanMgb3B0aW1pemF0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXkgYnVmZmVyLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUlzQXJyYXlCdWZmZXIodmFsdWUpIHtcbiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IGFycmF5QnVmZmVyVGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzRGF0ZWAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZGF0ZSBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSXNEYXRlKHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBkYXRlVGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzRXF1YWxgIHdoaWNoIHN1cHBvcnRzIHBhcnRpYWwgY29tcGFyaXNvbnNcbiAgICAgKiBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLlxuICAgICAqICAxIC0gVW5vcmRlcmVkIGNvbXBhcmlzb25cbiAgICAgKiAgMiAtIFBhcnRpYWwgY29tcGFyaXNvblxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgYHZhbHVlYCBhbmQgYG90aGVyYCBvYmplY3RzLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaykge1xuICAgICAgaWYgKHZhbHVlID09PSBvdGhlcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IG90aGVyID09IG51bGwgfHwgKCFpc09iamVjdExpa2UodmFsdWUpICYmICFpc09iamVjdExpa2Uob3RoZXIpKSkge1xuICAgICAgICByZXR1cm4gdmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiYXNlSXNFcXVhbERlZXAodmFsdWUsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBiYXNlSXNFcXVhbCwgc3RhY2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxgIGZvciBhcnJheXMgYW5kIG9iamVjdHMgd2hpY2ggcGVyZm9ybXNcbiAgICAgKiBkZWVwIGNvbXBhcmlzb25zIGFuZCB0cmFja3MgdHJhdmVyc2VkIG9iamVjdHMgZW5hYmxpbmcgb2JqZWN0cyB3aXRoIGNpcmN1bGFyXG4gICAgICogcmVmZXJlbmNlcyB0byBiZSBjb21wYXJlZC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgYG9iamVjdGAgYW5kIGBvdGhlcmAgb2JqZWN0cy5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSXNFcXVhbERlZXAob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykge1xuICAgICAgdmFyIG9iaklzQXJyID0gaXNBcnJheShvYmplY3QpLFxuICAgICAgICAgIG90aElzQXJyID0gaXNBcnJheShvdGhlciksXG4gICAgICAgICAgb2JqVGFnID0gb2JqSXNBcnIgPyBhcnJheVRhZyA6IGdldFRhZyhvYmplY3QpLFxuICAgICAgICAgIG90aFRhZyA9IG90aElzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob3RoZXIpO1xuXG4gICAgICBvYmpUYWcgPSBvYmpUYWcgPT0gYXJnc1RhZyA/IG9iamVjdFRhZyA6IG9ialRhZztcbiAgICAgIG90aFRhZyA9IG90aFRhZyA9PSBhcmdzVGFnID8gb2JqZWN0VGFnIDogb3RoVGFnO1xuXG4gICAgICB2YXIgb2JqSXNPYmogPSBvYmpUYWcgPT0gb2JqZWN0VGFnLFxuICAgICAgICAgIG90aElzT2JqID0gb3RoVGFnID09IG9iamVjdFRhZyxcbiAgICAgICAgICBpc1NhbWVUYWcgPSBvYmpUYWcgPT0gb3RoVGFnO1xuXG4gICAgICBpZiAoaXNTYW1lVGFnICYmIGlzQnVmZmVyKG9iamVjdCkpIHtcbiAgICAgICAgaWYgKCFpc0J1ZmZlcihvdGhlcikpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgb2JqSXNBcnIgPSB0cnVlO1xuICAgICAgICBvYmpJc09iaiA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKGlzU2FtZVRhZyAmJiAhb2JqSXNPYmopIHtcbiAgICAgICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTtcbiAgICAgICAgcmV0dXJuIChvYmpJc0FyciB8fCBpc1R5cGVkQXJyYXkob2JqZWN0KSlcbiAgICAgICAgICA/IGVxdWFsQXJyYXlzKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spXG4gICAgICAgICAgOiBlcXVhbEJ5VGFnKG9iamVjdCwgb3RoZXIsIG9ialRhZywgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjayk7XG4gICAgICB9XG4gICAgICBpZiAoIShiaXRtYXNrICYgQ09NUEFSRV9QQVJUSUFMX0ZMQUcpKSB7XG4gICAgICAgIHZhciBvYmpJc1dyYXBwZWQgPSBvYmpJc09iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgJ19fd3JhcHBlZF9fJyksXG4gICAgICAgICAgICBvdGhJc1dyYXBwZWQgPSBvdGhJc09iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCAnX193cmFwcGVkX18nKTtcblxuICAgICAgICBpZiAob2JqSXNXcmFwcGVkIHx8IG90aElzV3JhcHBlZCkge1xuICAgICAgICAgIHZhciBvYmpVbndyYXBwZWQgPSBvYmpJc1dyYXBwZWQgPyBvYmplY3QudmFsdWUoKSA6IG9iamVjdCxcbiAgICAgICAgICAgICAgb3RoVW53cmFwcGVkID0gb3RoSXNXcmFwcGVkID8gb3RoZXIudmFsdWUoKSA6IG90aGVyO1xuXG4gICAgICAgICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTtcbiAgICAgICAgICByZXR1cm4gZXF1YWxGdW5jKG9ialVud3JhcHBlZCwgb3RoVW53cmFwcGVkLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjayk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghaXNTYW1lVGFnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHN0YWNrIHx8IChzdGFjayA9IG5ldyBTdGFjayk7XG4gICAgICByZXR1cm4gZXF1YWxPYmplY3RzKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTWFwYCB3aXRob3V0IE5vZGUuanMgb3B0aW1pemF0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBtYXAsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSXNNYXAodmFsdWUpIHtcbiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGdldFRhZyh2YWx1ZSkgPT0gbWFwVGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTWF0Y2hgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBtYXRjaERhdGEgVGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIHRvIG1hdGNoLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUlzTWF0Y2gob2JqZWN0LCBzb3VyY2UsIG1hdGNoRGF0YSwgY3VzdG9taXplcikge1xuICAgICAgdmFyIGluZGV4ID0gbWF0Y2hEYXRhLmxlbmd0aCxcbiAgICAgICAgICBsZW5ndGggPSBpbmRleCxcbiAgICAgICAgICBub0N1c3RvbWl6ZXIgPSAhY3VzdG9taXplcjtcblxuICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAhbGVuZ3RoO1xuICAgICAgfVxuICAgICAgb2JqZWN0ID0gT2JqZWN0KG9iamVjdCk7XG4gICAgICB3aGlsZSAoaW5kZXgtLSkge1xuICAgICAgICB2YXIgZGF0YSA9IG1hdGNoRGF0YVtpbmRleF07XG4gICAgICAgIGlmICgobm9DdXN0b21pemVyICYmIGRhdGFbMl0pXG4gICAgICAgICAgICAgID8gZGF0YVsxXSAhPT0gb2JqZWN0W2RhdGFbMF1dXG4gICAgICAgICAgICAgIDogIShkYXRhWzBdIGluIG9iamVjdClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgZGF0YSA9IG1hdGNoRGF0YVtpbmRleF07XG4gICAgICAgIHZhciBrZXkgPSBkYXRhWzBdLFxuICAgICAgICAgICAgb2JqVmFsdWUgPSBvYmplY3Rba2V5XSxcbiAgICAgICAgICAgIHNyY1ZhbHVlID0gZGF0YVsxXTtcblxuICAgICAgICBpZiAobm9DdXN0b21pemVyICYmIGRhdGFbMl0pIHtcbiAgICAgICAgICBpZiAob2JqVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBzdGFjayA9IG5ldyBTdGFjaztcbiAgICAgICAgICBpZiAoY3VzdG9taXplcikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlLCBrZXksIG9iamVjdCwgc291cmNlLCBzdGFjayk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghKHJlc3VsdCA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgPyBiYXNlSXNFcXVhbChzcmNWYWx1ZSwgb2JqVmFsdWUsIENPTVBBUkVfUEFSVElBTF9GTEFHIHwgQ09NUEFSRV9VTk9SREVSRURfRkxBRywgY3VzdG9taXplciwgc3RhY2spXG4gICAgICAgICAgICAgICAgOiByZXN1bHRcbiAgICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNOYXRpdmVgIHdpdGhvdXQgYmFkIHNoaW0gY2hlY2tzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbixcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkge1xuICAgICAgaWYgKCFpc09iamVjdCh2YWx1ZSkgfHwgaXNNYXNrZWQodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBwYXR0ZXJuID0gaXNGdW5jdGlvbih2YWx1ZSkgPyByZUlzTmF0aXZlIDogcmVJc0hvc3RDdG9yO1xuICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0b1NvdXJjZSh2YWx1ZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzUmVnRXhwYCB3aXRob3V0IE5vZGUuanMgb3B0aW1pemF0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSByZWdleHAsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlSXNSZWdFeHAodmFsdWUpIHtcbiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHJlZ2V4cFRhZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1NldGAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc2V0LCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUlzU2V0KHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBnZXRUYWcodmFsdWUpID09IHNldFRhZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1R5cGVkQXJyYXlgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUlzVHlwZWRBcnJheSh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiZcbiAgICAgICAgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW2Jhc2VHZXRUYWcodmFsdWUpXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pdGVyYXRlZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gW3ZhbHVlPV8uaWRlbnRpdHldIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGFuIGl0ZXJhdGVlLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgaXRlcmF0ZWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUl0ZXJhdGVlKHZhbHVlKSB7XG4gICAgICAvLyBEb24ndCBzdG9yZSB0aGUgYHR5cGVvZmAgcmVzdWx0IGluIGEgdmFyaWFibGUgdG8gYXZvaWQgYSBKSVQgYnVnIGluIFNhZmFyaSA5LlxuICAgICAgLy8gU2VlIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0xNTYwMzQgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gaWRlbnRpdHk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBpc0FycmF5KHZhbHVlKVxuICAgICAgICAgID8gYmFzZU1hdGNoZXNQcm9wZXJ0eSh2YWx1ZVswXSwgdmFsdWVbMV0pXG4gICAgICAgICAgOiBiYXNlTWF0Y2hlcyh2YWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvcGVydHkodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNgIHdoaWNoIGRvZXNuJ3QgdHJlYXQgc3BhcnNlIGFycmF5cyBhcyBkZW5zZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUtleXMob2JqZWN0KSB7XG4gICAgICBpZiAoIWlzUHJvdG90eXBlKG9iamVjdCkpIHtcbiAgICAgICAgcmV0dXJuIG5hdGl2ZUtleXMob2JqZWN0KTtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGZvciAodmFyIGtleSBpbiBPYmplY3Qob2JqZWN0KSkge1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYga2V5ICE9ICdjb25zdHJ1Y3RvcicpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNJbmAgd2hpY2ggZG9lc24ndCB0cmVhdCBzcGFyc2UgYXJyYXlzIGFzIGRlbnNlLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlS2V5c0luKG9iamVjdCkge1xuICAgICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7XG4gICAgICAgIHJldHVybiBuYXRpdmVLZXlzSW4ob2JqZWN0KTtcbiAgICAgIH1cbiAgICAgIHZhciBpc1Byb3RvID0gaXNQcm90b3R5cGUob2JqZWN0KSxcbiAgICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIG9iamVjdCkge1xuICAgICAgICBpZiAoIShrZXkgPT0gJ2NvbnN0cnVjdG9yJyAmJiAoaXNQcm90byB8fCAhaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpKSkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubHRgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBgb3RoZXJgLFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZUx0KHZhbHVlLCBvdGhlcikge1xuICAgICAgcmV0dXJuIHZhbHVlIDwgb3RoZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubWFwYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBhcnJheS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlTWFwKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICByZXN1bHQgPSBpc0FycmF5TGlrZShjb2xsZWN0aW9uKSA/IEFycmF5KGNvbGxlY3Rpb24ubGVuZ3RoKSA6IFtdO1xuXG4gICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJlc3VsdFsrK2luZGV4XSA9IGl0ZXJhdGVlKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1hdGNoZXNgIHdoaWNoIGRvZXNuJ3QgY2xvbmUgYHNvdXJjZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgc3BlYyBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlTWF0Y2hlcyhzb3VyY2UpIHtcbiAgICAgIHZhciBtYXRjaERhdGEgPSBnZXRNYXRjaERhdGEoc291cmNlKTtcbiAgICAgIGlmIChtYXRjaERhdGEubGVuZ3RoID09IDEgJiYgbWF0Y2hEYXRhWzBdWzJdKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzU3RyaWN0Q29tcGFyYWJsZShtYXRjaERhdGFbMF1bMF0sIG1hdGNoRGF0YVswXVsxXSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICAgIHJldHVybiBvYmplY3QgPT09IHNvdXJjZSB8fCBiYXNlSXNNYXRjaChvYmplY3QsIHNvdXJjZSwgbWF0Y2hEYXRhKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubWF0Y2hlc1Byb3BlcnR5YCB3aGljaCBkb2Vzbid0IGNsb25lIGBzcmNWYWx1ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuXG4gICAgICogQHBhcmFtIHsqfSBzcmNWYWx1ZSBUaGUgdmFsdWUgdG8gbWF0Y2guXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgc3BlYyBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlTWF0Y2hlc1Byb3BlcnR5KHBhdGgsIHNyY1ZhbHVlKSB7XG4gICAgICBpZiAoaXNLZXkocGF0aCkgJiYgaXNTdHJpY3RDb21wYXJhYmxlKHNyY1ZhbHVlKSkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlc1N0cmljdENvbXBhcmFibGUodG9LZXkocGF0aCksIHNyY1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHtcbiAgICAgICAgdmFyIG9ialZhbHVlID0gZ2V0KG9iamVjdCwgcGF0aCk7XG4gICAgICAgIHJldHVybiAob2JqVmFsdWUgPT09IHVuZGVmaW5lZCAmJiBvYmpWYWx1ZSA9PT0gc3JjVmFsdWUpXG4gICAgICAgICAgPyBoYXNJbihvYmplY3QsIHBhdGgpXG4gICAgICAgICAgOiBiYXNlSXNFcXVhbChzcmNWYWx1ZSwgb2JqVmFsdWUsIENPTVBBUkVfUEFSVElBTF9GTEFHIHwgQ09NUEFSRV9VTk9SREVSRURfRkxBRyk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1lcmdlYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzcmNJbmRleCBUaGUgaW5kZXggb2YgYHNvdXJjZWAuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgbWVyZ2VkIHZhbHVlcy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIHNvdXJjZSB2YWx1ZXMgYW5kIHRoZWlyIG1lcmdlZFxuICAgICAqICBjb3VudGVycGFydHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZU1lcmdlKG9iamVjdCwgc291cmNlLCBzcmNJbmRleCwgY3VzdG9taXplciwgc3RhY2spIHtcbiAgICAgIGlmIChvYmplY3QgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBiYXNlRm9yKHNvdXJjZSwgZnVuY3Rpb24oc3JjVmFsdWUsIGtleSkge1xuICAgICAgICBpZiAoaXNPYmplY3Qoc3JjVmFsdWUpKSB7XG4gICAgICAgICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTtcbiAgICAgICAgICBiYXNlTWVyZ2VEZWVwKG9iamVjdCwgc291cmNlLCBrZXksIHNyY0luZGV4LCBiYXNlTWVyZ2UsIGN1c3RvbWl6ZXIsIHN0YWNrKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBjdXN0b21pemVyXG4gICAgICAgICAgICA/IGN1c3RvbWl6ZXIob2JqZWN0W2tleV0sIHNyY1ZhbHVlLCAoa2V5ICsgJycpLCBvYmplY3QsIHNvdXJjZSwgc3RhY2spXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBuZXdWYWx1ZSA9IHNyY1ZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhc3NpZ25NZXJnZVZhbHVlKG9iamVjdCwga2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIGtleXNJbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlTWVyZ2VgIGZvciBhcnJheXMgYW5kIG9iamVjdHMgd2hpY2ggcGVyZm9ybXNcbiAgICAgKiBkZWVwIG1lcmdlcyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhclxuICAgICAqIHJlZmVyZW5jZXMgdG8gYmUgbWVyZ2VkLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIG1lcmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzcmNJbmRleCBUaGUgaW5kZXggb2YgYHNvdXJjZWAuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbWVyZ2VGdW5jIFRoZSBmdW5jdGlvbiB0byBtZXJnZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgYXNzaWduZWQgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgc291cmNlIHZhbHVlcyBhbmQgdGhlaXIgbWVyZ2VkXG4gICAgICogIGNvdW50ZXJwYXJ0cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlTWVyZ2VEZWVwKG9iamVjdCwgc291cmNlLCBrZXksIHNyY0luZGV4LCBtZXJnZUZ1bmMsIGN1c3RvbWl6ZXIsIHN0YWNrKSB7XG4gICAgICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XSxcbiAgICAgICAgICBzcmNWYWx1ZSA9IHNvdXJjZVtrZXldLFxuICAgICAgICAgIHN0YWNrZWQgPSBzdGFjay5nZXQoc3JjVmFsdWUpO1xuXG4gICAgICBpZiAoc3RhY2tlZCkge1xuICAgICAgICBhc3NpZ25NZXJnZVZhbHVlKG9iamVjdCwga2V5LCBzdGFja2VkKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIG5ld1ZhbHVlID0gY3VzdG9taXplclxuICAgICAgICA/IGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlLCAoa2V5ICsgJycpLCBvYmplY3QsIHNvdXJjZSwgc3RhY2spXG4gICAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgICB2YXIgaXNDb21tb24gPSBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkO1xuXG4gICAgICBpZiAoaXNDb21tb24pIHtcbiAgICAgICAgdmFyIGlzQXJyID0gaXNBcnJheShzcmNWYWx1ZSksXG4gICAgICAgICAgICBpc0J1ZmYgPSAhaXNBcnIgJiYgaXNCdWZmZXIoc3JjVmFsdWUpLFxuICAgICAgICAgICAgaXNUeXBlZCA9ICFpc0FyciAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheShzcmNWYWx1ZSk7XG5cbiAgICAgICAgbmV3VmFsdWUgPSBzcmNWYWx1ZTtcbiAgICAgICAgaWYgKGlzQXJyIHx8IGlzQnVmZiB8fCBpc1R5cGVkKSB7XG4gICAgICAgICAgaWYgKGlzQXJyYXkob2JqVmFsdWUpKSB7XG4gICAgICAgICAgICBuZXdWYWx1ZSA9IG9ialZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChpc0FycmF5TGlrZU9iamVjdChvYmpWYWx1ZSkpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gY29weUFycmF5KG9ialZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAoaXNCdWZmKSB7XG4gICAgICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICAgICAgbmV3VmFsdWUgPSBjbG9uZUJ1ZmZlcihzcmNWYWx1ZSwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKGlzVHlwZWQpIHtcbiAgICAgICAgICAgIGlzQ29tbW9uID0gZmFsc2U7XG4gICAgICAgICAgICBuZXdWYWx1ZSA9IGNsb25lVHlwZWRBcnJheShzcmNWYWx1ZSwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3VmFsdWUgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNQbGFpbk9iamVjdChzcmNWYWx1ZSkgfHwgaXNBcmd1bWVudHMoc3JjVmFsdWUpKSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBvYmpWYWx1ZTtcbiAgICAgICAgICBpZiAoaXNBcmd1bWVudHMob2JqVmFsdWUpKSB7XG4gICAgICAgICAgICBuZXdWYWx1ZSA9IHRvUGxhaW5PYmplY3Qob2JqVmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmICghaXNPYmplY3Qob2JqVmFsdWUpIHx8IChzcmNJbmRleCAmJiBpc0Z1bmN0aW9uKG9ialZhbHVlKSkpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gaW5pdENsb25lT2JqZWN0KHNyY1ZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaXNDb21tb24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGlzQ29tbW9uKSB7XG4gICAgICAgIC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIG9iamVjdHMgYW5kIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgICAgICBzdGFjay5zZXQoc3JjVmFsdWUsIG5ld1ZhbHVlKTtcbiAgICAgICAgbWVyZ2VGdW5jKG5ld1ZhbHVlLCBzcmNWYWx1ZSwgc3JjSW5kZXgsIGN1c3RvbWl6ZXIsIHN0YWNrKTtcbiAgICAgICAgc3RhY2tbJ2RlbGV0ZSddKHNyY1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGFzc2lnbk1lcmdlVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5udGhgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBpbmRleCBvZiB0aGUgZWxlbWVudCB0byByZXR1cm4uXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG50aCBlbGVtZW50IG9mIGBhcnJheWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZU50aChhcnJheSwgbikge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcbiAgICAgIGlmICghbGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIG4gKz0gbiA8IDAgPyBsZW5ndGggOiAwO1xuICAgICAgcmV0dXJuIGlzSW5kZXgobiwgbGVuZ3RoKSA/IGFycmF5W25dIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm9yZGVyQnlgIHdpdGhvdXQgcGFyYW0gZ3VhcmRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbltdfE9iamVjdFtdfHN0cmluZ1tdfSBpdGVyYXRlZXMgVGhlIGl0ZXJhdGVlcyB0byBzb3J0IGJ5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IG9yZGVycyBUaGUgc29ydCBvcmRlcnMgb2YgYGl0ZXJhdGVlc2AuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgc29ydGVkIGFycmF5LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VPcmRlckJ5KGNvbGxlY3Rpb24sIGl0ZXJhdGVlcywgb3JkZXJzKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMTtcbiAgICAgIGl0ZXJhdGVlcyA9IGFycmF5TWFwKGl0ZXJhdGVlcy5sZW5ndGggPyBpdGVyYXRlZXMgOiBbaWRlbnRpdHldLCBiYXNlVW5hcnkoZ2V0SXRlcmF0ZWUoKSkpO1xuXG4gICAgICB2YXIgcmVzdWx0ID0gYmFzZU1hcChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHZhciBjcml0ZXJpYSA9IGFycmF5TWFwKGl0ZXJhdGVlcywgZnVuY3Rpb24oaXRlcmF0ZWUpIHtcbiAgICAgICAgICByZXR1cm4gaXRlcmF0ZWUodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgJ2NyaXRlcmlhJzogY3JpdGVyaWEsICdpbmRleCc6ICsraW5kZXgsICd2YWx1ZSc6IHZhbHVlIH07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGJhc2VTb3J0QnkocmVzdWx0LCBmdW5jdGlvbihvYmplY3QsIG90aGVyKSB7XG4gICAgICAgIHJldHVybiBjb21wYXJlTXVsdGlwbGUob2JqZWN0LCBvdGhlciwgb3JkZXJzKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnBpY2tgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaW5kaXZpZHVhbFxuICAgICAqIHByb3BlcnR5IGlkZW50aWZpZXJzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IHBhdGhzIFRoZSBwcm9wZXJ0eSBwYXRocyB0byBwaWNrLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVBpY2sob2JqZWN0LCBwYXRocykge1xuICAgICAgcmV0dXJuIGJhc2VQaWNrQnkob2JqZWN0LCBwYXRocywgZnVuY3Rpb24odmFsdWUsIHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIGhhc0luKG9iamVjdCwgcGF0aCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiAgYF8ucGlja0J5YCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0gcGF0aHMgVGhlIHByb3BlcnR5IHBhdGhzIHRvIHBpY2suXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBwcm9wZXJ0eS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VQaWNrQnkob2JqZWN0LCBwYXRocywgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBwYXRocy5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0ID0ge307XG5cbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBwYXRoID0gcGF0aHNbaW5kZXhdLFxuICAgICAgICAgICAgdmFsdWUgPSBiYXNlR2V0KG9iamVjdCwgcGF0aCk7XG5cbiAgICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgcGF0aCkpIHtcbiAgICAgICAgICBiYXNlU2V0KHJlc3VsdCwgY2FzdFBhdGgocGF0aCwgb2JqZWN0KSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVByb3BlcnR5YCB3aGljaCBzdXBwb3J0cyBkZWVwIHBhdGhzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGFjY2Vzc29yIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VQcm9wZXJ0eURlZXAocGF0aCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gYmFzZUdldChvYmplY3QsIHBhdGgpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wdWxsQWxsQnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWVcbiAgICAgKiBzaG9ydGhhbmRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIGl0ZXJhdGVlLCBjb21wYXJhdG9yKSB7XG4gICAgICB2YXIgaW5kZXhPZiA9IGNvbXBhcmF0b3IgPyBiYXNlSW5kZXhPZldpdGggOiBiYXNlSW5kZXhPZixcbiAgICAgICAgICBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGgsXG4gICAgICAgICAgc2VlbiA9IGFycmF5O1xuXG4gICAgICBpZiAoYXJyYXkgPT09IHZhbHVlcykge1xuICAgICAgICB2YWx1ZXMgPSBjb3B5QXJyYXkodmFsdWVzKTtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVyYXRlZSkge1xuICAgICAgICBzZWVuID0gYXJyYXlNYXAoYXJyYXksIGJhc2VVbmFyeShpdGVyYXRlZSkpO1xuICAgICAgfVxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIGZyb21JbmRleCA9IDAsXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlc1tpbmRleF0sXG4gICAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUpIDogdmFsdWU7XG5cbiAgICAgICAgd2hpbGUgKChmcm9tSW5kZXggPSBpbmRleE9mKHNlZW4sIGNvbXB1dGVkLCBmcm9tSW5kZXgsIGNvbXBhcmF0b3IpKSA+IC0xKSB7XG4gICAgICAgICAgaWYgKHNlZW4gIT09IGFycmF5KSB7XG4gICAgICAgICAgICBzcGxpY2UuY2FsbChzZWVuLCBmcm9tSW5kZXgsIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzcGxpY2UuY2FsbChhcnJheSwgZnJvbUluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnB1bGxBdGAgd2l0aG91dCBzdXBwb3J0IGZvciBpbmRpdmlkdWFsXG4gICAgICogaW5kZXhlcyBvciBjYXB0dXJpbmcgdGhlIHJlbW92ZWQgZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtudW1iZXJbXX0gaW5kZXhlcyBUaGUgaW5kZXhlcyBvZiBlbGVtZW50cyB0byByZW1vdmUuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcykge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gaW5kZXhlcy5sZW5ndGggOiAwLFxuICAgICAgICAgIGxhc3RJbmRleCA9IGxlbmd0aCAtIDE7XG5cbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICB2YXIgaW5kZXggPSBpbmRleGVzW2xlbmd0aF07XG4gICAgICAgIGlmIChsZW5ndGggPT0gbGFzdEluZGV4IHx8IGluZGV4ICE9PSBwcmV2aW91cykge1xuICAgICAgICAgIHZhciBwcmV2aW91cyA9IGluZGV4O1xuICAgICAgICAgIGlmIChpc0luZGV4KGluZGV4KSkge1xuICAgICAgICAgICAgc3BsaWNlLmNhbGwoYXJyYXksIGluZGV4LCAxKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmFzZVVuc2V0KGFycmF5LCBpbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucmFuZG9tYCB3aXRob3V0IHN1cHBvcnQgZm9yIHJldHVybmluZ1xuICAgICAqIGZsb2F0aW5nLXBvaW50IG51bWJlcnMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsb3dlciBUaGUgbG93ZXIgYm91bmQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHVwcGVyIFRoZSB1cHBlciBib3VuZC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSByYW5kb20gbnVtYmVyLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VSYW5kb20obG93ZXIsIHVwcGVyKSB7XG4gICAgICByZXR1cm4gbG93ZXIgKyBuYXRpdmVGbG9vcihuYXRpdmVSYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnJhbmdlYCBhbmQgYF8ucmFuZ2VSaWdodGAgd2hpY2ggZG9lc24ndFxuICAgICAqIGNvZXJjZSBhcmd1bWVudHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCBUaGUgc3RhcnQgb2YgdGhlIHJhbmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgcmFuZ2UuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN0ZXAgVGhlIHZhbHVlIHRvIGluY3JlbWVudCBvciBkZWNyZW1lbnQgYnkuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSByYW5nZSBvZiBudW1iZXJzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VSYW5nZShzdGFydCwgZW5kLCBzdGVwLCBmcm9tUmlnaHQpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChuYXRpdmVDZWlsKChlbmQgLSBzdGFydCkgLyAoc3RlcCB8fCAxKSksIDApLFxuICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7XG5cbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICByZXN1bHRbZnJvbVJpZ2h0ID8gbGVuZ3RoIDogKytpbmRleF0gPSBzdGFydDtcbiAgICAgICAgc3RhcnQgKz0gc3RlcDtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ucmVwZWF0YCB3aGljaCBkb2Vzbid0IGNvZXJjZSBhcmd1bWVudHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byByZXBlYXQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQgdGhlIHN0cmluZy5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSByZXBlYXRlZCBzdHJpbmcuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVJlcGVhdChzdHJpbmcsIG4pIHtcbiAgICAgIHZhciByZXN1bHQgPSAnJztcbiAgICAgIGlmICghc3RyaW5nIHx8IG4gPCAxIHx8IG4gPiBNQVhfU0FGRV9JTlRFR0VSKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICAvLyBMZXZlcmFnZSB0aGUgZXhwb25lbnRpYXRpb24gYnkgc3F1YXJpbmcgYWxnb3JpdGhtIGZvciBhIGZhc3RlciByZXBlYXQuXG4gICAgICAvLyBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRXhwb25lbnRpYXRpb25fYnlfc3F1YXJpbmcgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgIGRvIHtcbiAgICAgICAgaWYgKG4gJSAyKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IHN0cmluZztcbiAgICAgICAgfVxuICAgICAgICBuID0gbmF0aXZlRmxvb3IobiAvIDIpO1xuICAgICAgICBpZiAobikge1xuICAgICAgICAgIHN0cmluZyArPSBzdHJpbmc7XG4gICAgICAgIH1cbiAgICAgIH0gd2hpbGUgKG4pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnJlc3RgIHdoaWNoIGRvZXNuJ3QgdmFsaWRhdGUgb3IgY29lcmNlIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVJlc3QoZnVuYywgc3RhcnQpIHtcbiAgICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCBzdGFydCwgaWRlbnRpdHkpLCBmdW5jICsgJycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNhbXBsZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIHNhbXBsZS5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmFuZG9tIGVsZW1lbnQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVNhbXBsZShjb2xsZWN0aW9uKSB7XG4gICAgICByZXR1cm4gYXJyYXlTYW1wbGUodmFsdWVzKGNvbGxlY3Rpb24pKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zYW1wbGVTaXplYCB3aXRob3V0IHBhcmFtIGd1YXJkcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2FtcGxlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gc2FtcGxlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcmFuZG9tIGVsZW1lbnRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VTYW1wbGVTaXplKGNvbGxlY3Rpb24sIG4pIHtcbiAgICAgIHZhciBhcnJheSA9IHZhbHVlcyhjb2xsZWN0aW9uKTtcbiAgICAgIHJldHVybiBzaHVmZmxlU2VsZihhcnJheSwgYmFzZUNsYW1wKG4sIDAsIGFycmF5Lmxlbmd0aCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNldGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHNldC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgcGF0aCBjcmVhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VTZXQob2JqZWN0LCBwYXRoLCB2YWx1ZSwgY3VzdG9taXplcikge1xuICAgICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICB9XG4gICAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTtcblxuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gcGF0aC5sZW5ndGgsXG4gICAgICAgICAgbGFzdEluZGV4ID0gbGVuZ3RoIC0gMSxcbiAgICAgICAgICBuZXN0ZWQgPSBvYmplY3Q7XG5cbiAgICAgIHdoaWxlIChuZXN0ZWQgIT0gbnVsbCAmJiArK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBrZXkgPSB0b0tleShwYXRoW2luZGV4XSksXG4gICAgICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlO1xuXG4gICAgICAgIGlmIChpbmRleCAhPSBsYXN0SW5kZXgpIHtcbiAgICAgICAgICB2YXIgb2JqVmFsdWUgPSBuZXN0ZWRba2V5XTtcbiAgICAgICAgICBuZXdWYWx1ZSA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKG9ialZhbHVlLCBrZXksIG5lc3RlZCkgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gaXNPYmplY3Qob2JqVmFsdWUpXG4gICAgICAgICAgICAgID8gb2JqVmFsdWVcbiAgICAgICAgICAgICAgOiAoaXNJbmRleChwYXRoW2luZGV4ICsgMV0pID8gW10gOiB7fSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGFzc2lnblZhbHVlKG5lc3RlZCwga2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgIG5lc3RlZCA9IG5lc3RlZFtrZXldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgc2V0RGF0YWAgd2l0aG91dCBzdXBwb3J0IGZvciBob3QgbG9vcCBzaG9ydGluZy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXNzb2NpYXRlIG1ldGFkYXRhIHdpdGguXG4gICAgICogQHBhcmFtIHsqfSBkYXRhIFRoZSBtZXRhZGF0YS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgYGZ1bmNgLlxuICAgICAqL1xuICAgIHZhciBiYXNlU2V0RGF0YSA9ICFtZXRhTWFwID8gaWRlbnRpdHkgOiBmdW5jdGlvbihmdW5jLCBkYXRhKSB7XG4gICAgICBtZXRhTWFwLnNldChmdW5jLCBkYXRhKTtcbiAgICAgIHJldHVybiBmdW5jO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgc2V0VG9TdHJpbmdgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaG90IGxvb3Agc2hvcnRpbmcuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdHJpbmcgVGhlIGB0b1N0cmluZ2AgcmVzdWx0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgZnVuY2AuXG4gICAgICovXG4gICAgdmFyIGJhc2VTZXRUb1N0cmluZyA9ICFkZWZpbmVQcm9wZXJ0eSA/IGlkZW50aXR5IDogZnVuY3Rpb24oZnVuYywgc3RyaW5nKSB7XG4gICAgICByZXR1cm4gZGVmaW5lUHJvcGVydHkoZnVuYywgJ3RvU3RyaW5nJywge1xuICAgICAgICAnY29uZmlndXJhYmxlJzogdHJ1ZSxcbiAgICAgICAgJ2VudW1lcmFibGUnOiBmYWxzZSxcbiAgICAgICAgJ3ZhbHVlJzogY29uc3RhbnQoc3RyaW5nKSxcbiAgICAgICAgJ3dyaXRhYmxlJzogdHJ1ZVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNodWZmbGVgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBzaHVmZmxlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IHNodWZmbGVkIGFycmF5LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VTaHVmZmxlKGNvbGxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBzaHVmZmxlU2VsZih2YWx1ZXMoY29sbGVjdGlvbikpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNsaWNlYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCkge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXG4gICAgICBpZiAoc3RhcnQgPCAwKSB7XG4gICAgICAgIHN0YXJ0ID0gLXN0YXJ0ID4gbGVuZ3RoID8gMCA6IChsZW5ndGggKyBzdGFydCk7XG4gICAgICB9XG4gICAgICBlbmQgPSBlbmQgPiBsZW5ndGggPyBsZW5ndGggOiBlbmQ7XG4gICAgICBpZiAoZW5kIDwgMCkge1xuICAgICAgICBlbmQgKz0gbGVuZ3RoO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gc3RhcnQgPiBlbmQgPyAwIDogKChlbmQgLSBzdGFydCkgPj4+IDApO1xuICAgICAgc3RhcnQgPj4+PSAwO1xuXG4gICAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFtpbmRleF0gPSBhcnJheVtpbmRleCArIHN0YXJ0XTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29tZWAgd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFueSBlbGVtZW50IHBhc3NlcyB0aGUgcHJlZGljYXRlIGNoZWNrLFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVNvbWUoY29sbGVjdGlvbiwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgcmVzdWx0O1xuXG4gICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmVzdWx0ID0gcHJlZGljYXRlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICAgIHJldHVybiAhcmVzdWx0O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gISFyZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhgIGFuZCBgXy5zb3J0ZWRMYXN0SW5kZXhgIHdoaWNoXG4gICAgICogcGVyZm9ybXMgYSBiaW5hcnkgc2VhcmNoIG9mIGBhcnJheWAgdG8gZGV0ZXJtaW5lIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgXG4gICAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JldEhpZ2hlc3RdIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBoaWdoZXN0IHF1YWxpZmllZCBpbmRleC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZFxuICAgICAqICBpbnRvIGBhcnJheWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgcmV0SGlnaGVzdCkge1xuICAgICAgdmFyIGxvdyA9IDAsXG4gICAgICAgICAgaGlnaCA9IGFycmF5ID09IG51bGwgPyBsb3cgOiBhcnJheS5sZW5ndGg7XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYgdmFsdWUgPT09IHZhbHVlICYmIGhpZ2ggPD0gSEFMRl9NQVhfQVJSQVlfTEVOR1RIKSB7XG4gICAgICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7XG4gICAgICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMSxcbiAgICAgICAgICAgICAgY29tcHV0ZWQgPSBhcnJheVttaWRdO1xuXG4gICAgICAgICAgaWYgKGNvbXB1dGVkICE9PSBudWxsICYmICFpc1N5bWJvbChjb21wdXRlZCkgJiZcbiAgICAgICAgICAgICAgKHJldEhpZ2hlc3QgPyAoY29tcHV0ZWQgPD0gdmFsdWUpIDogKGNvbXB1dGVkIDwgdmFsdWUpKSkge1xuICAgICAgICAgICAgbG93ID0gbWlkICsgMTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGlnaCA9IG1pZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhpZ2g7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4QnkoYXJyYXksIHZhbHVlLCBpZGVudGl0eSwgcmV0SGlnaGVzdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhCeWAgYW5kIGBfLnNvcnRlZExhc3RJbmRleEJ5YFxuICAgICAqIHdoaWNoIGludm9rZXMgYGl0ZXJhdGVlYCBmb3IgYHZhbHVlYCBhbmQgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgdG8gY29tcHV0ZVxuICAgICAqIHRoZWlyIHNvcnQgcmFua2luZy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ7ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXRIaWdoZXN0XSBTcGVjaWZ5IHJldHVybmluZyB0aGUgaGlnaGVzdCBxdWFsaWZpZWQgaW5kZXguXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWRcbiAgICAgKiAgaW50byBgYXJyYXlgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUsIHJldEhpZ2hlc3QpIHtcbiAgICAgIHZhbHVlID0gaXRlcmF0ZWUodmFsdWUpO1xuXG4gICAgICB2YXIgbG93ID0gMCxcbiAgICAgICAgICBoaWdoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgdmFsSXNOYU4gPSB2YWx1ZSAhPT0gdmFsdWUsXG4gICAgICAgICAgdmFsSXNOdWxsID0gdmFsdWUgPT09IG51bGwsXG4gICAgICAgICAgdmFsSXNTeW1ib2wgPSBpc1N5bWJvbCh2YWx1ZSksXG4gICAgICAgICAgdmFsSXNVbmRlZmluZWQgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkO1xuXG4gICAgICB3aGlsZSAobG93IDwgaGlnaCkge1xuICAgICAgICB2YXIgbWlkID0gbmF0aXZlRmxvb3IoKGxvdyArIGhpZ2gpIC8gMiksXG4gICAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlKGFycmF5W21pZF0pLFxuICAgICAgICAgICAgb3RoSXNEZWZpbmVkID0gY29tcHV0ZWQgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG90aElzTnVsbCA9IGNvbXB1dGVkID09PSBudWxsLFxuICAgICAgICAgICAgb3RoSXNSZWZsZXhpdmUgPSBjb21wdXRlZCA9PT0gY29tcHV0ZWQsXG4gICAgICAgICAgICBvdGhJc1N5bWJvbCA9IGlzU3ltYm9sKGNvbXB1dGVkKTtcblxuICAgICAgICBpZiAodmFsSXNOYU4pIHtcbiAgICAgICAgICB2YXIgc2V0TG93ID0gcmV0SGlnaGVzdCB8fCBvdGhJc1JlZmxleGl2ZTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWxJc1VuZGVmaW5lZCkge1xuICAgICAgICAgIHNldExvdyA9IG90aElzUmVmbGV4aXZlICYmIChyZXRIaWdoZXN0IHx8IG90aElzRGVmaW5lZCk7XG4gICAgICAgIH0gZWxzZSBpZiAodmFsSXNOdWxsKSB7XG4gICAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmIChyZXRIaWdoZXN0IHx8ICFvdGhJc051bGwpO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbElzU3ltYm9sKSB7XG4gICAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmICFvdGhJc051bGwgJiYgKHJldEhpZ2hlc3QgfHwgIW90aElzU3ltYm9sKTtcbiAgICAgICAgfSBlbHNlIGlmIChvdGhJc051bGwgfHwgb3RoSXNTeW1ib2wpIHtcbiAgICAgICAgICBzZXRMb3cgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRMb3cgPSByZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2V0TG93KSB7XG4gICAgICAgICAgbG93ID0gbWlkICsgMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBoaWdoID0gbWlkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbmF0aXZlTWluKGhpZ2gsIE1BWF9BUlJBWV9JTkRFWCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkVW5pcWAgYW5kIGBfLnNvcnRlZFVuaXFCeWAgd2l0aG91dFxuICAgICAqIHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVNvcnRlZFVuaXEoYXJyYXksIGl0ZXJhdGVlKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgcmVzSW5kZXggPSAwLFxuICAgICAgICAgIHJlc3VsdCA9IFtdO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sXG4gICAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUpIDogdmFsdWU7XG5cbiAgICAgICAgaWYgKCFpbmRleCB8fCAhZXEoY29tcHV0ZWQsIHNlZW4pKSB7XG4gICAgICAgICAgdmFyIHNlZW4gPSBjb21wdXRlZDtcbiAgICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50b051bWJlcmAgd2hpY2ggZG9lc24ndCBlbnN1cmUgY29ycmVjdFxuICAgICAqIGNvbnZlcnNpb25zIG9mIGJpbmFyeSwgaGV4YWRlY2ltYWwsIG9yIG9jdGFsIHN0cmluZyB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VUb051bWJlcih2YWx1ZSkge1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAoaXNTeW1ib2wodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBOQU47XG4gICAgICB9XG4gICAgICByZXR1cm4gK3ZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRvU3RyaW5nYCB3aGljaCBkb2Vzbid0IGNvbnZlcnQgbnVsbGlzaFxuICAgICAqIHZhbHVlcyB0byBlbXB0eSBzdHJpbmdzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm9jZXNzLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHN0cmluZy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlVG9TdHJpbmcodmFsdWUpIHtcbiAgICAgIC8vIEV4aXQgZWFybHkgZm9yIHN0cmluZ3MgdG8gYXZvaWQgYSBwZXJmb3JtYW5jZSBoaXQgaW4gc29tZSBlbnZpcm9ubWVudHMuXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAvLyBSZWN1cnNpdmVseSBjb252ZXJ0IHZhbHVlcyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgICAgICByZXR1cm4gYXJyYXlNYXAodmFsdWUsIGJhc2VUb1N0cmluZykgKyAnJztcbiAgICAgIH1cbiAgICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHN5bWJvbFRvU3RyaW5nID8gc3ltYm9sVG9TdHJpbmcuY2FsbCh2YWx1ZSkgOiAnJztcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSAodmFsdWUgKyAnJyk7XG4gICAgICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udW5pcUJ5YCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmFzZVVuaXEoYXJyYXksIGl0ZXJhdGVlLCBjb21wYXJhdG9yKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBpbmNsdWRlcyA9IGFycmF5SW5jbHVkZXMsXG4gICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICAgIGlzQ29tbW9uID0gdHJ1ZSxcbiAgICAgICAgICByZXN1bHQgPSBbXSxcbiAgICAgICAgICBzZWVuID0gcmVzdWx0O1xuXG4gICAgICBpZiAoY29tcGFyYXRvcikge1xuICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICBpbmNsdWRlcyA9IGFycmF5SW5jbHVkZXNXaXRoO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAobGVuZ3RoID49IExBUkdFX0FSUkFZX1NJWkUpIHtcbiAgICAgICAgdmFyIHNldCA9IGl0ZXJhdGVlID8gbnVsbCA6IGNyZWF0ZVNldChhcnJheSk7XG4gICAgICAgIGlmIChzZXQpIHtcbiAgICAgICAgICByZXR1cm4gc2V0VG9BcnJheShzZXQpO1xuICAgICAgICB9XG4gICAgICAgIGlzQ29tbW9uID0gZmFsc2U7XG4gICAgICAgIGluY2x1ZGVzID0gY2FjaGVIYXM7XG4gICAgICAgIHNlZW4gPSBuZXcgU2V0Q2FjaGU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc2VlbiA9IGl0ZXJhdGVlID8gW10gOiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBvdXRlcjpcbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XSxcbiAgICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSkgOiB2YWx1ZTtcblxuICAgICAgICB2YWx1ZSA9IChjb21wYXJhdG9yIHx8IHZhbHVlICE9PSAwKSA/IHZhbHVlIDogMDtcbiAgICAgICAgaWYgKGlzQ29tbW9uICYmIGNvbXB1dGVkID09PSBjb21wdXRlZCkge1xuICAgICAgICAgIHZhciBzZWVuSW5kZXggPSBzZWVuLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoc2VlbkluZGV4LS0pIHtcbiAgICAgICAgICAgIGlmIChzZWVuW3NlZW5JbmRleF0gPT09IGNvbXB1dGVkKSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXRlcmF0ZWUpIHtcbiAgICAgICAgICAgIHNlZW4ucHVzaChjb21wdXRlZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghaW5jbHVkZXMoc2VlbiwgY29tcHV0ZWQsIGNvbXBhcmF0b3IpKSB7XG4gICAgICAgICAgaWYgKHNlZW4gIT09IHJlc3VsdCkge1xuICAgICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnVuc2V0YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcHJvcGVydHkgcGF0aCB0byB1bnNldC5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHByb3BlcnR5IGlzIGRlbGV0ZWQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlVW5zZXQob2JqZWN0LCBwYXRoKSB7XG4gICAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTtcbiAgICAgIG9iamVjdCA9IHBhcmVudChvYmplY3QsIHBhdGgpO1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsIHx8IGRlbGV0ZSBvYmplY3RbdG9LZXkobGFzdChwYXRoKSldO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnVwZGF0ZWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHVwZGF0ZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB1cGRhdGVyIFRoZSBmdW5jdGlvbiB0byBwcm9kdWNlIHRoZSB1cGRhdGVkIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIHBhdGggY3JlYXRpb24uXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlVXBkYXRlKG9iamVjdCwgcGF0aCwgdXBkYXRlciwgY3VzdG9taXplcikge1xuICAgICAgcmV0dXJuIGJhc2VTZXQob2JqZWN0LCBwYXRoLCB1cGRhdGVyKGJhc2VHZXQob2JqZWN0LCBwYXRoKSksIGN1c3RvbWl6ZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIG1ldGhvZHMgbGlrZSBgXy5kcm9wV2hpbGVgIGFuZCBgXy50YWtlV2hpbGVgXG4gICAgICogd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNEcm9wXSBTcGVjaWZ5IGRyb3BwaW5nIGVsZW1lbnRzIGluc3RlYWQgb2YgdGFraW5nIHRoZW0uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VXaGlsZShhcnJheSwgcHJlZGljYXRlLCBpc0Ryb3AsIGZyb21SaWdodCkge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xO1xuXG4gICAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSAmJlxuICAgICAgICBwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7fVxuXG4gICAgICByZXR1cm4gaXNEcm9wXG4gICAgICAgID8gYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gMCA6IGluZGV4KSwgKGZyb21SaWdodCA/IGluZGV4ICsgMSA6IGxlbmd0aCkpXG4gICAgICAgIDogYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gaW5kZXggKyAxIDogMCksIChmcm9tUmlnaHQgPyBsZW5ndGggOiBpbmRleCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGB3cmFwcGVyVmFsdWVgIHdoaWNoIHJldHVybnMgdGhlIHJlc3VsdCBvZlxuICAgICAqIHBlcmZvcm1pbmcgYSBzZXF1ZW5jZSBvZiBhY3Rpb25zIG9uIHRoZSB1bndyYXBwZWQgYHZhbHVlYCwgd2hlcmUgZWFjaFxuICAgICAqIHN1Y2Nlc3NpdmUgYWN0aW9uIGlzIHN1cHBsaWVkIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIHByZXZpb3VzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB1bndyYXBwZWQgdmFsdWUuXG4gICAgICogQHBhcmFtIHtBcnJheX0gYWN0aW9ucyBBY3Rpb25zIHRvIHBlcmZvcm0gdG8gcmVzb2x2ZSB0aGUgdW53cmFwcGVkIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlV3JhcHBlclZhbHVlKHZhbHVlLCBhY3Rpb25zKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gdmFsdWU7XG4gICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgTGF6eVdyYXBwZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnZhbHVlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXJyYXlSZWR1Y2UoYWN0aW9ucywgZnVuY3Rpb24ocmVzdWx0LCBhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGFjdGlvbi5mdW5jLmFwcGx5KGFjdGlvbi50aGlzQXJnLCBhcnJheVB1c2goW3Jlc3VsdF0sIGFjdGlvbi5hcmdzKSk7XG4gICAgICB9LCByZXN1bHQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIG1ldGhvZHMgbGlrZSBgXy54b3JgLCB3aXRob3V0IHN1cHBvcnQgZm9yXG4gICAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcywgdGhhdCBhY2NlcHRzIGFuIGFycmF5IG9mIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheXMgVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgdmFsdWVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJhc2VYb3IoYXJyYXlzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5cy5sZW5ndGg7XG4gICAgICBpZiAobGVuZ3RoIDwgMikge1xuICAgICAgICByZXR1cm4gbGVuZ3RoID8gYmFzZVVuaXEoYXJyYXlzWzBdKSA6IFtdO1xuICAgICAgfVxuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIGFycmF5ID0gYXJyYXlzW2luZGV4XSxcbiAgICAgICAgICAgIG90aEluZGV4ID0gLTE7XG5cbiAgICAgICAgd2hpbGUgKCsrb3RoSW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgICBpZiAob3RoSW5kZXggIT0gaW5kZXgpIHtcbiAgICAgICAgICAgIHJlc3VsdFtpbmRleF0gPSBiYXNlRGlmZmVyZW5jZShyZXN1bHRbaW5kZXhdIHx8IGFycmF5LCBhcnJheXNbb3RoSW5kZXhdLCBpdGVyYXRlZSwgY29tcGFyYXRvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZVVuaXEoYmFzZUZsYXR0ZW4ocmVzdWx0LCAxKSwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy56aXBPYmplY3RgIHdoaWNoIGFzc2lnbnMgdmFsdWVzIHVzaW5nIGBhc3NpZ25GdW5jYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgVGhlIHByb3BlcnR5IGlkZW50aWZpZXJzLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgcHJvcGVydHkgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFzc2lnbkZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGFzc2lnbiB2YWx1ZXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiYXNlWmlwT2JqZWN0KHByb3BzLCB2YWx1ZXMsIGFzc2lnbkZ1bmMpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aCxcbiAgICAgICAgICB2YWxzTGVuZ3RoID0gdmFsdWVzLmxlbmd0aCxcbiAgICAgICAgICByZXN1bHQgPSB7fTtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gaW5kZXggPCB2YWxzTGVuZ3RoID8gdmFsdWVzW2luZGV4XSA6IHVuZGVmaW5lZDtcbiAgICAgICAgYXNzaWduRnVuYyhyZXN1bHQsIHByb3BzW2luZGV4XSwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYXN0cyBgdmFsdWVgIHRvIGFuIGVtcHR5IGFycmF5IGlmIGl0J3Mgbm90IGFuIGFycmF5IGxpa2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0LlxuICAgICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgdGhlIGNhc3QgYXJyYXktbGlrZSBvYmplY3QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2FzdEFycmF5TGlrZU9iamVjdCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0KHZhbHVlKSA/IHZhbHVlIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FzdHMgYHZhbHVlYCB0byBgaWRlbnRpdHlgIGlmIGl0J3Mgbm90IGEgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGluc3BlY3QuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIGNhc3QgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2FzdEZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicgPyB2YWx1ZSA6IGlkZW50aXR5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhc3RzIGB2YWx1ZWAgdG8gYSBwYXRoIGFycmF5IGlmIGl0J3Mgbm90IG9uZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeSBrZXlzIG9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY2FzdCBwcm9wZXJ0eSBwYXRoIGFycmF5LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNhc3RQYXRoKHZhbHVlLCBvYmplY3QpIHtcbiAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXNLZXkodmFsdWUsIG9iamVjdCkgPyBbdmFsdWVdIDogc3RyaW5nVG9QYXRoKHRvU3RyaW5nKHZhbHVlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBgYmFzZVJlc3RgIGFsaWFzIHdoaWNoIGNhbiBiZSByZXBsYWNlZCB3aXRoIGBpZGVudGl0eWAgYnkgbW9kdWxlXG4gICAgICogcmVwbGFjZW1lbnQgcGx1Z2lucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHR5cGUge0Z1bmN0aW9ufVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IGEgcmVzdCBwYXJhbWV0ZXIgdG8uXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICovXG4gICAgdmFyIGNhc3RSZXN0ID0gYmFzZVJlc3Q7XG5cbiAgICAvKipcbiAgICAgKiBDYXN0cyBgYXJyYXlgIHRvIGEgc2xpY2UgaWYgaXQncyBuZWVkZWQuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCBUaGUgc3RhcnQgcG9zaXRpb24uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtlbmQ9YXJyYXkubGVuZ3RoXSBUaGUgZW5kIHBvc2l0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY2FzdCBzbGljZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjYXN0U2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gICAgICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IGVuZDtcbiAgICAgIHJldHVybiAoIXN0YXJ0ICYmIGVuZCA+PSBsZW5ndGgpID8gYXJyYXkgOiBiYXNlU2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc2ltcGxlIHdyYXBwZXIgYXJvdW5kIHRoZSBnbG9iYWwgW2BjbGVhclRpbWVvdXRgXShodHRwczovL21kbi5pby9jbGVhclRpbWVvdXQpLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge251bWJlcnxPYmplY3R9IGlkIFRoZSB0aW1lciBpZCBvciB0aW1lb3V0IG9iamVjdCBvZiB0aGUgdGltZXIgdG8gY2xlYXIuXG4gICAgICovXG4gICAgdmFyIGNsZWFyVGltZW91dCA9IGN0eENsZWFyVGltZW91dCB8fCBmdW5jdGlvbihpZCkge1xuICAgICAgcmV0dXJuIHJvb3QuY2xlYXJUaW1lb3V0KGlkKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNsb25lIG9mICBgYnVmZmVyYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtCdWZmZXJ9IGJ1ZmZlciBUaGUgYnVmZmVyIHRvIGNsb25lLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuXG4gICAgICogQHJldHVybnMge0J1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGJ1ZmZlci5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZUJ1ZmZlcihidWZmZXIsIGlzRGVlcCkge1xuICAgICAgaWYgKGlzRGVlcCkge1xuICAgICAgICByZXR1cm4gYnVmZmVyLnNsaWNlKCk7XG4gICAgICB9XG4gICAgICB2YXIgbGVuZ3RoID0gYnVmZmVyLmxlbmd0aCxcbiAgICAgICAgICByZXN1bHQgPSBhbGxvY1Vuc2FmZSA/IGFsbG9jVW5zYWZlKGxlbmd0aCkgOiBuZXcgYnVmZmVyLmNvbnN0cnVjdG9yKGxlbmd0aCk7XG5cbiAgICAgIGJ1ZmZlci5jb3B5KHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgYXJyYXlCdWZmZXJgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnJheUJ1ZmZlciBUaGUgYXJyYXkgYnVmZmVyIHRvIGNsb25lLlxuICAgICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGFycmF5IGJ1ZmZlci5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZUFycmF5QnVmZmVyKGFycmF5QnVmZmVyKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gbmV3IGFycmF5QnVmZmVyLmNvbnN0cnVjdG9yKGFycmF5QnVmZmVyLmJ5dGVMZW5ndGgpO1xuICAgICAgbmV3IFVpbnQ4QXJyYXkocmVzdWx0KS5zZXQobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBkYXRhVmlld2AuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhVmlldyBUaGUgZGF0YSB2aWV3IHRvIGNsb25lLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIGRhdGEgdmlldy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZURhdGFWaWV3KGRhdGFWaWV3LCBpc0RlZXApIHtcbiAgICAgIHZhciBidWZmZXIgPSBpc0RlZXAgPyBjbG9uZUFycmF5QnVmZmVyKGRhdGFWaWV3LmJ1ZmZlcikgOiBkYXRhVmlldy5idWZmZXI7XG4gICAgICByZXR1cm4gbmV3IGRhdGFWaWV3LmNvbnN0cnVjdG9yKGJ1ZmZlciwgZGF0YVZpZXcuYnl0ZU9mZnNldCwgZGF0YVZpZXcuYnl0ZUxlbmd0aCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBtYXBgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY2xvbmUuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgbWFwLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb25lTWFwKG1hcCwgaXNEZWVwLCBjbG9uZUZ1bmMpIHtcbiAgICAgIHZhciBhcnJheSA9IGlzRGVlcCA/IGNsb25lRnVuYyhtYXBUb0FycmF5KG1hcCksIENMT05FX0RFRVBfRkxBRykgOiBtYXBUb0FycmF5KG1hcCk7XG4gICAgICByZXR1cm4gYXJyYXlSZWR1Y2UoYXJyYXksIGFkZE1hcEVudHJ5LCBuZXcgbWFwLmNvbnN0cnVjdG9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHJlZ2V4cGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgVGhlIHJlZ2V4cCB0byBjbG9uZS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgcmVnZXhwLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHJlZ2V4cCkge1xuICAgICAgdmFyIHJlc3VsdCA9IG5ldyByZWdleHAuY29uc3RydWN0b3IocmVnZXhwLnNvdXJjZSwgcmVGbGFncy5leGVjKHJlZ2V4cCkpO1xuICAgICAgcmVzdWx0Lmxhc3RJbmRleCA9IHJlZ2V4cC5sYXN0SW5kZXg7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgc2V0YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIGNsb25lLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNsb25lRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2xvbmUgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIHNldC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZVNldChzZXQsIGlzRGVlcCwgY2xvbmVGdW5jKSB7XG4gICAgICB2YXIgYXJyYXkgPSBpc0RlZXAgPyBjbG9uZUZ1bmMoc2V0VG9BcnJheShzZXQpLCBDTE9ORV9ERUVQX0ZMQUcpIDogc2V0VG9BcnJheShzZXQpO1xuICAgICAgcmV0dXJuIGFycmF5UmVkdWNlKGFycmF5LCBhZGRTZXRFbnRyeSwgbmV3IHNldC5jb25zdHJ1Y3Rvcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNsb25lIG9mIHRoZSBgc3ltYm9sYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzeW1ib2wgVGhlIHN5bWJvbCBvYmplY3QgdG8gY2xvbmUuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIHN5bWJvbCBvYmplY3QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvbmVTeW1ib2woc3ltYm9sKSB7XG4gICAgICByZXR1cm4gc3ltYm9sVmFsdWVPZiA/IE9iamVjdChzeW1ib2xWYWx1ZU9mLmNhbGwoc3ltYm9sKSkgOiB7fTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHR5cGVkQXJyYXlgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHlwZWRBcnJheSBUaGUgdHlwZWQgYXJyYXkgdG8gY2xvbmUuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgdHlwZWQgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvbmVUeXBlZEFycmF5KHR5cGVkQXJyYXksIGlzRGVlcCkge1xuICAgICAgdmFyIGJ1ZmZlciA9IGlzRGVlcCA/IGNsb25lQXJyYXlCdWZmZXIodHlwZWRBcnJheS5idWZmZXIpIDogdHlwZWRBcnJheS5idWZmZXI7XG4gICAgICByZXR1cm4gbmV3IHR5cGVkQXJyYXkuY29uc3RydWN0b3IoYnVmZmVyLCB0eXBlZEFycmF5LmJ5dGVPZmZzZXQsIHR5cGVkQXJyYXkubGVuZ3RoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb21wYXJlcyB2YWx1ZXMgdG8gc29ydCB0aGVtIGluIGFzY2VuZGluZyBvcmRlci5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHNvcnQgb3JkZXIgaW5kaWNhdG9yIGZvciBgdmFsdWVgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbXBhcmVBc2NlbmRpbmcodmFsdWUsIG90aGVyKSB7XG4gICAgICBpZiAodmFsdWUgIT09IG90aGVyKSB7XG4gICAgICAgIHZhciB2YWxJc0RlZmluZWQgPSB2YWx1ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgdmFsSXNOdWxsID0gdmFsdWUgPT09IG51bGwsXG4gICAgICAgICAgICB2YWxJc1JlZmxleGl2ZSA9IHZhbHVlID09PSB2YWx1ZSxcbiAgICAgICAgICAgIHZhbElzU3ltYm9sID0gaXNTeW1ib2wodmFsdWUpO1xuXG4gICAgICAgIHZhciBvdGhJc0RlZmluZWQgPSBvdGhlciAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgb3RoSXNOdWxsID0gb3RoZXIgPT09IG51bGwsXG4gICAgICAgICAgICBvdGhJc1JlZmxleGl2ZSA9IG90aGVyID09PSBvdGhlcixcbiAgICAgICAgICAgIG90aElzU3ltYm9sID0gaXNTeW1ib2wob3RoZXIpO1xuXG4gICAgICAgIGlmICgoIW90aElzTnVsbCAmJiAhb3RoSXNTeW1ib2wgJiYgIXZhbElzU3ltYm9sICYmIHZhbHVlID4gb3RoZXIpIHx8XG4gICAgICAgICAgICAodmFsSXNTeW1ib2wgJiYgb3RoSXNEZWZpbmVkICYmIG90aElzUmVmbGV4aXZlICYmICFvdGhJc051bGwgJiYgIW90aElzU3ltYm9sKSB8fFxuICAgICAgICAgICAgKHZhbElzTnVsbCAmJiBvdGhJc0RlZmluZWQgJiYgb3RoSXNSZWZsZXhpdmUpIHx8XG4gICAgICAgICAgICAoIXZhbElzRGVmaW5lZCAmJiBvdGhJc1JlZmxleGl2ZSkgfHxcbiAgICAgICAgICAgICF2YWxJc1JlZmxleGl2ZSkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoIXZhbElzTnVsbCAmJiAhdmFsSXNTeW1ib2wgJiYgIW90aElzU3ltYm9sICYmIHZhbHVlIDwgb3RoZXIpIHx8XG4gICAgICAgICAgICAob3RoSXNTeW1ib2wgJiYgdmFsSXNEZWZpbmVkICYmIHZhbElzUmVmbGV4aXZlICYmICF2YWxJc051bGwgJiYgIXZhbElzU3ltYm9sKSB8fFxuICAgICAgICAgICAgKG90aElzTnVsbCAmJiB2YWxJc0RlZmluZWQgJiYgdmFsSXNSZWZsZXhpdmUpIHx8XG4gICAgICAgICAgICAoIW90aElzRGVmaW5lZCAmJiB2YWxJc1JlZmxleGl2ZSkgfHxcbiAgICAgICAgICAgICFvdGhJc1JlZmxleGl2ZSkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlZCBieSBgXy5vcmRlckJ5YCB0byBjb21wYXJlIG11bHRpcGxlIHByb3BlcnRpZXMgb2YgYSB2YWx1ZSB0byBhbm90aGVyXG4gICAgICogYW5kIHN0YWJsZSBzb3J0IHRoZW0uXG4gICAgICpcbiAgICAgKiBJZiBgb3JkZXJzYCBpcyB1bnNwZWNpZmllZCwgYWxsIHZhbHVlcyBhcmUgc29ydGVkIGluIGFzY2VuZGluZyBvcmRlci4gT3RoZXJ3aXNlLFxuICAgICAqIHNwZWNpZnkgYW4gb3JkZXIgb2YgXCJkZXNjXCIgZm9yIGRlc2NlbmRpbmcgb3IgXCJhc2NcIiBmb3IgYXNjZW5kaW5nIHNvcnQgb3JkZXJcbiAgICAgKiBvZiBjb3JyZXNwb25kaW5nIHZhbHVlcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW5bXXxzdHJpbmdbXX0gb3JkZXJzIFRoZSBvcmRlciB0byBzb3J0IGJ5IGZvciBlYWNoIHByb3BlcnR5LlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHNvcnQgb3JkZXIgaW5kaWNhdG9yIGZvciBgb2JqZWN0YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb21wYXJlTXVsdGlwbGUob2JqZWN0LCBvdGhlciwgb3JkZXJzKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBvYmpDcml0ZXJpYSA9IG9iamVjdC5jcml0ZXJpYSxcbiAgICAgICAgICBvdGhDcml0ZXJpYSA9IG90aGVyLmNyaXRlcmlhLFxuICAgICAgICAgIGxlbmd0aCA9IG9iakNyaXRlcmlhLmxlbmd0aCxcbiAgICAgICAgICBvcmRlcnNMZW5ndGggPSBvcmRlcnMubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gY29tcGFyZUFzY2VuZGluZyhvYmpDcml0ZXJpYVtpbmRleF0sIG90aENyaXRlcmlhW2luZGV4XSk7XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICBpZiAoaW5kZXggPj0gb3JkZXJzTGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgb3JkZXIgPSBvcmRlcnNbaW5kZXhdO1xuICAgICAgICAgIHJldHVybiByZXN1bHQgKiAob3JkZXIgPT0gJ2Rlc2MnID8gLTEgOiAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gRml4ZXMgYW4gYEFycmF5I3NvcnRgIGJ1ZyBpbiB0aGUgSlMgZW5naW5lIGVtYmVkZGVkIGluIEFkb2JlIGFwcGxpY2F0aW9uc1xuICAgICAgLy8gdGhhdCBjYXVzZXMgaXQsIHVuZGVyIGNlcnRhaW4gY2lyY3Vtc3RhbmNlcywgdG8gcHJvdmlkZSB0aGUgc2FtZSB2YWx1ZSBmb3JcbiAgICAgIC8vIGBvYmplY3RgIGFuZCBgb3RoZXJgLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2phc2hrZW5hcy91bmRlcnNjb3JlL3B1bGwvMTI0N1xuICAgICAgLy8gZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgIC8vXG4gICAgICAvLyBUaGlzIGFsc28gZW5zdXJlcyBhIHN0YWJsZSBzb3J0IGluIFY4IGFuZCBvdGhlciBlbmdpbmVzLlxuICAgICAgLy8gU2VlIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTkwIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICByZXR1cm4gb2JqZWN0LmluZGV4IC0gb3RoZXIuaW5kZXg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSB0aGF0IGlzIHRoZSBjb21wb3NpdGlvbiBvZiBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMsXG4gICAgICogcGxhY2Vob2xkZXJzLCBhbmQgcHJvdmlkZWQgYXJndW1lbnRzIGludG8gYSBzaW5nbGUgYXJyYXkgb2YgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFydGlhbHMgVGhlIGFyZ3VtZW50cyB0byBwcmVwZW5kIHRvIHRob3NlIHByb3ZpZGVkLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGhvbGRlcnMgVGhlIGBwYXJ0aWFsc2AgcGxhY2Vob2xkZXIgaW5kZXhlcy5cbiAgICAgKiBAcGFyYW1zIHtib29sZWFufSBbaXNDdXJyaWVkXSBTcGVjaWZ5IGNvbXBvc2luZyBmb3IgYSBjdXJyaWVkIGZ1bmN0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGNvbXBvc2VkIGFyZ3VtZW50cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb21wb3NlQXJncyhhcmdzLCBwYXJ0aWFscywgaG9sZGVycywgaXNDdXJyaWVkKSB7XG4gICAgICB2YXIgYXJnc0luZGV4ID0gLTEsXG4gICAgICAgICAgYXJnc0xlbmd0aCA9IGFyZ3MubGVuZ3RoLFxuICAgICAgICAgIGhvbGRlcnNMZW5ndGggPSBob2xkZXJzLmxlbmd0aCxcbiAgICAgICAgICBsZWZ0SW5kZXggPSAtMSxcbiAgICAgICAgICBsZWZ0TGVuZ3RoID0gcGFydGlhbHMubGVuZ3RoLFxuICAgICAgICAgIHJhbmdlTGVuZ3RoID0gbmF0aXZlTWF4KGFyZ3NMZW5ndGggLSBob2xkZXJzTGVuZ3RoLCAwKSxcbiAgICAgICAgICByZXN1bHQgPSBBcnJheShsZWZ0TGVuZ3RoICsgcmFuZ2VMZW5ndGgpLFxuICAgICAgICAgIGlzVW5jdXJyaWVkID0gIWlzQ3VycmllZDtcblxuICAgICAgd2hpbGUgKCsrbGVmdEluZGV4IDwgbGVmdExlbmd0aCkge1xuICAgICAgICByZXN1bHRbbGVmdEluZGV4XSA9IHBhcnRpYWxzW2xlZnRJbmRleF07XG4gICAgICB9XG4gICAgICB3aGlsZSAoKythcmdzSW5kZXggPCBob2xkZXJzTGVuZ3RoKSB7XG4gICAgICAgIGlmIChpc1VuY3VycmllZCB8fCBhcmdzSW5kZXggPCBhcmdzTGVuZ3RoKSB7XG4gICAgICAgICAgcmVzdWx0W2hvbGRlcnNbYXJnc0luZGV4XV0gPSBhcmdzW2FyZ3NJbmRleF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdoaWxlIChyYW5nZUxlbmd0aC0tKSB7XG4gICAgICAgIHJlc3VsdFtsZWZ0SW5kZXgrK10gPSBhcmdzW2FyZ3NJbmRleCsrXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBsaWtlIGBjb21wb3NlQXJnc2AgZXhjZXB0IHRoYXQgdGhlIGFyZ3VtZW50cyBjb21wb3NpdGlvblxuICAgICAqIGlzIHRhaWxvcmVkIGZvciBgXy5wYXJ0aWFsUmlnaHRgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFydGlhbHMgVGhlIGFyZ3VtZW50cyB0byBhcHBlbmQgdG8gdGhvc2UgcHJvdmlkZWQuXG4gICAgICogQHBhcmFtIHtBcnJheX0gaG9sZGVycyBUaGUgYHBhcnRpYWxzYCBwbGFjZWhvbGRlciBpbmRleGVzLlxuICAgICAqIEBwYXJhbXMge2Jvb2xlYW59IFtpc0N1cnJpZWRdIFNwZWNpZnkgY29tcG9zaW5nIGZvciBhIGN1cnJpZWQgZnVuY3Rpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgY29tcG9zZWQgYXJndW1lbnRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbXBvc2VBcmdzUmlnaHQoYXJncywgcGFydGlhbHMsIGhvbGRlcnMsIGlzQ3VycmllZCkge1xuICAgICAgdmFyIGFyZ3NJbmRleCA9IC0xLFxuICAgICAgICAgIGFyZ3NMZW5ndGggPSBhcmdzLmxlbmd0aCxcbiAgICAgICAgICBob2xkZXJzSW5kZXggPSAtMSxcbiAgICAgICAgICBob2xkZXJzTGVuZ3RoID0gaG9sZGVycy5sZW5ndGgsXG4gICAgICAgICAgcmlnaHRJbmRleCA9IC0xLFxuICAgICAgICAgIHJpZ2h0TGVuZ3RoID0gcGFydGlhbHMubGVuZ3RoLFxuICAgICAgICAgIHJhbmdlTGVuZ3RoID0gbmF0aXZlTWF4KGFyZ3NMZW5ndGggLSBob2xkZXJzTGVuZ3RoLCAwKSxcbiAgICAgICAgICByZXN1bHQgPSBBcnJheShyYW5nZUxlbmd0aCArIHJpZ2h0TGVuZ3RoKSxcbiAgICAgICAgICBpc1VuY3VycmllZCA9ICFpc0N1cnJpZWQ7XG5cbiAgICAgIHdoaWxlICgrK2FyZ3NJbmRleCA8IHJhbmdlTGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFthcmdzSW5kZXhdID0gYXJnc1thcmdzSW5kZXhdO1xuICAgICAgfVxuICAgICAgdmFyIG9mZnNldCA9IGFyZ3NJbmRleDtcbiAgICAgIHdoaWxlICgrK3JpZ2h0SW5kZXggPCByaWdodExlbmd0aCkge1xuICAgICAgICByZXN1bHRbb2Zmc2V0ICsgcmlnaHRJbmRleF0gPSBwYXJ0aWFsc1tyaWdodEluZGV4XTtcbiAgICAgIH1cbiAgICAgIHdoaWxlICgrK2hvbGRlcnNJbmRleCA8IGhvbGRlcnNMZW5ndGgpIHtcbiAgICAgICAgaWYgKGlzVW5jdXJyaWVkIHx8IGFyZ3NJbmRleCA8IGFyZ3NMZW5ndGgpIHtcbiAgICAgICAgICByZXN1bHRbb2Zmc2V0ICsgaG9sZGVyc1tob2xkZXJzSW5kZXhdXSA9IGFyZ3NbYXJnc0luZGV4KytdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcGllcyB0aGUgdmFsdWVzIG9mIGBzb3VyY2VgIHRvIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgZnJvbS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXk9W11dIFRoZSBhcnJheSB0byBjb3B5IHZhbHVlcyB0by5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb3B5QXJyYXkoc291cmNlLCBhcnJheSkge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gc291cmNlLmxlbmd0aDtcblxuICAgICAgYXJyYXkgfHwgKGFycmF5ID0gQXJyYXkobGVuZ3RoKSk7XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcGllcyBwcm9wZXJ0aWVzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBwcm9wZXJ0aWVzIGZyb20uXG4gICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgVGhlIHByb3BlcnR5IGlkZW50aWZpZXJzIHRvIGNvcHkuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBwcm9wZXJ0aWVzIHRvLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvcGllZCB2YWx1ZXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb3B5T2JqZWN0KHNvdXJjZSwgcHJvcHMsIG9iamVjdCwgY3VzdG9taXplcikge1xuICAgICAgdmFyIGlzTmV3ID0gIW9iamVjdDtcbiAgICAgIG9iamVjdCB8fCAob2JqZWN0ID0ge30pO1xuXG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07XG5cbiAgICAgICAgdmFyIG5ld1ZhbHVlID0gY3VzdG9taXplclxuICAgICAgICAgID8gY3VzdG9taXplcihvYmplY3Rba2V5XSwgc291cmNlW2tleV0sIGtleSwgb2JqZWN0LCBzb3VyY2UpXG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IHNvdXJjZVtrZXldO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc05ldykge1xuICAgICAgICAgIGJhc2VBc3NpZ25WYWx1ZShvYmplY3QsIGtleSwgbmV3VmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFzc2lnblZhbHVlKG9iamVjdCwga2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29waWVzIG93biBzeW1ib2xzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29weVN5bWJvbHMoc291cmNlLCBvYmplY3QpIHtcbiAgICAgIHJldHVybiBjb3B5T2JqZWN0KHNvdXJjZSwgZ2V0U3ltYm9scyhzb3VyY2UpLCBvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcGllcyBvd24gYW5kIGluaGVyaXRlZCBzeW1ib2xzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29weVN5bWJvbHNJbihzb3VyY2UsIG9iamVjdCkge1xuICAgICAgcmV0dXJuIGNvcHlPYmplY3Qoc291cmNlLCBnZXRTeW1ib2xzSW4oc291cmNlKSwgb2JqZWN0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gbGlrZSBgXy5ncm91cEJ5YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc2V0dGVyIFRoZSBmdW5jdGlvbiB0byBzZXQgYWNjdW11bGF0b3IgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpbml0aWFsaXplcl0gVGhlIGFjY3VtdWxhdG9yIG9iamVjdCBpbml0aWFsaXplci5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhZ2dyZWdhdG9yIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZUFnZ3JlZ2F0b3Ioc2V0dGVyLCBpbml0aWFsaXplcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7XG4gICAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5QWdncmVnYXRvciA6IGJhc2VBZ2dyZWdhdG9yLFxuICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBpbml0aWFsaXplciA/IGluaXRpYWxpemVyKCkgOiB7fTtcblxuICAgICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBzZXR0ZXIsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSwgYWNjdW11bGF0b3IpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gbGlrZSBgXy5hc3NpZ25gLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhc3NpZ25lciBUaGUgZnVuY3Rpb24gdG8gYXNzaWduIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhc3NpZ25lciBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVBc3NpZ25lcihhc3NpZ25lcikge1xuICAgICAgcmV0dXJuIGJhc2VSZXN0KGZ1bmN0aW9uKG9iamVjdCwgc291cmNlcykge1xuICAgICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICAgIGxlbmd0aCA9IHNvdXJjZXMubGVuZ3RoLFxuICAgICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA+IDEgPyBzb3VyY2VzW2xlbmd0aCAtIDFdIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZ3VhcmQgPSBsZW5ndGggPiAyID8gc291cmNlc1syXSA6IHVuZGVmaW5lZDtcblxuICAgICAgICBjdXN0b21pemVyID0gKGFzc2lnbmVyLmxlbmd0aCA+IDMgJiYgdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICA/IChsZW5ndGgtLSwgY3VzdG9taXplcilcbiAgICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc291cmNlc1swXSwgc291cmNlc1sxXSwgZ3VhcmQpKSB7XG4gICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA8IDMgPyB1bmRlZmluZWQgOiBjdXN0b21pemVyO1xuICAgICAgICAgIGxlbmd0aCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgb2JqZWN0ID0gT2JqZWN0KG9iamVjdCk7XG4gICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIHNvdXJjZSA9IHNvdXJjZXNbaW5kZXhdO1xuICAgICAgICAgIGlmIChzb3VyY2UpIHtcbiAgICAgICAgICAgIGFzc2lnbmVyKG9iamVjdCwgc291cmNlLCBpbmRleCwgY3VzdG9taXplcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYGJhc2VFYWNoYCBvciBgYmFzZUVhY2hSaWdodGAgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGVhY2hGdW5jIFRoZSBmdW5jdGlvbiB0byBpdGVyYXRlIG92ZXIgYSBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGJhc2UgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlQmFzZUVhY2goZWFjaEZ1bmMsIGZyb21SaWdodCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7XG4gICAgICAgIGlmIChjb2xsZWN0aW9uID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzQXJyYXlMaWtlKGNvbGxlY3Rpb24pKSB7XG4gICAgICAgICAgcmV0dXJuIGVhY2hGdW5jKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGgsXG4gICAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xLFxuICAgICAgICAgICAgaXRlcmFibGUgPSBPYmplY3QoY29sbGVjdGlvbik7XG5cbiAgICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHtcbiAgICAgICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVbaW5kZXhdLCBpbmRleCwgaXRlcmFibGUpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYmFzZSBmdW5jdGlvbiBmb3IgbWV0aG9kcyBsaWtlIGBfLmZvckluYCBhbmQgYF8uZm9yT3duYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYmFzZSBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVCYXNlRm9yKGZyb21SaWdodCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNGdW5jKSB7XG4gICAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgICAgaXRlcmFibGUgPSBPYmplY3Qob2JqZWN0KSxcbiAgICAgICAgICAgIHByb3BzID0ga2V5c0Z1bmMob2JqZWN0KSxcbiAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDtcblxuICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgICB2YXIga2V5ID0gcHJvcHNbZnJvbVJpZ2h0ID8gbGVuZ3RoIDogKytpbmRleF07XG4gICAgICAgICAgaWYgKGl0ZXJhdGVlKGl0ZXJhYmxlW2tleV0sIGtleSwgaXRlcmFibGUpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHdyYXBzIGBmdW5jYCB0byBpbnZva2UgaXQgd2l0aCB0aGUgb3B0aW9uYWwgYHRoaXNgXG4gICAgICogYmluZGluZyBvZiBgdGhpc0FyZ2AuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgY3JlYXRlV3JhcGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHdyYXBwZWQgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlQmluZChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnKSB7XG4gICAgICB2YXIgaXNCaW5kID0gYml0bWFzayAmIFdSQVBfQklORF9GTEFHLFxuICAgICAgICAgIEN0b3IgPSBjcmVhdGVDdG9yKGZ1bmMpO1xuXG4gICAgICBmdW5jdGlvbiB3cmFwcGVyKCkge1xuICAgICAgICB2YXIgZm4gPSAodGhpcyAmJiB0aGlzICE9PSByb290ICYmIHRoaXMgaW5zdGFuY2VvZiB3cmFwcGVyKSA/IEN0b3IgOiBmdW5jO1xuICAgICAgICByZXR1cm4gZm4uYXBwbHkoaXNCaW5kID8gdGhpc0FyZyA6IHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gd3JhcHBlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gbGlrZSBgXy5sb3dlckZpcnN0YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZE5hbWUgVGhlIG5hbWUgb2YgdGhlIGBTdHJpbmdgIGNhc2UgbWV0aG9kIHRvIHVzZS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjYXNlIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZUNhc2VGaXJzdChtZXRob2ROYW1lKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG5cbiAgICAgICAgdmFyIHN0clN5bWJvbHMgPSBoYXNVbmljb2RlKHN0cmluZylcbiAgICAgICAgICA/IHN0cmluZ1RvQXJyYXkoc3RyaW5nKVxuICAgICAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIHZhciBjaHIgPSBzdHJTeW1ib2xzXG4gICAgICAgICAgPyBzdHJTeW1ib2xzWzBdXG4gICAgICAgICAgOiBzdHJpbmcuY2hhckF0KDApO1xuXG4gICAgICAgIHZhciB0cmFpbGluZyA9IHN0clN5bWJvbHNcbiAgICAgICAgICA/IGNhc3RTbGljZShzdHJTeW1ib2xzLCAxKS5qb2luKCcnKVxuICAgICAgICAgIDogc3RyaW5nLnNsaWNlKDEpO1xuXG4gICAgICAgIHJldHVybiBjaHJbbWV0aG9kTmFtZV0oKSArIHRyYWlsaW5nO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gbGlrZSBgXy5jYW1lbENhc2VgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY29tYmluZSBlYWNoIHdvcmQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY29tcG91bmRlciBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVDb21wb3VuZGVyKGNhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBhcnJheVJlZHVjZSh3b3JkcyhkZWJ1cnIoc3RyaW5nKS5yZXBsYWNlKHJlQXBvcywgJycpKSwgY2FsbGJhY2ssICcnKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcHJvZHVjZXMgYW4gaW5zdGFuY2Ugb2YgYEN0b3JgIHJlZ2FyZGxlc3Mgb2ZcbiAgICAgKiB3aGV0aGVyIGl0IHdhcyBpbnZva2VkIGFzIHBhcnQgb2YgYSBgbmV3YCBleHByZXNzaW9uIG9yIGJ5IGBjYWxsYCBvciBgYXBwbHlgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBDdG9yIFRoZSBjb25zdHJ1Y3RvciB0byB3cmFwLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHdyYXBwZWQgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlQ3RvcihDdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFVzZSBhIGBzd2l0Y2hgIHN0YXRlbWVudCB0byB3b3JrIHdpdGggY2xhc3MgY29uc3RydWN0b3JzLiBTZWVcbiAgICAgICAgLy8gaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1mdW5jdGlvbi1vYmplY3RzLWNhbGwtdGhpc2FyZ3VtZW50LWFyZ3VtZW50c2xpc3RcbiAgICAgICAgLy8gZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICBjYXNlIDA6IHJldHVybiBuZXcgQ3RvcjtcbiAgICAgICAgICBjYXNlIDE6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdKTtcbiAgICAgICAgICBjYXNlIDI6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgICAgICBjYXNlIDM6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgICBjYXNlIDQ6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTtcbiAgICAgICAgICBjYXNlIDU6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdKTtcbiAgICAgICAgICBjYXNlIDY6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTtcbiAgICAgICAgICBjYXNlIDc6IHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdLCBhcmdzWzZdKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGhpc0JpbmRpbmcgPSBiYXNlQ3JlYXRlKEN0b3IucHJvdG90eXBlKSxcbiAgICAgICAgICAgIHJlc3VsdCA9IEN0b3IuYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpO1xuXG4gICAgICAgIC8vIE1pbWljIHRoZSBjb25zdHJ1Y3RvcidzIGByZXR1cm5gIGJlaGF2aW9yLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9lczUuZ2l0aHViLmlvLyN4MTMuMi4yIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICAgIHJldHVybiBpc09iamVjdChyZXN1bHQpID8gcmVzdWx0IDogdGhpc0JpbmRpbmc7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHdyYXBzIGBmdW5jYCB0byBlbmFibGUgY3VycnlpbmcuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgY3JlYXRlV3JhcGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYXJpdHkgVGhlIGFyaXR5IG9mIGBmdW5jYC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZUN1cnJ5KGZ1bmMsIGJpdG1hc2ssIGFyaXR5KSB7XG4gICAgICB2YXIgQ3RvciA9IGNyZWF0ZUN0b3IoZnVuYyk7XG5cbiAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7XG4gICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgYXJncyA9IEFycmF5KGxlbmd0aCksXG4gICAgICAgICAgICBpbmRleCA9IGxlbmd0aCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gZ2V0SG9sZGVyKHdyYXBwZXIpO1xuXG4gICAgICAgIHdoaWxlIChpbmRleC0tKSB7XG4gICAgICAgICAgYXJnc1tpbmRleF0gPSBhcmd1bWVudHNbaW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBob2xkZXJzID0gKGxlbmd0aCA8IDMgJiYgYXJnc1swXSAhPT0gcGxhY2Vob2xkZXIgJiYgYXJnc1tsZW5ndGggLSAxXSAhPT0gcGxhY2Vob2xkZXIpXG4gICAgICAgICAgPyBbXVxuICAgICAgICAgIDogcmVwbGFjZUhvbGRlcnMoYXJncywgcGxhY2Vob2xkZXIpO1xuXG4gICAgICAgIGxlbmd0aCAtPSBob2xkZXJzLmxlbmd0aDtcbiAgICAgICAgaWYgKGxlbmd0aCA8IGFyaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZVJlY3VycnkoXG4gICAgICAgICAgICBmdW5jLCBiaXRtYXNrLCBjcmVhdGVIeWJyaWQsIHdyYXBwZXIucGxhY2Vob2xkZXIsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGFyZ3MsIGhvbGRlcnMsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBhcml0eSAtIGxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGZuID0gKHRoaXMgJiYgdGhpcyAhPT0gcm9vdCAmJiB0aGlzIGluc3RhbmNlb2Ygd3JhcHBlcikgPyBDdG9yIDogZnVuYztcbiAgICAgICAgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBgXy5maW5kYCBvciBgXy5maW5kTGFzdGAgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZpbmRJbmRleEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGZpbmQgdGhlIGNvbGxlY3Rpb24gaW5kZXguXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZmluZCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVGaW5kKGZpbmRJbmRleEZ1bmMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIGZyb21JbmRleCkge1xuICAgICAgICB2YXIgaXRlcmFibGUgPSBPYmplY3QoY29sbGVjdGlvbik7XG4gICAgICAgIGlmICghaXNBcnJheUxpa2UoY29sbGVjdGlvbikpIHtcbiAgICAgICAgICB2YXIgaXRlcmF0ZWUgPSBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpO1xuICAgICAgICAgIGNvbGxlY3Rpb24gPSBrZXlzKGNvbGxlY3Rpb24pO1xuICAgICAgICAgIHByZWRpY2F0ZSA9IGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gaXRlcmF0ZWUoaXRlcmFibGVba2V5XSwga2V5LCBpdGVyYWJsZSk7IH07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4RnVuYyhjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIGZyb21JbmRleCk7XG4gICAgICAgIHJldHVybiBpbmRleCA+IC0xID8gaXRlcmFibGVbaXRlcmF0ZWUgPyBjb2xsZWN0aW9uW2luZGV4XSA6IGluZGV4XSA6IHVuZGVmaW5lZDtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGBfLmZsb3dgIG9yIGBfLmZsb3dSaWdodGAgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZsb3cgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlRmxvdyhmcm9tUmlnaHQpIHtcbiAgICAgIHJldHVybiBmbGF0UmVzdChmdW5jdGlvbihmdW5jcykge1xuICAgICAgICB2YXIgbGVuZ3RoID0gZnVuY3MubGVuZ3RoLFxuICAgICAgICAgICAgaW5kZXggPSBsZW5ndGgsXG4gICAgICAgICAgICBwcmVyZXEgPSBMb2Rhc2hXcmFwcGVyLnByb3RvdHlwZS50aHJ1O1xuXG4gICAgICAgIGlmIChmcm9tUmlnaHQpIHtcbiAgICAgICAgICBmdW5jcy5yZXZlcnNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKGluZGV4LS0pIHtcbiAgICAgICAgICB2YXIgZnVuYyA9IGZ1bmNzW2luZGV4XTtcbiAgICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocHJlcmVxICYmICF3cmFwcGVyICYmIGdldEZ1bmNOYW1lKGZ1bmMpID09ICd3cmFwcGVyJykge1xuICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSBuZXcgTG9kYXNoV3JhcHBlcihbXSwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGluZGV4ID0gd3JhcHBlciA/IGluZGV4IDogbGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICAgIGZ1bmMgPSBmdW5jc1tpbmRleF07XG5cbiAgICAgICAgICB2YXIgZnVuY05hbWUgPSBnZXRGdW5jTmFtZShmdW5jKSxcbiAgICAgICAgICAgICAgZGF0YSA9IGZ1bmNOYW1lID09ICd3cmFwcGVyJyA/IGdldERhdGEoZnVuYykgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICBpZiAoZGF0YSAmJiBpc0xhemlhYmxlKGRhdGFbMF0pICYmXG4gICAgICAgICAgICAgICAgZGF0YVsxXSA9PSAoV1JBUF9BUllfRkxBRyB8IFdSQVBfQ1VSUllfRkxBRyB8IFdSQVBfUEFSVElBTF9GTEFHIHwgV1JBUF9SRUFSR19GTEFHKSAmJlxuICAgICAgICAgICAgICAgICFkYXRhWzRdLmxlbmd0aCAmJiBkYXRhWzldID09IDFcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICB3cmFwcGVyID0gd3JhcHBlcltnZXRGdW5jTmFtZShkYXRhWzBdKV0uYXBwbHkod3JhcHBlciwgZGF0YVszXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdyYXBwZXIgPSAoZnVuYy5sZW5ndGggPT0gMSAmJiBpc0xhemlhYmxlKGZ1bmMpKVxuICAgICAgICAgICAgICA/IHdyYXBwZXJbZnVuY05hbWVdKClcbiAgICAgICAgICAgICAgOiB3cmFwcGVyLnRocnUoZnVuYyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgdmFsdWUgPSBhcmdzWzBdO1xuXG4gICAgICAgICAgaWYgKHdyYXBwZXIgJiYgYXJncy5sZW5ndGggPT0gMSAmJiBpc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHdyYXBwZXIucGxhbnQodmFsdWUpLnZhbHVlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBpbmRleCA9IDAsXG4gICAgICAgICAgICAgIHJlc3VsdCA9IGxlbmd0aCA/IGZ1bmNzW2luZGV4XS5hcHBseSh0aGlzLCBhcmdzKSA6IHZhbHVlO1xuXG4gICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmNzW2luZGV4XS5jYWxsKHRoaXMsIHJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCB3cmFwcyBgZnVuY2AgdG8gaW52b2tlIGl0IHdpdGggb3B0aW9uYWwgYHRoaXNgXG4gICAgICogYmluZGluZyBvZiBgdGhpc0FyZ2AsIHBhcnRpYWwgYXBwbGljYXRpb24sIGFuZCBjdXJyeWluZy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbnxzdHJpbmd9IGZ1bmMgVGhlIGZ1bmN0aW9uIG9yIG1ldGhvZCBuYW1lIHRvIHdyYXAuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgY3JlYXRlV3JhcGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0geyp9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtwYXJ0aWFsc10gVGhlIGFyZ3VtZW50cyB0byBwcmVwZW5kIHRvIHRob3NlIHByb3ZpZGVkIHRvXG4gICAgICogIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQHBhcmFtIHtBcnJheX0gW2hvbGRlcnNdIFRoZSBgcGFydGlhbHNgIHBsYWNlaG9sZGVyIGluZGV4ZXMuXG4gICAgICogQHBhcmFtIHtBcnJheX0gW3BhcnRpYWxzUmlnaHRdIFRoZSBhcmd1bWVudHMgdG8gYXBwZW5kIHRvIHRob3NlIHByb3ZpZGVkXG4gICAgICogIHRvIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQHBhcmFtIHtBcnJheX0gW2hvbGRlcnNSaWdodF0gVGhlIGBwYXJ0aWFsc1JpZ2h0YCBwbGFjZWhvbGRlciBpbmRleGVzLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFthcmdQb3NdIFRoZSBhcmd1bWVudCBwb3NpdGlvbnMgb2YgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyeV0gVGhlIGFyaXR5IGNhcCBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eV0gVGhlIGFyaXR5IG9mIGBmdW5jYC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZUh5YnJpZChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnLCBwYXJ0aWFscywgaG9sZGVycywgcGFydGlhbHNSaWdodCwgaG9sZGVyc1JpZ2h0LCBhcmdQb3MsIGFyeSwgYXJpdHkpIHtcbiAgICAgIHZhciBpc0FyeSA9IGJpdG1hc2sgJiBXUkFQX0FSWV9GTEFHLFxuICAgICAgICAgIGlzQmluZCA9IGJpdG1hc2sgJiBXUkFQX0JJTkRfRkxBRyxcbiAgICAgICAgICBpc0JpbmRLZXkgPSBiaXRtYXNrICYgV1JBUF9CSU5EX0tFWV9GTEFHLFxuICAgICAgICAgIGlzQ3VycmllZCA9IGJpdG1hc2sgJiAoV1JBUF9DVVJSWV9GTEFHIHwgV1JBUF9DVVJSWV9SSUdIVF9GTEFHKSxcbiAgICAgICAgICBpc0ZsaXAgPSBiaXRtYXNrICYgV1JBUF9GTElQX0ZMQUcsXG4gICAgICAgICAgQ3RvciA9IGlzQmluZEtleSA/IHVuZGVmaW5lZCA6IGNyZWF0ZUN0b3IoZnVuYyk7XG5cbiAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7XG4gICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgYXJncyA9IEFycmF5KGxlbmd0aCksXG4gICAgICAgICAgICBpbmRleCA9IGxlbmd0aDtcblxuICAgICAgICB3aGlsZSAoaW5kZXgtLSkge1xuICAgICAgICAgIGFyZ3NbaW5kZXhdID0gYXJndW1lbnRzW2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDdXJyaWVkKSB7XG4gICAgICAgICAgdmFyIHBsYWNlaG9sZGVyID0gZ2V0SG9sZGVyKHdyYXBwZXIpLFxuICAgICAgICAgICAgICBob2xkZXJzQ291bnQgPSBjb3VudEhvbGRlcnMoYXJncywgcGxhY2Vob2xkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJ0aWFscykge1xuICAgICAgICAgIGFyZ3MgPSBjb21wb3NlQXJncyhhcmdzLCBwYXJ0aWFscywgaG9sZGVycywgaXNDdXJyaWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFydGlhbHNSaWdodCkge1xuICAgICAgICAgIGFyZ3MgPSBjb21wb3NlQXJnc1JpZ2h0KGFyZ3MsIHBhcnRpYWxzUmlnaHQsIGhvbGRlcnNSaWdodCwgaXNDdXJyaWVkKTtcbiAgICAgICAgfVxuICAgICAgICBsZW5ndGggLT0gaG9sZGVyc0NvdW50O1xuICAgICAgICBpZiAoaXNDdXJyaWVkICYmIGxlbmd0aCA8IGFyaXR5KSB7XG4gICAgICAgICAgdmFyIG5ld0hvbGRlcnMgPSByZXBsYWNlSG9sZGVycyhhcmdzLCBwbGFjZWhvbGRlcik7XG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZVJlY3VycnkoXG4gICAgICAgICAgICBmdW5jLCBiaXRtYXNrLCBjcmVhdGVIeWJyaWQsIHdyYXBwZXIucGxhY2Vob2xkZXIsIHRoaXNBcmcsXG4gICAgICAgICAgICBhcmdzLCBuZXdIb2xkZXJzLCBhcmdQb3MsIGFyeSwgYXJpdHkgLSBsZW5ndGhcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0aGlzQmluZGluZyA9IGlzQmluZCA/IHRoaXNBcmcgOiB0aGlzLFxuICAgICAgICAgICAgZm4gPSBpc0JpbmRLZXkgPyB0aGlzQmluZGluZ1tmdW5jXSA6IGZ1bmM7XG5cbiAgICAgICAgbGVuZ3RoID0gYXJncy5sZW5ndGg7XG4gICAgICAgIGlmIChhcmdQb3MpIHtcbiAgICAgICAgICBhcmdzID0gcmVvcmRlcihhcmdzLCBhcmdQb3MpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzRmxpcCAmJiBsZW5ndGggPiAxKSB7XG4gICAgICAgICAgYXJncy5yZXZlcnNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXJ5ICYmIGFyeSA8IGxlbmd0aCkge1xuICAgICAgICAgIGFyZ3MubGVuZ3RoID0gYXJ5O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzICYmIHRoaXMgIT09IHJvb3QgJiYgdGhpcyBpbnN0YW5jZW9mIHdyYXBwZXIpIHtcbiAgICAgICAgICBmbiA9IEN0b3IgfHwgY3JlYXRlQ3Rvcihmbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXNCaW5kaW5nLCBhcmdzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiBsaWtlIGBfLmludmVydEJ5YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc2V0dGVyIFRoZSBmdW5jdGlvbiB0byBzZXQgYWNjdW11bGF0b3IgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHRvSXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIHRvIHJlc29sdmUgaXRlcmF0ZWVzLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGludmVydGVyIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZUludmVydGVyKHNldHRlciwgdG9JdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VJbnZlcnRlcihvYmplY3QsIHNldHRlciwgdG9JdGVyYXRlZShpdGVyYXRlZSksIHt9KTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgYSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uIG9uIHR3byB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wZXJhdG9yIFRoZSBmdW5jdGlvbiB0byBwZXJmb3JtIHRoZSBvcGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtkZWZhdWx0VmFsdWVdIFRoZSB2YWx1ZSB1c2VkIGZvciBgdW5kZWZpbmVkYCBhcmd1bWVudHMuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgbWF0aGVtYXRpY2FsIG9wZXJhdGlvbiBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVNYXRoT3BlcmF0aW9uKG9wZXJhdG9yLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHtcbiAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgb3RoZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3RoZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIG90aGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IHR5cGVvZiBvdGhlciA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdmFsdWUgPSBiYXNlVG9TdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgb3RoZXIgPSBiYXNlVG9TdHJpbmcob3RoZXIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGJhc2VUb051bWJlcih2YWx1ZSk7XG4gICAgICAgICAgICBvdGhlciA9IGJhc2VUb051bWJlcihvdGhlcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdCA9IG9wZXJhdG9yKHZhbHVlLCBvdGhlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGxpa2UgYF8ub3ZlcmAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFycmF5RnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGl0ZXJhdGVlcy5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBvdmVyIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZU92ZXIoYXJyYXlGdW5jKSB7XG4gICAgICByZXR1cm4gZmxhdFJlc3QoZnVuY3Rpb24oaXRlcmF0ZWVzKSB7XG4gICAgICAgIGl0ZXJhdGVlcyA9IGFycmF5TWFwKGl0ZXJhdGVlcywgYmFzZVVuYXJ5KGdldEl0ZXJhdGVlKCkpKTtcbiAgICAgICAgcmV0dXJuIGJhc2VSZXN0KGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgICAgICB2YXIgdGhpc0FyZyA9IHRoaXM7XG4gICAgICAgICAgcmV0dXJuIGFycmF5RnVuYyhpdGVyYXRlZXMsIGZ1bmN0aW9uKGl0ZXJhdGVlKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwbHkoaXRlcmF0ZWUsIHRoaXNBcmcsIGFyZ3MpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgdGhlIHBhZGRpbmcgZm9yIGBzdHJpbmdgIGJhc2VkIG9uIGBsZW5ndGhgLiBUaGUgYGNoYXJzYCBzdHJpbmdcbiAgICAgKiBpcyB0cnVuY2F0ZWQgaWYgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIGV4Y2VlZHMgYGxlbmd0aGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIHBhZGRpbmcgbGVuZ3RoLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbY2hhcnM9JyAnXSBUaGUgc3RyaW5nIHVzZWQgYXMgcGFkZGluZy5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBwYWRkaW5nIGZvciBgc3RyaW5nYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVQYWRkaW5nKGxlbmd0aCwgY2hhcnMpIHtcbiAgICAgIGNoYXJzID0gY2hhcnMgPT09IHVuZGVmaW5lZCA/ICcgJyA6IGJhc2VUb1N0cmluZyhjaGFycyk7XG5cbiAgICAgIHZhciBjaGFyc0xlbmd0aCA9IGNoYXJzLmxlbmd0aDtcbiAgICAgIGlmIChjaGFyc0xlbmd0aCA8IDIpIHtcbiAgICAgICAgcmV0dXJuIGNoYXJzTGVuZ3RoID8gYmFzZVJlcGVhdChjaGFycywgbGVuZ3RoKSA6IGNoYXJzO1xuICAgICAgfVxuICAgICAgdmFyIHJlc3VsdCA9IGJhc2VSZXBlYXQoY2hhcnMsIG5hdGl2ZUNlaWwobGVuZ3RoIC8gc3RyaW5nU2l6ZShjaGFycykpKTtcbiAgICAgIHJldHVybiBoYXNVbmljb2RlKGNoYXJzKVxuICAgICAgICA/IGNhc3RTbGljZShzdHJpbmdUb0FycmF5KHJlc3VsdCksIDAsIGxlbmd0aCkuam9pbignJylcbiAgICAgICAgOiByZXN1bHQuc2xpY2UoMCwgbGVuZ3RoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCB3cmFwcyBgZnVuY2AgdG8gaW52b2tlIGl0IHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nXG4gICAgICogb2YgYHRoaXNBcmdgIGFuZCBgcGFydGlhbHNgIHByZXBlbmRlZCB0byB0aGUgYXJndW1lbnRzIGl0IHJlY2VpdmVzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLiBTZWUgYGNyZWF0ZVdyYXBgIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICogQHBhcmFtIHsqfSB0aGlzQXJnIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFydGlhbHMgVGhlIGFyZ3VtZW50cyB0byBwcmVwZW5kIHRvIHRob3NlIHByb3ZpZGVkIHRvXG4gICAgICogIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgd3JhcHBlZCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWFsKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzKSB7XG4gICAgICB2YXIgaXNCaW5kID0gYml0bWFzayAmIFdSQVBfQklORF9GTEFHLFxuICAgICAgICAgIEN0b3IgPSBjcmVhdGVDdG9yKGZ1bmMpO1xuXG4gICAgICBmdW5jdGlvbiB3cmFwcGVyKCkge1xuICAgICAgICB2YXIgYXJnc0luZGV4ID0gLTEsXG4gICAgICAgICAgICBhcmdzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgIGxlZnRJbmRleCA9IC0xLFxuICAgICAgICAgICAgbGVmdExlbmd0aCA9IHBhcnRpYWxzLmxlbmd0aCxcbiAgICAgICAgICAgIGFyZ3MgPSBBcnJheShsZWZ0TGVuZ3RoICsgYXJnc0xlbmd0aCksXG4gICAgICAgICAgICBmbiA9ICh0aGlzICYmIHRoaXMgIT09IHJvb3QgJiYgdGhpcyBpbnN0YW5jZW9mIHdyYXBwZXIpID8gQ3RvciA6IGZ1bmM7XG5cbiAgICAgICAgd2hpbGUgKCsrbGVmdEluZGV4IDwgbGVmdExlbmd0aCkge1xuICAgICAgICAgIGFyZ3NbbGVmdEluZGV4XSA9IHBhcnRpYWxzW2xlZnRJbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKGFyZ3NMZW5ndGgtLSkge1xuICAgICAgICAgIGFyZ3NbbGVmdEluZGV4KytdID0gYXJndW1lbnRzWysrYXJnc0luZGV4XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXBwbHkoZm4sIGlzQmluZCA/IHRoaXNBcmcgOiB0aGlzLCBhcmdzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBgXy5yYW5nZWAgb3IgYF8ucmFuZ2VSaWdodGAgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJhbmdlIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVJhbmdlKGZyb21SaWdodCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIHN0ZXApIHtcbiAgICAgICAgaWYgKHN0ZXAgJiYgdHlwZW9mIHN0ZXAgIT0gJ251bWJlcicgJiYgaXNJdGVyYXRlZUNhbGwoc3RhcnQsIGVuZCwgc3RlcCkpIHtcbiAgICAgICAgICBlbmQgPSBzdGVwID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIC8vIEVuc3VyZSB0aGUgc2lnbiBvZiBgLTBgIGlzIHByZXNlcnZlZC5cbiAgICAgICAgc3RhcnQgPSB0b0Zpbml0ZShzdGFydCk7XG4gICAgICAgIGlmIChlbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVuZCA9IHN0YXJ0O1xuICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbmQgPSB0b0Zpbml0ZShlbmQpO1xuICAgICAgICB9XG4gICAgICAgIHN0ZXAgPSBzdGVwID09PSB1bmRlZmluZWQgPyAoc3RhcnQgPCBlbmQgPyAxIDogLTEpIDogdG9GaW5pdGUoc3RlcCk7XG4gICAgICAgIHJldHVybiBiYXNlUmFuZ2Uoc3RhcnQsIGVuZCwgc3RlcCwgZnJvbVJpZ2h0KTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgYSByZWxhdGlvbmFsIG9wZXJhdGlvbiBvbiB0d28gdmFsdWVzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcGVyYXRvciBUaGUgZnVuY3Rpb24gdG8gcGVyZm9ybSB0aGUgb3BlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlbGF0aW9uYWwgb3BlcmF0aW9uIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVJlbGF0aW9uYWxPcGVyYXRpb24ob3BlcmF0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHtcbiAgICAgICAgaWYgKCEodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnICYmIHR5cGVvZiBvdGhlciA9PSAnc3RyaW5nJykpIHtcbiAgICAgICAgICB2YWx1ZSA9IHRvTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICBvdGhlciA9IHRvTnVtYmVyKG90aGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3BlcmF0b3IodmFsdWUsIG90aGVyKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgd3JhcHMgYGZ1bmNgIHRvIGNvbnRpbnVlIGN1cnJ5aW5nLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLiBTZWUgYGNyZWF0ZVdyYXBgIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gd3JhcEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgYGZ1bmNgIHdyYXBwZXIuXG4gICAgICogQHBhcmFtIHsqfSBwbGFjZWhvbGRlciBUaGUgcGxhY2Vob2xkZXIgdmFsdWUuXG4gICAgICogQHBhcmFtIHsqfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gcHJlcGVuZCB0byB0aG9zZSBwcm92aWRlZCB0b1xuICAgICAqICB0aGUgbmV3IGZ1bmN0aW9uLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtob2xkZXJzXSBUaGUgYHBhcnRpYWxzYCBwbGFjZWhvbGRlciBpbmRleGVzLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFthcmdQb3NdIFRoZSBhcmd1bWVudCBwb3NpdGlvbnMgb2YgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyeV0gVGhlIGFyaXR5IGNhcCBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eV0gVGhlIGFyaXR5IG9mIGBmdW5jYC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycnkoZnVuYywgYml0bWFzaywgd3JhcEZ1bmMsIHBsYWNlaG9sZGVyLCB0aGlzQXJnLCBwYXJ0aWFscywgaG9sZGVycywgYXJnUG9zLCBhcnksIGFyaXR5KSB7XG4gICAgICB2YXIgaXNDdXJyeSA9IGJpdG1hc2sgJiBXUkFQX0NVUlJZX0ZMQUcsXG4gICAgICAgICAgbmV3SG9sZGVycyA9IGlzQ3VycnkgPyBob2xkZXJzIDogdW5kZWZpbmVkLFxuICAgICAgICAgIG5ld0hvbGRlcnNSaWdodCA9IGlzQ3VycnkgPyB1bmRlZmluZWQgOiBob2xkZXJzLFxuICAgICAgICAgIG5ld1BhcnRpYWxzID0gaXNDdXJyeSA/IHBhcnRpYWxzIDogdW5kZWZpbmVkLFxuICAgICAgICAgIG5ld1BhcnRpYWxzUmlnaHQgPSBpc0N1cnJ5ID8gdW5kZWZpbmVkIDogcGFydGlhbHM7XG5cbiAgICAgIGJpdG1hc2sgfD0gKGlzQ3VycnkgPyBXUkFQX1BBUlRJQUxfRkxBRyA6IFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHKTtcbiAgICAgIGJpdG1hc2sgJj0gfihpc0N1cnJ5ID8gV1JBUF9QQVJUSUFMX1JJR0hUX0ZMQUcgOiBXUkFQX1BBUlRJQUxfRkxBRyk7XG5cbiAgICAgIGlmICghKGJpdG1hc2sgJiBXUkFQX0NVUlJZX0JPVU5EX0ZMQUcpKSB7XG4gICAgICAgIGJpdG1hc2sgJj0gfihXUkFQX0JJTkRfRkxBRyB8IFdSQVBfQklORF9LRVlfRkxBRyk7XG4gICAgICB9XG4gICAgICB2YXIgbmV3RGF0YSA9IFtcbiAgICAgICAgZnVuYywgYml0bWFzaywgdGhpc0FyZywgbmV3UGFydGlhbHMsIG5ld0hvbGRlcnMsIG5ld1BhcnRpYWxzUmlnaHQsXG4gICAgICAgIG5ld0hvbGRlcnNSaWdodCwgYXJnUG9zLCBhcnksIGFyaXR5XG4gICAgICBdO1xuXG4gICAgICB2YXIgcmVzdWx0ID0gd3JhcEZ1bmMuYXBwbHkodW5kZWZpbmVkLCBuZXdEYXRhKTtcbiAgICAgIGlmIChpc0xhemlhYmxlKGZ1bmMpKSB7XG4gICAgICAgIHNldERhdGEocmVzdWx0LCBuZXdEYXRhKTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xuICAgICAgcmV0dXJuIHNldFdyYXBUb1N0cmluZyhyZXN1bHQsIGZ1bmMsIGJpdG1hc2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiBsaWtlIGBfLnJvdW5kYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZE5hbWUgVGhlIG5hbWUgb2YgdGhlIGBNYXRoYCBtZXRob2QgdG8gdXNlIHdoZW4gcm91bmRpbmcuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcm91bmQgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlUm91bmQobWV0aG9kTmFtZSkge1xuICAgICAgdmFyIGZ1bmMgPSBNYXRoW21ldGhvZE5hbWVdO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG51bWJlciwgcHJlY2lzaW9uKSB7XG4gICAgICAgIG51bWJlciA9IHRvTnVtYmVyKG51bWJlcik7XG4gICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA9PSBudWxsID8gMCA6IG5hdGl2ZU1pbih0b0ludGVnZXIocHJlY2lzaW9uKSwgMjkyKTtcbiAgICAgICAgaWYgKHByZWNpc2lvbikge1xuICAgICAgICAgIC8vIFNoaWZ0IHdpdGggZXhwb25lbnRpYWwgbm90YXRpb24gdG8gYXZvaWQgZmxvYXRpbmctcG9pbnQgaXNzdWVzLlxuICAgICAgICAgIC8vIFNlZSBbTUROXShodHRwczovL21kbi5pby9yb3VuZCNFeGFtcGxlcykgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgICAgICB2YXIgcGFpciA9ICh0b1N0cmluZyhudW1iZXIpICsgJ2UnKS5zcGxpdCgnZScpLFxuICAgICAgICAgICAgICB2YWx1ZSA9IGZ1bmMocGFpclswXSArICdlJyArICgrcGFpclsxXSArIHByZWNpc2lvbikpO1xuXG4gICAgICAgICAgcGFpciA9ICh0b1N0cmluZyh2YWx1ZSkgKyAnZScpLnNwbGl0KCdlJyk7XG4gICAgICAgICAgcmV0dXJuICsocGFpclswXSArICdlJyArICgrcGFpclsxXSAtIHByZWNpc2lvbikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jKG51bWJlcik7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzZXQgb2JqZWN0IG9mIGB2YWx1ZXNgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byBhZGQgdG8gdGhlIHNldC5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgc2V0LlxuICAgICAqL1xuICAgIHZhciBjcmVhdGVTZXQgPSAhKFNldCAmJiAoMSAvIHNldFRvQXJyYXkobmV3IFNldChbLC0wXSkpWzFdKSA9PSBJTkZJTklUWSkgPyBub29wIDogZnVuY3Rpb24odmFsdWVzKSB7XG4gICAgICByZXR1cm4gbmV3IFNldCh2YWx1ZXMpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYF8udG9QYWlyc2Agb3IgYF8udG9QYWlyc0luYCBmdW5jdGlvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBhIGdpdmVuIG9iamVjdC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBwYWlycyBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjcmVhdGVUb1BhaXJzKGtleXNGdW5jKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICAgIHZhciB0YWcgPSBnZXRUYWcob2JqZWN0KTtcbiAgICAgICAgaWYgKHRhZyA9PSBtYXBUYWcpIHtcbiAgICAgICAgICByZXR1cm4gbWFwVG9BcnJheShvYmplY3QpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0YWcgPT0gc2V0VGFnKSB7XG4gICAgICAgICAgcmV0dXJuIHNldFRvUGFpcnMob2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZVRvUGFpcnMob2JqZWN0LCBrZXlzRnVuYyhvYmplY3QpKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgZWl0aGVyIGN1cnJpZXMgb3IgaW52b2tlcyBgZnVuY2Agd2l0aCBvcHRpb25hbFxuICAgICAqIGB0aGlzYCBiaW5kaW5nIGFuZCBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb258c3RyaW5nfSBmdW5jIFRoZSBmdW5jdGlvbiBvciBtZXRob2QgbmFtZSB0byB3cmFwLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLlxuICAgICAqICAgIDEgLSBgXy5iaW5kYFxuICAgICAqICAgIDIgLSBgXy5iaW5kS2V5YFxuICAgICAqICAgIDQgLSBgXy5jdXJyeWAgb3IgYF8uY3VycnlSaWdodGAgb2YgYSBib3VuZCBmdW5jdGlvblxuICAgICAqICAgIDggLSBgXy5jdXJyeWBcbiAgICAgKiAgIDE2IC0gYF8uY3VycnlSaWdodGBcbiAgICAgKiAgIDMyIC0gYF8ucGFydGlhbGBcbiAgICAgKiAgIDY0IC0gYF8ucGFydGlhbFJpZ2h0YFxuICAgICAqICAxMjggLSBgXy5yZWFyZ2BcbiAgICAgKiAgMjU2IC0gYF8uYXJ5YFxuICAgICAqICA1MTIgLSBgXy5mbGlwYFxuICAgICAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHtBcnJheX0gW3BhcnRpYWxzXSBUaGUgYXJndW1lbnRzIHRvIGJlIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtob2xkZXJzXSBUaGUgYHBhcnRpYWxzYCBwbGFjZWhvbGRlciBpbmRleGVzLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFthcmdQb3NdIFRoZSBhcmd1bWVudCBwb3NpdGlvbnMgb2YgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyeV0gVGhlIGFyaXR5IGNhcCBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eV0gVGhlIGFyaXR5IG9mIGBmdW5jYC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVdyYXAoZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMsIGhvbGRlcnMsIGFyZ1BvcywgYXJ5LCBhcml0eSkge1xuICAgICAgdmFyIGlzQmluZEtleSA9IGJpdG1hc2sgJiBXUkFQX0JJTkRfS0VZX0ZMQUc7XG4gICAgICBpZiAoIWlzQmluZEtleSAmJiB0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgICAgIH1cbiAgICAgIHZhciBsZW5ndGggPSBwYXJ0aWFscyA/IHBhcnRpYWxzLmxlbmd0aCA6IDA7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICBiaXRtYXNrICY9IH4oV1JBUF9QQVJUSUFMX0ZMQUcgfCBXUkFQX1BBUlRJQUxfUklHSFRfRkxBRyk7XG4gICAgICAgIHBhcnRpYWxzID0gaG9sZGVycyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGFyeSA9IGFyeSA9PT0gdW5kZWZpbmVkID8gYXJ5IDogbmF0aXZlTWF4KHRvSW50ZWdlcihhcnkpLCAwKTtcbiAgICAgIGFyaXR5ID0gYXJpdHkgPT09IHVuZGVmaW5lZCA/IGFyaXR5IDogdG9JbnRlZ2VyKGFyaXR5KTtcbiAgICAgIGxlbmd0aCAtPSBob2xkZXJzID8gaG9sZGVycy5sZW5ndGggOiAwO1xuXG4gICAgICBpZiAoYml0bWFzayAmIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHKSB7XG4gICAgICAgIHZhciBwYXJ0aWFsc1JpZ2h0ID0gcGFydGlhbHMsXG4gICAgICAgICAgICBob2xkZXJzUmlnaHQgPSBob2xkZXJzO1xuXG4gICAgICAgIHBhcnRpYWxzID0gaG9sZGVycyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHZhciBkYXRhID0gaXNCaW5kS2V5ID8gdW5kZWZpbmVkIDogZ2V0RGF0YShmdW5jKTtcblxuICAgICAgdmFyIG5ld0RhdGEgPSBbXG4gICAgICAgIGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBwYXJ0aWFsc1JpZ2h0LCBob2xkZXJzUmlnaHQsXG4gICAgICAgIGFyZ1BvcywgYXJ5LCBhcml0eVxuICAgICAgXTtcblxuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgbWVyZ2VEYXRhKG5ld0RhdGEsIGRhdGEpO1xuICAgICAgfVxuICAgICAgZnVuYyA9IG5ld0RhdGFbMF07XG4gICAgICBiaXRtYXNrID0gbmV3RGF0YVsxXTtcbiAgICAgIHRoaXNBcmcgPSBuZXdEYXRhWzJdO1xuICAgICAgcGFydGlhbHMgPSBuZXdEYXRhWzNdO1xuICAgICAgaG9sZGVycyA9IG5ld0RhdGFbNF07XG4gICAgICBhcml0eSA9IG5ld0RhdGFbOV0gPSBuZXdEYXRhWzldID09PSB1bmRlZmluZWRcbiAgICAgICAgPyAoaXNCaW5kS2V5ID8gMCA6IGZ1bmMubGVuZ3RoKVxuICAgICAgICA6IG5hdGl2ZU1heChuZXdEYXRhWzldIC0gbGVuZ3RoLCAwKTtcblxuICAgICAgaWYgKCFhcml0eSAmJiBiaXRtYXNrICYgKFdSQVBfQ1VSUllfRkxBRyB8IFdSQVBfQ1VSUllfUklHSFRfRkxBRykpIHtcbiAgICAgICAgYml0bWFzayAmPSB+KFdSQVBfQ1VSUllfRkxBRyB8IFdSQVBfQ1VSUllfUklHSFRfRkxBRyk7XG4gICAgICB9XG4gICAgICBpZiAoIWJpdG1hc2sgfHwgYml0bWFzayA9PSBXUkFQX0JJTkRfRkxBRykge1xuICAgICAgICB2YXIgcmVzdWx0ID0gY3JlYXRlQmluZChmdW5jLCBiaXRtYXNrLCB0aGlzQXJnKTtcbiAgICAgIH0gZWxzZSBpZiAoYml0bWFzayA9PSBXUkFQX0NVUlJZX0ZMQUcgfHwgYml0bWFzayA9PSBXUkFQX0NVUlJZX1JJR0hUX0ZMQUcpIHtcbiAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ3VycnkoZnVuYywgYml0bWFzaywgYXJpdHkpO1xuICAgICAgfSBlbHNlIGlmICgoYml0bWFzayA9PSBXUkFQX1BBUlRJQUxfRkxBRyB8fCBiaXRtYXNrID09IChXUkFQX0JJTkRfRkxBRyB8IFdSQVBfUEFSVElBTF9GTEFHKSkgJiYgIWhvbGRlcnMubGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdCA9IGNyZWF0ZVBhcnRpYWwoZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0ID0gY3JlYXRlSHlicmlkLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7XG4gICAgICB9XG4gICAgICB2YXIgc2V0dGVyID0gZGF0YSA/IGJhc2VTZXREYXRhIDogc2V0RGF0YTtcbiAgICAgIHJldHVybiBzZXRXcmFwVG9TdHJpbmcoc2V0dGVyKHJlc3VsdCwgbmV3RGF0YSksIGZ1bmMsIGJpdG1hc2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZWQgYnkgYF8uZGVmYXVsdHNgIHRvIGN1c3RvbWl6ZSBpdHMgYF8uYXNzaWduSW5gIHVzZSB0byBhc3NpZ24gcHJvcGVydGllc1xuICAgICAqIG9mIHNvdXJjZSBvYmplY3RzIHRvIHRoZSBkZXN0aW5hdGlvbiBvYmplY3QgZm9yIGFsbCBkZXN0aW5hdGlvbiBwcm9wZXJ0aWVzXG4gICAgICogdGhhdCByZXNvbHZlIHRvIGB1bmRlZmluZWRgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IG9ialZhbHVlIFRoZSBkZXN0aW5hdGlvbiB2YWx1ZS5cbiAgICAgKiBAcGFyYW0geyp9IHNyY1ZhbHVlIFRoZSBzb3VyY2UgdmFsdWUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBhc3NpZ24uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgcGFyZW50IG9iamVjdCBvZiBgb2JqVmFsdWVgLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSB2YWx1ZSB0byBhc3NpZ24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3VzdG9tRGVmYXVsdHNBc3NpZ25JbihvYmpWYWx1ZSwgc3JjVmFsdWUsIGtleSwgb2JqZWN0KSB7XG4gICAgICBpZiAob2JqVmFsdWUgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgIChlcShvYmpWYWx1ZSwgb2JqZWN0UHJvdG9ba2V5XSkgJiYgIWhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKSkge1xuICAgICAgICByZXR1cm4gc3JjVmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gb2JqVmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlZCBieSBgXy5kZWZhdWx0c0RlZXBgIHRvIGN1c3RvbWl6ZSBpdHMgYF8ubWVyZ2VgIHVzZSB0byBtZXJnZSBzb3VyY2VcbiAgICAgKiBvYmplY3RzIGludG8gZGVzdGluYXRpb24gb2JqZWN0cyB0aGF0IGFyZSBwYXNzZWQgdGhydS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSBvYmpWYWx1ZSBUaGUgZGVzdGluYXRpb24gdmFsdWUuXG4gICAgICogQHBhcmFtIHsqfSBzcmNWYWx1ZSBUaGUgc291cmNlIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gbWVyZ2UuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgcGFyZW50IG9iamVjdCBvZiBgb2JqVmFsdWVgLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIHBhcmVudCBvYmplY3Qgb2YgYHNyY1ZhbHVlYC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIHNvdXJjZSB2YWx1ZXMgYW5kIHRoZWlyIG1lcmdlZFxuICAgICAqICBjb3VudGVycGFydHMuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHZhbHVlIHRvIGFzc2lnbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjdXN0b21EZWZhdWx0c01lcmdlKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSwgc3RhY2spIHtcbiAgICAgIGlmIChpc09iamVjdChvYmpWYWx1ZSkgJiYgaXNPYmplY3Qoc3JjVmFsdWUpKSB7XG4gICAgICAgIC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIG9iamVjdHMgYW5kIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgICAgICBzdGFjay5zZXQoc3JjVmFsdWUsIG9ialZhbHVlKTtcbiAgICAgICAgYmFzZU1lcmdlKG9ialZhbHVlLCBzcmNWYWx1ZSwgdW5kZWZpbmVkLCBjdXN0b21EZWZhdWx0c01lcmdlLCBzdGFjayk7XG4gICAgICAgIHN0YWNrWydkZWxldGUnXShzcmNWYWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb2JqVmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlZCBieSBgXy5vbWl0YCB0byBjdXN0b21pemUgaXRzIGBfLmNsb25lRGVlcGAgdXNlIHRvIG9ubHkgY2xvbmUgcGxhaW5cbiAgICAgKiBvYmplY3RzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgdW5jbG9uZWQgdmFsdWUgb3IgYHVuZGVmaW5lZGAgdG8gZGVmZXIgY2xvbmluZyB0byBgXy5jbG9uZURlZXBgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGN1c3RvbU9taXRDbG9uZSh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGlzUGxhaW5PYmplY3QodmFsdWUpID8gdW5kZWZpbmVkIDogdmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlSXNFcXVhbERlZXBgIGZvciBhcnJheXMgd2l0aCBzdXBwb3J0IGZvclxuICAgICAqIHBhcnRpYWwgZGVlcCBjb21wYXJpc29ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtBcnJheX0gb3RoZXIgVGhlIG90aGVyIGFycmF5IHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RhY2sgVHJhY2tzIHRyYXZlcnNlZCBgYXJyYXlgIGFuZCBgb3RoZXJgIG9iamVjdHMuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBhcnJheXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlcXVhbEFycmF5cyhhcnJheSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHtcbiAgICAgIHZhciBpc1BhcnRpYWwgPSBiaXRtYXNrICYgQ09NUEFSRV9QQVJUSUFMX0ZMQUcsXG4gICAgICAgICAgYXJyTGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICAgIG90aExlbmd0aCA9IG90aGVyLmxlbmd0aDtcblxuICAgICAgaWYgKGFyckxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIShpc1BhcnRpYWwgJiYgb3RoTGVuZ3RoID4gYXJyTGVuZ3RoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBBc3N1bWUgY3ljbGljIHZhbHVlcyBhcmUgZXF1YWwuXG4gICAgICB2YXIgc3RhY2tlZCA9IHN0YWNrLmdldChhcnJheSk7XG4gICAgICBpZiAoc3RhY2tlZCAmJiBzdGFjay5nZXQob3RoZXIpKSB7XG4gICAgICAgIHJldHVybiBzdGFja2VkID09IG90aGVyO1xuICAgICAgfVxuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgcmVzdWx0ID0gdHJ1ZSxcbiAgICAgICAgICBzZWVuID0gKGJpdG1hc2sgJiBDT01QQVJFX1VOT1JERVJFRF9GTEFHKSA/IG5ldyBTZXRDYWNoZSA6IHVuZGVmaW5lZDtcblxuICAgICAgc3RhY2suc2V0KGFycmF5LCBvdGhlcik7XG4gICAgICBzdGFjay5zZXQob3RoZXIsIGFycmF5KTtcblxuICAgICAgLy8gSWdub3JlIG5vbi1pbmRleCBwcm9wZXJ0aWVzLlxuICAgICAgd2hpbGUgKCsraW5kZXggPCBhcnJMZW5ndGgpIHtcbiAgICAgICAgdmFyIGFyclZhbHVlID0gYXJyYXlbaW5kZXhdLFxuICAgICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltpbmRleF07XG5cbiAgICAgICAgaWYgKGN1c3RvbWl6ZXIpIHtcbiAgICAgICAgICB2YXIgY29tcGFyZWQgPSBpc1BhcnRpYWxcbiAgICAgICAgICAgID8gY3VzdG9taXplcihvdGhWYWx1ZSwgYXJyVmFsdWUsIGluZGV4LCBvdGhlciwgYXJyYXksIHN0YWNrKVxuICAgICAgICAgICAgOiBjdXN0b21pemVyKGFyclZhbHVlLCBvdGhWYWx1ZSwgaW5kZXgsIGFycmF5LCBvdGhlciwgc3RhY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wYXJlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKGNvbXBhcmVkKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBhcnJheXMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS5cbiAgICAgICAgaWYgKHNlZW4pIHtcbiAgICAgICAgICBpZiAoIWFycmF5U29tZShvdGhlciwgZnVuY3Rpb24ob3RoVmFsdWUsIG90aEluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjYWNoZUhhcyhzZWVuLCBvdGhJbmRleCkgJiZcbiAgICAgICAgICAgICAgICAgICAgKGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fCBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaykpKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gc2Vlbi5wdXNoKG90aEluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghKFxuICAgICAgICAgICAgICBhcnJWYWx1ZSA9PT0gb3RoVmFsdWUgfHxcbiAgICAgICAgICAgICAgICBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaylcbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc3RhY2tbJ2RlbGV0ZSddKGFycmF5KTtcbiAgICAgIHN0YWNrWydkZWxldGUnXShvdGhlcik7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3IgY29tcGFyaW5nIG9iamVjdHMgb2ZcbiAgICAgKiB0aGUgc2FtZSBgdG9TdHJpbmdUYWdgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjb21wYXJpbmcgdmFsdWVzIHdpdGggdGFncyBvZlxuICAgICAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0YWcgVGhlIGB0b1N0cmluZ1RhZ2Agb2YgdGhlIG9iamVjdHMgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCB0YWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHtcbiAgICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgIGNhc2UgZGF0YVZpZXdUYWc6XG4gICAgICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fFxuICAgICAgICAgICAgICAob2JqZWN0LmJ5dGVPZmZzZXQgIT0gb3RoZXIuYnl0ZU9mZnNldCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb2JqZWN0ID0gb2JqZWN0LmJ1ZmZlcjtcbiAgICAgICAgICBvdGhlciA9IG90aGVyLmJ1ZmZlcjtcblxuICAgICAgICBjYXNlIGFycmF5QnVmZmVyVGFnOlxuICAgICAgICAgIGlmICgob2JqZWN0LmJ5dGVMZW5ndGggIT0gb3RoZXIuYnl0ZUxlbmd0aCkgfHxcbiAgICAgICAgICAgICAgIWVxdWFsRnVuYyhuZXcgVWludDhBcnJheShvYmplY3QpLCBuZXcgVWludDhBcnJheShvdGhlcikpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGNhc2UgYm9vbFRhZzpcbiAgICAgICAgY2FzZSBkYXRlVGFnOlxuICAgICAgICBjYXNlIG51bWJlclRhZzpcbiAgICAgICAgICAvLyBDb2VyY2UgYm9vbGVhbnMgdG8gYDFgIG9yIGAwYCBhbmQgZGF0ZXMgdG8gbWlsbGlzZWNvbmRzLlxuICAgICAgICAgIC8vIEludmFsaWQgZGF0ZXMgYXJlIGNvZXJjZWQgdG8gYE5hTmAuXG4gICAgICAgICAgcmV0dXJuIGVxKCtvYmplY3QsICtvdGhlcik7XG5cbiAgICAgICAgY2FzZSBlcnJvclRhZzpcbiAgICAgICAgICByZXR1cm4gb2JqZWN0Lm5hbWUgPT0gb3RoZXIubmFtZSAmJiBvYmplY3QubWVzc2FnZSA9PSBvdGhlci5tZXNzYWdlO1xuXG4gICAgICAgIGNhc2UgcmVnZXhwVGFnOlxuICAgICAgICBjYXNlIHN0cmluZ1RhZzpcbiAgICAgICAgICAvLyBDb2VyY2UgcmVnZXhlcyB0byBzdHJpbmdzIGFuZCB0cmVhdCBzdHJpbmdzLCBwcmltaXRpdmVzIGFuZCBvYmplY3RzLFxuICAgICAgICAgIC8vIGFzIGVxdWFsLiBTZWUgaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXJlZ2V4cC5wcm90b3R5cGUudG9zdHJpbmdcbiAgICAgICAgICAvLyBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAgICAgIHJldHVybiBvYmplY3QgPT0gKG90aGVyICsgJycpO1xuXG4gICAgICAgIGNhc2UgbWFwVGFnOlxuICAgICAgICAgIHZhciBjb252ZXJ0ID0gbWFwVG9BcnJheTtcblxuICAgICAgICBjYXNlIHNldFRhZzpcbiAgICAgICAgICB2YXIgaXNQYXJ0aWFsID0gYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHO1xuICAgICAgICAgIGNvbnZlcnQgfHwgKGNvbnZlcnQgPSBzZXRUb0FycmF5KTtcblxuICAgICAgICAgIGlmIChvYmplY3Quc2l6ZSAhPSBvdGhlci5zaXplICYmICFpc1BhcnRpYWwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLlxuICAgICAgICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KG9iamVjdCk7XG4gICAgICAgICAgaWYgKHN0YWNrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGFja2VkID09IG90aGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBiaXRtYXNrIHw9IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUc7XG5cbiAgICAgICAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS5cbiAgICAgICAgICBzdGFjay5zZXQob2JqZWN0LCBvdGhlcik7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGVxdWFsQXJyYXlzKGNvbnZlcnQob2JqZWN0KSwgY29udmVydChvdGhlciksIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spO1xuICAgICAgICAgIHN0YWNrWydkZWxldGUnXShvYmplY3QpO1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICAgICAgY2FzZSBzeW1ib2xUYWc6XG4gICAgICAgICAgaWYgKHN5bWJvbFZhbHVlT2YpIHtcbiAgICAgICAgICAgIHJldHVybiBzeW1ib2xWYWx1ZU9mLmNhbGwob2JqZWN0KSA9PSBzeW1ib2xWYWx1ZU9mLmNhbGwob3RoZXIpO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIG9iamVjdHMgd2l0aCBzdXBwb3J0IGZvclxuICAgICAqIHBhcnRpYWwgZGVlcCBjb21wYXJpc29ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXF1YWxPYmplY3RzKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHtcbiAgICAgIHZhciBpc1BhcnRpYWwgPSBiaXRtYXNrICYgQ09NUEFSRV9QQVJUSUFMX0ZMQUcsXG4gICAgICAgICAgb2JqUHJvcHMgPSBnZXRBbGxLZXlzKG9iamVjdCksXG4gICAgICAgICAgb2JqTGVuZ3RoID0gb2JqUHJvcHMubGVuZ3RoLFxuICAgICAgICAgIG90aFByb3BzID0gZ2V0QWxsS2V5cyhvdGhlciksXG4gICAgICAgICAgb3RoTGVuZ3RoID0gb3RoUHJvcHMubGVuZ3RoO1xuXG4gICAgICBpZiAob2JqTGVuZ3RoICE9IG90aExlbmd0aCAmJiAhaXNQYXJ0aWFsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBpbmRleCA9IG9iakxlbmd0aDtcbiAgICAgIHdoaWxlIChpbmRleC0tKSB7XG4gICAgICAgIHZhciBrZXkgPSBvYmpQcm9wc1tpbmRleF07XG4gICAgICAgIGlmICghKGlzUGFydGlhbCA/IGtleSBpbiBvdGhlciA6IGhhc093blByb3BlcnR5LmNhbGwob3RoZXIsIGtleSkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBBc3N1bWUgY3ljbGljIHZhbHVlcyBhcmUgZXF1YWwuXG4gICAgICB2YXIgc3RhY2tlZCA9IHN0YWNrLmdldChvYmplY3QpO1xuICAgICAgaWYgKHN0YWNrZWQgJiYgc3RhY2suZ2V0KG90aGVyKSkge1xuICAgICAgICByZXR1cm4gc3RhY2tlZCA9PSBvdGhlcjtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSB0cnVlO1xuICAgICAgc3RhY2suc2V0KG9iamVjdCwgb3RoZXIpO1xuICAgICAgc3RhY2suc2V0KG90aGVyLCBvYmplY3QpO1xuXG4gICAgICB2YXIgc2tpcEN0b3IgPSBpc1BhcnRpYWw7XG4gICAgICB3aGlsZSAoKytpbmRleCA8IG9iakxlbmd0aCkge1xuICAgICAgICBrZXkgPSBvYmpQcm9wc1tpbmRleF07XG4gICAgICAgIHZhciBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLFxuICAgICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltrZXldO1xuXG4gICAgICAgIGlmIChjdXN0b21pemVyKSB7XG4gICAgICAgICAgdmFyIGNvbXBhcmVkID0gaXNQYXJ0aWFsXG4gICAgICAgICAgICA/IGN1c3RvbWl6ZXIob3RoVmFsdWUsIG9ialZhbHVlLCBrZXksIG90aGVyLCBvYmplY3QsIHN0YWNrKVxuICAgICAgICAgICAgOiBjdXN0b21pemVyKG9ialZhbHVlLCBvdGhWYWx1ZSwga2V5LCBvYmplY3QsIG90aGVyLCBzdGFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgICAgIGlmICghKGNvbXBhcmVkID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgPyAob2JqVmFsdWUgPT09IG90aFZhbHVlIHx8IGVxdWFsRnVuYyhvYmpWYWx1ZSwgb3RoVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSlcbiAgICAgICAgICAgICAgOiBjb21wYXJlZFxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHNraXBDdG9yIHx8IChza2lwQ3RvciA9IGtleSA9PSAnY29uc3RydWN0b3InKTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQgJiYgIXNraXBDdG9yKSB7XG4gICAgICAgIHZhciBvYmpDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLFxuICAgICAgICAgICAgb3RoQ3RvciA9IG90aGVyLmNvbnN0cnVjdG9yO1xuXG4gICAgICAgIC8vIE5vbiBgT2JqZWN0YCBvYmplY3QgaW5zdGFuY2VzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWFsLlxuICAgICAgICBpZiAob2JqQ3RvciAhPSBvdGhDdG9yICYmXG4gICAgICAgICAgICAoJ2NvbnN0cnVjdG9yJyBpbiBvYmplY3QgJiYgJ2NvbnN0cnVjdG9yJyBpbiBvdGhlcikgJiZcbiAgICAgICAgICAgICEodHlwZW9mIG9iakN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvYmpDdG9yIGluc3RhbmNlb2Ygb2JqQ3RvciAmJlxuICAgICAgICAgICAgICB0eXBlb2Ygb3RoQ3RvciA9PSAnZnVuY3Rpb24nICYmIG90aEN0b3IgaW5zdGFuY2VvZiBvdGhDdG9yKSkge1xuICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzdGFja1snZGVsZXRlJ10ob2JqZWN0KTtcbiAgICAgIHN0YWNrWydkZWxldGUnXShvdGhlcik7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVJlc3RgIHdoaWNoIGZsYXR0ZW5zIHRoZSByZXN0IGFycmF5LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBhcHBseSBhIHJlc3QgcGFyYW1ldGVyIHRvLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXRSZXN0KGZ1bmMpIHtcbiAgICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCB1bmRlZmluZWQsIGZsYXR0ZW4pLCBmdW5jICsgJycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2Ygb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEFsbEtleXMob2JqZWN0KSB7XG4gICAgICByZXR1cm4gYmFzZUdldEFsbEtleXMob2JqZWN0LCBrZXlzLCBnZXRTeW1ib2xzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIG93biBhbmQgaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgYW5kXG4gICAgICogc3ltYm9scyBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0QWxsS2V5c0luKG9iamVjdCkge1xuICAgICAgcmV0dXJuIGJhc2VHZXRBbGxLZXlzKG9iamVjdCwga2V5c0luLCBnZXRTeW1ib2xzSW4pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgbWV0YWRhdGEgZm9yIGBmdW5jYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1ldGFkYXRhIGZvciBgZnVuY2AuXG4gICAgICovXG4gICAgdmFyIGdldERhdGEgPSAhbWV0YU1hcCA/IG5vb3AgOiBmdW5jdGlvbihmdW5jKSB7XG4gICAgICByZXR1cm4gbWV0YU1hcC5nZXQoZnVuYyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG5hbWUgb2YgYGZ1bmNgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBmdW5jdGlvbiBuYW1lLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEZ1bmNOYW1lKGZ1bmMpIHtcbiAgICAgIHZhciByZXN1bHQgPSAoZnVuYy5uYW1lICsgJycpLFxuICAgICAgICAgIGFycmF5ID0gcmVhbE5hbWVzW3Jlc3VsdF0sXG4gICAgICAgICAgbGVuZ3RoID0gaGFzT3duUHJvcGVydHkuY2FsbChyZWFsTmFtZXMsIHJlc3VsdCkgPyBhcnJheS5sZW5ndGggOiAwO1xuXG4gICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgdmFyIGRhdGEgPSBhcnJheVtsZW5ndGhdLFxuICAgICAgICAgICAgb3RoZXJGdW5jID0gZGF0YS5mdW5jO1xuICAgICAgICBpZiAob3RoZXJGdW5jID09IG51bGwgfHwgb3RoZXJGdW5jID09IGZ1bmMpIHtcbiAgICAgICAgICByZXR1cm4gZGF0YS5uYW1lO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGFyZ3VtZW50IHBsYWNlaG9sZGVyIHZhbHVlIGZvciBgZnVuY2AuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGluc3BlY3QuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHBsYWNlaG9sZGVyIHZhbHVlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEhvbGRlcihmdW5jKSB7XG4gICAgICB2YXIgb2JqZWN0ID0gaGFzT3duUHJvcGVydHkuY2FsbChsb2Rhc2gsICdwbGFjZWhvbGRlcicpID8gbG9kYXNoIDogZnVuYztcbiAgICAgIHJldHVybiBvYmplY3QucGxhY2Vob2xkZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgYXBwcm9wcmlhdGUgXCJpdGVyYXRlZVwiIGZ1bmN0aW9uLiBJZiBgXy5pdGVyYXRlZWAgaXMgY3VzdG9taXplZCxcbiAgICAgKiB0aGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIGN1c3RvbSBtZXRob2QsIG90aGVyd2lzZSBpdCByZXR1cm5zIGBiYXNlSXRlcmF0ZWVgLlxuICAgICAqIElmIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQsIHRoZSBjaG9zZW4gZnVuY3Rpb24gaXMgaW52b2tlZCB3aXRoIHRoZW0gYW5kXG4gICAgICogaXRzIHJlc3VsdCBpcyByZXR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSBbdmFsdWVdIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGFuIGl0ZXJhdGVlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJpdHldIFRoZSBhcml0eSBvZiB0aGUgY3JlYXRlZCBpdGVyYXRlZS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIGNob3NlbiBmdW5jdGlvbiBvciBpdHMgcmVzdWx0LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEl0ZXJhdGVlKCkge1xuICAgICAgdmFyIHJlc3VsdCA9IGxvZGFzaC5pdGVyYXRlZSB8fCBpdGVyYXRlZTtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdCA9PT0gaXRlcmF0ZWUgPyBiYXNlSXRlcmF0ZWUgOiByZXN1bHQ7XG4gICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHJlc3VsdChhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSkgOiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgZGF0YSBmb3IgYG1hcGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSByZWZlcmVuY2Uga2V5LlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBtYXAgZGF0YS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRNYXBEYXRhKG1hcCwga2V5KSB7XG4gICAgICB2YXIgZGF0YSA9IG1hcC5fX2RhdGFfXztcbiAgICAgIHJldHVybiBpc0tleWFibGUoa2V5KVxuICAgICAgICA/IGRhdGFbdHlwZW9mIGtleSA9PSAnc3RyaW5nJyA/ICdzdHJpbmcnIDogJ2hhc2gnXVxuICAgICAgICA6IGRhdGEubWFwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIG9mIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBtYXRjaCBkYXRhIG9mIGBvYmplY3RgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldE1hdGNoRGF0YShvYmplY3QpIHtcbiAgICAgIHZhciByZXN1bHQgPSBrZXlzKG9iamVjdCksXG4gICAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDtcblxuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIHZhciBrZXkgPSByZXN1bHRbbGVuZ3RoXSxcbiAgICAgICAgICAgIHZhbHVlID0gb2JqZWN0W2tleV07XG5cbiAgICAgICAgcmVzdWx0W2xlbmd0aF0gPSBba2V5LCB2YWx1ZSwgaXNTdHJpY3RDb21wYXJhYmxlKHZhbHVlKV07XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG5hdGl2ZSBmdW5jdGlvbiBhdCBga2V5YCBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kIHRvIGdldC5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZnVuY3Rpb24gaWYgaXQncyBuYXRpdmUsIGVsc2UgYHVuZGVmaW5lZGAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7XG4gICAgICB2YXIgdmFsdWUgPSBnZXRWYWx1ZShvYmplY3QsIGtleSk7XG4gICAgICByZXR1cm4gYmFzZUlzTmF0aXZlKHZhbHVlKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUdldFRhZ2Agd2hpY2ggaWdub3JlcyBgU3ltYm9sLnRvU3RyaW5nVGFnYCB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHJhdyBgdG9TdHJpbmdUYWdgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldFJhd1RhZyh2YWx1ZSkge1xuICAgICAgdmFyIGlzT3duID0gaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgc3ltVG9TdHJpbmdUYWcpLFxuICAgICAgICAgIHRhZyA9IHZhbHVlW3N5bVRvU3RyaW5nVGFnXTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdW5kZWZpbmVkO1xuICAgICAgICB2YXIgdW5tYXNrZWQgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZSkge31cblxuICAgICAgdmFyIHJlc3VsdCA9IG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpO1xuICAgICAgaWYgKHVubWFza2VkKSB7XG4gICAgICAgIGlmIChpc093bikge1xuICAgICAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHRhZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWxldGUgdmFsdWVbc3ltVG9TdHJpbmdUYWddO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBlbnVtZXJhYmxlIHN5bWJvbHMgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHN5bWJvbHMuXG4gICAgICovXG4gICAgdmFyIGdldFN5bWJvbHMgPSAhbmF0aXZlR2V0U3ltYm9scyA/IHN0dWJBcnJheSA6IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIG9iamVjdCA9IE9iamVjdChvYmplY3QpO1xuICAgICAgcmV0dXJuIGFycmF5RmlsdGVyKG5hdGl2ZUdldFN5bWJvbHMob2JqZWN0KSwgZnVuY3Rpb24oc3ltYm9sKSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKG9iamVjdCwgc3ltYm9sKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN5bWJvbHMgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHN5bWJvbHMuXG4gICAgICovXG4gICAgdmFyIGdldFN5bWJvbHNJbiA9ICFuYXRpdmVHZXRTeW1ib2xzID8gc3R1YkFycmF5IDogZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICB3aGlsZSAob2JqZWN0KSB7XG4gICAgICAgIGFycmF5UHVzaChyZXN1bHQsIGdldFN5bWJvbHMob2JqZWN0KSk7XG4gICAgICAgIG9iamVjdCA9IGdldFByb3RvdHlwZShvYmplY3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgYHRvU3RyaW5nVGFnYCBvZiBgdmFsdWVgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLlxuICAgICAqL1xuICAgIHZhciBnZXRUYWcgPSBiYXNlR2V0VGFnO1xuXG4gICAgLy8gRmFsbGJhY2sgZm9yIGRhdGEgdmlld3MsIG1hcHMsIHNldHMsIGFuZCB3ZWFrIG1hcHMgaW4gSUUgMTEgYW5kIHByb21pc2VzIGluIE5vZGUuanMgPCA2LlxuICAgIGlmICgoRGF0YVZpZXcgJiYgZ2V0VGFnKG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMSkpKSAhPSBkYXRhVmlld1RhZykgfHxcbiAgICAgICAgKE1hcCAmJiBnZXRUYWcobmV3IE1hcCkgIT0gbWFwVGFnKSB8fFxuICAgICAgICAoUHJvbWlzZSAmJiBnZXRUYWcoUHJvbWlzZS5yZXNvbHZlKCkpICE9IHByb21pc2VUYWcpIHx8XG4gICAgICAgIChTZXQgJiYgZ2V0VGFnKG5ldyBTZXQpICE9IHNldFRhZykgfHxcbiAgICAgICAgKFdlYWtNYXAgJiYgZ2V0VGFnKG5ldyBXZWFrTWFwKSAhPSB3ZWFrTWFwVGFnKSkge1xuICAgICAgZ2V0VGFnID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGJhc2VHZXRUYWcodmFsdWUpLFxuICAgICAgICAgICAgQ3RvciA9IHJlc3VsdCA9PSBvYmplY3RUYWcgPyB2YWx1ZS5jb25zdHJ1Y3RvciA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGN0b3JTdHJpbmcgPSBDdG9yID8gdG9Tb3VyY2UoQ3RvcikgOiAnJztcblxuICAgICAgICBpZiAoY3RvclN0cmluZykge1xuICAgICAgICAgIHN3aXRjaCAoY3RvclN0cmluZykge1xuICAgICAgICAgICAgY2FzZSBkYXRhVmlld0N0b3JTdHJpbmc6IHJldHVybiBkYXRhVmlld1RhZztcbiAgICAgICAgICAgIGNhc2UgbWFwQ3RvclN0cmluZzogcmV0dXJuIG1hcFRhZztcbiAgICAgICAgICAgIGNhc2UgcHJvbWlzZUN0b3JTdHJpbmc6IHJldHVybiBwcm9taXNlVGFnO1xuICAgICAgICAgICAgY2FzZSBzZXRDdG9yU3RyaW5nOiByZXR1cm4gc2V0VGFnO1xuICAgICAgICAgICAgY2FzZSB3ZWFrTWFwQ3RvclN0cmluZzogcmV0dXJuIHdlYWtNYXBUYWc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHZpZXcsIGFwcGx5aW5nIGFueSBgdHJhbnNmb3Jtc2AgdG8gdGhlIGBzdGFydGAgYW5kIGBlbmRgIHBvc2l0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IFRoZSBzdGFydCBvZiB0aGUgdmlldy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlbmQgb2YgdGhlIHZpZXcuXG4gICAgICogQHBhcmFtIHtBcnJheX0gdHJhbnNmb3JtcyBUaGUgdHJhbnNmb3JtYXRpb25zIHRvIGFwcGx5IHRvIHRoZSB2aWV3LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGBzdGFydGAgYW5kIGBlbmRgXG4gICAgICogIHBvc2l0aW9ucyBvZiB0aGUgdmlldy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRWaWV3KHN0YXJ0LCBlbmQsIHRyYW5zZm9ybXMpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IHRyYW5zZm9ybXMubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRyYW5zZm9ybXNbaW5kZXhdLFxuICAgICAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTtcblxuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICAgIGNhc2UgJ2Ryb3AnOiAgICAgIHN0YXJ0ICs9IHNpemU7IGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2Ryb3BSaWdodCc6IGVuZCAtPSBzaXplOyBicmVhaztcbiAgICAgICAgICBjYXNlICd0YWtlJzogICAgICBlbmQgPSBuYXRpdmVNaW4oZW5kLCBzdGFydCArIHNpemUpOyBicmVhaztcbiAgICAgICAgICBjYXNlICd0YWtlUmlnaHQnOiBzdGFydCA9IG5hdGl2ZU1heChzdGFydCwgZW5kIC0gc2l6ZSk7IGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4geyAnc3RhcnQnOiBzdGFydCwgJ2VuZCc6IGVuZCB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIHdyYXBwZXIgZGV0YWlscyBmcm9tIHRoZSBgc291cmNlYCBib2R5IGNvbW1lbnQuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2UgVGhlIHNvdXJjZSB0byBpbnNwZWN0LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgd3JhcHBlciBkZXRhaWxzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldFdyYXBEZXRhaWxzKHNvdXJjZSkge1xuICAgICAgdmFyIG1hdGNoID0gc291cmNlLm1hdGNoKHJlV3JhcERldGFpbHMpO1xuICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0uc3BsaXQocmVTcGxpdERldGFpbHMpIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGBwYXRoYCBleGlzdHMgb24gYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCB0byBjaGVjay5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYXNGdW5jIFRoZSBmdW5jdGlvbiB0byBjaGVjayBwcm9wZXJ0aWVzLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgcGF0aGAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUGF0aChvYmplY3QsIHBhdGgsIGhhc0Z1bmMpIHtcbiAgICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpO1xuXG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aCxcbiAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIGtleSA9IHRvS2V5KHBhdGhbaW5kZXhdKTtcbiAgICAgICAgaWYgKCEocmVzdWx0ID0gb2JqZWN0ICE9IG51bGwgJiYgaGFzRnVuYyhvYmplY3QsIGtleSkpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2tleV07XG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0IHx8ICsraW5kZXggIT0gbGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBsZW5ndGggPSBvYmplY3QgPT0gbnVsbCA/IDAgOiBvYmplY3QubGVuZ3RoO1xuICAgICAgcmV0dXJuICEhbGVuZ3RoICYmIGlzTGVuZ3RoKGxlbmd0aCkgJiYgaXNJbmRleChrZXksIGxlbmd0aCkgJiZcbiAgICAgICAgKGlzQXJyYXkob2JqZWN0KSB8fCBpc0FyZ3VtZW50cyhvYmplY3QpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhbiBhcnJheSBjbG9uZS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNsb25lLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5pdENsb25lQXJyYXkoYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0ID0gYXJyYXkuY29uc3RydWN0b3IobGVuZ3RoKTtcblxuICAgICAgLy8gQWRkIHByb3BlcnRpZXMgYXNzaWduZWQgYnkgYFJlZ0V4cCNleGVjYC5cbiAgICAgIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7XG4gICAgICAgIHJlc3VsdC5pbmRleCA9IGFycmF5LmluZGV4O1xuICAgICAgICByZXN1bHQuaW5wdXQgPSBhcnJheS5pbnB1dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2xvbmUuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5pdENsb25lT2JqZWN0KG9iamVjdCkge1xuICAgICAgcmV0dXJuICh0eXBlb2Ygb2JqZWN0LmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgIWlzUHJvdG90eXBlKG9iamVjdCkpXG4gICAgICAgID8gYmFzZUNyZWF0ZShnZXRQcm90b3R5cGUob2JqZWN0KSlcbiAgICAgICAgOiB7fTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhbiBvYmplY3QgY2xvbmUgYmFzZWQgb24gaXRzIGB0b1N0cmluZ1RhZ2AuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBvbmx5IHN1cHBvcnRzIGNsb25pbmcgdmFsdWVzIHdpdGggdGFncyBvZlxuICAgICAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2xvbmUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRhZyBUaGUgYHRvU3RyaW5nVGFnYCBvZiB0aGUgb2JqZWN0IHRvIGNsb25lLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNsb25lRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2xvbmUgdmFsdWVzLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5pdENsb25lQnlUYWcob2JqZWN0LCB0YWcsIGNsb25lRnVuYywgaXNEZWVwKSB7XG4gICAgICB2YXIgQ3RvciA9IG9iamVjdC5jb25zdHJ1Y3RvcjtcbiAgICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgIGNhc2UgYXJyYXlCdWZmZXJUYWc6XG4gICAgICAgICAgcmV0dXJuIGNsb25lQXJyYXlCdWZmZXIob2JqZWN0KTtcblxuICAgICAgICBjYXNlIGJvb2xUYWc6XG4gICAgICAgIGNhc2UgZGF0ZVRhZzpcbiAgICAgICAgICByZXR1cm4gbmV3IEN0b3IoK29iamVjdCk7XG5cbiAgICAgICAgY2FzZSBkYXRhVmlld1RhZzpcbiAgICAgICAgICByZXR1cm4gY2xvbmVEYXRhVmlldyhvYmplY3QsIGlzRGVlcCk7XG5cbiAgICAgICAgY2FzZSBmbG9hdDMyVGFnOiBjYXNlIGZsb2F0NjRUYWc6XG4gICAgICAgIGNhc2UgaW50OFRhZzogY2FzZSBpbnQxNlRhZzogY2FzZSBpbnQzMlRhZzpcbiAgICAgICAgY2FzZSB1aW50OFRhZzogY2FzZSB1aW50OENsYW1wZWRUYWc6IGNhc2UgdWludDE2VGFnOiBjYXNlIHVpbnQzMlRhZzpcbiAgICAgICAgICByZXR1cm4gY2xvbmVUeXBlZEFycmF5KG9iamVjdCwgaXNEZWVwKTtcblxuICAgICAgICBjYXNlIG1hcFRhZzpcbiAgICAgICAgICByZXR1cm4gY2xvbmVNYXAob2JqZWN0LCBpc0RlZXAsIGNsb25lRnVuYyk7XG5cbiAgICAgICAgY2FzZSBudW1iZXJUYWc6XG4gICAgICAgIGNhc2Ugc3RyaW5nVGFnOlxuICAgICAgICAgIHJldHVybiBuZXcgQ3RvcihvYmplY3QpO1xuXG4gICAgICAgIGNhc2UgcmVnZXhwVGFnOlxuICAgICAgICAgIHJldHVybiBjbG9uZVJlZ0V4cChvYmplY3QpO1xuXG4gICAgICAgIGNhc2Ugc2V0VGFnOlxuICAgICAgICAgIHJldHVybiBjbG9uZVNldChvYmplY3QsIGlzRGVlcCwgY2xvbmVGdW5jKTtcblxuICAgICAgICBjYXNlIHN5bWJvbFRhZzpcbiAgICAgICAgICByZXR1cm4gY2xvbmVTeW1ib2wob2JqZWN0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnRzIHdyYXBwZXIgYGRldGFpbHNgIGluIGEgY29tbWVudCBhdCB0aGUgdG9wIG9mIHRoZSBgc291cmNlYCBib2R5LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIFRoZSBzb3VyY2UgdG8gbW9kaWZ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gZGV0YWlscyBUaGUgZGV0YWlscyB0byBpbnNlcnQuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgbW9kaWZpZWQgc291cmNlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGluc2VydFdyYXBEZXRhaWxzKHNvdXJjZSwgZGV0YWlscykge1xuICAgICAgdmFyIGxlbmd0aCA9IGRldGFpbHMubGVuZ3RoO1xuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgIH1cbiAgICAgIHZhciBsYXN0SW5kZXggPSBsZW5ndGggLSAxO1xuICAgICAgZGV0YWlsc1tsYXN0SW5kZXhdID0gKGxlbmd0aCA+IDEgPyAnJiAnIDogJycpICsgZGV0YWlsc1tsYXN0SW5kZXhdO1xuICAgICAgZGV0YWlscyA9IGRldGFpbHMuam9pbihsZW5ndGggPiAyID8gJywgJyA6ICcgJyk7XG4gICAgICByZXR1cm4gc291cmNlLnJlcGxhY2UocmVXcmFwQ29tbWVudCwgJ3tcXG4vKiBbd3JhcHBlZCB3aXRoICcgKyBkZXRhaWxzICsgJ10gKi9cXG4nKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGZsYXR0ZW5hYmxlIGBhcmd1bWVudHNgIG9iamVjdCBvciBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZmxhdHRlbmFibGUsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0ZsYXR0ZW5hYmxlKHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNBcnJheSh2YWx1ZSkgfHwgaXNBcmd1bWVudHModmFsdWUpIHx8XG4gICAgICAgICEhKHNwcmVhZGFibGVTeW1ib2wgJiYgdmFsdWUgJiYgdmFsdWVbc3ByZWFkYWJsZVN5bWJvbF0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHtcbiAgICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDtcbiAgICAgIHJldHVybiAhIWxlbmd0aCAmJlxuICAgICAgICAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSAmJlxuICAgICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSBnaXZlbiBhcmd1bWVudHMgYXJlIGZyb20gYW4gaXRlcmF0ZWUgY2FsbC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgcG90ZW50aWFsIGl0ZXJhdGVlIHZhbHVlIGFyZ3VtZW50LlxuICAgICAqIEBwYXJhbSB7Kn0gaW5kZXggVGhlIHBvdGVudGlhbCBpdGVyYXRlZSBpbmRleCBvciBrZXkgYXJndW1lbnQuXG4gICAgICogQHBhcmFtIHsqfSBvYmplY3QgVGhlIHBvdGVudGlhbCBpdGVyYXRlZSBvYmplY3QgYXJndW1lbnQuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBhcmd1bWVudHMgYXJlIGZyb20gYW4gaXRlcmF0ZWUgY2FsbCxcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzSXRlcmF0ZWVDYWxsKHZhbHVlLCBpbmRleCwgb2JqZWN0KSB7XG4gICAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgaW5kZXg7XG4gICAgICBpZiAodHlwZSA9PSAnbnVtYmVyJ1xuICAgICAgICAgICAgPyAoaXNBcnJheUxpa2Uob2JqZWN0KSAmJiBpc0luZGV4KGluZGV4LCBvYmplY3QubGVuZ3RoKSlcbiAgICAgICAgICAgIDogKHR5cGUgPT0gJ3N0cmluZycgJiYgaW5kZXggaW4gb2JqZWN0KVxuICAgICAgICAgICkge1xuICAgICAgICByZXR1cm4gZXEob2JqZWN0W2luZGV4XSwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcHJvcGVydHkgbmFtZSBhbmQgbm90IGEgcHJvcGVydHkgcGF0aC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkga2V5cyBvbi5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3BlcnR5IG5hbWUsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0tleSh2YWx1ZSwgb2JqZWN0KSB7XG4gICAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gICAgICBpZiAodHlwZSA9PSAnbnVtYmVyJyB8fCB0eXBlID09ICdzeW1ib2wnIHx8IHR5cGUgPT0gJ2Jvb2xlYW4nIHx8XG4gICAgICAgICAgdmFsdWUgPT0gbnVsbCB8fCBpc1N5bWJvbCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVJc1BsYWluUHJvcC50ZXN0KHZhbHVlKSB8fCAhcmVJc0RlZXBQcm9wLnRlc3QodmFsdWUpIHx8XG4gICAgICAgIChvYmplY3QgIT0gbnVsbCAmJiB2YWx1ZSBpbiBPYmplY3Qob2JqZWN0KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUgZm9yIHVzZSBhcyB1bmlxdWUgb2JqZWN0IGtleS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0tleWFibGUodmFsdWUpIHtcbiAgICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlO1xuICAgICAgcmV0dXJuICh0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJylcbiAgICAgICAgPyAodmFsdWUgIT09ICdfX3Byb3RvX18nKVxuICAgICAgICA6ICh2YWx1ZSA9PT0gbnVsbCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGBmdW5jYCBoYXMgYSBsYXp5IGNvdW50ZXJwYXJ0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGZ1bmNgIGhhcyBhIGxhenkgY291bnRlcnBhcnQsXG4gICAgICogIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0xhemlhYmxlKGZ1bmMpIHtcbiAgICAgIHZhciBmdW5jTmFtZSA9IGdldEZ1bmNOYW1lKGZ1bmMpLFxuICAgICAgICAgIG90aGVyID0gbG9kYXNoW2Z1bmNOYW1lXTtcblxuICAgICAgaWYgKHR5cGVvZiBvdGhlciAhPSAnZnVuY3Rpb24nIHx8ICEoZnVuY05hbWUgaW4gTGF6eVdyYXBwZXIucHJvdG90eXBlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoZnVuYyA9PT0gb3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB2YXIgZGF0YSA9IGdldERhdGEob3RoZXIpO1xuICAgICAgcmV0dXJuICEhZGF0YSAmJiBmdW5jID09PSBkYXRhWzBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgZnVuY2AgaGFzIGl0cyBzb3VyY2UgbWFza2VkLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGZ1bmNgIGlzIG1hc2tlZCwgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTWFza2VkKGZ1bmMpIHtcbiAgICAgIHJldHVybiAhIW1hc2tTcmNLZXkgJiYgKG1hc2tTcmNLZXkgaW4gZnVuYyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGBmdW5jYCBpcyBjYXBhYmxlIG9mIGJlaW5nIG1hc2tlZC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrYWJsZSwgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIHZhciBpc01hc2thYmxlID0gY29yZUpzRGF0YSA/IGlzRnVuY3Rpb24gOiBzdHViRmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYSBwcm90b3R5cGUgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3RvdHlwZSwgZWxzZSBgZmFsc2VgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzUHJvdG90eXBlKHZhbHVlKSB7XG4gICAgICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLFxuICAgICAgICAgIHByb3RvID0gKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUpIHx8IG9iamVjdFByb3RvO1xuXG4gICAgICByZXR1cm4gdmFsdWUgPT09IHByb3RvO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHN1aXRhYmxlIGZvciBzdHJpY3QgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlmIHN1aXRhYmxlIGZvciBzdHJpY3RcbiAgICAgKiAgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc1N0cmljdENvbXBhcmFibGUodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgJiYgIWlzT2JqZWN0KHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYG1hdGNoZXNQcm9wZXJ0eWAgZm9yIHNvdXJjZSB2YWx1ZXMgc3VpdGFibGVcbiAgICAgKiBmb3Igc3RyaWN0IGVxdWFsaXR5IGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cbiAgICAgKiBAcGFyYW0geyp9IHNyY1ZhbHVlIFRoZSB2YWx1ZSB0byBtYXRjaC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzcGVjIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1hdGNoZXNTdHJpY3RDb21wYXJhYmxlKGtleSwgc3JjVmFsdWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHtcbiAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gc3JjVmFsdWUgJiZcbiAgICAgICAgICAoc3JjVmFsdWUgIT09IHVuZGVmaW5lZCB8fCAoa2V5IGluIE9iamVjdChvYmplY3QpKSk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5tZW1vaXplYCB3aGljaCBjbGVhcnMgdGhlIG1lbW9pemVkIGZ1bmN0aW9uJ3NcbiAgICAgKiBjYWNoZSB3aGVuIGl0IGV4Y2VlZHMgYE1BWF9NRU1PSVpFX1NJWkVgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBoYXZlIGl0cyBvdXRwdXQgbWVtb2l6ZWQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgbWVtb2l6ZWQgZnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWVtb2l6ZUNhcHBlZChmdW5jKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gbWVtb2l6ZShmdW5jLCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgaWYgKGNhY2hlLnNpemUgPT09IE1BWF9NRU1PSVpFX1NJWkUpIHtcbiAgICAgICAgICBjYWNoZS5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBrZXk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGNhY2hlID0gcmVzdWx0LmNhY2hlO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXJnZXMgdGhlIGZ1bmN0aW9uIG1ldGFkYXRhIG9mIGBzb3VyY2VgIGludG8gYGRhdGFgLlxuICAgICAqXG4gICAgICogTWVyZ2luZyBtZXRhZGF0YSByZWR1Y2VzIHRoZSBudW1iZXIgb2Ygd3JhcHBlcnMgdXNlZCB0byBpbnZva2UgYSBmdW5jdGlvbi5cbiAgICAgKiBUaGlzIGlzIHBvc3NpYmxlIGJlY2F1c2UgbWV0aG9kcyBsaWtlIGBfLmJpbmRgLCBgXy5jdXJyeWAsIGFuZCBgXy5wYXJ0aWFsYFxuICAgICAqIG1heSBiZSBhcHBsaWVkIHJlZ2FyZGxlc3Mgb2YgZXhlY3V0aW9uIG9yZGVyLiBNZXRob2RzIGxpa2UgYF8uYXJ5YCBhbmRcbiAgICAgKiBgXy5yZWFyZ2AgbW9kaWZ5IGZ1bmN0aW9uIGFyZ3VtZW50cywgbWFraW5nIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IGFyZVxuICAgICAqIGV4ZWN1dGVkIGltcG9ydGFudCwgcHJldmVudGluZyB0aGUgbWVyZ2luZyBvZiBtZXRhZGF0YS4gSG93ZXZlciwgd2UgbWFrZVxuICAgICAqIGFuIGV4Y2VwdGlvbiBmb3IgYSBzYWZlIGNvbWJpbmVkIGNhc2Ugd2hlcmUgY3VycmllZCBmdW5jdGlvbnMgaGF2ZSBgXy5hcnlgXG4gICAgICogYW5kIG9yIGBfLnJlYXJnYCBhcHBsaWVkLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBkYXRhIFRoZSBkZXN0aW5hdGlvbiBtZXRhZGF0YS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBzb3VyY2UgVGhlIHNvdXJjZSBtZXRhZGF0YS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGRhdGFgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1lcmdlRGF0YShkYXRhLCBzb3VyY2UpIHtcbiAgICAgIHZhciBiaXRtYXNrID0gZGF0YVsxXSxcbiAgICAgICAgICBzcmNCaXRtYXNrID0gc291cmNlWzFdLFxuICAgICAgICAgIG5ld0JpdG1hc2sgPSBiaXRtYXNrIHwgc3JjQml0bWFzayxcbiAgICAgICAgICBpc0NvbW1vbiA9IG5ld0JpdG1hc2sgPCAoV1JBUF9CSU5EX0ZMQUcgfCBXUkFQX0JJTkRfS0VZX0ZMQUcgfCBXUkFQX0FSWV9GTEFHKTtcblxuICAgICAgdmFyIGlzQ29tYm8gPVxuICAgICAgICAoKHNyY0JpdG1hc2sgPT0gV1JBUF9BUllfRkxBRykgJiYgKGJpdG1hc2sgPT0gV1JBUF9DVVJSWV9GTEFHKSkgfHxcbiAgICAgICAgKChzcmNCaXRtYXNrID09IFdSQVBfQVJZX0ZMQUcpICYmIChiaXRtYXNrID09IFdSQVBfUkVBUkdfRkxBRykgJiYgKGRhdGFbN10ubGVuZ3RoIDw9IHNvdXJjZVs4XSkpIHx8XG4gICAgICAgICgoc3JjQml0bWFzayA9PSAoV1JBUF9BUllfRkxBRyB8IFdSQVBfUkVBUkdfRkxBRykpICYmIChzb3VyY2VbN10ubGVuZ3RoIDw9IHNvdXJjZVs4XSkgJiYgKGJpdG1hc2sgPT0gV1JBUF9DVVJSWV9GTEFHKSk7XG5cbiAgICAgIC8vIEV4aXQgZWFybHkgaWYgbWV0YWRhdGEgY2FuJ3QgYmUgbWVyZ2VkLlxuICAgICAgaWYgKCEoaXNDb21tb24gfHwgaXNDb21ibykpIHtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICB9XG4gICAgICAvLyBVc2Ugc291cmNlIGB0aGlzQXJnYCBpZiBhdmFpbGFibGUuXG4gICAgICBpZiAoc3JjQml0bWFzayAmIFdSQVBfQklORF9GTEFHKSB7XG4gICAgICAgIGRhdGFbMl0gPSBzb3VyY2VbMl07XG4gICAgICAgIC8vIFNldCB3aGVuIGN1cnJ5aW5nIGEgYm91bmQgZnVuY3Rpb24uXG4gICAgICAgIG5ld0JpdG1hc2sgfD0gYml0bWFzayAmIFdSQVBfQklORF9GTEFHID8gMCA6IFdSQVBfQ1VSUllfQk9VTkRfRkxBRztcbiAgICAgIH1cbiAgICAgIC8vIENvbXBvc2UgcGFydGlhbCBhcmd1bWVudHMuXG4gICAgICB2YXIgdmFsdWUgPSBzb3VyY2VbM107XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgdmFyIHBhcnRpYWxzID0gZGF0YVszXTtcbiAgICAgICAgZGF0YVszXSA9IHBhcnRpYWxzID8gY29tcG9zZUFyZ3MocGFydGlhbHMsIHZhbHVlLCBzb3VyY2VbNF0pIDogdmFsdWU7XG4gICAgICAgIGRhdGFbNF0gPSBwYXJ0aWFscyA/IHJlcGxhY2VIb2xkZXJzKGRhdGFbM10sIFBMQUNFSE9MREVSKSA6IHNvdXJjZVs0XTtcbiAgICAgIH1cbiAgICAgIC8vIENvbXBvc2UgcGFydGlhbCByaWdodCBhcmd1bWVudHMuXG4gICAgICB2YWx1ZSA9IHNvdXJjZVs1XTtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICBwYXJ0aWFscyA9IGRhdGFbNV07XG4gICAgICAgIGRhdGFbNV0gPSBwYXJ0aWFscyA/IGNvbXBvc2VBcmdzUmlnaHQocGFydGlhbHMsIHZhbHVlLCBzb3VyY2VbNl0pIDogdmFsdWU7XG4gICAgICAgIGRhdGFbNl0gPSBwYXJ0aWFscyA/IHJlcGxhY2VIb2xkZXJzKGRhdGFbNV0sIFBMQUNFSE9MREVSKSA6IHNvdXJjZVs2XTtcbiAgICAgIH1cbiAgICAgIC8vIFVzZSBzb3VyY2UgYGFyZ1Bvc2AgaWYgYXZhaWxhYmxlLlxuICAgICAgdmFsdWUgPSBzb3VyY2VbN107XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgZGF0YVs3XSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgLy8gVXNlIHNvdXJjZSBgYXJ5YCBpZiBpdCdzIHNtYWxsZXIuXG4gICAgICBpZiAoc3JjQml0bWFzayAmIFdSQVBfQVJZX0ZMQUcpIHtcbiAgICAgICAgZGF0YVs4XSA9IGRhdGFbOF0gPT0gbnVsbCA/IHNvdXJjZVs4XSA6IG5hdGl2ZU1pbihkYXRhWzhdLCBzb3VyY2VbOF0pO1xuICAgICAgfVxuICAgICAgLy8gVXNlIHNvdXJjZSBgYXJpdHlgIGlmIG9uZSBpcyBub3QgcHJvdmlkZWQuXG4gICAgICBpZiAoZGF0YVs5XSA9PSBudWxsKSB7XG4gICAgICAgIGRhdGFbOV0gPSBzb3VyY2VbOV07XG4gICAgICB9XG4gICAgICAvLyBVc2Ugc291cmNlIGBmdW5jYCBhbmQgbWVyZ2UgYml0bWFza3MuXG4gICAgICBkYXRhWzBdID0gc291cmNlWzBdO1xuICAgICAgZGF0YVsxXSA9IG5ld0JpdG1hc2s7XG5cbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZVxuICAgICAqIFtgT2JqZWN0LmtleXNgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cylcbiAgICAgKiBleGNlcHQgdGhhdCBpdCBpbmNsdWRlcyBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBuYXRpdmVLZXlzSW4ob2JqZWN0KSB7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICBpZiAob2JqZWN0ICE9IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIE9iamVjdChvYmplY3QpKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nIHVzaW5nIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKHZhbHVlKSB7XG4gICAgICByZXR1cm4gbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlUmVzdGAgd2hpY2ggdHJhbnNmb3JtcyB0aGUgcmVzdCBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSByZXN0IGFycmF5IHRyYW5zZm9ybS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvdmVyUmVzdChmdW5jLCBzdGFydCwgdHJhbnNmb3JtKSB7XG4gICAgICBzdGFydCA9IG5hdGl2ZU1heChzdGFydCA9PT0gdW5kZWZpbmVkID8gKGZ1bmMubGVuZ3RoIC0gMSkgOiBzdGFydCwgMCk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLFxuICAgICAgICAgICAgaW5kZXggPSAtMSxcbiAgICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChhcmdzLmxlbmd0aCAtIHN0YXJ0LCAwKSxcbiAgICAgICAgICAgIGFycmF5ID0gQXJyYXkobGVuZ3RoKTtcblxuICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICAgIGFycmF5W2luZGV4XSA9IGFyZ3Nbc3RhcnQgKyBpbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgaW5kZXggPSAtMTtcbiAgICAgICAgdmFyIG90aGVyQXJncyA9IEFycmF5KHN0YXJ0ICsgMSk7XG4gICAgICAgIHdoaWxlICgrK2luZGV4IDwgc3RhcnQpIHtcbiAgICAgICAgICBvdGhlckFyZ3NbaW5kZXhdID0gYXJnc1tpbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgb3RoZXJBcmdzW3N0YXJ0XSA9IHRyYW5zZm9ybShhcnJheSk7XG4gICAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzLCBvdGhlckFyZ3MpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBwYXJlbnQgdmFsdWUgYXQgYHBhdGhgIG9mIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGF0aCBUaGUgcGF0aCB0byBnZXQgdGhlIHBhcmVudCB2YWx1ZSBvZi5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcGFyZW50IHZhbHVlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHBhcmVudChvYmplY3QsIHBhdGgpIHtcbiAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA8IDIgPyBvYmplY3QgOiBiYXNlR2V0KG9iamVjdCwgYmFzZVNsaWNlKHBhdGgsIDAsIC0xKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVvcmRlciBgYXJyYXlgIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWVkIGluZGV4ZXMgd2hlcmUgdGhlIGVsZW1lbnQgYXRcbiAgICAgKiB0aGUgZmlyc3QgaW5kZXggaXMgYXNzaWduZWQgYXMgdGhlIGZpcnN0IGVsZW1lbnQsIHRoZSBlbGVtZW50IGF0XG4gICAgICogdGhlIHNlY29uZCBpbmRleCBpcyBhc3NpZ25lZCBhcyB0aGUgc2Vjb25kIGVsZW1lbnQsIGFuZCBzbyBvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHJlb3JkZXIuXG4gICAgICogQHBhcmFtIHtBcnJheX0gaW5kZXhlcyBUaGUgYXJyYW5nZWQgYXJyYXkgaW5kZXhlcy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW9yZGVyKGFycmF5LCBpbmRleGVzKSB7XG4gICAgICB2YXIgYXJyTGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1pbihpbmRleGVzLmxlbmd0aCwgYXJyTGVuZ3RoKSxcbiAgICAgICAgICBvbGRBcnJheSA9IGNvcHlBcnJheShhcnJheSk7XG5cbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICB2YXIgaW5kZXggPSBpbmRleGVzW2xlbmd0aF07XG4gICAgICAgIGFycmF5W2xlbmd0aF0gPSBpc0luZGV4KGluZGV4LCBhcnJMZW5ndGgpID8gb2xkQXJyYXlbaW5kZXhdIDogdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgbWV0YWRhdGEgZm9yIGBmdW5jYC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBJZiB0aGlzIGZ1bmN0aW9uIGJlY29tZXMgaG90LCBpLmUuIGlzIGludm9rZWQgYSBsb3QgaW4gYSBzaG9ydFxuICAgICAqIHBlcmlvZCBvZiB0aW1lLCBpdCB3aWxsIHRyaXAgaXRzIGJyZWFrZXIgYW5kIHRyYW5zaXRpb24gdG8gYW4gaWRlbnRpdHlcbiAgICAgKiBmdW5jdGlvbiB0byBhdm9pZCBnYXJiYWdlIGNvbGxlY3Rpb24gcGF1c2VzIGluIFY4LiBTZWVcbiAgICAgKiBbVjggaXNzdWUgMjA3MF0oaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MjA3MClcbiAgICAgKiBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBhc3NvY2lhdGUgbWV0YWRhdGEgd2l0aC5cbiAgICAgKiBAcGFyYW0geyp9IGRhdGEgVGhlIG1ldGFkYXRhLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgZnVuY2AuXG4gICAgICovXG4gICAgdmFyIHNldERhdGEgPSBzaG9ydE91dChiYXNlU2V0RGF0YSk7XG5cbiAgICAvKipcbiAgICAgKiBBIHNpbXBsZSB3cmFwcGVyIGFyb3VuZCB0aGUgZ2xvYmFsIFtgc2V0VGltZW91dGBdKGh0dHBzOi8vbWRuLmlvL3NldFRpbWVvdXQpLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWxheS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2FpdCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheSBpbnZvY2F0aW9uLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ8T2JqZWN0fSBSZXR1cm5zIHRoZSB0aW1lciBpZCBvciB0aW1lb3V0IG9iamVjdC5cbiAgICAgKi9cbiAgICB2YXIgc2V0VGltZW91dCA9IGN0eFNldFRpbWVvdXQgfHwgZnVuY3Rpb24oZnVuYywgd2FpdCkge1xuICAgICAgcmV0dXJuIHJvb3Quc2V0VGltZW91dChmdW5jLCB3YWl0KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgYHRvU3RyaW5nYCBtZXRob2Qgb2YgYGZ1bmNgIHRvIHJldHVybiBgc3RyaW5nYC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN0cmluZyBUaGUgYHRvU3RyaW5nYCByZXN1bHQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIGBmdW5jYC5cbiAgICAgKi9cbiAgICB2YXIgc2V0VG9TdHJpbmcgPSBzaG9ydE91dChiYXNlU2V0VG9TdHJpbmcpO1xuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgYHRvU3RyaW5nYCBtZXRob2Qgb2YgYHdyYXBwZXJgIHRvIG1pbWljIHRoZSBzb3VyY2Ugb2YgYHJlZmVyZW5jZWBcbiAgICAgKiB3aXRoIHdyYXBwZXIgZGV0YWlscyBpbiBhIGNvbW1lbnQgYXQgdGhlIHRvcCBvZiB0aGUgc291cmNlIGJvZHkuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHdyYXBwZXIgVGhlIGZ1bmN0aW9uIHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZWZlcmVuY2UgVGhlIHJlZmVyZW5jZSBmdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBjcmVhdGVXcmFwYCBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgd3JhcHBlcmAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0V3JhcFRvU3RyaW5nKHdyYXBwZXIsIHJlZmVyZW5jZSwgYml0bWFzaykge1xuICAgICAgdmFyIHNvdXJjZSA9IChyZWZlcmVuY2UgKyAnJyk7XG4gICAgICByZXR1cm4gc2V0VG9TdHJpbmcod3JhcHBlciwgaW5zZXJ0V3JhcERldGFpbHMoc291cmNlLCB1cGRhdGVXcmFwRGV0YWlscyhnZXRXcmFwRGV0YWlscyhzb3VyY2UpLCBiaXRtYXNrKSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0J2xsIHNob3J0IG91dCBhbmQgaW52b2tlIGBpZGVudGl0eWAgaW5zdGVhZFxuICAgICAqIG9mIGBmdW5jYCB3aGVuIGl0J3MgY2FsbGVkIGBIT1RfQ09VTlRgIG9yIG1vcmUgdGltZXMgaW4gYEhPVF9TUEFOYFxuICAgICAqIG1pbGxpc2Vjb25kcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcmVzdHJpY3QuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgc2hvcnRhYmxlIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3J0T3V0KGZ1bmMpIHtcbiAgICAgIHZhciBjb3VudCA9IDAsXG4gICAgICAgICAgbGFzdENhbGxlZCA9IDA7XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YW1wID0gbmF0aXZlTm93KCksXG4gICAgICAgICAgICByZW1haW5pbmcgPSBIT1RfU1BBTiAtIChzdGFtcCAtIGxhc3RDYWxsZWQpO1xuXG4gICAgICAgIGxhc3RDYWxsZWQgPSBzdGFtcDtcbiAgICAgICAgaWYgKHJlbWFpbmluZyA+IDApIHtcbiAgICAgICAgICBpZiAoKytjb3VudCA+PSBIT1RfQ09VTlQpIHtcbiAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHNbMF07XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5zaHVmZmxlYCB3aGljaCBtdXRhdGVzIGFuZCBzZXRzIHRoZSBzaXplIG9mIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzaHVmZmxlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc2l6ZT1hcnJheS5sZW5ndGhdIFRoZSBzaXplIG9mIGBhcnJheWAuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2h1ZmZsZVNlbGYoYXJyYXksIHNpemUpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICBsYXN0SW5kZXggPSBsZW5ndGggLSAxO1xuXG4gICAgICBzaXplID0gc2l6ZSA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogc2l6ZTtcbiAgICAgIHdoaWxlICgrK2luZGV4IDwgc2l6ZSkge1xuICAgICAgICB2YXIgcmFuZCA9IGJhc2VSYW5kb20oaW5kZXgsIGxhc3RJbmRleCksXG4gICAgICAgICAgICB2YWx1ZSA9IGFycmF5W3JhbmRdO1xuXG4gICAgICAgIGFycmF5W3JhbmRdID0gYXJyYXlbaW5kZXhdO1xuICAgICAgICBhcnJheVtpbmRleF0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIGFycmF5Lmxlbmd0aCA9IHNpemU7XG4gICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYSBwcm9wZXJ0eSBwYXRoIGFycmF5LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHByb3BlcnR5IHBhdGggYXJyYXkuXG4gICAgICovXG4gICAgdmFyIHN0cmluZ1RvUGF0aCA9IG1lbW9pemVDYXBwZWQoZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICBpZiAocmVMZWFkaW5nRG90LnRlc3Qoc3RyaW5nKSkge1xuICAgICAgICByZXN1bHQucHVzaCgnJyk7XG4gICAgICB9XG4gICAgICBzdHJpbmcucmVwbGFjZShyZVByb3BOYW1lLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyLCBxdW90ZSwgc3RyaW5nKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHF1b3RlID8gc3RyaW5nLnJlcGxhY2UocmVFc2NhcGVDaGFyLCAnJDEnKSA6IChudW1iZXIgfHwgbWF0Y2gpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzdHJpbmcga2V5IGlmIGl0J3Mgbm90IGEgc3RyaW5nIG9yIHN5bWJvbC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfHN5bWJvbH0gUmV0dXJucyB0aGUga2V5LlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvS2V5KHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IGlzU3ltYm9sKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICB2YXIgcmVzdWx0ID0gKHZhbHVlICsgJycpO1xuICAgICAgcmV0dXJuIChyZXN1bHQgPT0gJzAnICYmICgxIC8gdmFsdWUpID09IC1JTkZJTklUWSkgPyAnLTAnIDogcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBmdW5jYCB0byBpdHMgc291cmNlIGNvZGUuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc291cmNlIGNvZGUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9Tb3VyY2UoZnVuYykge1xuICAgICAgaWYgKGZ1bmMgIT0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBmdW5jVG9TdHJpbmcuY2FsbChmdW5jKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge31cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gKGZ1bmMgKyAnJyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICB9XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB3cmFwcGVyIGBkZXRhaWxzYCBiYXNlZCBvbiBgYml0bWFza2AgZmxhZ3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gZGV0YWlscyBUaGUgZGV0YWlscyB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgY3JlYXRlV3JhcGAgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGRldGFpbHNgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZVdyYXBEZXRhaWxzKGRldGFpbHMsIGJpdG1hc2spIHtcbiAgICAgIGFycmF5RWFjaCh3cmFwRmxhZ3MsIGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gJ18uJyArIHBhaXJbMF07XG4gICAgICAgIGlmICgoYml0bWFzayAmIHBhaXJbMV0pICYmICFhcnJheUluY2x1ZGVzKGRldGFpbHMsIHZhbHVlKSkge1xuICAgICAgICAgIGRldGFpbHMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRldGFpbHMuc29ydCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgd3JhcHBlcmAuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB3cmFwcGVyIFRoZSB3cmFwcGVyIHRvIGNsb25lLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCB3cmFwcGVyLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHdyYXBwZXJDbG9uZSh3cmFwcGVyKSB7XG4gICAgICBpZiAod3JhcHBlciBpbnN0YW5jZW9mIExhenlXcmFwcGVyKSB7XG4gICAgICAgIHJldHVybiB3cmFwcGVyLmNsb25lKCk7XG4gICAgICB9XG4gICAgICB2YXIgcmVzdWx0ID0gbmV3IExvZGFzaFdyYXBwZXIod3JhcHBlci5fX3dyYXBwZWRfXywgd3JhcHBlci5fX2NoYWluX18pO1xuICAgICAgcmVzdWx0Ll9fYWN0aW9uc19fID0gY29weUFycmF5KHdyYXBwZXIuX19hY3Rpb25zX18pO1xuICAgICAgcmVzdWx0Ll9faW5kZXhfXyAgPSB3cmFwcGVyLl9faW5kZXhfXztcbiAgICAgIHJlc3VsdC5fX3ZhbHVlc19fID0gd3JhcHBlci5fX3ZhbHVlc19fO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGVsZW1lbnRzIHNwbGl0IGludG8gZ3JvdXBzIHRoZSBsZW5ndGggb2YgYHNpemVgLlxuICAgICAqIElmIGBhcnJheWAgY2FuJ3QgYmUgc3BsaXQgZXZlbmx5LCB0aGUgZmluYWwgY2h1bmsgd2lsbCBiZSB0aGUgcmVtYWluaW5nXG4gICAgICogZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3NpemU9MV0gVGhlIGxlbmd0aCBvZiBlYWNoIGNodW5rXG4gICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjaHVua3MuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uY2h1bmsoWydhJywgJ2InLCAnYycsICdkJ10sIDIpO1xuICAgICAqIC8vID0+IFtbJ2EnLCAnYiddLCBbJ2MnLCAnZCddXVxuICAgICAqXG4gICAgICogXy5jaHVuayhbJ2EnLCAnYicsICdjJywgJ2QnXSwgMyk7XG4gICAgICogLy8gPT4gW1snYScsICdiJywgJ2MnXSwgWydkJ11dXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2h1bmsoYXJyYXksIHNpemUsIGd1YXJkKSB7XG4gICAgICBpZiAoKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIHNpemUsIGd1YXJkKSA6IHNpemUgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgc2l6ZSA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaXplID0gbmF0aXZlTWF4KHRvSW50ZWdlcihzaXplKSwgMCk7XG4gICAgICB9XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCB8fCBzaXplIDwgMSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICB2YXIgaW5kZXggPSAwLFxuICAgICAgICAgIHJlc0luZGV4ID0gMCxcbiAgICAgICAgICByZXN1bHQgPSBBcnJheShuYXRpdmVDZWlsKGxlbmd0aCAvIHNpemUpKTtcblxuICAgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFtyZXNJbmRleCsrXSA9IGJhc2VTbGljZShhcnJheSwgaW5kZXgsIChpbmRleCArPSBzaXplKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgZmFsc2V5IHZhbHVlcyByZW1vdmVkLiBUaGUgdmFsdWVzIGBmYWxzZWAsIGBudWxsYCxcbiAgICAgKiBgMGAsIGBcIlwiYCwgYHVuZGVmaW5lZGAsIGFuZCBgTmFOYCBhcmUgZmFsc2V5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbXBhY3QuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZmlsdGVyZWQgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmNvbXBhY3QoWzAsIDEsIGZhbHNlLCAyLCAnJywgM10pO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbXBhY3QoYXJyYXkpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoLFxuICAgICAgICAgIHJlc0luZGV4ID0gMCxcbiAgICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGFycmF5IGNvbmNhdGVuYXRpbmcgYGFycmF5YCB3aXRoIGFueSBhZGRpdGlvbmFsIGFycmF5c1xuICAgICAqIGFuZC9vciB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29uY2F0ZW5hdGUuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGNvbmNhdGVuYXRlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGNvbmNhdGVuYXRlZCBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWzFdO1xuICAgICAqIHZhciBvdGhlciA9IF8uY29uY2F0KGFycmF5LCAyLCBbM10sIFtbNF1dKTtcbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKG90aGVyKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgMywgWzRdXVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsxXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbmNhdCgpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgdmFyIGFyZ3MgPSBBcnJheShsZW5ndGggLSAxKSxcbiAgICAgICAgICBhcnJheSA9IGFyZ3VtZW50c1swXSxcbiAgICAgICAgICBpbmRleCA9IGxlbmd0aDtcblxuICAgICAgd2hpbGUgKGluZGV4LS0pIHtcbiAgICAgICAgYXJnc1tpbmRleCAtIDFdID0gYXJndW1lbnRzW2luZGV4XTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcnJheVB1c2goaXNBcnJheShhcnJheSkgPyBjb3B5QXJyYXkoYXJyYXkpIDogW2FycmF5XSwgYmFzZUZsYXR0ZW4oYXJncywgMSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgYGFycmF5YCB2YWx1ZXMgbm90IGluY2x1ZGVkIGluIHRoZSBvdGhlciBnaXZlbiBhcnJheXNcbiAgICAgKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKVxuICAgICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlXG4gICAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLnB1bGxBbGxgLCB0aGlzIG1ldGhvZCByZXR1cm5zIGEgbmV3IGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBleGNsdWRlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy5cbiAgICAgKiBAc2VlIF8ud2l0aG91dCwgXy54b3JcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5kaWZmZXJlbmNlKFsyLCAxXSwgWzIsIDNdKTtcbiAgICAgKiAvLyA9PiBbMV1cbiAgICAgKi9cbiAgICB2YXIgZGlmZmVyZW5jZSA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5LCB2YWx1ZXMpIHtcbiAgICAgIHJldHVybiBpc0FycmF5TGlrZU9iamVjdChhcnJheSlcbiAgICAgICAgPyBiYXNlRGlmZmVyZW5jZShhcnJheSwgYmFzZUZsYXR0ZW4odmFsdWVzLCAxLCBpc0FycmF5TGlrZU9iamVjdCwgdHJ1ZSkpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRpZmZlcmVuY2VgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaFxuICAgICAqIGlzIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIGFuZCBgdmFsdWVzYCB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uXG4gICAgICogYnkgd2hpY2ggdGhleSdyZSBjb21wYXJlZC4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlXG4gICAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OlxuICAgICAqICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLnB1bGxBbGxCeWAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGV4Y2x1ZGUuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5kaWZmZXJlbmNlQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7XG4gICAgICogLy8gPT4gWzEuMl1cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZGlmZmVyZW5jZUJ5KFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgW3sgJ3gnOiAxIH1dLCAneCcpO1xuICAgICAqIC8vID0+IFt7ICd4JzogMiB9XVxuICAgICAqL1xuICAgIHZhciBkaWZmZXJlbmNlQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7XG4gICAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KHZhbHVlcyk7XG4gICAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7XG4gICAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0KGFycmF5KVxuICAgICAgICA/IGJhc2VEaWZmZXJlbmNlKGFycmF5LCBiYXNlRmxhdHRlbih2YWx1ZXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKVxuICAgICAgICA6IFtdO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5kaWZmZXJlbmNlYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYFxuICAgICAqIHdoaWNoIGlzIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlgIHRvIGB2YWx1ZXNgLiBUaGUgb3JkZXIgYW5kXG4gICAgICogcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZSBkZXRlcm1pbmVkIGJ5IHRoZSBmaXJzdCBhcnJheS4gVGhlIGNvbXBhcmF0b3JcbiAgICAgKiBpcyBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBVbmxpa2UgYF8ucHVsbEFsbFdpdGhgLCB0aGlzIG1ldGhvZCByZXR1cm5zIGEgbmV3IGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBleGNsdWRlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdHMgPSBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH1dO1xuICAgICAqXG4gICAgICogXy5kaWZmZXJlbmNlV2l0aChvYmplY3RzLCBbeyAneCc6IDEsICd5JzogMiB9XSwgXy5pc0VxdWFsKTtcbiAgICAgKiAvLyA9PiBbeyAneCc6IDIsICd5JzogMSB9XVxuICAgICAqL1xuICAgIHZhciBkaWZmZXJlbmNlV2l0aCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5LCB2YWx1ZXMpIHtcbiAgICAgIHZhciBjb21wYXJhdG9yID0gbGFzdCh2YWx1ZXMpO1xuICAgICAgaWYgKGlzQXJyYXlMaWtlT2JqZWN0KGNvbXBhcmF0b3IpKSB7XG4gICAgICAgIGNvbXBhcmF0b3IgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QoYXJyYXkpXG4gICAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIGJhc2VGbGF0dGVuKHZhbHVlcywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyBkcm9wcGVkIGZyb20gdGhlIGJlZ2lubmluZy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjUuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBkcm9wLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmRyb3AoWzEsIDIsIDNdKTtcbiAgICAgKiAvLyA9PiBbMiwgM11cbiAgICAgKlxuICAgICAqIF8uZHJvcChbMSwgMiwgM10sIDIpO1xuICAgICAqIC8vID0+IFszXVxuICAgICAqXG4gICAgICogXy5kcm9wKFsxLCAyLCAzXSwgNSk7XG4gICAgICogLy8gPT4gW11cbiAgICAgKlxuICAgICAqIF8uZHJvcChbMSwgMiwgM10sIDApO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRyb3AoYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBuID0gKGd1YXJkIHx8IG4gPT09IHVuZGVmaW5lZCkgPyAxIDogdG9JbnRlZ2VyKG4pO1xuICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbiwgbGVuZ3RoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyBkcm9wcGVkIGZyb20gdGhlIGVuZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBkcm9wLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmRyb3BSaWdodChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IFsxLCAyXVxuICAgICAqXG4gICAgICogXy5kcm9wUmlnaHQoWzEsIDIsIDNdLCAyKTtcbiAgICAgKiAvLyA9PiBbMV1cbiAgICAgKlxuICAgICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgNSk7XG4gICAgICogLy8gPT4gW11cbiAgICAgKlxuICAgICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgMCk7XG4gICAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAgICovXG4gICAgZnVuY3Rpb24gZHJvcFJpZ2h0KGFycmF5LCBuLCBndWFyZCkge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTtcbiAgICAgIG4gPSBsZW5ndGggLSBuO1xuICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgMCwgbiA8IDAgPyAwIDogbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgZXhjbHVkaW5nIGVsZW1lbnRzIGRyb3BwZWQgZnJvbSB0aGUgZW5kLlxuICAgICAqIEVsZW1lbnRzIGFyZSBkcm9wcGVkIHVudGlsIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzXG4gICAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleCwgYXJyYXkpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiB0cnVlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiBmYWxzZSB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8uZHJvcFJpZ2h0V2hpbGUodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuICFvLmFjdGl2ZTsgfSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmRyb3BSaWdodFdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknLCAnZnJlZCddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5J11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZHJvcFJpZ2h0V2hpbGUodXNlcnMsICdhY3RpdmUnKTtcbiAgICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJywgJ3BlYmJsZXMnXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRyb3BSaWdodFdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgdHJ1ZSwgdHJ1ZSlcbiAgICAgICAgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCBleGNsdWRpbmcgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBiZWdpbm5pbmcuXG4gICAgICogRWxlbWVudHMgYXJlIGRyb3BwZWQgdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXNcbiAgICAgKiBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHVzZXJzID0gW1xuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiB0cnVlIH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogXy5kcm9wV2hpbGUodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuICFvLmFjdGl2ZTsgfSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydwZWJibGVzJ11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5kcm9wV2hpbGUodXNlcnMsIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmRyb3BXaGlsZSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmRyb3BXaGlsZSh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5JywgJ2ZyZWQnLCAncGViYmxlcyddXG4gICAgICovXG4gICAgZnVuY3Rpb24gZHJvcFdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgdHJ1ZSlcbiAgICAgICAgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaWxscyBlbGVtZW50cyBvZiBgYXJyYXlgIHdpdGggYHZhbHVlYCBmcm9tIGBzdGFydGAgdXAgdG8sIGJ1dCBub3RcbiAgICAgKiBpbmNsdWRpbmcsIGBlbmRgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjIuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdO1xuICAgICAqXG4gICAgICogXy5maWxsKGFycmF5LCAnYScpO1xuICAgICAqIGNvbnNvbGUubG9nKGFycmF5KTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYScsICdhJ11cbiAgICAgKlxuICAgICAqIF8uZmlsbChBcnJheSgzKSwgMik7XG4gICAgICogLy8gPT4gWzIsIDIsIDJdXG4gICAgICpcbiAgICAgKiBfLmZpbGwoWzQsIDYsIDgsIDEwXSwgJyonLCAxLCAzKTtcbiAgICAgKiAvLyA9PiBbNCwgJyonLCAnKicsIDEwXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBpZiAoc3RhcnQgJiYgdHlwZW9mIHN0YXJ0ICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQpKSB7XG4gICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgZW5kID0gbGVuZ3RoO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VGaWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQsIGVuZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5maW5kYCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3RcbiAgICAgKiBlbGVtZW50IGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciBpbnN0ZWFkIG9mIHRoZSBlbGVtZW50IGl0c2VsZi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZvdW5kIGVsZW1lbnQsIGVsc2UgYC0xYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHVzZXJzID0gW1xuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiB0cnVlIH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogXy5maW5kSW5kZXgodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8udXNlciA9PSAnYmFybmV5JzsgfSk7XG4gICAgICogLy8gPT4gMFxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbmRJbmRleCh1c2VycywgeyAndXNlcic6ICdmcmVkJywgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IDFcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbmRJbmRleCh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IDBcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZmluZEluZGV4KHVzZXJzLCAnYWN0aXZlJyk7XG4gICAgICogLy8gPT4gMlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbmRJbmRleChhcnJheSwgcHJlZGljYXRlLCBmcm9tSW5kZXgpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIGlmICghbGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIHZhciBpbmRleCA9IGZyb21JbmRleCA9PSBudWxsID8gMCA6IHRvSW50ZWdlcihmcm9tSW5kZXgpO1xuICAgICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IG5hdGl2ZU1heChsZW5ndGggKyBpbmRleCwgMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZUZpbmRJbmRleChhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgaW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmluZEluZGV4YCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzXG4gICAgICogb2YgYGNvbGxlY3Rpb25gIGZyb20gcmlnaHQgdG8gbGVmdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAyLjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD1hcnJheS5sZW5ndGgtMV0gVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBmb3VuZCBlbGVtZW50LCBlbHNlIGAtMWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiB0cnVlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiBmYWxzZSB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8uZmluZExhc3RJbmRleCh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gby51c2VyID09ICdwZWJibGVzJzsgfSk7XG4gICAgICogLy8gPT4gMlxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IHRydWUgfSk7XG4gICAgICogLy8gPT4gMFxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZmluZExhc3RJbmRleCh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IDJcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZmluZExhc3RJbmRleCh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IDBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaW5kTGFzdEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21JbmRleCkge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuICAgICAgdmFyIGluZGV4ID0gbGVuZ3RoIC0gMTtcbiAgICAgIGlmIChmcm9tSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpbmRleCA9IHRvSW50ZWdlcihmcm9tSW5kZXgpO1xuICAgICAgICBpbmRleCA9IGZyb21JbmRleCA8IDBcbiAgICAgICAgICA/IG5hdGl2ZU1heChsZW5ndGggKyBpbmRleCwgMClcbiAgICAgICAgICA6IG5hdGl2ZU1pbihpbmRleCwgbGVuZ3RoIC0gMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZUZpbmRJbmRleChhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgaW5kZXgsIHRydWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZsYXR0ZW5zIGBhcnJheWAgYSBzaW5nbGUgbGV2ZWwgZGVlcC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZsYXR0ZW5lZCBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5mbGF0dGVuKFsxLCBbMiwgWzMsIFs0XV0sIDVdXSk7XG4gICAgICogLy8gPT4gWzEsIDIsIFszLCBbNF1dLCA1XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgMSkgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWN1cnNpdmVseSBmbGF0dGVucyBgYXJyYXlgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGZsYXR0ZW4uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmZsYXR0ZW5EZWVwKFsxLCBbMiwgWzMsIFs0XV0sIDVdXSk7XG4gICAgICogLy8gPT4gWzEsIDIsIDMsIDQsIDVdXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmxhdHRlbkRlZXAoYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgSU5GSU5JVFkpIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlbHkgZmxhdHRlbiBgYXJyYXlgIHVwIHRvIGBkZXB0aGAgdGltZXMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC40LjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmxhdHRlbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIFRoZSBtYXhpbXVtIHJlY3Vyc2lvbiBkZXB0aC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBhcnJheSA9IFsxLCBbMiwgWzMsIFs0XV0sIDVdXTtcbiAgICAgKlxuICAgICAqIF8uZmxhdHRlbkRlcHRoKGFycmF5LCAxKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgWzMsIFs0XV0sIDVdXG4gICAgICpcbiAgICAgKiBfLmZsYXR0ZW5EZXB0aChhcnJheSwgMik7XG4gICAgICogLy8gPT4gWzEsIDIsIDMsIFs0XSwgNV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmbGF0dGVuRGVwdGgoYXJyYXksIGRlcHRoKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBkZXB0aCA9IGRlcHRoID09PSB1bmRlZmluZWQgPyAxIDogdG9JbnRlZ2VyKGRlcHRoKTtcbiAgICAgIHJldHVybiBiYXNlRmxhdHRlbihhcnJheSwgZGVwdGgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBpbnZlcnNlIG9mIGBfLnRvUGFpcnNgOyB0aGlzIG1ldGhvZCByZXR1cm5zIGFuIG9iamVjdCBjb21wb3NlZFxuICAgICAqIGZyb20ga2V5LXZhbHVlIGBwYWlyc2AuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYWlycyBUaGUga2V5LXZhbHVlIHBhaXJzLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZnJvbVBhaXJzKFtbJ2EnLCAxXSwgWydiJywgMl1dKTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyIH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmcm9tUGFpcnMocGFpcnMpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IHBhaXJzID09IG51bGwgPyAwIDogcGFpcnMubGVuZ3RoLFxuICAgICAgICAgIHJlc3VsdCA9IHt9O1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgcGFpciA9IHBhaXJzW2luZGV4XTtcbiAgICAgICAgcmVzdWx0W3BhaXJbMF1dID0gcGFpclsxXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGFsaWFzIGZpcnN0XG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50IG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaGVhZChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IDFcbiAgICAgKlxuICAgICAqIF8uaGVhZChbXSk7XG4gICAgICogLy8gPT4gdW5kZWZpbmVkXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGVhZChhcnJheSkge1xuICAgICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpID8gYXJyYXlbMF0gOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYHZhbHVlYCBpcyBmb3VuZCBpbiBgYXJyYXlgXG4gICAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybylcbiAgICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuIElmIGBmcm9tSW5kZXhgIGlzIG5lZ2F0aXZlLCBpdCdzIHVzZWQgYXMgdGhlXG4gICAgICogb2Zmc2V0IGZyb20gdGhlIGVuZCBvZiBgYXJyYXlgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pbmRleE9mKFsxLCAyLCAxLCAyXSwgMik7XG4gICAgICogLy8gPT4gMVxuICAgICAqXG4gICAgICogLy8gU2VhcmNoIGZyb20gdGhlIGBmcm9tSW5kZXhgLlxuICAgICAqIF8uaW5kZXhPZihbMSwgMiwgMSwgMl0sIDIsIDIpO1xuICAgICAqIC8vID0+IDNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoZnJvbUluZGV4KTtcbiAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgaW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYWxsIGJ1dCB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmluaXRpYWwoWzEsIDIsIDNdKTtcbiAgICAgKiAvLyA9PiBbMSwgMl1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbml0aWFsKGFycmF5KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICByZXR1cm4gbGVuZ3RoID8gYmFzZVNsaWNlKGFycmF5LCAwLCAtMSkgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHVuaXF1ZSB2YWx1ZXMgdGhhdCBhcmUgaW5jbHVkZWQgaW4gYWxsIGdpdmVuIGFycmF5c1xuICAgICAqIHVzaW5nIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pXG4gICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLiBUaGUgb3JkZXIgYW5kIHJlZmVyZW5jZXMgb2YgcmVzdWx0IHZhbHVlcyBhcmVcbiAgICAgKiBkZXRlcm1pbmVkIGJ5IHRoZSBmaXJzdCBhcnJheS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmludGVyc2VjdGlvbihbMiwgMV0sIFsyLCAzXSk7XG4gICAgICogLy8gPT4gWzJdXG4gICAgICovXG4gICAgdmFyIGludGVyc2VjdGlvbiA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgdmFyIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7XG4gICAgICByZXR1cm4gKG1hcHBlZC5sZW5ndGggJiYgbWFwcGVkWzBdID09PSBhcnJheXNbMF0pXG4gICAgICAgID8gYmFzZUludGVyc2VjdGlvbihtYXBwZWQpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmludGVyc2VjdGlvbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgXG4gICAgICogd2hpY2ggaXMgaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvblxuICAgICAqIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZVxuICAgICAqIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDpcbiAgICAgKiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmludGVyc2VjdGlvbkJ5KFsyLjEsIDEuMl0sIFsyLjMsIDMuNF0sIE1hdGguZmxvb3IpO1xuICAgICAqIC8vID0+IFsyLjFdXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmludGVyc2VjdGlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpO1xuICAgICAqIC8vID0+IFt7ICd4JzogMSB9XVxuICAgICAqL1xuICAgIHZhciBpbnRlcnNlY3Rpb25CeSA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgdmFyIGl0ZXJhdGVlID0gbGFzdChhcnJheXMpLFxuICAgICAgICAgIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7XG5cbiAgICAgIGlmIChpdGVyYXRlZSA9PT0gbGFzdChtYXBwZWQpKSB7XG4gICAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWFwcGVkLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKVxuICAgICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmludGVyc2VjdGlvbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY29tcGFyYXRvcmBcbiAgICAgKiB3aGljaCBpcyBpbnZva2VkIHRvIGNvbXBhcmUgZWxlbWVudHMgb2YgYGFycmF5c2AuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlc1xuICAgICAqIG9mIHJlc3VsdCB2YWx1ZXMgYXJlIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgY29tcGFyYXRvciBpc1xuICAgICAqIGludm9rZWQgd2l0aCB0d28gYXJndW1lbnRzOiAoYXJyVmFsLCBvdGhWYWwpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGludGVyc2VjdGluZyB2YWx1ZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XTtcbiAgICAgKiB2YXIgb3RoZXJzID0gW3sgJ3gnOiAxLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTtcbiAgICAgKlxuICAgICAqIF8uaW50ZXJzZWN0aW9uV2l0aChvYmplY3RzLCBvdGhlcnMsIF8uaXNFcXVhbCk7XG4gICAgICogLy8gPT4gW3sgJ3gnOiAxLCAneSc6IDIgfV1cbiAgICAgKi9cbiAgICB2YXIgaW50ZXJzZWN0aW9uV2l0aCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgdmFyIGNvbXBhcmF0b3IgPSBsYXN0KGFycmF5cyksXG4gICAgICAgICAgbWFwcGVkID0gYXJyYXlNYXAoYXJyYXlzLCBjYXN0QXJyYXlMaWtlT2JqZWN0KTtcblxuICAgICAgY29tcGFyYXRvciA9IHR5cGVvZiBjb21wYXJhdG9yID09ICdmdW5jdGlvbicgPyBjb21wYXJhdG9yIDogdW5kZWZpbmVkO1xuICAgICAgaWYgKGNvbXBhcmF0b3IpIHtcbiAgICAgICAgbWFwcGVkLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKVxuICAgICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhbGwgZWxlbWVudHMgaW4gYGFycmF5YCBpbnRvIGEgc3RyaW5nIHNlcGFyYXRlZCBieSBgc2VwYXJhdG9yYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBjb252ZXJ0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc2VwYXJhdG9yPScsJ10gVGhlIGVsZW1lbnQgc2VwYXJhdG9yLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGpvaW5lZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uam9pbihbJ2EnLCAnYicsICdjJ10sICd+Jyk7XG4gICAgICogLy8gPT4gJ2F+Yn5jJ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGpvaW4oYXJyYXksIHNlcGFyYXRvcikge1xuICAgICAgcmV0dXJuIGFycmF5ID09IG51bGwgPyAnJyA6IG5hdGl2ZUpvaW4uY2FsbChhcnJheSwgc2VwYXJhdG9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ubGFzdChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IDNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsYXN0KGFycmF5KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICByZXR1cm4gbGVuZ3RoID8gYXJyYXlbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbmRleE9mYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mXG4gICAgICogYGFycmF5YCBmcm9tIHJpZ2h0IHRvIGxlZnQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZnJvbUluZGV4PWFycmF5Lmxlbmd0aC0xXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5sYXN0SW5kZXhPZihbMSwgMiwgMSwgMl0sIDIpO1xuICAgICAqIC8vID0+IDNcbiAgICAgKlxuICAgICAqIC8vIFNlYXJjaCBmcm9tIHRoZSBgZnJvbUluZGV4YC5cbiAgICAgKiBfLmxhc3RJbmRleE9mKFsxLCAyLCAxLCAyXSwgMiwgMik7XG4gICAgICogLy8gPT4gMVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgICB2YXIgaW5kZXggPSBsZW5ndGg7XG4gICAgICBpZiAoZnJvbUluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaW5kZXggPSB0b0ludGVnZXIoZnJvbUluZGV4KTtcbiAgICAgICAgaW5kZXggPSBpbmRleCA8IDAgPyBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApIDogbmF0aXZlTWluKGluZGV4LCBsZW5ndGggLSAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWVcbiAgICAgICAgPyBzdHJpY3RMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGluZGV4KVxuICAgICAgICA6IGJhc2VGaW5kSW5kZXgoYXJyYXksIGJhc2VJc05hTiwgaW5kZXgsIHRydWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGVsZW1lbnQgYXQgaW5kZXggYG5gIG9mIGBhcnJheWAuIElmIGBuYCBpcyBuZWdhdGl2ZSwgdGhlIG50aFxuICAgICAqIGVsZW1lbnQgZnJvbSB0aGUgZW5kIGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MF0gVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIHJldHVybi5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbnRoIGVsZW1lbnQgb2YgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJ107XG4gICAgICpcbiAgICAgKiBfLm50aChhcnJheSwgMSk7XG4gICAgICogLy8gPT4gJ2InXG4gICAgICpcbiAgICAgKiBfLm50aChhcnJheSwgLTIpO1xuICAgICAqIC8vID0+ICdjJztcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBudGgoYXJyYXksIG4pIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VOdGgoYXJyYXksIHRvSW50ZWdlcihuKSkgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbGwgZ2l2ZW4gdmFsdWVzIGZyb20gYGFycmF5YCB1c2luZ1xuICAgICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pXG4gICAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFVubGlrZSBgXy53aXRob3V0YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLiBVc2UgYF8ucmVtb3ZlYFxuICAgICAqIHRvIHJlbW92ZSBlbGVtZW50cyBmcm9tIGFuIGFycmF5IGJ5IHByZWRpY2F0ZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAyLjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIHJlbW92ZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWydhJywgJ2InLCAnYycsICdhJywgJ2InLCAnYyddO1xuICAgICAqXG4gICAgICogXy5wdWxsKGFycmF5LCAnYScsICdjJyk7XG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsnYicsICdiJ11cbiAgICAgKi9cbiAgICB2YXIgcHVsbCA9IGJhc2VSZXN0KHB1bGxBbGwpO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5wdWxsYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGFuIGFycmF5IG9mIHZhbHVlcyB0byByZW1vdmUuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmRpZmZlcmVuY2VgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWydhJywgJ2InLCAnYycsICdhJywgJ2InLCAnYyddO1xuICAgICAqXG4gICAgICogXy5wdWxsQWxsKGFycmF5LCBbJ2EnLCAnYyddKTtcbiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7XG4gICAgICogLy8gPT4gWydiJywgJ2InXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHB1bGxBbGwoYXJyYXksIHZhbHVlcykge1xuICAgICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGggJiYgdmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpXG4gICAgICAgID8gYmFzZVB1bGxBbGwoYXJyYXksIHZhbHVlcylcbiAgICAgICAgOiBhcnJheTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnB1bGxBbGxgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIGFuZCBgdmFsdWVzYCB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uXG4gICAgICogYnkgd2hpY2ggdGhleSdyZSBjb21wYXJlZC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmRpZmZlcmVuY2VCeWAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gcmVtb3ZlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gW3sgJ3gnOiAxIH0sIHsgJ3gnOiAyIH0sIHsgJ3gnOiAzIH0sIHsgJ3gnOiAxIH1dO1xuICAgICAqXG4gICAgICogXy5wdWxsQWxsQnkoYXJyYXksIFt7ICd4JzogMSB9LCB7ICd4JzogMyB9XSwgJ3gnKTtcbiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7XG4gICAgICogLy8gPT4gW3sgJ3gnOiAyIH1dXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHVsbEFsbEJ5KGFycmF5LCB2YWx1ZXMsIGl0ZXJhdGVlKSB7XG4gICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCAmJiB2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aClcbiAgICAgICAgPyBiYXNlUHVsbEFsbChhcnJheSwgdmFsdWVzLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpXG4gICAgICAgIDogYXJyYXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5wdWxsQWxsYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYCB3aGljaFxuICAgICAqIGlzIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlgIHRvIGB2YWx1ZXNgLiBUaGUgY29tcGFyYXRvciBpc1xuICAgICAqIGludm9rZWQgd2l0aCB0d28gYXJndW1lbnRzOiAoYXJyVmFsLCBvdGhWYWwpLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFVubGlrZSBgXy5kaWZmZXJlbmNlV2l0aGAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjYuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gcmVtb3ZlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMywgJ3knOiA0IH0sIHsgJ3gnOiA1LCAneSc6IDYgfV07XG4gICAgICpcbiAgICAgKiBfLnB1bGxBbGxXaXRoKGFycmF5LCBbeyAneCc6IDMsICd5JzogNCB9XSwgXy5pc0VxdWFsKTtcbiAgICAgKiBjb25zb2xlLmxvZyhhcnJheSk7XG4gICAgICogLy8gPT4gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDUsICd5JzogNiB9XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHB1bGxBbGxXaXRoKGFycmF5LCB2YWx1ZXMsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoICYmIHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKVxuICAgICAgICA/IGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIHVuZGVmaW5lZCwgY29tcGFyYXRvcilcbiAgICAgICAgOiBhcnJheTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGVsZW1lbnRzIGZyb20gYGFycmF5YCBjb3JyZXNwb25kaW5nIHRvIGBpbmRleGVzYCBhbmQgcmV0dXJucyBhblxuICAgICAqIGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmF0YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0gey4uLihudW1iZXJ8bnVtYmVyW10pfSBbaW5kZXhlc10gVGhlIGluZGV4ZXMgb2YgZWxlbWVudHMgdG8gcmVtb3ZlLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBhcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCddO1xuICAgICAqIHZhciBwdWxsZWQgPSBfLnB1bGxBdChhcnJheSwgWzEsIDNdKTtcbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKGFycmF5KTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYyddXG4gICAgICpcbiAgICAgKiBjb25zb2xlLmxvZyhwdWxsZWQpO1xuICAgICAqIC8vID0+IFsnYicsICdkJ11cbiAgICAgKi9cbiAgICB2YXIgcHVsbEF0ID0gZmxhdFJlc3QoZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICByZXN1bHQgPSBiYXNlQXQoYXJyYXksIGluZGV4ZXMpO1xuXG4gICAgICBiYXNlUHVsbEF0KGFycmF5LCBhcnJheU1hcChpbmRleGVzLCBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICByZXR1cm4gaXNJbmRleChpbmRleCwgbGVuZ3RoKSA/ICtpbmRleCA6IGluZGV4O1xuICAgICAgfSkuc29ydChjb21wYXJlQXNjZW5kaW5nKSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFsbCBlbGVtZW50cyBmcm9tIGBhcnJheWAgdGhhdCBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3JcbiAgICAgKiBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiB0aGUgcmVtb3ZlZCBlbGVtZW50cy4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkXG4gICAgICogd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZmlsdGVyYCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLiBVc2UgYF8ucHVsbGBcbiAgICAgKiB0byBwdWxsIGVsZW1lbnRzIGZyb20gYW4gYXJyYXkgYnkgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZW1vdmVkIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgMywgNF07XG4gICAgICogdmFyIGV2ZW5zID0gXy5yZW1vdmUoYXJyYXksIGZ1bmN0aW9uKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAwO1xuICAgICAqIH0pO1xuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsxLCAzXVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2coZXZlbnMpO1xuICAgICAqIC8vID0+IFsyLCA0XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZShhcnJheSwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBpbmRleGVzID0gW10sXG4gICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXG4gICAgICBwcmVkaWNhdGUgPSBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpO1xuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgYXJyYXkpKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICAgIGluZGV4ZXMucHVzaChpbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJhc2VQdWxsQXQoYXJyYXksIGluZGV4ZXMpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXZlcnNlcyBgYXJyYXlgIHNvIHRoYXQgdGhlIGZpcnN0IGVsZW1lbnQgYmVjb21lcyB0aGUgbGFzdCwgdGhlIHNlY29uZFxuICAgICAqIGVsZW1lbnQgYmVjb21lcyB0aGUgc2Vjb25kIHRvIGxhc3QsIGFuZCBzbyBvbi5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAgYW5kIGlzIGJhc2VkIG9uXG4gICAgICogW2BBcnJheSNyZXZlcnNlYF0oaHR0cHM6Ly9tZG4uaW8vQXJyYXkvcmV2ZXJzZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgM107XG4gICAgICpcbiAgICAgKiBfLnJldmVyc2UoYXJyYXkpO1xuICAgICAqIC8vID0+IFszLCAyLCAxXVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFszLCAyLCAxXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJldmVyc2UoYXJyYXkpIHtcbiAgICAgIHJldHVybiBhcnJheSA9PSBudWxsID8gYXJyYXkgOiBuYXRpdmVSZXZlcnNlLmNhbGwoYXJyYXkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIGZyb20gYHN0YXJ0YCB1cCB0bywgYnV0IG5vdCBpbmNsdWRpbmcsIGBlbmRgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIHVzZWQgaW5zdGVhZCBvZlxuICAgICAqIFtgQXJyYXkjc2xpY2VgXShodHRwczovL21kbi5pby9BcnJheS9zbGljZSkgdG8gZW5zdXJlIGRlbnNlIGFycmF5cyBhcmVcbiAgICAgKiByZXR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBpZiAoZW5kICYmIHR5cGVvZiBlbmQgIT0gJ251bWJlcicgJiYgaXNJdGVyYXRlZUNhbGwoYXJyYXksIHN0YXJ0LCBlbmQpKSB7XG4gICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgZW5kID0gbGVuZ3RoO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoc3RhcnQpO1xuICAgICAgICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IHRvSW50ZWdlcihlbmQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlcyBhIGJpbmFyeSBzZWFyY2ggdG8gZGV0ZXJtaW5lIHRoZSBsb3dlc3QgaW5kZXggYXQgd2hpY2ggYHZhbHVlYFxuICAgICAqIHNob3VsZCBiZSBpbnNlcnRlZCBpbnRvIGBhcnJheWAgaW4gb3JkZXIgdG8gbWFpbnRhaW4gaXRzIHNvcnQgb3JkZXIuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWRcbiAgICAgKiAgaW50byBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnNvcnRlZEluZGV4KFszMCwgNTBdLCA0MCk7XG4gICAgICogLy8gPT4gMVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIGJhc2VTb3J0ZWRJbmRleChhcnJheSwgdmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uc29ydGVkSW5kZXhgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYFxuICAgICAqIHdoaWNoIGlzIGludm9rZWQgZm9yIGB2YWx1ZWAgYW5kIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIHRvIGNvbXB1dGUgdGhlaXJcbiAgICAgKiBzb3J0IHJhbmtpbmcuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZFxuICAgICAqICBpbnRvIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiA0IH0sIHsgJ3gnOiA1IH1dO1xuICAgICAqXG4gICAgICogXy5zb3J0ZWRJbmRleEJ5KG9iamVjdHMsIHsgJ3gnOiA0IH0sIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8ueDsgfSk7XG4gICAgICogLy8gPT4gMFxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5zb3J0ZWRJbmRleEJ5KG9iamVjdHMsIHsgJ3gnOiA0IH0sICd4Jyk7XG4gICAgICogLy8gPT4gMFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvcnRlZEluZGV4QnkoYXJyYXksIHZhbHVlLCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmluZGV4T2ZgIGV4Y2VwdCB0aGF0IGl0IHBlcmZvcm1zIGEgYmluYXJ5XG4gICAgICogc2VhcmNoIG9uIGEgc29ydGVkIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc29ydGVkSW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpO1xuICAgICAqIC8vID0+IDFcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzb3J0ZWRJbmRleE9mKGFycmF5LCB2YWx1ZSkge1xuICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuICAgICAgaWYgKGxlbmd0aCkge1xuICAgICAgICB2YXIgaW5kZXggPSBiYXNlU29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKTtcbiAgICAgICAgaWYgKGluZGV4IDwgbGVuZ3RoICYmIGVxKGFycmF5W2luZGV4XSwgdmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5zb3J0ZWRJbmRleGAgZXhjZXB0IHRoYXQgaXQgcmV0dXJucyB0aGUgaGlnaGVzdFxuICAgICAqIGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0b1xuICAgICAqIG1haW50YWluIGl0cyBzb3J0IG9yZGVyLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkIGJlIGluc2VydGVkXG4gICAgICogIGludG8gYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zb3J0ZWRMYXN0SW5kZXgoWzQsIDUsIDUsIDUsIDZdLCA1KTtcbiAgICAgKiAvLyA9PiA0XG4gICAgICovXG4gICAgZnVuY3Rpb24gc29ydGVkTGFzdEluZGV4KGFycmF5LCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIGJhc2VTb3J0ZWRJbmRleChhcnJheSwgdmFsdWUsIHRydWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uc29ydGVkTGFzdEluZGV4YCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWBcbiAgICAgKiB3aGljaCBpcyBpbnZva2VkIGZvciBgdmFsdWVgIGFuZCBlYWNoIGVsZW1lbnQgb2YgYGFycmF5YCB0byBjb21wdXRlIHRoZWlyXG4gICAgICogc29ydCByYW5raW5nLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWRcbiAgICAgKiAgaW50byBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogNCB9LCB7ICd4JzogNSB9XTtcbiAgICAgKlxuICAgICAqIF8uc29ydGVkTGFzdEluZGV4Qnkob2JqZWN0cywgeyAneCc6IDQgfSwgZnVuY3Rpb24obykgeyByZXR1cm4gby54OyB9KTtcbiAgICAgKiAvLyA9PiAxXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnNvcnRlZExhc3RJbmRleEJ5KG9iamVjdHMsIHsgJ3gnOiA0IH0sICd4Jyk7XG4gICAgICogLy8gPT4gMVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvcnRlZExhc3RJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiBiYXNlU29ydGVkSW5kZXhCeShhcnJheSwgdmFsdWUsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5sYXN0SW5kZXhPZmAgZXhjZXB0IHRoYXQgaXQgcGVyZm9ybXMgYSBiaW5hcnlcbiAgICAgKiBzZWFyY2ggb24gYSBzb3J0ZWQgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zb3J0ZWRMYXN0SW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpO1xuICAgICAqIC8vID0+IDNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIGlmIChsZW5ndGgpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgdHJ1ZSkgLSAxO1xuICAgICAgICBpZiAoZXEoYXJyYXlbaW5kZXhdLCB2YWx1ZSkpIHtcbiAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaXFgIGV4Y2VwdCB0aGF0IGl0J3MgZGVzaWduZWQgYW5kIG9wdGltaXplZFxuICAgICAqIGZvciBzb3J0ZWQgYXJyYXlzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc29ydGVkVW5pcShbMSwgMSwgMl0pO1xuICAgICAqIC8vID0+IFsxLCAyXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvcnRlZFVuaXEoYXJyYXkpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VTb3J0ZWRVbmlxKGFycmF5KVxuICAgICAgICA6IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcUJ5YCBleGNlcHQgdGhhdCBpdCdzIGRlc2lnbmVkIGFuZCBvcHRpbWl6ZWRcbiAgICAgKiBmb3Igc29ydGVkIGFycmF5cy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc29ydGVkVW5pcUJ5KFsxLjEsIDEuMiwgMi4zLCAyLjRdLCBNYXRoLmZsb29yKTtcbiAgICAgKiAvLyA9PiBbMS4xLCAyLjNdXG4gICAgICovXG4gICAgZnVuY3Rpb24gc29ydGVkVW5pcUJ5KGFycmF5LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpXG4gICAgICAgID8gYmFzZVNvcnRlZFVuaXEoYXJyYXksIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSlcbiAgICAgICAgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGFsbCBidXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udGFpbChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IFsyLCAzXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRhaWwoYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIHJldHVybiBsZW5ndGggPyBiYXNlU2xpY2UoYXJyYXksIDEsIGxlbmd0aCkgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyB0YWtlbiBmcm9tIHRoZSBiZWdpbm5pbmcuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gdGFrZS5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50YWtlKFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gWzFdXG4gICAgICpcbiAgICAgKiBfLnRha2UoWzEsIDIsIDNdLCAyKTtcbiAgICAgKiAvLyA9PiBbMSwgMl1cbiAgICAgKlxuICAgICAqIF8udGFrZShbMSwgMiwgM10sIDUpO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqXG4gICAgICogXy50YWtlKFsxLCAyLCAzXSwgMCk7XG4gICAgICogLy8gPT4gW11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0YWtlKGFycmF5LCBuLCBndWFyZCkge1xuICAgICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBuID0gKGd1YXJkIHx8IG4gPT09IHVuZGVmaW5lZCkgPyAxIDogdG9JbnRlZ2VyKG4pO1xuICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgMCwgbiA8IDAgPyAwIDogbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBgbmAgZWxlbWVudHMgdGFrZW4gZnJvbSB0aGUgZW5kLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbj0xXSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIHRvIHRha2UuXG4gICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gWzNdXG4gICAgICpcbiAgICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10sIDIpO1xuICAgICAqIC8vID0+IFsyLCAzXVxuICAgICAqXG4gICAgICogXy50YWtlUmlnaHQoWzEsIDIsIDNdLCA1KTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICAgKlxuICAgICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSwgMCk7XG4gICAgICogLy8gPT4gW11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0YWtlUmlnaHQoYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBuID0gKGd1YXJkIHx8IG4gPT09IHVuZGVmaW5lZCkgPyAxIDogdG9JbnRlZ2VyKG4pO1xuICAgICAgbiA9IGxlbmd0aCAtIG47XG4gICAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCBuIDwgMCA/IDAgOiBuLCBsZW5ndGgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggZWxlbWVudHMgdGFrZW4gZnJvbSB0aGUgZW5kLiBFbGVtZW50cyBhcmVcbiAgICAgKiB0YWtlbiB1bnRpbCBgcHJlZGljYXRlYCByZXR1cm5zIGZhbHNleS4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkIHdpdGhcbiAgICAgKiB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSBbXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLnRha2VSaWdodFdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8udGFrZVJpZ2h0V2hpbGUodXNlcnMsICdhY3RpdmUnKTtcbiAgICAgKiAvLyA9PiBbXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRha2VSaWdodFdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgZmFsc2UsIHRydWUpXG4gICAgICAgIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBlbGVtZW50cyB0YWtlbiBmcm9tIHRoZSBiZWdpbm5pbmcuIEVsZW1lbnRzXG4gICAgICogYXJlIHRha2VuIHVudGlsIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzIGludm9rZWQgd2l0aFxuICAgICAqIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleCwgYXJyYXkpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiBmYWxzZSB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogdHJ1ZSB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8udGFrZVdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5JywgJ2ZyZWQnXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnRha2VXaGlsZSh1c2VycywgeyAndXNlcic6ICdiYXJuZXknLCAnYWN0aXZlJzogZmFsc2UgfSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8udGFrZVdoaWxlKHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknLCAnZnJlZCddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnRha2VXaGlsZSh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IFtdXG4gICAgICovXG4gICAgZnVuY3Rpb24gdGFrZVdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSlcbiAgICAgICAgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHVuaXF1ZSB2YWx1ZXMsIGluIG9yZGVyLCBmcm9tIGFsbCBnaXZlbiBhcnJheXMgdXNpbmdcbiAgICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKVxuICAgICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udW5pb24oWzJdLCBbMSwgMl0pO1xuICAgICAqIC8vID0+IFsyLCAxXVxuICAgICAqL1xuICAgIHZhciB1bmlvbiA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgcmV0dXJuIGJhc2VVbmlxKGJhc2VGbGF0dGVuKGFycmF5cywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pb25gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBlYWNoIGBhcnJheXNgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24gYnlcbiAgICAgKiB3aGljaCB1bmlxdWVuZXNzIGlzIGNvbXB1dGVkLiBSZXN1bHQgdmFsdWVzIGFyZSBjaG9zZW4gZnJvbSB0aGUgZmlyc3RcbiAgICAgKiBhcnJheSBpbiB3aGljaCB0aGUgdmFsdWUgb2NjdXJzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDpcbiAgICAgKiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udW5pb25CeShbMi4xXSwgWzEuMiwgMi4zXSwgTWF0aC5mbG9vcik7XG4gICAgICogLy8gPT4gWzIuMSwgMS4yXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy51bmlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpO1xuICAgICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XVxuICAgICAqL1xuICAgIHZhciB1bmlvbkJ5ID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7XG4gICAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KGFycmF5cyk7XG4gICAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7XG4gICAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VVbmlxKGJhc2VGbGF0dGVuKGFycmF5cywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy51bmlvbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY29tcGFyYXRvcmAgd2hpY2hcbiAgICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgZWxlbWVudHMgb2YgYGFycmF5c2AuIFJlc3VsdCB2YWx1ZXMgYXJlIGNob3NlbiBmcm9tXG4gICAgICogdGhlIGZpcnN0IGFycmF5IGluIHdoaWNoIHRoZSB2YWx1ZSBvY2N1cnMuIFRoZSBjb21wYXJhdG9yIGlzIGludm9rZWRcbiAgICAgKiB3aXRoIHR3byBhcmd1bWVudHM6IChhcnJWYWwsIG90aFZhbCkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgY29tYmluZWQgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07XG4gICAgICogdmFyIG90aGVycyA9IFt7ICd4JzogMSwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDIgfV07XG4gICAgICpcbiAgICAgKiBfLnVuaW9uV2l0aChvYmplY3RzLCBvdGhlcnMsIF8uaXNFcXVhbCk7XG4gICAgICogLy8gPT4gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9LCB7ICd4JzogMSwgJ3knOiAxIH1dXG4gICAgICovXG4gICAgdmFyIHVuaW9uV2l0aCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgdmFyIGNvbXBhcmF0b3IgPSBsYXN0KGFycmF5cyk7XG4gICAgICBjb21wYXJhdG9yID0gdHlwZW9mIGNvbXBhcmF0b3IgPT0gJ2Z1bmN0aW9uJyA/IGNvbXBhcmF0b3IgOiB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gYmFzZVVuaXEoYmFzZUZsYXR0ZW4oYXJyYXlzLCAxLCBpc0FycmF5TGlrZU9iamVjdCwgdHJ1ZSksIHVuZGVmaW5lZCwgY29tcGFyYXRvcik7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiBhbiBhcnJheSwgdXNpbmdcbiAgICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKVxuICAgICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucywgaW4gd2hpY2ggb25seSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBlYWNoIGVsZW1lbnRcbiAgICAgKiBpcyBrZXB0LiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBvcmRlciB0aGV5IG9jY3VyXG4gICAgICogaW4gdGhlIGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udW5pcShbMiwgMSwgMl0pO1xuICAgICAqIC8vID0+IFsyLCAxXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaXEoYXJyYXkpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5KSA6IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcWAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzXG4gICAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IGluIGBhcnJheWAgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieSB3aGljaFxuICAgICAqIHVuaXF1ZW5lc3MgaXMgY29tcHV0ZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQgYnkgdGhlXG4gICAgICogb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OlxuICAgICAqICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udW5pcUJ5KFsyLjEsIDEuMiwgMi4zXSwgTWF0aC5mbG9vcik7XG4gICAgICogLy8gPT4gWzIuMSwgMS4yXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy51bmlxQnkoW3sgJ3gnOiAxIH0sIHsgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpO1xuICAgICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaXFCeShhcnJheSwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy51bmlxYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYCB3aGljaFxuICAgICAqIGlzIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlgLiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpc1xuICAgICAqIGRldGVybWluZWQgYnkgdGhlIG9yZGVyIHRoZXkgb2NjdXIgaW4gdGhlIGFycmF5LlRoZSBjb21wYXJhdG9yIGlzIGludm9rZWRcbiAgICAgKiB3aXRoIHR3byBhcmd1bWVudHM6IChhcnJWYWwsIG90aFZhbCkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdHMgPSBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDIgfV07XG4gICAgICpcbiAgICAgKiBfLnVuaXFXaXRoKG9iamVjdHMsIF8uaXNFcXVhbCk7XG4gICAgICogLy8gPT4gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaXFXaXRoKGFycmF5LCBjb21wYXJhdG9yKSB7XG4gICAgICBjb21wYXJhdG9yID0gdHlwZW9mIGNvbXBhcmF0b3IgPT0gJ2Z1bmN0aW9uJyA/IGNvbXBhcmF0b3IgOiB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlVW5pcShhcnJheSwgdW5kZWZpbmVkLCBjb21wYXJhdG9yKSA6IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGFuIGFycmF5IG9mIGdyb3VwZWRcbiAgICAgKiBlbGVtZW50cyBhbmQgY3JlYXRlcyBhbiBhcnJheSByZWdyb3VwaW5nIHRoZSBlbGVtZW50cyB0byB0aGVpciBwcmUtemlwXG4gICAgICogY29uZmlndXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjIuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzIHRvIHByb2Nlc3MuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgcmVncm91cGVkIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgemlwcGVkID0gXy56aXAoWydhJywgJ2InXSwgWzEsIDJdLCBbdHJ1ZSwgZmFsc2VdKTtcbiAgICAgKiAvLyA9PiBbWydhJywgMSwgdHJ1ZV0sIFsnYicsIDIsIGZhbHNlXV1cbiAgICAgKlxuICAgICAqIF8udW56aXAoemlwcGVkKTtcbiAgICAgKiAvLyA9PiBbWydhJywgJ2InXSwgWzEsIDJdLCBbdHJ1ZSwgZmFsc2VdXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuemlwKGFycmF5KSB7XG4gICAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHZhciBsZW5ndGggPSAwO1xuICAgICAgYXJyYXkgPSBhcnJheUZpbHRlcihhcnJheSwgZnVuY3Rpb24oZ3JvdXApIHtcbiAgICAgICAgaWYgKGlzQXJyYXlMaWtlT2JqZWN0KGdyb3VwKSkge1xuICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChncm91cC5sZW5ndGgsIGxlbmd0aCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGJhc2VUaW1lcyhsZW5ndGgsIGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBhcnJheU1hcChhcnJheSwgYmFzZVByb3BlcnR5KGluZGV4KSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAgdG8gc3BlY2lmeVxuICAgICAqIGhvdyByZWdyb3VwZWQgdmFsdWVzIHNob3VsZCBiZSBjb21iaW5lZC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aGVcbiAgICAgKiBlbGVtZW50cyBvZiBlYWNoIGdyb3VwOiAoLi4uZ3JvdXApLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuOC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IG9mIGdyb3VwZWQgZWxlbWVudHMgdG8gcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmVcbiAgICAgKiAgcmVncm91cGVkIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZWdyb3VwZWQgZWxlbWVudHMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB6aXBwZWQgPSBfLnppcChbMSwgMl0sIFsxMCwgMjBdLCBbMTAwLCAyMDBdKTtcbiAgICAgKiAvLyA9PiBbWzEsIDEwLCAxMDBdLCBbMiwgMjAsIDIwMF1dXG4gICAgICpcbiAgICAgKiBfLnVuemlwV2l0aCh6aXBwZWQsIF8uYWRkKTtcbiAgICAgKiAvLyA9PiBbMywgMzAsIDMwMF1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bnppcFdpdGgoYXJyYXksIGl0ZXJhdGVlKSB7XG4gICAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSB1bnppcChhcnJheSk7XG4gICAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5TWFwKHJlc3VsdCwgZnVuY3Rpb24oZ3JvdXApIHtcbiAgICAgICAgcmV0dXJuIGFwcGx5KGl0ZXJhdGVlLCB1bmRlZmluZWQsIGdyb3VwKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgZXhjbHVkaW5nIGFsbCBnaXZlbiB2YWx1ZXMgdXNpbmdcbiAgICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKVxuICAgICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBVbmxpa2UgYF8ucHVsbGAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0gey4uLip9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuXG4gICAgICogQHNlZSBfLmRpZmZlcmVuY2UsIF8ueG9yXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ud2l0aG91dChbMiwgMSwgMiwgM10sIDEsIDIpO1xuICAgICAqIC8vID0+IFszXVxuICAgICAqL1xuICAgIHZhciB3aXRob3V0ID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXksIHZhbHVlcykge1xuICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0KGFycmF5KVxuICAgICAgICA/IGJhc2VEaWZmZXJlbmNlKGFycmF5LCB2YWx1ZXMpXG4gICAgICAgIDogW107XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHVuaXF1ZSB2YWx1ZXMgdGhhdCBpcyB0aGVcbiAgICAgKiBbc3ltbWV0cmljIGRpZmZlcmVuY2VdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1N5bW1ldHJpY19kaWZmZXJlbmNlKVxuICAgICAqIG9mIHRoZSBnaXZlbiBhcnJheXMuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQgYnkgdGhlIG9yZGVyXG4gICAgICogdGhleSBvY2N1ciBpbiB0aGUgYXJyYXlzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDIuNC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy5cbiAgICAgKiBAc2VlIF8uZGlmZmVyZW5jZSwgXy53aXRob3V0XG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ueG9yKFsyLCAxXSwgWzIsIDNdKTtcbiAgICAgKiAvLyA9PiBbMSwgM11cbiAgICAgKi9cbiAgICB2YXIgeG9yID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7XG4gICAgICByZXR1cm4gYmFzZVhvcihhcnJheUZpbHRlcihhcnJheXMsIGlzQXJyYXlMaWtlT2JqZWN0KSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnhvcmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzXG4gICAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieVxuICAgICAqIHdoaWNoIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWRcbiAgICAgKiBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXlzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZVxuICAgICAqIGFyZ3VtZW50OiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ueG9yQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7XG4gICAgICogLy8gPT4gWzEuMiwgMy40XVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy54b3JCeShbeyAneCc6IDEgfV0sIFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgJ3gnKTtcbiAgICAgKiAvLyA9PiBbeyAneCc6IDIgfV1cbiAgICAgKi9cbiAgICB2YXIgeG9yQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHtcbiAgICAgIHZhciBpdGVyYXRlZSA9IGxhc3QoYXJyYXlzKTtcbiAgICAgIGlmIChpc0FycmF5TGlrZU9iamVjdChpdGVyYXRlZSkpIHtcbiAgICAgICAgaXRlcmF0ZWUgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZVhvcihhcnJheUZpbHRlcihhcnJheXMsIGlzQXJyYXlMaWtlT2JqZWN0KSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ueG9yYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlzYC4gVGhlIG9yZGVyIG9mIHJlc3VsdCB2YWx1ZXMgaXNcbiAgICAgKiBkZXRlcm1pbmVkIGJ5IHRoZSBvcmRlciB0aGV5IG9jY3VyIGluIHRoZSBhcnJheXMuIFRoZSBjb21wYXJhdG9yIGlzIGludm9rZWRcbiAgICAgKiB3aXRoIHR3byBhcmd1bWVudHM6IChhcnJWYWwsIG90aFZhbCkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQXJyYXlcbiAgICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZmlsdGVyZWQgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07XG4gICAgICogdmFyIG90aGVycyA9IFt7ICd4JzogMSwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDIgfV07XG4gICAgICpcbiAgICAgKiBfLnhvcldpdGgob2JqZWN0cywgb3RoZXJzLCBfLmlzRXF1YWwpO1xuICAgICAqIC8vID0+IFt7ICd4JzogMiwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDEgfV1cbiAgICAgKi9cbiAgICB2YXIgeG9yV2l0aCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykge1xuICAgICAgdmFyIGNvbXBhcmF0b3IgPSBsYXN0KGFycmF5cyk7XG4gICAgICBjb21wYXJhdG9yID0gdHlwZW9mIGNvbXBhcmF0b3IgPT0gJ2Z1bmN0aW9uJyA/IGNvbXBhcmF0b3IgOiB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gYmFzZVhvcihhcnJheUZpbHRlcihhcnJheXMsIGlzQXJyYXlMaWtlT2JqZWN0KSwgdW5kZWZpbmVkLCBjb21wYXJhdG9yKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cywgdGhlIGZpcnN0IG9mIHdoaWNoIGNvbnRhaW5zIHRoZVxuICAgICAqIGZpcnN0IGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBhcnJheXMsIHRoZSBzZWNvbmQgb2Ygd2hpY2ggY29udGFpbnMgdGhlXG4gICAgICogc2Vjb25kIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBhcnJheXMsIGFuZCBzbyBvbi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBBcnJheVxuICAgICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gcHJvY2Vzcy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnppcChbJ2EnLCAnYiddLCBbMSwgMl0sIFt0cnVlLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IFtbJ2EnLCAxLCB0cnVlXSwgWydiJywgMiwgZmFsc2VdXVxuICAgICAqL1xuICAgIHZhciB6aXAgPSBiYXNlUmVzdCh1bnppcCk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZyb21QYWlyc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyB0d28gYXJyYXlzLFxuICAgICAqIG9uZSBvZiBwcm9wZXJ0eSBpZGVudGlmaWVycyBhbmQgb25lIG9mIGNvcnJlc3BvbmRpbmcgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuNC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BzPVtdXSBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMuXG4gICAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlcz1bXV0gVGhlIHByb3BlcnR5IHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnppcE9iamVjdChbJ2EnLCAnYiddLCBbMSwgMl0pO1xuICAgICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHppcE9iamVjdChwcm9wcywgdmFsdWVzKSB7XG4gICAgICByZXR1cm4gYmFzZVppcE9iamVjdChwcm9wcyB8fCBbXSwgdmFsdWVzIHx8IFtdLCBhc3NpZ25WYWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy56aXBPYmplY3RgIGV4Y2VwdCB0aGF0IGl0IHN1cHBvcnRzIHByb3BlcnR5IHBhdGhzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMS4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BzPVtdXSBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMuXG4gICAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlcz1bXV0gVGhlIHByb3BlcnR5IHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnppcE9iamVjdERlZXAoWydhLmJbMF0uYycsICdhLmJbMV0uZCddLCBbMSwgMl0pO1xuICAgICAqIC8vID0+IHsgJ2EnOiB7ICdiJzogW3sgJ2MnOiAxIH0sIHsgJ2QnOiAyIH1dIH0gfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHppcE9iamVjdERlZXAocHJvcHMsIHZhbHVlcykge1xuICAgICAgcmV0dXJuIGJhc2VaaXBPYmplY3QocHJvcHMgfHwgW10sIHZhbHVlcyB8fCBbXSwgYmFzZVNldCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy56aXBgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB0byBzcGVjaWZ5XG4gICAgICogaG93IGdyb3VwZWQgdmFsdWVzIHNob3VsZCBiZSBjb21iaW5lZC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aGVcbiAgICAgKiBlbGVtZW50cyBvZiBlYWNoIGdyb3VwOiAoLi4uZ3JvdXApLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuOC4wXG4gICAgICogQGNhdGVnb3J5IEFycmF5XG4gICAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBwcm9jZXNzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gdG8gY29tYmluZVxuICAgICAqICBncm91cGVkIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnppcFdpdGgoWzEsIDJdLCBbMTAsIDIwXSwgWzEwMCwgMjAwXSwgZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAqICAgcmV0dXJuIGEgKyBiICsgYztcbiAgICAgKiB9KTtcbiAgICAgKiAvLyA9PiBbMTExLCAyMjJdXG4gICAgICovXG4gICAgdmFyIHppcFdpdGggPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheXMubGVuZ3RoLFxuICAgICAgICAgIGl0ZXJhdGVlID0gbGVuZ3RoID4gMSA/IGFycmF5c1tsZW5ndGggLSAxXSA6IHVuZGVmaW5lZDtcblxuICAgICAgaXRlcmF0ZWUgPSB0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyA/IChhcnJheXMucG9wKCksIGl0ZXJhdGVlKSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiB1bnppcFdpdGgoYXJyYXlzLCBpdGVyYXRlZSk7XG4gICAgfSk7XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZSB0aGF0IHdyYXBzIGB2YWx1ZWAgd2l0aCBleHBsaWNpdCBtZXRob2RcbiAgICAgKiBjaGFpbiBzZXF1ZW5jZXMgZW5hYmxlZC4gVGhlIHJlc3VsdCBvZiBzdWNoIHNlcXVlbmNlcyBtdXN0IGJlIHVud3JhcHBlZFxuICAgICAqIHdpdGggYF8jdmFsdWVgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDEuMy4wXG4gICAgICogQGNhdGVnb3J5IFNlcVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBsb2Rhc2hgIHdyYXBwZXIgaW5zdGFuY2UuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhZ2UnOiAzNiB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FnZSc6IDQwIH0sXG4gICAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWdlJzogMSB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIHZhciB5b3VuZ2VzdCA9IF9cbiAgICAgKiAgIC5jaGFpbih1c2VycylcbiAgICAgKiAgIC5zb3J0QnkoJ2FnZScpXG4gICAgICogICAubWFwKGZ1bmN0aW9uKG8pIHtcbiAgICAgKiAgICAgcmV0dXJuIG8udXNlciArICcgaXMgJyArIG8uYWdlO1xuICAgICAqICAgfSlcbiAgICAgKiAgIC5oZWFkKClcbiAgICAgKiAgIC52YWx1ZSgpO1xuICAgICAqIC8vID0+ICdwZWJibGVzIGlzIDEnXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2hhaW4odmFsdWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSBsb2Rhc2godmFsdWUpO1xuICAgICAgcmVzdWx0Ll9fY2hhaW5fXyA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGludm9rZXMgYGludGVyY2VwdG9yYCBhbmQgcmV0dXJucyBgdmFsdWVgLiBUaGUgaW50ZXJjZXB0b3JcbiAgICAgKiBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OyAodmFsdWUpLiBUaGUgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0b1xuICAgICAqIFwidGFwIGludG9cIiBhIG1ldGhvZCBjaGFpbiBzZXF1ZW5jZSBpbiBvcmRlciB0byBtb2RpZnkgaW50ZXJtZWRpYXRlIHJlc3VsdHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgU2VxXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvdmlkZSB0byBgaW50ZXJjZXB0b3JgLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGludGVyY2VwdG9yIFRoZSBmdW5jdGlvbiB0byBpbnZva2UuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgYHZhbHVlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXyhbMSwgMiwgM10pXG4gICAgICogIC50YXAoZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgKiAgICAvLyBNdXRhdGUgaW5wdXQgYXJyYXkuXG4gICAgICogICAgYXJyYXkucG9wKCk7XG4gICAgICogIH0pXG4gICAgICogIC5yZXZlcnNlKClcbiAgICAgKiAgLnZhbHVlKCk7XG4gICAgICogLy8gPT4gWzIsIDFdXG4gICAgICovXG4gICAgZnVuY3Rpb24gdGFwKHZhbHVlLCBpbnRlcmNlcHRvcikge1xuICAgICAgaW50ZXJjZXB0b3IodmFsdWUpO1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udGFwYCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSByZXN1bHQgb2YgYGludGVyY2VwdG9yYC5cbiAgICAgKiBUaGUgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0byBcInBhc3MgdGhydVwiIHZhbHVlcyByZXBsYWNpbmcgaW50ZXJtZWRpYXRlXG4gICAgICogcmVzdWx0cyBpbiBhIG1ldGhvZCBjaGFpbiBzZXF1ZW5jZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBTZXFcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm92aWRlIHRvIGBpbnRlcmNlcHRvcmAuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaW50ZXJjZXB0b3IgVGhlIGZ1bmN0aW9uIHRvIGludm9rZS5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzdWx0IG9mIGBpbnRlcmNlcHRvcmAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8oJyAgYWJjICAnKVxuICAgICAqICAuY2hhaW4oKVxuICAgICAqICAudHJpbSgpXG4gICAgICogIC50aHJ1KGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICogICAgcmV0dXJuIFt2YWx1ZV07XG4gICAgICogIH0pXG4gICAgICogIC52YWx1ZSgpO1xuICAgICAqIC8vID0+IFsnYWJjJ11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0aHJ1KHZhbHVlLCBpbnRlcmNlcHRvcikge1xuICAgICAgcmV0dXJuIGludGVyY2VwdG9yKHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0aGUgd3JhcHBlciB2ZXJzaW9uIG9mIGBfLmF0YC5cbiAgICAgKlxuICAgICAqIEBuYW1lIGF0XG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMS4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU2VxXG4gICAgICogQHBhcmFtIHsuLi4oc3RyaW5nfHN0cmluZ1tdKX0gW3BhdGhzXSBUaGUgcHJvcGVydHkgcGF0aHMgdG8gcGljay5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfSwgNF0gfTtcbiAgICAgKlxuICAgICAqIF8ob2JqZWN0KS5hdChbJ2FbMF0uYi5jJywgJ2FbMV0nXSkudmFsdWUoKTtcbiAgICAgKiAvLyA9PiBbMywgNF1cbiAgICAgKi9cbiAgICB2YXIgd3JhcHBlckF0ID0gZmxhdFJlc3QoZnVuY3Rpb24ocGF0aHMpIHtcbiAgICAgIHZhciBsZW5ndGggPSBwYXRocy5sZW5ndGgsXG4gICAgICAgICAgc3RhcnQgPSBsZW5ndGggPyBwYXRoc1swXSA6IDAsXG4gICAgICAgICAgdmFsdWUgPSB0aGlzLl9fd3JhcHBlZF9fLFxuICAgICAgICAgIGludGVyY2VwdG9yID0gZnVuY3Rpb24ob2JqZWN0KSB7IHJldHVybiBiYXNlQXQob2JqZWN0LCBwYXRocyk7IH07XG5cbiAgICAgIGlmIChsZW5ndGggPiAxIHx8IHRoaXMuX19hY3Rpb25zX18ubGVuZ3RoIHx8XG4gICAgICAgICAgISh2YWx1ZSBpbnN0YW5jZW9mIExhenlXcmFwcGVyKSB8fCAhaXNJbmRleChzdGFydCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGhydShpbnRlcmNlcHRvcik7XG4gICAgICB9XG4gICAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKHN0YXJ0LCArc3RhcnQgKyAobGVuZ3RoID8gMSA6IDApKTtcbiAgICAgIHZhbHVlLl9fYWN0aW9uc19fLnB1c2goe1xuICAgICAgICAnZnVuYyc6IHRocnUsXG4gICAgICAgICdhcmdzJzogW2ludGVyY2VwdG9yXSxcbiAgICAgICAgJ3RoaXNBcmcnOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBMb2Rhc2hXcmFwcGVyKHZhbHVlLCB0aGlzLl9fY2hhaW5fXykudGhydShmdW5jdGlvbihhcnJheSkge1xuICAgICAgICBpZiAobGVuZ3RoICYmICFhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgICBhcnJheS5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZSB3aXRoIGV4cGxpY2l0IG1ldGhvZCBjaGFpbiBzZXF1ZW5jZXMgZW5hYmxlZC5cbiAgICAgKlxuICAgICAqIEBuYW1lIGNoYWluXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgU2VxXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBsb2Rhc2hgIHdyYXBwZXIgaW5zdGFuY2UuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2IH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIC8vIEEgc2VxdWVuY2Ugd2l0aG91dCBleHBsaWNpdCBjaGFpbmluZy5cbiAgICAgKiBfKHVzZXJzKS5oZWFkKCk7XG4gICAgICogLy8gPT4geyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYgfVxuICAgICAqXG4gICAgICogLy8gQSBzZXF1ZW5jZSB3aXRoIGV4cGxpY2l0IGNoYWluaW5nLlxuICAgICAqIF8odXNlcnMpXG4gICAgICogICAuY2hhaW4oKVxuICAgICAqICAgLmhlYWQoKVxuICAgICAqICAgLnBpY2soJ3VzZXInKVxuICAgICAqICAgLnZhbHVlKCk7XG4gICAgICogLy8gPT4geyAndXNlcic6ICdiYXJuZXknIH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3cmFwcGVyQ2hhaW4oKSB7XG4gICAgICByZXR1cm4gY2hhaW4odGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZXMgdGhlIGNoYWluIHNlcXVlbmNlIGFuZCByZXR1cm5zIHRoZSB3cmFwcGVkIHJlc3VsdC5cbiAgICAgKlxuICAgICAqIEBuYW1lIGNvbW1pdFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMi4wXG4gICAgICogQGNhdGVnb3J5IFNlcVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBgbG9kYXNoYCB3cmFwcGVyIGluc3RhbmNlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbMSwgMl07XG4gICAgICogdmFyIHdyYXBwZWQgPSBfKGFycmF5KS5wdXNoKDMpO1xuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsxLCAyXVxuICAgICAqXG4gICAgICogd3JhcHBlZCA9IHdyYXBwZWQuY29tbWl0KCk7XG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqXG4gICAgICogd3JhcHBlZC5sYXN0KCk7XG4gICAgICogLy8gPT4gM1xuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXkpO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHdyYXBwZXJDb21taXQoKSB7XG4gICAgICByZXR1cm4gbmV3IExvZGFzaFdyYXBwZXIodGhpcy52YWx1ZSgpLCB0aGlzLl9fY2hhaW5fXyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgbmV4dCB2YWx1ZSBvbiBhIHdyYXBwZWQgb2JqZWN0IGZvbGxvd2luZyB0aGVcbiAgICAgKiBbaXRlcmF0b3IgcHJvdG9jb2xdKGh0dHBzOi8vbWRuLmlvL2l0ZXJhdGlvbl9wcm90b2NvbHMjaXRlcmF0b3IpLlxuICAgICAqXG4gICAgICogQG5hbWUgbmV4dFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFNlcVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5leHQgaXRlcmF0b3IgdmFsdWUuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB3cmFwcGVkID0gXyhbMSwgMl0pO1xuICAgICAqXG4gICAgICogd3JhcHBlZC5uZXh0KCk7XG4gICAgICogLy8gPT4geyAnZG9uZSc6IGZhbHNlLCAndmFsdWUnOiAxIH1cbiAgICAgKlxuICAgICAqIHdyYXBwZWQubmV4dCgpO1xuICAgICAqIC8vID0+IHsgJ2RvbmUnOiBmYWxzZSwgJ3ZhbHVlJzogMiB9XG4gICAgICpcbiAgICAgKiB3cmFwcGVkLm5leHQoKTtcbiAgICAgKiAvLyA9PiB7ICdkb25lJzogdHJ1ZSwgJ3ZhbHVlJzogdW5kZWZpbmVkIH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3cmFwcGVyTmV4dCgpIHtcbiAgICAgIGlmICh0aGlzLl9fdmFsdWVzX18gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9fdmFsdWVzX18gPSB0b0FycmF5KHRoaXMudmFsdWUoKSk7XG4gICAgICB9XG4gICAgICB2YXIgZG9uZSA9IHRoaXMuX19pbmRleF9fID49IHRoaXMuX192YWx1ZXNfXy5sZW5ndGgsXG4gICAgICAgICAgdmFsdWUgPSBkb25lID8gdW5kZWZpbmVkIDogdGhpcy5fX3ZhbHVlc19fW3RoaXMuX19pbmRleF9fKytdO1xuXG4gICAgICByZXR1cm4geyAnZG9uZSc6IGRvbmUsICd2YWx1ZSc6IHZhbHVlIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5hYmxlcyB0aGUgd3JhcHBlciB0byBiZSBpdGVyYWJsZS5cbiAgICAgKlxuICAgICAqIEBuYW1lIFN5bWJvbC5pdGVyYXRvclxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFNlcVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIHdyYXBwZXIgb2JqZWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgd3JhcHBlZCA9IF8oWzEsIDJdKTtcbiAgICAgKlxuICAgICAqIHdyYXBwZWRbU3ltYm9sLml0ZXJhdG9yXSgpID09PSB3cmFwcGVkO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIEFycmF5LmZyb20od3JhcHBlZCk7XG4gICAgICogLy8gPT4gWzEsIDJdXG4gICAgICovXG4gICAgZnVuY3Rpb24gd3JhcHBlclRvSXRlcmF0b3IoKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGNoYWluIHNlcXVlbmNlIHBsYW50aW5nIGB2YWx1ZWAgYXMgdGhlIHdyYXBwZWQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAbmFtZSBwbGFudFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMi4wXG4gICAgICogQGNhdGVnb3J5IFNlcVxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHBsYW50LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBgbG9kYXNoYCB3cmFwcGVyIGluc3RhbmNlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBzcXVhcmUobikge1xuICAgICAqICAgcmV0dXJuIG4gKiBuO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIHZhciB3cmFwcGVkID0gXyhbMSwgMl0pLm1hcChzcXVhcmUpO1xuICAgICAqIHZhciBvdGhlciA9IHdyYXBwZWQucGxhbnQoWzMsIDRdKTtcbiAgICAgKlxuICAgICAqIG90aGVyLnZhbHVlKCk7XG4gICAgICogLy8gPT4gWzksIDE2XVxuICAgICAqXG4gICAgICogd3JhcHBlZC52YWx1ZSgpO1xuICAgICAqIC8vID0+IFsxLCA0XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHdyYXBwZXJQbGFudCh2YWx1ZSkge1xuICAgICAgdmFyIHJlc3VsdCxcbiAgICAgICAgICBwYXJlbnQgPSB0aGlzO1xuXG4gICAgICB3aGlsZSAocGFyZW50IGluc3RhbmNlb2YgYmFzZUxvZGFzaCkge1xuICAgICAgICB2YXIgY2xvbmUgPSB3cmFwcGVyQ2xvbmUocGFyZW50KTtcbiAgICAgICAgY2xvbmUuX19pbmRleF9fID0gMDtcbiAgICAgICAgY2xvbmUuX192YWx1ZXNfXyA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHByZXZpb3VzLl9fd3JhcHBlZF9fID0gY2xvbmU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ID0gY2xvbmU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHByZXZpb3VzID0gY2xvbmU7XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5fX3dyYXBwZWRfXztcbiAgICAgIH1cbiAgICAgIHByZXZpb3VzLl9fd3JhcHBlZF9fID0gdmFsdWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIHRoZSB3cmFwcGVyIHZlcnNpb24gb2YgYF8ucmV2ZXJzZWAuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgbXV0YXRlcyB0aGUgd3JhcHBlZCBhcnJheS5cbiAgICAgKlxuICAgICAqIEBuYW1lIHJldmVyc2VcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBTZXFcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdO1xuICAgICAqXG4gICAgICogXyhhcnJheSkucmV2ZXJzZSgpLnZhbHVlKClcbiAgICAgKiAvLyA9PiBbMywgMiwgMV1cbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKGFycmF5KTtcbiAgICAgKiAvLyA9PiBbMywgMiwgMV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3cmFwcGVyUmV2ZXJzZSgpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX193cmFwcGVkX187XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMYXp5V3JhcHBlcikge1xuICAgICAgICB2YXIgd3JhcHBlZCA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy5fX2FjdGlvbnNfXy5sZW5ndGgpIHtcbiAgICAgICAgICB3cmFwcGVkID0gbmV3IExhenlXcmFwcGVyKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHdyYXBwZWQgPSB3cmFwcGVkLnJldmVyc2UoKTtcbiAgICAgICAgd3JhcHBlZC5fX2FjdGlvbnNfXy5wdXNoKHtcbiAgICAgICAgICAnZnVuYyc6IHRocnUsXG4gICAgICAgICAgJ2FyZ3MnOiBbcmV2ZXJzZV0sXG4gICAgICAgICAgJ3RoaXNBcmcnOiB1bmRlZmluZWRcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBuZXcgTG9kYXNoV3JhcHBlcih3cmFwcGVkLCB0aGlzLl9fY2hhaW5fXyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy50aHJ1KHJldmVyc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGVzIHRoZSBjaGFpbiBzZXF1ZW5jZSB0byByZXNvbHZlIHRoZSB1bndyYXBwZWQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAbmFtZSB2YWx1ZVxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGFsaWFzIHRvSlNPTiwgdmFsdWVPZlxuICAgICAqIEBjYXRlZ29yeSBTZXFcbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdW53cmFwcGVkIHZhbHVlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfKFsxLCAyLCAzXSkudmFsdWUoKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3cmFwcGVyVmFsdWUoKSB7XG4gICAgICByZXR1cm4gYmFzZVdyYXBwZXJWYWx1ZSh0aGlzLl9fd3JhcHBlZF9fLCB0aGlzLl9fYWN0aW9uc19fKTtcbiAgICB9XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZiBrZXlzIGdlbmVyYXRlZCBmcm9tIHRoZSByZXN1bHRzIG9mIHJ1bm5pbmdcbiAgICAgKiBlYWNoIGVsZW1lbnQgb2YgYGNvbGxlY3Rpb25gIHRocnUgYGl0ZXJhdGVlYC4gVGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgb2ZcbiAgICAgKiBlYWNoIGtleSBpcyB0aGUgbnVtYmVyIG9mIHRpbWVzIHRoZSBrZXkgd2FzIHJldHVybmVkIGJ5IGBpdGVyYXRlZWAuIFRoZVxuICAgICAqIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC41LjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIHRvIHRyYW5zZm9ybSBrZXlzLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNvbXBvc2VkIGFnZ3JlZ2F0ZSBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uY291bnRCeShbNi4xLCA0LjIsIDYuM10sIE1hdGguZmxvb3IpO1xuICAgICAqIC8vID0+IHsgJzQnOiAxLCAnNic6IDIgfVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5jb3VudEJ5KFsnb25lJywgJ3R3bycsICd0aHJlZSddLCAnbGVuZ3RoJyk7XG4gICAgICogLy8gPT4geyAnMyc6IDIsICc1JzogMSB9XG4gICAgICovXG4gICAgdmFyIGNvdW50QnkgPSBjcmVhdGVBZ2dyZWdhdG9yKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCBrZXkpKSB7XG4gICAgICAgICsrcmVzdWx0W2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiYXNlQXNzaWduVmFsdWUocmVzdWx0LCBrZXksIDEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciAqKmFsbCoqIGVsZW1lbnRzIG9mIGBjb2xsZWN0aW9uYC5cbiAgICAgKiBJdGVyYXRpb24gaXMgc3RvcHBlZCBvbmNlIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzXG4gICAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIHJldHVybnMgYHRydWVgIGZvclxuICAgICAqIFtlbXB0eSBjb2xsZWN0aW9uc10oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRW1wdHlfc2V0KSBiZWNhdXNlXG4gICAgICogW2V2ZXJ5dGhpbmcgaXMgdHJ1ZV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmFjdW91c190cnV0aCkgb2ZcbiAgICAgKiBlbGVtZW50cyBvZiBlbXB0eSBjb2xsZWN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbGwgZWxlbWVudHMgcGFzcyB0aGUgcHJlZGljYXRlIGNoZWNrLFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZXZlcnkoW3RydWUsIDEsIG51bGwsICd5ZXMnXSwgQm9vbGVhbik7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM2LCAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FnZSc6IDQwLCAnYWN0aXZlJzogZmFsc2UgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZXZlcnkodXNlcnMsIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5ldmVyeSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZXZlcnkodXNlcnMsICdhY3RpdmUnKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGV2ZXJ5KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgZ3VhcmQpIHtcbiAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5RXZlcnkgOiBiYXNlRXZlcnk7XG4gICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBndWFyZCkpIHtcbiAgICAgICAgcHJlZGljYXRlID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZiBgY29sbGVjdGlvbmAsIHJldHVybmluZyBhbiBhcnJheSBvZiBhbGwgZWxlbWVudHNcbiAgICAgKiBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3IuIFRoZSBwcmVkaWNhdGUgaXMgaW52b2tlZCB3aXRoIHRocmVlXG4gICAgICogYXJndW1lbnRzOiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLnJlbW92ZWAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmlsdGVyZWQgYXJyYXkuXG4gICAgICogQHNlZSBfLnJlamVjdFxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSBbXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiwgJ2FjdGl2ZSc6IHRydWUgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FnZSc6IDQwLCAnYWN0aXZlJzogZmFsc2UgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLmZpbHRlcih1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gIW8uYWN0aXZlOyB9KTtcbiAgICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2ZyZWQnXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbHRlcih1c2VycywgeyAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5J11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbHRlcih1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbHRlcih1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5J11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaWx0ZXIoY29sbGVjdGlvbiwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheUZpbHRlciA6IGJhc2VGaWx0ZXI7XG4gICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mIGBjb2xsZWN0aW9uYCwgcmV0dXJuaW5nIHRoZSBmaXJzdCBlbGVtZW50XG4gICAgICogYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yLiBUaGUgcHJlZGljYXRlIGlzIGludm9rZWQgd2l0aCB0aHJlZVxuICAgICAqIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1hdGNoZWQgZWxlbWVudCwgZWxzZSBgdW5kZWZpbmVkYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHVzZXJzID0gW1xuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FnZSc6IDQwLCAnYWN0aXZlJzogZmFsc2UgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhZ2UnOiAxLCAgJ2FjdGl2ZSc6IHRydWUgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLmZpbmQodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8uYWdlIDwgNDA7IH0pO1xuICAgICAqIC8vID0+IG9iamVjdCBmb3IgJ2Jhcm5leSdcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maW5kKHVzZXJzLCB7ICdhZ2UnOiAxLCAnYWN0aXZlJzogdHJ1ZSB9KTtcbiAgICAgKiAvLyA9PiBvYmplY3QgZm9yICdwZWJibGVzJ1xuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZmluZCh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdCBmb3IgJ2ZyZWQnXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbmQodXNlcnMsICdhY3RpdmUnKTtcbiAgICAgKiAvLyA9PiBvYmplY3QgZm9yICdiYXJuZXknXG4gICAgICovXG4gICAgdmFyIGZpbmQgPSBjcmVhdGVGaW5kKGZpbmRJbmRleCk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRgIGV4Y2VwdCB0aGF0IGl0IGl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2ZcbiAgICAgKiBgY29sbGVjdGlvbmAgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDIuMC4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD1jb2xsZWN0aW9uLmxlbmd0aC0xXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1hdGNoZWQgZWxlbWVudCwgZWxzZSBgdW5kZWZpbmVkYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5maW5kTGFzdChbMSwgMiwgMywgNF0sIGZ1bmN0aW9uKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICUgMiA9PSAxO1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+IDNcbiAgICAgKi9cbiAgICB2YXIgZmluZExhc3QgPSBjcmVhdGVGaW5kKGZpbmRMYXN0SW5kZXgpO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZsYXR0ZW5lZCBhcnJheSBvZiB2YWx1ZXMgYnkgcnVubmluZyBlYWNoIGVsZW1lbnQgaW4gYGNvbGxlY3Rpb25gXG4gICAgICogdGhydSBgaXRlcmF0ZWVgIGFuZCBmbGF0dGVuaW5nIHRoZSBtYXBwZWQgcmVzdWx0cy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWRcbiAgICAgKiB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBkdXBsaWNhdGUobikge1xuICAgICAqICAgcmV0dXJuIFtuLCBuXTtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBfLmZsYXRNYXAoWzEsIDJdLCBkdXBsaWNhdGUpO1xuICAgICAqIC8vID0+IFsxLCAxLCAyLCAyXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXRNYXAoY29sbGVjdGlvbiwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiBiYXNlRmxhdHRlbihtYXAoY29sbGVjdGlvbiwgaXRlcmF0ZWUpLCAxKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZsYXRNYXBgIGV4Y2VwdCB0aGF0IGl0IHJlY3Vyc2l2ZWx5IGZsYXR0ZW5zIHRoZVxuICAgICAqIG1hcHBlZCByZXN1bHRzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNy4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBkdXBsaWNhdGUobikge1xuICAgICAqICAgcmV0dXJuIFtbW24sIG5dXV07XG4gICAgICogfVxuICAgICAqXG4gICAgICogXy5mbGF0TWFwRGVlcChbMSwgMl0sIGR1cGxpY2F0ZSk7XG4gICAgICogLy8gPT4gWzEsIDEsIDIsIDJdXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmxhdE1hcERlZXAoY29sbGVjdGlvbiwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiBiYXNlRmxhdHRlbihtYXAoY29sbGVjdGlvbiwgaXRlcmF0ZWUpLCBJTkZJTklUWSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5mbGF0TWFwYCBleGNlcHQgdGhhdCBpdCByZWN1cnNpdmVseSBmbGF0dGVucyB0aGVcbiAgICAgKiBtYXBwZWQgcmVzdWx0cyB1cCB0byBgZGVwdGhgIHRpbWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNy4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBkdXBsaWNhdGUobikge1xuICAgICAqICAgcmV0dXJuIFtbW24sIG5dXV07XG4gICAgICogfVxuICAgICAqXG4gICAgICogXy5mbGF0TWFwRGVwdGgoWzEsIDJdLCBkdXBsaWNhdGUsIDIpO1xuICAgICAqIC8vID0+IFtbMSwgMV0sIFsyLCAyXV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmbGF0TWFwRGVwdGgoY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGRlcHRoKSB7XG4gICAgICBkZXB0aCA9IGRlcHRoID09PSB1bmRlZmluZWQgPyAxIDogdG9JbnRlZ2VyKGRlcHRoKTtcbiAgICAgIHJldHVybiBiYXNlRmxhdHRlbihtYXAoY29sbGVjdGlvbiwgaXRlcmF0ZWUpLCBkZXB0aCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZiBgY29sbGVjdGlvbmAgYW5kIGludm9rZXMgYGl0ZXJhdGVlYCBmb3IgZWFjaCBlbGVtZW50LlxuICAgICAqIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuXG4gICAgICogSXRlcmF0ZWUgZnVuY3Rpb25zIG1heSBleGl0IGl0ZXJhdGlvbiBlYXJseSBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIEFzIHdpdGggb3RoZXIgXCJDb2xsZWN0aW9uc1wiIG1ldGhvZHMsIG9iamVjdHMgd2l0aCBhIFwibGVuZ3RoXCJcbiAgICAgKiBwcm9wZXJ0eSBhcmUgaXRlcmF0ZWQgbGlrZSBhcnJheXMuIFRvIGF2b2lkIHRoaXMgYmVoYXZpb3IgdXNlIGBfLmZvckluYFxuICAgICAqIG9yIGBfLmZvck93bmAgZm9yIG9iamVjdCBpdGVyYXRpb24uXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAYWxpYXMgZWFjaFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgYGNvbGxlY3Rpb25gLlxuICAgICAqIEBzZWUgXy5mb3JFYWNoUmlnaHRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5mb3JFYWNoKFsxLCAyXSwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKHZhbHVlKTtcbiAgICAgKiB9KTtcbiAgICAgKiAvLyA9PiBMb2dzIGAxYCB0aGVuIGAyYC5cbiAgICAgKlxuICAgICAqIF8uZm9yRWFjaCh7ICdhJzogMSwgJ2InOiAyIH0sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKGtleSk7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4gTG9ncyAnYScgdGhlbiAnYicgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9yRWFjaChjb2xsZWN0aW9uLCBpdGVyYXRlZSkge1xuICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlFYWNoIDogYmFzZUVhY2g7XG4gICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZm9yRWFjaGAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBlbGVtZW50cyBvZlxuICAgICAqIGBjb2xsZWN0aW9uYCBmcm9tIHJpZ2h0IHRvIGxlZnQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi4wLjBcbiAgICAgKiBAYWxpYXMgZWFjaFJpZ2h0XG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fE9iamVjdH0gUmV0dXJucyBgY29sbGVjdGlvbmAuXG4gICAgICogQHNlZSBfLmZvckVhY2hcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5mb3JFYWNoUmlnaHQoWzEsIDJdLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAqICAgY29uc29sZS5sb2codmFsdWUpO1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+IExvZ3MgYDJgIHRoZW4gYDFgLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvckVhY2hSaWdodChjb2xsZWN0aW9uLCBpdGVyYXRlZSkge1xuICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlFYWNoUmlnaHQgOiBiYXNlRWFjaFJpZ2h0O1xuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDMpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZiBrZXlzIGdlbmVyYXRlZCBmcm9tIHRoZSByZXN1bHRzIG9mIHJ1bm5pbmdcbiAgICAgKiBlYWNoIGVsZW1lbnQgb2YgYGNvbGxlY3Rpb25gIHRocnUgYGl0ZXJhdGVlYC4gVGhlIG9yZGVyIG9mIGdyb3VwZWQgdmFsdWVzXG4gICAgICogaXMgZGV0ZXJtaW5lZCBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiBgY29sbGVjdGlvbmAuIFRoZSBjb3JyZXNwb25kaW5nXG4gICAgICogdmFsdWUgb2YgZWFjaCBrZXkgaXMgYW4gYXJyYXkgb2YgZWxlbWVudHMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgdGhlXG4gICAgICoga2V5LiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgdG8gdHJhbnNmb3JtIGtleXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29tcG9zZWQgYWdncmVnYXRlIG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5ncm91cEJ5KFs2LjEsIDQuMiwgNi4zXSwgTWF0aC5mbG9vcik7XG4gICAgICogLy8gPT4geyAnNCc6IFs0LjJdLCAnNic6IFs2LjEsIDYuM10gfVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5ncm91cEJ5KFsnb25lJywgJ3R3bycsICd0aHJlZSddLCAnbGVuZ3RoJyk7XG4gICAgICogLy8gPT4geyAnMyc6IFsnb25lJywgJ3R3byddLCAnNSc6IFsndGhyZWUnXSB9XG4gICAgICovXG4gICAgdmFyIGdyb3VwQnkgPSBjcmVhdGVBZ2dyZWdhdG9yKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCBrZXkpKSB7XG4gICAgICAgIHJlc3VsdFtrZXldLnB1c2godmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmFzZUFzc2lnblZhbHVlKHJlc3VsdCwga2V5LCBbdmFsdWVdKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGluIGBjb2xsZWN0aW9uYC4gSWYgYGNvbGxlY3Rpb25gIGlzIGEgc3RyaW5nLCBpdCdzXG4gICAgICogY2hlY2tlZCBmb3IgYSBzdWJzdHJpbmcgb2YgYHZhbHVlYCwgb3RoZXJ3aXNlXG4gICAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybylcbiAgICAgKiBpcyB1c2VkIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4gSWYgYGZyb21JbmRleGAgaXMgbmVnYXRpdmUsIGl0J3MgdXNlZCBhc1xuICAgICAqIHRoZSBvZmZzZXQgZnJvbSB0aGUgZW5kIG9mIGBjb2xsZWN0aW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8c3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ucmVkdWNlYC5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBmb3VuZCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmluY2x1ZGVzKFsxLCAyLCAzXSwgMSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pbmNsdWRlcyhbMSwgMiwgM10sIDEsIDIpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmluY2x1ZGVzKHsgJ2EnOiAxLCAnYic6IDIgfSwgMSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pbmNsdWRlcygnYWJjZCcsICdiYycpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbmNsdWRlcyhjb2xsZWN0aW9uLCB2YWx1ZSwgZnJvbUluZGV4LCBndWFyZCkge1xuICAgICAgY29sbGVjdGlvbiA9IGlzQXJyYXlMaWtlKGNvbGxlY3Rpb24pID8gY29sbGVjdGlvbiA6IHZhbHVlcyhjb2xsZWN0aW9uKTtcbiAgICAgIGZyb21JbmRleCA9IChmcm9tSW5kZXggJiYgIWd1YXJkKSA/IHRvSW50ZWdlcihmcm9tSW5kZXgpIDogMDtcblxuICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoO1xuICAgICAgaWYgKGZyb21JbmRleCA8IDApIHtcbiAgICAgICAgZnJvbUluZGV4ID0gbmF0aXZlTWF4KGxlbmd0aCArIGZyb21JbmRleCwgMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXNTdHJpbmcoY29sbGVjdGlvbilcbiAgICAgICAgPyAoZnJvbUluZGV4IDw9IGxlbmd0aCAmJiBjb2xsZWN0aW9uLmluZGV4T2YodmFsdWUsIGZyb21JbmRleCkgPiAtMSlcbiAgICAgICAgOiAoISFsZW5ndGggJiYgYmFzZUluZGV4T2YoY29sbGVjdGlvbiwgdmFsdWUsIGZyb21JbmRleCkgPiAtMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW52b2tlcyB0aGUgbWV0aG9kIGF0IGBwYXRoYCBvZiBlYWNoIGVsZW1lbnQgaW4gYGNvbGxlY3Rpb25gLCByZXR1cm5pbmdcbiAgICAgKiBhbiBhcnJheSBvZiB0aGUgcmVzdWx0cyBvZiBlYWNoIGludm9rZWQgbWV0aG9kLiBBbnkgYWRkaXRpb25hbCBhcmd1bWVudHNcbiAgICAgKiBhcmUgcHJvdmlkZWQgdG8gZWFjaCBpbnZva2VkIG1ldGhvZC4gSWYgYHBhdGhgIGlzIGEgZnVuY3Rpb24sIGl0J3MgaW52b2tlZFxuICAgICAqIGZvciwgYW5kIGB0aGlzYCBib3VuZCB0bywgZWFjaCBlbGVtZW50IGluIGBjb2xsZWN0aW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7QXJyYXl8RnVuY3Rpb258c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBtZXRob2QgdG8gaW52b2tlIG9yXG4gICAgICogIHRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgZWFjaCBtZXRob2Qgd2l0aC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHJlc3VsdHMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaW52b2tlTWFwKFtbNSwgMSwgN10sIFszLCAyLCAxXV0sICdzb3J0Jyk7XG4gICAgICogLy8gPT4gW1sxLCA1LCA3XSwgWzEsIDIsIDNdXVxuICAgICAqXG4gICAgICogXy5pbnZva2VNYXAoWzEyMywgNDU2XSwgU3RyaW5nLnByb3RvdHlwZS5zcGxpdCwgJycpO1xuICAgICAqIC8vID0+IFtbJzEnLCAnMicsICczJ10sIFsnNCcsICc1JywgJzYnXV1cbiAgICAgKi9cbiAgICB2YXIgaW52b2tlTWFwID0gYmFzZVJlc3QoZnVuY3Rpb24oY29sbGVjdGlvbiwgcGF0aCwgYXJncykge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgaXNGdW5jID0gdHlwZW9mIHBhdGggPT0gJ2Z1bmN0aW9uJyxcbiAgICAgICAgICByZXN1bHQgPSBpc0FycmF5TGlrZShjb2xsZWN0aW9uKSA/IEFycmF5KGNvbGxlY3Rpb24ubGVuZ3RoKSA6IFtdO1xuXG4gICAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICByZXN1bHRbKytpbmRleF0gPSBpc0Z1bmMgPyBhcHBseShwYXRoLCB2YWx1ZSwgYXJncykgOiBiYXNlSW52b2tlKHZhbHVlLCBwYXRoLCBhcmdzKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIGtleXMgZ2VuZXJhdGVkIGZyb20gdGhlIHJlc3VsdHMgb2YgcnVubmluZ1xuICAgICAqIGVhY2ggZWxlbWVudCBvZiBgY29sbGVjdGlvbmAgdGhydSBgaXRlcmF0ZWVgLiBUaGUgY29ycmVzcG9uZGluZyB2YWx1ZSBvZlxuICAgICAqIGVhY2gga2V5IGlzIHRoZSBsYXN0IGVsZW1lbnQgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgdGhlIGtleS4gVGhlXG4gICAgICogaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgdG8gdHJhbnNmb3JtIGtleXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29tcG9zZWQgYWdncmVnYXRlIG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gW1xuICAgICAqICAgeyAnZGlyJzogJ2xlZnQnLCAnY29kZSc6IDk3IH0sXG4gICAgICogICB7ICdkaXInOiAncmlnaHQnLCAnY29kZSc6IDEwMCB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8ua2V5QnkoYXJyYXksIGZ1bmN0aW9uKG8pIHtcbiAgICAgKiAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG8uY29kZSk7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4geyAnYSc6IHsgJ2Rpcic6ICdsZWZ0JywgJ2NvZGUnOiA5NyB9LCAnZCc6IHsgJ2Rpcic6ICdyaWdodCcsICdjb2RlJzogMTAwIH0gfVxuICAgICAqXG4gICAgICogXy5rZXlCeShhcnJheSwgJ2RpcicpO1xuICAgICAqIC8vID0+IHsgJ2xlZnQnOiB7ICdkaXInOiAnbGVmdCcsICdjb2RlJzogOTcgfSwgJ3JpZ2h0JzogeyAnZGlyJzogJ3JpZ2h0JywgJ2NvZGUnOiAxMDAgfSB9XG4gICAgICovXG4gICAgdmFyIGtleUJ5ID0gY3JlYXRlQWdncmVnYXRvcihmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICAgIGJhc2VBc3NpZ25WYWx1ZShyZXN1bHQsIGtleSwgdmFsdWUpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB2YWx1ZXMgYnkgcnVubmluZyBlYWNoIGVsZW1lbnQgaW4gYGNvbGxlY3Rpb25gIHRocnVcbiAgICAgKiBgaXRlcmF0ZWVgLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czpcbiAgICAgKiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuXG4gICAgICpcbiAgICAgKiBNYW55IGxvZGFzaCBtZXRob2RzIGFyZSBndWFyZGVkIHRvIHdvcmsgYXMgaXRlcmF0ZWVzIGZvciBtZXRob2RzIGxpa2VcbiAgICAgKiBgXy5ldmVyeWAsIGBfLmZpbHRlcmAsIGBfLm1hcGAsIGBfLm1hcFZhbHVlc2AsIGBfLnJlamVjdGAsIGFuZCBgXy5zb21lYC5cbiAgICAgKlxuICAgICAqIFRoZSBndWFyZGVkIG1ldGhvZHMgYXJlOlxuICAgICAqIGBhcnlgLCBgY2h1bmtgLCBgY3VycnlgLCBgY3VycnlSaWdodGAsIGBkcm9wYCwgYGRyb3BSaWdodGAsIGBldmVyeWAsXG4gICAgICogYGZpbGxgLCBgaW52ZXJ0YCwgYHBhcnNlSW50YCwgYHJhbmRvbWAsIGByYW5nZWAsIGByYW5nZVJpZ2h0YCwgYHJlcGVhdGAsXG4gICAgICogYHNhbXBsZVNpemVgLCBgc2xpY2VgLCBgc29tZWAsIGBzb3J0QnlgLCBgc3BsaXRgLCBgdGFrZWAsIGB0YWtlUmlnaHRgLFxuICAgICAqIGB0ZW1wbGF0ZWAsIGB0cmltYCwgYHRyaW1FbmRgLCBgdHJpbVN0YXJ0YCwgYW5kIGB3b3Jkc2BcbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gc3F1YXJlKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICogbjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBfLm1hcChbNCwgOF0sIHNxdWFyZSk7XG4gICAgICogLy8gPT4gWzE2LCA2NF1cbiAgICAgKlxuICAgICAqIF8ubWFwKHsgJ2EnOiA0LCAnYic6IDggfSwgc3F1YXJlKTtcbiAgICAgKiAvLyA9PiBbMTYsIDY0XSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgICAqXG4gICAgICogdmFyIHVzZXJzID0gW1xuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnIH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5tYXAodXNlcnMsICd1c2VyJyk7XG4gICAgICogLy8gPT4gWydiYXJuZXknLCAnZnJlZCddXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheU1hcCA6IGJhc2VNYXA7XG4gICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uc29ydEJ5YCBleGNlcHQgdGhhdCBpdCBhbGxvd3Mgc3BlY2lmeWluZyB0aGUgc29ydFxuICAgICAqIG9yZGVycyBvZiB0aGUgaXRlcmF0ZWVzIHRvIHNvcnQgYnkuIElmIGBvcmRlcnNgIGlzIHVuc3BlY2lmaWVkLCBhbGwgdmFsdWVzXG4gICAgICogYXJlIHNvcnRlZCBpbiBhc2NlbmRpbmcgb3JkZXIuIE90aGVyd2lzZSwgc3BlY2lmeSBhbiBvcmRlciBvZiBcImRlc2NcIiBmb3JcbiAgICAgKiBkZXNjZW5kaW5nIG9yIFwiYXNjXCIgZm9yIGFzY2VuZGluZyBzb3J0IG9yZGVyIG9mIGNvcnJlc3BvbmRpbmcgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtBcnJheVtdfEZ1bmN0aW9uW118T2JqZWN0W118c3RyaW5nW119IFtpdGVyYXRlZXM9W18uaWRlbnRpdHldXVxuICAgICAqICBUaGUgaXRlcmF0ZWVzIHRvIHNvcnQgYnkuXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0gW29yZGVyc10gVGhlIHNvcnQgb3JkZXJzIG9mIGBpdGVyYXRlZXNgLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLnJlZHVjZWAuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgc29ydGVkIGFycmF5LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSBbXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0OCB9LFxuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzQgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FnZSc6IDQwIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIC8vIFNvcnQgYnkgYHVzZXJgIGluIGFzY2VuZGluZyBvcmRlciBhbmQgYnkgYGFnZWAgaW4gZGVzY2VuZGluZyBvcmRlci5cbiAgICAgKiBfLm9yZGVyQnkodXNlcnMsIFsndXNlcicsICdhZ2UnXSwgWydhc2MnLCAnZGVzYyddKTtcbiAgICAgKiAvLyA9PiBvYmplY3RzIGZvciBbWydiYXJuZXknLCAzNl0sIFsnYmFybmV5JywgMzRdLCBbJ2ZyZWQnLCA0OF0sIFsnZnJlZCcsIDQwXV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcmRlckJ5KGNvbGxlY3Rpb24sIGl0ZXJhdGVlcywgb3JkZXJzLCBndWFyZCkge1xuICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBpZiAoIWlzQXJyYXkoaXRlcmF0ZWVzKSkge1xuICAgICAgICBpdGVyYXRlZXMgPSBpdGVyYXRlZXMgPT0gbnVsbCA/IFtdIDogW2l0ZXJhdGVlc107XG4gICAgICB9XG4gICAgICBvcmRlcnMgPSBndWFyZCA/IHVuZGVmaW5lZCA6IG9yZGVycztcbiAgICAgIGlmICghaXNBcnJheShvcmRlcnMpKSB7XG4gICAgICAgIG9yZGVycyA9IG9yZGVycyA9PSBudWxsID8gW10gOiBbb3JkZXJzXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiYXNlT3JkZXJCeShjb2xsZWN0aW9uLCBpdGVyYXRlZXMsIG9yZGVycyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBlbGVtZW50cyBzcGxpdCBpbnRvIHR3byBncm91cHMsIHRoZSBmaXJzdCBvZiB3aGljaFxuICAgICAqIGNvbnRhaW5zIGVsZW1lbnRzIGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciwgdGhlIHNlY29uZCBvZiB3aGljaFxuICAgICAqIGNvbnRhaW5zIGVsZW1lbnRzIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5IGZvci4gVGhlIHByZWRpY2F0ZSBpc1xuICAgICAqIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSBbXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWdlJzogMzYsICdhY3RpdmUnOiBmYWxzZSB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FnZSc6IDQwLCAnYWN0aXZlJzogdHJ1ZSB9LFxuICAgICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FnZSc6IDEsICAnYWN0aXZlJzogZmFsc2UgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLnBhcnRpdGlvbih1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gby5hY3RpdmU7IH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFtbJ2ZyZWQnXSwgWydiYXJuZXknLCAncGViYmxlcyddXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnBhcnRpdGlvbih1c2VycywgeyAnYWdlJzogMSwgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFtbJ3BlYmJsZXMnXSwgWydiYXJuZXknLCAnZnJlZCddXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8ucGFydGl0aW9uKHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7XG4gICAgICogLy8gPT4gb2JqZWN0cyBmb3IgW1snYmFybmV5JywgJ3BlYmJsZXMnXSwgWydmcmVkJ11dXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnBhcnRpdGlvbih1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFtbJ2ZyZWQnXSwgWydiYXJuZXknLCAncGViYmxlcyddXVxuICAgICAqL1xuICAgIHZhciBwYXJ0aXRpb24gPSBjcmVhdGVBZ2dyZWdhdG9yKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgICAgcmVzdWx0W2tleSA/IDAgOiAxXS5wdXNoKHZhbHVlKTtcbiAgICB9LCBmdW5jdGlvbigpIHsgcmV0dXJuIFtbXSwgW11dOyB9KTtcblxuICAgIC8qKlxuICAgICAqIFJlZHVjZXMgYGNvbGxlY3Rpb25gIHRvIGEgdmFsdWUgd2hpY2ggaXMgdGhlIGFjY3VtdWxhdGVkIHJlc3VsdCBvZiBydW5uaW5nXG4gICAgICogZWFjaCBlbGVtZW50IGluIGBjb2xsZWN0aW9uYCB0aHJ1IGBpdGVyYXRlZWAsIHdoZXJlIGVhY2ggc3VjY2Vzc2l2ZVxuICAgICAqIGludm9jYXRpb24gaXMgc3VwcGxpZWQgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgcHJldmlvdXMuIElmIGBhY2N1bXVsYXRvcmBcbiAgICAgKiBpcyBub3QgZ2l2ZW4sIHRoZSBmaXJzdCBlbGVtZW50IG9mIGBjb2xsZWN0aW9uYCBpcyB1c2VkIGFzIHRoZSBpbml0aWFsXG4gICAgICogdmFsdWUuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggZm91ciBhcmd1bWVudHM6XG4gICAgICogKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICAgKlxuICAgICAqIE1hbnkgbG9kYXNoIG1ldGhvZHMgYXJlIGd1YXJkZWQgdG8gd29yayBhcyBpdGVyYXRlZXMgZm9yIG1ldGhvZHMgbGlrZVxuICAgICAqIGBfLnJlZHVjZWAsIGBfLnJlZHVjZVJpZ2h0YCwgYW5kIGBfLnRyYW5zZm9ybWAuXG4gICAgICpcbiAgICAgKiBUaGUgZ3VhcmRlZCBtZXRob2RzIGFyZTpcbiAgICAgKiBgYXNzaWduYCwgYGRlZmF1bHRzYCwgYGRlZmF1bHRzRGVlcGAsIGBpbmNsdWRlc2AsIGBtZXJnZWAsIGBvcmRlckJ5YCxcbiAgICAgKiBhbmQgYHNvcnRCeWBcbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEBwYXJhbSB7Kn0gW2FjY3VtdWxhdG9yXSBUaGUgaW5pdGlhbCB2YWx1ZS5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuXG4gICAgICogQHNlZSBfLnJlZHVjZVJpZ2h0XG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucmVkdWNlKFsxLCAyXSwgZnVuY3Rpb24oc3VtLCBuKSB7XG4gICAgICogICByZXR1cm4gc3VtICsgbjtcbiAgICAgKiB9LCAwKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICpcbiAgICAgKiBfLnJlZHVjZSh7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDEgfSwgZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7XG4gICAgICogICAocmVzdWx0W3ZhbHVlXSB8fCAocmVzdWx0W3ZhbHVlXSA9IFtdKSkucHVzaChrZXkpO1xuICAgICAqICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgKiB9LCB7fSk7XG4gICAgICogLy8gPT4geyAnMSc6IFsnYScsICdjJ10sICcyJzogWydiJ10gfSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlZHVjZShjb2xsZWN0aW9uLCBpdGVyYXRlZSwgYWNjdW11bGF0b3IpIHtcbiAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5UmVkdWNlIDogYmFzZVJlZHVjZSxcbiAgICAgICAgICBpbml0QWNjdW0gPSBhcmd1bWVudHMubGVuZ3RoIDwgMztcblxuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDQpLCBhY2N1bXVsYXRvciwgaW5pdEFjY3VtLCBiYXNlRWFjaCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5yZWR1Y2VgIGV4Y2VwdCB0aGF0IGl0IGl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2ZcbiAgICAgKiBgY29sbGVjdGlvbmAgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBpbml0aWFsIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS5cbiAgICAgKiBAc2VlIF8ucmVkdWNlXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBhcnJheSA9IFtbMCwgMV0sIFsyLCAzXSwgWzQsIDVdXTtcbiAgICAgKlxuICAgICAqIF8ucmVkdWNlUmlnaHQoYXJyYXksIGZ1bmN0aW9uKGZsYXR0ZW5lZCwgb3RoZXIpIHtcbiAgICAgKiAgIHJldHVybiBmbGF0dGVuZWQuY29uY2F0KG90aGVyKTtcbiAgICAgKiB9LCBbXSk7XG4gICAgICogLy8gPT4gWzQsIDUsIDIsIDMsIDAsIDFdXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVkdWNlUmlnaHQoY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheVJlZHVjZVJpZ2h0IDogYmFzZVJlZHVjZSxcbiAgICAgICAgICBpbml0QWNjdW0gPSBhcmd1bWVudHMubGVuZ3RoIDwgMztcblxuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDQpLCBhY2N1bXVsYXRvciwgaW5pdEFjY3VtLCBiYXNlRWFjaFJpZ2h0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8uZmlsdGVyYDsgdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZWxlbWVudHMgb2YgYGNvbGxlY3Rpb25gXG4gICAgICogdGhhdCBgcHJlZGljYXRlYCBkb2VzICoqbm90KiogcmV0dXJuIHRydXRoeSBmb3IuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmlsdGVyZWQgYXJyYXkuXG4gICAgICogQHNlZSBfLmZpbHRlclxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSBbXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiwgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IHRydWUgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLnJlamVjdCh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gIW8uYWN0aXZlOyB9KTtcbiAgICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2ZyZWQnXVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnJlamVjdCh1c2VycywgeyAnYWdlJzogNDAsICdhY3RpdmUnOiB0cnVlIH0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5J11cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnJlamVjdCh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCddXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnJlamVjdCh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5J11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWplY3QoY29sbGVjdGlvbiwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheUZpbHRlciA6IGJhc2VGaWx0ZXI7XG4gICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBuZWdhdGUoZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSByYW5kb20gZWxlbWVudCBmcm9tIGBjb2xsZWN0aW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAyLjAuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2FtcGxlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByYW5kb20gZWxlbWVudC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zYW1wbGUoWzEsIDIsIDMsIDRdKTtcbiAgICAgKiAvLyA9PiAyXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2FtcGxlKGNvbGxlY3Rpb24pIHtcbiAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5U2FtcGxlIDogYmFzZVNhbXBsZTtcbiAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYG5gIHJhbmRvbSBlbGVtZW50cyBhdCB1bmlxdWUga2V5cyBmcm9tIGBjb2xsZWN0aW9uYCB1cCB0byB0aGVcbiAgICAgKiBzaXplIG9mIGBjb2xsZWN0aW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2FtcGxlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbj0xXSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIHRvIHNhbXBsZS5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcmFuZG9tIGVsZW1lbnRzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnNhbXBsZVNpemUoWzEsIDIsIDNdLCAyKTtcbiAgICAgKiAvLyA9PiBbMywgMV1cbiAgICAgKlxuICAgICAqIF8uc2FtcGxlU2l6ZShbMSwgMiwgM10sIDQpO1xuICAgICAqIC8vID0+IFsyLCAzLCAxXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNhbXBsZVNpemUoY29sbGVjdGlvbiwgbiwgZ3VhcmQpIHtcbiAgICAgIGlmICgoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChjb2xsZWN0aW9uLCBuLCBndWFyZCkgOiBuID09PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIG4gPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbiA9IHRvSW50ZWdlcihuKTtcbiAgICAgIH1cbiAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5U2FtcGxlU2l6ZSA6IGJhc2VTYW1wbGVTaXplO1xuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBzaHVmZmxlZCB2YWx1ZXMsIHVzaW5nIGEgdmVyc2lvbiBvZiB0aGVcbiAgICAgKiBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Zpc2hlci1ZYXRlc19zaHVmZmxlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gc2h1ZmZsZS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBzaHVmZmxlZCBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zaHVmZmxlKFsxLCAyLCAzLCA0XSk7XG4gICAgICogLy8gPT4gWzQsIDEsIDMsIDJdXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2h1ZmZsZShjb2xsZWN0aW9uKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheVNodWZmbGUgOiBiYXNlU2h1ZmZsZTtcbiAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHNpemUgb2YgYGNvbGxlY3Rpb25gIGJ5IHJldHVybmluZyBpdHMgbGVuZ3RoIGZvciBhcnJheS1saWtlXG4gICAgICogdmFsdWVzIG9yIHRoZSBudW1iZXIgb2Ygb3duIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnRpZXMgZm9yIG9iamVjdHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpbnNwZWN0LlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbGxlY3Rpb24gc2l6ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zaXplKFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gM1xuICAgICAqXG4gICAgICogXy5zaXplKHsgJ2EnOiAxLCAnYic6IDIgfSk7XG4gICAgICogLy8gPT4gMlxuICAgICAqXG4gICAgICogXy5zaXplKCdwZWJibGVzJyk7XG4gICAgICogLy8gPT4gN1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpemUoY29sbGVjdGlvbikge1xuICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGlmIChpc0FycmF5TGlrZShjb2xsZWN0aW9uKSkge1xuICAgICAgICByZXR1cm4gaXNTdHJpbmcoY29sbGVjdGlvbikgPyBzdHJpbmdTaXplKGNvbGxlY3Rpb24pIDogY29sbGVjdGlvbi5sZW5ndGg7XG4gICAgICB9XG4gICAgICB2YXIgdGFnID0gZ2V0VGFnKGNvbGxlY3Rpb24pO1xuICAgICAgaWYgKHRhZyA9PSBtYXBUYWcgfHwgdGFnID09IHNldFRhZykge1xuICAgICAgICByZXR1cm4gY29sbGVjdGlvbi5zaXplO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VLZXlzKGNvbGxlY3Rpb24pLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yICoqYW55KiogZWxlbWVudCBvZiBgY29sbGVjdGlvbmAuXG4gICAgICogSXRlcmF0aW9uIGlzIHN0b3BwZWQgb25jZSBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeS4gVGhlIHByZWRpY2F0ZSBpc1xuICAgICAqIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjayxcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnNvbWUoW251bGwsIDAsICd5ZXMnLCBmYWxzZV0sIEJvb2xlYW4pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IHRydWUgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FjdGl2ZSc6IGZhbHNlIH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLnNvbWUodXNlcnMsIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FjdGl2ZSc6IGZhbHNlIH0pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5zb21lKHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5zb21lKHVzZXJzLCAnYWN0aXZlJyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvbWUoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBndWFyZCkge1xuICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlTb21lIDogYmFzZVNvbWU7XG4gICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBndWFyZCkpIHtcbiAgICAgICAgcHJlZGljYXRlID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBlbGVtZW50cywgc29ydGVkIGluIGFzY2VuZGluZyBvcmRlciBieSB0aGUgcmVzdWx0cyBvZlxuICAgICAqIHJ1bm5pbmcgZWFjaCBlbGVtZW50IGluIGEgY29sbGVjdGlvbiB0aHJ1IGVhY2ggaXRlcmF0ZWUuIFRoaXMgbWV0aG9kXG4gICAgICogcGVyZm9ybXMgYSBzdGFibGUgc29ydCwgdGhhdCBpcywgaXQgcHJlc2VydmVzIHRoZSBvcmlnaW5hbCBzb3J0IG9yZGVyIG9mXG4gICAgICogZXF1YWwgZWxlbWVudHMuIFRoZSBpdGVyYXRlZXMgYXJlIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0gey4uLihGdW5jdGlvbnxGdW5jdGlvbltdKX0gW2l0ZXJhdGVlcz1bXy5pZGVudGl0eV1dXG4gICAgICogIFRoZSBpdGVyYXRlZXMgdG8gc29ydCBieS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBzb3J0ZWQgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB1c2VycyA9IFtcbiAgICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgJ2FnZSc6IDQ4IH0sXG4gICAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICdhZ2UnOiAzNiB9LFxuICAgICAqICAgeyAndXNlcic6ICdmcmVkJywgICAnYWdlJzogNDAgfSxcbiAgICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgJ2FnZSc6IDM0IH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogXy5zb3J0QnkodXNlcnMsIFtmdW5jdGlvbihvKSB7IHJldHVybiBvLnVzZXI7IH1dKTtcbiAgICAgKiAvLyA9PiBvYmplY3RzIGZvciBbWydiYXJuZXknLCAzNl0sIFsnYmFybmV5JywgMzRdLCBbJ2ZyZWQnLCA0OF0sIFsnZnJlZCcsIDQwXV1cbiAgICAgKlxuICAgICAqIF8uc29ydEJ5KHVzZXJzLCBbJ3VzZXInLCAnYWdlJ10pO1xuICAgICAqIC8vID0+IG9iamVjdHMgZm9yIFtbJ2Jhcm5leScsIDM0XSwgWydiYXJuZXknLCAzNl0sIFsnZnJlZCcsIDQwXSwgWydmcmVkJywgNDhdXVxuICAgICAqL1xuICAgIHZhciBzb3J0QnkgPSBiYXNlUmVzdChmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZXMpIHtcbiAgICAgIGlmIChjb2xsZWN0aW9uID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgdmFyIGxlbmd0aCA9IGl0ZXJhdGVlcy5sZW5ndGg7XG4gICAgICBpZiAobGVuZ3RoID4gMSAmJiBpc0l0ZXJhdGVlQ2FsbChjb2xsZWN0aW9uLCBpdGVyYXRlZXNbMF0sIGl0ZXJhdGVlc1sxXSkpIHtcbiAgICAgICAgaXRlcmF0ZWVzID0gW107XG4gICAgICB9IGVsc2UgaWYgKGxlbmd0aCA+IDIgJiYgaXNJdGVyYXRlZUNhbGwoaXRlcmF0ZWVzWzBdLCBpdGVyYXRlZXNbMV0sIGl0ZXJhdGVlc1syXSkpIHtcbiAgICAgICAgaXRlcmF0ZWVzID0gW2l0ZXJhdGVlc1swXV07XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZU9yZGVyQnkoY29sbGVjdGlvbiwgYmFzZUZsYXR0ZW4oaXRlcmF0ZWVzLCAxKSwgW10pO1xuICAgIH0pO1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgdGltZXN0YW1wIG9mIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgaGF2ZSBlbGFwc2VkIHNpbmNlXG4gICAgICogdGhlIFVuaXggZXBvY2ggKDEgSmFudWFyeSAxOTcwIDAwOjAwOjAwIFVUQykuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi40LjBcbiAgICAgKiBAY2F0ZWdvcnkgRGF0ZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHRpbWVzdGFtcC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5kZWZlcihmdW5jdGlvbihzdGFtcCkge1xuICAgICAqICAgY29uc29sZS5sb2coXy5ub3coKSAtIHN0YW1wKTtcbiAgICAgKiB9LCBfLm5vdygpKTtcbiAgICAgKiAvLyA9PiBMb2dzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGl0IHRvb2sgZm9yIHRoZSBkZWZlcnJlZCBpbnZvY2F0aW9uLlxuICAgICAqL1xuICAgIHZhciBub3cgPSBjdHhOb3cgfHwgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcm9vdC5EYXRlLm5vdygpO1xuICAgIH07XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8uYmVmb3JlYDsgdGhpcyBtZXRob2QgY3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlc1xuICAgICAqIGBmdW5jYCBvbmNlIGl0J3MgY2FsbGVkIGBuYCBvciBtb3JlIHRpbWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiBjYWxscyBiZWZvcmUgYGZ1bmNgIGlzIGludm9rZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcmVzdHJpY3QuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcmVzdHJpY3RlZCBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHNhdmVzID0gWydwcm9maWxlJywgJ3NldHRpbmdzJ107XG4gICAgICpcbiAgICAgKiB2YXIgZG9uZSA9IF8uYWZ0ZXIoc2F2ZXMubGVuZ3RoLCBmdW5jdGlvbigpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKCdkb25lIHNhdmluZyEnKTtcbiAgICAgKiB9KTtcbiAgICAgKlxuICAgICAqIF8uZm9yRWFjaChzYXZlcywgZnVuY3Rpb24odHlwZSkge1xuICAgICAqICAgYXN5bmNTYXZlKHsgJ3R5cGUnOiB0eXBlLCAnY29tcGxldGUnOiBkb25lIH0pO1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+IExvZ3MgJ2RvbmUgc2F2aW5nIScgYWZ0ZXIgdGhlIHR3byBhc3luYyBzYXZlcyBoYXZlIGNvbXBsZXRlZC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZnRlcihuLCBmdW5jKSB7XG4gICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gICAgICB9XG4gICAgICBuID0gdG9JbnRlZ2VyKG4pO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoLS1uIDwgMSkge1xuICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2AsIHdpdGggdXAgdG8gYG5gIGFyZ3VtZW50cyxcbiAgICAgKiBpZ25vcmluZyBhbnkgYWRkaXRpb25hbCBhcmd1bWVudHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYXAgYXJndW1lbnRzIGZvci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249ZnVuYy5sZW5ndGhdIFRoZSBhcml0eSBjYXAuXG4gICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjYXBwZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ubWFwKFsnNicsICc4JywgJzEwJ10sIF8uYXJ5KHBhcnNlSW50LCAxKSk7XG4gICAgICogLy8gPT4gWzYsIDgsIDEwXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFyeShmdW5jLCBuLCBndWFyZCkge1xuICAgICAgbiA9IGd1YXJkID8gdW5kZWZpbmVkIDogbjtcbiAgICAgIG4gPSAoZnVuYyAmJiBuID09IG51bGwpID8gZnVuYy5sZW5ndGggOiBuO1xuICAgICAgcmV0dXJuIGNyZWF0ZVdyYXAoZnVuYywgV1JBUF9BUllfRkxBRywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBuKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCwgd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgYW5kIGFyZ3VtZW50c1xuICAgICAqIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLCB3aGlsZSBpdCdzIGNhbGxlZCBsZXNzIHRoYW4gYG5gIHRpbWVzLiBTdWJzZXF1ZW50XG4gICAgICogY2FsbHMgdG8gdGhlIGNyZWF0ZWQgZnVuY3Rpb24gcmV0dXJuIHRoZSByZXN1bHQgb2YgdGhlIGxhc3QgYGZ1bmNgIGludm9jYXRpb24uXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIGNhbGxzIGF0IHdoaWNoIGBmdW5jYCBpcyBubyBsb25nZXIgaW52b2tlZC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byByZXN0cmljdC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyByZXN0cmljdGVkIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBqUXVlcnkoZWxlbWVudCkub24oJ2NsaWNrJywgXy5iZWZvcmUoNSwgYWRkQ29udGFjdFRvTGlzdCkpO1xuICAgICAqIC8vID0+IEFsbG93cyBhZGRpbmcgdXAgdG8gNCBjb250YWN0cyB0byB0aGUgbGlzdC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBiZWZvcmUobiwgZnVuYykge1xuICAgICAgdmFyIHJlc3VsdDtcbiAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgICAgIH1cbiAgICAgIG4gPSB0b0ludGVnZXIobik7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgtLW4gPiAwKSB7XG4gICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuIDw9IDEpIHtcbiAgICAgICAgICBmdW5jID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIGB0aGlzQXJnYFxuICAgICAqIGFuZCBgcGFydGlhbHNgIHByZXBlbmRlZCB0byB0aGUgYXJndW1lbnRzIGl0IHJlY2VpdmVzLlxuICAgICAqXG4gICAgICogVGhlIGBfLmJpbmQucGxhY2Vob2xkZXJgIHZhbHVlLCB3aGljaCBkZWZhdWx0cyB0byBgX2AgaW4gbW9ub2xpdGhpYyBidWlsZHMsXG4gICAgICogbWF5IGJlIHVzZWQgYXMgYSBwbGFjZWhvbGRlciBmb3IgcGFydGlhbGx5IGFwcGxpZWQgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFVubGlrZSBuYXRpdmUgYEZ1bmN0aW9uI2JpbmRgLCB0aGlzIG1ldGhvZCBkb2Vzbid0IHNldCB0aGUgXCJsZW5ndGhcIlxuICAgICAqIHByb3BlcnR5IG9mIGJvdW5kIGZ1bmN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvblxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGJpbmQuXG4gICAgICogQHBhcmFtIHsqfSB0aGlzQXJnIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYm91bmQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGdyZWV0KGdyZWV0aW5nLCBwdW5jdHVhdGlvbikge1xuICAgICAqICAgcmV0dXJuIGdyZWV0aW5nICsgJyAnICsgdGhpcy51c2VyICsgcHVuY3R1YXRpb247XG4gICAgICogfVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ3VzZXInOiAnZnJlZCcgfTtcbiAgICAgKlxuICAgICAqIHZhciBib3VuZCA9IF8uYmluZChncmVldCwgb2JqZWN0LCAnaGknKTtcbiAgICAgKiBib3VuZCgnIScpO1xuICAgICAqIC8vID0+ICdoaSBmcmVkISdcbiAgICAgKlxuICAgICAqIC8vIEJvdW5kIHdpdGggcGxhY2Vob2xkZXJzLlxuICAgICAqIHZhciBib3VuZCA9IF8uYmluZChncmVldCwgb2JqZWN0LCBfLCAnIScpO1xuICAgICAqIGJvdW5kKCdoaScpO1xuICAgICAqIC8vID0+ICdoaSBmcmVkISdcbiAgICAgKi9cbiAgICB2YXIgYmluZCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGZ1bmMsIHRoaXNBcmcsIHBhcnRpYWxzKSB7XG4gICAgICB2YXIgYml0bWFzayA9IFdSQVBfQklORF9GTEFHO1xuICAgICAgaWYgKHBhcnRpYWxzLmxlbmd0aCkge1xuICAgICAgICB2YXIgaG9sZGVycyA9IHJlcGxhY2VIb2xkZXJzKHBhcnRpYWxzLCBnZXRIb2xkZXIoYmluZCkpO1xuICAgICAgICBiaXRtYXNrIHw9IFdSQVBfUEFSVElBTF9GTEFHO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNyZWF0ZVdyYXAoZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMsIGhvbGRlcnMpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyB0aGUgbWV0aG9kIGF0IGBvYmplY3Rba2V5XWAgd2l0aCBgcGFydGlhbHNgXG4gICAgICogcHJlcGVuZGVkIHRvIHRoZSBhcmd1bWVudHMgaXQgcmVjZWl2ZXMuXG4gICAgICpcbiAgICAgKiBUaGlzIG1ldGhvZCBkaWZmZXJzIGZyb20gYF8uYmluZGAgYnkgYWxsb3dpbmcgYm91bmQgZnVuY3Rpb25zIHRvIHJlZmVyZW5jZVxuICAgICAqIG1ldGhvZHMgdGhhdCBtYXkgYmUgcmVkZWZpbmVkIG9yIGRvbid0IHlldCBleGlzdC4gU2VlXG4gICAgICogW1BldGVyIE1pY2hhdXgncyBhcnRpY2xlXShodHRwOi8vcGV0ZXIubWljaGF1eC5jYS9hcnRpY2xlcy9sYXp5LWZ1bmN0aW9uLWRlZmluaXRpb24tcGF0dGVybilcbiAgICAgKiBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAqXG4gICAgICogVGhlIGBfLmJpbmRLZXkucGxhY2Vob2xkZXJgIHZhbHVlLCB3aGljaCBkZWZhdWx0cyB0byBgX2AgaW4gbW9ub2xpdGhpY1xuICAgICAqIGJ1aWxkcywgbWF5IGJlIHVzZWQgYXMgYSBwbGFjZWhvbGRlciBmb3IgcGFydGlhbGx5IGFwcGxpZWQgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMTAuMFxuICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvblxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnZva2UgdGhlIG1ldGhvZCBvbi5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIG1ldGhvZC5cbiAgICAgKiBAcGFyYW0gey4uLip9IFtwYXJ0aWFsc10gVGhlIGFyZ3VtZW50cyB0byBiZSBwYXJ0aWFsbHkgYXBwbGllZC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBib3VuZCBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHtcbiAgICAgKiAgICd1c2VyJzogJ2ZyZWQnLFxuICAgICAqICAgJ2dyZWV0JzogZnVuY3Rpb24oZ3JlZXRpbmcsIHB1bmN0dWF0aW9uKSB7XG4gICAgICogICAgIHJldHVybiBncmVldGluZyArICcgJyArIHRoaXMudXNlciArIHB1bmN0dWF0aW9uO1xuICAgICAqICAgfVxuICAgICAqIH07XG4gICAgICpcbiAgICAgKiB2YXIgYm91bmQgPSBfLmJpbmRLZXkob2JqZWN0LCAnZ3JlZXQnLCAnaGknKTtcbiAgICAgKiBib3VuZCgnIScpO1xuICAgICAqIC8vID0+ICdoaSBmcmVkISdcbiAgICAgKlxuICAgICAqIG9iamVjdC5ncmVldCA9IGZ1bmN0aW9uKGdyZWV0aW5nLCBwdW5jdHVhdGlvbikge1xuICAgICAqICAgcmV0dXJuIGdyZWV0aW5nICsgJ3lhICcgKyB0aGlzLnVzZXIgKyBwdW5jdHVhdGlvbjtcbiAgICAgKiB9O1xuICAgICAqXG4gICAgICogYm91bmQoJyEnKTtcbiAgICAgKiAvLyA9PiAnaGl5YSBmcmVkISdcbiAgICAgKlxuICAgICAqIC8vIEJvdW5kIHdpdGggcGxhY2Vob2xkZXJzLlxuICAgICAqIHZhciBib3VuZCA9IF8uYmluZEtleShvYmplY3QsICdncmVldCcsIF8sICchJyk7XG4gICAgICogYm91bmQoJ2hpJyk7XG4gICAgICogLy8gPT4gJ2hpeWEgZnJlZCEnXG4gICAgICovXG4gICAgdmFyIGJpbmRLZXkgPSBiYXNlUmVzdChmdW5jdGlvbihvYmplY3QsIGtleSwgcGFydGlhbHMpIHtcbiAgICAgIHZhciBiaXRtYXNrID0gV1JBUF9CSU5EX0ZMQUcgfCBXUkFQX0JJTkRfS0VZX0ZMQUc7XG4gICAgICBpZiAocGFydGlhbHMubGVuZ3RoKSB7XG4gICAgICAgIHZhciBob2xkZXJzID0gcmVwbGFjZUhvbGRlcnMocGFydGlhbHMsIGdldEhvbGRlcihiaW5kS2V5KSk7XG4gICAgICAgIGJpdG1hc2sgfD0gV1JBUF9QQVJUSUFMX0ZMQUc7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3JlYXRlV3JhcChrZXksIGJpdG1hc2ssIG9iamVjdCwgcGFydGlhbHMsIGhvbGRlcnMpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBhcmd1bWVudHMgb2YgYGZ1bmNgIGFuZCBlaXRoZXIgaW52b2tlc1xuICAgICAqIGBmdW5jYCByZXR1cm5pbmcgaXRzIHJlc3VsdCwgaWYgYXQgbGVhc3QgYGFyaXR5YCBudW1iZXIgb2YgYXJndW1lbnRzIGhhdmVcbiAgICAgKiBiZWVuIHByb3ZpZGVkLCBvciByZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIHRoZSByZW1haW5pbmcgYGZ1bmNgXG4gICAgICogYXJndW1lbnRzLCBhbmQgc28gb24uIFRoZSBhcml0eSBvZiBgZnVuY2AgbWF5IGJlIHNwZWNpZmllZCBpZiBgZnVuYy5sZW5ndGhgXG4gICAgICogaXMgbm90IHN1ZmZpY2llbnQuXG4gICAgICpcbiAgICAgKiBUaGUgYF8uY3VycnkucGxhY2Vob2xkZXJgIHZhbHVlLCB3aGljaCBkZWZhdWx0cyB0byBgX2AgaW4gbW9ub2xpdGhpYyBidWlsZHMsXG4gICAgICogbWF5IGJlIHVzZWQgYXMgYSBwbGFjZWhvbGRlciBmb3IgcHJvdmlkZWQgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGRvZXNuJ3Qgc2V0IHRoZSBcImxlbmd0aFwiIHByb3BlcnR5IG9mIGN1cnJpZWQgZnVuY3Rpb25zLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDIuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY3VycnkuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eT1mdW5jLmxlbmd0aF0gVGhlIGFyaXR5IG9mIGBmdW5jYC5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGN1cnJpZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBhYmMgPSBmdW5jdGlvbihhLCBiLCBjKSB7XG4gICAgICogICByZXR1cm4gW2EsIGIsIGNdO1xuICAgICAqIH07XG4gICAgICpcbiAgICAgKiB2YXIgY3VycmllZCA9IF8uY3VycnkoYWJjKTtcbiAgICAgKlxuICAgICAqIGN1cnJpZWQoMSkoMikoMyk7XG4gICAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAgICpcbiAgICAgKiBjdXJyaWVkKDEsIDIpKDMpO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqXG4gICAgICogY3VycmllZCgxLCAyLCAzKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICAgKlxuICAgICAqIC8vIEN1cnJpZWQgd2l0aCBwbGFjZWhvbGRlcnMuXG4gICAgICogY3VycmllZCgxKShfLCAzKSgyKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjdXJyeShmdW5jLCBhcml0eSwgZ3VhcmQpIHtcbiAgICAgIGFyaXR5ID0gZ3VhcmQgPyB1bmRlZmluZWQgOiBhcml0eTtcbiAgICAgIHZhciByZXN1bHQgPSBjcmVhdGVXcmFwKGZ1bmMsIFdSQVBfQ1VSUllfRkxBRywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGFyaXR5KTtcbiAgICAgIHJlc3VsdC5wbGFjZWhvbGRlciA9IGN1cnJ5LnBsYWNlaG9sZGVyO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmN1cnJ5YCBleGNlcHQgdGhhdCBhcmd1bWVudHMgYXJlIGFwcGxpZWQgdG8gYGZ1bmNgXG4gICAgICogaW4gdGhlIG1hbm5lciBvZiBgXy5wYXJ0aWFsUmlnaHRgIGluc3RlYWQgb2YgYF8ucGFydGlhbGAuXG4gICAgICpcbiAgICAgKiBUaGUgYF8uY3VycnlSaWdodC5wbGFjZWhvbGRlcmAgdmFsdWUsIHdoaWNoIGRlZmF1bHRzIHRvIGBfYCBpbiBtb25vbGl0aGljXG4gICAgICogYnVpbGRzLCBtYXkgYmUgdXNlZCBhcyBhIHBsYWNlaG9sZGVyIGZvciBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgZG9lc24ndCBzZXQgdGhlIFwibGVuZ3RoXCIgcHJvcGVydHkgb2YgY3VycmllZCBmdW5jdGlvbnMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjdXJyeS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2FyaXR5PWZ1bmMubGVuZ3RoXSBUaGUgYXJpdHkgb2YgYGZ1bmNgLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY3VycmllZCBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFiYyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHtcbiAgICAgKiAgIHJldHVybiBbYSwgYiwgY107XG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIHZhciBjdXJyaWVkID0gXy5jdXJyeVJpZ2h0KGFiYyk7XG4gICAgICpcbiAgICAgKiBjdXJyaWVkKDMpKDIpKDEpO1xuICAgICAqIC8vID0+IFsxLCAyLCAzXVxuICAgICAqXG4gICAgICogY3VycmllZCgyLCAzKSgxKTtcbiAgICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICAgKlxuICAgICAqIGN1cnJpZWQoMSwgMiwgMyk7XG4gICAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAgICpcbiAgICAgKiAvLyBDdXJyaWVkIHdpdGggcGxhY2Vob2xkZXJzLlxuICAgICAqIGN1cnJpZWQoMykoMSwgXykoMik7XG4gICAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3VycnlSaWdodChmdW5jLCBhcml0eSwgZ3VhcmQpIHtcbiAgICAgIGFyaXR5ID0gZ3VhcmQgPyB1bmRlZmluZWQgOiBhcml0eTtcbiAgICAgIHZhciByZXN1bHQgPSBjcmVhdGVXcmFwKGZ1bmMsIFdSQVBfQ1VSUllfUklHSFRfRkxBRywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGFyaXR5KTtcbiAgICAgIHJlc3VsdC5wbGFjZWhvbGRlciA9IGN1cnJ5UmlnaHQucGxhY2Vob2xkZXI7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBkZWJvdW5jZWQgZnVuY3Rpb24gdGhhdCBkZWxheXMgaW52b2tpbmcgYGZ1bmNgIHVudGlsIGFmdGVyIGB3YWl0YFxuICAgICAqIG1pbGxpc2Vjb25kcyBoYXZlIGVsYXBzZWQgc2luY2UgdGhlIGxhc3QgdGltZSB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uIHdhc1xuICAgICAqIGludm9rZWQuIFRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gY29tZXMgd2l0aCBhIGBjYW5jZWxgIG1ldGhvZCB0byBjYW5jZWxcbiAgICAgKiBkZWxheWVkIGBmdW5jYCBpbnZvY2F0aW9ucyBhbmQgYSBgZmx1c2hgIG1ldGhvZCB0byBpbW1lZGlhdGVseSBpbnZva2UgdGhlbS5cbiAgICAgKiBQcm92aWRlIGBvcHRpb25zYCB0byBpbmRpY2F0ZSB3aGV0aGVyIGBmdW5jYCBzaG91bGQgYmUgaW52b2tlZCBvbiB0aGVcbiAgICAgKiBsZWFkaW5nIGFuZC9vciB0cmFpbGluZyBlZGdlIG9mIHRoZSBgd2FpdGAgdGltZW91dC4gVGhlIGBmdW5jYCBpcyBpbnZva2VkXG4gICAgICogd2l0aCB0aGUgbGFzdCBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbi4gU3Vic2VxdWVudFxuICAgICAqIGNhbGxzIHRvIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gcmV0dXJuIHRoZSByZXN1bHQgb2YgdGhlIGxhc3QgYGZ1bmNgXG4gICAgICogaW52b2NhdGlvbi5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBJZiBgbGVhZGluZ2AgYW5kIGB0cmFpbGluZ2Agb3B0aW9ucyBhcmUgYHRydWVgLCBgZnVuY2AgaXNcbiAgICAgKiBpbnZva2VkIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0IG9ubHkgaWYgdGhlIGRlYm91bmNlZCBmdW5jdGlvblxuICAgICAqIGlzIGludm9rZWQgbW9yZSB0aGFuIG9uY2UgZHVyaW5nIHRoZSBgd2FpdGAgdGltZW91dC5cbiAgICAgKlxuICAgICAqIElmIGB3YWl0YCBpcyBgMGAgYW5kIGBsZWFkaW5nYCBpcyBgZmFsc2VgLCBgZnVuY2AgaW52b2NhdGlvbiBpcyBkZWZlcnJlZFxuICAgICAqIHVudGlsIHRvIHRoZSBuZXh0IHRpY2ssIHNpbWlsYXIgdG8gYHNldFRpbWVvdXRgIHdpdGggYSB0aW1lb3V0IG9mIGAwYC5cbiAgICAgKlxuICAgICAqIFNlZSBbRGF2aWQgQ29yYmFjaG8ncyBhcnRpY2xlXShodHRwczovL2Nzcy10cmlja3MuY29tL2RlYm91bmNpbmctdGhyb3R0bGluZy1leHBsYWluZWQtZXhhbXBsZXMvKVxuICAgICAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8uZGVib3VuY2VgIGFuZCBgXy50aHJvdHRsZWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWJvdW5jZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3dhaXQ9MF0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gZGVsYXkuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPWZhbHNlXVxuICAgICAqICBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSBsZWFkaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1heFdhaXRdXG4gICAgICogIFRoZSBtYXhpbXVtIHRpbWUgYGZ1bmNgIGlzIGFsbG93ZWQgdG8gYmUgZGVsYXllZCBiZWZvcmUgaXQncyBpbnZva2VkLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMudHJhaWxpbmc9dHJ1ZV1cbiAgICAgKiAgU3BlY2lmeSBpbnZva2luZyBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBkZWJvdW5jZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIC8vIEF2b2lkIGNvc3RseSBjYWxjdWxhdGlvbnMgd2hpbGUgdGhlIHdpbmRvdyBzaXplIGlzIGluIGZsdXguXG4gICAgICogalF1ZXJ5KHdpbmRvdykub24oJ3Jlc2l6ZScsIF8uZGVib3VuY2UoY2FsY3VsYXRlTGF5b3V0LCAxNTApKTtcbiAgICAgKlxuICAgICAqIC8vIEludm9rZSBgc2VuZE1haWxgIHdoZW4gY2xpY2tlZCwgZGVib3VuY2luZyBzdWJzZXF1ZW50IGNhbGxzLlxuICAgICAqIGpRdWVyeShlbGVtZW50KS5vbignY2xpY2snLCBfLmRlYm91bmNlKHNlbmRNYWlsLCAzMDAsIHtcbiAgICAgKiAgICdsZWFkaW5nJzogdHJ1ZSxcbiAgICAgKiAgICd0cmFpbGluZyc6IGZhbHNlXG4gICAgICogfSkpO1xuICAgICAqXG4gICAgICogLy8gRW5zdXJlIGBiYXRjaExvZ2AgaXMgaW52b2tlZCBvbmNlIGFmdGVyIDEgc2Vjb25kIG9mIGRlYm91bmNlZCBjYWxscy5cbiAgICAgKiB2YXIgZGVib3VuY2VkID0gXy5kZWJvdW5jZShiYXRjaExvZywgMjUwLCB7ICdtYXhXYWl0JzogMTAwMCB9KTtcbiAgICAgKiB2YXIgc291cmNlID0gbmV3IEV2ZW50U291cmNlKCcvc3RyZWFtJyk7XG4gICAgICogalF1ZXJ5KHNvdXJjZSkub24oJ21lc3NhZ2UnLCBkZWJvdW5jZWQpO1xuICAgICAqXG4gICAgICogLy8gQ2FuY2VsIHRoZSB0cmFpbGluZyBkZWJvdW5jZWQgaW52b2NhdGlvbi5cbiAgICAgKiBqUXVlcnkod2luZG93KS5vbigncG9wc3RhdGUnLCBkZWJvdW5jZWQuY2FuY2VsKTtcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBvcHRpb25zKSB7XG4gICAgICB2YXIgbGFzdEFyZ3MsXG4gICAgICAgICAgbGFzdFRoaXMsXG4gICAgICAgICAgbWF4V2FpdCxcbiAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgdGltZXJJZCxcbiAgICAgICAgICBsYXN0Q2FsbFRpbWUsXG4gICAgICAgICAgbGFzdEludm9rZVRpbWUgPSAwLFxuICAgICAgICAgIGxlYWRpbmcgPSBmYWxzZSxcbiAgICAgICAgICBtYXhpbmcgPSBmYWxzZSxcbiAgICAgICAgICB0cmFpbGluZyA9IHRydWU7XG5cbiAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgICAgIH1cbiAgICAgIHdhaXQgPSB0b051bWJlcih3YWl0KSB8fCAwO1xuICAgICAgaWYgKGlzT2JqZWN0KG9wdGlvbnMpKSB7XG4gICAgICAgIGxlYWRpbmcgPSAhIW9wdGlvbnMubGVhZGluZztcbiAgICAgICAgbWF4aW5nID0gJ21heFdhaXQnIGluIG9wdGlvbnM7XG4gICAgICAgIG1heFdhaXQgPSBtYXhpbmcgPyBuYXRpdmVNYXgodG9OdW1iZXIob3B0aW9ucy5tYXhXYWl0KSB8fCAwLCB3YWl0KSA6IG1heFdhaXQ7XG4gICAgICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLnRyYWlsaW5nIDogdHJhaWxpbmc7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGludm9rZUZ1bmModGltZSkge1xuICAgICAgICB2YXIgYXJncyA9IGxhc3RBcmdzLFxuICAgICAgICAgICAgdGhpc0FyZyA9IGxhc3RUaGlzO1xuXG4gICAgICAgIGxhc3RBcmdzID0gbGFzdFRoaXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIGxhc3RJbnZva2VUaW1lID0gdGltZTtcbiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbGVhZGluZ0VkZ2UodGltZSkge1xuICAgICAgICAvLyBSZXNldCBhbnkgYG1heFdhaXRgIHRpbWVyLlxuICAgICAgICBsYXN0SW52b2tlVGltZSA9IHRpbWU7XG4gICAgICAgIC8vIFN0YXJ0IHRoZSB0aW1lciBmb3IgdGhlIHRyYWlsaW5nIGVkZ2UuXG4gICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7XG4gICAgICAgIC8vIEludm9rZSB0aGUgbGVhZGluZyBlZGdlLlxuICAgICAgICByZXR1cm4gbGVhZGluZyA/IGludm9rZUZ1bmModGltZSkgOiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkge1xuICAgICAgICB2YXIgdGltZVNpbmNlTGFzdENhbGwgPSB0aW1lIC0gbGFzdENhbGxUaW1lLFxuICAgICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZSxcbiAgICAgICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDtcblxuICAgICAgICByZXR1cm4gbWF4aW5nID8gbmF0aXZlTWluKHJlc3VsdCwgbWF4V2FpdCAtIHRpbWVTaW5jZUxhc3RJbnZva2UpIDogcmVzdWx0O1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzaG91bGRJbnZva2UodGltZSkge1xuICAgICAgICB2YXIgdGltZVNpbmNlTGFzdENhbGwgPSB0aW1lIC0gbGFzdENhbGxUaW1lLFxuICAgICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZTtcblxuICAgICAgICAvLyBFaXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgY2FsbCwgYWN0aXZpdHkgaGFzIHN0b3BwZWQgYW5kIHdlJ3JlIGF0IHRoZVxuICAgICAgICAvLyB0cmFpbGluZyBlZGdlLCB0aGUgc3lzdGVtIHRpbWUgaGFzIGdvbmUgYmFja3dhcmRzIGFuZCB3ZSdyZSB0cmVhdGluZ1xuICAgICAgICAvLyBpdCBhcyB0aGUgdHJhaWxpbmcgZWRnZSwgb3Igd2UndmUgaGl0IHRoZSBgbWF4V2FpdGAgbGltaXQuXG4gICAgICAgIHJldHVybiAobGFzdENhbGxUaW1lID09PSB1bmRlZmluZWQgfHwgKHRpbWVTaW5jZUxhc3RDYWxsID49IHdhaXQpIHx8XG4gICAgICAgICAgKHRpbWVTaW5jZUxhc3RDYWxsIDwgMCkgfHwgKG1heGluZyAmJiB0aW1lU2luY2VMYXN0SW52b2tlID49IG1heFdhaXQpKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gdGltZXJFeHBpcmVkKCkge1xuICAgICAgICB2YXIgdGltZSA9IG5vdygpO1xuICAgICAgICBpZiAoc2hvdWxkSW52b2tlKHRpbWUpKSB7XG4gICAgICAgICAgcmV0dXJuIHRyYWlsaW5nRWRnZSh0aW1lKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZXN0YXJ0IHRoZSB0aW1lci5cbiAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCByZW1haW5pbmdXYWl0KHRpbWUpKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gdHJhaWxpbmdFZGdlKHRpbWUpIHtcbiAgICAgICAgdGltZXJJZCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAvLyBPbmx5IGludm9rZSBpZiB3ZSBoYXZlIGBsYXN0QXJnc2Agd2hpY2ggbWVhbnMgYGZ1bmNgIGhhcyBiZWVuXG4gICAgICAgIC8vIGRlYm91bmNlZCBhdCBsZWFzdCBvbmNlLlxuICAgICAgICBpZiAodHJhaWxpbmcgJiYgbGFzdEFyZ3MpIHtcbiAgICAgICAgICByZXR1cm4gaW52b2tlRnVuYyh0aW1lKTtcbiAgICAgICAgfVxuICAgICAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgICAgIGlmICh0aW1lcklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgbGFzdEludm9rZVRpbWUgPSAwO1xuICAgICAgICBsYXN0QXJncyA9IGxhc3RDYWxsVGltZSA9IGxhc3RUaGlzID0gdGltZXJJZCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZmx1c2goKSB7XG4gICAgICAgIHJldHVybiB0aW1lcklkID09PSB1bmRlZmluZWQgPyByZXN1bHQgOiB0cmFpbGluZ0VkZ2Uobm93KCkpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKSB7XG4gICAgICAgIHZhciB0aW1lID0gbm93KCksXG4gICAgICAgICAgICBpc0ludm9raW5nID0gc2hvdWxkSW52b2tlKHRpbWUpO1xuXG4gICAgICAgIGxhc3RBcmdzID0gYXJndW1lbnRzO1xuICAgICAgICBsYXN0VGhpcyA9IHRoaXM7XG4gICAgICAgIGxhc3RDYWxsVGltZSA9IHRpbWU7XG5cbiAgICAgICAgaWYgKGlzSW52b2tpbmcpIHtcbiAgICAgICAgICBpZiAodGltZXJJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbGVhZGluZ0VkZ2UobGFzdENhbGxUaW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1heGluZykge1xuICAgICAgICAgICAgLy8gSGFuZGxlIGludm9jYXRpb25zIGluIGEgdGlnaHQgbG9vcC5cbiAgICAgICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7XG4gICAgICAgICAgICByZXR1cm4gaW52b2tlRnVuYyhsYXN0Q2FsbFRpbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGltZXJJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgZGVib3VuY2VkLmNhbmNlbCA9IGNhbmNlbDtcbiAgICAgIGRlYm91bmNlZC5mbHVzaCA9IGZsdXNoO1xuICAgICAgcmV0dXJuIGRlYm91bmNlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWZlcnMgaW52b2tpbmcgdGhlIGBmdW5jYCB1bnRpbCB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcyBjbGVhcmVkLiBBbnlcbiAgICAgKiBhZGRpdGlvbmFsIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQgdG8gYGZ1bmNgIHdoZW4gaXQncyBpbnZva2VkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZGVmZXIuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgYGZ1bmNgIHdpdGguXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgdGltZXIgaWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZGVmZXIoZnVuY3Rpb24odGV4dCkge1xuICAgICAqICAgY29uc29sZS5sb2codGV4dCk7XG4gICAgICogfSwgJ2RlZmVycmVkJyk7XG4gICAgICogLy8gPT4gTG9ncyAnZGVmZXJyZWQnIGFmdGVyIG9uZSBtaWxsaXNlY29uZC5cbiAgICAgKi9cbiAgICB2YXIgZGVmZXIgPSBiYXNlUmVzdChmdW5jdGlvbihmdW5jLCBhcmdzKSB7XG4gICAgICByZXR1cm4gYmFzZURlbGF5KGZ1bmMsIDEsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogSW52b2tlcyBgZnVuY2AgYWZ0ZXIgYHdhaXRgIG1pbGxpc2Vjb25kcy4gQW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIGFyZVxuICAgICAqIHByb3ZpZGVkIHRvIGBmdW5jYCB3aGVuIGl0J3MgaW52b2tlZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvblxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRlbGF5LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIGRlbGF5IGludm9jYXRpb24uXG4gICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgYGZ1bmNgIHdpdGguXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgdGltZXIgaWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZGVsYXkoZnVuY3Rpb24odGV4dCkge1xuICAgICAqICAgY29uc29sZS5sb2codGV4dCk7XG4gICAgICogfSwgMTAwMCwgJ2xhdGVyJyk7XG4gICAgICogLy8gPT4gTG9ncyAnbGF0ZXInIGFmdGVyIG9uZSBzZWNvbmQuXG4gICAgICovXG4gICAgdmFyIGRlbGF5ID0gYmFzZVJlc3QoZnVuY3Rpb24oZnVuYywgd2FpdCwgYXJncykge1xuICAgICAgcmV0dXJuIGJhc2VEZWxheShmdW5jLCB0b051bWJlcih3YWl0KSB8fCAwLCBhcmdzKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggYXJndW1lbnRzIHJldmVyc2VkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZmxpcCBhcmd1bWVudHMgZm9yLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZsaXBwZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBmbGlwcGVkID0gXy5mbGlwKGZ1bmN0aW9uKCkge1xuICAgICAqICAgcmV0dXJuIF8udG9BcnJheShhcmd1bWVudHMpO1xuICAgICAqIH0pO1xuICAgICAqXG4gICAgICogZmxpcHBlZCgnYScsICdiJywgJ2MnLCAnZCcpO1xuICAgICAqIC8vID0+IFsnZCcsICdjJywgJ2InLCAnYSddXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmxpcChmdW5jKSB7XG4gICAgICByZXR1cm4gY3JlYXRlV3JhcChmdW5jLCBXUkFQX0ZMSVBfRkxBRyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWVtb2l6ZXMgdGhlIHJlc3VsdCBvZiBgZnVuY2AuIElmIGByZXNvbHZlcmAgaXNcbiAgICAgKiBwcm92aWRlZCwgaXQgZGV0ZXJtaW5lcyB0aGUgY2FjaGUga2V5IGZvciBzdG9yaW5nIHRoZSByZXN1bHQgYmFzZWQgb24gdGhlXG4gICAgICogYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4gQnkgZGVmYXVsdCwgdGhlIGZpcnN0IGFyZ3VtZW50XG4gICAgICogcHJvdmlkZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uIGlzIHVzZWQgYXMgdGhlIG1hcCBjYWNoZSBrZXkuIFRoZSBgZnVuY2BcbiAgICAgKiBpcyBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBtZW1vaXplZCBmdW5jdGlvbi5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGUgY2FjaGUgaXMgZXhwb3NlZCBhcyB0aGUgYGNhY2hlYCBwcm9wZXJ0eSBvbiB0aGUgbWVtb2l6ZWRcbiAgICAgKiBmdW5jdGlvbi4gSXRzIGNyZWF0aW9uIG1heSBiZSBjdXN0b21pemVkIGJ5IHJlcGxhY2luZyB0aGUgYF8ubWVtb2l6ZS5DYWNoZWBcbiAgICAgKiBjb25zdHJ1Y3RvciB3aXRoIG9uZSB3aG9zZSBpbnN0YW5jZXMgaW1wbGVtZW50IHRoZVxuICAgICAqIFtgTWFwYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcHJvcGVydGllcy1vZi10aGUtbWFwLXByb3RvdHlwZS1vYmplY3QpXG4gICAgICogbWV0aG9kIGludGVyZmFjZSBvZiBgY2xlYXJgLCBgZGVsZXRlYCwgYGdldGAsIGBoYXNgLCBhbmQgYHNldGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBoYXZlIGl0cyBvdXRwdXQgbWVtb2l6ZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jlc29sdmVyXSBUaGUgZnVuY3Rpb24gdG8gcmVzb2x2ZSB0aGUgY2FjaGUga2V5LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEsICdiJzogMiB9O1xuICAgICAqIHZhciBvdGhlciA9IHsgJ2MnOiAzLCAnZCc6IDQgfTtcbiAgICAgKlxuICAgICAqIHZhciB2YWx1ZXMgPSBfLm1lbW9pemUoXy52YWx1ZXMpO1xuICAgICAqIHZhbHVlcyhvYmplY3QpO1xuICAgICAqIC8vID0+IFsxLCAyXVxuICAgICAqXG4gICAgICogdmFsdWVzKG90aGVyKTtcbiAgICAgKiAvLyA9PiBbMywgNF1cbiAgICAgKlxuICAgICAqIG9iamVjdC5hID0gMjtcbiAgICAgKiB2YWx1ZXMob2JqZWN0KTtcbiAgICAgKiAvLyA9PiBbMSwgMl1cbiAgICAgKlxuICAgICAqIC8vIE1vZGlmeSB0aGUgcmVzdWx0IGNhY2hlLlxuICAgICAqIHZhbHVlcy5jYWNoZS5zZXQob2JqZWN0LCBbJ2EnLCAnYiddKTtcbiAgICAgKiB2YWx1ZXMob2JqZWN0KTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYiddXG4gICAgICpcbiAgICAgKiAvLyBSZXBsYWNlIGBfLm1lbW9pemUuQ2FjaGVgLlxuICAgICAqIF8ubWVtb2l6ZS5DYWNoZSA9IFdlYWtNYXA7XG4gICAgICovXG4gICAgZnVuY3Rpb24gbWVtb2l6ZShmdW5jLCByZXNvbHZlcikge1xuICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicgfHwgKHJlc29sdmVyICE9IG51bGwgJiYgdHlwZW9mIHJlc29sdmVyICE9ICdmdW5jdGlvbicpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgICAgIH1cbiAgICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cyxcbiAgICAgICAgICAgIGtleSA9IHJlc29sdmVyID8gcmVzb2x2ZXIuYXBwbHkodGhpcywgYXJncykgOiBhcmdzWzBdLFxuICAgICAgICAgICAgY2FjaGUgPSBtZW1vaXplZC5jYWNoZTtcblxuICAgICAgICBpZiAoY2FjaGUuaGFzKGtleSkpIHtcbiAgICAgICAgICByZXR1cm4gY2FjaGUuZ2V0KGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIG1lbW9pemVkLmNhY2hlID0gY2FjaGUuc2V0KGtleSwgcmVzdWx0KSB8fCBjYWNoZTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyAobWVtb2l6ZS5DYWNoZSB8fCBNYXBDYWNoZSk7XG4gICAgICByZXR1cm4gbWVtb2l6ZWQ7XG4gICAgfVxuXG4gICAgLy8gRXhwb3NlIGBNYXBDYWNoZWAuXG4gICAgbWVtb2l6ZS5DYWNoZSA9IE1hcENhY2hlO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbmVnYXRlcyB0aGUgcmVzdWx0IG9mIHRoZSBwcmVkaWNhdGUgYGZ1bmNgLiBUaGVcbiAgICAgKiBgZnVuY2AgcHJlZGljYXRlIGlzIGludm9rZWQgd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgYW5kIGFyZ3VtZW50cyBvZiB0aGVcbiAgICAgKiBjcmVhdGVkIGZ1bmN0aW9uLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBwcmVkaWNhdGUgdG8gbmVnYXRlLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG5lZ2F0ZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGlzRXZlbihuKSB7XG4gICAgICogICByZXR1cm4gbiAlIDIgPT0gMDtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBfLmZpbHRlcihbMSwgMiwgMywgNCwgNSwgNl0sIF8ubmVnYXRlKGlzRXZlbikpO1xuICAgICAqIC8vID0+IFsxLCAzLCA1XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG5lZ2F0ZShwcmVkaWNhdGUpIHtcbiAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlICE9ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgICAgICAgIGNhc2UgMDogcmV0dXJuICFwcmVkaWNhdGUuY2FsbCh0aGlzKTtcbiAgICAgICAgICBjYXNlIDE6IHJldHVybiAhcHJlZGljYXRlLmNhbGwodGhpcywgYXJnc1swXSk7XG4gICAgICAgICAgY2FzZSAyOiByZXR1cm4gIXByZWRpY2F0ZS5jYWxsKHRoaXMsIGFyZ3NbMF0sIGFyZ3NbMV0pO1xuICAgICAgICAgIGNhc2UgMzogcmV0dXJuICFwcmVkaWNhdGUuY2FsbCh0aGlzLCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gIXByZWRpY2F0ZS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaXMgcmVzdHJpY3RlZCB0byBpbnZva2luZyBgZnVuY2Agb25jZS4gUmVwZWF0IGNhbGxzXG4gICAgICogdG8gdGhlIGZ1bmN0aW9uIHJldHVybiB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGludm9jYXRpb24uIFRoZSBgZnVuY2AgaXNcbiAgICAgKiBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIGFuZCBhcmd1bWVudHMgb2YgdGhlIGNyZWF0ZWQgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byByZXN0cmljdC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyByZXN0cmljdGVkIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgaW5pdGlhbGl6ZSA9IF8ub25jZShjcmVhdGVBcHBsaWNhdGlvbik7XG4gICAgICogaW5pdGlhbGl6ZSgpO1xuICAgICAqIGluaXRpYWxpemUoKTtcbiAgICAgKiAvLyA9PiBgY3JlYXRlQXBwbGljYXRpb25gIGlzIGludm9rZWQgb25jZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uY2UoZnVuYykge1xuICAgICAgcmV0dXJuIGJlZm9yZSgyLCBmdW5jKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCB3aXRoIGl0cyBhcmd1bWVudHMgdHJhbnNmb3JtZWQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLlxuICAgICAqIEBwYXJhbSB7Li4uKEZ1bmN0aW9ufEZ1bmN0aW9uW10pfSBbdHJhbnNmb3Jtcz1bXy5pZGVudGl0eV1dXG4gICAgICogIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm1zLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBkb3VibGVkKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICogMjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBzcXVhcmUobikge1xuICAgICAqICAgcmV0dXJuIG4gKiBuO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIHZhciBmdW5jID0gXy5vdmVyQXJncyhmdW5jdGlvbih4LCB5KSB7XG4gICAgICogICByZXR1cm4gW3gsIHldO1xuICAgICAqIH0sIFtzcXVhcmUsIGRvdWJsZWRdKTtcbiAgICAgKlxuICAgICAqIGZ1bmMoOSwgMyk7XG4gICAgICogLy8gPT4gWzgxLCA2XVxuICAgICAqXG4gICAgICogZnVuYygxMCwgNSk7XG4gICAgICogLy8gPT4gWzEwMCwgMTBdXG4gICAgICovXG4gICAgdmFyIG92ZXJBcmdzID0gY2FzdFJlc3QoZnVuY3Rpb24oZnVuYywgdHJhbnNmb3Jtcykge1xuICAgICAgdHJhbnNmb3JtcyA9ICh0cmFuc2Zvcm1zLmxlbmd0aCA9PSAxICYmIGlzQXJyYXkodHJhbnNmb3Jtc1swXSkpXG4gICAgICAgID8gYXJyYXlNYXAodHJhbnNmb3Jtc1swXSwgYmFzZVVuYXJ5KGdldEl0ZXJhdGVlKCkpKVxuICAgICAgICA6IGFycmF5TWFwKGJhc2VGbGF0dGVuKHRyYW5zZm9ybXMsIDEpLCBiYXNlVW5hcnkoZ2V0SXRlcmF0ZWUoKSkpO1xuXG4gICAgICB2YXIgZnVuY3NMZW5ndGggPSB0cmFuc2Zvcm1zLmxlbmd0aDtcbiAgICAgIHJldHVybiBiYXNlUmVzdChmdW5jdGlvbihhcmdzKSB7XG4gICAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgICAgbGVuZ3RoID0gbmF0aXZlTWluKGFyZ3MubGVuZ3RoLCBmdW5jc0xlbmd0aCk7XG5cbiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgICBhcmdzW2luZGV4XSA9IHRyYW5zZm9ybXNbaW5kZXhdLmNhbGwodGhpcywgYXJnc1tpbmRleF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzLCBhcmdzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBgcGFydGlhbHNgIHByZXBlbmRlZCB0byB0aGVcbiAgICAgKiBhcmd1bWVudHMgaXQgcmVjZWl2ZXMuIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uYmluZGAgZXhjZXB0IGl0IGRvZXMgKipub3QqKlxuICAgICAqIGFsdGVyIHRoZSBgdGhpc2AgYmluZGluZy5cbiAgICAgKlxuICAgICAqIFRoZSBgXy5wYXJ0aWFsLnBsYWNlaG9sZGVyYCB2YWx1ZSwgd2hpY2ggZGVmYXVsdHMgdG8gYF9gIGluIG1vbm9saXRoaWNcbiAgICAgKiBidWlsZHMsIG1heSBiZSB1c2VkIGFzIGEgcGxhY2Vob2xkZXIgZm9yIHBhcnRpYWxseSBhcHBsaWVkIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBkb2Vzbid0IHNldCB0aGUgXCJsZW5ndGhcIiBwcm9wZXJ0eSBvZiBwYXJ0aWFsbHlcbiAgICAgKiBhcHBsaWVkIGZ1bmN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqIEBjYXRlZ29yeSBGdW5jdGlvblxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHBhcnRpYWxseSBhcHBseSBhcmd1bWVudHMgdG8uXG4gICAgICogQHBhcmFtIHsuLi4qfSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcGFydGlhbGx5IGFwcGxpZWQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGdyZWV0KGdyZWV0aW5nLCBuYW1lKSB7XG4gICAgICogICByZXR1cm4gZ3JlZXRpbmcgKyAnICcgKyBuYW1lO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIHZhciBzYXlIZWxsb1RvID0gXy5wYXJ0aWFsKGdyZWV0LCAnaGVsbG8nKTtcbiAgICAgKiBzYXlIZWxsb1RvKCdmcmVkJyk7XG4gICAgICogLy8gPT4gJ2hlbGxvIGZyZWQnXG4gICAgICpcbiAgICAgKiAvLyBQYXJ0aWFsbHkgYXBwbGllZCB3aXRoIHBsYWNlaG9sZGVycy5cbiAgICAgKiB2YXIgZ3JlZXRGcmVkID0gXy5wYXJ0aWFsKGdyZWV0LCBfLCAnZnJlZCcpO1xuICAgICAqIGdyZWV0RnJlZCgnaGknKTtcbiAgICAgKiAvLyA9PiAnaGkgZnJlZCdcbiAgICAgKi9cbiAgICB2YXIgcGFydGlhbCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGZ1bmMsIHBhcnRpYWxzKSB7XG4gICAgICB2YXIgaG9sZGVycyA9IHJlcGxhY2VIb2xkZXJzKHBhcnRpYWxzLCBnZXRIb2xkZXIocGFydGlhbCkpO1xuICAgICAgcmV0dXJuIGNyZWF0ZVdyYXAoZnVuYywgV1JBUF9QQVJUSUFMX0ZMQUcsIHVuZGVmaW5lZCwgcGFydGlhbHMsIGhvbGRlcnMpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5wYXJ0aWFsYCBleGNlcHQgdGhhdCBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHNcbiAgICAgKiBhcmUgYXBwZW5kZWQgdG8gdGhlIGFyZ3VtZW50cyBpdCByZWNlaXZlcy5cbiAgICAgKlxuICAgICAqIFRoZSBgXy5wYXJ0aWFsUmlnaHQucGxhY2Vob2xkZXJgIHZhbHVlLCB3aGljaCBkZWZhdWx0cyB0byBgX2AgaW4gbW9ub2xpdGhpY1xuICAgICAqIGJ1aWxkcywgbWF5IGJlIHVzZWQgYXMgYSBwbGFjZWhvbGRlciBmb3IgcGFydGlhbGx5IGFwcGxpZWQgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGRvZXNuJ3Qgc2V0IHRoZSBcImxlbmd0aFwiIHByb3BlcnR5IG9mIHBhcnRpYWxseVxuICAgICAqIGFwcGxpZWQgZnVuY3Rpb25zLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDEuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcGFydGlhbGx5IGFwcGx5IGFyZ3VtZW50cyB0by5cbiAgICAgKiBAcGFyYW0gey4uLip9IFtwYXJ0aWFsc10gVGhlIGFyZ3VtZW50cyB0byBiZSBwYXJ0aWFsbHkgYXBwbGllZC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBwYXJ0aWFsbHkgYXBwbGllZCBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gZ3JlZXQoZ3JlZXRpbmcsIG5hbWUpIHtcbiAgICAgKiAgIHJldHVybiBncmVldGluZyArICcgJyArIG5hbWU7XG4gICAgICogfVxuICAgICAqXG4gICAgICogdmFyIGdyZWV0RnJlZCA9IF8ucGFydGlhbFJpZ2h0KGdyZWV0LCAnZnJlZCcpO1xuICAgICAqIGdyZWV0RnJlZCgnaGknKTtcbiAgICAgKiAvLyA9PiAnaGkgZnJlZCdcbiAgICAgKlxuICAgICAqIC8vIFBhcnRpYWxseSBhcHBsaWVkIHdpdGggcGxhY2Vob2xkZXJzLlxuICAgICAqIHZhciBzYXlIZWxsb1RvID0gXy5wYXJ0aWFsUmlnaHQoZ3JlZXQsICdoZWxsbycsIF8pO1xuICAgICAqIHNheUhlbGxvVG8oJ2ZyZWQnKTtcbiAgICAgKiAvLyA9PiAnaGVsbG8gZnJlZCdcbiAgICAgKi9cbiAgICB2YXIgcGFydGlhbFJpZ2h0ID0gYmFzZVJlc3QoZnVuY3Rpb24oZnVuYywgcGFydGlhbHMpIHtcbiAgICAgIHZhciBob2xkZXJzID0gcmVwbGFjZUhvbGRlcnMocGFydGlhbHMsIGdldEhvbGRlcihwYXJ0aWFsUmlnaHQpKTtcbiAgICAgIHJldHVybiBjcmVhdGVXcmFwKGZ1bmMsIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHLCB1bmRlZmluZWQsIHBhcnRpYWxzLCBob2xkZXJzKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggYXJndW1lbnRzIGFycmFuZ2VkIGFjY29yZGluZ1xuICAgICAqIHRvIHRoZSBzcGVjaWZpZWQgYGluZGV4ZXNgIHdoZXJlIHRoZSBhcmd1bWVudCB2YWx1ZSBhdCB0aGUgZmlyc3QgaW5kZXggaXNcbiAgICAgKiBwcm92aWRlZCBhcyB0aGUgZmlyc3QgYXJndW1lbnQsIHRoZSBhcmd1bWVudCB2YWx1ZSBhdCB0aGUgc2Vjb25kIGluZGV4IGlzXG4gICAgICogcHJvdmlkZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudCwgYW5kIHNvIG9uLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcmVhcnJhbmdlIGFyZ3VtZW50cyBmb3IuXG4gICAgICogQHBhcmFtIHsuLi4obnVtYmVyfG51bWJlcltdKX0gaW5kZXhlcyBUaGUgYXJyYW5nZWQgYXJndW1lbnQgaW5kZXhlcy5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHJlYXJnZWQgPSBfLnJlYXJnKGZ1bmN0aW9uKGEsIGIsIGMpIHtcbiAgICAgKiAgIHJldHVybiBbYSwgYiwgY107XG4gICAgICogfSwgWzIsIDAsIDFdKTtcbiAgICAgKlxuICAgICAqIHJlYXJnZWQoJ2InLCAnYycsICdhJylcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYicsICdjJ11cbiAgICAgKi9cbiAgICB2YXIgcmVhcmcgPSBmbGF0UmVzdChmdW5jdGlvbihmdW5jLCBpbmRleGVzKSB7XG4gICAgICByZXR1cm4gY3JlYXRlV3JhcChmdW5jLCBXUkFQX1JFQVJHX0ZMQUcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGluZGV4ZXMpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlXG4gICAgICogY3JlYXRlZCBmdW5jdGlvbiBhbmQgYXJndW1lbnRzIGZyb20gYHN0YXJ0YCBhbmQgYmV5b25kIHByb3ZpZGVkIGFzXG4gICAgICogYW4gYXJyYXkuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb24gdGhlXG4gICAgICogW3Jlc3QgcGFyYW1ldGVyXShodHRwczovL21kbi5pby9yZXN0X3BhcmFtZXRlcnMpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBzYXkgPSBfLnJlc3QoZnVuY3Rpb24od2hhdCwgbmFtZXMpIHtcbiAgICAgKiAgIHJldHVybiB3aGF0ICsgJyAnICsgXy5pbml0aWFsKG5hbWVzKS5qb2luKCcsICcpICtcbiAgICAgKiAgICAgKF8uc2l6ZShuYW1lcykgPiAxID8gJywgJiAnIDogJycpICsgXy5sYXN0KG5hbWVzKTtcbiAgICAgKiB9KTtcbiAgICAgKlxuICAgICAqIHNheSgnaGVsbG8nLCAnZnJlZCcsICdiYXJuZXknLCAncGViYmxlcycpO1xuICAgICAqIC8vID0+ICdoZWxsbyBmcmVkLCBiYXJuZXksICYgcGViYmxlcydcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZXN0KGZ1bmMsIHN0YXJ0KSB7XG4gICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gICAgICB9XG4gICAgICBzdGFydCA9IHN0YXJ0ID09PSB1bmRlZmluZWQgPyBzdGFydCA6IHRvSW50ZWdlcihzdGFydCk7XG4gICAgICByZXR1cm4gYmFzZVJlc3QoZnVuYywgc3RhcnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZVxuICAgICAqIGNyZWF0ZSBmdW5jdGlvbiBhbmQgYW4gYXJyYXkgb2YgYXJndW1lbnRzIG11Y2ggbGlrZVxuICAgICAqIFtgRnVuY3Rpb24jYXBwbHlgXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5KS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbiB0aGVcbiAgICAgKiBbc3ByZWFkIG9wZXJhdG9yXShodHRwczovL21kbi5pby9zcHJlYWRfb3BlcmF0b3IpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMi4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gc3ByZWFkIGFyZ3VtZW50cyBvdmVyLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uIG9mIHRoZSBzcHJlYWQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBzYXkgPSBfLnNwcmVhZChmdW5jdGlvbih3aG8sIHdoYXQpIHtcbiAgICAgKiAgIHJldHVybiB3aG8gKyAnIHNheXMgJyArIHdoYXQ7XG4gICAgICogfSk7XG4gICAgICpcbiAgICAgKiBzYXkoWydmcmVkJywgJ2hlbGxvJ10pO1xuICAgICAqIC8vID0+ICdmcmVkIHNheXMgaGVsbG8nXG4gICAgICpcbiAgICAgKiB2YXIgbnVtYmVycyA9IFByb21pc2UuYWxsKFtcbiAgICAgKiAgIFByb21pc2UucmVzb2x2ZSg0MCksXG4gICAgICogICBQcm9taXNlLnJlc29sdmUoMzYpXG4gICAgICogXSk7XG4gICAgICpcbiAgICAgKiBudW1iZXJzLnRoZW4oXy5zcHJlYWQoZnVuY3Rpb24oeCwgeSkge1xuICAgICAqICAgcmV0dXJuIHggKyB5O1xuICAgICAqIH0pKTtcbiAgICAgKiAvLyA9PiBhIFByb21pc2Ugb2YgNzZcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzcHJlYWQoZnVuYywgc3RhcnQpIHtcbiAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgICAgIH1cbiAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiBuYXRpdmVNYXgodG9JbnRlZ2VyKHN0YXJ0KSwgMCk7XG4gICAgICByZXR1cm4gYmFzZVJlc3QoZnVuY3Rpb24oYXJncykge1xuICAgICAgICB2YXIgYXJyYXkgPSBhcmdzW3N0YXJ0XSxcbiAgICAgICAgICAgIG90aGVyQXJncyA9IGNhc3RTbGljZShhcmdzLCAwLCBzdGFydCk7XG5cbiAgICAgICAgaWYgKGFycmF5KSB7XG4gICAgICAgICAgYXJyYXlQdXNoKG90aGVyQXJncywgYXJyYXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzLCBvdGhlckFyZ3MpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHRocm90dGxlZCBmdW5jdGlvbiB0aGF0IG9ubHkgaW52b2tlcyBgZnVuY2AgYXQgbW9zdCBvbmNlIHBlclxuICAgICAqIGV2ZXJ5IGB3YWl0YCBtaWxsaXNlY29uZHMuIFRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gY29tZXMgd2l0aCBhIGBjYW5jZWxgXG4gICAgICogbWV0aG9kIHRvIGNhbmNlbCBkZWxheWVkIGBmdW5jYCBpbnZvY2F0aW9ucyBhbmQgYSBgZmx1c2hgIG1ldGhvZCB0b1xuICAgICAqIGltbWVkaWF0ZWx5IGludm9rZSB0aGVtLiBQcm92aWRlIGBvcHRpb25zYCB0byBpbmRpY2F0ZSB3aGV0aGVyIGBmdW5jYFxuICAgICAqIHNob3VsZCBiZSBpbnZva2VkIG9uIHRoZSBsZWFkaW5nIGFuZC9vciB0cmFpbGluZyBlZGdlIG9mIHRoZSBgd2FpdGBcbiAgICAgKiB0aW1lb3V0LiBUaGUgYGZ1bmNgIGlzIGludm9rZWQgd2l0aCB0aGUgbGFzdCBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlXG4gICAgICogdGhyb3R0bGVkIGZ1bmN0aW9uLiBTdWJzZXF1ZW50IGNhbGxzIHRvIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gcmV0dXJuIHRoZVxuICAgICAqIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AgaW52b2NhdGlvbi5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBJZiBgbGVhZGluZ2AgYW5kIGB0cmFpbGluZ2Agb3B0aW9ucyBhcmUgYHRydWVgLCBgZnVuY2AgaXNcbiAgICAgKiBpbnZva2VkIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0IG9ubHkgaWYgdGhlIHRocm90dGxlZCBmdW5jdGlvblxuICAgICAqIGlzIGludm9rZWQgbW9yZSB0aGFuIG9uY2UgZHVyaW5nIHRoZSBgd2FpdGAgdGltZW91dC5cbiAgICAgKlxuICAgICAqIElmIGB3YWl0YCBpcyBgMGAgYW5kIGBsZWFkaW5nYCBpcyBgZmFsc2VgLCBgZnVuY2AgaW52b2NhdGlvbiBpcyBkZWZlcnJlZFxuICAgICAqIHVudGlsIHRvIHRoZSBuZXh0IHRpY2ssIHNpbWlsYXIgdG8gYHNldFRpbWVvdXRgIHdpdGggYSB0aW1lb3V0IG9mIGAwYC5cbiAgICAgKlxuICAgICAqIFNlZSBbRGF2aWQgQ29yYmFjaG8ncyBhcnRpY2xlXShodHRwczovL2Nzcy10cmlja3MuY29tL2RlYm91bmNpbmctdGhyb3R0bGluZy1leHBsYWluZWQtZXhhbXBsZXMvKVxuICAgICAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8udGhyb3R0bGVgIGFuZCBgXy5kZWJvdW5jZWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB0aHJvdHRsZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3dhaXQ9MF0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gdGhyb3R0bGUgaW52b2NhdGlvbnMgdG8uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPXRydWVdXG4gICAgICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIGxlYWRpbmcgZWRnZSBvZiB0aGUgdGltZW91dC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnRyYWlsaW5nPXRydWVdXG4gICAgICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIHRyYWlsaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgdGhyb3R0bGVkIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiAvLyBBdm9pZCBleGNlc3NpdmVseSB1cGRhdGluZyB0aGUgcG9zaXRpb24gd2hpbGUgc2Nyb2xsaW5nLlxuICAgICAqIGpRdWVyeSh3aW5kb3cpLm9uKCdzY3JvbGwnLCBfLnRocm90dGxlKHVwZGF0ZVBvc2l0aW9uLCAxMDApKTtcbiAgICAgKlxuICAgICAqIC8vIEludm9rZSBgcmVuZXdUb2tlbmAgd2hlbiB0aGUgY2xpY2sgZXZlbnQgaXMgZmlyZWQsIGJ1dCBub3QgbW9yZSB0aGFuIG9uY2UgZXZlcnkgNSBtaW51dGVzLlxuICAgICAqIHZhciB0aHJvdHRsZWQgPSBfLnRocm90dGxlKHJlbmV3VG9rZW4sIDMwMDAwMCwgeyAndHJhaWxpbmcnOiBmYWxzZSB9KTtcbiAgICAgKiBqUXVlcnkoZWxlbWVudCkub24oJ2NsaWNrJywgdGhyb3R0bGVkKTtcbiAgICAgKlxuICAgICAqIC8vIENhbmNlbCB0aGUgdHJhaWxpbmcgdGhyb3R0bGVkIGludm9jYXRpb24uXG4gICAgICogalF1ZXJ5KHdpbmRvdykub24oJ3BvcHN0YXRlJywgdGhyb3R0bGVkLmNhbmNlbCk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gdGhyb3R0bGUoZnVuYywgd2FpdCwgb3B0aW9ucykge1xuICAgICAgdmFyIGxlYWRpbmcgPSB0cnVlLFxuICAgICAgICAgIHRyYWlsaW5nID0gdHJ1ZTtcblxuICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpO1xuICAgICAgfVxuICAgICAgaWYgKGlzT2JqZWN0KG9wdGlvbnMpKSB7XG4gICAgICAgIGxlYWRpbmcgPSAnbGVhZGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy5sZWFkaW5nIDogbGVhZGluZztcbiAgICAgICAgdHJhaWxpbmcgPSAndHJhaWxpbmcnIGluIG9wdGlvbnMgPyAhIW9wdGlvbnMudHJhaWxpbmcgOiB0cmFpbGluZztcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWJvdW5jZShmdW5jLCB3YWl0LCB7XG4gICAgICAgICdsZWFkaW5nJzogbGVhZGluZyxcbiAgICAgICAgJ21heFdhaXQnOiB3YWl0LFxuICAgICAgICAndHJhaWxpbmcnOiB0cmFpbGluZ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyB1cCB0byBvbmUgYXJndW1lbnQsIGlnbm9yaW5nIGFueVxuICAgICAqIGFkZGl0aW9uYWwgYXJndW1lbnRzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2FwIGFyZ3VtZW50cyBmb3IuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY2FwcGVkIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLm1hcChbJzYnLCAnOCcsICcxMCddLCBfLnVuYXJ5KHBhcnNlSW50KSk7XG4gICAgICogLy8gPT4gWzYsIDgsIDEwXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuYXJ5KGZ1bmMpIHtcbiAgICAgIHJldHVybiBhcnkoZnVuYywgMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcHJvdmlkZXMgYHZhbHVlYCB0byBgd3JhcHBlcmAgYXMgaXRzIGZpcnN0XG4gICAgICogYXJndW1lbnQuIEFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyBwcm92aWRlZCB0byB0aGUgZnVuY3Rpb24gYXJlIGFwcGVuZGVkXG4gICAgICogdG8gdGhvc2UgcHJvdmlkZWQgdG8gdGhlIGB3cmFwcGVyYC4gVGhlIHdyYXBwZXIgaXMgaW52b2tlZCB3aXRoIHRoZSBgdGhpc2BcbiAgICAgKiBiaW5kaW5nIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gd3JhcC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbd3JhcHBlcj1pZGVudGl0eV0gVGhlIHdyYXBwZXIgZnVuY3Rpb24uXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBwID0gXy53cmFwKF8uZXNjYXBlLCBmdW5jdGlvbihmdW5jLCB0ZXh0KSB7XG4gICAgICogICByZXR1cm4gJzxwPicgKyBmdW5jKHRleHQpICsgJzwvcD4nO1xuICAgICAqIH0pO1xuICAgICAqXG4gICAgICogcCgnZnJlZCwgYmFybmV5LCAmIHBlYmJsZXMnKTtcbiAgICAgKiAvLyA9PiAnPHA+ZnJlZCwgYmFybmV5LCAmYW1wOyBwZWJibGVzPC9wPidcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3cmFwKHZhbHVlLCB3cmFwcGVyKSB7XG4gICAgICByZXR1cm4gcGFydGlhbChjYXN0RnVuY3Rpb24od3JhcHBlciksIHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBDYXN0cyBgdmFsdWVgIGFzIGFuIGFycmF5IGlmIGl0J3Mgbm90IG9uZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjQuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNhc3QgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uY2FzdEFycmF5KDEpO1xuICAgICAqIC8vID0+IFsxXVxuICAgICAqXG4gICAgICogXy5jYXN0QXJyYXkoeyAnYSc6IDEgfSk7XG4gICAgICogLy8gPT4gW3sgJ2EnOiAxIH1dXG4gICAgICpcbiAgICAgKiBfLmNhc3RBcnJheSgnYWJjJyk7XG4gICAgICogLy8gPT4gWydhYmMnXVxuICAgICAqXG4gICAgICogXy5jYXN0QXJyYXkobnVsbCk7XG4gICAgICogLy8gPT4gW251bGxdXG4gICAgICpcbiAgICAgKiBfLmNhc3RBcnJheSh1bmRlZmluZWQpO1xuICAgICAqIC8vID0+IFt1bmRlZmluZWRdXG4gICAgICpcbiAgICAgKiBfLmNhc3RBcnJheSgpO1xuICAgICAqIC8vID0+IFtdXG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgM107XG4gICAgICogY29uc29sZS5sb2coXy5jYXN0QXJyYXkoYXJyYXkpID09PSBhcnJheSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNhc3RBcnJheSgpIHtcbiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHNbMF07XG4gICAgICByZXR1cm4gaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNoYWxsb3cgY2xvbmUgb2YgYHZhbHVlYC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBsb29zZWx5IGJhc2VkIG9uIHRoZVxuICAgICAqIFtzdHJ1Y3R1cmVkIGNsb25lIGFsZ29yaXRobV0oaHR0cHM6Ly9tZG4uaW8vU3RydWN0dXJlZF9jbG9uZV9hbGdvcml0aG0pXG4gICAgICogYW5kIHN1cHBvcnRzIGNsb25pbmcgYXJyYXlzLCBhcnJheSBidWZmZXJzLCBib29sZWFucywgZGF0ZSBvYmplY3RzLCBtYXBzLFxuICAgICAqIG51bWJlcnMsIGBPYmplY3RgIG9iamVjdHMsIHJlZ2V4ZXMsIHNldHMsIHN0cmluZ3MsIHN5bWJvbHMsIGFuZCB0eXBlZFxuICAgICAqIGFycmF5cy4gVGhlIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMgb2YgYGFyZ3VtZW50c2Agb2JqZWN0cyBhcmUgY2xvbmVkXG4gICAgICogYXMgcGxhaW4gb2JqZWN0cy4gQW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkIGZvciB1bmNsb25lYWJsZSB2YWx1ZXMgc3VjaFxuICAgICAqIGFzIGVycm9yIG9iamVjdHMsIGZ1bmN0aW9ucywgRE9NIG5vZGVzLCBhbmQgV2Vha01hcHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNsb25lLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBjbG9uZWQgdmFsdWUuXG4gICAgICogQHNlZSBfLmNsb25lRGVlcFxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICdhJzogMSB9LCB7ICdiJzogMiB9XTtcbiAgICAgKlxuICAgICAqIHZhciBzaGFsbG93ID0gXy5jbG9uZShvYmplY3RzKTtcbiAgICAgKiBjb25zb2xlLmxvZyhzaGFsbG93WzBdID09PSBvYmplY3RzWzBdKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvbmUodmFsdWUpIHtcbiAgICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX1NZTUJPTFNfRkxBRyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5jbG9uZWAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmAgd2hpY2hcbiAgICAgKiBpcyBpbnZva2VkIHRvIHByb2R1Y2UgdGhlIGNsb25lZCB2YWx1ZS4gSWYgYGN1c3RvbWl6ZXJgIHJldHVybnMgYHVuZGVmaW5lZGAsXG4gICAgICogY2xvbmluZyBpcyBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBpbnZva2VkIHdpdGhcbiAgICAgKiB1cCB0byBmb3VyIGFyZ3VtZW50czsgKHZhbHVlIFssIGluZGV4fGtleSwgb2JqZWN0LCBzdGFja10pLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjbG9uZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBjbG9uZWQgdmFsdWUuXG4gICAgICogQHNlZSBfLmNsb25lRGVlcFdpdGhcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gY3VzdG9taXplcih2YWx1ZSkge1xuICAgICAqICAgaWYgKF8uaXNFbGVtZW50KHZhbHVlKSkge1xuICAgICAqICAgICByZXR1cm4gdmFsdWUuY2xvbmVOb2RlKGZhbHNlKTtcbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgZWwgPSBfLmNsb25lV2l0aChkb2N1bWVudC5ib2R5LCBjdXN0b21pemVyKTtcbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKGVsID09PSBkb2N1bWVudC5ib2R5KTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqIGNvbnNvbGUubG9nKGVsLm5vZGVOYW1lKTtcbiAgICAgKiAvLyA9PiAnQk9EWSdcbiAgICAgKiBjb25zb2xlLmxvZyhlbC5jaGlsZE5vZGVzLmxlbmd0aCk7XG4gICAgICogLy8gPT4gMFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb25lV2l0aCh2YWx1ZSwgY3VzdG9taXplcikge1xuICAgICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIGJhc2VDbG9uZSh2YWx1ZSwgQ0xPTkVfU1lNQk9MU19GTEFHLCBjdXN0b21pemVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmNsb25lYCBleGNlcHQgdGhhdCBpdCByZWN1cnNpdmVseSBjbG9uZXMgYHZhbHVlYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmVjdXJzaXZlbHkgY2xvbmUuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGRlZXAgY2xvbmVkIHZhbHVlLlxuICAgICAqIEBzZWUgXy5jbG9uZVxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICdhJzogMSB9LCB7ICdiJzogMiB9XTtcbiAgICAgKlxuICAgICAqIHZhciBkZWVwID0gXy5jbG9uZURlZXAob2JqZWN0cyk7XG4gICAgICogY29uc29sZS5sb2coZGVlcFswXSA9PT0gb2JqZWN0c1swXSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9uZURlZXAodmFsdWUpIHtcbiAgICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX0RFRVBfRkxBRyB8IENMT05FX1NZTUJPTFNfRkxBRyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5jbG9uZVdpdGhgIGV4Y2VwdCB0aGF0IGl0IHJlY3Vyc2l2ZWx5IGNsb25lcyBgdmFsdWVgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byByZWN1cnNpdmVseSBjbG9uZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBkZWVwIGNsb25lZCB2YWx1ZS5cbiAgICAgKiBAc2VlIF8uY2xvbmVXaXRoXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIodmFsdWUpIHtcbiAgICAgKiAgIGlmIChfLmlzRWxlbWVudCh2YWx1ZSkpIHtcbiAgICAgKiAgICAgcmV0dXJuIHZhbHVlLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgZWwgPSBfLmNsb25lRGVlcFdpdGgoZG9jdW1lbnQuYm9keSwgY3VzdG9taXplcik7XG4gICAgICpcbiAgICAgKiBjb25zb2xlLmxvZyhlbCA9PT0gZG9jdW1lbnQuYm9keSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKiBjb25zb2xlLmxvZyhlbC5ub2RlTmFtZSk7XG4gICAgICogLy8gPT4gJ0JPRFknXG4gICAgICogY29uc29sZS5sb2coZWwuY2hpbGROb2Rlcy5sZW5ndGgpO1xuICAgICAqIC8vID0+IDIwXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvbmVEZWVwV2l0aCh2YWx1ZSwgY3VzdG9taXplcikge1xuICAgICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIGJhc2VDbG9uZSh2YWx1ZSwgQ0xPTkVfREVFUF9GTEFHIHwgQ0xPTkVfU1lNQk9MU19GTEFHLCBjdXN0b21pemVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYG9iamVjdGAgY29uZm9ybXMgdG8gYHNvdXJjZWAgYnkgaW52b2tpbmcgdGhlIHByZWRpY2F0ZVxuICAgICAqIHByb3BlcnRpZXMgb2YgYHNvdXJjZWAgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSB2YWx1ZXMgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgZXF1aXZhbGVudCB0byBgXy5jb25mb3Jtc2Agd2hlbiBgc291cmNlYCBpc1xuICAgICAqIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTQuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHByZWRpY2F0ZXMgdG8gY29uZm9ybSB0by5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgY29uZm9ybXMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6IDIgfTtcbiAgICAgKlxuICAgICAqIF8uY29uZm9ybXNUbyhvYmplY3QsIHsgJ2InOiBmdW5jdGlvbihuKSB7IHJldHVybiBuID4gMTsgfSB9KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmNvbmZvcm1zVG8ob2JqZWN0LCB7ICdiJzogZnVuY3Rpb24obikgeyByZXR1cm4gbiA+IDI7IH0gfSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb25mb3Jtc1RvKG9iamVjdCwgc291cmNlKSB7XG4gICAgICByZXR1cm4gc291cmNlID09IG51bGwgfHwgYmFzZUNvbmZvcm1zVG8ob2JqZWN0LCBzb3VyY2UsIGtleXMoc291cmNlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYVxuICAgICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pXG4gICAgICogY29tcGFyaXNvbiBiZXR3ZWVuIHR3byB2YWx1ZXMgdG8gZGV0ZXJtaW5lIGlmIHRoZXkgYXJlIGVxdWl2YWxlbnQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTtcbiAgICAgKiB2YXIgb3RoZXIgPSB7ICdhJzogMSB9O1xuICAgICAqXG4gICAgICogXy5lcShvYmplY3QsIG9iamVjdCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5lcShvYmplY3QsIG90aGVyKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5lcSgnYScsICdhJyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5lcSgnYScsIE9iamVjdCgnYScpKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5lcShOYU4sIE5hTik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVxKHZhbHVlLCBvdGhlcikge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBvdGhlciB8fCAodmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIGBvdGhlcmAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy45LjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gYG90aGVyYCxcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBzZWUgXy5sdFxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmd0KDMsIDEpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uZ3QoMywgMyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uZ3QoMSwgMyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICB2YXIgZ3QgPSBjcmVhdGVSZWxhdGlvbmFsT3BlcmF0aW9uKGJhc2VHdCk7XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gYG90aGVyYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjkuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0b1xuICAgICAqICBgb3RoZXJgLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQHNlZSBfLmx0ZVxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmd0ZSgzLCAxKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmd0ZSgzLCAzKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmd0ZSgxLCAzKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIHZhciBndGUgPSBjcmVhdGVSZWxhdGlvbmFsT3BlcmF0aW9uKGZ1bmN0aW9uKHZhbHVlLCBvdGhlcikge1xuICAgICAgcmV0dXJuIHZhbHVlID49IG90aGVyO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIGlzQXJndW1lbnRzID0gYmFzZUlzQXJndW1lbnRzKGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID8gYmFzZUlzQXJndW1lbnRzIDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJlxuICAgICAgICAhcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGFuIGBBcnJheWAgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheSwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzQXJyYXkoWzEsIDIsIDNdKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzQXJyYXkoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheSgnYWJjJyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheShfLm5vb3ApO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhbiBgQXJyYXlCdWZmZXJgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjMuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXkgYnVmZmVyLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheUJ1ZmZlcihuZXcgQXJyYXlCdWZmZXIoMikpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheUJ1ZmZlcihuZXcgQXJyYXkoMikpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIGlzQXJyYXlCdWZmZXIgPSBub2RlSXNBcnJheUJ1ZmZlciA/IGJhc2VVbmFyeShub2RlSXNBcnJheUJ1ZmZlcikgOiBiYXNlSXNBcnJheUJ1ZmZlcjtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3NcbiAgICAgKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yXG4gICAgICogZXF1YWwgdG8gYDBgIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pc0FycmF5TGlrZWAgZXhjZXB0IHRoYXQgaXQgYWxzbyBjaGVja3MgaWYgYHZhbHVlYFxuICAgICAqIGlzIGFuIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXktbGlrZSBvYmplY3QsXG4gICAgICogIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc0FycmF5TGlrZU9iamVjdChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheUxpa2VPYmplY3QoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0FycmF5TGlrZU9iamVjdCgnYWJjJyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uaXNBcnJheUxpa2VPYmplY3QoXy5ub29wKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzQXJyYXlMaWtlT2JqZWN0KHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBpc0FycmF5TGlrZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGJvb2xlYW4gcHJpbWl0aXZlIG9yIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBib29sZWFuLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNCb29sZWFuKGZhbHNlKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzQm9vbGVhbihudWxsKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzQm9vbGVhbih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBmYWxzZSB8fFxuICAgICAgICAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBib29sVGFnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjMuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBidWZmZXIsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc0J1ZmZlcihuZXcgQnVmZmVyKDIpKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzQnVmZmVyKG5ldyBVaW50OEFycmF5KDIpKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIHZhciBpc0J1ZmZlciA9IG5hdGl2ZUlzQnVmZmVyIHx8IHN0dWJGYWxzZTtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRGF0ZWAgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGRhdGUgb2JqZWN0LCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNEYXRlKG5ldyBEYXRlKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzRGF0ZSgnTW9uIEFwcmlsIDIzIDIwMTInKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIHZhciBpc0RhdGUgPSBub2RlSXNEYXRlID8gYmFzZVVuYXJ5KG5vZGVJc0RhdGUpIDogYmFzZUlzRGF0ZTtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxpa2VseSBhIERPTSBlbGVtZW50LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIERPTSBlbGVtZW50LCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNFbGVtZW50KGRvY3VtZW50LmJvZHkpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNFbGVtZW50KCc8Ym9keT4nKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzRWxlbWVudCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgdmFsdWUubm9kZVR5cGUgPT09IDEgJiYgIWlzUGxhaW5PYmplY3QodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGVtcHR5IG9iamVjdCwgY29sbGVjdGlvbiwgbWFwLCBvciBzZXQuXG4gICAgICpcbiAgICAgKiBPYmplY3RzIGFyZSBjb25zaWRlcmVkIGVtcHR5IGlmIHRoZXkgaGF2ZSBubyBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWRcbiAgICAgKiBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICogQXJyYXktbGlrZSB2YWx1ZXMgc3VjaCBhcyBgYXJndW1lbnRzYCBvYmplY3RzLCBhcnJheXMsIGJ1ZmZlcnMsIHN0cmluZ3MsIG9yXG4gICAgICogalF1ZXJ5LWxpa2UgY29sbGVjdGlvbnMgYXJlIGNvbnNpZGVyZWQgZW1wdHkgaWYgdGhleSBoYXZlIGEgYGxlbmd0aGAgb2YgYDBgLlxuICAgICAqIFNpbWlsYXJseSwgbWFwcyBhbmQgc2V0cyBhcmUgY29uc2lkZXJlZCBlbXB0eSBpZiB0aGV5IGhhdmUgYSBgc2l6ZWAgb2YgYDBgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBlbXB0eSwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzRW1wdHkobnVsbCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0VtcHR5KHRydWUpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNFbXB0eSgxKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzRW1wdHkoWzEsIDIsIDNdKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc0VtcHR5KHsgJ2EnOiAxIH0pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpICYmXG4gICAgICAgICAgKGlzQXJyYXkodmFsdWUpIHx8IHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUuc3BsaWNlID09ICdmdW5jdGlvbicgfHxcbiAgICAgICAgICAgIGlzQnVmZmVyKHZhbHVlKSB8fCBpc1R5cGVkQXJyYXkodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSkpIHtcbiAgICAgICAgcmV0dXJuICF2YWx1ZS5sZW5ndGg7XG4gICAgICB9XG4gICAgICB2YXIgdGFnID0gZ2V0VGFnKHZhbHVlKTtcbiAgICAgIGlmICh0YWcgPT0gbWFwVGFnIHx8IHRhZyA9PSBzZXRUYWcpIHtcbiAgICAgICAgcmV0dXJuICF2YWx1ZS5zaXplO1xuICAgICAgfVxuICAgICAgaWYgKGlzUHJvdG90eXBlKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gIWJhc2VLZXlzKHZhbHVlKS5sZW5ndGg7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGEgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gdHdvIHZhbHVlcyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmVcbiAgICAgKiBlcXVpdmFsZW50LlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIHN1cHBvcnRzIGNvbXBhcmluZyBhcnJheXMsIGFycmF5IGJ1ZmZlcnMsIGJvb2xlYW5zLFxuICAgICAqIGRhdGUgb2JqZWN0cywgZXJyb3Igb2JqZWN0cywgbWFwcywgbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcyxcbiAgICAgKiBzZXRzLCBzdHJpbmdzLCBzeW1ib2xzLCBhbmQgdHlwZWQgYXJyYXlzLiBgT2JqZWN0YCBvYmplY3RzIGFyZSBjb21wYXJlZFxuICAgICAqIGJ5IHRoZWlyIG93biwgbm90IGluaGVyaXRlZCwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLiBGdW5jdGlvbnMgYW5kIERPTVxuICAgICAqIG5vZGVzIGFyZSBjb21wYXJlZCBieSBzdHJpY3QgZXF1YWxpdHksIGkuZS4gYD09PWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTtcbiAgICAgKiB2YXIgb3RoZXIgPSB7ICdhJzogMSB9O1xuICAgICAqXG4gICAgICogXy5pc0VxdWFsKG9iamVjdCwgb3RoZXIpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIG9iamVjdCA9PT0gb3RoZXI7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0VxdWFsKHZhbHVlLCBvdGhlcikge1xuICAgICAgcmV0dXJuIGJhc2VJc0VxdWFsKHZhbHVlLCBvdGhlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pc0VxdWFsYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjdXN0b21pemVyYCB3aGljaFxuICAgICAqIGlzIGludm9rZWQgdG8gY29tcGFyZSB2YWx1ZXMuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgLCBjb21wYXJpc29uc1xuICAgICAqIGFyZSBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBpbnZva2VkIHdpdGggdXAgdG9cbiAgICAgKiBzaXggYXJndW1lbnRzOiAob2JqVmFsdWUsIG90aFZhbHVlIFssIGluZGV4fGtleSwgb2JqZWN0LCBvdGhlciwgc3RhY2tdKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGlzR3JlZXRpbmcodmFsdWUpIHtcbiAgICAgKiAgIHJldHVybiAvXmgoPzppfGVsbG8pJC8udGVzdCh2YWx1ZSk7XG4gICAgICogfVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gY3VzdG9taXplcihvYmpWYWx1ZSwgb3RoVmFsdWUpIHtcbiAgICAgKiAgIGlmIChpc0dyZWV0aW5nKG9ialZhbHVlKSAmJiBpc0dyZWV0aW5nKG90aFZhbHVlKSkge1xuICAgICAqICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgYXJyYXkgPSBbJ2hlbGxvJywgJ2dvb2RieWUnXTtcbiAgICAgKiB2YXIgb3RoZXIgPSBbJ2hpJywgJ2dvb2RieWUnXTtcbiAgICAgKlxuICAgICAqIF8uaXNFcXVhbFdpdGgoYXJyYXksIG90aGVyLCBjdXN0b21pemVyKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNFcXVhbFdpdGgodmFsdWUsIG90aGVyLCBjdXN0b21pemVyKSB7XG4gICAgICBjdXN0b21pemVyID0gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGN1c3RvbWl6ZXIgOiB1bmRlZmluZWQ7XG4gICAgICB2YXIgcmVzdWx0ID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIodmFsdWUsIG90aGVyKSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiByZXN1bHQgPT09IHVuZGVmaW5lZCA/IGJhc2VJc0VxdWFsKHZhbHVlLCBvdGhlciwgdW5kZWZpbmVkLCBjdXN0b21pemVyKSA6ICEhcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGBFcnJvcmAsIGBFdmFsRXJyb3JgLCBgUmFuZ2VFcnJvcmAsIGBSZWZlcmVuY2VFcnJvcmAsXG4gICAgICogYFN5bnRheEVycm9yYCwgYFR5cGVFcnJvcmAsIG9yIGBVUklFcnJvcmAgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBlcnJvciBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc0Vycm9yKG5ldyBFcnJvcik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0Vycm9yKEVycm9yKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzRXJyb3IodmFsdWUpIHtcbiAgICAgIGlmICghaXNPYmplY3RMaWtlKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgdGFnID0gYmFzZUdldFRhZyh2YWx1ZSk7XG4gICAgICByZXR1cm4gdGFnID09IGVycm9yVGFnIHx8IHRhZyA9PSBkb21FeGNUYWcgfHxcbiAgICAgICAgKHR5cGVvZiB2YWx1ZS5tZXNzYWdlID09ICdzdHJpbmcnICYmIHR5cGVvZiB2YWx1ZS5uYW1lID09ICdzdHJpbmcnICYmICFpc1BsYWluT2JqZWN0KHZhbHVlKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBmaW5pdGUgcHJpbWl0aXZlIG51bWJlci5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvblxuICAgICAqIFtgTnVtYmVyLmlzRmluaXRlYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzRmluaXRlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBmaW5pdGUgbnVtYmVyLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNGaW5pdGUoMyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0Zpbml0ZShOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzRmluaXRlKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc0Zpbml0ZSgnMycpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNGaW5pdGUodmFsdWUpIHtcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYgbmF0aXZlSXNGaW5pdGUodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRnVuY3Rpb25gIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBmdW5jdGlvbiwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzRnVuY3Rpb24oXyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc0Z1bmN0aW9uKC9hYmMvKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvclxuICAgICAgLy8gaW4gU2FmYXJpIDkgd2hpY2ggcmV0dXJucyAnb2JqZWN0JyBmb3IgdHlwZWQgYXJyYXlzIGFuZCBvdGhlciBjb25zdHJ1Y3RvcnMuXG4gICAgICB2YXIgdGFnID0gYmFzZUdldFRhZyh2YWx1ZSk7XG4gICAgICByZXR1cm4gdGFnID09IGZ1bmNUYWcgfHwgdGFnID09IGdlblRhZyB8fCB0YWcgPT0gYXN5bmNUYWcgfHwgdGFnID09IHByb3h5VGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGludGVnZXIuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb25cbiAgICAgKiBbYE51bWJlci5pc0ludGVnZXJgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNJbnRlZ2VyKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gaW50ZWdlciwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzSW50ZWdlcigzKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc0ludGVnZXIoSW5maW5pdHkpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmlzSW50ZWdlcignMycpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID09IHRvSW50ZWdlcih2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBhcnJheS1saWtlIGxlbmd0aC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBsb29zZWx5IGJhc2VkIG9uXG4gICAgICogW2BUb0xlbmd0aGBdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvbGVuZ3RoKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBsZW5ndGgsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc0xlbmd0aCgzKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmlzTGVuZ3RoKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc0xlbmd0aCgnMycpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHtcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiZcbiAgICAgICAgdmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8PSBNQVhfU0FGRV9JTlRFR0VSO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHRoZVxuICAgICAqIFtsYW5ndWFnZSB0eXBlXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1sYW5ndWFnZS10eXBlcylcbiAgICAgKiBvZiBgT2JqZWN0YC4gKGUuZy4gYXJyYXlzLCBmdW5jdGlvbnMsIG9iamVjdHMsIHJlZ2V4ZXMsIGBuZXcgTnVtYmVyKDApYCwgYW5kIGBuZXcgU3RyaW5nKCcnKWApXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIG9iamVjdCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzT2JqZWN0KHt9KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzT2JqZWN0KFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc09iamVjdChfLm5vb3ApO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNPYmplY3QobnVsbCk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkge1xuICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYFxuICAgICAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgXCJvYmplY3RcIi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc09iamVjdExpa2Uoe30pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc09iamVjdExpa2UoXy5ub29wKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc09iamVjdExpa2UobnVsbCk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE1hcGAgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMy4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG1hcCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzTWFwKG5ldyBNYXApO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNNYXAobmV3IFdlYWtNYXApO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIGlzTWFwID0gbm9kZUlzTWFwID8gYmFzZVVuYXJ5KG5vZGVJc01hcCkgOiBiYXNlSXNNYXA7XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHBhcnRpYWwgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gYG9iamVjdGAgYW5kIGBzb3VyY2VgIHRvXG4gICAgICogZGV0ZXJtaW5lIGlmIGBvYmplY3RgIGNvbnRhaW5zIGVxdWl2YWxlbnQgcHJvcGVydHkgdmFsdWVzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGVxdWl2YWxlbnQgdG8gYF8ubWF0Y2hlc2Agd2hlbiBgc291cmNlYCBpc1xuICAgICAqIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgICAqXG4gICAgICogUGFydGlhbCBjb21wYXJpc29ucyB3aWxsIG1hdGNoIGVtcHR5IGFycmF5IGFuZCBlbXB0eSBvYmplY3QgYHNvdXJjZWBcbiAgICAgKiB2YWx1ZXMgYWdhaW5zdCBhbnkgYXJyYXkgb3Igb2JqZWN0IHZhbHVlLCByZXNwZWN0aXZlbHkuIFNlZSBgXy5pc0VxdWFsYFxuICAgICAqIGZvciBhIGxpc3Qgb2Ygc3VwcG9ydGVkIHZhbHVlIGNvbXBhcmlzb25zLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgdmFsdWVzIHRvIG1hdGNoLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSwgJ2InOiAyIH07XG4gICAgICpcbiAgICAgKiBfLmlzTWF0Y2gob2JqZWN0LCB7ICdiJzogMiB9KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzTWF0Y2gob2JqZWN0LCB7ICdiJzogMSB9KTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTWF0Y2gob2JqZWN0LCBzb3VyY2UpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPT09IHNvdXJjZSB8fCBiYXNlSXNNYXRjaChvYmplY3QsIHNvdXJjZSwgZ2V0TWF0Y2hEYXRhKHNvdXJjZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uaXNNYXRjaGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmAgd2hpY2hcbiAgICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgcmV0dXJucyBgdW5kZWZpbmVkYCwgY29tcGFyaXNvbnNcbiAgICAgKiBhcmUgaGFuZGxlZCBieSB0aGUgbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoIGZpdmVcbiAgICAgKiBhcmd1bWVudHM6IChvYmpWYWx1ZSwgc3JjVmFsdWUsIGluZGV4fGtleSwgb2JqZWN0LCBzb3VyY2UpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgdmFsdWVzIHRvIG1hdGNoLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGlzR3JlZXRpbmcodmFsdWUpIHtcbiAgICAgKiAgIHJldHVybiAvXmgoPzppfGVsbG8pJC8udGVzdCh2YWx1ZSk7XG4gICAgICogfVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gY3VzdG9taXplcihvYmpWYWx1ZSwgc3JjVmFsdWUpIHtcbiAgICAgKiAgIGlmIChpc0dyZWV0aW5nKG9ialZhbHVlKSAmJiBpc0dyZWV0aW5nKHNyY1ZhbHVlKSkge1xuICAgICAqICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnZ3JlZXRpbmcnOiAnaGVsbG8nIH07XG4gICAgICogdmFyIHNvdXJjZSA9IHsgJ2dyZWV0aW5nJzogJ2hpJyB9O1xuICAgICAqXG4gICAgICogXy5pc01hdGNoV2l0aChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTWF0Y2hXaXRoKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyKSB7XG4gICAgICBjdXN0b21pemVyID0gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGN1c3RvbWl6ZXIgOiB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gYmFzZUlzTWF0Y2gob2JqZWN0LCBzb3VyY2UsIGdldE1hdGNoRGF0YShzb3VyY2UpLCBjdXN0b21pemVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgTmFOYC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvblxuICAgICAqIFtgTnVtYmVyLmlzTmFOYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzTmFOKSBhbmQgaXMgbm90IHRoZSBzYW1lIGFzXG4gICAgICogZ2xvYmFsIFtgaXNOYU5gXShodHRwczovL21kbi5pby9pc05hTikgd2hpY2ggcmV0dXJucyBgdHJ1ZWAgZm9yXG4gICAgICogYHVuZGVmaW5lZGAgYW5kIG90aGVyIG5vbi1udW1iZXIgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgTmFOYCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzTmFOKE5hTik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc05hTihuZXcgTnVtYmVyKE5hTikpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIGlzTmFOKHVuZGVmaW5lZCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc05hTih1bmRlZmluZWQpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNOYU4odmFsdWUpIHtcbiAgICAgIC8vIEFuIGBOYU5gIHByaW1pdGl2ZSBpcyB0aGUgb25seSB2YWx1ZSB0aGF0IGlzIG5vdCBlcXVhbCB0byBpdHNlbGYuXG4gICAgICAvLyBQZXJmb3JtIHRoZSBgdG9TdHJpbmdUYWdgIGNoZWNrIGZpcnN0IHRvIGF2b2lkIGVycm9ycyB3aXRoIHNvbWVcbiAgICAgIC8vIEFjdGl2ZVggb2JqZWN0cyBpbiBJRS5cbiAgICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgdmFsdWUgIT0gK3ZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcHJpc3RpbmUgbmF0aXZlIGZ1bmN0aW9uLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGNhbid0IHJlbGlhYmx5IGRldGVjdCBuYXRpdmUgZnVuY3Rpb25zIGluIHRoZSBwcmVzZW5jZVxuICAgICAqIG9mIHRoZSBjb3JlLWpzIHBhY2thZ2UgYmVjYXVzZSBjb3JlLWpzIGNpcmN1bXZlbnRzIHRoaXMga2luZCBvZiBkZXRlY3Rpb24uXG4gICAgICogRGVzcGl0ZSBtdWx0aXBsZSByZXF1ZXN0cywgdGhlIGNvcmUtanMgbWFpbnRhaW5lciBoYXMgbWFkZSBpdCBjbGVhcjogYW55XG4gICAgICogYXR0ZW1wdCB0byBmaXggdGhlIGRldGVjdGlvbiB3aWxsIGJlIG9ic3RydWN0ZWQuIEFzIGEgcmVzdWx0LCB3ZSdyZSBsZWZ0XG4gICAgICogd2l0aCBsaXR0bGUgY2hvaWNlIGJ1dCB0byB0aHJvdyBhbiBlcnJvci4gVW5mb3J0dW5hdGVseSwgdGhpcyBhbHNvIGFmZmVjdHNcbiAgICAgKiBwYWNrYWdlcywgbGlrZSBbYmFiZWwtcG9seWZpbGxdKGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2JhYmVsLXBvbHlmaWxsKSxcbiAgICAgKiB3aGljaCByZWx5IG9uIGNvcmUtanMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbmF0aXZlIGZ1bmN0aW9uLFxuICAgICAqICBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNOYXRpdmUoQXJyYXkucHJvdG90eXBlLnB1c2gpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNOYXRpdmUoXyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc05hdGl2ZSh2YWx1ZSkge1xuICAgICAgaWYgKGlzTWFza2FibGUodmFsdWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihDT1JFX0VSUk9SX1RFWFQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VJc05hdGl2ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYG51bGxgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgbnVsbGAsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc051bGwobnVsbCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc051bGwodm9pZCAwKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTnVsbCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYCBvciBgdW5kZWZpbmVkYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbnVsbGlzaCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzTmlsKG51bGwpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNOaWwodm9pZCAwKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzTmlsKE5hTik7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc05pbCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBOdW1iZXJgIHByaW1pdGl2ZSBvciBvYmplY3QuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVG8gZXhjbHVkZSBgSW5maW5pdHlgLCBgLUluZmluaXR5YCwgYW5kIGBOYU5gLCB3aGljaCBhcmVcbiAgICAgKiBjbGFzc2lmaWVkIGFzIG51bWJlcnMsIHVzZSB0aGUgYF8uaXNGaW5pdGVgIG1ldGhvZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBudW1iZXIsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc051bWJlcigzKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNOdW1iZXIoSW5maW5pdHkpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNOdW1iZXIoJzMnKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTnVtYmVyKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8XG4gICAgICAgIChpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IG51bWJlclRhZyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIHRoYXQgaXMsIGFuIG9iamVjdCBjcmVhdGVkIGJ5IHRoZVxuICAgICAqIGBPYmplY3RgIGNvbnN0cnVjdG9yIG9yIG9uZSB3aXRoIGEgYFtbUHJvdG90eXBlXV1gIG9mIGBudWxsYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjguMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gMTtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBfLmlzUGxhaW5PYmplY3QobmV3IEZvbyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uaXNQbGFpbk9iamVjdChbMSwgMiwgM10pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmlzUGxhaW5PYmplY3QoeyAneCc6IDAsICd5JzogMCB9KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzUGxhaW5PYmplY3QoT2JqZWN0LmNyZWF0ZShudWxsKSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHtcbiAgICAgIGlmICghaXNPYmplY3RMaWtlKHZhbHVlKSB8fCBiYXNlR2V0VGFnKHZhbHVlKSAhPSBvYmplY3RUYWcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIHByb3RvID0gZ2V0UHJvdG90eXBlKHZhbHVlKTtcbiAgICAgIGlmIChwcm90byA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHZhciBDdG9yID0gaGFzT3duUHJvcGVydHkuY2FsbChwcm90bywgJ2NvbnN0cnVjdG9yJykgJiYgcHJvdG8uY29uc3RydWN0b3I7XG4gICAgICByZXR1cm4gdHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yIGluc3RhbmNlb2YgQ3RvciAmJlxuICAgICAgICBmdW5jVG9TdHJpbmcuY2FsbChDdG9yKSA9PSBvYmplY3RDdG9yU3RyaW5nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgUmVnRXhwYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcmVnZXhwLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNSZWdFeHAoL2FiYy8pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNSZWdFeHAoJy9hYmMvJyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICB2YXIgaXNSZWdFeHAgPSBub2RlSXNSZWdFeHAgPyBiYXNlVW5hcnkobm9kZUlzUmVnRXhwKSA6IGJhc2VJc1JlZ0V4cDtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgc2FmZSBpbnRlZ2VyLiBBbiBpbnRlZ2VyIGlzIHNhZmUgaWYgaXQncyBhbiBJRUVFLTc1NFxuICAgICAqIGRvdWJsZSBwcmVjaXNpb24gbnVtYmVyIHdoaWNoIGlzbid0IHRoZSByZXN1bHQgb2YgYSByb3VuZGVkIHVuc2FmZSBpbnRlZ2VyLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uXG4gICAgICogW2BOdW1iZXIuaXNTYWZlSW50ZWdlcmBdKGh0dHBzOi8vbWRuLmlvL051bWJlci9pc1NhZmVJbnRlZ2VyKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzYWZlIGludGVnZXIsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc1NhZmVJbnRlZ2VyKDMpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNTYWZlSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc1NhZmVJbnRlZ2VyKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogXy5pc1NhZmVJbnRlZ2VyKCczJyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc1NhZmVJbnRlZ2VyKHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA+PSAtTUFYX1NBRkVfSU5URUdFUiAmJiB2YWx1ZSA8PSBNQVhfU0FGRV9JTlRFR0VSO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU2V0YCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4zLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc2V0LCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNTZXQobmV3IFNldCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pc1NldChuZXcgV2Vha1NldCk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICB2YXIgaXNTZXQgPSBub2RlSXNTZXQgPyBiYXNlVW5hcnkobm9kZUlzU2V0KSA6IGJhc2VJc1NldDtcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU3RyaW5nYCBwcmltaXRpdmUgb3Igb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHN0cmluZywgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmlzU3RyaW5nKCdhYmMnKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzU3RyaW5nKDEpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNTdHJpbmcodmFsdWUpIHtcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHxcbiAgICAgICAgKCFpc0FycmF5KHZhbHVlKSAmJiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHN0cmluZ1RhZyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTeW1ib2xgIHByaW1pdGl2ZSBvciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc3ltYm9sLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNTeW1ib2woU3ltYm9sLml0ZXJhdG9yKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzU3ltYm9sKCdhYmMnKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzU3ltYm9sKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdzeW1ib2wnIHx8XG4gICAgICAgIChpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHN5bWJvbFRhZyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIHR5cGVkIGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaXNUeXBlZEFycmF5KG5ldyBVaW50OEFycmF5KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmlzVHlwZWRBcnJheShbXSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICB2YXIgaXNUeXBlZEFycmF5ID0gbm9kZUlzVHlwZWRBcnJheSA/IGJhc2VVbmFyeShub2RlSXNUeXBlZEFycmF5KSA6IGJhc2VJc1R5cGVkQXJyYXk7XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYHVuZGVmaW5lZGAsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc1VuZGVmaW5lZCh2b2lkIDApO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNVbmRlZmluZWQobnVsbCk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc1VuZGVmaW5lZCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBXZWFrTWFwYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4zLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgd2VhayBtYXAsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc1dlYWtNYXAobmV3IFdlYWtNYXApO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNXZWFrTWFwKG5ldyBNYXApO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNXZWFrTWFwKHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBnZXRUYWcodmFsdWUpID09IHdlYWtNYXBUYWc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBXZWFrU2V0YCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4zLjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgd2VhayBzZXQsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5pc1dlYWtTZXQobmV3IFdlYWtTZXQpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaXNXZWFrU2V0KG5ldyBTZXQpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNXZWFrU2V0KHZhbHVlKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSB3ZWFrU2V0VGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBgb3RoZXJgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuOS4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLlxuICAgICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIGBvdGhlcmAsXG4gICAgICogIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAc2VlIF8uZ3RcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5sdCgxLCAzKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmx0KDMsIDMpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmx0KDMsIDEpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIGx0ID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihiYXNlTHQpO1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBvdGhlcmAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy45LjBcbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuXG4gICAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG9cbiAgICAgKiAgYG90aGVyYCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBzZWUgXy5ndGVcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5sdGUoMSwgMyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5sdGUoMywgMyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5sdGUoMywgMSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICB2YXIgbHRlID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA8PSBvdGhlcjtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYW4gYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgTGFuZ1xuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgYXJyYXkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udG9BcnJheSh7ICdhJzogMSwgJ2InOiAyIH0pO1xuICAgICAqIC8vID0+IFsxLCAyXVxuICAgICAqXG4gICAgICogXy50b0FycmF5KCdhYmMnKTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYicsICdjJ11cbiAgICAgKlxuICAgICAqIF8udG9BcnJheSgxKTtcbiAgICAgKiAvLyA9PiBbXVxuICAgICAqXG4gICAgICogXy50b0FycmF5KG51bGwpO1xuICAgICAqIC8vID0+IFtdXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9BcnJheSh2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBpc1N0cmluZyh2YWx1ZSkgPyBzdHJpbmdUb0FycmF5KHZhbHVlKSA6IGNvcHlBcnJheSh2YWx1ZSk7XG4gICAgICB9XG4gICAgICBpZiAoc3ltSXRlcmF0b3IgJiYgdmFsdWVbc3ltSXRlcmF0b3JdKSB7XG4gICAgICAgIHJldHVybiBpdGVyYXRvclRvQXJyYXkodmFsdWVbc3ltSXRlcmF0b3JdKCkpO1xuICAgICAgfVxuICAgICAgdmFyIHRhZyA9IGdldFRhZyh2YWx1ZSksXG4gICAgICAgICAgZnVuYyA9IHRhZyA9PSBtYXBUYWcgPyBtYXBUb0FycmF5IDogKHRhZyA9PSBzZXRUYWcgPyBzZXRUb0FycmF5IDogdmFsdWVzKTtcblxuICAgICAgcmV0dXJuIGZ1bmModmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBmaW5pdGUgbnVtYmVyLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTIuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgbnVtYmVyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnRvRmluaXRlKDMuMik7XG4gICAgICogLy8gPT4gMy4yXG4gICAgICpcbiAgICAgKiBfLnRvRmluaXRlKE51bWJlci5NSU5fVkFMVUUpO1xuICAgICAqIC8vID0+IDVlLTMyNFxuICAgICAqXG4gICAgICogXy50b0Zpbml0ZShJbmZpbml0eSk7XG4gICAgICogLy8gPT4gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDhcbiAgICAgKlxuICAgICAqIF8udG9GaW5pdGUoJzMuMicpO1xuICAgICAqIC8vID0+IDMuMlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvRmluaXRlKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogMDtcbiAgICAgIH1cbiAgICAgIHZhbHVlID0gdG9OdW1iZXIodmFsdWUpO1xuICAgICAgaWYgKHZhbHVlID09PSBJTkZJTklUWSB8fCB2YWx1ZSA9PT0gLUlORklOSVRZKSB7XG4gICAgICAgIHZhciBzaWduID0gKHZhbHVlIDwgMCA/IC0xIDogMSk7XG4gICAgICAgIHJldHVybiBzaWduICogTUFYX0lOVEVHRVI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlID8gdmFsdWUgOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYW4gaW50ZWdlci5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBsb29zZWx5IGJhc2VkIG9uXG4gICAgICogW2BUb0ludGVnZXJgXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9pbnRlZ2VyKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgaW50ZWdlci5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50b0ludGVnZXIoMy4yKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICpcbiAgICAgKiBfLnRvSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgKiAvLyA9PiAwXG4gICAgICpcbiAgICAgKiBfLnRvSW50ZWdlcihJbmZpbml0eSk7XG4gICAgICogLy8gPT4gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDhcbiAgICAgKlxuICAgICAqIF8udG9JbnRlZ2VyKCczLjInKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9JbnRlZ2VyKHZhbHVlKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gdG9GaW5pdGUodmFsdWUpLFxuICAgICAgICAgIHJlbWFpbmRlciA9IHJlc3VsdCAlIDE7XG5cbiAgICAgIHJldHVybiByZXN1bHQgPT09IHJlc3VsdCA/IChyZW1haW5kZXIgPyByZXN1bHQgLSByZW1haW5kZXIgOiByZXN1bHQpIDogMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGludGVnZXIgc3VpdGFibGUgZm9yIHVzZSBhcyB0aGUgbGVuZ3RoIG9mIGFuXG4gICAgICogYXJyYXktbGlrZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb25cbiAgICAgKiBbYFRvTGVuZ3RoYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9sZW5ndGgpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBpbnRlZ2VyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnRvTGVuZ3RoKDMuMik7XG4gICAgICogLy8gPT4gM1xuICAgICAqXG4gICAgICogXy50b0xlbmd0aChOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgKiAvLyA9PiAwXG4gICAgICpcbiAgICAgKiBfLnRvTGVuZ3RoKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiA0Mjk0OTY3Mjk1XG4gICAgICpcbiAgICAgKiBfLnRvTGVuZ3RoKCczLjInKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9MZW5ndGgodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA/IGJhc2VDbGFtcCh0b0ludGVnZXIodmFsdWUpLCAwLCBNQVhfQVJSQVlfTEVOR1RIKSA6IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIG51bWJlci5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBMYW5nXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvY2Vzcy5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBudW1iZXIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udG9OdW1iZXIoMy4yKTtcbiAgICAgKiAvLyA9PiAzLjJcbiAgICAgKlxuICAgICAqIF8udG9OdW1iZXIoTnVtYmVyLk1JTl9WQUxVRSk7XG4gICAgICogLy8gPT4gNWUtMzI0XG4gICAgICpcbiAgICAgKiBfLnRvTnVtYmVyKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiBJbmZpbml0eVxuICAgICAqXG4gICAgICogXy50b051bWJlcignMy4yJyk7XG4gICAgICogLy8gPT4gMy4yXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9OdW1iZXIodmFsdWUpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgICAgaWYgKGlzU3ltYm9sKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gTkFOO1xuICAgICAgfVxuICAgICAgaWYgKGlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgb3RoZXIgPSB0eXBlb2YgdmFsdWUudmFsdWVPZiA9PSAnZnVuY3Rpb24nID8gdmFsdWUudmFsdWVPZigpIDogdmFsdWU7XG4gICAgICAgIHZhbHVlID0gaXNPYmplY3Qob3RoZXIpID8gKG90aGVyICsgJycpIDogb3RoZXI7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogK3ZhbHVlO1xuICAgICAgfVxuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHJlVHJpbSwgJycpO1xuICAgICAgdmFyIGlzQmluYXJ5ID0gcmVJc0JpbmFyeS50ZXN0KHZhbHVlKTtcbiAgICAgIHJldHVybiAoaXNCaW5hcnkgfHwgcmVJc09jdGFsLnRlc3QodmFsdWUpKVxuICAgICAgICA/IGZyZWVQYXJzZUludCh2YWx1ZS5zbGljZSgyKSwgaXNCaW5hcnkgPyAyIDogOClcbiAgICAgICAgOiAocmVJc0JhZEhleC50ZXN0KHZhbHVlKSA/IE5BTiA6ICt2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHBsYWluIG9iamVjdCBmbGF0dGVuaW5nIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZ1xuICAgICAqIGtleWVkIHByb3BlcnRpZXMgb2YgYHZhbHVlYCB0byBvd24gcHJvcGVydGllcyBvZiB0aGUgcGxhaW4gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBwbGFpbiBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYiA9IDI7XG4gICAgICogfVxuICAgICAqXG4gICAgICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAgICAgKlxuICAgICAqIF8uYXNzaWduKHsgJ2EnOiAxIH0sIG5ldyBGb28pO1xuICAgICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfVxuICAgICAqXG4gICAgICogXy5hc3NpZ24oeyAnYSc6IDEgfSwgXy50b1BsYWluT2JqZWN0KG5ldyBGb28pKTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDMgfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvUGxhaW5PYmplY3QodmFsdWUpIHtcbiAgICAgIHJldHVybiBjb3B5T2JqZWN0KHZhbHVlLCBrZXlzSW4odmFsdWUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc2FmZSBpbnRlZ2VyLiBBIHNhZmUgaW50ZWdlciBjYW4gYmUgY29tcGFyZWQgYW5kXG4gICAgICogcmVwcmVzZW50ZWQgY29ycmVjdGx5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBpbnRlZ2VyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnRvU2FmZUludGVnZXIoMy4yKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICpcbiAgICAgKiBfLnRvU2FmZUludGVnZXIoTnVtYmVyLk1JTl9WQUxVRSk7XG4gICAgICogLy8gPT4gMFxuICAgICAqXG4gICAgICogXy50b1NhZmVJbnRlZ2VyKEluZmluaXR5KTtcbiAgICAgKiAvLyA9PiA5MDA3MTk5MjU0NzQwOTkxXG4gICAgICpcbiAgICAgKiBfLnRvU2FmZUludGVnZXIoJzMuMicpO1xuICAgICAqIC8vID0+IDNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b1NhZmVJbnRlZ2VyKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWVcbiAgICAgICAgPyBiYXNlQ2xhbXAodG9JbnRlZ2VyKHZhbHVlKSwgLU1BWF9TQUZFX0lOVEVHRVIsIE1BWF9TQUZFX0lOVEVHRVIpXG4gICAgICAgIDogKHZhbHVlID09PSAwID8gdmFsdWUgOiAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nLiBBbiBlbXB0eSBzdHJpbmcgaXMgcmV0dXJuZWQgZm9yIGBudWxsYFxuICAgICAqIGFuZCBgdW5kZWZpbmVkYCB2YWx1ZXMuIFRoZSBzaWduIG9mIGAtMGAgaXMgcHJlc2VydmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IExhbmdcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udG9TdHJpbmcobnVsbCk7XG4gICAgICogLy8gPT4gJydcbiAgICAgKlxuICAgICAqIF8udG9TdHJpbmcoLTApO1xuICAgICAqIC8vID0+ICctMCdcbiAgICAgKlxuICAgICAqIF8udG9TdHJpbmcoWzEsIDIsIDNdKTtcbiAgICAgKiAvLyA9PiAnMSwyLDMnXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9TdHJpbmcodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gJycgOiBiYXNlVG9TdHJpbmcodmFsdWUpO1xuICAgIH1cblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIEFzc2lnbnMgb3duIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnRpZXMgb2Ygc291cmNlIG9iamVjdHMgdG8gdGhlXG4gICAgICogZGVzdGluYXRpb24gb2JqZWN0LiBTb3VyY2Ugb2JqZWN0cyBhcmUgYXBwbGllZCBmcm9tIGxlZnQgdG8gcmlnaHQuXG4gICAgICogU3Vic2VxdWVudCBzb3VyY2VzIG92ZXJ3cml0ZSBwcm9wZXJ0eSBhc3NpZ25tZW50cyBvZiBwcmV2aW91cyBzb3VyY2VzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAgYW5kIGlzIGxvb3NlbHkgYmFzZWQgb25cbiAgICAgKiBbYE9iamVjdC5hc3NpZ25gXShodHRwczovL21kbi5pby9PYmplY3QvYXNzaWduKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjEwLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBbc291cmNlc10gVGhlIHNvdXJjZSBvYmplY3RzLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICogQHNlZSBfLmFzc2lnbkluXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYSA9IDE7XG4gICAgICogfVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gQmFyKCkge1xuICAgICAqICAgdGhpcy5jID0gMztcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBGb28ucHJvdG90eXBlLmIgPSAyO1xuICAgICAqIEJhci5wcm90b3R5cGUuZCA9IDQ7XG4gICAgICpcbiAgICAgKiBfLmFzc2lnbih7ICdhJzogMCB9LCBuZXcgRm9vLCBuZXcgQmFyKTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2MnOiAzIH1cbiAgICAgKi9cbiAgICB2YXIgYXNzaWduID0gY3JlYXRlQXNzaWduZXIoZnVuY3Rpb24ob2JqZWN0LCBzb3VyY2UpIHtcbiAgICAgIGlmIChpc1Byb3RvdHlwZShzb3VyY2UpIHx8IGlzQXJyYXlMaWtlKHNvdXJjZSkpIHtcbiAgICAgICAgY29weU9iamVjdChzb3VyY2UsIGtleXMoc291cmNlKSwgb2JqZWN0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcbiAgICAgICAgICBhc3NpZ25WYWx1ZShvYmplY3QsIGtleSwgc291cmNlW2tleV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmFzc2lnbmAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBvd24gYW5kXG4gICAgICogaW5oZXJpdGVkIHNvdXJjZSBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAYWxpYXMgZXh0ZW5kXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gey4uLk9iamVjdH0gW3NvdXJjZXNdIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5hc3NpZ25cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gMTtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBCYXIoKSB7XG4gICAgICogICB0aGlzLmMgPSAzO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYiA9IDI7XG4gICAgICogQmFyLnByb3RvdHlwZS5kID0gNDtcbiAgICAgKlxuICAgICAqIF8uYXNzaWduSW4oeyAnYSc6IDAgfSwgbmV3IEZvbywgbmV3IEJhcik7XG4gICAgICogLy8gPT4geyAnYSc6IDEsICdiJzogMiwgJ2MnOiAzLCAnZCc6IDQgfVxuICAgICAqL1xuICAgIHZhciBhc3NpZ25JbiA9IGNyZWF0ZUFzc2lnbmVyKGZ1bmN0aW9uKG9iamVjdCwgc291cmNlKSB7XG4gICAgICBjb3B5T2JqZWN0KHNvdXJjZSwga2V5c0luKHNvdXJjZSksIG9iamVjdCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmFzc2lnbkluYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjdXN0b21pemVyYFxuICAgICAqIHdoaWNoIGlzIGludm9rZWQgdG8gcHJvZHVjZSB0aGUgYXNzaWduZWQgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgcmV0dXJuc1xuICAgICAqIGB1bmRlZmluZWRgLCBhc3NpZ25tZW50IGlzIGhhbmRsZWQgYnkgdGhlIG1ldGhvZCBpbnN0ZWFkLiBUaGUgYGN1c3RvbWl6ZXJgXG4gICAgICogaXMgaW52b2tlZCB3aXRoIGZpdmUgYXJndW1lbnRzOiAob2JqVmFsdWUsIHNyY1ZhbHVlLCBrZXksIG9iamVjdCwgc291cmNlKS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGFsaWFzIGV4dGVuZFdpdGhcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBzb3VyY2VzIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBhc3NpZ25lZCB2YWx1ZXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAc2VlIF8uYXNzaWduV2l0aFxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBjdXN0b21pemVyKG9ialZhbHVlLCBzcmNWYWx1ZSkge1xuICAgICAqICAgcmV0dXJuIF8uaXNVbmRlZmluZWQob2JqVmFsdWUpID8gc3JjVmFsdWUgOiBvYmpWYWx1ZTtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgZGVmYXVsdHMgPSBfLnBhcnRpYWxSaWdodChfLmFzc2lnbkluV2l0aCwgY3VzdG9taXplcik7XG4gICAgICpcbiAgICAgKiBkZWZhdWx0cyh7ICdhJzogMSB9LCB7ICdiJzogMiB9LCB7ICdhJzogMyB9KTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyIH1cbiAgICAgKi9cbiAgICB2YXIgYXNzaWduSW5XaXRoID0gY3JlYXRlQXNzaWduZXIoZnVuY3Rpb24ob2JqZWN0LCBzb3VyY2UsIHNyY0luZGV4LCBjdXN0b21pemVyKSB7XG4gICAgICBjb3B5T2JqZWN0KHNvdXJjZSwga2V5c0luKHNvdXJjZSksIG9iamVjdCwgY3VzdG9taXplcik7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmFzc2lnbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmBcbiAgICAgKiB3aGljaCBpcyBpbnZva2VkIHRvIHByb2R1Y2UgdGhlIGFzc2lnbmVkIHZhbHVlcy4gSWYgYGN1c3RvbWl6ZXJgIHJldHVybnNcbiAgICAgKiBgdW5kZWZpbmVkYCwgYXNzaWdubWVudCBpcyBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYFxuICAgICAqIGlzIGludm9rZWQgd2l0aCBmaXZlIGFyZ3VtZW50czogKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSkuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgbXV0YXRlcyBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gICAgICogQHBhcmFtIHsuLi5PYmplY3R9IHNvdXJjZXMgVGhlIHNvdXJjZSBvYmplY3RzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5hc3NpZ25JbldpdGhcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gY3VzdG9taXplcihvYmpWYWx1ZSwgc3JjVmFsdWUpIHtcbiAgICAgKiAgIHJldHVybiBfLmlzVW5kZWZpbmVkKG9ialZhbHVlKSA/IHNyY1ZhbHVlIDogb2JqVmFsdWU7XG4gICAgICogfVxuICAgICAqXG4gICAgICogdmFyIGRlZmF1bHRzID0gXy5wYXJ0aWFsUmlnaHQoXy5hc3NpZ25XaXRoLCBjdXN0b21pemVyKTtcbiAgICAgKlxuICAgICAqIGRlZmF1bHRzKHsgJ2EnOiAxIH0sIHsgJ2InOiAyIH0sIHsgJ2EnOiAzIH0pO1xuICAgICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfVxuICAgICAqL1xuICAgIHZhciBhc3NpZ25XaXRoID0gY3JlYXRlQXNzaWduZXIoZnVuY3Rpb24ob2JqZWN0LCBzb3VyY2UsIHNyY0luZGV4LCBjdXN0b21pemVyKSB7XG4gICAgICBjb3B5T2JqZWN0KHNvdXJjZSwga2V5cyhzb3VyY2UpLCBvYmplY3QsIGN1c3RvbWl6ZXIpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byBgcGF0aHNgIG9mIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDEuMC4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHsuLi4oc3RyaW5nfHN0cmluZ1tdKX0gW3BhdGhzXSBUaGUgcHJvcGVydHkgcGF0aHMgdG8gcGljay5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHBpY2tlZCB2YWx1ZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogW3sgJ2InOiB7ICdjJzogMyB9IH0sIDRdIH07XG4gICAgICpcbiAgICAgKiBfLmF0KG9iamVjdCwgWydhWzBdLmIuYycsICdhWzFdJ10pO1xuICAgICAqIC8vID0+IFszLCA0XVxuICAgICAqL1xuICAgIHZhciBhdCA9IGZsYXRSZXN0KGJhc2VBdCk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIG9iamVjdCB0aGF0IGluaGVyaXRzIGZyb20gdGhlIGBwcm90b3R5cGVgIG9iamVjdC4gSWYgYVxuICAgICAqIGBwcm9wZXJ0aWVzYCBvYmplY3QgaXMgZ2l2ZW4sIGl0cyBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQgcHJvcGVydGllc1xuICAgICAqIGFyZSBhc3NpZ25lZCB0byB0aGUgY3JlYXRlZCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi4zLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHByb3RvdHlwZSBUaGUgb2JqZWN0IHRvIGluaGVyaXQgZnJvbS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW3Byb3BlcnRpZXNdIFRoZSBwcm9wZXJ0aWVzIHRvIGFzc2lnbiB0byB0aGUgb2JqZWN0LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIFNoYXBlKCkge1xuICAgICAqICAgdGhpcy54ID0gMDtcbiAgICAgKiAgIHRoaXMueSA9IDA7XG4gICAgICogfVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gQ2lyY2xlKCkge1xuICAgICAqICAgU2hhcGUuY2FsbCh0aGlzKTtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBDaXJjbGUucHJvdG90eXBlID0gXy5jcmVhdGUoU2hhcGUucHJvdG90eXBlLCB7XG4gICAgICogICAnY29uc3RydWN0b3InOiBDaXJjbGVcbiAgICAgKiB9KTtcbiAgICAgKlxuICAgICAqIHZhciBjaXJjbGUgPSBuZXcgQ2lyY2xlO1xuICAgICAqIGNpcmNsZSBpbnN0YW5jZW9mIENpcmNsZTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBjaXJjbGUgaW5zdGFuY2VvZiBTaGFwZTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlKHByb3RvdHlwZSwgcHJvcGVydGllcykge1xuICAgICAgdmFyIHJlc3VsdCA9IGJhc2VDcmVhdGUocHJvdG90eXBlKTtcbiAgICAgIHJldHVybiBwcm9wZXJ0aWVzID09IG51bGwgPyByZXN1bHQgOiBiYXNlQXNzaWduKHJlc3VsdCwgcHJvcGVydGllcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWducyBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZyBrZXllZCBwcm9wZXJ0aWVzIG9mIHNvdXJjZVxuICAgICAqIG9iamVjdHMgdG8gdGhlIGRlc3RpbmF0aW9uIG9iamVjdCBmb3IgYWxsIGRlc3RpbmF0aW9uIHByb3BlcnRpZXMgdGhhdFxuICAgICAqIHJlc29sdmUgdG8gYHVuZGVmaW5lZGAuIFNvdXJjZSBvYmplY3RzIGFyZSBhcHBsaWVkIGZyb20gbGVmdCB0byByaWdodC5cbiAgICAgKiBPbmNlIGEgcHJvcGVydHkgaXMgc2V0LCBhZGRpdGlvbmFsIHZhbHVlcyBvZiB0aGUgc2FtZSBwcm9wZXJ0eSBhcmUgaWdub3JlZC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gey4uLk9iamVjdH0gW3NvdXJjZXNdIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5kZWZhdWx0c0RlZXBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5kZWZhdWx0cyh7ICdhJzogMSB9LCB7ICdiJzogMiB9LCB7ICdhJzogMyB9KTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyIH1cbiAgICAgKi9cbiAgICB2YXIgZGVmYXVsdHMgPSBiYXNlUmVzdChmdW5jdGlvbihhcmdzKSB7XG4gICAgICBhcmdzLnB1c2godW5kZWZpbmVkLCBjdXN0b21EZWZhdWx0c0Fzc2lnbkluKTtcbiAgICAgIHJldHVybiBhcHBseShhc3NpZ25JbldpdGgsIHVuZGVmaW5lZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRlZmF1bHRzYCBleGNlcHQgdGhhdCBpdCByZWN1cnNpdmVseSBhc3NpZ25zXG4gICAgICogZGVmYXVsdCBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4xMC4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gey4uLk9iamVjdH0gW3NvdXJjZXNdIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5kZWZhdWx0c1xuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmRlZmF1bHRzRGVlcCh7ICdhJzogeyAnYic6IDIgfSB9LCB7ICdhJzogeyAnYic6IDEsICdjJzogMyB9IH0pO1xuICAgICAqIC8vID0+IHsgJ2EnOiB7ICdiJzogMiwgJ2MnOiAzIH0gfVxuICAgICAqL1xuICAgIHZhciBkZWZhdWx0c0RlZXAgPSBiYXNlUmVzdChmdW5jdGlvbihhcmdzKSB7XG4gICAgICBhcmdzLnB1c2godW5kZWZpbmVkLCBjdXN0b21EZWZhdWx0c01lcmdlKTtcbiAgICAgIHJldHVybiBhcHBseShtZXJnZVdpdGgsIHVuZGVmaW5lZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRgIGV4Y2VwdCB0aGF0IGl0IHJldHVybnMgdGhlIGtleSBvZiB0aGUgZmlyc3RcbiAgICAgKiBlbGVtZW50IGBwcmVkaWNhdGVgIHJldHVybnMgdHJ1dGh5IGZvciBpbnN0ZWFkIG9mIHRoZSBlbGVtZW50IGl0c2VsZi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjEuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge3N0cmluZ3x1bmRlZmluZWR9IFJldHVybnMgdGhlIGtleSBvZiB0aGUgbWF0Y2hlZCBlbGVtZW50LFxuICAgICAqICBlbHNlIGB1bmRlZmluZWRgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSB7XG4gICAgICogICAnYmFybmV5JzogIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LFxuICAgICAqICAgJ2ZyZWQnOiAgICB7ICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICAncGViYmxlcyc6IHsgJ2FnZSc6IDEsICAnYWN0aXZlJzogdHJ1ZSB9XG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIF8uZmluZEtleSh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gby5hZ2UgPCA0MDsgfSk7XG4gICAgICogLy8gPT4gJ2Jhcm5leScgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maW5kS2V5KHVzZXJzLCB7ICdhZ2UnOiAxLCAnYWN0aXZlJzogdHJ1ZSB9KTtcbiAgICAgKiAvLyA9PiAncGViYmxlcydcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbmRLZXkodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTtcbiAgICAgKiAvLyA9PiAnZnJlZCdcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uZmluZEtleSh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+ICdiYXJuZXknXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmluZEtleShvYmplY3QsIHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIGJhc2VGaW5kS2V5KG9iamVjdCwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgYmFzZUZvck93bik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5maW5kS2V5YCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mXG4gICAgICogYSBjb2xsZWN0aW9uIGluIHRoZSBvcHBvc2l0ZSBvcmRlci5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAyLjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge3N0cmluZ3x1bmRlZmluZWR9IFJldHVybnMgdGhlIGtleSBvZiB0aGUgbWF0Y2hlZCBlbGVtZW50LFxuICAgICAqICBlbHNlIGB1bmRlZmluZWRgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSB7XG4gICAgICogICAnYmFybmV5JzogIHsgJ2FnZSc6IDM2LCAnYWN0aXZlJzogdHJ1ZSB9LFxuICAgICAqICAgJ2ZyZWQnOiAgICB7ICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0sXG4gICAgICogICAncGViYmxlcyc6IHsgJ2FnZSc6IDEsICAnYWN0aXZlJzogdHJ1ZSB9XG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIF8uZmluZExhc3RLZXkodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8uYWdlIDwgNDA7IH0pO1xuICAgICAqIC8vID0+IHJldHVybnMgJ3BlYmJsZXMnIGFzc3VtaW5nIGBfLmZpbmRLZXlgIHJldHVybnMgJ2Jhcm5leSdcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maW5kTGFzdEtleSh1c2VycywgeyAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0pO1xuICAgICAqIC8vID0+ICdiYXJuZXknXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maW5kTGFzdEtleSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pO1xuICAgICAqIC8vID0+ICdmcmVkJ1xuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maW5kTGFzdEtleSh1c2VycywgJ2FjdGl2ZScpO1xuICAgICAqIC8vID0+ICdwZWJibGVzJ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbmRMYXN0S2V5KG9iamVjdCwgcHJlZGljYXRlKSB7XG4gICAgICByZXR1cm4gYmFzZUZpbmRLZXkob2JqZWN0LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpLCBiYXNlRm9yT3duUmlnaHQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQgcHJvcGVydGllcyBvZiBhblxuICAgICAqIG9iamVjdCBhbmQgaW52b2tlcyBgaXRlcmF0ZWVgIGZvciBlYWNoIHByb3BlcnR5LiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZFxuICAgICAqIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGtleSwgb2JqZWN0KS4gSXRlcmF0ZWUgZnVuY3Rpb25zIG1heSBleGl0XG4gICAgICogaXRlcmF0aW9uIGVhcmx5IGJ5IGV4cGxpY2l0bHkgcmV0dXJuaW5nIGBmYWxzZWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC4zLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5mb3JJblJpZ2h0XG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYSA9IDE7XG4gICAgICogICB0aGlzLmIgPSAyO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7XG4gICAgICpcbiAgICAgKiBfLmZvckluKG5ldyBGb28sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKGtleSk7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4gTG9ncyAnYScsICdiJywgdGhlbiAnYycgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9ySW4ob2JqZWN0LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsXG4gICAgICAgID8gb2JqZWN0XG4gICAgICAgIDogYmFzZUZvcihvYmplY3QsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAzKSwga2V5c0luKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZvckluYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIHByb3BlcnRpZXMgb2ZcbiAgICAgKiBgb2JqZWN0YCBpbiB0aGUgb3Bwb3NpdGUgb3JkZXIuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBzZWUgXy5mb3JJblxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBGb28oKSB7XG4gICAgICogICB0aGlzLmEgPSAxO1xuICAgICAqICAgdGhpcy5iID0gMjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzO1xuICAgICAqXG4gICAgICogXy5mb3JJblJpZ2h0KG5ldyBGb28sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKGtleSk7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4gTG9ncyAnYycsICdiJywgdGhlbiAnYScgYXNzdW1pbmcgYF8uZm9ySW5gIGxvZ3MgJ2EnLCAnYicsIHRoZW4gJ2MnLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvckluUmlnaHQob2JqZWN0LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsXG4gICAgICAgID8gb2JqZWN0XG4gICAgICAgIDogYmFzZUZvclJpZ2h0KG9iamVjdCwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDMpLCBrZXlzSW4pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgb3duIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnRpZXMgb2YgYW4gb2JqZWN0IGFuZFxuICAgICAqIGludm9rZXMgYGl0ZXJhdGVlYCBmb3IgZWFjaCBwcm9wZXJ0eS4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aHJlZVxuICAgICAqIGFyZ3VtZW50czogKHZhbHVlLCBrZXksIG9iamVjdCkuIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb25cbiAgICAgKiBlYXJseSBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuMy4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAc2VlIF8uZm9yT3duUmlnaHRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gMTtcbiAgICAgKiAgIHRoaXMuYiA9IDI7XG4gICAgICogfVxuICAgICAqXG4gICAgICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAgICAgKlxuICAgICAqIF8uZm9yT3duKG5ldyBGb28sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgKiAgIGNvbnNvbGUubG9nKGtleSk7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4gTG9ncyAnYScgdGhlbiAnYicgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9yT3duKG9iamVjdCwgaXRlcmF0ZWUpIHtcbiAgICAgIHJldHVybiBvYmplY3QgJiYgYmFzZUZvck93bihvYmplY3QsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5mb3JPd25gIGV4Y2VwdCB0aGF0IGl0IGl0ZXJhdGVzIG92ZXIgcHJvcGVydGllcyBvZlxuICAgICAqIGBvYmplY3RgIGluIHRoZSBvcHBvc2l0ZSBvcmRlci5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAyLjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICogQHNlZSBfLmZvck93blxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBGb28oKSB7XG4gICAgICogICB0aGlzLmEgPSAxO1xuICAgICAqICAgdGhpcy5iID0gMjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzO1xuICAgICAqXG4gICAgICogXy5mb3JPd25SaWdodChuZXcgRm9vLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICogICBjb25zb2xlLmxvZyhrZXkpO1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+IExvZ3MgJ2InIHRoZW4gJ2EnIGFzc3VtaW5nIGBfLmZvck93bmAgbG9ncyAnYScgdGhlbiAnYicuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9yT3duUmlnaHQob2JqZWN0LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIG9iamVjdCAmJiBiYXNlRm9yT3duUmlnaHQob2JqZWN0LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgZnVuY3Rpb24gcHJvcGVydHkgbmFtZXMgZnJvbSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzXG4gICAgICogb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBmdW5jdGlvbiBuYW1lcy5cbiAgICAgKiBAc2VlIF8uZnVuY3Rpb25zSW5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gXy5jb25zdGFudCgnYScpO1xuICAgICAqICAgdGhpcy5iID0gXy5jb25zdGFudCgnYicpO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IF8uY29uc3RhbnQoJ2MnKTtcbiAgICAgKlxuICAgICAqIF8uZnVuY3Rpb25zKG5ldyBGb28pO1xuICAgICAqIC8vID0+IFsnYScsICdiJ11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmdW5jdGlvbnMob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyBbXSA6IGJhc2VGdW5jdGlvbnMob2JqZWN0LCBrZXlzKG9iamVjdCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgZnVuY3Rpb24gcHJvcGVydHkgbmFtZXMgZnJvbSBvd24gYW5kIGluaGVyaXRlZFxuICAgICAqIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGZ1bmN0aW9uIG5hbWVzLlxuICAgICAqIEBzZWUgXy5mdW5jdGlvbnNcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gXy5jb25zdGFudCgnYScpO1xuICAgICAqICAgdGhpcy5iID0gXy5jb25zdGFudCgnYicpO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IF8uY29uc3RhbnQoJ2MnKTtcbiAgICAgKlxuICAgICAqIF8uZnVuY3Rpb25zSW4obmV3IEZvbyk7XG4gICAgICogLy8gPT4gWydhJywgJ2InLCAnYyddXG4gICAgICovXG4gICAgZnVuY3Rpb24gZnVuY3Rpb25zSW4ob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyBbXSA6IGJhc2VGdW5jdGlvbnMob2JqZWN0LCBrZXlzSW4ob2JqZWN0KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgdmFsdWUgYXQgYHBhdGhgIG9mIGBvYmplY3RgLiBJZiB0aGUgcmVzb2x2ZWQgdmFsdWUgaXNcbiAgICAgKiBgdW5kZWZpbmVkYCwgdGhlIGBkZWZhdWx0VmFsdWVgIGlzIHJldHVybmVkIGluIGl0cyBwbGFjZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjcuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cbiAgICAgKiBAcGFyYW0geyp9IFtkZWZhdWx0VmFsdWVdIFRoZSB2YWx1ZSByZXR1cm5lZCBmb3IgYHVuZGVmaW5lZGAgcmVzb2x2ZWQgdmFsdWVzLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTtcbiAgICAgKlxuICAgICAqIF8uZ2V0KG9iamVjdCwgJ2FbMF0uYi5jJyk7XG4gICAgICogLy8gPT4gM1xuICAgICAqXG4gICAgICogXy5nZXQob2JqZWN0LCBbJ2EnLCAnMCcsICdiJywgJ2MnXSk7XG4gICAgICogLy8gPT4gM1xuICAgICAqXG4gICAgICogXy5nZXQob2JqZWN0LCAnYS5iLmMnLCAnZGVmYXVsdCcpO1xuICAgICAqIC8vID0+ICdkZWZhdWx0J1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldChvYmplY3QsIHBhdGgsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgdmFyIHJlc3VsdCA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogYmFzZUdldChvYmplY3QsIHBhdGgpO1xuICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBgcGF0aGAgaXMgYSBkaXJlY3QgcHJvcGVydHkgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgcGF0aGAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogeyAnYic6IDIgfSB9O1xuICAgICAqIHZhciBvdGhlciA9IF8uY3JlYXRlKHsgJ2EnOiBfLmNyZWF0ZSh7ICdiJzogMiB9KSB9KTtcbiAgICAgKlxuICAgICAqIF8uaGFzKG9iamVjdCwgJ2EnKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmhhcyhvYmplY3QsICdhLmInKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmhhcyhvYmplY3QsIFsnYScsICdiJ10pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaGFzKG90aGVyLCAnYScpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzKG9iamVjdCwgcGF0aCkge1xuICAgICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIGhhc1BhdGgob2JqZWN0LCBwYXRoLCBiYXNlSGFzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHBhdGhgIGlzIGEgZGlyZWN0IG9yIGluaGVyaXRlZCBwcm9wZXJ0eSBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBwYXRoYCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IF8uY3JlYXRlKHsgJ2EnOiBfLmNyZWF0ZSh7ICdiJzogMiB9KSB9KTtcbiAgICAgKlxuICAgICAqIF8uaGFzSW4ob2JqZWN0LCAnYScpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaGFzSW4ob2JqZWN0LCAnYS5iJyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5oYXNJbihvYmplY3QsIFsnYScsICdiJ10pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaGFzSW4ob2JqZWN0LCAnYicpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzSW4ob2JqZWN0LCBwYXRoKSB7XG4gICAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYgaGFzUGF0aChvYmplY3QsIHBhdGgsIGJhc2VIYXNJbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgb2YgdGhlIGludmVydGVkIGtleXMgYW5kIHZhbHVlcyBvZiBgb2JqZWN0YC5cbiAgICAgKiBJZiBgb2JqZWN0YCBjb250YWlucyBkdXBsaWNhdGUgdmFsdWVzLCBzdWJzZXF1ZW50IHZhbHVlcyBvdmVyd3JpdGVcbiAgICAgKiBwcm9wZXJ0eSBhc3NpZ25tZW50cyBvZiBwcmV2aW91cyB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC43LjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGludmVydC5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgaW52ZXJ0ZWQgb2JqZWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEsICdiJzogMiwgJ2MnOiAxIH07XG4gICAgICpcbiAgICAgKiBfLmludmVydChvYmplY3QpO1xuICAgICAqIC8vID0+IHsgJzEnOiAnYycsICcyJzogJ2InIH1cbiAgICAgKi9cbiAgICB2YXIgaW52ZXJ0ID0gY3JlYXRlSW52ZXJ0ZXIoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7XG4gICAgICByZXN1bHRbdmFsdWVdID0ga2V5O1xuICAgIH0sIGNvbnN0YW50KGlkZW50aXR5KSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmludmVydGAgZXhjZXB0IHRoYXQgdGhlIGludmVydGVkIG9iamVjdCBpcyBnZW5lcmF0ZWRcbiAgICAgKiBmcm9tIHRoZSByZXN1bHRzIG9mIHJ1bm5pbmcgZWFjaCBlbGVtZW50IG9mIGBvYmplY3RgIHRocnUgYGl0ZXJhdGVlYC4gVGhlXG4gICAgICogY29ycmVzcG9uZGluZyBpbnZlcnRlZCB2YWx1ZSBvZiBlYWNoIGludmVydGVkIGtleSBpcyBhbiBhcnJheSBvZiBrZXlzXG4gICAgICogcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgdGhlIGludmVydGVkIHZhbHVlLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZFxuICAgICAqIHdpdGggb25lIGFyZ3VtZW50OiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMS4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnZlcnQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBpbnZlcnRlZCBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDEgfTtcbiAgICAgKlxuICAgICAqIF8uaW52ZXJ0Qnkob2JqZWN0KTtcbiAgICAgKiAvLyA9PiB7ICcxJzogWydhJywgJ2MnXSwgJzInOiBbJ2InXSB9XG4gICAgICpcbiAgICAgKiBfLmludmVydEJ5KG9iamVjdCwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgKiAgIHJldHVybiAnZ3JvdXAnICsgdmFsdWU7XG4gICAgICogfSk7XG4gICAgICogLy8gPT4geyAnZ3JvdXAxJzogWydhJywgJ2MnXSwgJ2dyb3VwMic6IFsnYiddIH1cbiAgICAgKi9cbiAgICB2YXIgaW52ZXJ0QnkgPSBjcmVhdGVJbnZlcnRlcihmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3VsdCwgdmFsdWUpKSB7XG4gICAgICAgIHJlc3VsdFt2YWx1ZV0ucHVzaChrZXkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W3ZhbHVlXSA9IFtrZXldO1xuICAgICAgfVxuICAgIH0sIGdldEl0ZXJhdGVlKTtcblxuICAgIC8qKlxuICAgICAqIEludm9rZXMgdGhlIG1ldGhvZCBhdCBgcGF0aGAgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBtZXRob2QgdG8gaW52b2tlLlxuICAgICAqIEBwYXJhbSB7Li4uKn0gW2FyZ3NdIFRoZSBhcmd1bWVudHMgdG8gaW52b2tlIHRoZSBtZXRob2Qgd2l0aC5cbiAgICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzdWx0IG9mIHRoZSBpbnZva2VkIG1ldGhvZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiBbMSwgMiwgMywgNF0gfSB9XSB9O1xuICAgICAqXG4gICAgICogXy5pbnZva2Uob2JqZWN0LCAnYVswXS5iLmMuc2xpY2UnLCAxLCAzKTtcbiAgICAgKiAvLyA9PiBbMiwgM11cbiAgICAgKi9cbiAgICB2YXIgaW52b2tlID0gYmFzZVJlc3QoYmFzZUludm9rZSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLiBTZWUgdGhlXG4gICAgICogW0VTIHNwZWNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKVxuICAgICAqIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYSA9IDE7XG4gICAgICogICB0aGlzLmIgPSAyO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7XG4gICAgICpcbiAgICAgKiBfLmtleXMobmV3IEZvbyk7XG4gICAgICogLy8gPT4gWydhJywgJ2InXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgICAqXG4gICAgICogXy5rZXlzKCdoaScpO1xuICAgICAqIC8vID0+IFsnMCcsICcxJ11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBrZXlzKG9iamVjdCkge1xuICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iamVjdCkgPyBhcnJheUxpa2VLZXlzKG9iamVjdCkgOiBiYXNlS2V5cyhvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBhbmQgaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gMTtcbiAgICAgKiAgIHRoaXMuYiA9IDI7XG4gICAgICogfVxuICAgICAqXG4gICAgICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAgICAgKlxuICAgICAqIF8ua2V5c0luKG5ldyBGb28pO1xuICAgICAqIC8vID0+IFsnYScsICdiJywgJ2MnXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGtleXNJbihvYmplY3QpIHtcbiAgICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QsIHRydWUpIDogYmFzZUtleXNJbihvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5tYXBWYWx1ZXNgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGFuIG9iamVjdCB3aXRoIHRoZVxuICAgICAqIHNhbWUgdmFsdWVzIGFzIGBvYmplY3RgIGFuZCBrZXlzIGdlbmVyYXRlZCBieSBydW5uaW5nIGVhY2ggb3duIGVudW1lcmFibGVcbiAgICAgKiBzdHJpbmcga2V5ZWQgcHJvcGVydHkgb2YgYG9iamVjdGAgdGhydSBgaXRlcmF0ZWVgLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZFxuICAgICAqIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGtleSwgb2JqZWN0KS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjguMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBtYXBwZWQgb2JqZWN0LlxuICAgICAqIEBzZWUgXy5tYXBWYWx1ZXNcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5tYXBLZXlzKHsgJ2EnOiAxLCAnYic6IDIgfSwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAqICAgcmV0dXJuIGtleSArIHZhbHVlO1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+IHsgJ2ExJzogMSwgJ2IyJzogMiB9XG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwS2V5cyhvYmplY3QsIGl0ZXJhdGVlKSB7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBpdGVyYXRlZSA9IGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAzKTtcblxuICAgICAgYmFzZUZvck93bihvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iamVjdCkge1xuICAgICAgICBiYXNlQXNzaWduVmFsdWUocmVzdWx0LCBpdGVyYXRlZSh2YWx1ZSwga2V5LCBvYmplY3QpLCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBrZXlzIGFzIGBvYmplY3RgIGFuZCB2YWx1ZXMgZ2VuZXJhdGVkXG4gICAgICogYnkgcnVubmluZyBlYWNoIG93biBlbnVtZXJhYmxlIHN0cmluZyBrZXllZCBwcm9wZXJ0eSBvZiBgb2JqZWN0YCB0aHJ1XG4gICAgICogYGl0ZXJhdGVlYC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM6XG4gICAgICogKHZhbHVlLCBrZXksIG9iamVjdCkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi40LjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIG9iamVjdC5cbiAgICAgKiBAc2VlIF8ubWFwS2V5c1xuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgdXNlcnMgPSB7XG4gICAgICogICAnZnJlZCc6ICAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhZ2UnOiA0MCB9LFxuICAgICAqICAgJ3BlYmJsZXMnOiB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWdlJzogMSB9XG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIF8ubWFwVmFsdWVzKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiBvLmFnZTsgfSk7XG4gICAgICogLy8gPT4geyAnZnJlZCc6IDQwLCAncGViYmxlcyc6IDEgfSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5tYXBWYWx1ZXModXNlcnMsICdhZ2UnKTtcbiAgICAgKiAvLyA9PiB7ICdmcmVkJzogNDAsICdwZWJibGVzJzogMSB9IChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFwVmFsdWVzKG9iamVjdCwgaXRlcmF0ZWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGl0ZXJhdGVlID0gZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDMpO1xuXG4gICAgICBiYXNlRm9yT3duKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqZWN0KSB7XG4gICAgICAgIGJhc2VBc3NpZ25WYWx1ZShyZXN1bHQsIGtleSwgaXRlcmF0ZWUodmFsdWUsIGtleSwgb2JqZWN0KSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5hc3NpZ25gIGV4Y2VwdCB0aGF0IGl0IHJlY3Vyc2l2ZWx5IG1lcmdlcyBvd24gYW5kXG4gICAgICogaW5oZXJpdGVkIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnRpZXMgb2Ygc291cmNlIG9iamVjdHMgaW50byB0aGVcbiAgICAgKiBkZXN0aW5hdGlvbiBvYmplY3QuIFNvdXJjZSBwcm9wZXJ0aWVzIHRoYXQgcmVzb2x2ZSB0byBgdW5kZWZpbmVkYCBhcmVcbiAgICAgKiBza2lwcGVkIGlmIGEgZGVzdGluYXRpb24gdmFsdWUgZXhpc3RzLiBBcnJheSBhbmQgcGxhaW4gb2JqZWN0IHByb3BlcnRpZXNcbiAgICAgKiBhcmUgbWVyZ2VkIHJlY3Vyc2l2ZWx5LiBPdGhlciBvYmplY3RzIGFuZCB2YWx1ZSB0eXBlcyBhcmUgb3ZlcnJpZGRlbiBieVxuICAgICAqIGFzc2lnbm1lbnQuIFNvdXJjZSBvYmplY3RzIGFyZSBhcHBsaWVkIGZyb20gbGVmdCB0byByaWdodC4gU3Vic2VxdWVudFxuICAgICAqIHNvdXJjZXMgb3ZlcndyaXRlIHByb3BlcnR5IGFzc2lnbm1lbnRzIG9mIHByZXZpb3VzIHNvdXJjZXMuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgbXV0YXRlcyBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAwLjUuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gICAgICogQHBhcmFtIHsuLi5PYmplY3R9IFtzb3VyY2VzXSBUaGUgc291cmNlIG9iamVjdHMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHtcbiAgICAgKiAgICdhJzogW3sgJ2InOiAyIH0sIHsgJ2QnOiA0IH1dXG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIHZhciBvdGhlciA9IHtcbiAgICAgKiAgICdhJzogW3sgJ2MnOiAzIH0sIHsgJ2UnOiA1IH1dXG4gICAgICogfTtcbiAgICAgKlxuICAgICAqIF8ubWVyZ2Uob2JqZWN0LCBvdGhlcik7XG4gICAgICogLy8gPT4geyAnYSc6IFt7ICdiJzogMiwgJ2MnOiAzIH0sIHsgJ2QnOiA0LCAnZSc6IDUgfV0gfVxuICAgICAqL1xuICAgIHZhciBtZXJnZSA9IGNyZWF0ZUFzc2lnbmVyKGZ1bmN0aW9uKG9iamVjdCwgc291cmNlLCBzcmNJbmRleCkge1xuICAgICAgYmFzZU1lcmdlKG9iamVjdCwgc291cmNlLCBzcmNJbmRleCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLm1lcmdlYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjdXN0b21pemVyYCB3aGljaFxuICAgICAqIGlzIGludm9rZWQgdG8gcHJvZHVjZSB0aGUgbWVyZ2VkIHZhbHVlcyBvZiB0aGUgZGVzdGluYXRpb24gYW5kIHNvdXJjZVxuICAgICAqIHByb3BlcnRpZXMuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgLCBtZXJnaW5nIGlzIGhhbmRsZWQgYnkgdGhlXG4gICAgICogbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoIHNpeCBhcmd1bWVudHM6XG4gICAgICogKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSwgc3RhY2spLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBzb3VyY2VzIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgYXNzaWduZWQgdmFsdWVzLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlKSB7XG4gICAgICogICBpZiAoXy5pc0FycmF5KG9ialZhbHVlKSkge1xuICAgICAqICAgICByZXR1cm4gb2JqVmFsdWUuY29uY2F0KHNyY1ZhbHVlKTtcbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IFsxXSwgJ2InOiBbMl0gfTtcbiAgICAgKiB2YXIgb3RoZXIgPSB7ICdhJzogWzNdLCAnYic6IFs0XSB9O1xuICAgICAqXG4gICAgICogXy5tZXJnZVdpdGgob2JqZWN0LCBvdGhlciwgY3VzdG9taXplcik7XG4gICAgICogLy8gPT4geyAnYSc6IFsxLCAzXSwgJ2InOiBbMiwgNF0gfVxuICAgICAqL1xuICAgIHZhciBtZXJnZVdpdGggPSBjcmVhdGVBc3NpZ25lcihmdW5jdGlvbihvYmplY3QsIHNvdXJjZSwgc3JjSW5kZXgsIGN1c3RvbWl6ZXIpIHtcbiAgICAgIGJhc2VNZXJnZShvYmplY3QsIHNvdXJjZSwgc3JjSW5kZXgsIGN1c3RvbWl6ZXIpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG9wcG9zaXRlIG9mIGBfLnBpY2tgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZiB0aGVcbiAgICAgKiBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHByb3BlcnR5IHBhdGhzIG9mIGBvYmplY3RgIHRoYXQgYXJlIG5vdCBvbWl0dGVkLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGNvbnNpZGVyYWJseSBzbG93ZXIgdGhhbiBgXy5waWNrYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7Li4uKHN0cmluZ3xzdHJpbmdbXSl9IFtwYXRoc10gVGhlIHByb3BlcnR5IHBhdGhzIHRvIG9taXQuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6ICcyJywgJ2MnOiAzIH07XG4gICAgICpcbiAgICAgKiBfLm9taXQob2JqZWN0LCBbJ2EnLCAnYyddKTtcbiAgICAgKiAvLyA9PiB7ICdiJzogJzInIH1cbiAgICAgKi9cbiAgICB2YXIgb21pdCA9IGZsYXRSZXN0KGZ1bmN0aW9uKG9iamVjdCwgcGF0aHMpIHtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgdmFyIGlzRGVlcCA9IGZhbHNlO1xuICAgICAgcGF0aHMgPSBhcnJheU1hcChwYXRocywgZnVuY3Rpb24ocGF0aCkge1xuICAgICAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTtcbiAgICAgICAgaXNEZWVwIHx8IChpc0RlZXAgPSBwYXRoLmxlbmd0aCA+IDEpO1xuICAgICAgICByZXR1cm4gcGF0aDtcbiAgICAgIH0pO1xuICAgICAgY29weU9iamVjdChvYmplY3QsIGdldEFsbEtleXNJbihvYmplY3QpLCByZXN1bHQpO1xuICAgICAgaWYgKGlzRGVlcCkge1xuICAgICAgICByZXN1bHQgPSBiYXNlQ2xvbmUocmVzdWx0LCBDTE9ORV9ERUVQX0ZMQUcgfCBDTE9ORV9GTEFUX0ZMQUcgfCBDTE9ORV9TWU1CT0xTX0ZMQUcsIGN1c3RvbU9taXRDbG9uZSk7XG4gICAgICB9XG4gICAgICB2YXIgbGVuZ3RoID0gcGF0aHMubGVuZ3RoO1xuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIGJhc2VVbnNldChyZXN1bHQsIHBhdGhzW2xlbmd0aF0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5waWNrQnlgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZlxuICAgICAqIHRoZSBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZyBrZXllZCBwcm9wZXJ0aWVzIG9mIGBvYmplY3RgIHRoYXRcbiAgICAgKiBgcHJlZGljYXRlYCBkb2Vzbid0IHJldHVybiB0cnV0aHkgZm9yLiBUaGUgcHJlZGljYXRlIGlzIGludm9rZWQgd2l0aCB0d29cbiAgICAgKiBhcmd1bWVudHM6ICh2YWx1ZSwga2V5KS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIHByb3BlcnR5LlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSwgJ2InOiAnMicsICdjJzogMyB9O1xuICAgICAqXG4gICAgICogXy5vbWl0Qnkob2JqZWN0LCBfLmlzTnVtYmVyKTtcbiAgICAgKiAvLyA9PiB7ICdiJzogJzInIH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvbWl0Qnkob2JqZWN0LCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiBwaWNrQnkob2JqZWN0LCBuZWdhdGUoZ2V0SXRlcmF0ZWUocHJlZGljYXRlKSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IGNvbXBvc2VkIG9mIHRoZSBwaWNrZWQgYG9iamVjdGAgcHJvcGVydGllcy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBzb3VyY2Ugb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7Li4uKHN0cmluZ3xzdHJpbmdbXSl9IFtwYXRoc10gVGhlIHByb3BlcnR5IHBhdGhzIHRvIHBpY2suXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6ICcyJywgJ2MnOiAzIH07XG4gICAgICpcbiAgICAgKiBfLnBpY2sob2JqZWN0LCBbJ2EnLCAnYyddKTtcbiAgICAgKiAvLyA9PiB7ICdhJzogMSwgJ2MnOiAzIH1cbiAgICAgKi9cbiAgICB2YXIgcGljayA9IGZsYXRSZXN0KGZ1bmN0aW9uKG9iamVjdCwgcGF0aHMpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHt9IDogYmFzZVBpY2sob2JqZWN0LCBwYXRocyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZiB0aGUgYG9iamVjdGAgcHJvcGVydGllcyBgcHJlZGljYXRlYCByZXR1cm5zXG4gICAgICogdHJ1dGh5IGZvci4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKHZhbHVlLCBrZXkpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgcHJvcGVydHkuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6ICcyJywgJ2MnOiAzIH07XG4gICAgICpcbiAgICAgKiBfLnBpY2tCeShvYmplY3QsIF8uaXNOdW1iZXIpO1xuICAgICAqIC8vID0+IHsgJ2EnOiAxLCAnYyc6IDMgfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHBpY2tCeShvYmplY3QsIHByZWRpY2F0ZSkge1xuICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH1cbiAgICAgIHZhciBwcm9wcyA9IGFycmF5TWFwKGdldEFsbEtleXNJbihvYmplY3QpLCBmdW5jdGlvbihwcm9wKSB7XG4gICAgICAgIHJldHVybiBbcHJvcF07XG4gICAgICB9KTtcbiAgICAgIHByZWRpY2F0ZSA9IGdldEl0ZXJhdGVlKHByZWRpY2F0ZSk7XG4gICAgICByZXR1cm4gYmFzZVBpY2tCeShvYmplY3QsIHByb3BzLCBmdW5jdGlvbih2YWx1ZSwgcGF0aCkge1xuICAgICAgICByZXR1cm4gcHJlZGljYXRlKHZhbHVlLCBwYXRoWzBdKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZ2V0YCBleGNlcHQgdGhhdCBpZiB0aGUgcmVzb2x2ZWQgdmFsdWUgaXMgYVxuICAgICAqIGZ1bmN0aW9uIGl0J3MgaW52b2tlZCB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiBpdHMgcGFyZW50IG9iamVjdCBhbmRcbiAgICAgKiBpdHMgcmVzdWx0IGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gcmVzb2x2ZS5cbiAgICAgKiBAcGFyYW0geyp9IFtkZWZhdWx0VmFsdWVdIFRoZSB2YWx1ZSByZXR1cm5lZCBmb3IgYHVuZGVmaW5lZGAgcmVzb2x2ZWQgdmFsdWVzLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MxJzogMywgJ2MyJzogXy5jb25zdGFudCg0KSB9IH1dIH07XG4gICAgICpcbiAgICAgKiBfLnJlc3VsdChvYmplY3QsICdhWzBdLmIuYzEnKTtcbiAgICAgKiAvLyA9PiAzXG4gICAgICpcbiAgICAgKiBfLnJlc3VsdChvYmplY3QsICdhWzBdLmIuYzInKTtcbiAgICAgKiAvLyA9PiA0XG4gICAgICpcbiAgICAgKiBfLnJlc3VsdChvYmplY3QsICdhWzBdLmIuYzMnLCAnZGVmYXVsdCcpO1xuICAgICAqIC8vID0+ICdkZWZhdWx0J1xuICAgICAqXG4gICAgICogXy5yZXN1bHQob2JqZWN0LCAnYVswXS5iLmMzJywgXy5jb25zdGFudCgnZGVmYXVsdCcpKTtcbiAgICAgKiAvLyA9PiAnZGVmYXVsdCdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZXN1bHQob2JqZWN0LCBwYXRoLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpO1xuXG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aDtcblxuICAgICAgLy8gRW5zdXJlIHRoZSBsb29wIGlzIGVudGVyZWQgd2hlbiBwYXRoIGlzIGVtcHR5LlxuICAgICAgaWYgKCFsZW5ndGgpIHtcbiAgICAgICAgbGVuZ3RoID0gMTtcbiAgICAgICAgb2JqZWN0ID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBvYmplY3RbdG9LZXkocGF0aFtpbmRleF0pXTtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbmRleCA9IGxlbmd0aDtcbiAgICAgICAgICB2YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBvYmplY3QgPSBpc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlLmNhbGwob2JqZWN0KSA6IHZhbHVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSB2YWx1ZSBhdCBgcGF0aGAgb2YgYG9iamVjdGAuIElmIGEgcG9ydGlvbiBvZiBgcGF0aGAgZG9lc24ndCBleGlzdCxcbiAgICAgKiBpdCdzIGNyZWF0ZWQuIEFycmF5cyBhcmUgY3JlYXRlZCBmb3IgbWlzc2luZyBpbmRleCBwcm9wZXJ0aWVzIHdoaWxlIG9iamVjdHNcbiAgICAgKiBhcmUgY3JlYXRlZCBmb3IgYWxsIG90aGVyIG1pc3NpbmcgcHJvcGVydGllcy4gVXNlIGBfLnNldFdpdGhgIHRvIGN1c3RvbWl6ZVxuICAgICAqIGBwYXRoYCBjcmVhdGlvbi5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuNy4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHNldC5cbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTtcbiAgICAgKlxuICAgICAqIF8uc2V0KG9iamVjdCwgJ2FbMF0uYi5jJywgNCk7XG4gICAgICogY29uc29sZS5sb2cob2JqZWN0LmFbMF0uYi5jKTtcbiAgICAgKiAvLyA9PiA0XG4gICAgICpcbiAgICAgKiBfLnNldChvYmplY3QsIFsneCcsICcwJywgJ3knLCAneiddLCA1KTtcbiAgICAgKiBjb25zb2xlLmxvZyhvYmplY3QueFswXS55LnopO1xuICAgICAqIC8vID0+IDVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXQob2JqZWN0LCBwYXRoLCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gb2JqZWN0IDogYmFzZVNldChvYmplY3QsIHBhdGgsIHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNldGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmAgd2hpY2ggaXNcbiAgICAgKiBpbnZva2VkIHRvIHByb2R1Y2UgdGhlIG9iamVjdHMgb2YgYHBhdGhgLiAgSWYgYGN1c3RvbWl6ZXJgIHJldHVybnMgYHVuZGVmaW5lZGBcbiAgICAgKiBwYXRoIGNyZWF0aW9uIGlzIGhhbmRsZWQgYnkgdGhlIG1ldGhvZCBpbnN0ZWFkLiBUaGUgYGN1c3RvbWl6ZXJgIGlzIGludm9rZWRcbiAgICAgKiB3aXRoIHRocmVlIGFyZ3VtZW50czogKG5zVmFsdWUsIGtleSwgbnNPYmplY3QpLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gc2V0LlxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBhc3NpZ25lZCB2YWx1ZXMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdCA9IHt9O1xuICAgICAqXG4gICAgICogXy5zZXRXaXRoKG9iamVjdCwgJ1swXVsxXScsICdhJywgT2JqZWN0KTtcbiAgICAgKiAvLyA9PiB7ICcwJzogeyAnMSc6ICdhJyB9IH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXRXaXRoKG9iamVjdCwgcGF0aCwgdmFsdWUsIGN1c3RvbWl6ZXIpIHtcbiAgICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgY3VzdG9taXplciA9PSAnZnVuY3Rpb24nID8gY3VzdG9taXplciA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IG9iamVjdCA6IGJhc2VTZXQob2JqZWN0LCBwYXRoLCB2YWx1ZSwgY3VzdG9taXplcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQtdmFsdWUgcGFpcnMgZm9yIGBvYmplY3RgXG4gICAgICogd2hpY2ggY2FuIGJlIGNvbnN1bWVkIGJ5IGBfLmZyb21QYWlyc2AuIElmIGBvYmplY3RgIGlzIGEgbWFwIG9yIHNldCwgaXRzXG4gICAgICogZW50cmllcyBhcmUgcmV0dXJuZWQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAYWxpYXMgZW50cmllc1xuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBrZXktdmFsdWUgcGFpcnMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYSA9IDE7XG4gICAgICogICB0aGlzLmIgPSAyO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7XG4gICAgICpcbiAgICAgKiBfLnRvUGFpcnMobmV3IEZvbyk7XG4gICAgICogLy8gPT4gW1snYScsIDFdLCBbJ2InLCAyXV0gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICAgKi9cbiAgICB2YXIgdG9QYWlycyA9IGNyZWF0ZVRvUGFpcnMoa2V5cyk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIG93biBhbmQgaW5oZXJpdGVkIGVudW1lcmFibGUgc3RyaW5nIGtleWVkLXZhbHVlIHBhaXJzXG4gICAgICogZm9yIGBvYmplY3RgIHdoaWNoIGNhbiBiZSBjb25zdW1lZCBieSBgXy5mcm9tUGFpcnNgLiBJZiBgb2JqZWN0YCBpcyBhIG1hcFxuICAgICAqIG9yIHNldCwgaXRzIGVudHJpZXMgYXJlIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGFsaWFzIGVudHJpZXNJblxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBrZXktdmFsdWUgcGFpcnMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGZ1bmN0aW9uIEZvbygpIHtcbiAgICAgKiAgIHRoaXMuYSA9IDE7XG4gICAgICogICB0aGlzLmIgPSAyO1xuICAgICAqIH1cbiAgICAgKlxuICAgICAqIEZvby5wcm90b3R5cGUuYyA9IDM7XG4gICAgICpcbiAgICAgKiBfLnRvUGFpcnNJbihuZXcgRm9vKTtcbiAgICAgKiAvLyA9PiBbWydhJywgMV0sIFsnYicsIDJdLCBbJ2MnLCAzXV0gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICAgKi9cbiAgICB2YXIgdG9QYWlyc0luID0gY3JlYXRlVG9QYWlycyhrZXlzSW4pO1xuXG4gICAgLyoqXG4gICAgICogQW4gYWx0ZXJuYXRpdmUgdG8gYF8ucmVkdWNlYDsgdGhpcyBtZXRob2QgdHJhbnNmb3JtcyBgb2JqZWN0YCB0byBhIG5ld1xuICAgICAqIGBhY2N1bXVsYXRvcmAgb2JqZWN0IHdoaWNoIGlzIHRoZSByZXN1bHQgb2YgcnVubmluZyBlYWNoIG9mIGl0cyBvd25cbiAgICAgKiBlbnVtZXJhYmxlIHN0cmluZyBrZXllZCBwcm9wZXJ0aWVzIHRocnUgYGl0ZXJhdGVlYCwgd2l0aCBlYWNoIGludm9jYXRpb25cbiAgICAgKiBwb3RlbnRpYWxseSBtdXRhdGluZyB0aGUgYGFjY3VtdWxhdG9yYCBvYmplY3QuIElmIGBhY2N1bXVsYXRvcmAgaXMgbm90XG4gICAgICogcHJvdmlkZWQsIGEgbmV3IG9iamVjdCB3aXRoIHRoZSBzYW1lIGBbW1Byb3RvdHlwZV1dYCB3aWxsIGJlIHVzZWQuIFRoZVxuICAgICAqIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBmb3VyIGFyZ3VtZW50czogKGFjY3VtdWxhdG9yLCB2YWx1ZSwga2V5LCBvYmplY3QpLlxuICAgICAqIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjMuMFxuICAgICAqIEBjYXRlZ29yeSBPYmplY3RcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEBwYXJhbSB7Kn0gW2FjY3VtdWxhdG9yXSBUaGUgY3VzdG9tIGFjY3VtdWxhdG9yIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50cmFuc2Zvcm0oWzIsIDMsIDRdLCBmdW5jdGlvbihyZXN1bHQsIG4pIHtcbiAgICAgKiAgIHJlc3VsdC5wdXNoKG4gKj0gbik7XG4gICAgICogICByZXR1cm4gbiAlIDIgPT0gMDtcbiAgICAgKiB9LCBbXSk7XG4gICAgICogLy8gPT4gWzQsIDldXG4gICAgICpcbiAgICAgKiBfLnRyYW5zZm9ybSh7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDEgfSwgZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7XG4gICAgICogICAocmVzdWx0W3ZhbHVlXSB8fCAocmVzdWx0W3ZhbHVlXSA9IFtdKSkucHVzaChrZXkpO1xuICAgICAqIH0sIHt9KTtcbiAgICAgKiAvLyA9PiB7ICcxJzogWydhJywgJ2MnXSwgJzInOiBbJ2InXSB9XG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJhbnNmb3JtKG9iamVjdCwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yKSB7XG4gICAgICB2YXIgaXNBcnIgPSBpc0FycmF5KG9iamVjdCksXG4gICAgICAgICAgaXNBcnJMaWtlID0gaXNBcnIgfHwgaXNCdWZmZXIob2JqZWN0KSB8fCBpc1R5cGVkQXJyYXkob2JqZWN0KTtcblxuICAgICAgaXRlcmF0ZWUgPSBnZXRJdGVyYXRlZShpdGVyYXRlZSwgNCk7XG4gICAgICBpZiAoYWNjdW11bGF0b3IgPT0gbnVsbCkge1xuICAgICAgICB2YXIgQ3RvciA9IG9iamVjdCAmJiBvYmplY3QuY29uc3RydWN0b3I7XG4gICAgICAgIGlmIChpc0Fyckxpa2UpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvciA9IGlzQXJyID8gbmV3IEN0b3IgOiBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc09iamVjdChvYmplY3QpKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3IgPSBpc0Z1bmN0aW9uKEN0b3IpID8gYmFzZUNyZWF0ZShnZXRQcm90b3R5cGUob2JqZWN0KSkgOiB7fTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBhY2N1bXVsYXRvciA9IHt9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAoaXNBcnJMaWtlID8gYXJyYXlFYWNoIDogYmFzZUZvck93bikob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIG9iamVjdCkge1xuICAgICAgICByZXR1cm4gaXRlcmF0ZWUoYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgb2JqZWN0KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHByb3BlcnR5IGF0IGBwYXRoYCBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHVuc2V0LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgcHJvcGVydHkgaXMgZGVsZXRlZCwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IFt7ICdiJzogeyAnYyc6IDcgfSB9XSB9O1xuICAgICAqIF8udW5zZXQob2JqZWN0LCAnYVswXS5iLmMnKTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBjb25zb2xlLmxvZyhvYmplY3QpO1xuICAgICAqIC8vID0+IHsgJ2EnOiBbeyAnYic6IHt9IH1dIH07XG4gICAgICpcbiAgICAgKiBfLnVuc2V0KG9iamVjdCwgWydhJywgJzAnLCAnYicsICdjJ10pO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKG9iamVjdCk7XG4gICAgICogLy8gPT4geyAnYSc6IFt7ICdiJzoge30gfV0gfTtcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bnNldChvYmplY3QsIHBhdGgpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHRydWUgOiBiYXNlVW5zZXQob2JqZWN0LCBwYXRoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNldGAgZXhjZXB0IHRoYXQgYWNjZXB0cyBgdXBkYXRlcmAgdG8gcHJvZHVjZSB0aGVcbiAgICAgKiB2YWx1ZSB0byBzZXQuIFVzZSBgXy51cGRhdGVXaXRoYCB0byBjdXN0b21pemUgYHBhdGhgIGNyZWF0aW9uLiBUaGUgYHVwZGF0ZXJgXG4gICAgICogaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNi4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB1cGRhdGVyIFRoZSBmdW5jdGlvbiB0byBwcm9kdWNlIHRoZSB1cGRhdGVkIHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogW3sgJ2InOiB7ICdjJzogMyB9IH1dIH07XG4gICAgICpcbiAgICAgKiBfLnVwZGF0ZShvYmplY3QsICdhWzBdLmIuYycsIGZ1bmN0aW9uKG4pIHsgcmV0dXJuIG4gKiBuOyB9KTtcbiAgICAgKiBjb25zb2xlLmxvZyhvYmplY3QuYVswXS5iLmMpO1xuICAgICAqIC8vID0+IDlcbiAgICAgKlxuICAgICAqIF8udXBkYXRlKG9iamVjdCwgJ3hbMF0ueS56JywgZnVuY3Rpb24obikgeyByZXR1cm4gbiA/IG4gKyAxIDogMDsgfSk7XG4gICAgICogY29uc29sZS5sb2cob2JqZWN0LnhbMF0ueS56KTtcbiAgICAgKiAvLyA9PiAwXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXBkYXRlKG9iamVjdCwgcGF0aCwgdXBkYXRlcikge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gb2JqZWN0IDogYmFzZVVwZGF0ZShvYmplY3QsIHBhdGgsIGNhc3RGdW5jdGlvbih1cGRhdGVyKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy51cGRhdGVgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGN1c3RvbWl6ZXJgIHdoaWNoIGlzXG4gICAgICogaW52b2tlZCB0byBwcm9kdWNlIHRoZSBvYmplY3RzIG9mIGBwYXRoYC4gIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgXG4gICAgICogcGF0aCBjcmVhdGlvbiBpcyBoYW5kbGVkIGJ5IHRoZSBtZXRob2QgaW5zdGVhZC4gVGhlIGBjdXN0b21pemVyYCBpcyBpbnZva2VkXG4gICAgICogd2l0aCB0aHJlZSBhcmd1bWVudHM6IChuc1ZhbHVlLCBrZXksIG5zT2JqZWN0KS5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNi4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB1cGRhdGVyIFRoZSBmdW5jdGlvbiB0byBwcm9kdWNlIHRoZSB1cGRhdGVkIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0ID0ge307XG4gICAgICpcbiAgICAgKiBfLnVwZGF0ZVdpdGgob2JqZWN0LCAnWzBdWzFdJywgXy5jb25zdGFudCgnYScpLCBPYmplY3QpO1xuICAgICAqIC8vID0+IHsgJzAnOiB7ICcxJzogJ2EnIH0gfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZVdpdGgob2JqZWN0LCBwYXRoLCB1cGRhdGVyLCBjdXN0b21pemVyKSB7XG4gICAgICBjdXN0b21pemVyID0gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGN1c3RvbWl6ZXIgOiB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyBvYmplY3QgOiBiYXNlVXBkYXRlKG9iamVjdCwgcGF0aCwgY2FzdEZ1bmN0aW9uKHVwZGF0ZXIpLCBjdXN0b21pemVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQgcHJvcGVydHkgdmFsdWVzIG9mIGBvYmplY3RgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIE5vbi1vYmplY3QgdmFsdWVzIGFyZSBjb2VyY2VkIHRvIG9iamVjdHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgT2JqZWN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgdmFsdWVzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBmdW5jdGlvbiBGb28oKSB7XG4gICAgICogICB0aGlzLmEgPSAxO1xuICAgICAqICAgdGhpcy5iID0gMjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiBGb28ucHJvdG90eXBlLmMgPSAzO1xuICAgICAqXG4gICAgICogXy52YWx1ZXMobmV3IEZvbyk7XG4gICAgICogLy8gPT4gWzEsIDJdIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gICAgICpcbiAgICAgKiBfLnZhbHVlcygnaGknKTtcbiAgICAgKiAvLyA9PiBbJ2gnLCAnaSddXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsdWVzKG9iamVjdCkge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gW10gOiBiYXNlVmFsdWVzKG9iamVjdCwga2V5cyhvYmplY3QpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZyBrZXllZCBwcm9wZXJ0eVxuICAgICAqIHZhbHVlcyBvZiBgb2JqZWN0YC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IE9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gRm9vKCkge1xuICAgICAqICAgdGhpcy5hID0gMTtcbiAgICAgKiAgIHRoaXMuYiA9IDI7XG4gICAgICogfVxuICAgICAqXG4gICAgICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAgICAgKlxuICAgICAqIF8udmFsdWVzSW4obmV3IEZvbyk7XG4gICAgICogLy8gPT4gWzEsIDIsIDNdIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsdWVzSW4ob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyBbXSA6IGJhc2VWYWx1ZXMob2JqZWN0LCBrZXlzSW4ob2JqZWN0KSk7XG4gICAgfVxuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ2xhbXBzIGBudW1iZXJgIHdpdGhpbiB0aGUgaW5jbHVzaXZlIGBsb3dlcmAgYW5kIGB1cHBlcmAgYm91bmRzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IE51bWJlclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXIgVGhlIG51bWJlciB0byBjbGFtcC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xvd2VyXSBUaGUgbG93ZXIgYm91bmQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHVwcGVyIFRoZSB1cHBlciBib3VuZC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjbGFtcGVkIG51bWJlci5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5jbGFtcCgtMTAsIC01LCA1KTtcbiAgICAgKiAvLyA9PiAtNVxuICAgICAqXG4gICAgICogXy5jbGFtcCgxMCwgLTUsIDUpO1xuICAgICAqIC8vID0+IDVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbGFtcChudW1iZXIsIGxvd2VyLCB1cHBlcikge1xuICAgICAgaWYgKHVwcGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBwZXIgPSBsb3dlcjtcbiAgICAgICAgbG93ZXIgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBpZiAodXBwZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cHBlciA9IHRvTnVtYmVyKHVwcGVyKTtcbiAgICAgICAgdXBwZXIgPSB1cHBlciA9PT0gdXBwZXIgPyB1cHBlciA6IDA7XG4gICAgICB9XG4gICAgICBpZiAobG93ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBsb3dlciA9IHRvTnVtYmVyKGxvd2VyKTtcbiAgICAgICAgbG93ZXIgPSBsb3dlciA9PT0gbG93ZXIgPyBsb3dlciA6IDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZUNsYW1wKHRvTnVtYmVyKG51bWJlciksIGxvd2VyLCB1cHBlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGBuYCBpcyBiZXR3ZWVuIGBzdGFydGAgYW5kIHVwIHRvLCBidXQgbm90IGluY2x1ZGluZywgYGVuZGAuIElmXG4gICAgICogYGVuZGAgaXMgbm90IHNwZWNpZmllZCwgaXQncyBzZXQgdG8gYHN0YXJ0YCB3aXRoIGBzdGFydGAgdGhlbiBzZXQgdG8gYDBgLlxuICAgICAqIElmIGBzdGFydGAgaXMgZ3JlYXRlciB0aGFuIGBlbmRgIHRoZSBwYXJhbXMgYXJlIHN3YXBwZWQgdG8gc3VwcG9ydFxuICAgICAqIG5lZ2F0aXZlIHJhbmdlcy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjMuMFxuICAgICAqIEBjYXRlZ29yeSBOdW1iZXJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyIFRoZSBudW1iZXIgdG8gY2hlY2suXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGFydD0wXSBUaGUgc3RhcnQgb2YgdGhlIHJhbmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgcmFuZ2UuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBudW1iZXJgIGlzIGluIHRoZSByYW5nZSwgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBzZWUgXy5yYW5nZSwgXy5yYW5nZVJpZ2h0XG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uaW5SYW5nZSgzLCAyLCA0KTtcbiAgICAgKiAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBfLmluUmFuZ2UoNCwgOCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5pblJhbmdlKDQsIDIpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmluUmFuZ2UoMiwgMik7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uaW5SYW5nZSgxLjIsIDIpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uaW5SYW5nZSg1LjIsIDQpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLmluUmFuZ2UoLTMsIC0yLCAtNik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGluUmFuZ2UobnVtYmVyLCBzdGFydCwgZW5kKSB7XG4gICAgICBzdGFydCA9IHRvRmluaXRlKHN0YXJ0KTtcbiAgICAgIGlmIChlbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbmQgPSBzdGFydDtcbiAgICAgICAgc3RhcnQgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW5kID0gdG9GaW5pdGUoZW5kKTtcbiAgICAgIH1cbiAgICAgIG51bWJlciA9IHRvTnVtYmVyKG51bWJlcik7XG4gICAgICByZXR1cm4gYmFzZUluUmFuZ2UobnVtYmVyLCBzdGFydCwgZW5kKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcm9kdWNlcyBhIHJhbmRvbSBudW1iZXIgYmV0d2VlbiB0aGUgaW5jbHVzaXZlIGBsb3dlcmAgYW5kIGB1cHBlcmAgYm91bmRzLlxuICAgICAqIElmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHByb3ZpZGVkIGEgbnVtYmVyIGJldHdlZW4gYDBgIGFuZCB0aGUgZ2l2ZW4gbnVtYmVyXG4gICAgICogaXMgcmV0dXJuZWQuIElmIGBmbG9hdGluZ2AgaXMgYHRydWVgLCBvciBlaXRoZXIgYGxvd2VyYCBvciBgdXBwZXJgIGFyZVxuICAgICAqIGZsb2F0cywgYSBmbG9hdGluZy1wb2ludCBudW1iZXIgaXMgcmV0dXJuZWQgaW5zdGVhZCBvZiBhbiBpbnRlZ2VyLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIEphdmFTY3JpcHQgZm9sbG93cyB0aGUgSUVFRS03NTQgc3RhbmRhcmQgZm9yIHJlc29sdmluZ1xuICAgICAqIGZsb2F0aW5nLXBvaW50IHZhbHVlcyB3aGljaCBjYW4gcHJvZHVjZSB1bmV4cGVjdGVkIHJlc3VsdHMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMC43LjBcbiAgICAgKiBAY2F0ZWdvcnkgTnVtYmVyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtsb3dlcj0wXSBUaGUgbG93ZXIgYm91bmQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFt1cHBlcj0xXSBUaGUgdXBwZXIgYm91bmQuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZmxvYXRpbmddIFNwZWNpZnkgcmV0dXJuaW5nIGEgZmxvYXRpbmctcG9pbnQgbnVtYmVyLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHJhbmRvbSBudW1iZXIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucmFuZG9tKDAsIDUpO1xuICAgICAqIC8vID0+IGFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCA1XG4gICAgICpcbiAgICAgKiBfLnJhbmRvbSg1KTtcbiAgICAgKiAvLyA9PiBhbHNvIGFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCA1XG4gICAgICpcbiAgICAgKiBfLnJhbmRvbSg1LCB0cnVlKTtcbiAgICAgKiAvLyA9PiBhIGZsb2F0aW5nLXBvaW50IG51bWJlciBiZXR3ZWVuIDAgYW5kIDVcbiAgICAgKlxuICAgICAqIF8ucmFuZG9tKDEuMiwgNS4yKTtcbiAgICAgKiAvLyA9PiBhIGZsb2F0aW5nLXBvaW50IG51bWJlciBiZXR3ZWVuIDEuMiBhbmQgNS4yXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZG9tKGxvd2VyLCB1cHBlciwgZmxvYXRpbmcpIHtcbiAgICAgIGlmIChmbG9hdGluZyAmJiB0eXBlb2YgZmxvYXRpbmcgIT0gJ2Jvb2xlYW4nICYmIGlzSXRlcmF0ZWVDYWxsKGxvd2VyLCB1cHBlciwgZmxvYXRpbmcpKSB7XG4gICAgICAgIHVwcGVyID0gZmxvYXRpbmcgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBpZiAoZmxvYXRpbmcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodHlwZW9mIHVwcGVyID09ICdib29sZWFuJykge1xuICAgICAgICAgIGZsb2F0aW5nID0gdXBwZXI7XG4gICAgICAgICAgdXBwZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGxvd2VyID09ICdib29sZWFuJykge1xuICAgICAgICAgIGZsb2F0aW5nID0gbG93ZXI7XG4gICAgICAgICAgbG93ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChsb3dlciA9PT0gdW5kZWZpbmVkICYmIHVwcGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbG93ZXIgPSAwO1xuICAgICAgICB1cHBlciA9IDE7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbG93ZXIgPSB0b0Zpbml0ZShsb3dlcik7XG4gICAgICAgIGlmICh1cHBlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdXBwZXIgPSBsb3dlcjtcbiAgICAgICAgICBsb3dlciA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXBwZXIgPSB0b0Zpbml0ZSh1cHBlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChsb3dlciA+IHVwcGVyKSB7XG4gICAgICAgIHZhciB0ZW1wID0gbG93ZXI7XG4gICAgICAgIGxvd2VyID0gdXBwZXI7XG4gICAgICAgIHVwcGVyID0gdGVtcDtcbiAgICAgIH1cbiAgICAgIGlmIChmbG9hdGluZyB8fCBsb3dlciAlIDEgfHwgdXBwZXIgJSAxKSB7XG4gICAgICAgIHZhciByYW5kID0gbmF0aXZlUmFuZG9tKCk7XG4gICAgICAgIHJldHVybiBuYXRpdmVNaW4obG93ZXIgKyAocmFuZCAqICh1cHBlciAtIGxvd2VyICsgZnJlZVBhcnNlRmxvYXQoJzFlLScgKyAoKHJhbmQgKyAnJykubGVuZ3RoIC0gMSkpKSksIHVwcGVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiYXNlUmFuZG9tKGxvd2VyLCB1cHBlcik7XG4gICAgfVxuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gW2NhbWVsIGNhc2VdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NhbWVsQ2FzZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjYW1lbCBjYXNlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uY2FtZWxDYXNlKCdGb28gQmFyJyk7XG4gICAgICogLy8gPT4gJ2Zvb0JhcidcbiAgICAgKlxuICAgICAqIF8uY2FtZWxDYXNlKCctLWZvby1iYXItLScpO1xuICAgICAqIC8vID0+ICdmb29CYXInXG4gICAgICpcbiAgICAgKiBfLmNhbWVsQ2FzZSgnX19GT09fQkFSX18nKTtcbiAgICAgKiAvLyA9PiAnZm9vQmFyJ1xuICAgICAqL1xuICAgIHZhciBjYW1lbENhc2UgPSBjcmVhdGVDb21wb3VuZGVyKGZ1bmN0aW9uKHJlc3VsdCwgd29yZCwgaW5kZXgpIHtcbiAgICAgIHdvcmQgPSB3b3JkLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gY2FwaXRhbGl6ZSh3b3JkKSA6IHdvcmQpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhlIGZpcnN0IGNoYXJhY3RlciBvZiBgc3RyaW5nYCB0byB1cHBlciBjYXNlIGFuZCB0aGUgcmVtYWluaW5nXG4gICAgICogdG8gbG93ZXIgY2FzZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjYXBpdGFsaXplLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNhcGl0YWxpemVkIHN0cmluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5jYXBpdGFsaXplKCdGUkVEJyk7XG4gICAgICogLy8gPT4gJ0ZyZWQnXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHtcbiAgICAgIHJldHVybiB1cHBlckZpcnN0KHRvU3RyaW5nKHN0cmluZykudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVidXJycyBgc3RyaW5nYCBieSBjb252ZXJ0aW5nXG4gICAgICogW0xhdGluLTEgU3VwcGxlbWVudF0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGF0aW4tMV9TdXBwbGVtZW50XyhVbmljb2RlX2Jsb2NrKSNDaGFyYWN0ZXJfdGFibGUpXG4gICAgICogYW5kIFtMYXRpbiBFeHRlbmRlZC1BXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MYXRpbl9FeHRlbmRlZC1BKVxuICAgICAqIGxldHRlcnMgdG8gYmFzaWMgTGF0aW4gbGV0dGVycyBhbmQgcmVtb3ZpbmdcbiAgICAgKiBbY29tYmluaW5nIGRpYWNyaXRpY2FsIG1hcmtzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db21iaW5pbmdfRGlhY3JpdGljYWxfTWFya3MpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGRlYnVyci5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBkZWJ1cnJlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZGVidXJyKCdkw6lqw6AgdnUnKTtcbiAgICAgKiAvLyA9PiAnZGVqYSB2dSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWJ1cnIoc3RyaW5nKSB7XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuICAgICAgcmV0dXJuIHN0cmluZyAmJiBzdHJpbmcucmVwbGFjZShyZUxhdGluLCBkZWJ1cnJMZXR0ZXIpLnJlcGxhY2UocmVDb21ib01hcmssICcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHN0cmluZ2AgZW5kcyB3aXRoIHRoZSBnaXZlbiB0YXJnZXQgc3RyaW5nLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGluc3BlY3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFt0YXJnZXRdIFRoZSBzdHJpbmcgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3Bvc2l0aW9uPXN0cmluZy5sZW5ndGhdIFRoZSBwb3NpdGlvbiB0byBzZWFyY2ggdXAgdG8uXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBzdHJpbmdgIGVuZHMgd2l0aCBgdGFyZ2V0YCxcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmVuZHNXaXRoKCdhYmMnLCAnYycpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIF8uZW5kc1dpdGgoJ2FiYycsICdiJyk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKlxuICAgICAqIF8uZW5kc1dpdGgoJ2FiYycsICdiJywgMik7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHN0cmluZywgdGFyZ2V0LCBwb3NpdGlvbikge1xuICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTtcbiAgICAgIHRhcmdldCA9IGJhc2VUb1N0cmluZyh0YXJnZXQpO1xuXG4gICAgICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDtcbiAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24gPT09IHVuZGVmaW5lZFxuICAgICAgICA/IGxlbmd0aFxuICAgICAgICA6IGJhc2VDbGFtcCh0b0ludGVnZXIocG9zaXRpb24pLCAwLCBsZW5ndGgpO1xuXG4gICAgICB2YXIgZW5kID0gcG9zaXRpb247XG4gICAgICBwb3NpdGlvbiAtPSB0YXJnZXQubGVuZ3RoO1xuICAgICAgcmV0dXJuIHBvc2l0aW9uID49IDAgJiYgc3RyaW5nLnNsaWNlKHBvc2l0aW9uLCBlbmQpID09IHRhcmdldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGUgY2hhcmFjdGVycyBcIiZcIiwgXCI8XCIsIFwiPlwiLCAnXCInLCBhbmQgXCInXCIgaW4gYHN0cmluZ2AgdG8gdGhlaXJcbiAgICAgKiBjb3JyZXNwb25kaW5nIEhUTUwgZW50aXRpZXMuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogTm8gb3RoZXIgY2hhcmFjdGVycyBhcmUgZXNjYXBlZC4gVG8gZXNjYXBlIGFkZGl0aW9uYWxcbiAgICAgKiBjaGFyYWN0ZXJzIHVzZSBhIHRoaXJkLXBhcnR5IGxpYnJhcnkgbGlrZSBbX2hlX10oaHR0cHM6Ly9tdGhzLmJlL2hlKS5cbiAgICAgKlxuICAgICAqIFRob3VnaCB0aGUgXCI+XCIgY2hhcmFjdGVyIGlzIGVzY2FwZWQgZm9yIHN5bW1ldHJ5LCBjaGFyYWN0ZXJzIGxpa2VcbiAgICAgKiBcIj5cIiBhbmQgXCIvXCIgZG9uJ3QgbmVlZCBlc2NhcGluZyBpbiBIVE1MIGFuZCBoYXZlIG5vIHNwZWNpYWwgbWVhbmluZ1xuICAgICAqIHVubGVzcyB0aGV5J3JlIHBhcnQgb2YgYSB0YWcgb3IgdW5xdW90ZWQgYXR0cmlidXRlIHZhbHVlLiBTZWVcbiAgICAgKiBbTWF0aGlhcyBCeW5lbnMncyBhcnRpY2xlXShodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvYW1iaWd1b3VzLWFtcGVyc2FuZHMpXG4gICAgICogKHVuZGVyIFwic2VtaS1yZWxhdGVkIGZ1biBmYWN0XCIpIGZvciBtb3JlIGRldGFpbHMuXG4gICAgICpcbiAgICAgKiBXaGVuIHdvcmtpbmcgd2l0aCBIVE1MIHlvdSBzaG91bGQgYWx3YXlzXG4gICAgICogW3F1b3RlIGF0dHJpYnV0ZSB2YWx1ZXNdKGh0dHA6Ly93b25rby5jb20vcG9zdC9odG1sLWVzY2FwaW5nKSB0byByZWR1Y2VcbiAgICAgKiBYU1MgdmVjdG9ycy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBlc2NhcGUuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZXNjYXBlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZXNjYXBlKCdmcmVkLCBiYXJuZXksICYgcGViYmxlcycpO1xuICAgICAqIC8vID0+ICdmcmVkLCBiYXJuZXksICZhbXA7IHBlYmJsZXMnXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXNjYXBlKHN0cmluZykge1xuICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTtcbiAgICAgIHJldHVybiAoc3RyaW5nICYmIHJlSGFzVW5lc2NhcGVkSHRtbC50ZXN0KHN0cmluZykpXG4gICAgICAgID8gc3RyaW5nLnJlcGxhY2UocmVVbmVzY2FwZWRIdG1sLCBlc2NhcGVIdG1sQ2hhcilcbiAgICAgICAgOiBzdHJpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXNjYXBlcyB0aGUgYFJlZ0V4cGAgc3BlY2lhbCBjaGFyYWN0ZXJzIFwiXlwiLCBcIiRcIiwgXCJcXFwiLCBcIi5cIiwgXCIqXCIsIFwiK1wiLFxuICAgICAqIFwiP1wiLCBcIihcIiwgXCIpXCIsIFwiW1wiLCBcIl1cIiwgXCJ7XCIsIFwifVwiLCBhbmQgXCJ8XCIgaW4gYHN0cmluZ2AuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gZXNjYXBlLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGVzY2FwZWQgc3RyaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmVzY2FwZVJlZ0V4cCgnW2xvZGFzaF0oaHR0cHM6Ly9sb2Rhc2guY29tLyknKTtcbiAgICAgKiAvLyA9PiAnXFxbbG9kYXNoXFxdXFwoaHR0cHM6Ly9sb2Rhc2hcXC5jb20vXFwpJ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHJpbmcpIHtcbiAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG4gICAgICByZXR1cm4gKHN0cmluZyAmJiByZUhhc1JlZ0V4cENoYXIudGVzdChzdHJpbmcpKVxuICAgICAgICA/IHN0cmluZy5yZXBsYWNlKHJlUmVnRXhwQ2hhciwgJ1xcXFwkJicpXG4gICAgICAgIDogc3RyaW5nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvXG4gICAgICogW2tlYmFiIGNhc2VdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xldHRlcl9jYXNlI1NwZWNpYWxfY2FzZV9zdHlsZXMpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUga2ViYWIgY2FzZWQgc3RyaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmtlYmFiQ2FzZSgnRm9vIEJhcicpO1xuICAgICAqIC8vID0+ICdmb28tYmFyJ1xuICAgICAqXG4gICAgICogXy5rZWJhYkNhc2UoJ2Zvb0JhcicpO1xuICAgICAqIC8vID0+ICdmb28tYmFyJ1xuICAgICAqXG4gICAgICogXy5rZWJhYkNhc2UoJ19fRk9PX0JBUl9fJyk7XG4gICAgICogLy8gPT4gJ2Zvby1iYXInXG4gICAgICovXG4gICAgdmFyIGtlYmFiQ2FzZSA9IGNyZWF0ZUNvbXBvdW5kZXIoZnVuY3Rpb24ocmVzdWx0LCB3b3JkLCBpbmRleCkge1xuICAgICAgcmV0dXJuIHJlc3VsdCArIChpbmRleCA/ICctJyA6ICcnKSArIHdvcmQudG9Mb3dlckNhc2UoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgLCBhcyBzcGFjZSBzZXBhcmF0ZWQgd29yZHMsIHRvIGxvd2VyIGNhc2UuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBsb3dlciBjYXNlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ubG93ZXJDYXNlKCctLUZvby1CYXItLScpO1xuICAgICAqIC8vID0+ICdmb28gYmFyJ1xuICAgICAqXG4gICAgICogXy5sb3dlckNhc2UoJ2Zvb0JhcicpO1xuICAgICAqIC8vID0+ICdmb28gYmFyJ1xuICAgICAqXG4gICAgICogXy5sb3dlckNhc2UoJ19fRk9PX0JBUl9fJyk7XG4gICAgICogLy8gPT4gJ2ZvbyBiYXInXG4gICAgICovXG4gICAgdmFyIGxvd2VyQ2FzZSA9IGNyZWF0ZUNvbXBvdW5kZXIoZnVuY3Rpb24ocmVzdWx0LCB3b3JkLCBpbmRleCkge1xuICAgICAgcmV0dXJuIHJlc3VsdCArIChpbmRleCA/ICcgJyA6ICcnKSArIHdvcmQudG9Mb3dlckNhc2UoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgYHN0cmluZ2AgdG8gbG93ZXIgY2FzZS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ubG93ZXJGaXJzdCgnRnJlZCcpO1xuICAgICAqIC8vID0+ICdmcmVkJ1xuICAgICAqXG4gICAgICogXy5sb3dlckZpcnN0KCdGUkVEJyk7XG4gICAgICogLy8gPT4gJ2ZSRUQnXG4gICAgICovXG4gICAgdmFyIGxvd2VyRmlyc3QgPSBjcmVhdGVDYXNlRmlyc3QoJ3RvTG93ZXJDYXNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBQYWRzIGBzdHJpbmdgIG9uIHRoZSBsZWZ0IGFuZCByaWdodCBzaWRlcyBpZiBpdCdzIHNob3J0ZXIgdGhhbiBgbGVuZ3RoYC5cbiAgICAgKiBQYWRkaW5nIGNoYXJhY3RlcnMgYXJlIHRydW5jYXRlZCBpZiB0aGV5IGNhbid0IGJlIGV2ZW5seSBkaXZpZGVkIGJ5IGBsZW5ndGhgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHBhZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aD0wXSBUaGUgcGFkZGluZyBsZW5ndGguXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz0nICddIFRoZSBzdHJpbmcgdXNlZCBhcyBwYWRkaW5nLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHBhZGRlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucGFkKCdhYmMnLCA4KTtcbiAgICAgKiAvLyA9PiAnICBhYmMgICAnXG4gICAgICpcbiAgICAgKiBfLnBhZCgnYWJjJywgOCwgJ18tJyk7XG4gICAgICogLy8gPT4gJ18tYWJjXy1fJ1xuICAgICAqXG4gICAgICogXy5wYWQoJ2FiYycsIDMpO1xuICAgICAqIC8vID0+ICdhYmMnXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFkKHN0cmluZywgbGVuZ3RoLCBjaGFycykge1xuICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTtcbiAgICAgIGxlbmd0aCA9IHRvSW50ZWdlcihsZW5ndGgpO1xuXG4gICAgICB2YXIgc3RyTGVuZ3RoID0gbGVuZ3RoID8gc3RyaW5nU2l6ZShzdHJpbmcpIDogMDtcbiAgICAgIGlmICghbGVuZ3RoIHx8IHN0ckxlbmd0aCA+PSBsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICAgIH1cbiAgICAgIHZhciBtaWQgPSAobGVuZ3RoIC0gc3RyTGVuZ3RoKSAvIDI7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBjcmVhdGVQYWRkaW5nKG5hdGl2ZUZsb29yKG1pZCksIGNoYXJzKSArXG4gICAgICAgIHN0cmluZyArXG4gICAgICAgIGNyZWF0ZVBhZGRpbmcobmF0aXZlQ2VpbChtaWQpLCBjaGFycylcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGFkcyBgc3RyaW5nYCBvbiB0aGUgcmlnaHQgc2lkZSBpZiBpdCdzIHNob3J0ZXIgdGhhbiBgbGVuZ3RoYC4gUGFkZGluZ1xuICAgICAqIGNoYXJhY3RlcnMgYXJlIHRydW5jYXRlZCBpZiB0aGV5IGV4Y2VlZCBgbGVuZ3RoYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBwYWQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9MF0gVGhlIHBhZGRpbmcgbGVuZ3RoLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbY2hhcnM9JyAnXSBUaGUgc3RyaW5nIHVzZWQgYXMgcGFkZGluZy5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBwYWRkZWQgc3RyaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnBhZEVuZCgnYWJjJywgNik7XG4gICAgICogLy8gPT4gJ2FiYyAgICdcbiAgICAgKlxuICAgICAqIF8ucGFkRW5kKCdhYmMnLCA2LCAnXy0nKTtcbiAgICAgKiAvLyA9PiAnYWJjXy1fJ1xuICAgICAqXG4gICAgICogXy5wYWRFbmQoJ2FiYycsIDMpO1xuICAgICAqIC8vID0+ICdhYmMnXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFkRW5kKHN0cmluZywgbGVuZ3RoLCBjaGFycykge1xuICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTtcbiAgICAgIGxlbmd0aCA9IHRvSW50ZWdlcihsZW5ndGgpO1xuXG4gICAgICB2YXIgc3RyTGVuZ3RoID0gbGVuZ3RoID8gc3RyaW5nU2l6ZShzdHJpbmcpIDogMDtcbiAgICAgIHJldHVybiAobGVuZ3RoICYmIHN0ckxlbmd0aCA8IGxlbmd0aClcbiAgICAgICAgPyAoc3RyaW5nICsgY3JlYXRlUGFkZGluZyhsZW5ndGggLSBzdHJMZW5ndGgsIGNoYXJzKSlcbiAgICAgICAgOiBzdHJpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGFkcyBgc3RyaW5nYCBvbiB0aGUgbGVmdCBzaWRlIGlmIGl0J3Mgc2hvcnRlciB0aGFuIGBsZW5ndGhgLiBQYWRkaW5nXG4gICAgICogY2hhcmFjdGVycyBhcmUgdHJ1bmNhdGVkIGlmIHRoZXkgZXhjZWVkIGBsZW5ndGhgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHBhZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aD0wXSBUaGUgcGFkZGluZyBsZW5ndGguXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz0nICddIFRoZSBzdHJpbmcgdXNlZCBhcyBwYWRkaW5nLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHBhZGRlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucGFkU3RhcnQoJ2FiYycsIDYpO1xuICAgICAqIC8vID0+ICcgICBhYmMnXG4gICAgICpcbiAgICAgKiBfLnBhZFN0YXJ0KCdhYmMnLCA2LCAnXy0nKTtcbiAgICAgKiAvLyA9PiAnXy1fYWJjJ1xuICAgICAqXG4gICAgICogXy5wYWRTdGFydCgnYWJjJywgMyk7XG4gICAgICogLy8gPT4gJ2FiYydcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwYWRTdGFydChzdHJpbmcsIGxlbmd0aCwgY2hhcnMpIHtcbiAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG4gICAgICBsZW5ndGggPSB0b0ludGVnZXIobGVuZ3RoKTtcblxuICAgICAgdmFyIHN0ckxlbmd0aCA9IGxlbmd0aCA/IHN0cmluZ1NpemUoc3RyaW5nKSA6IDA7XG4gICAgICByZXR1cm4gKGxlbmd0aCAmJiBzdHJMZW5ndGggPCBsZW5ndGgpXG4gICAgICAgID8gKGNyZWF0ZVBhZGRpbmcobGVuZ3RoIC0gc3RyTGVuZ3RoLCBjaGFycykgKyBzdHJpbmcpXG4gICAgICAgIDogc3RyaW5nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvIGFuIGludGVnZXIgb2YgdGhlIHNwZWNpZmllZCByYWRpeC4gSWYgYHJhZGl4YCBpc1xuICAgICAqIGB1bmRlZmluZWRgIG9yIGAwYCwgYSBgcmFkaXhgIG9mIGAxMGAgaXMgdXNlZCB1bmxlc3MgYHZhbHVlYCBpcyBhXG4gICAgICogaGV4YWRlY2ltYWwsIGluIHdoaWNoIGNhc2UgYSBgcmFkaXhgIG9mIGAxNmAgaXMgdXNlZC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBhbGlnbnMgd2l0aCB0aGVcbiAgICAgKiBbRVM1IGltcGxlbWVudGF0aW9uXShodHRwczovL2VzNS5naXRodWIuaW8vI3gxNS4xLjIuMikgb2YgYHBhcnNlSW50YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAxLjEuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3JhZGl4PTEwXSBUaGUgcmFkaXggdG8gaW50ZXJwcmV0IGB2YWx1ZWAgYnkuXG4gICAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgaW50ZWdlci5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5wYXJzZUludCgnMDgnKTtcbiAgICAgKiAvLyA9PiA4XG4gICAgICpcbiAgICAgKiBfLm1hcChbJzYnLCAnMDgnLCAnMTAnXSwgXy5wYXJzZUludCk7XG4gICAgICogLy8gPT4gWzYsIDgsIDEwXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZywgcmFkaXgsIGd1YXJkKSB7XG4gICAgICBpZiAoZ3VhcmQgfHwgcmFkaXggPT0gbnVsbCkge1xuICAgICAgICByYWRpeCA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHJhZGl4KSB7XG4gICAgICAgIHJhZGl4ID0gK3JhZGl4O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5hdGl2ZVBhcnNlSW50KHRvU3RyaW5nKHN0cmluZykucmVwbGFjZShyZVRyaW1TdGFydCwgJycpLCByYWRpeCB8fCAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBlYXRzIHRoZSBnaXZlbiBzdHJpbmcgYG5gIHRpbWVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHJlcGVhdC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQgdGhlIHN0cmluZy5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHJlcGVhdGVkIHN0cmluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5yZXBlYXQoJyonLCAzKTtcbiAgICAgKiAvLyA9PiAnKioqJ1xuICAgICAqXG4gICAgICogXy5yZXBlYXQoJ2FiYycsIDIpO1xuICAgICAqIC8vID0+ICdhYmNhYmMnXG4gICAgICpcbiAgICAgKiBfLnJlcGVhdCgnYWJjJywgMCk7XG4gICAgICogLy8gPT4gJydcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZXBlYXQoc3RyaW5nLCBuLCBndWFyZCkge1xuICAgICAgaWYgKChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKHN0cmluZywgbiwgZ3VhcmQpIDogbiA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgICBuID0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG4gPSB0b0ludGVnZXIobik7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZVJlcGVhdCh0b1N0cmluZyhzdHJpbmcpLCBuKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyBtYXRjaGVzIGZvciBgcGF0dGVybmAgaW4gYHN0cmluZ2Agd2l0aCBgcmVwbGFjZW1lbnRgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uXG4gICAgICogW2BTdHJpbmcjcmVwbGFjZWBdKGh0dHBzOi8vbWRuLmlvL1N0cmluZy9yZXBsYWNlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBtb2RpZnkuXG4gICAgICogQHBhcmFtIHtSZWdFeHB8c3RyaW5nfSBwYXR0ZXJuIFRoZSBwYXR0ZXJuIHRvIHJlcGxhY2UuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbnxzdHJpbmd9IHJlcGxhY2VtZW50IFRoZSBtYXRjaCByZXBsYWNlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBtb2RpZmllZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucmVwbGFjZSgnSGkgRnJlZCcsICdGcmVkJywgJ0Jhcm5leScpO1xuICAgICAqIC8vID0+ICdIaSBCYXJuZXknXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVwbGFjZSgpIHtcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLFxuICAgICAgICAgIHN0cmluZyA9IHRvU3RyaW5nKGFyZ3NbMF0pO1xuXG4gICAgICByZXR1cm4gYXJncy5sZW5ndGggPCAzID8gc3RyaW5nIDogc3RyaW5nLnJlcGxhY2UoYXJnc1sxXSwgYXJnc1syXSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHN0cmluZ2AgdG9cbiAgICAgKiBbc25ha2UgY2FzZV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU25ha2VfY2FzZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzbmFrZSBjYXNlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc25ha2VDYXNlKCdGb28gQmFyJyk7XG4gICAgICogLy8gPT4gJ2Zvb19iYXInXG4gICAgICpcbiAgICAgKiBfLnNuYWtlQ2FzZSgnZm9vQmFyJyk7XG4gICAgICogLy8gPT4gJ2Zvb19iYXInXG4gICAgICpcbiAgICAgKiBfLnNuYWtlQ2FzZSgnLS1GT08tQkFSLS0nKTtcbiAgICAgKiAvLyA9PiAnZm9vX2JhcidcbiAgICAgKi9cbiAgICB2YXIgc25ha2VDYXNlID0gY3JlYXRlQ29tcG91bmRlcihmdW5jdGlvbihyZXN1bHQsIHdvcmQsIGluZGV4KSB7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gJ18nIDogJycpICsgd29yZC50b0xvd2VyQ2FzZSgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogU3BsaXRzIGBzdHJpbmdgIGJ5IGBzZXBhcmF0b3JgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uXG4gICAgICogW2BTdHJpbmcjc3BsaXRgXShodHRwczovL21kbi5pby9TdHJpbmcvc3BsaXQpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHNwbGl0LlxuICAgICAqIEBwYXJhbSB7UmVnRXhwfHN0cmluZ30gc2VwYXJhdG9yIFRoZSBzZXBhcmF0b3IgcGF0dGVybiB0byBzcGxpdCBieS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xpbWl0XSBUaGUgbGVuZ3RoIHRvIHRydW5jYXRlIHJlc3VsdHMgdG8uXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzdHJpbmcgc2VnbWVudHMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc3BsaXQoJ2EtYi1jJywgJy0nLCAyKTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnYiddXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3BsaXQoc3RyaW5nLCBzZXBhcmF0b3IsIGxpbWl0KSB7XG4gICAgICBpZiAobGltaXQgJiYgdHlwZW9mIGxpbWl0ICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKHN0cmluZywgc2VwYXJhdG9yLCBsaW1pdCkpIHtcbiAgICAgICAgc2VwYXJhdG9yID0gbGltaXQgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBsaW1pdCA9IGxpbWl0ID09PSB1bmRlZmluZWQgPyBNQVhfQVJSQVlfTEVOR1RIIDogbGltaXQgPj4+IDA7XG4gICAgICBpZiAoIWxpbWl0KSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG4gICAgICBpZiAoc3RyaW5nICYmIChcbiAgICAgICAgICAgIHR5cGVvZiBzZXBhcmF0b3IgPT0gJ3N0cmluZycgfHxcbiAgICAgICAgICAgIChzZXBhcmF0b3IgIT0gbnVsbCAmJiAhaXNSZWdFeHAoc2VwYXJhdG9yKSlcbiAgICAgICAgICApKSB7XG4gICAgICAgIHNlcGFyYXRvciA9IGJhc2VUb1N0cmluZyhzZXBhcmF0b3IpO1xuICAgICAgICBpZiAoIXNlcGFyYXRvciAmJiBoYXNVbmljb2RlKHN0cmluZykpIHtcbiAgICAgICAgICByZXR1cm4gY2FzdFNsaWNlKHN0cmluZ1RvQXJyYXkoc3RyaW5nKSwgMCwgbGltaXQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5nLnNwbGl0KHNlcGFyYXRvciwgbGltaXQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvXG4gICAgICogW3N0YXJ0IGNhc2VdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xldHRlcl9jYXNlI1N0eWxpc3RpY19vcl9zcGVjaWFsaXNlZF91c2FnZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4xLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzdGFydCBjYXNlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc3RhcnRDYXNlKCctLWZvby1iYXItLScpO1xuICAgICAqIC8vID0+ICdGb28gQmFyJ1xuICAgICAqXG4gICAgICogXy5zdGFydENhc2UoJ2Zvb0JhcicpO1xuICAgICAqIC8vID0+ICdGb28gQmFyJ1xuICAgICAqXG4gICAgICogXy5zdGFydENhc2UoJ19fRk9PX0JBUl9fJyk7XG4gICAgICogLy8gPT4gJ0ZPTyBCQVInXG4gICAgICovXG4gICAgdmFyIHN0YXJ0Q2FzZSA9IGNyZWF0ZUNvbXBvdW5kZXIoZnVuY3Rpb24ocmVzdWx0LCB3b3JkLCBpbmRleCkge1xuICAgICAgcmV0dXJuIHJlc3VsdCArIChpbmRleCA/ICcgJyA6ICcnKSArIHVwcGVyRmlyc3Qod29yZCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYHN0cmluZ2Agc3RhcnRzIHdpdGggdGhlIGdpdmVuIHRhcmdldCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gaW5zcGVjdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3RhcmdldF0gVGhlIHN0cmluZyB0byBzZWFyY2ggZm9yLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbcG9zaXRpb249MF0gVGhlIHBvc2l0aW9uIHRvIHNlYXJjaCBmcm9tLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgc3RyaW5nYCBzdGFydHMgd2l0aCBgdGFyZ2V0YCxcbiAgICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnN0YXJ0c1dpdGgoJ2FiYycsICdhJyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogXy5zdGFydHNXaXRoKCdhYmMnLCAnYicpO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBfLnN0YXJ0c1dpdGgoJ2FiYycsICdiJywgMSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyaW5nLCB0YXJnZXQsIHBvc2l0aW9uKSB7XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiA9PSBudWxsXG4gICAgICAgID8gMFxuICAgICAgICA6IGJhc2VDbGFtcCh0b0ludGVnZXIocG9zaXRpb24pLCAwLCBzdHJpbmcubGVuZ3RoKTtcblxuICAgICAgdGFyZ2V0ID0gYmFzZVRvU3RyaW5nKHRhcmdldCk7XG4gICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKHBvc2l0aW9uLCBwb3NpdGlvbiArIHRhcmdldC5sZW5ndGgpID09IHRhcmdldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY29tcGlsZWQgdGVtcGxhdGUgZnVuY3Rpb24gdGhhdCBjYW4gaW50ZXJwb2xhdGUgZGF0YSBwcm9wZXJ0aWVzXG4gICAgICogaW4gXCJpbnRlcnBvbGF0ZVwiIGRlbGltaXRlcnMsIEhUTUwtZXNjYXBlIGludGVycG9sYXRlZCBkYXRhIHByb3BlcnRpZXMgaW5cbiAgICAgKiBcImVzY2FwZVwiIGRlbGltaXRlcnMsIGFuZCBleGVjdXRlIEphdmFTY3JpcHQgaW4gXCJldmFsdWF0ZVwiIGRlbGltaXRlcnMuIERhdGFcbiAgICAgKiBwcm9wZXJ0aWVzIG1heSBiZSBhY2Nlc3NlZCBhcyBmcmVlIHZhcmlhYmxlcyBpbiB0aGUgdGVtcGxhdGUuIElmIGEgc2V0dGluZ1xuICAgICAqIG9iamVjdCBpcyBnaXZlbiwgaXQgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGBfLnRlbXBsYXRlU2V0dGluZ3NgIHZhbHVlcy5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBJbiB0aGUgZGV2ZWxvcG1lbnQgYnVpbGQgYF8udGVtcGxhdGVgIHV0aWxpemVzXG4gICAgICogW3NvdXJjZVVSTHNdKGh0dHA6Ly93d3cuaHRtbDVyb2Nrcy5jb20vZW4vdHV0b3JpYWxzL2RldmVsb3BlcnRvb2xzL3NvdXJjZW1hcHMvI3RvYy1zb3VyY2V1cmwpXG4gICAgICogZm9yIGVhc2llciBkZWJ1Z2dpbmcuXG4gICAgICpcbiAgICAgKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBwcmVjb21waWxpbmcgdGVtcGxhdGVzIHNlZVxuICAgICAqIFtsb2Rhc2gncyBjdXN0b20gYnVpbGRzIGRvY3VtZW50YXRpb25dKGh0dHBzOi8vbG9kYXNoLmNvbS9jdXN0b20tYnVpbGRzKS5cbiAgICAgKlxuICAgICAqIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIENocm9tZSBleHRlbnNpb24gc2FuZGJveGVzIHNlZVxuICAgICAqIFtDaHJvbWUncyBleHRlbnNpb25zIGRvY3VtZW50YXRpb25dKGh0dHBzOi8vZGV2ZWxvcGVyLmNocm9tZS5jb20vZXh0ZW5zaW9ucy9zYW5kYm94aW5nRXZhbCkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgU3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSB0ZW1wbGF0ZSBzdHJpbmcuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtSZWdFeHB9IFtvcHRpb25zLmVzY2FwZT1fLnRlbXBsYXRlU2V0dGluZ3MuZXNjYXBlXVxuICAgICAqICBUaGUgSFRNTCBcImVzY2FwZVwiIGRlbGltaXRlci5cbiAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gW29wdGlvbnMuZXZhbHVhdGU9Xy50ZW1wbGF0ZVNldHRpbmdzLmV2YWx1YXRlXVxuICAgICAqICBUaGUgXCJldmFsdWF0ZVwiIGRlbGltaXRlci5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuaW1wb3J0cz1fLnRlbXBsYXRlU2V0dGluZ3MuaW1wb3J0c11cbiAgICAgKiAgQW4gb2JqZWN0IHRvIGltcG9ydCBpbnRvIHRoZSB0ZW1wbGF0ZSBhcyBmcmVlIHZhcmlhYmxlcy5cbiAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gW29wdGlvbnMuaW50ZXJwb2xhdGU9Xy50ZW1wbGF0ZVNldHRpbmdzLmludGVycG9sYXRlXVxuICAgICAqICBUaGUgXCJpbnRlcnBvbGF0ZVwiIGRlbGltaXRlci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuc291cmNlVVJMPSdsb2Rhc2gudGVtcGxhdGVTb3VyY2VzW25dJ11cbiAgICAgKiAgVGhlIHNvdXJjZVVSTCBvZiB0aGUgY29tcGlsZWQgdGVtcGxhdGUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnZhcmlhYmxlPSdvYmonXVxuICAgICAqICBUaGUgZGF0YSBvYmplY3QgdmFyaWFibGUgbmFtZS5cbiAgICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgY29tcGlsZWQgdGVtcGxhdGUgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIC8vIFVzZSB0aGUgXCJpbnRlcnBvbGF0ZVwiIGRlbGltaXRlciB0byBjcmVhdGUgYSBjb21waWxlZCB0ZW1wbGF0ZS5cbiAgICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCdoZWxsbyA8JT0gdXNlciAlPiEnKTtcbiAgICAgKiBjb21waWxlZCh7ICd1c2VyJzogJ2ZyZWQnIH0pO1xuICAgICAqIC8vID0+ICdoZWxsbyBmcmVkISdcbiAgICAgKlxuICAgICAqIC8vIFVzZSB0aGUgSFRNTCBcImVzY2FwZVwiIGRlbGltaXRlciB0byBlc2NhcGUgZGF0YSBwcm9wZXJ0eSB2YWx1ZXMuXG4gICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnPGI+PCUtIHZhbHVlICU+PC9iPicpO1xuICAgICAqIGNvbXBpbGVkKHsgJ3ZhbHVlJzogJzxzY3JpcHQ+JyB9KTtcbiAgICAgKiAvLyA9PiAnPGI+Jmx0O3NjcmlwdCZndDs8L2I+J1xuICAgICAqXG4gICAgICogLy8gVXNlIHRoZSBcImV2YWx1YXRlXCIgZGVsaW1pdGVyIHRvIGV4ZWN1dGUgSmF2YVNjcmlwdCBhbmQgZ2VuZXJhdGUgSFRNTC5cbiAgICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCc8JSBfLmZvckVhY2godXNlcnMsIGZ1bmN0aW9uKHVzZXIpIHsgJT48bGk+PCUtIHVzZXIgJT48L2xpPjwlIH0pOyAlPicpO1xuICAgICAqIGNvbXBpbGVkKHsgJ3VzZXJzJzogWydmcmVkJywgJ2Jhcm5leSddIH0pO1xuICAgICAqIC8vID0+ICc8bGk+ZnJlZDwvbGk+PGxpPmJhcm5leTwvbGk+J1xuICAgICAqXG4gICAgICogLy8gVXNlIHRoZSBpbnRlcm5hbCBgcHJpbnRgIGZ1bmN0aW9uIGluIFwiZXZhbHVhdGVcIiBkZWxpbWl0ZXJzLlxuICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJzwlIHByaW50KFwiaGVsbG8gXCIgKyB1c2VyKTsgJT4hJyk7XG4gICAgICogY29tcGlsZWQoeyAndXNlcic6ICdiYXJuZXknIH0pO1xuICAgICAqIC8vID0+ICdoZWxsbyBiYXJuZXkhJ1xuICAgICAqXG4gICAgICogLy8gVXNlIHRoZSBFUyB0ZW1wbGF0ZSBsaXRlcmFsIGRlbGltaXRlciBhcyBhbiBcImludGVycG9sYXRlXCIgZGVsaW1pdGVyLlxuICAgICAqIC8vIERpc2FibGUgc3VwcG9ydCBieSByZXBsYWNpbmcgdGhlIFwiaW50ZXJwb2xhdGVcIiBkZWxpbWl0ZXIuXG4gICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnaGVsbG8gJHsgdXNlciB9IScpO1xuICAgICAqIGNvbXBpbGVkKHsgJ3VzZXInOiAncGViYmxlcycgfSk7XG4gICAgICogLy8gPT4gJ2hlbGxvIHBlYmJsZXMhJ1xuICAgICAqXG4gICAgICogLy8gVXNlIGJhY2tzbGFzaGVzIHRvIHRyZWF0IGRlbGltaXRlcnMgYXMgcGxhaW4gdGV4dC5cbiAgICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCc8JT0gXCJcXFxcPCUtIHZhbHVlICVcXFxcPlwiICU+Jyk7XG4gICAgICogY29tcGlsZWQoeyAndmFsdWUnOiAnaWdub3JlZCcgfSk7XG4gICAgICogLy8gPT4gJzwlLSB2YWx1ZSAlPidcbiAgICAgKlxuICAgICAqIC8vIFVzZSB0aGUgYGltcG9ydHNgIG9wdGlvbiB0byBpbXBvcnQgYGpRdWVyeWAgYXMgYGpxYC5cbiAgICAgKiB2YXIgdGV4dCA9ICc8JSBqcS5lYWNoKHVzZXJzLCBmdW5jdGlvbih1c2VyKSB7ICU+PGxpPjwlLSB1c2VyICU+PC9saT48JSB9KTsgJT4nO1xuICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUodGV4dCwgeyAnaW1wb3J0cyc6IHsgJ2pxJzogalF1ZXJ5IH0gfSk7XG4gICAgICogY29tcGlsZWQoeyAndXNlcnMnOiBbJ2ZyZWQnLCAnYmFybmV5J10gfSk7XG4gICAgICogLy8gPT4gJzxsaT5mcmVkPC9saT48bGk+YmFybmV5PC9saT4nXG4gICAgICpcbiAgICAgKiAvLyBVc2UgdGhlIGBzb3VyY2VVUkxgIG9wdGlvbiB0byBzcGVjaWZ5IGEgY3VzdG9tIHNvdXJjZVVSTCBmb3IgdGhlIHRlbXBsYXRlLlxuICAgICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJ2hlbGxvIDwlPSB1c2VyICU+IScsIHsgJ3NvdXJjZVVSTCc6ICcvYmFzaWMvZ3JlZXRpbmcuanN0JyB9KTtcbiAgICAgKiBjb21waWxlZChkYXRhKTtcbiAgICAgKiAvLyA9PiBGaW5kIHRoZSBzb3VyY2Ugb2YgXCJncmVldGluZy5qc3RcIiB1bmRlciB0aGUgU291cmNlcyB0YWIgb3IgUmVzb3VyY2VzIHBhbmVsIG9mIHRoZSB3ZWIgaW5zcGVjdG9yLlxuICAgICAqXG4gICAgICogLy8gVXNlIHRoZSBgdmFyaWFibGVgIG9wdGlvbiB0byBlbnN1cmUgYSB3aXRoLXN0YXRlbWVudCBpc24ndCB1c2VkIGluIHRoZSBjb21waWxlZCB0ZW1wbGF0ZS5cbiAgICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCdoaSA8JT0gZGF0YS51c2VyICU+IScsIHsgJ3ZhcmlhYmxlJzogJ2RhdGEnIH0pO1xuICAgICAqIGNvbXBpbGVkLnNvdXJjZTtcbiAgICAgKiAvLyA9PiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICogLy8gICB2YXIgX190LCBfX3AgPSAnJztcbiAgICAgKiAvLyAgIF9fcCArPSAnaGkgJyArICgoX190ID0gKCBkYXRhLnVzZXIgKSkgPT0gbnVsbCA/ICcnIDogX190KSArICchJztcbiAgICAgKiAvLyAgIHJldHVybiBfX3A7XG4gICAgICogLy8gfVxuICAgICAqXG4gICAgICogLy8gVXNlIGN1c3RvbSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLlxuICAgICAqIF8udGVtcGxhdGVTZXR0aW5ncy5pbnRlcnBvbGF0ZSA9IC97eyhbXFxzXFxTXSs/KX19L2c7XG4gICAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnaGVsbG8ge3sgdXNlciB9fSEnKTtcbiAgICAgKiBjb21waWxlZCh7ICd1c2VyJzogJ211c3RhY2hlJyB9KTtcbiAgICAgKiAvLyA9PiAnaGVsbG8gbXVzdGFjaGUhJ1xuICAgICAqXG4gICAgICogLy8gVXNlIHRoZSBgc291cmNlYCBwcm9wZXJ0eSB0byBpbmxpbmUgY29tcGlsZWQgdGVtcGxhdGVzIGZvciBtZWFuaW5nZnVsXG4gICAgICogLy8gbGluZSBudW1iZXJzIGluIGVycm9yIG1lc3NhZ2VzIGFuZCBzdGFjayB0cmFjZXMuXG4gICAgICogZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2pzdC5qcycpLCAnXFxcbiAgICAgKiAgIHZhciBKU1QgPSB7XFxcbiAgICAgKiAgICAgXCJtYWluXCI6ICcgKyBfLnRlbXBsYXRlKG1haW5UZXh0KS5zb3VyY2UgKyAnXFxcbiAgICAgKiAgIH07XFxcbiAgICAgKiAnKTtcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0ZW1wbGF0ZShzdHJpbmcsIG9wdGlvbnMsIGd1YXJkKSB7XG4gICAgICAvLyBCYXNlZCBvbiBKb2huIFJlc2lnJ3MgYHRtcGxgIGltcGxlbWVudGF0aW9uXG4gICAgICAvLyAoaHR0cDovL2Vqb2huLm9yZy9ibG9nL2phdmFzY3JpcHQtbWljcm8tdGVtcGxhdGluZy8pXG4gICAgICAvLyBhbmQgTGF1cmEgRG9rdG9yb3ZhJ3MgZG9ULmpzIChodHRwczovL2dpdGh1Yi5jb20vb2xhZG8vZG9UKS5cbiAgICAgIHZhciBzZXR0aW5ncyA9IGxvZGFzaC50ZW1wbGF0ZVNldHRpbmdzO1xuXG4gICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCBvcHRpb25zLCBndWFyZCkpIHtcbiAgICAgICAgb3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG4gICAgICBvcHRpb25zID0gYXNzaWduSW5XaXRoKHt9LCBvcHRpb25zLCBzZXR0aW5ncywgY3VzdG9tRGVmYXVsdHNBc3NpZ25Jbik7XG5cbiAgICAgIHZhciBpbXBvcnRzID0gYXNzaWduSW5XaXRoKHt9LCBvcHRpb25zLmltcG9ydHMsIHNldHRpbmdzLmltcG9ydHMsIGN1c3RvbURlZmF1bHRzQXNzaWduSW4pLFxuICAgICAgICAgIGltcG9ydHNLZXlzID0ga2V5cyhpbXBvcnRzKSxcbiAgICAgICAgICBpbXBvcnRzVmFsdWVzID0gYmFzZVZhbHVlcyhpbXBvcnRzLCBpbXBvcnRzS2V5cyk7XG5cbiAgICAgIHZhciBpc0VzY2FwaW5nLFxuICAgICAgICAgIGlzRXZhbHVhdGluZyxcbiAgICAgICAgICBpbmRleCA9IDAsXG4gICAgICAgICAgaW50ZXJwb2xhdGUgPSBvcHRpb25zLmludGVycG9sYXRlIHx8IHJlTm9NYXRjaCxcbiAgICAgICAgICBzb3VyY2UgPSBcIl9fcCArPSAnXCI7XG5cbiAgICAgIC8vIENvbXBpbGUgdGhlIHJlZ2V4cCB0byBtYXRjaCBlYWNoIGRlbGltaXRlci5cbiAgICAgIHZhciByZURlbGltaXRlcnMgPSBSZWdFeHAoXG4gICAgICAgIChvcHRpb25zLmVzY2FwZSB8fCByZU5vTWF0Y2gpLnNvdXJjZSArICd8JyArXG4gICAgICAgIGludGVycG9sYXRlLnNvdXJjZSArICd8JyArXG4gICAgICAgIChpbnRlcnBvbGF0ZSA9PT0gcmVJbnRlcnBvbGF0ZSA/IHJlRXNUZW1wbGF0ZSA6IHJlTm9NYXRjaCkuc291cmNlICsgJ3wnICtcbiAgICAgICAgKG9wdGlvbnMuZXZhbHVhdGUgfHwgcmVOb01hdGNoKS5zb3VyY2UgKyAnfCQnXG4gICAgICAsICdnJyk7XG5cbiAgICAgIC8vIFVzZSBhIHNvdXJjZVVSTCBmb3IgZWFzaWVyIGRlYnVnZ2luZy5cbiAgICAgIHZhciBzb3VyY2VVUkwgPSAnLy8jIHNvdXJjZVVSTD0nICtcbiAgICAgICAgKCdzb3VyY2VVUkwnIGluIG9wdGlvbnNcbiAgICAgICAgICA/IG9wdGlvbnMuc291cmNlVVJMXG4gICAgICAgICAgOiAoJ2xvZGFzaC50ZW1wbGF0ZVNvdXJjZXNbJyArICgrK3RlbXBsYXRlQ291bnRlcikgKyAnXScpXG4gICAgICAgICkgKyAnXFxuJztcblxuICAgICAgc3RyaW5nLnJlcGxhY2UocmVEZWxpbWl0ZXJzLCBmdW5jdGlvbihtYXRjaCwgZXNjYXBlVmFsdWUsIGludGVycG9sYXRlVmFsdWUsIGVzVGVtcGxhdGVWYWx1ZSwgZXZhbHVhdGVWYWx1ZSwgb2Zmc2V0KSB7XG4gICAgICAgIGludGVycG9sYXRlVmFsdWUgfHwgKGludGVycG9sYXRlVmFsdWUgPSBlc1RlbXBsYXRlVmFsdWUpO1xuXG4gICAgICAgIC8vIEVzY2FwZSBjaGFyYWN0ZXJzIHRoYXQgY2FuJ3QgYmUgaW5jbHVkZWQgaW4gc3RyaW5nIGxpdGVyYWxzLlxuICAgICAgICBzb3VyY2UgKz0gc3RyaW5nLnNsaWNlKGluZGV4LCBvZmZzZXQpLnJlcGxhY2UocmVVbmVzY2FwZWRTdHJpbmcsIGVzY2FwZVN0cmluZ0NoYXIpO1xuXG4gICAgICAgIC8vIFJlcGxhY2UgZGVsaW1pdGVycyB3aXRoIHNuaXBwZXRzLlxuICAgICAgICBpZiAoZXNjYXBlVmFsdWUpIHtcbiAgICAgICAgICBpc0VzY2FwaW5nID0gdHJ1ZTtcbiAgICAgICAgICBzb3VyY2UgKz0gXCInICtcXG5fX2UoXCIgKyBlc2NhcGVWYWx1ZSArIFwiKSArXFxuJ1wiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmFsdWF0ZVZhbHVlKSB7XG4gICAgICAgICAgaXNFdmFsdWF0aW5nID0gdHJ1ZTtcbiAgICAgICAgICBzb3VyY2UgKz0gXCInO1xcblwiICsgZXZhbHVhdGVWYWx1ZSArIFwiO1xcbl9fcCArPSAnXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGludGVycG9sYXRlVmFsdWUpIHtcbiAgICAgICAgICBzb3VyY2UgKz0gXCInICtcXG4oKF9fdCA9IChcIiArIGludGVycG9sYXRlVmFsdWUgKyBcIikpID09IG51bGwgPyAnJyA6IF9fdCkgK1xcbidcIjtcbiAgICAgICAgfVxuICAgICAgICBpbmRleCA9IG9mZnNldCArIG1hdGNoLmxlbmd0aDtcblxuICAgICAgICAvLyBUaGUgSlMgZW5naW5lIGVtYmVkZGVkIGluIEFkb2JlIHByb2R1Y3RzIG5lZWRzIGBtYXRjaGAgcmV0dXJuZWQgaW5cbiAgICAgICAgLy8gb3JkZXIgdG8gcHJvZHVjZSB0aGUgY29ycmVjdCBgb2Zmc2V0YCB2YWx1ZS5cbiAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgfSk7XG5cbiAgICAgIHNvdXJjZSArPSBcIic7XFxuXCI7XG5cbiAgICAgIC8vIElmIGB2YXJpYWJsZWAgaXMgbm90IHNwZWNpZmllZCB3cmFwIGEgd2l0aC1zdGF0ZW1lbnQgYXJvdW5kIHRoZSBnZW5lcmF0ZWRcbiAgICAgIC8vIGNvZGUgdG8gYWRkIHRoZSBkYXRhIG9iamVjdCB0byB0aGUgdG9wIG9mIHRoZSBzY29wZSBjaGFpbi5cbiAgICAgIHZhciB2YXJpYWJsZSA9IG9wdGlvbnMudmFyaWFibGU7XG4gICAgICBpZiAoIXZhcmlhYmxlKSB7XG4gICAgICAgIHNvdXJjZSA9ICd3aXRoIChvYmopIHtcXG4nICsgc291cmNlICsgJ1xcbn1cXG4nO1xuICAgICAgfVxuICAgICAgLy8gQ2xlYW51cCBjb2RlIGJ5IHN0cmlwcGluZyBlbXB0eSBzdHJpbmdzLlxuICAgICAgc291cmNlID0gKGlzRXZhbHVhdGluZyA/IHNvdXJjZS5yZXBsYWNlKHJlRW1wdHlTdHJpbmdMZWFkaW5nLCAnJykgOiBzb3VyY2UpXG4gICAgICAgIC5yZXBsYWNlKHJlRW1wdHlTdHJpbmdNaWRkbGUsICckMScpXG4gICAgICAgIC5yZXBsYWNlKHJlRW1wdHlTdHJpbmdUcmFpbGluZywgJyQxOycpO1xuXG4gICAgICAvLyBGcmFtZSBjb2RlIGFzIHRoZSBmdW5jdGlvbiBib2R5LlxuICAgICAgc291cmNlID0gJ2Z1bmN0aW9uKCcgKyAodmFyaWFibGUgfHwgJ29iaicpICsgJykge1xcbicgK1xuICAgICAgICAodmFyaWFibGVcbiAgICAgICAgICA/ICcnXG4gICAgICAgICAgOiAnb2JqIHx8IChvYmogPSB7fSk7XFxuJ1xuICAgICAgICApICtcbiAgICAgICAgXCJ2YXIgX190LCBfX3AgPSAnJ1wiICtcbiAgICAgICAgKGlzRXNjYXBpbmdcbiAgICAgICAgICAgPyAnLCBfX2UgPSBfLmVzY2FwZSdcbiAgICAgICAgICAgOiAnJ1xuICAgICAgICApICtcbiAgICAgICAgKGlzRXZhbHVhdGluZ1xuICAgICAgICAgID8gJywgX19qID0gQXJyYXkucHJvdG90eXBlLmpvaW47XFxuJyArXG4gICAgICAgICAgICBcImZ1bmN0aW9uIHByaW50KCkgeyBfX3AgKz0gX19qLmNhbGwoYXJndW1lbnRzLCAnJykgfVxcblwiXG4gICAgICAgICAgOiAnO1xcbidcbiAgICAgICAgKSArXG4gICAgICAgIHNvdXJjZSArXG4gICAgICAgICdyZXR1cm4gX19wXFxufSc7XG5cbiAgICAgIHZhciByZXN1bHQgPSBhdHRlbXB0KGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gRnVuY3Rpb24oaW1wb3J0c0tleXMsIHNvdXJjZVVSTCArICdyZXR1cm4gJyArIHNvdXJjZSlcbiAgICAgICAgICAuYXBwbHkodW5kZWZpbmVkLCBpbXBvcnRzVmFsdWVzKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbidzIHNvdXJjZSBieSBpdHMgYHRvU3RyaW5nYCBtZXRob2Qgb3JcbiAgICAgIC8vIHRoZSBgc291cmNlYCBwcm9wZXJ0eSBhcyBhIGNvbnZlbmllbmNlIGZvciBpbmxpbmluZyBjb21waWxlZCB0ZW1wbGF0ZXMuXG4gICAgICByZXN1bHQuc291cmNlID0gc291cmNlO1xuICAgICAgaWYgKGlzRXJyb3IocmVzdWx0KSkge1xuICAgICAgICB0aHJvdyByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgLCBhcyBhIHdob2xlLCB0byBsb3dlciBjYXNlIGp1c3QgbGlrZVxuICAgICAqIFtTdHJpbmcjdG9Mb3dlckNhc2VdKGh0dHBzOi8vbWRuLmlvL3RvTG93ZXJDYXNlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGxvd2VyIGNhc2VkIHN0cmluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50b0xvd2VyKCctLUZvby1CYXItLScpO1xuICAgICAqIC8vID0+ICctLWZvby1iYXItLSdcbiAgICAgKlxuICAgICAqIF8udG9Mb3dlcignZm9vQmFyJyk7XG4gICAgICogLy8gPT4gJ2Zvb2JhcidcbiAgICAgKlxuICAgICAqIF8udG9Mb3dlcignX19GT09fQkFSX18nKTtcbiAgICAgKiAvLyA9PiAnX19mb29fYmFyX18nXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9Mb3dlcih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHRvU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGBzdHJpbmdgLCBhcyBhIHdob2xlLCB0byB1cHBlciBjYXNlIGp1c3QgbGlrZVxuICAgICAqIFtTdHJpbmcjdG9VcHBlckNhc2VdKGh0dHBzOi8vbWRuLmlvL3RvVXBwZXJDYXNlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHVwcGVyIGNhc2VkIHN0cmluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50b1VwcGVyKCctLWZvby1iYXItLScpO1xuICAgICAqIC8vID0+ICctLUZPTy1CQVItLSdcbiAgICAgKlxuICAgICAqIF8udG9VcHBlcignZm9vQmFyJyk7XG4gICAgICogLy8gPT4gJ0ZPT0JBUidcbiAgICAgKlxuICAgICAqIF8udG9VcHBlcignX19mb29fYmFyX18nKTtcbiAgICAgKiAvLyA9PiAnX19GT09fQkFSX18nXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9VcHBlcih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHRvU3RyaW5nKHZhbHVlKS50b1VwcGVyQ2FzZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZSBvciBzcGVjaWZpZWQgY2hhcmFjdGVycyBmcm9tIGBzdHJpbmdgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHRyaW0uXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz13aGl0ZXNwYWNlXSBUaGUgY2hhcmFjdGVycyB0byB0cmltLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udHJpbSgnICBhYmMgICcpO1xuICAgICAqIC8vID0+ICdhYmMnXG4gICAgICpcbiAgICAgKiBfLnRyaW0oJy1fLWFiYy1fLScsICdfLScpO1xuICAgICAqIC8vID0+ICdhYmMnXG4gICAgICpcbiAgICAgKiBfLm1hcChbJyAgZm9vICAnLCAnICBiYXIgICddLCBfLnRyaW0pO1xuICAgICAqIC8vID0+IFsnZm9vJywgJ2JhciddXG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJpbShzdHJpbmcsIGNoYXJzLCBndWFyZCkge1xuICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTtcbiAgICAgIGlmIChzdHJpbmcgJiYgKGd1YXJkIHx8IGNoYXJzID09PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZShyZVRyaW0sICcnKTtcbiAgICAgIH1cbiAgICAgIGlmICghc3RyaW5nIHx8ICEoY2hhcnMgPSBiYXNlVG9TdHJpbmcoY2hhcnMpKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nO1xuICAgICAgfVxuICAgICAgdmFyIHN0clN5bWJvbHMgPSBzdHJpbmdUb0FycmF5KHN0cmluZyksXG4gICAgICAgICAgY2hyU3ltYm9scyA9IHN0cmluZ1RvQXJyYXkoY2hhcnMpLFxuICAgICAgICAgIHN0YXJ0ID0gY2hhcnNTdGFydEluZGV4KHN0clN5bWJvbHMsIGNoclN5bWJvbHMpLFxuICAgICAgICAgIGVuZCA9IGNoYXJzRW5kSW5kZXgoc3RyU3ltYm9scywgY2hyU3ltYm9scykgKyAxO1xuXG4gICAgICByZXR1cm4gY2FzdFNsaWNlKHN0clN5bWJvbHMsIHN0YXJ0LCBlbmQpLmpvaW4oJycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdHJhaWxpbmcgd2hpdGVzcGFjZSBvciBzcGVjaWZpZWQgY2hhcmFjdGVycyBmcm9tIGBzdHJpbmdgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHRyaW0uXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz13aGl0ZXNwYWNlXSBUaGUgY2hhcmFjdGVycyB0byB0cmltLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udHJpbUVuZCgnICBhYmMgICcpO1xuICAgICAqIC8vID0+ICcgIGFiYydcbiAgICAgKlxuICAgICAqIF8udHJpbUVuZCgnLV8tYWJjLV8tJywgJ18tJyk7XG4gICAgICogLy8gPT4gJy1fLWFiYydcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0cmltRW5kKHN0cmluZywgY2hhcnMsIGd1YXJkKSB7XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuICAgICAgaWYgKHN0cmluZyAmJiAoZ3VhcmQgfHwgY2hhcnMgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKHJlVHJpbUVuZCwgJycpO1xuICAgICAgfVxuICAgICAgaWYgKCFzdHJpbmcgfHwgIShjaGFycyA9IGJhc2VUb1N0cmluZyhjaGFycykpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmc7XG4gICAgICB9XG4gICAgICB2YXIgc3RyU3ltYm9scyA9IHN0cmluZ1RvQXJyYXkoc3RyaW5nKSxcbiAgICAgICAgICBlbmQgPSBjaGFyc0VuZEluZGV4KHN0clN5bWJvbHMsIHN0cmluZ1RvQXJyYXkoY2hhcnMpKSArIDE7XG5cbiAgICAgIHJldHVybiBjYXN0U2xpY2Uoc3RyU3ltYm9scywgMCwgZW5kKS5qb2luKCcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGxlYWRpbmcgd2hpdGVzcGFjZSBvciBzcGVjaWZpZWQgY2hhcmFjdGVycyBmcm9tIGBzdHJpbmdgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHRyaW0uXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjaGFycz13aGl0ZXNwYWNlXSBUaGUgY2hhcmFjdGVycyB0byB0cmltLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udHJpbVN0YXJ0KCcgIGFiYyAgJyk7XG4gICAgICogLy8gPT4gJ2FiYyAgJ1xuICAgICAqXG4gICAgICogXy50cmltU3RhcnQoJy1fLWFiYy1fLScsICdfLScpO1xuICAgICAqIC8vID0+ICdhYmMtXy0nXG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJpbVN0YXJ0KHN0cmluZywgY2hhcnMsIGd1YXJkKSB7XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuICAgICAgaWYgKHN0cmluZyAmJiAoZ3VhcmQgfHwgY2hhcnMgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKHJlVHJpbVN0YXJ0LCAnJyk7XG4gICAgICB9XG4gICAgICBpZiAoIXN0cmluZyB8fCAhKGNoYXJzID0gYmFzZVRvU3RyaW5nKGNoYXJzKSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICAgIH1cbiAgICAgIHZhciBzdHJTeW1ib2xzID0gc3RyaW5nVG9BcnJheShzdHJpbmcpLFxuICAgICAgICAgIHN0YXJ0ID0gY2hhcnNTdGFydEluZGV4KHN0clN5bWJvbHMsIHN0cmluZ1RvQXJyYXkoY2hhcnMpKTtcblxuICAgICAgcmV0dXJuIGNhc3RTbGljZShzdHJTeW1ib2xzLCBzdGFydCkuam9pbignJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJ1bmNhdGVzIGBzdHJpbmdgIGlmIGl0J3MgbG9uZ2VyIHRoYW4gdGhlIGdpdmVuIG1heGltdW0gc3RyaW5nIGxlbmd0aC5cbiAgICAgKiBUaGUgbGFzdCBjaGFyYWN0ZXJzIG9mIHRoZSB0cnVuY2F0ZWQgc3RyaW5nIGFyZSByZXBsYWNlZCB3aXRoIHRoZSBvbWlzc2lvblxuICAgICAqIHN0cmluZyB3aGljaCBkZWZhdWx0cyB0byBcIi4uLlwiLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHRydW5jYXRlLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5sZW5ndGg9MzBdIFRoZSBtYXhpbXVtIHN0cmluZyBsZW5ndGguXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLm9taXNzaW9uPScuLi4nXSBUaGUgc3RyaW5nIHRvIGluZGljYXRlIHRleHQgaXMgb21pdHRlZC5cbiAgICAgKiBAcGFyYW0ge1JlZ0V4cHxzdHJpbmd9IFtvcHRpb25zLnNlcGFyYXRvcl0gVGhlIHNlcGFyYXRvciBwYXR0ZXJuIHRvIHRydW5jYXRlIHRvLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHRydW5jYXRlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udHJ1bmNhdGUoJ2hpLWRpZGRseS1obyB0aGVyZSwgbmVpZ2hib3Jpbm8nKTtcbiAgICAgKiAvLyA9PiAnaGktZGlkZGx5LWhvIHRoZXJlLCBuZWlnaGJvLi4uJ1xuICAgICAqXG4gICAgICogXy50cnVuY2F0ZSgnaGktZGlkZGx5LWhvIHRoZXJlLCBuZWlnaGJvcmlubycsIHtcbiAgICAgKiAgICdsZW5ndGgnOiAyNCxcbiAgICAgKiAgICdzZXBhcmF0b3InOiAnICdcbiAgICAgKiB9KTtcbiAgICAgKiAvLyA9PiAnaGktZGlkZGx5LWhvIHRoZXJlLC4uLidcbiAgICAgKlxuICAgICAqIF8udHJ1bmNhdGUoJ2hpLWRpZGRseS1obyB0aGVyZSwgbmVpZ2hib3Jpbm8nLCB7XG4gICAgICogICAnbGVuZ3RoJzogMjQsXG4gICAgICogICAnc2VwYXJhdG9yJzogLyw/ICsvXG4gICAgICogfSk7XG4gICAgICogLy8gPT4gJ2hpLWRpZGRseS1obyB0aGVyZS4uLidcbiAgICAgKlxuICAgICAqIF8udHJ1bmNhdGUoJ2hpLWRpZGRseS1obyB0aGVyZSwgbmVpZ2hib3Jpbm8nLCB7XG4gICAgICogICAnb21pc3Npb24nOiAnIFsuLi5dJ1xuICAgICAqIH0pO1xuICAgICAqIC8vID0+ICdoaS1kaWRkbHktaG8gdGhlcmUsIG5laWcgWy4uLl0nXG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJ1bmNhdGUoc3RyaW5nLCBvcHRpb25zKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gREVGQVVMVF9UUlVOQ19MRU5HVEgsXG4gICAgICAgICAgb21pc3Npb24gPSBERUZBVUxUX1RSVU5DX09NSVNTSU9OO1xuXG4gICAgICBpZiAoaXNPYmplY3Qob3B0aW9ucykpIHtcbiAgICAgICAgdmFyIHNlcGFyYXRvciA9ICdzZXBhcmF0b3InIGluIG9wdGlvbnMgPyBvcHRpb25zLnNlcGFyYXRvciA6IHNlcGFyYXRvcjtcbiAgICAgICAgbGVuZ3RoID0gJ2xlbmd0aCcgaW4gb3B0aW9ucyA/IHRvSW50ZWdlcihvcHRpb25zLmxlbmd0aCkgOiBsZW5ndGg7XG4gICAgICAgIG9taXNzaW9uID0gJ29taXNzaW9uJyBpbiBvcHRpb25zID8gYmFzZVRvU3RyaW5nKG9wdGlvbnMub21pc3Npb24pIDogb21pc3Npb247XG4gICAgICB9XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuXG4gICAgICB2YXIgc3RyTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDtcbiAgICAgIGlmIChoYXNVbmljb2RlKHN0cmluZykpIHtcbiAgICAgICAgdmFyIHN0clN5bWJvbHMgPSBzdHJpbmdUb0FycmF5KHN0cmluZyk7XG4gICAgICAgIHN0ckxlbmd0aCA9IHN0clN5bWJvbHMubGVuZ3RoO1xuICAgICAgfVxuICAgICAgaWYgKGxlbmd0aCA+PSBzdHJMZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICAgIH1cbiAgICAgIHZhciBlbmQgPSBsZW5ndGggLSBzdHJpbmdTaXplKG9taXNzaW9uKTtcbiAgICAgIGlmIChlbmQgPCAxKSB7XG4gICAgICAgIHJldHVybiBvbWlzc2lvbjtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSBzdHJTeW1ib2xzXG4gICAgICAgID8gY2FzdFNsaWNlKHN0clN5bWJvbHMsIDAsIGVuZCkuam9pbignJylcbiAgICAgICAgOiBzdHJpbmcuc2xpY2UoMCwgZW5kKTtcblxuICAgICAgaWYgKHNlcGFyYXRvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQgKyBvbWlzc2lvbjtcbiAgICAgIH1cbiAgICAgIGlmIChzdHJTeW1ib2xzKSB7XG4gICAgICAgIGVuZCArPSAocmVzdWx0Lmxlbmd0aCAtIGVuZCk7XG4gICAgICB9XG4gICAgICBpZiAoaXNSZWdFeHAoc2VwYXJhdG9yKSkge1xuICAgICAgICBpZiAoc3RyaW5nLnNsaWNlKGVuZCkuc2VhcmNoKHNlcGFyYXRvcikpIHtcbiAgICAgICAgICB2YXIgbWF0Y2gsXG4gICAgICAgICAgICAgIHN1YnN0cmluZyA9IHJlc3VsdDtcblxuICAgICAgICAgIGlmICghc2VwYXJhdG9yLmdsb2JhbCkge1xuICAgICAgICAgICAgc2VwYXJhdG9yID0gUmVnRXhwKHNlcGFyYXRvci5zb3VyY2UsIHRvU3RyaW5nKHJlRmxhZ3MuZXhlYyhzZXBhcmF0b3IpKSArICdnJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlcGFyYXRvci5sYXN0SW5kZXggPSAwO1xuICAgICAgICAgIHdoaWxlICgobWF0Y2ggPSBzZXBhcmF0b3IuZXhlYyhzdWJzdHJpbmcpKSkge1xuICAgICAgICAgICAgdmFyIG5ld0VuZCA9IG1hdGNoLmluZGV4O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHQgPSByZXN1bHQuc2xpY2UoMCwgbmV3RW5kID09PSB1bmRlZmluZWQgPyBlbmQgOiBuZXdFbmQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHN0cmluZy5pbmRleE9mKGJhc2VUb1N0cmluZyhzZXBhcmF0b3IpLCBlbmQpICE9IGVuZCkge1xuICAgICAgICB2YXIgaW5kZXggPSByZXN1bHQubGFzdEluZGV4T2Yoc2VwYXJhdG9yKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICByZXN1bHQgPSByZXN1bHQuc2xpY2UoMCwgaW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0ICsgb21pc3Npb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGludmVyc2Ugb2YgYF8uZXNjYXBlYDsgdGhpcyBtZXRob2QgY29udmVydHMgdGhlIEhUTUwgZW50aXRpZXNcbiAgICAgKiBgJmFtcDtgLCBgJmx0O2AsIGAmZ3Q7YCwgYCZxdW90O2AsIGFuZCBgJiMzOTtgIGluIGBzdHJpbmdgIHRvXG4gICAgICogdGhlaXIgY29ycmVzcG9uZGluZyBjaGFyYWN0ZXJzLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIE5vIG90aGVyIEhUTUwgZW50aXRpZXMgYXJlIHVuZXNjYXBlZC4gVG8gdW5lc2NhcGUgYWRkaXRpb25hbFxuICAgICAqIEhUTUwgZW50aXRpZXMgdXNlIGEgdGhpcmQtcGFydHkgbGlicmFyeSBsaWtlIFtfaGVfXShodHRwczovL210aHMuYmUvaGUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDAuNi4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIHVuZXNjYXBlLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHVuZXNjYXBlZCBzdHJpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udW5lc2NhcGUoJ2ZyZWQsIGJhcm5leSwgJmFtcDsgcGViYmxlcycpO1xuICAgICAqIC8vID0+ICdmcmVkLCBiYXJuZXksICYgcGViYmxlcydcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bmVzY2FwZShzdHJpbmcpIHtcbiAgICAgIHN0cmluZyA9IHRvU3RyaW5nKHN0cmluZyk7XG4gICAgICByZXR1cm4gKHN0cmluZyAmJiByZUhhc0VzY2FwZWRIdG1sLnRlc3Qoc3RyaW5nKSlcbiAgICAgICAgPyBzdHJpbmcucmVwbGFjZShyZUVzY2FwZWRIdG1sLCB1bmVzY2FwZUh0bWxDaGFyKVxuICAgICAgICA6IHN0cmluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBgc3RyaW5nYCwgYXMgc3BhY2Ugc2VwYXJhdGVkIHdvcmRzLCB0byB1cHBlciBjYXNlLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdXBwZXIgY2FzZWQgc3RyaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnVwcGVyQ2FzZSgnLS1mb28tYmFyJyk7XG4gICAgICogLy8gPT4gJ0ZPTyBCQVInXG4gICAgICpcbiAgICAgKiBfLnVwcGVyQ2FzZSgnZm9vQmFyJyk7XG4gICAgICogLy8gPT4gJ0ZPTyBCQVInXG4gICAgICpcbiAgICAgKiBfLnVwcGVyQ2FzZSgnX19mb29fYmFyX18nKTtcbiAgICAgKiAvLyA9PiAnRk9PIEJBUidcbiAgICAgKi9cbiAgICB2YXIgdXBwZXJDYXNlID0gY3JlYXRlQ29tcG91bmRlcihmdW5jdGlvbihyZXN1bHQsIHdvcmQsIGluZGV4KSB7XG4gICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gJyAnIDogJycpICsgd29yZC50b1VwcGVyQ2FzZSgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhlIGZpcnN0IGNoYXJhY3RlciBvZiBgc3RyaW5nYCB0byB1cHBlciBjYXNlLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFN0cmluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY29udmVydGVkIHN0cmluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy51cHBlckZpcnN0KCdmcmVkJyk7XG4gICAgICogLy8gPT4gJ0ZyZWQnXG4gICAgICpcbiAgICAgKiBfLnVwcGVyRmlyc3QoJ0ZSRUQnKTtcbiAgICAgKiAvLyA9PiAnRlJFRCdcbiAgICAgKi9cbiAgICB2YXIgdXBwZXJGaXJzdCA9IGNyZWF0ZUNhc2VGaXJzdCgndG9VcHBlckNhc2UnKTtcblxuICAgIC8qKlxuICAgICAqIFNwbGl0cyBgc3RyaW5nYCBpbnRvIGFuIGFycmF5IG9mIGl0cyB3b3Jkcy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBTdHJpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBpbnNwZWN0LlxuICAgICAqIEBwYXJhbSB7UmVnRXhwfHN0cmluZ30gW3BhdHRlcm5dIFRoZSBwYXR0ZXJuIHRvIG1hdGNoIHdvcmRzLlxuICAgICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB3b3JkcyBvZiBgc3RyaW5nYC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy53b3JkcygnZnJlZCwgYmFybmV5LCAmIHBlYmJsZXMnKTtcbiAgICAgKiAvLyA9PiBbJ2ZyZWQnLCAnYmFybmV5JywgJ3BlYmJsZXMnXVxuICAgICAqXG4gICAgICogXy53b3JkcygnZnJlZCwgYmFybmV5LCAmIHBlYmJsZXMnLCAvW14sIF0rL2cpO1xuICAgICAqIC8vID0+IFsnZnJlZCcsICdiYXJuZXknLCAnJicsICdwZWJibGVzJ11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB3b3JkcyhzdHJpbmcsIHBhdHRlcm4sIGd1YXJkKSB7XG4gICAgICBzdHJpbmcgPSB0b1N0cmluZyhzdHJpbmcpO1xuICAgICAgcGF0dGVybiA9IGd1YXJkID8gdW5kZWZpbmVkIDogcGF0dGVybjtcblxuICAgICAgaWYgKHBhdHRlcm4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gaGFzVW5pY29kZVdvcmQoc3RyaW5nKSA/IHVuaWNvZGVXb3JkcyhzdHJpbmcpIDogYXNjaWlXb3JkcyhzdHJpbmcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0cmluZy5tYXRjaChwYXR0ZXJuKSB8fCBbXTtcbiAgICB9XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBBdHRlbXB0cyB0byBpbnZva2UgYGZ1bmNgLCByZXR1cm5pbmcgZWl0aGVyIHRoZSByZXN1bHQgb3IgdGhlIGNhdWdodCBlcnJvclxuICAgICAqIG9iamVjdC4gQW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIGFyZSBwcm92aWRlZCB0byBgZnVuY2Agd2hlbiBpdCdzIGludm9rZWQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGF0dGVtcHQuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgYGZ1bmNgIHdpdGguXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGBmdW5jYCByZXN1bHQgb3IgZXJyb3Igb2JqZWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiAvLyBBdm9pZCB0aHJvd2luZyBlcnJvcnMgZm9yIGludmFsaWQgc2VsZWN0b3JzLlxuICAgICAqIHZhciBlbGVtZW50cyA9IF8uYXR0ZW1wdChmdW5jdGlvbihzZWxlY3Rvcikge1xuICAgICAqICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgICAqIH0sICc+Xz4nKTtcbiAgICAgKlxuICAgICAqIGlmIChfLmlzRXJyb3IoZWxlbWVudHMpKSB7XG4gICAgICogICBlbGVtZW50cyA9IFtdO1xuICAgICAqIH1cbiAgICAgKi9cbiAgICB2YXIgYXR0ZW1wdCA9IGJhc2VSZXN0KGZ1bmN0aW9uKGZ1bmMsIGFyZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhcHBseShmdW5jLCB1bmRlZmluZWQsIGFyZ3MpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gaXNFcnJvcihlKSA/IGUgOiBuZXcgRXJyb3IoZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBCaW5kcyBtZXRob2RzIG9mIGFuIG9iamVjdCB0byB0aGUgb2JqZWN0IGl0c2VsZiwgb3ZlcndyaXRpbmcgdGhlIGV4aXN0aW5nXG4gICAgICogbWV0aG9kLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGRvZXNuJ3Qgc2V0IHRoZSBcImxlbmd0aFwiIHByb3BlcnR5IG9mIGJvdW5kIGZ1bmN0aW9ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGJpbmQgYW5kIGFzc2lnbiB0aGUgYm91bmQgbWV0aG9kcyB0by5cbiAgICAgKiBAcGFyYW0gey4uLihzdHJpbmd8c3RyaW5nW10pfSBtZXRob2ROYW1lcyBUaGUgb2JqZWN0IG1ldGhvZCBuYW1lcyB0byBiaW5kLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciB2aWV3ID0ge1xuICAgICAqICAgJ2xhYmVsJzogJ2RvY3MnLFxuICAgICAqICAgJ2NsaWNrJzogZnVuY3Rpb24oKSB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKCdjbGlja2VkICcgKyB0aGlzLmxhYmVsKTtcbiAgICAgKiAgIH1cbiAgICAgKiB9O1xuICAgICAqXG4gICAgICogXy5iaW5kQWxsKHZpZXcsIFsnY2xpY2snXSk7XG4gICAgICogalF1ZXJ5KGVsZW1lbnQpLm9uKCdjbGljaycsIHZpZXcuY2xpY2spO1xuICAgICAqIC8vID0+IExvZ3MgJ2NsaWNrZWQgZG9jcycgd2hlbiBjbGlja2VkLlxuICAgICAqL1xuICAgIHZhciBiaW5kQWxsID0gZmxhdFJlc3QoZnVuY3Rpb24ob2JqZWN0LCBtZXRob2ROYW1lcykge1xuICAgICAgYXJyYXlFYWNoKG1ldGhvZE5hbWVzLCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAga2V5ID0gdG9LZXkoa2V5KTtcbiAgICAgICAgYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCBiaW5kKG9iamVjdFtrZXldLCBvYmplY3QpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGl0ZXJhdGVzIG92ZXIgYHBhaXJzYCBhbmQgaW52b2tlcyB0aGUgY29ycmVzcG9uZGluZ1xuICAgICAqIGZ1bmN0aW9uIG9mIHRoZSBmaXJzdCBwcmVkaWNhdGUgdG8gcmV0dXJuIHRydXRoeS4gVGhlIHByZWRpY2F0ZS1mdW5jdGlvblxuICAgICAqIHBhaXJzIGFyZSBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIGFuZCBhcmd1bWVudHMgb2YgdGhlIGNyZWF0ZWRcbiAgICAgKiBmdW5jdGlvbi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtBcnJheX0gcGFpcnMgVGhlIHByZWRpY2F0ZS1mdW5jdGlvbiBwYWlycy5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjb21wb3NpdGUgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBmdW5jID0gXy5jb25kKFtcbiAgICAgKiAgIFtfLm1hdGNoZXMoeyAnYSc6IDEgfSksICAgICAgICAgICBfLmNvbnN0YW50KCdtYXRjaGVzIEEnKV0sXG4gICAgICogICBbXy5jb25mb3Jtcyh7ICdiJzogXy5pc051bWJlciB9KSwgXy5jb25zdGFudCgnbWF0Y2hlcyBCJyldLFxuICAgICAqICAgW18uc3R1YlRydWUsICAgICAgICAgICAgICAgICAgICAgIF8uY29uc3RhbnQoJ25vIG1hdGNoJyldXG4gICAgICogXSk7XG4gICAgICpcbiAgICAgKiBmdW5jKHsgJ2EnOiAxLCAnYic6IDIgfSk7XG4gICAgICogLy8gPT4gJ21hdGNoZXMgQSdcbiAgICAgKlxuICAgICAqIGZ1bmMoeyAnYSc6IDAsICdiJzogMSB9KTtcbiAgICAgKiAvLyA9PiAnbWF0Y2hlcyBCJ1xuICAgICAqXG4gICAgICogZnVuYyh7ICdhJzogJzEnLCAnYic6ICcyJyB9KTtcbiAgICAgKiAvLyA9PiAnbm8gbWF0Y2gnXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29uZChwYWlycykge1xuICAgICAgdmFyIGxlbmd0aCA9IHBhaXJzID09IG51bGwgPyAwIDogcGFpcnMubGVuZ3RoLFxuICAgICAgICAgIHRvSXRlcmF0ZWUgPSBnZXRJdGVyYXRlZSgpO1xuXG4gICAgICBwYWlycyA9ICFsZW5ndGggPyBbXSA6IGFycmF5TWFwKHBhaXJzLCBmdW5jdGlvbihwYWlyKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcGFpclsxXSAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbdG9JdGVyYXRlZShwYWlyWzBdKSwgcGFpclsxXV07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGJhc2VSZXN0KGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIHBhaXIgPSBwYWlyc1tpbmRleF07XG4gICAgICAgICAgaWYgKGFwcGx5KHBhaXJbMF0sIHRoaXMsIGFyZ3MpKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwbHkocGFpclsxXSwgdGhpcywgYXJncyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIHRoZSBwcmVkaWNhdGUgcHJvcGVydGllcyBvZiBgc291cmNlYCB3aXRoXG4gICAgICogdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdmFsdWVzIG9mIGEgZ2l2ZW4gb2JqZWN0LCByZXR1cm5pbmcgYHRydWVgIGlmXG4gICAgICogYWxsIHByZWRpY2F0ZXMgcmV0dXJuIHRydXRoeSwgZWxzZSBgZmFsc2VgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoZSBjcmVhdGVkIGZ1bmN0aW9uIGlzIGVxdWl2YWxlbnQgdG8gYF8uY29uZm9ybXNUb2Agd2l0aFxuICAgICAqIGBzb3VyY2VgIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3Qgb2YgcHJvcGVydHkgcHJlZGljYXRlcyB0byBjb25mb3JtIHRvLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW1xuICAgICAqICAgeyAnYSc6IDIsICdiJzogMSB9LFxuICAgICAqICAgeyAnYSc6IDEsICdiJzogMiB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8uZmlsdGVyKG9iamVjdHMsIF8uY29uZm9ybXMoeyAnYic6IGZ1bmN0aW9uKG4pIHsgcmV0dXJuIG4gPiAxOyB9IH0pKTtcbiAgICAgKiAvLyA9PiBbeyAnYSc6IDEsICdiJzogMiB9XVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbmZvcm1zKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIGJhc2VDb25mb3JtcyhiYXNlQ2xvbmUoc291cmNlLCBDTE9ORV9ERUVQX0ZMQUcpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGB2YWx1ZWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMi40LjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHJldHVybiBmcm9tIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY29uc3RhbnQgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gXy50aW1lcygyLCBfLmNvbnN0YW50KHsgJ2EnOiAxIH0pKTtcbiAgICAgKlxuICAgICAqIGNvbnNvbGUubG9nKG9iamVjdHMpO1xuICAgICAqIC8vID0+IFt7ICdhJzogMSB9LCB7ICdhJzogMSB9XVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2cob2JqZWN0c1swXSA9PT0gb2JqZWN0c1sxXSk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbnN0YW50KHZhbHVlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGB2YWx1ZWAgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBkZWZhdWx0IHZhbHVlIHNob3VsZCBiZSByZXR1cm5lZCBpblxuICAgICAqIGl0cyBwbGFjZS4gVGhlIGBkZWZhdWx0VmFsdWVgIGlzIHJldHVybmVkIGlmIGB2YWx1ZWAgaXMgYE5hTmAsIGBudWxsYCxcbiAgICAgKiBvciBgdW5kZWZpbmVkYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjE0LjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgICAqIEBwYXJhbSB7Kn0gZGVmYXVsdFZhbHVlIFRoZSBkZWZhdWx0IHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5kZWZhdWx0VG8oMSwgMTApO1xuICAgICAqIC8vID0+IDFcbiAgICAgKlxuICAgICAqIF8uZGVmYXVsdFRvKHVuZGVmaW5lZCwgMTApO1xuICAgICAqIC8vID0+IDEwXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVmYXVsdFRvKHZhbHVlLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIHJldHVybiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSAhPT0gdmFsdWUpID8gZGVmYXVsdFZhbHVlIDogdmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBnaXZlbiBmdW5jdGlvbnNcbiAgICAgKiB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiB0aGUgY3JlYXRlZCBmdW5jdGlvbiwgd2hlcmUgZWFjaCBzdWNjZXNzaXZlXG4gICAgICogaW52b2NhdGlvbiBpcyBzdXBwbGllZCB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBwcmV2aW91cy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHsuLi4oRnVuY3Rpb258RnVuY3Rpb25bXSl9IFtmdW5jc10gVGhlIGZ1bmN0aW9ucyB0byBpbnZva2UuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY29tcG9zaXRlIGZ1bmN0aW9uLlxuICAgICAqIEBzZWUgXy5mbG93UmlnaHRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gc3F1YXJlKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICogbjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgYWRkU3F1YXJlID0gXy5mbG93KFtfLmFkZCwgc3F1YXJlXSk7XG4gICAgICogYWRkU3F1YXJlKDEsIDIpO1xuICAgICAqIC8vID0+IDlcbiAgICAgKi9cbiAgICB2YXIgZmxvdyA9IGNyZWF0ZUZsb3coKTtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uZmxvd2AgZXhjZXB0IHRoYXQgaXQgY3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXRcbiAgICAgKiBpbnZva2VzIHRoZSBnaXZlbiBmdW5jdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0gey4uLihGdW5jdGlvbnxGdW5jdGlvbltdKX0gW2Z1bmNzXSBUaGUgZnVuY3Rpb25zIHRvIGludm9rZS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjb21wb3NpdGUgZnVuY3Rpb24uXG4gICAgICogQHNlZSBfLmZsb3dcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gc3F1YXJlKG4pIHtcbiAgICAgKiAgIHJldHVybiBuICogbjtcbiAgICAgKiB9XG4gICAgICpcbiAgICAgKiB2YXIgYWRkU3F1YXJlID0gXy5mbG93UmlnaHQoW3NxdWFyZSwgXy5hZGRdKTtcbiAgICAgKiBhZGRTcXVhcmUoMSwgMik7XG4gICAgICogLy8gPT4gOVxuICAgICAqL1xuICAgIHZhciBmbG93UmlnaHQgPSBjcmVhdGVGbG93KHRydWUpO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgaXQgcmVjZWl2ZXMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHNpbmNlIDAuMS4wXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgQW55IHZhbHVlLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIGB2YWx1ZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSB9O1xuICAgICAqXG4gICAgICogY29uc29sZS5sb2coXy5pZGVudGl0eShvYmplY3QpID09PSBvYmplY3QpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGFyZ3VtZW50cyBvZiB0aGUgY3JlYXRlZFxuICAgICAqIGZ1bmN0aW9uLiBJZiBgZnVuY2AgaXMgYSBwcm9wZXJ0eSBuYW1lLCB0aGUgY3JlYXRlZCBmdW5jdGlvbiByZXR1cm5zIHRoZVxuICAgICAqIHByb3BlcnR5IHZhbHVlIGZvciBhIGdpdmVuIGVsZW1lbnQuIElmIGBmdW5jYCBpcyBhbiBhcnJheSBvciBvYmplY3QsIHRoZVxuICAgICAqIGNyZWF0ZWQgZnVuY3Rpb24gcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgY29udGFpbiB0aGUgZXF1aXZhbGVudFxuICAgICAqIHNvdXJjZSBwcm9wZXJ0aWVzLCBvdGhlcndpc2UgaXQgcmV0dXJucyBgZmFsc2VgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0geyp9IFtmdW5jPV8uaWRlbnRpdHldIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgY2FsbGJhY2suXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBjYWxsYmFjay5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIHVzZXJzID0gW1xuICAgICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sXG4gICAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC5cbiAgICAgKiBfLmZpbHRlcih1c2VycywgXy5pdGVyYXRlZSh7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0pKTtcbiAgICAgKiAvLyA9PiBbeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH1dXG4gICAgICpcbiAgICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5maWx0ZXIodXNlcnMsIF8uaXRlcmF0ZWUoWyd1c2VyJywgJ2ZyZWQnXSkpO1xuICAgICAqIC8vID0+IFt7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfV1cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8ubWFwKHVzZXJzLCBfLml0ZXJhdGVlKCd1c2VyJykpO1xuICAgICAqIC8vID0+IFsnYmFybmV5JywgJ2ZyZWQnXVxuICAgICAqXG4gICAgICogLy8gQ3JlYXRlIGN1c3RvbSBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICAgICAqIF8uaXRlcmF0ZWUgPSBfLndyYXAoXy5pdGVyYXRlZSwgZnVuY3Rpb24oaXRlcmF0ZWUsIGZ1bmMpIHtcbiAgICAgKiAgIHJldHVybiAhXy5pc1JlZ0V4cChmdW5jKSA/IGl0ZXJhdGVlKGZ1bmMpIDogZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICogICAgIHJldHVybiBmdW5jLnRlc3Qoc3RyaW5nKTtcbiAgICAgKiAgIH07XG4gICAgICogfSk7XG4gICAgICpcbiAgICAgKiBfLmZpbHRlcihbJ2FiYycsICdkZWYnXSwgL2VmLyk7XG4gICAgICogLy8gPT4gWydkZWYnXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGl0ZXJhdGVlKGZ1bmMpIHtcbiAgICAgIHJldHVybiBiYXNlSXRlcmF0ZWUodHlwZW9mIGZ1bmMgPT0gJ2Z1bmN0aW9uJyA/IGZ1bmMgOiBiYXNlQ2xvbmUoZnVuYywgQ0xPTkVfREVFUF9GTEFHKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgYSBwYXJ0aWFsIGRlZXAgY29tcGFyaXNvbiBiZXR3ZWVuIGEgZ2l2ZW5cbiAgICAgKiBvYmplY3QgYW5kIGBzb3VyY2VgLCByZXR1cm5pbmcgYHRydWVgIGlmIHRoZSBnaXZlbiBvYmplY3QgaGFzIGVxdWl2YWxlbnRcbiAgICAgKiBwcm9wZXJ0eSB2YWx1ZXMsIGVsc2UgYGZhbHNlYC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBUaGUgY3JlYXRlZCBmdW5jdGlvbiBpcyBlcXVpdmFsZW50IHRvIGBfLmlzTWF0Y2hgIHdpdGggYHNvdXJjZWBcbiAgICAgKiBwYXJ0aWFsbHkgYXBwbGllZC5cbiAgICAgKlxuICAgICAqIFBhcnRpYWwgY29tcGFyaXNvbnMgd2lsbCBtYXRjaCBlbXB0eSBhcnJheSBhbmQgZW1wdHkgb2JqZWN0IGBzb3VyY2VgXG4gICAgICogdmFsdWVzIGFnYWluc3QgYW55IGFycmF5IG9yIG9iamVjdCB2YWx1ZSwgcmVzcGVjdGl2ZWx5LiBTZWUgYF8uaXNFcXVhbGBcbiAgICAgKiBmb3IgYSBsaXN0IG9mIHN1cHBvcnRlZCB2YWx1ZSBjb21wYXJpc29ucy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzcGVjIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFtcbiAgICAgKiAgIHsgJ2EnOiAxLCAnYic6IDIsICdjJzogMyB9LFxuICAgICAqICAgeyAnYSc6IDQsICdiJzogNSwgJ2MnOiA2IH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogXy5maWx0ZXIob2JqZWN0cywgXy5tYXRjaGVzKHsgJ2EnOiA0LCAnYyc6IDYgfSkpO1xuICAgICAqIC8vID0+IFt7ICdhJzogNCwgJ2InOiA1LCAnYyc6IDYgfV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXRjaGVzKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIGJhc2VNYXRjaGVzKGJhc2VDbG9uZShzb3VyY2UsIENMT05FX0RFRVBfRkxBRykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHBlcmZvcm1zIGEgcGFydGlhbCBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiB0aGVcbiAgICAgKiB2YWx1ZSBhdCBgcGF0aGAgb2YgYSBnaXZlbiBvYmplY3QgdG8gYHNyY1ZhbHVlYCwgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGVcbiAgICAgKiBvYmplY3QgdmFsdWUgaXMgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFBhcnRpYWwgY29tcGFyaXNvbnMgd2lsbCBtYXRjaCBlbXB0eSBhcnJheSBhbmQgZW1wdHkgb2JqZWN0XG4gICAgICogYHNyY1ZhbHVlYCB2YWx1ZXMgYWdhaW5zdCBhbnkgYXJyYXkgb3Igb2JqZWN0IHZhbHVlLCByZXNwZWN0aXZlbHkuIFNlZVxuICAgICAqIGBfLmlzRXF1YWxgIGZvciBhIGxpc3Qgb2Ygc3VwcG9ydGVkIHZhbHVlIGNvbXBhcmlzb25zLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMi4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICAgICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW1xuICAgICAqICAgeyAnYSc6IDEsICdiJzogMiwgJ2MnOiAzIH0sXG4gICAgICogICB7ICdhJzogNCwgJ2InOiA1LCAnYyc6IDYgfVxuICAgICAqIF07XG4gICAgICpcbiAgICAgKiBfLmZpbmQob2JqZWN0cywgXy5tYXRjaGVzUHJvcGVydHkoJ2EnLCA0KSk7XG4gICAgICogLy8gPT4geyAnYSc6IDQsICdiJzogNSwgJ2MnOiA2IH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXRjaGVzUHJvcGVydHkocGF0aCwgc3JjVmFsdWUpIHtcbiAgICAgIHJldHVybiBiYXNlTWF0Y2hlc1Byb3BlcnR5KHBhdGgsIGJhc2VDbG9uZShzcmNWYWx1ZSwgQ0xPTkVfREVFUF9GTEFHKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyB0aGUgbWV0aG9kIGF0IGBwYXRoYCBvZiBhIGdpdmVuIG9iamVjdC5cbiAgICAgKiBBbnkgYWRkaXRpb25hbCBhcmd1bWVudHMgYXJlIHByb3ZpZGVkIHRvIHRoZSBpbnZva2VkIG1ldGhvZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjcuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIG1ldGhvZCB0byBpbnZva2UuXG4gICAgICogQHBhcmFtIHsuLi4qfSBbYXJnc10gVGhlIGFyZ3VtZW50cyB0byBpbnZva2UgdGhlIG1ldGhvZCB3aXRoLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGludm9rZXIgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW1xuICAgICAqICAgeyAnYSc6IHsgJ2InOiBfLmNvbnN0YW50KDIpIH0gfSxcbiAgICAgKiAgIHsgJ2EnOiB7ICdiJzogXy5jb25zdGFudCgxKSB9IH1cbiAgICAgKiBdO1xuICAgICAqXG4gICAgICogXy5tYXAob2JqZWN0cywgXy5tZXRob2QoJ2EuYicpKTtcbiAgICAgKiAvLyA9PiBbMiwgMV1cbiAgICAgKlxuICAgICAqIF8ubWFwKG9iamVjdHMsIF8ubWV0aG9kKFsnYScsICdiJ10pKTtcbiAgICAgKiAvLyA9PiBbMiwgMV1cbiAgICAgKi9cbiAgICB2YXIgbWV0aG9kID0gYmFzZVJlc3QoZnVuY3Rpb24ocGF0aCwgYXJncykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gYmFzZUludm9rZShvYmplY3QsIHBhdGgsIGFyZ3MpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5tZXRob2RgOyB0aGlzIG1ldGhvZCBjcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzXG4gICAgICogdGhlIG1ldGhvZCBhdCBhIGdpdmVuIHBhdGggb2YgYG9iamVjdGAuIEFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyBhcmVcbiAgICAgKiBwcm92aWRlZCB0byB0aGUgaW52b2tlZCBtZXRob2QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy43LjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcGFyYW0gey4uLip9IFthcmdzXSBUaGUgYXJndW1lbnRzIHRvIGludm9rZSB0aGUgbWV0aG9kIHdpdGguXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgaW52b2tlciBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gXy50aW1lcygzLCBfLmNvbnN0YW50KSxcbiAgICAgKiAgICAgb2JqZWN0ID0geyAnYSc6IGFycmF5LCAnYic6IGFycmF5LCAnYyc6IGFycmF5IH07XG4gICAgICpcbiAgICAgKiBfLm1hcChbJ2FbMl0nLCAnY1swXSddLCBfLm1ldGhvZE9mKG9iamVjdCkpO1xuICAgICAqIC8vID0+IFsyLCAwXVxuICAgICAqXG4gICAgICogXy5tYXAoW1snYScsICcyJ10sIFsnYycsICcwJ11dLCBfLm1ldGhvZE9mKG9iamVjdCkpO1xuICAgICAqIC8vID0+IFsyLCAwXVxuICAgICAqL1xuICAgIHZhciBtZXRob2RPZiA9IGJhc2VSZXN0KGZ1bmN0aW9uKG9iamVjdCwgYXJncykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VJbnZva2Uob2JqZWN0LCBwYXRoLCBhcmdzKTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGFsbCBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQgZnVuY3Rpb24gcHJvcGVydGllcyBvZiBhIHNvdXJjZVxuICAgICAqIG9iamVjdCB0byB0aGUgZGVzdGluYXRpb24gb2JqZWN0LiBJZiBgb2JqZWN0YCBpcyBhIGZ1bmN0aW9uLCB0aGVuIG1ldGhvZHNcbiAgICAgKiBhcmUgYWRkZWQgdG8gaXRzIHByb3RvdHlwZSBhcyB3ZWxsLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFVzZSBgXy5ydW5JbkNvbnRleHRgIHRvIGNyZWF0ZSBhIHByaXN0aW5lIGBsb2Rhc2hgIGZ1bmN0aW9uIHRvXG4gICAgICogYXZvaWQgY29uZmxpY3RzIGNhdXNlZCBieSBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gW29iamVjdD1sb2Rhc2hdIFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIGZ1bmN0aW9ucyB0byBhZGQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5jaGFpbj10cnVlXSBTcGVjaWZ5IHdoZXRoZXIgbWl4aW5zIGFyZSBjaGFpbmFibGUuXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufE9iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogZnVuY3Rpb24gdm93ZWxzKHN0cmluZykge1xuICAgICAqICAgcmV0dXJuIF8uZmlsdGVyKHN0cmluZywgZnVuY3Rpb24odikge1xuICAgICAqICAgICByZXR1cm4gL1thZWlvdV0vaS50ZXN0KHYpO1xuICAgICAqICAgfSk7XG4gICAgICogfVxuICAgICAqXG4gICAgICogXy5taXhpbih7ICd2b3dlbHMnOiB2b3dlbHMgfSk7XG4gICAgICogXy52b3dlbHMoJ2ZyZWQnKTtcbiAgICAgKiAvLyA9PiBbJ2UnXVxuICAgICAqXG4gICAgICogXygnZnJlZCcpLnZvd2VscygpLnZhbHVlKCk7XG4gICAgICogLy8gPT4gWydlJ11cbiAgICAgKlxuICAgICAqIF8ubWl4aW4oeyAndm93ZWxzJzogdm93ZWxzIH0sIHsgJ2NoYWluJzogZmFsc2UgfSk7XG4gICAgICogXygnZnJlZCcpLnZvd2VscygpO1xuICAgICAqIC8vID0+IFsnZSddXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWl4aW4ob2JqZWN0LCBzb3VyY2UsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBwcm9wcyA9IGtleXMoc291cmNlKSxcbiAgICAgICAgICBtZXRob2ROYW1lcyA9IGJhc2VGdW5jdGlvbnMoc291cmNlLCBwcm9wcyk7XG5cbiAgICAgIGlmIChvcHRpb25zID09IG51bGwgJiZcbiAgICAgICAgICAhKGlzT2JqZWN0KHNvdXJjZSkgJiYgKG1ldGhvZE5hbWVzLmxlbmd0aCB8fCAhcHJvcHMubGVuZ3RoKSkpIHtcbiAgICAgICAgb3B0aW9ucyA9IHNvdXJjZTtcbiAgICAgICAgc291cmNlID0gb2JqZWN0O1xuICAgICAgICBvYmplY3QgPSB0aGlzO1xuICAgICAgICBtZXRob2ROYW1lcyA9IGJhc2VGdW5jdGlvbnMoc291cmNlLCBrZXlzKHNvdXJjZSkpO1xuICAgICAgfVxuICAgICAgdmFyIGNoYWluID0gIShpc09iamVjdChvcHRpb25zKSAmJiAnY2hhaW4nIGluIG9wdGlvbnMpIHx8ICEhb3B0aW9ucy5jaGFpbixcbiAgICAgICAgICBpc0Z1bmMgPSBpc0Z1bmN0aW9uKG9iamVjdCk7XG5cbiAgICAgIGFycmF5RWFjaChtZXRob2ROYW1lcywgZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgICAgICB2YXIgZnVuYyA9IHNvdXJjZVttZXRob2ROYW1lXTtcbiAgICAgICAgb2JqZWN0W21ldGhvZE5hbWVdID0gZnVuYztcbiAgICAgICAgaWYgKGlzRnVuYykge1xuICAgICAgICAgIG9iamVjdC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBjaGFpbkFsbCA9IHRoaXMuX19jaGFpbl9fO1xuICAgICAgICAgICAgaWYgKGNoYWluIHx8IGNoYWluQWxsKSB7XG4gICAgICAgICAgICAgIHZhciByZXN1bHQgPSBvYmplY3QodGhpcy5fX3dyYXBwZWRfXyksXG4gICAgICAgICAgICAgICAgICBhY3Rpb25zID0gcmVzdWx0Ll9fYWN0aW9uc19fID0gY29weUFycmF5KHRoaXMuX19hY3Rpb25zX18pO1xuXG4gICAgICAgICAgICAgIGFjdGlvbnMucHVzaCh7ICdmdW5jJzogZnVuYywgJ2FyZ3MnOiBhcmd1bWVudHMsICd0aGlzQXJnJzogb2JqZWN0IH0pO1xuICAgICAgICAgICAgICByZXN1bHQuX19jaGFpbl9fID0gY2hhaW5BbGw7XG4gICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShvYmplY3QsIGFycmF5UHVzaChbdGhpcy52YWx1ZSgpXSwgYXJndW1lbnRzKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV2ZXJ0cyB0aGUgYF9gIHZhcmlhYmxlIHRvIGl0cyBwcmV2aW91cyB2YWx1ZSBhbmQgcmV0dXJucyBhIHJlZmVyZW5jZSB0b1xuICAgICAqIHRoZSBgbG9kYXNoYCBmdW5jdGlvbi5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBgbG9kYXNoYCBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGxvZGFzaCA9IF8ubm9Db25mbGljdCgpO1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7XG4gICAgICBpZiAocm9vdC5fID09PSB0aGlzKSB7XG4gICAgICAgIHJvb3QuXyA9IG9sZERhc2g7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGB1bmRlZmluZWRgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDIuMy4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50aW1lcygyLCBfLm5vb3ApO1xuICAgICAqIC8vID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZF1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBub29wKCkge1xuICAgICAgLy8gTm8gb3BlcmF0aW9uIHBlcmZvcm1lZC5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBnZXRzIHRoZSBhcmd1bWVudCBhdCBpbmRleCBgbmAuIElmIGBuYCBpcyBuZWdhdGl2ZSxcbiAgICAgKiB0aGUgbnRoIGFyZ3VtZW50IGZyb20gdGhlIGVuZCBpcyByZXR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTBdIFRoZSBpbmRleCBvZiB0aGUgYXJndW1lbnQgdG8gcmV0dXJuLlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHBhc3MtdGhydSBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGZ1bmMgPSBfLm50aEFyZygxKTtcbiAgICAgKiBmdW5jKCdhJywgJ2InLCAnYycsICdkJyk7XG4gICAgICogLy8gPT4gJ2InXG4gICAgICpcbiAgICAgKiB2YXIgZnVuYyA9IF8ubnRoQXJnKC0yKTtcbiAgICAgKiBmdW5jKCdhJywgJ2InLCAnYycsICdkJyk7XG4gICAgICogLy8gPT4gJ2MnXG4gICAgICovXG4gICAgZnVuY3Rpb24gbnRoQXJnKG4pIHtcbiAgICAgIG4gPSB0b0ludGVnZXIobik7XG4gICAgICByZXR1cm4gYmFzZVJlc3QoZnVuY3Rpb24oYXJncykge1xuICAgICAgICByZXR1cm4gYmFzZU50aChhcmdzLCBuKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGl0ZXJhdGVlc2Agd2l0aCB0aGUgYXJndW1lbnRzIGl0IHJlY2VpdmVzXG4gICAgICogYW5kIHJldHVybnMgdGhlaXIgcmVzdWx0cy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHsuLi4oRnVuY3Rpb258RnVuY3Rpb25bXSl9IFtpdGVyYXRlZXM9W18uaWRlbnRpdHldXVxuICAgICAqICBUaGUgaXRlcmF0ZWVzIHRvIGludm9rZS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGZ1bmMgPSBfLm92ZXIoW01hdGgubWF4LCBNYXRoLm1pbl0pO1xuICAgICAqXG4gICAgICogZnVuYygxLCAyLCAzLCA0KTtcbiAgICAgKiAvLyA9PiBbNCwgMV1cbiAgICAgKi9cbiAgICB2YXIgb3ZlciA9IGNyZWF0ZU92ZXIoYXJyYXlNYXApO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmICoqYWxsKiogb2YgdGhlIGBwcmVkaWNhdGVzYCByZXR1cm5cbiAgICAgKiB0cnV0aHkgd2hlbiBpbnZva2VkIHdpdGggdGhlIGFyZ3VtZW50cyBpdCByZWNlaXZlcy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHsuLi4oRnVuY3Rpb258RnVuY3Rpb25bXSl9IFtwcmVkaWNhdGVzPVtfLmlkZW50aXR5XV1cbiAgICAgKiAgVGhlIHByZWRpY2F0ZXMgdG8gY2hlY2suXG4gICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBmdW5jID0gXy5vdmVyRXZlcnkoW0Jvb2xlYW4sIGlzRmluaXRlXSk7XG4gICAgICpcbiAgICAgKiBmdW5jKCcxJyk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogZnVuYyhudWxsKTtcbiAgICAgKiAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogZnVuYyhOYU4pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIG92ZXJFdmVyeSA9IGNyZWF0ZU92ZXIoYXJyYXlFdmVyeSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgKiphbnkqKiBvZiB0aGUgYHByZWRpY2F0ZXNgIHJldHVyblxuICAgICAqIHRydXRoeSB3aGVuIGludm9rZWQgd2l0aCB0aGUgYXJndW1lbnRzIGl0IHJlY2VpdmVzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMC4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0gey4uLihGdW5jdGlvbnxGdW5jdGlvbltdKX0gW3ByZWRpY2F0ZXM9W18uaWRlbnRpdHldXVxuICAgICAqICBUaGUgcHJlZGljYXRlcyB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGZ1bmMgPSBfLm92ZXJTb21lKFtCb29sZWFuLCBpc0Zpbml0ZV0pO1xuICAgICAqXG4gICAgICogZnVuYygnMScpO1xuICAgICAqIC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIGZ1bmMobnVsbCk7XG4gICAgICogLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogZnVuYyhOYU4pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgdmFyIG92ZXJTb21lID0gY3JlYXRlT3ZlcihhcnJheVNvbWUpO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgdmFsdWUgYXQgYHBhdGhgIG9mIGEgZ2l2ZW4gb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDIuNC4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGFjY2Vzc29yIGZ1bmN0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFtcbiAgICAgKiAgIHsgJ2EnOiB7ICdiJzogMiB9IH0sXG4gICAgICogICB7ICdhJzogeyAnYic6IDEgfSB9XG4gICAgICogXTtcbiAgICAgKlxuICAgICAqIF8ubWFwKG9iamVjdHMsIF8ucHJvcGVydHkoJ2EuYicpKTtcbiAgICAgKiAvLyA9PiBbMiwgMV1cbiAgICAgKlxuICAgICAqIF8ubWFwKF8uc29ydEJ5KG9iamVjdHMsIF8ucHJvcGVydHkoWydhJywgJ2InXSkpLCAnYS5iJyk7XG4gICAgICogLy8gPT4gWzEsIDJdXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJvcGVydHkocGF0aCkge1xuICAgICAgcmV0dXJuIGlzS2V5KHBhdGgpID8gYmFzZVByb3BlcnR5KHRvS2V5KHBhdGgpKSA6IGJhc2VQcm9wZXJ0eURlZXAocGF0aCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIG9wcG9zaXRlIG9mIGBfLnByb3BlcnR5YDsgdGhpcyBtZXRob2QgY3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJuc1xuICAgICAqIHRoZSB2YWx1ZSBhdCBhIGdpdmVuIHBhdGggb2YgYG9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5ID0gWzAsIDEsIDJdLFxuICAgICAqICAgICBvYmplY3QgPSB7ICdhJzogYXJyYXksICdiJzogYXJyYXksICdjJzogYXJyYXkgfTtcbiAgICAgKlxuICAgICAqIF8ubWFwKFsnYVsyXScsICdjWzBdJ10sIF8ucHJvcGVydHlPZihvYmplY3QpKTtcbiAgICAgKiAvLyA9PiBbMiwgMF1cbiAgICAgKlxuICAgICAqIF8ubWFwKFtbJ2EnLCAnMiddLCBbJ2MnLCAnMCddXSwgXy5wcm9wZXJ0eU9mKG9iamVjdCkpO1xuICAgICAqIC8vID0+IFsyLCAwXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByb3BlcnR5T2Yob2JqZWN0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24ocGF0aCkge1xuICAgICAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBiYXNlR2V0KG9iamVjdCwgcGF0aCk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgbnVtYmVycyAocG9zaXRpdmUgYW5kL29yIG5lZ2F0aXZlKSBwcm9ncmVzc2luZyBmcm9tXG4gICAgICogYHN0YXJ0YCB1cCB0bywgYnV0IG5vdCBpbmNsdWRpbmcsIGBlbmRgLiBBIHN0ZXAgb2YgYC0xYCBpcyB1c2VkIGlmIGEgbmVnYXRpdmVcbiAgICAgKiBgc3RhcnRgIGlzIHNwZWNpZmllZCB3aXRob3V0IGFuIGBlbmRgIG9yIGBzdGVwYC4gSWYgYGVuZGAgaXMgbm90IHNwZWNpZmllZCxcbiAgICAgKiBpdCdzIHNldCB0byBgc3RhcnRgIHdpdGggYHN0YXJ0YCB0aGVuIHNldCB0byBgMGAuXG4gICAgICpcbiAgICAgKiAqKk5vdGU6KiogSmF2YVNjcmlwdCBmb2xsb3dzIHRoZSBJRUVFLTc1NCBzdGFuZGFyZCBmb3IgcmVzb2x2aW5nXG4gICAgICogZmxvYXRpbmctcG9pbnQgdmFsdWVzIHdoaWNoIGNhbiBwcm9kdWNlIHVuZXhwZWN0ZWQgcmVzdWx0cy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGFydD0wXSBUaGUgc3RhcnQgb2YgdGhlIHJhbmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgcmFuZ2UuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGVwPTFdIFRoZSB2YWx1ZSB0byBpbmNyZW1lbnQgb3IgZGVjcmVtZW50IGJ5LlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcmFuZ2Ugb2YgbnVtYmVycy5cbiAgICAgKiBAc2VlIF8uaW5SYW5nZSwgXy5yYW5nZVJpZ2h0XG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8ucmFuZ2UoNCk7XG4gICAgICogLy8gPT4gWzAsIDEsIDIsIDNdXG4gICAgICpcbiAgICAgKiBfLnJhbmdlKC00KTtcbiAgICAgKiAvLyA9PiBbMCwgLTEsIC0yLCAtM11cbiAgICAgKlxuICAgICAqIF8ucmFuZ2UoMSwgNSk7XG4gICAgICogLy8gPT4gWzEsIDIsIDMsIDRdXG4gICAgICpcbiAgICAgKiBfLnJhbmdlKDAsIDIwLCA1KTtcbiAgICAgKiAvLyA9PiBbMCwgNSwgMTAsIDE1XVxuICAgICAqXG4gICAgICogXy5yYW5nZSgwLCAtNCwgLTEpO1xuICAgICAqIC8vID0+IFswLCAtMSwgLTIsIC0zXVxuICAgICAqXG4gICAgICogXy5yYW5nZSgxLCA0LCAwKTtcbiAgICAgKiAvLyA9PiBbMSwgMSwgMV1cbiAgICAgKlxuICAgICAqIF8ucmFuZ2UoMCk7XG4gICAgICogLy8gPT4gW11cbiAgICAgKi9cbiAgICB2YXIgcmFuZ2UgPSBjcmVhdGVSYW5nZSgpO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5yYW5nZWAgZXhjZXB0IHRoYXQgaXQgcG9wdWxhdGVzIHZhbHVlcyBpblxuICAgICAqIGRlc2NlbmRpbmcgb3JkZXIuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IG9mIHRoZSByYW5nZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlbmQgb2YgdGhlIHJhbmdlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RlcD0xXSBUaGUgdmFsdWUgdG8gaW5jcmVtZW50IG9yIGRlY3JlbWVudCBieS5cbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHJhbmdlIG9mIG51bWJlcnMuXG4gICAgICogQHNlZSBfLmluUmFuZ2UsIF8ucmFuZ2VcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5yYW5nZVJpZ2h0KDQpO1xuICAgICAqIC8vID0+IFszLCAyLCAxLCAwXVxuICAgICAqXG4gICAgICogXy5yYW5nZVJpZ2h0KC00KTtcbiAgICAgKiAvLyA9PiBbLTMsIC0yLCAtMSwgMF1cbiAgICAgKlxuICAgICAqIF8ucmFuZ2VSaWdodCgxLCA1KTtcbiAgICAgKiAvLyA9PiBbNCwgMywgMiwgMV1cbiAgICAgKlxuICAgICAqIF8ucmFuZ2VSaWdodCgwLCAyMCwgNSk7XG4gICAgICogLy8gPT4gWzE1LCAxMCwgNSwgMF1cbiAgICAgKlxuICAgICAqIF8ucmFuZ2VSaWdodCgwLCAtNCwgLTEpO1xuICAgICAqIC8vID0+IFstMywgLTIsIC0xLCAwXVxuICAgICAqXG4gICAgICogXy5yYW5nZVJpZ2h0KDEsIDQsIDApO1xuICAgICAqIC8vID0+IFsxLCAxLCAxXVxuICAgICAqXG4gICAgICogXy5yYW5nZVJpZ2h0KDApO1xuICAgICAqIC8vID0+IFtdXG4gICAgICovXG4gICAgdmFyIHJhbmdlUmlnaHQgPSBjcmVhdGVSYW5nZSh0cnVlKTtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgZW1wdHkgYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4xMy4wXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBlbXB0eSBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIGFycmF5cyA9IF8udGltZXMoMiwgXy5zdHViQXJyYXkpO1xuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXlzKTtcbiAgICAgKiAvLyA9PiBbW10sIFtdXVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2coYXJyYXlzWzBdID09PSBhcnJheXNbMV0pO1xuICAgICAqIC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3R1YkFycmF5KCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYGZhbHNlYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjEzLjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGBmYWxzZWAuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8udGltZXMoMiwgXy5zdHViRmFsc2UpO1xuICAgICAqIC8vID0+IFtmYWxzZSwgZmFsc2VdXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3R1YkZhbHNlKCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgZW1wdHkgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTMuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGVtcHR5IG9iamVjdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdHMgPSBfLnRpbWVzKDIsIF8uc3R1Yk9iamVjdCk7XG4gICAgICpcbiAgICAgKiBjb25zb2xlLmxvZyhvYmplY3RzKTtcbiAgICAgKiAvLyA9PiBbe30sIHt9XVxuICAgICAqXG4gICAgICogY29uc29sZS5sb2cob2JqZWN0c1swXSA9PT0gb2JqZWN0c1sxXSk7XG4gICAgICogLy8gPT4gZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzdHViT2JqZWN0KCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTMuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZW1wdHkgc3RyaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnRpbWVzKDIsIF8uc3R1YlN0cmluZyk7XG4gICAgICogLy8gPT4gWycnLCAnJ11cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzdHViU3RyaW5nKCkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYHRydWVgLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuMTMuMFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnRpbWVzKDIsIF8uc3R1YlRydWUpO1xuICAgICAqIC8vID0+IFt0cnVlLCB0cnVlXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN0dWJUcnVlKCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW52b2tlcyB0aGUgaXRlcmF0ZWUgYG5gIHRpbWVzLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgdGhlIHJlc3VsdHMgb2ZcbiAgICAgKiBlYWNoIGludm9jYXRpb24uIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OyAoaW5kZXgpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIHRpbWVzIHRvIGludm9rZSBgaXRlcmF0ZWVgLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLlxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50aW1lcygzLCBTdHJpbmcpO1xuICAgICAqIC8vID0+IFsnMCcsICcxJywgJzInXVxuICAgICAqXG4gICAgICogIF8udGltZXMoNCwgXy5jb25zdGFudCgwKSk7XG4gICAgICogLy8gPT4gWzAsIDAsIDAsIDBdXG4gICAgICovXG4gICAgZnVuY3Rpb24gdGltZXMobiwgaXRlcmF0ZWUpIHtcbiAgICAgIG4gPSB0b0ludGVnZXIobik7XG4gICAgICBpZiAobiA8IDEgfHwgbiA+IE1BWF9TQUZFX0lOVEVHRVIpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgdmFyIGluZGV4ID0gTUFYX0FSUkFZX0xFTkdUSCxcbiAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNaW4obiwgTUFYX0FSUkFZX0xFTkdUSCk7XG5cbiAgICAgIGl0ZXJhdGVlID0gZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUpO1xuICAgICAgbiAtPSBNQVhfQVJSQVlfTEVOR1RIO1xuXG4gICAgICB2YXIgcmVzdWx0ID0gYmFzZVRpbWVzKGxlbmd0aCwgaXRlcmF0ZWUpO1xuICAgICAgd2hpbGUgKCsraW5kZXggPCBuKSB7XG4gICAgICAgIGl0ZXJhdGVlKGluZGV4KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHByb3BlcnR5IHBhdGggYXJyYXkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgcHJvcGVydHkgcGF0aCBhcnJheS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy50b1BhdGgoJ2EuYi5jJyk7XG4gICAgICogLy8gPT4gWydhJywgJ2InLCAnYyddXG4gICAgICpcbiAgICAgKiBfLnRvUGF0aCgnYVswXS5iLmMnKTtcbiAgICAgKiAvLyA9PiBbJ2EnLCAnMCcsICdiJywgJ2MnXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvUGF0aCh2YWx1ZSkge1xuICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBhcnJheU1hcCh2YWx1ZSwgdG9LZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGlzU3ltYm9sKHZhbHVlKSA/IFt2YWx1ZV0gOiBjb3B5QXJyYXkoc3RyaW5nVG9QYXRoKHRvU3RyaW5nKHZhbHVlKSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhIHVuaXF1ZSBJRC4gSWYgYHByZWZpeGAgaXMgZ2l2ZW4sIHRoZSBJRCBpcyBhcHBlbmRlZCB0byBpdC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAc2luY2UgMC4xLjBcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtwcmVmaXg9JyddIFRoZSB2YWx1ZSB0byBwcmVmaXggdGhlIElEIHdpdGguXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdW5pcXVlIElELlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnVuaXF1ZUlkKCdjb250YWN0XycpO1xuICAgICAqIC8vID0+ICdjb250YWN0XzEwNCdcbiAgICAgKlxuICAgICAqIF8udW5pcXVlSWQoKTtcbiAgICAgKiAvLyA9PiAnMTA1J1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaXF1ZUlkKHByZWZpeCkge1xuICAgICAgdmFyIGlkID0gKytpZENvdW50ZXI7XG4gICAgICByZXR1cm4gdG9TdHJpbmcocHJlZml4KSArIGlkO1xuICAgIH1cblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIEFkZHMgdHdvIG51bWJlcnMuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgMy40LjBcbiAgICAgKiBAY2F0ZWdvcnkgTWF0aFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhdWdlbmQgVGhlIGZpcnN0IG51bWJlciBpbiBhbiBhZGRpdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYWRkZW5kIFRoZSBzZWNvbmQgbnVtYmVyIGluIGFuIGFkZGl0aW9uLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHRvdGFsLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmFkZCg2LCA0KTtcbiAgICAgKiAvLyA9PiAxMFxuICAgICAqL1xuICAgIHZhciBhZGQgPSBjcmVhdGVNYXRoT3BlcmF0aW9uKGZ1bmN0aW9uKGF1Z2VuZCwgYWRkZW5kKSB7XG4gICAgICByZXR1cm4gYXVnZW5kICsgYWRkZW5kO1xuICAgIH0sIDApO1xuXG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgYG51bWJlcmAgcm91bmRlZCB1cCB0byBgcHJlY2lzaW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjEwLjBcbiAgICAgKiBAY2F0ZWdvcnkgTWF0aFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXIgVGhlIG51bWJlciB0byByb3VuZCB1cC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3ByZWNpc2lvbj0wXSBUaGUgcHJlY2lzaW9uIHRvIHJvdW5kIHVwIHRvLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHJvdW5kZWQgdXAgbnVtYmVyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLmNlaWwoNC4wMDYpO1xuICAgICAqIC8vID0+IDVcbiAgICAgKlxuICAgICAqIF8uY2VpbCg2LjAwNCwgMik7XG4gICAgICogLy8gPT4gNi4wMVxuICAgICAqXG4gICAgICogXy5jZWlsKDYwNDAsIC0yKTtcbiAgICAgKiAvLyA9PiA2MTAwXG4gICAgICovXG4gICAgdmFyIGNlaWwgPSBjcmVhdGVSb3VuZCgnY2VpbCcpO1xuXG4gICAgLyoqXG4gICAgICogRGl2aWRlIHR3byBudW1iZXJzLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNy4wXG4gICAgICogQGNhdGVnb3J5IE1hdGhcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZGl2aWRlbmQgVGhlIGZpcnN0IG51bWJlciBpbiBhIGRpdmlzaW9uLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkaXZpc29yIFRoZSBzZWNvbmQgbnVtYmVyIGluIGEgZGl2aXNpb24uXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgcXVvdGllbnQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZGl2aWRlKDYsIDQpO1xuICAgICAqIC8vID0+IDEuNVxuICAgICAqL1xuICAgIHZhciBkaXZpZGUgPSBjcmVhdGVNYXRoT3BlcmF0aW9uKGZ1bmN0aW9uKGRpdmlkZW5kLCBkaXZpc29yKSB7XG4gICAgICByZXR1cm4gZGl2aWRlbmQgLyBkaXZpc29yO1xuICAgIH0sIDEpO1xuXG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgYG51bWJlcmAgcm91bmRlZCBkb3duIHRvIGBwcmVjaXNpb25gLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDMuMTAuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlciBUaGUgbnVtYmVyIHRvIHJvdW5kIGRvd24uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtwcmVjaXNpb249MF0gVGhlIHByZWNpc2lvbiB0byByb3VuZCBkb3duIHRvLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHJvdW5kZWQgZG93biBudW1iZXIuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uZmxvb3IoNC4wMDYpO1xuICAgICAqIC8vID0+IDRcbiAgICAgKlxuICAgICAqIF8uZmxvb3IoMC4wNDYsIDIpO1xuICAgICAqIC8vID0+IDAuMDRcbiAgICAgKlxuICAgICAqIF8uZmxvb3IoNDA2MCwgLTIpO1xuICAgICAqIC8vID0+IDQwMDBcbiAgICAgKi9cbiAgICB2YXIgZmxvb3IgPSBjcmVhdGVSb3VuZCgnZmxvb3InKTtcblxuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIHRoZSBtYXhpbXVtIHZhbHVlIG9mIGBhcnJheWAuIElmIGBhcnJheWAgaXMgZW1wdHkgb3IgZmFsc2V5LFxuICAgICAqIGB1bmRlZmluZWRgIGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IE1hdGhcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBtYXhpbXVtIHZhbHVlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLm1heChbNCwgMiwgOCwgNl0pO1xuICAgICAqIC8vID0+IDhcbiAgICAgKlxuICAgICAqIF8ubWF4KFtdKTtcbiAgICAgKiAvLyA9PiB1bmRlZmluZWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYXgoYXJyYXkpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VFeHRyZW11bShhcnJheSwgaWRlbnRpdHksIGJhc2VHdClcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5tYXhgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBpbiBgYXJyYXlgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24gYnkgd2hpY2hcbiAgICAgKiB0aGUgdmFsdWUgaXMgcmFua2VkLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1heGltdW0gdmFsdWUuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW3sgJ24nOiAxIH0sIHsgJ24nOiAyIH1dO1xuICAgICAqXG4gICAgICogXy5tYXhCeShvYmplY3RzLCBmdW5jdGlvbihvKSB7IHJldHVybiBvLm47IH0pO1xuICAgICAqIC8vID0+IHsgJ24nOiAyIH1cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8ubWF4Qnkob2JqZWN0cywgJ24nKTtcbiAgICAgKiAvLyA9PiB7ICduJzogMiB9XG4gICAgICovXG4gICAgZnVuY3Rpb24gbWF4QnkoYXJyYXksIGl0ZXJhdGVlKSB7XG4gICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aClcbiAgICAgICAgPyBiYXNlRXh0cmVtdW0oYXJyYXksIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSwgYmFzZUd0KVxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbWVhbiBvZiB0aGUgdmFsdWVzIGluIGBhcnJheWAuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgTWF0aFxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbWVhbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5tZWFuKFs0LCAyLCA4LCA2XSk7XG4gICAgICogLy8gPT4gNVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1lYW4oYXJyYXkpIHtcbiAgICAgIHJldHVybiBiYXNlTWVhbihhcnJheSwgaWRlbnRpdHkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ubWVhbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzXG4gICAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IGluIGBhcnJheWAgdG8gZ2VuZXJhdGUgdGhlIHZhbHVlIHRvIGJlIGF2ZXJhZ2VkLlxuICAgICAqIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OiAodmFsdWUpLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHNpbmNlIDQuNy4wXG4gICAgICogQGNhdGVnb3J5IE1hdGhcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBtZWFuLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgb2JqZWN0cyA9IFt7ICduJzogNCB9LCB7ICduJzogMiB9LCB7ICduJzogOCB9LCB7ICduJzogNiB9XTtcbiAgICAgKlxuICAgICAqIF8ubWVhbkJ5KG9iamVjdHMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8ubjsgfSk7XG4gICAgICogLy8gPT4gNVxuICAgICAqXG4gICAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuXG4gICAgICogXy5tZWFuQnkob2JqZWN0cywgJ24nKTtcbiAgICAgKiAvLyA9PiA1XG4gICAgICovXG4gICAgZnVuY3Rpb24gbWVhbkJ5KGFycmF5LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIGJhc2VNZWFuKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIHRoZSBtaW5pbXVtIHZhbHVlIG9mIGBhcnJheWAuIElmIGBhcnJheWAgaXMgZW1wdHkgb3IgZmFsc2V5LFxuICAgICAqIGB1bmRlZmluZWRgIGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQGNhdGVnb3J5IE1hdGhcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBtaW5pbXVtIHZhbHVlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLm1pbihbNCwgMiwgOCwgNl0pO1xuICAgICAqIC8vID0+IDJcbiAgICAgKlxuICAgICAqIF8ubWluKFtdKTtcbiAgICAgKiAvLyA9PiB1bmRlZmluZWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtaW4oYXJyYXkpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VFeHRyZW11bShhcnJheSwgaWRlbnRpdHksIGJhc2VMdClcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5taW5gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBpbiBgYXJyYXlgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24gYnkgd2hpY2hcbiAgICAgKiB0aGUgdmFsdWUgaXMgcmFua2VkLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1pbmltdW0gdmFsdWUuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIHZhciBvYmplY3RzID0gW3sgJ24nOiAxIH0sIHsgJ24nOiAyIH1dO1xuICAgICAqXG4gICAgICogXy5taW5CeShvYmplY3RzLCBmdW5jdGlvbihvKSB7IHJldHVybiBvLm47IH0pO1xuICAgICAqIC8vID0+IHsgJ24nOiAxIH1cbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8ubWluQnkob2JqZWN0cywgJ24nKTtcbiAgICAgKiAvLyA9PiB7ICduJzogMSB9XG4gICAgICovXG4gICAgZnVuY3Rpb24gbWluQnkoYXJyYXksIGl0ZXJhdGVlKSB7XG4gICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aClcbiAgICAgICAgPyBiYXNlRXh0cmVtdW0oYXJyYXksIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSwgYmFzZUx0KVxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNdWx0aXBseSB0d28gbnVtYmVycy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjcuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG11bHRpcGxpZXIgVGhlIGZpcnN0IG51bWJlciBpbiBhIG11bHRpcGxpY2F0aW9uLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtdWx0aXBsaWNhbmQgVGhlIHNlY29uZCBudW1iZXIgaW4gYSBtdWx0aXBsaWNhdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBwcm9kdWN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLm11bHRpcGx5KDYsIDQpO1xuICAgICAqIC8vID0+IDI0XG4gICAgICovXG4gICAgdmFyIG11bHRpcGx5ID0gY3JlYXRlTWF0aE9wZXJhdGlvbihmdW5jdGlvbihtdWx0aXBsaWVyLCBtdWx0aXBsaWNhbmQpIHtcbiAgICAgIHJldHVybiBtdWx0aXBsaWVyICogbXVsdGlwbGljYW5kO1xuICAgIH0sIDEpO1xuXG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgYG51bWJlcmAgcm91bmRlZCB0byBgcHJlY2lzaW9uYC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjEwLjBcbiAgICAgKiBAY2F0ZWdvcnkgTWF0aFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXIgVGhlIG51bWJlciB0byByb3VuZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3ByZWNpc2lvbj0wXSBUaGUgcHJlY2lzaW9uIHRvIHJvdW5kIHRvLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHJvdW5kZWQgbnVtYmVyLlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBfLnJvdW5kKDQuMDA2KTtcbiAgICAgKiAvLyA9PiA0XG4gICAgICpcbiAgICAgKiBfLnJvdW5kKDQuMDA2LCAyKTtcbiAgICAgKiAvLyA9PiA0LjAxXG4gICAgICpcbiAgICAgKiBfLnJvdW5kKDQwNjAsIC0yKTtcbiAgICAgKiAvLyA9PiA0MTAwXG4gICAgICovXG4gICAgdmFyIHJvdW5kID0gY3JlYXRlUm91bmQoJ3JvdW5kJyk7XG5cbiAgICAvKipcbiAgICAgKiBTdWJ0cmFjdCB0d28gbnVtYmVycy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSA0LjAuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1pbnVlbmQgVGhlIGZpcnN0IG51bWJlciBpbiBhIHN1YnRyYWN0aW9uLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJ0cmFoZW5kIFRoZSBzZWNvbmQgbnVtYmVyIGluIGEgc3VidHJhY3Rpb24uXG4gICAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgZGlmZmVyZW5jZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogXy5zdWJ0cmFjdCg2LCA0KTtcbiAgICAgKiAvLyA9PiAyXG4gICAgICovXG4gICAgdmFyIHN1YnRyYWN0ID0gY3JlYXRlTWF0aE9wZXJhdGlvbihmdW5jdGlvbihtaW51ZW5kLCBzdWJ0cmFoZW5kKSB7XG4gICAgICByZXR1cm4gbWludWVuZCAtIHN1YnRyYWhlbmQ7XG4gICAgfSwgMCk7XG5cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgc3VtIG9mIHRoZSB2YWx1ZXMgaW4gYGFycmF5YC5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyT2YgX1xuICAgICAqIEBzaW5jZSAzLjQuMFxuICAgICAqIEBjYXRlZ29yeSBNYXRoXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBzdW0uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIF8uc3VtKFs0LCAyLCA4LCA2XSk7XG4gICAgICogLy8gPT4gMjBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzdW0oYXJyYXkpIHtcbiAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKVxuICAgICAgICA/IGJhc2VTdW0oYXJyYXksIGlkZW50aXR5KVxuICAgICAgICA6IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5zdW1gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpc1xuICAgICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBpbiBgYXJyYXlgIHRvIGdlbmVyYXRlIHRoZSB2YWx1ZSB0byBiZSBzdW1tZWQuXG4gICAgICogVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF9cbiAgICAgKiBAc2luY2UgNC4wLjBcbiAgICAgKiBAY2F0ZWdvcnkgTWF0aFxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHN1bS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogdmFyIG9iamVjdHMgPSBbeyAnbic6IDQgfSwgeyAnbic6IDIgfSwgeyAnbic6IDggfSwgeyAnbic6IDYgfV07XG4gICAgICpcbiAgICAgKiBfLnN1bUJ5KG9iamVjdHMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8ubjsgfSk7XG4gICAgICogLy8gPT4gMjBcbiAgICAgKlxuICAgICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLlxuICAgICAqIF8uc3VtQnkob2JqZWN0cywgJ24nKTtcbiAgICAgKiAvLyA9PiAyMFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN1bUJ5KGFycmF5LCBpdGVyYXRlZSkge1xuICAgICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpXG4gICAgICAgID8gYmFzZVN1bShhcnJheSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKVxuICAgICAgICA6IDA7XG4gICAgfVxuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLy8gQWRkIG1ldGhvZHMgdGhhdCByZXR1cm4gd3JhcHBlZCB2YWx1ZXMgaW4gY2hhaW4gc2VxdWVuY2VzLlxuICAgIGxvZGFzaC5hZnRlciA9IGFmdGVyO1xuICAgIGxvZGFzaC5hcnkgPSBhcnk7XG4gICAgbG9kYXNoLmFzc2lnbiA9IGFzc2lnbjtcbiAgICBsb2Rhc2guYXNzaWduSW4gPSBhc3NpZ25JbjtcbiAgICBsb2Rhc2guYXNzaWduSW5XaXRoID0gYXNzaWduSW5XaXRoO1xuICAgIGxvZGFzaC5hc3NpZ25XaXRoID0gYXNzaWduV2l0aDtcbiAgICBsb2Rhc2guYXQgPSBhdDtcbiAgICBsb2Rhc2guYmVmb3JlID0gYmVmb3JlO1xuICAgIGxvZGFzaC5iaW5kID0gYmluZDtcbiAgICBsb2Rhc2guYmluZEFsbCA9IGJpbmRBbGw7XG4gICAgbG9kYXNoLmJpbmRLZXkgPSBiaW5kS2V5O1xuICAgIGxvZGFzaC5jYXN0QXJyYXkgPSBjYXN0QXJyYXk7XG4gICAgbG9kYXNoLmNoYWluID0gY2hhaW47XG4gICAgbG9kYXNoLmNodW5rID0gY2h1bms7XG4gICAgbG9kYXNoLmNvbXBhY3QgPSBjb21wYWN0O1xuICAgIGxvZGFzaC5jb25jYXQgPSBjb25jYXQ7XG4gICAgbG9kYXNoLmNvbmQgPSBjb25kO1xuICAgIGxvZGFzaC5jb25mb3JtcyA9IGNvbmZvcm1zO1xuICAgIGxvZGFzaC5jb25zdGFudCA9IGNvbnN0YW50O1xuICAgIGxvZGFzaC5jb3VudEJ5ID0gY291bnRCeTtcbiAgICBsb2Rhc2guY3JlYXRlID0gY3JlYXRlO1xuICAgIGxvZGFzaC5jdXJyeSA9IGN1cnJ5O1xuICAgIGxvZGFzaC5jdXJyeVJpZ2h0ID0gY3VycnlSaWdodDtcbiAgICBsb2Rhc2guZGVib3VuY2UgPSBkZWJvdW5jZTtcbiAgICBsb2Rhc2guZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgICBsb2Rhc2guZGVmYXVsdHNEZWVwID0gZGVmYXVsdHNEZWVwO1xuICAgIGxvZGFzaC5kZWZlciA9IGRlZmVyO1xuICAgIGxvZGFzaC5kZWxheSA9IGRlbGF5O1xuICAgIGxvZGFzaC5kaWZmZXJlbmNlID0gZGlmZmVyZW5jZTtcbiAgICBsb2Rhc2guZGlmZmVyZW5jZUJ5ID0gZGlmZmVyZW5jZUJ5O1xuICAgIGxvZGFzaC5kaWZmZXJlbmNlV2l0aCA9IGRpZmZlcmVuY2VXaXRoO1xuICAgIGxvZGFzaC5kcm9wID0gZHJvcDtcbiAgICBsb2Rhc2guZHJvcFJpZ2h0ID0gZHJvcFJpZ2h0O1xuICAgIGxvZGFzaC5kcm9wUmlnaHRXaGlsZSA9IGRyb3BSaWdodFdoaWxlO1xuICAgIGxvZGFzaC5kcm9wV2hpbGUgPSBkcm9wV2hpbGU7XG4gICAgbG9kYXNoLmZpbGwgPSBmaWxsO1xuICAgIGxvZGFzaC5maWx0ZXIgPSBmaWx0ZXI7XG4gICAgbG9kYXNoLmZsYXRNYXAgPSBmbGF0TWFwO1xuICAgIGxvZGFzaC5mbGF0TWFwRGVlcCA9IGZsYXRNYXBEZWVwO1xuICAgIGxvZGFzaC5mbGF0TWFwRGVwdGggPSBmbGF0TWFwRGVwdGg7XG4gICAgbG9kYXNoLmZsYXR0ZW4gPSBmbGF0dGVuO1xuICAgIGxvZGFzaC5mbGF0dGVuRGVlcCA9IGZsYXR0ZW5EZWVwO1xuICAgIGxvZGFzaC5mbGF0dGVuRGVwdGggPSBmbGF0dGVuRGVwdGg7XG4gICAgbG9kYXNoLmZsaXAgPSBmbGlwO1xuICAgIGxvZGFzaC5mbG93ID0gZmxvdztcbiAgICBsb2Rhc2guZmxvd1JpZ2h0ID0gZmxvd1JpZ2h0O1xuICAgIGxvZGFzaC5mcm9tUGFpcnMgPSBmcm9tUGFpcnM7XG4gICAgbG9kYXNoLmZ1bmN0aW9ucyA9IGZ1bmN0aW9ucztcbiAgICBsb2Rhc2guZnVuY3Rpb25zSW4gPSBmdW5jdGlvbnNJbjtcbiAgICBsb2Rhc2guZ3JvdXBCeSA9IGdyb3VwQnk7XG4gICAgbG9kYXNoLmluaXRpYWwgPSBpbml0aWFsO1xuICAgIGxvZGFzaC5pbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247XG4gICAgbG9kYXNoLmludGVyc2VjdGlvbkJ5ID0gaW50ZXJzZWN0aW9uQnk7XG4gICAgbG9kYXNoLmludGVyc2VjdGlvbldpdGggPSBpbnRlcnNlY3Rpb25XaXRoO1xuICAgIGxvZGFzaC5pbnZlcnQgPSBpbnZlcnQ7XG4gICAgbG9kYXNoLmludmVydEJ5ID0gaW52ZXJ0Qnk7XG4gICAgbG9kYXNoLmludm9rZU1hcCA9IGludm9rZU1hcDtcbiAgICBsb2Rhc2guaXRlcmF0ZWUgPSBpdGVyYXRlZTtcbiAgICBsb2Rhc2gua2V5QnkgPSBrZXlCeTtcbiAgICBsb2Rhc2gua2V5cyA9IGtleXM7XG4gICAgbG9kYXNoLmtleXNJbiA9IGtleXNJbjtcbiAgICBsb2Rhc2gubWFwID0gbWFwO1xuICAgIGxvZGFzaC5tYXBLZXlzID0gbWFwS2V5cztcbiAgICBsb2Rhc2gubWFwVmFsdWVzID0gbWFwVmFsdWVzO1xuICAgIGxvZGFzaC5tYXRjaGVzID0gbWF0Y2hlcztcbiAgICBsb2Rhc2gubWF0Y2hlc1Byb3BlcnR5ID0gbWF0Y2hlc1Byb3BlcnR5O1xuICAgIGxvZGFzaC5tZW1vaXplID0gbWVtb2l6ZTtcbiAgICBsb2Rhc2gubWVyZ2UgPSBtZXJnZTtcbiAgICBsb2Rhc2gubWVyZ2VXaXRoID0gbWVyZ2VXaXRoO1xuICAgIGxvZGFzaC5tZXRob2QgPSBtZXRob2Q7XG4gICAgbG9kYXNoLm1ldGhvZE9mID0gbWV0aG9kT2Y7XG4gICAgbG9kYXNoLm1peGluID0gbWl4aW47XG4gICAgbG9kYXNoLm5lZ2F0ZSA9IG5lZ2F0ZTtcbiAgICBsb2Rhc2gubnRoQXJnID0gbnRoQXJnO1xuICAgIGxvZGFzaC5vbWl0ID0gb21pdDtcbiAgICBsb2Rhc2gub21pdEJ5ID0gb21pdEJ5O1xuICAgIGxvZGFzaC5vbmNlID0gb25jZTtcbiAgICBsb2Rhc2gub3JkZXJCeSA9IG9yZGVyQnk7XG4gICAgbG9kYXNoLm92ZXIgPSBvdmVyO1xuICAgIGxvZGFzaC5vdmVyQXJncyA9IG92ZXJBcmdzO1xuICAgIGxvZGFzaC5vdmVyRXZlcnkgPSBvdmVyRXZlcnk7XG4gICAgbG9kYXNoLm92ZXJTb21lID0gb3ZlclNvbWU7XG4gICAgbG9kYXNoLnBhcnRpYWwgPSBwYXJ0aWFsO1xuICAgIGxvZGFzaC5wYXJ0aWFsUmlnaHQgPSBwYXJ0aWFsUmlnaHQ7XG4gICAgbG9kYXNoLnBhcnRpdGlvbiA9IHBhcnRpdGlvbjtcbiAgICBsb2Rhc2gucGljayA9IHBpY2s7XG4gICAgbG9kYXNoLnBpY2tCeSA9IHBpY2tCeTtcbiAgICBsb2Rhc2gucHJvcGVydHkgPSBwcm9wZXJ0eTtcbiAgICBsb2Rhc2gucHJvcGVydHlPZiA9IHByb3BlcnR5T2Y7XG4gICAgbG9kYXNoLnB1bGwgPSBwdWxsO1xuICAgIGxvZGFzaC5wdWxsQWxsID0gcHVsbEFsbDtcbiAgICBsb2Rhc2gucHVsbEFsbEJ5ID0gcHVsbEFsbEJ5O1xuICAgIGxvZGFzaC5wdWxsQWxsV2l0aCA9IHB1bGxBbGxXaXRoO1xuICAgIGxvZGFzaC5wdWxsQXQgPSBwdWxsQXQ7XG4gICAgbG9kYXNoLnJhbmdlID0gcmFuZ2U7XG4gICAgbG9kYXNoLnJhbmdlUmlnaHQgPSByYW5nZVJpZ2h0O1xuICAgIGxvZGFzaC5yZWFyZyA9IHJlYXJnO1xuICAgIGxvZGFzaC5yZWplY3QgPSByZWplY3Q7XG4gICAgbG9kYXNoLnJlbW92ZSA9IHJlbW92ZTtcbiAgICBsb2Rhc2gucmVzdCA9IHJlc3Q7XG4gICAgbG9kYXNoLnJldmVyc2UgPSByZXZlcnNlO1xuICAgIGxvZGFzaC5zYW1wbGVTaXplID0gc2FtcGxlU2l6ZTtcbiAgICBsb2Rhc2guc2V0ID0gc2V0O1xuICAgIGxvZGFzaC5zZXRXaXRoID0gc2V0V2l0aDtcbiAgICBsb2Rhc2guc2h1ZmZsZSA9IHNodWZmbGU7XG4gICAgbG9kYXNoLnNsaWNlID0gc2xpY2U7XG4gICAgbG9kYXNoLnNvcnRCeSA9IHNvcnRCeTtcbiAgICBsb2Rhc2guc29ydGVkVW5pcSA9IHNvcnRlZFVuaXE7XG4gICAgbG9kYXNoLnNvcnRlZFVuaXFCeSA9IHNvcnRlZFVuaXFCeTtcbiAgICBsb2Rhc2guc3BsaXQgPSBzcGxpdDtcbiAgICBsb2Rhc2guc3ByZWFkID0gc3ByZWFkO1xuICAgIGxvZGFzaC50YWlsID0gdGFpbDtcbiAgICBsb2Rhc2gudGFrZSA9IHRha2U7XG4gICAgbG9kYXNoLnRha2VSaWdodCA9IHRha2VSaWdodDtcbiAgICBsb2Rhc2gudGFrZVJpZ2h0V2hpbGUgPSB0YWtlUmlnaHRXaGlsZTtcbiAgICBsb2Rhc2gudGFrZVdoaWxlID0gdGFrZVdoaWxlO1xuICAgIGxvZGFzaC50YXAgPSB0YXA7XG4gICAgbG9kYXNoLnRocm90dGxlID0gdGhyb3R0bGU7XG4gICAgbG9kYXNoLnRocnUgPSB0aHJ1O1xuICAgIGxvZGFzaC50b0FycmF5ID0gdG9BcnJheTtcbiAgICBsb2Rhc2gudG9QYWlycyA9IHRvUGFpcnM7XG4gICAgbG9kYXNoLnRvUGFpcnNJbiA9IHRvUGFpcnNJbjtcbiAgICBsb2Rhc2gudG9QYXRoID0gdG9QYXRoO1xuICAgIGxvZGFzaC50b1BsYWluT2JqZWN0ID0gdG9QbGFpbk9iamVjdDtcbiAgICBsb2Rhc2gudHJhbnNmb3JtID0gdHJhbnNmb3JtO1xuICAgIGxvZGFzaC51bmFyeSA9IHVuYXJ5O1xuICAgIGxvZGFzaC51bmlvbiA9IHVuaW9uO1xuICAgIGxvZGFzaC51bmlvbkJ5ID0gdW5pb25CeTtcbiAgICBsb2Rhc2gudW5pb25XaXRoID0gdW5pb25XaXRoO1xuICAgIGxvZGFzaC51bmlxID0gdW5pcTtcbiAgICBsb2Rhc2gudW5pcUJ5ID0gdW5pcUJ5O1xuICAgIGxvZGFzaC51bmlxV2l0aCA9IHVuaXFXaXRoO1xuICAgIGxvZGFzaC51bnNldCA9IHVuc2V0O1xuICAgIGxvZGFzaC51bnppcCA9IHVuemlwO1xuICAgIGxvZGFzaC51bnppcFdpdGggPSB1bnppcFdpdGg7XG4gICAgbG9kYXNoLnVwZGF0ZSA9IHVwZGF0ZTtcbiAgICBsb2Rhc2gudXBkYXRlV2l0aCA9IHVwZGF0ZVdpdGg7XG4gICAgbG9kYXNoLnZhbHVlcyA9IHZhbHVlcztcbiAgICBsb2Rhc2gudmFsdWVzSW4gPSB2YWx1ZXNJbjtcbiAgICBsb2Rhc2gud2l0aG91dCA9IHdpdGhvdXQ7XG4gICAgbG9kYXNoLndvcmRzID0gd29yZHM7XG4gICAgbG9kYXNoLndyYXAgPSB3cmFwO1xuICAgIGxvZGFzaC54b3IgPSB4b3I7XG4gICAgbG9kYXNoLnhvckJ5ID0geG9yQnk7XG4gICAgbG9kYXNoLnhvcldpdGggPSB4b3JXaXRoO1xuICAgIGxvZGFzaC56aXAgPSB6aXA7XG4gICAgbG9kYXNoLnppcE9iamVjdCA9IHppcE9iamVjdDtcbiAgICBsb2Rhc2guemlwT2JqZWN0RGVlcCA9IHppcE9iamVjdERlZXA7XG4gICAgbG9kYXNoLnppcFdpdGggPSB6aXBXaXRoO1xuXG4gICAgLy8gQWRkIGFsaWFzZXMuXG4gICAgbG9kYXNoLmVudHJpZXMgPSB0b1BhaXJzO1xuICAgIGxvZGFzaC5lbnRyaWVzSW4gPSB0b1BhaXJzSW47XG4gICAgbG9kYXNoLmV4dGVuZCA9IGFzc2lnbkluO1xuICAgIGxvZGFzaC5leHRlbmRXaXRoID0gYXNzaWduSW5XaXRoO1xuXG4gICAgLy8gQWRkIG1ldGhvZHMgdG8gYGxvZGFzaC5wcm90b3R5cGVgLlxuICAgIG1peGluKGxvZGFzaCwgbG9kYXNoKTtcblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8vIEFkZCBtZXRob2RzIHRoYXQgcmV0dXJuIHVud3JhcHBlZCB2YWx1ZXMgaW4gY2hhaW4gc2VxdWVuY2VzLlxuICAgIGxvZGFzaC5hZGQgPSBhZGQ7XG4gICAgbG9kYXNoLmF0dGVtcHQgPSBhdHRlbXB0O1xuICAgIGxvZGFzaC5jYW1lbENhc2UgPSBjYW1lbENhc2U7XG4gICAgbG9kYXNoLmNhcGl0YWxpemUgPSBjYXBpdGFsaXplO1xuICAgIGxvZGFzaC5jZWlsID0gY2VpbDtcbiAgICBsb2Rhc2guY2xhbXAgPSBjbGFtcDtcbiAgICBsb2Rhc2guY2xvbmUgPSBjbG9uZTtcbiAgICBsb2Rhc2guY2xvbmVEZWVwID0gY2xvbmVEZWVwO1xuICAgIGxvZGFzaC5jbG9uZURlZXBXaXRoID0gY2xvbmVEZWVwV2l0aDtcbiAgICBsb2Rhc2guY2xvbmVXaXRoID0gY2xvbmVXaXRoO1xuICAgIGxvZGFzaC5jb25mb3Jtc1RvID0gY29uZm9ybXNUbztcbiAgICBsb2Rhc2guZGVidXJyID0gZGVidXJyO1xuICAgIGxvZGFzaC5kZWZhdWx0VG8gPSBkZWZhdWx0VG87XG4gICAgbG9kYXNoLmRpdmlkZSA9IGRpdmlkZTtcbiAgICBsb2Rhc2guZW5kc1dpdGggPSBlbmRzV2l0aDtcbiAgICBsb2Rhc2guZXEgPSBlcTtcbiAgICBsb2Rhc2guZXNjYXBlID0gZXNjYXBlO1xuICAgIGxvZGFzaC5lc2NhcGVSZWdFeHAgPSBlc2NhcGVSZWdFeHA7XG4gICAgbG9kYXNoLmV2ZXJ5ID0gZXZlcnk7XG4gICAgbG9kYXNoLmZpbmQgPSBmaW5kO1xuICAgIGxvZGFzaC5maW5kSW5kZXggPSBmaW5kSW5kZXg7XG4gICAgbG9kYXNoLmZpbmRLZXkgPSBmaW5kS2V5O1xuICAgIGxvZGFzaC5maW5kTGFzdCA9IGZpbmRMYXN0O1xuICAgIGxvZGFzaC5maW5kTGFzdEluZGV4ID0gZmluZExhc3RJbmRleDtcbiAgICBsb2Rhc2guZmluZExhc3RLZXkgPSBmaW5kTGFzdEtleTtcbiAgICBsb2Rhc2guZmxvb3IgPSBmbG9vcjtcbiAgICBsb2Rhc2guZm9yRWFjaCA9IGZvckVhY2g7XG4gICAgbG9kYXNoLmZvckVhY2hSaWdodCA9IGZvckVhY2hSaWdodDtcbiAgICBsb2Rhc2guZm9ySW4gPSBmb3JJbjtcbiAgICBsb2Rhc2guZm9ySW5SaWdodCA9IGZvckluUmlnaHQ7XG4gICAgbG9kYXNoLmZvck93biA9IGZvck93bjtcbiAgICBsb2Rhc2guZm9yT3duUmlnaHQgPSBmb3JPd25SaWdodDtcbiAgICBsb2Rhc2guZ2V0ID0gZ2V0O1xuICAgIGxvZGFzaC5ndCA9IGd0O1xuICAgIGxvZGFzaC5ndGUgPSBndGU7XG4gICAgbG9kYXNoLmhhcyA9IGhhcztcbiAgICBsb2Rhc2guaGFzSW4gPSBoYXNJbjtcbiAgICBsb2Rhc2guaGVhZCA9IGhlYWQ7XG4gICAgbG9kYXNoLmlkZW50aXR5ID0gaWRlbnRpdHk7XG4gICAgbG9kYXNoLmluY2x1ZGVzID0gaW5jbHVkZXM7XG4gICAgbG9kYXNoLmluZGV4T2YgPSBpbmRleE9mO1xuICAgIGxvZGFzaC5pblJhbmdlID0gaW5SYW5nZTtcbiAgICBsb2Rhc2guaW52b2tlID0gaW52b2tlO1xuICAgIGxvZGFzaC5pc0FyZ3VtZW50cyA9IGlzQXJndW1lbnRzO1xuICAgIGxvZGFzaC5pc0FycmF5ID0gaXNBcnJheTtcbiAgICBsb2Rhc2guaXNBcnJheUJ1ZmZlciA9IGlzQXJyYXlCdWZmZXI7XG4gICAgbG9kYXNoLmlzQXJyYXlMaWtlID0gaXNBcnJheUxpa2U7XG4gICAgbG9kYXNoLmlzQXJyYXlMaWtlT2JqZWN0ID0gaXNBcnJheUxpa2VPYmplY3Q7XG4gICAgbG9kYXNoLmlzQm9vbGVhbiA9IGlzQm9vbGVhbjtcbiAgICBsb2Rhc2guaXNCdWZmZXIgPSBpc0J1ZmZlcjtcbiAgICBsb2Rhc2guaXNEYXRlID0gaXNEYXRlO1xuICAgIGxvZGFzaC5pc0VsZW1lbnQgPSBpc0VsZW1lbnQ7XG4gICAgbG9kYXNoLmlzRW1wdHkgPSBpc0VtcHR5O1xuICAgIGxvZGFzaC5pc0VxdWFsID0gaXNFcXVhbDtcbiAgICBsb2Rhc2guaXNFcXVhbFdpdGggPSBpc0VxdWFsV2l0aDtcbiAgICBsb2Rhc2guaXNFcnJvciA9IGlzRXJyb3I7XG4gICAgbG9kYXNoLmlzRmluaXRlID0gaXNGaW5pdGU7XG4gICAgbG9kYXNoLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uO1xuICAgIGxvZGFzaC5pc0ludGVnZXIgPSBpc0ludGVnZXI7XG4gICAgbG9kYXNoLmlzTGVuZ3RoID0gaXNMZW5ndGg7XG4gICAgbG9kYXNoLmlzTWFwID0gaXNNYXA7XG4gICAgbG9kYXNoLmlzTWF0Y2ggPSBpc01hdGNoO1xuICAgIGxvZGFzaC5pc01hdGNoV2l0aCA9IGlzTWF0Y2hXaXRoO1xuICAgIGxvZGFzaC5pc05hTiA9IGlzTmFOO1xuICAgIGxvZGFzaC5pc05hdGl2ZSA9IGlzTmF0aXZlO1xuICAgIGxvZGFzaC5pc05pbCA9IGlzTmlsO1xuICAgIGxvZGFzaC5pc051bGwgPSBpc051bGw7XG4gICAgbG9kYXNoLmlzTnVtYmVyID0gaXNOdW1iZXI7XG4gICAgbG9kYXNoLmlzT2JqZWN0ID0gaXNPYmplY3Q7XG4gICAgbG9kYXNoLmlzT2JqZWN0TGlrZSA9IGlzT2JqZWN0TGlrZTtcbiAgICBsb2Rhc2guaXNQbGFpbk9iamVjdCA9IGlzUGxhaW5PYmplY3Q7XG4gICAgbG9kYXNoLmlzUmVnRXhwID0gaXNSZWdFeHA7XG4gICAgbG9kYXNoLmlzU2FmZUludGVnZXIgPSBpc1NhZmVJbnRlZ2VyO1xuICAgIGxvZGFzaC5pc1NldCA9IGlzU2V0O1xuICAgIGxvZGFzaC5pc1N0cmluZyA9IGlzU3RyaW5nO1xuICAgIGxvZGFzaC5pc1N5bWJvbCA9IGlzU3ltYm9sO1xuICAgIGxvZGFzaC5pc1R5cGVkQXJyYXkgPSBpc1R5cGVkQXJyYXk7XG4gICAgbG9kYXNoLmlzVW5kZWZpbmVkID0gaXNVbmRlZmluZWQ7XG4gICAgbG9kYXNoLmlzV2Vha01hcCA9IGlzV2Vha01hcDtcbiAgICBsb2Rhc2guaXNXZWFrU2V0ID0gaXNXZWFrU2V0O1xuICAgIGxvZGFzaC5qb2luID0gam9pbjtcbiAgICBsb2Rhc2gua2ViYWJDYXNlID0ga2ViYWJDYXNlO1xuICAgIGxvZGFzaC5sYXN0ID0gbGFzdDtcbiAgICBsb2Rhc2gubGFzdEluZGV4T2YgPSBsYXN0SW5kZXhPZjtcbiAgICBsb2Rhc2gubG93ZXJDYXNlID0gbG93ZXJDYXNlO1xuICAgIGxvZGFzaC5sb3dlckZpcnN0ID0gbG93ZXJGaXJzdDtcbiAgICBsb2Rhc2gubHQgPSBsdDtcbiAgICBsb2Rhc2gubHRlID0gbHRlO1xuICAgIGxvZGFzaC5tYXggPSBtYXg7XG4gICAgbG9kYXNoLm1heEJ5ID0gbWF4Qnk7XG4gICAgbG9kYXNoLm1lYW4gPSBtZWFuO1xuICAgIGxvZGFzaC5tZWFuQnkgPSBtZWFuQnk7XG4gICAgbG9kYXNoLm1pbiA9IG1pbjtcbiAgICBsb2Rhc2gubWluQnkgPSBtaW5CeTtcbiAgICBsb2Rhc2guc3R1YkFycmF5ID0gc3R1YkFycmF5O1xuICAgIGxvZGFzaC5zdHViRmFsc2UgPSBzdHViRmFsc2U7XG4gICAgbG9kYXNoLnN0dWJPYmplY3QgPSBzdHViT2JqZWN0O1xuICAgIGxvZGFzaC5zdHViU3RyaW5nID0gc3R1YlN0cmluZztcbiAgICBsb2Rhc2guc3R1YlRydWUgPSBzdHViVHJ1ZTtcbiAgICBsb2Rhc2gubXVsdGlwbHkgPSBtdWx0aXBseTtcbiAgICBsb2Rhc2gubnRoID0gbnRoO1xuICAgIGxvZGFzaC5ub0NvbmZsaWN0ID0gbm9Db25mbGljdDtcbiAgICBsb2Rhc2gubm9vcCA9IG5vb3A7XG4gICAgbG9kYXNoLm5vdyA9IG5vdztcbiAgICBsb2Rhc2gucGFkID0gcGFkO1xuICAgIGxvZGFzaC5wYWRFbmQgPSBwYWRFbmQ7XG4gICAgbG9kYXNoLnBhZFN0YXJ0ID0gcGFkU3RhcnQ7XG4gICAgbG9kYXNoLnBhcnNlSW50ID0gcGFyc2VJbnQ7XG4gICAgbG9kYXNoLnJhbmRvbSA9IHJhbmRvbTtcbiAgICBsb2Rhc2gucmVkdWNlID0gcmVkdWNlO1xuICAgIGxvZGFzaC5yZWR1Y2VSaWdodCA9IHJlZHVjZVJpZ2h0O1xuICAgIGxvZGFzaC5yZXBlYXQgPSByZXBlYXQ7XG4gICAgbG9kYXNoLnJlcGxhY2UgPSByZXBsYWNlO1xuICAgIGxvZGFzaC5yZXN1bHQgPSByZXN1bHQ7XG4gICAgbG9kYXNoLnJvdW5kID0gcm91bmQ7XG4gICAgbG9kYXNoLnJ1bkluQ29udGV4dCA9IHJ1bkluQ29udGV4dDtcbiAgICBsb2Rhc2guc2FtcGxlID0gc2FtcGxlO1xuICAgIGxvZGFzaC5zaXplID0gc2l6ZTtcbiAgICBsb2Rhc2guc25ha2VDYXNlID0gc25ha2VDYXNlO1xuICAgIGxvZGFzaC5zb21lID0gc29tZTtcbiAgICBsb2Rhc2guc29ydGVkSW5kZXggPSBzb3J0ZWRJbmRleDtcbiAgICBsb2Rhc2guc29ydGVkSW5kZXhCeSA9IHNvcnRlZEluZGV4Qnk7XG4gICAgbG9kYXNoLnNvcnRlZEluZGV4T2YgPSBzb3J0ZWRJbmRleE9mO1xuICAgIGxvZGFzaC5zb3J0ZWRMYXN0SW5kZXggPSBzb3J0ZWRMYXN0SW5kZXg7XG4gICAgbG9kYXNoLnNvcnRlZExhc3RJbmRleEJ5ID0gc29ydGVkTGFzdEluZGV4Qnk7XG4gICAgbG9kYXNoLnNvcnRlZExhc3RJbmRleE9mID0gc29ydGVkTGFzdEluZGV4T2Y7XG4gICAgbG9kYXNoLnN0YXJ0Q2FzZSA9IHN0YXJ0Q2FzZTtcbiAgICBsb2Rhc2guc3RhcnRzV2l0aCA9IHN0YXJ0c1dpdGg7XG4gICAgbG9kYXNoLnN1YnRyYWN0ID0gc3VidHJhY3Q7XG4gICAgbG9kYXNoLnN1bSA9IHN1bTtcbiAgICBsb2Rhc2guc3VtQnkgPSBzdW1CeTtcbiAgICBsb2Rhc2gudGVtcGxhdGUgPSB0ZW1wbGF0ZTtcbiAgICBsb2Rhc2gudGltZXMgPSB0aW1lcztcbiAgICBsb2Rhc2gudG9GaW5pdGUgPSB0b0Zpbml0ZTtcbiAgICBsb2Rhc2gudG9JbnRlZ2VyID0gdG9JbnRlZ2VyO1xuICAgIGxvZGFzaC50b0xlbmd0aCA9IHRvTGVuZ3RoO1xuICAgIGxvZGFzaC50b0xvd2VyID0gdG9Mb3dlcjtcbiAgICBsb2Rhc2gudG9OdW1iZXIgPSB0b051bWJlcjtcbiAgICBsb2Rhc2gudG9TYWZlSW50ZWdlciA9IHRvU2FmZUludGVnZXI7XG4gICAgbG9kYXNoLnRvU3RyaW5nID0gdG9TdHJpbmc7XG4gICAgbG9kYXNoLnRvVXBwZXIgPSB0b1VwcGVyO1xuICAgIGxvZGFzaC50cmltID0gdHJpbTtcbiAgICBsb2Rhc2gudHJpbUVuZCA9IHRyaW1FbmQ7XG4gICAgbG9kYXNoLnRyaW1TdGFydCA9IHRyaW1TdGFydDtcbiAgICBsb2Rhc2gudHJ1bmNhdGUgPSB0cnVuY2F0ZTtcbiAgICBsb2Rhc2gudW5lc2NhcGUgPSB1bmVzY2FwZTtcbiAgICBsb2Rhc2gudW5pcXVlSWQgPSB1bmlxdWVJZDtcbiAgICBsb2Rhc2gudXBwZXJDYXNlID0gdXBwZXJDYXNlO1xuICAgIGxvZGFzaC51cHBlckZpcnN0ID0gdXBwZXJGaXJzdDtcblxuICAgIC8vIEFkZCBhbGlhc2VzLlxuICAgIGxvZGFzaC5lYWNoID0gZm9yRWFjaDtcbiAgICBsb2Rhc2guZWFjaFJpZ2h0ID0gZm9yRWFjaFJpZ2h0O1xuICAgIGxvZGFzaC5maXJzdCA9IGhlYWQ7XG5cbiAgICBtaXhpbihsb2Rhc2gsIChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzb3VyY2UgPSB7fTtcbiAgICAgIGJhc2VGb3JPd24obG9kYXNoLCBmdW5jdGlvbihmdW5jLCBtZXRob2ROYW1lKSB7XG4gICAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbChsb2Rhc2gucHJvdG90eXBlLCBtZXRob2ROYW1lKSkge1xuICAgICAgICAgIHNvdXJjZVttZXRob2ROYW1lXSA9IGZ1bmM7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9KCkpLCB7ICdjaGFpbic6IGZhbHNlIH0pO1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNlbWFudGljIHZlcnNpb24gbnVtYmVyLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBsb2Rhc2guVkVSU0lPTiA9IFZFUlNJT047XG5cbiAgICAvLyBBc3NpZ24gZGVmYXVsdCBwbGFjZWhvbGRlcnMuXG4gICAgYXJyYXlFYWNoKFsnYmluZCcsICdiaW5kS2V5JywgJ2N1cnJ5JywgJ2N1cnJ5UmlnaHQnLCAncGFydGlhbCcsICdwYXJ0aWFsUmlnaHQnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgICAgbG9kYXNoW21ldGhvZE5hbWVdLnBsYWNlaG9sZGVyID0gbG9kYXNoO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyBmb3IgYF8uZHJvcGAgYW5kIGBfLnRha2VgIHZhcmlhbnRzLlxuICAgIGFycmF5RWFjaChbJ2Ryb3AnLCAndGFrZSddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkge1xuICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24obikge1xuICAgICAgICBuID0gbiA9PT0gdW5kZWZpbmVkID8gMSA6IG5hdGl2ZU1heCh0b0ludGVnZXIobiksIDApO1xuXG4gICAgICAgIHZhciByZXN1bHQgPSAodGhpcy5fX2ZpbHRlcmVkX18gJiYgIWluZGV4KVxuICAgICAgICAgID8gbmV3IExhenlXcmFwcGVyKHRoaXMpXG4gICAgICAgICAgOiB0aGlzLmNsb25lKCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5fX2ZpbHRlcmVkX18pIHtcbiAgICAgICAgICByZXN1bHQuX190YWtlQ291bnRfXyA9IG5hdGl2ZU1pbihuLCByZXN1bHQuX190YWtlQ291bnRfXyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0Ll9fdmlld3NfXy5wdXNoKHtcbiAgICAgICAgICAgICdzaXplJzogbmF0aXZlTWluKG4sIE1BWF9BUlJBWV9MRU5HVEgpLFxuICAgICAgICAgICAgJ3R5cGUnOiBtZXRob2ROYW1lICsgKHJlc3VsdC5fX2Rpcl9fIDwgMCA/ICdSaWdodCcgOiAnJylcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcblxuICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWUgKyAnUmlnaHQnXSA9IGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmV2ZXJzZSgpW21ldGhvZE5hbWVdKG4pLnJldmVyc2UoKTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYExhenlXcmFwcGVyYCBtZXRob2RzIHRoYXQgYWNjZXB0IGFuIGBpdGVyYXRlZWAgdmFsdWUuXG4gICAgYXJyYXlFYWNoKFsnZmlsdGVyJywgJ21hcCcsICd0YWtlV2hpbGUnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSwgaW5kZXgpIHtcbiAgICAgIHZhciB0eXBlID0gaW5kZXggKyAxLFxuICAgICAgICAgIGlzRmlsdGVyID0gdHlwZSA9PSBMQVpZX0ZJTFRFUl9GTEFHIHx8IHR5cGUgPT0gTEFaWV9XSElMRV9GTEFHO1xuXG4gICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbihpdGVyYXRlZSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5jbG9uZSgpO1xuICAgICAgICByZXN1bHQuX19pdGVyYXRlZXNfXy5wdXNoKHtcbiAgICAgICAgICAnaXRlcmF0ZWUnOiBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMyksXG4gICAgICAgICAgJ3R5cGUnOiB0eXBlXG4gICAgICAgIH0pO1xuICAgICAgICByZXN1bHQuX19maWx0ZXJlZF9fID0gcmVzdWx0Ll9fZmlsdGVyZWRfXyB8fCBpc0ZpbHRlcjtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYExhenlXcmFwcGVyYCBtZXRob2RzIGZvciBgXy5oZWFkYCBhbmQgYF8ubGFzdGAuXG4gICAgYXJyYXlFYWNoKFsnaGVhZCcsICdsYXN0J10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUsIGluZGV4KSB7XG4gICAgICB2YXIgdGFrZU5hbWUgPSAndGFrZScgKyAoaW5kZXggPyAnUmlnaHQnIDogJycpO1xuXG4gICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFrZU5hbWVdKDEpLnZhbHVlKClbMF07XG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyBmb3IgYF8uaW5pdGlhbGAgYW5kIGBfLnRhaWxgLlxuICAgIGFycmF5RWFjaChbJ2luaXRpYWwnLCAndGFpbCddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkge1xuICAgICAgdmFyIGRyb3BOYW1lID0gJ2Ryb3AnICsgKGluZGV4ID8gJycgOiAnUmlnaHQnKTtcblxuICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9fZmlsdGVyZWRfXyA/IG5ldyBMYXp5V3JhcHBlcih0aGlzKSA6IHRoaXNbZHJvcE5hbWVdKDEpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5jb21wYWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5maWx0ZXIoaWRlbnRpdHkpO1xuICAgIH07XG5cbiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyKHByZWRpY2F0ZSkuaGVhZCgpO1xuICAgIH07XG5cbiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuZmluZExhc3QgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnJldmVyc2UoKS5maW5kKHByZWRpY2F0ZSk7XG4gICAgfTtcblxuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5pbnZva2VNYXAgPSBiYXNlUmVzdChmdW5jdGlvbihwYXRoLCBhcmdzKSB7XG4gICAgICBpZiAodHlwZW9mIHBhdGggPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gbmV3IExhenlXcmFwcGVyKHRoaXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBiYXNlSW52b2tlKHZhbHVlLCBwYXRoLCBhcmdzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyKG5lZ2F0ZShnZXRJdGVyYXRlZShwcmVkaWNhdGUpKSk7XG4gICAgfTtcblxuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHtcbiAgICAgIHN0YXJ0ID0gdG9JbnRlZ2VyKHN0YXJ0KTtcblxuICAgICAgdmFyIHJlc3VsdCA9IHRoaXM7XG4gICAgICBpZiAocmVzdWx0Ll9fZmlsdGVyZWRfXyAmJiAoc3RhcnQgPiAwIHx8IGVuZCA8IDApKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGF6eVdyYXBwZXIocmVzdWx0KTtcbiAgICAgIH1cbiAgICAgIGlmIChzdGFydCA8IDApIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnRha2VSaWdodCgtc3RhcnQpO1xuICAgICAgfSBlbHNlIGlmIChzdGFydCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZHJvcChzdGFydCk7XG4gICAgICB9XG4gICAgICBpZiAoZW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZW5kID0gdG9JbnRlZ2VyKGVuZCk7XG4gICAgICAgIHJlc3VsdCA9IGVuZCA8IDAgPyByZXN1bHQuZHJvcFJpZ2h0KC1lbmQpIDogcmVzdWx0LnRha2UoZW5kIC0gc3RhcnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLnRha2VSaWdodFdoaWxlID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXZlcnNlKCkudGFrZVdoaWxlKHByZWRpY2F0ZSkucmV2ZXJzZSgpO1xuICAgIH07XG5cbiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMudGFrZShNQVhfQVJSQVlfTEVOR1RIKTtcbiAgICB9O1xuXG4gICAgLy8gQWRkIGBMYXp5V3JhcHBlcmAgbWV0aG9kcyB0byBgbG9kYXNoLnByb3RvdHlwZWAuXG4gICAgYmFzZUZvck93bihMYXp5V3JhcHBlci5wcm90b3R5cGUsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHtcbiAgICAgIHZhciBjaGVja0l0ZXJhdGVlID0gL14oPzpmaWx0ZXJ8ZmluZHxtYXB8cmVqZWN0KXxXaGlsZSQvLnRlc3QobWV0aG9kTmFtZSksXG4gICAgICAgICAgaXNUYWtlciA9IC9eKD86aGVhZHxsYXN0KSQvLnRlc3QobWV0aG9kTmFtZSksXG4gICAgICAgICAgbG9kYXNoRnVuYyA9IGxvZGFzaFtpc1Rha2VyID8gKCd0YWtlJyArIChtZXRob2ROYW1lID09ICdsYXN0JyA/ICdSaWdodCcgOiAnJykpIDogbWV0aG9kTmFtZV0sXG4gICAgICAgICAgcmV0VW53cmFwcGVkID0gaXNUYWtlciB8fCAvXmZpbmQvLnRlc3QobWV0aG9kTmFtZSk7XG5cbiAgICAgIGlmICghbG9kYXNoRnVuYykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX193cmFwcGVkX18sXG4gICAgICAgICAgICBhcmdzID0gaXNUYWtlciA/IFsxXSA6IGFyZ3VtZW50cyxcbiAgICAgICAgICAgIGlzTGF6eSA9IHZhbHVlIGluc3RhbmNlb2YgTGF6eVdyYXBwZXIsXG4gICAgICAgICAgICBpdGVyYXRlZSA9IGFyZ3NbMF0sXG4gICAgICAgICAgICB1c2VMYXp5ID0gaXNMYXp5IHx8IGlzQXJyYXkodmFsdWUpO1xuXG4gICAgICAgIHZhciBpbnRlcmNlcHRvciA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGxvZGFzaEZ1bmMuYXBwbHkobG9kYXNoLCBhcnJheVB1c2goW3ZhbHVlXSwgYXJncykpO1xuICAgICAgICAgIHJldHVybiAoaXNUYWtlciAmJiBjaGFpbkFsbCkgPyByZXN1bHRbMF0gOiByZXN1bHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHVzZUxhenkgJiYgY2hlY2tJdGVyYXRlZSAmJiB0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyAmJiBpdGVyYXRlZS5sZW5ndGggIT0gMSkge1xuICAgICAgICAgIC8vIEF2b2lkIGxhenkgdXNlIGlmIHRoZSBpdGVyYXRlZSBoYXMgYSBcImxlbmd0aFwiIHZhbHVlIG90aGVyIHRoYW4gYDFgLlxuICAgICAgICAgIGlzTGF6eSA9IHVzZUxhenkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2hhaW5BbGwgPSB0aGlzLl9fY2hhaW5fXyxcbiAgICAgICAgICAgIGlzSHlicmlkID0gISF0aGlzLl9fYWN0aW9uc19fLmxlbmd0aCxcbiAgICAgICAgICAgIGlzVW53cmFwcGVkID0gcmV0VW53cmFwcGVkICYmICFjaGFpbkFsbCxcbiAgICAgICAgICAgIG9ubHlMYXp5ID0gaXNMYXp5ICYmICFpc0h5YnJpZDtcblxuICAgICAgICBpZiAoIXJldFVud3JhcHBlZCAmJiB1c2VMYXp5KSB7XG4gICAgICAgICAgdmFsdWUgPSBvbmx5TGF6eSA/IHZhbHVlIDogbmV3IExhenlXcmFwcGVyKHRoaXMpO1xuICAgICAgICAgIHZhciByZXN1bHQgPSBmdW5jLmFwcGx5KHZhbHVlLCBhcmdzKTtcbiAgICAgICAgICByZXN1bHQuX19hY3Rpb25zX18ucHVzaCh7ICdmdW5jJzogdGhydSwgJ2FyZ3MnOiBbaW50ZXJjZXB0b3JdLCAndGhpc0FyZyc6IHVuZGVmaW5lZCB9KTtcbiAgICAgICAgICByZXR1cm4gbmV3IExvZGFzaFdyYXBwZXIocmVzdWx0LCBjaGFpbkFsbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzVW53cmFwcGVkICYmIG9ubHlMYXp5KSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ID0gdGhpcy50aHJ1KGludGVyY2VwdG9yKTtcbiAgICAgICAgcmV0dXJuIGlzVW53cmFwcGVkID8gKGlzVGFrZXIgPyByZXN1bHQudmFsdWUoKVswXSA6IHJlc3VsdC52YWx1ZSgpKSA6IHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYEFycmF5YCBtZXRob2RzIHRvIGBsb2Rhc2gucHJvdG90eXBlYC5cbiAgICBhcnJheUVhY2goWydwb3AnLCAncHVzaCcsICdzaGlmdCcsICdzb3J0JywgJ3NwbGljZScsICd1bnNoaWZ0J10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICAgIHZhciBmdW5jID0gYXJyYXlQcm90b1ttZXRob2ROYW1lXSxcbiAgICAgICAgICBjaGFpbk5hbWUgPSAvXig/OnB1c2h8c29ydHx1bnNoaWZ0KSQvLnRlc3QobWV0aG9kTmFtZSkgPyAndGFwJyA6ICd0aHJ1JyxcbiAgICAgICAgICByZXRVbndyYXBwZWQgPSAvXig/OnBvcHxzaGlmdCkkLy50ZXN0KG1ldGhvZE5hbWUpO1xuXG4gICAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICBpZiAocmV0VW53cmFwcGVkICYmICF0aGlzLl9fY2hhaW5fXykge1xuICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWUoKTtcbiAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShpc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW10sIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzW2NoYWluTmFtZV0oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShpc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW10sIGFyZ3MpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICAvLyBNYXAgbWluaWZpZWQgbWV0aG9kIG5hbWVzIHRvIHRoZWlyIHJlYWwgbmFtZXMuXG4gICAgYmFzZUZvck93bihMYXp5V3JhcHBlci5wcm90b3R5cGUsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHtcbiAgICAgIHZhciBsb2Rhc2hGdW5jID0gbG9kYXNoW21ldGhvZE5hbWVdO1xuICAgICAgaWYgKGxvZGFzaEZ1bmMpIHtcbiAgICAgICAgdmFyIGtleSA9IChsb2Rhc2hGdW5jLm5hbWUgKyAnJyksXG4gICAgICAgICAgICBuYW1lcyA9IHJlYWxOYW1lc1trZXldIHx8IChyZWFsTmFtZXNba2V5XSA9IFtdKTtcblxuICAgICAgICBuYW1lcy5wdXNoKHsgJ25hbWUnOiBtZXRob2ROYW1lLCAnZnVuYyc6IGxvZGFzaEZ1bmMgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZWFsTmFtZXNbY3JlYXRlSHlicmlkKHVuZGVmaW5lZCwgV1JBUF9CSU5EX0tFWV9GTEFHKS5uYW1lXSA9IFt7XG4gICAgICAnbmFtZSc6ICd3cmFwcGVyJyxcbiAgICAgICdmdW5jJzogdW5kZWZpbmVkXG4gICAgfV07XG5cbiAgICAvLyBBZGQgbWV0aG9kcyB0byBgTGF6eVdyYXBwZXJgLlxuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5jbG9uZSA9IGxhenlDbG9uZTtcbiAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUucmV2ZXJzZSA9IGxhenlSZXZlcnNlO1xuICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS52YWx1ZSA9IGxhenlWYWx1ZTtcblxuICAgIC8vIEFkZCBjaGFpbiBzZXF1ZW5jZSBtZXRob2RzIHRvIHRoZSBgbG9kYXNoYCB3cmFwcGVyLlxuICAgIGxvZGFzaC5wcm90b3R5cGUuYXQgPSB3cmFwcGVyQXQ7XG4gICAgbG9kYXNoLnByb3RvdHlwZS5jaGFpbiA9IHdyYXBwZXJDaGFpbjtcbiAgICBsb2Rhc2gucHJvdG90eXBlLmNvbW1pdCA9IHdyYXBwZXJDb21taXQ7XG4gICAgbG9kYXNoLnByb3RvdHlwZS5uZXh0ID0gd3JhcHBlck5leHQ7XG4gICAgbG9kYXNoLnByb3RvdHlwZS5wbGFudCA9IHdyYXBwZXJQbGFudDtcbiAgICBsb2Rhc2gucHJvdG90eXBlLnJldmVyc2UgPSB3cmFwcGVyUmV2ZXJzZTtcbiAgICBsb2Rhc2gucHJvdG90eXBlLnRvSlNPTiA9IGxvZGFzaC5wcm90b3R5cGUudmFsdWVPZiA9IGxvZGFzaC5wcm90b3R5cGUudmFsdWUgPSB3cmFwcGVyVmFsdWU7XG5cbiAgICAvLyBBZGQgbGF6eSBhbGlhc2VzLlxuICAgIGxvZGFzaC5wcm90b3R5cGUuZmlyc3QgPSBsb2Rhc2gucHJvdG90eXBlLmhlYWQ7XG5cbiAgICBpZiAoc3ltSXRlcmF0b3IpIHtcbiAgICAgIGxvZGFzaC5wcm90b3R5cGVbc3ltSXRlcmF0b3JdID0gd3JhcHBlclRvSXRlcmF0b3I7XG4gICAgfVxuICAgIHJldHVybiBsb2Rhc2g7XG4gIH0pO1xuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8vIEV4cG9ydCBsb2Rhc2guXG4gIHZhciBfID0gcnVuSW5Db250ZXh0KCk7XG5cbiAgLy8gU29tZSBBTUQgYnVpbGQgb3B0aW1pemVycywgbGlrZSByLmpzLCBjaGVjayBmb3IgY29uZGl0aW9uIHBhdHRlcm5zIGxpa2U6XG4gIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkge1xuICAgIC8vIEV4cG9zZSBMb2Rhc2ggb24gdGhlIGdsb2JhbCBvYmplY3QgdG8gcHJldmVudCBlcnJvcnMgd2hlbiBMb2Rhc2ggaXNcbiAgICAvLyBsb2FkZWQgYnkgYSBzY3JpcHQgdGFnIGluIHRoZSBwcmVzZW5jZSBvZiBhbiBBTUQgbG9hZGVyLlxuICAgIC8vIFNlZSBodHRwOi8vcmVxdWlyZWpzLm9yZy9kb2NzL2Vycm9ycy5odG1sI21pc21hdGNoIGZvciBtb3JlIGRldGFpbHMuXG4gICAgLy8gVXNlIGBfLm5vQ29uZmxpY3RgIHRvIHJlbW92ZSBMb2Rhc2ggZnJvbSB0aGUgZ2xvYmFsIG9iamVjdC5cbiAgICByb290Ll8gPSBfO1xuXG4gICAgLy8gRGVmaW5lIGFzIGFuIGFub255bW91cyBtb2R1bGUgc28sIHRocm91Z2ggcGF0aCBtYXBwaW5nLCBpdCBjYW4gYmVcbiAgICAvLyByZWZlcmVuY2VkIGFzIHRoZSBcInVuZGVyc2NvcmVcIiBtb2R1bGUuXG4gICAgZGVmaW5lKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIF87XG4gICAgfSk7XG4gIH1cbiAgLy8gQ2hlY2sgZm9yIGBleHBvcnRzYCBhZnRlciBgZGVmaW5lYCBpbiBjYXNlIGEgYnVpbGQgb3B0aW1pemVyIGFkZHMgaXQuXG4gIGVsc2UgaWYgKGZyZWVNb2R1bGUpIHtcbiAgICAvLyBFeHBvcnQgZm9yIE5vZGUuanMuXG4gICAgKGZyZWVNb2R1bGUuZXhwb3J0cyA9IF8pLl8gPSBfO1xuICAgIC8vIEV4cG9ydCBmb3IgQ29tbW9uSlMgc3VwcG9ydC5cbiAgICBmcmVlRXhwb3J0cy5fID0gXztcbiAgfVxuICBlbHNlIHtcbiAgICAvLyBFeHBvcnQgdG8gdGhlIGdsb2JhbCBvYmplY3QuXG4gICAgcm9vdC5fID0gXztcbiAgfVxufS5jYWxsKHRoaXMpKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2xpYi9sb2Rhc2guanMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBUUE7OztBQWdKQTs7O0FBdUJBOzs7QUFtRkE7QUFzRUE7QUFrQkE7Ozs7Ozs7QUFtSEE7QUFFQTs7Ozs7OztBQVlBO0FBRUE7Ozs7Ozs7OztBQWNBOzs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7O0FBb0JBOzs7Ozs7OztBQXFCQTs7Ozs7Ozs7O0FBcUJBOzs7Ozs7OztBQXFCQTs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7O0FBY0E7Ozs7Ozs7O0FBcUJBOzs7Ozs7O0FBbUJBOzs7Ozs7Ozs7OztBQXVCQTs7Ozs7Ozs7Ozs7QUF5QkE7Ozs7Ozs7OztBQXFCQTs7Ozs7O0FBbUJBOzs7Ozs7QUFTQTs7Ozs7O0FBV0E7Ozs7Ozs7Ozs7QUFlQTs7Ozs7Ozs7OztBQXNCQTs7Ozs7Ozs7QUFxQkE7Ozs7Ozs7OztBQWdCQTs7Ozs7O0FBbUJBOzs7Ozs7OztBQWFBOzs7Ozs7QUFZQTs7Ozs7O0FBYUE7Ozs7Ozs7Ozs7OztBQW1CQTs7Ozs7Ozs7O0FBbUJBOzs7Ozs7OztBQW1CQTs7Ozs7Ozs7QUF1QkE7Ozs7Ozs7O0FBbUJBOzs7Ozs7QUFhQTs7Ozs7Ozs7O0FBZ0JBOzs7Ozs7O0FBY0E7Ozs7Ozs7O0FBYUE7Ozs7Ozs7O0FBaUJBOzs7Ozs7O0FBZUE7Ozs7Ozs7QUFvQkE7Ozs7OztBQVNBOzs7Ozs7QUFTQTs7Ozs7OztBQVlBOzs7Ozs7QUFXQTs7Ozs7O0FBV0E7Ozs7OztBQVdBOzs7Ozs7QUFpQkE7Ozs7Ozs7QUFrQkE7Ozs7Ozs7O0FBZUE7Ozs7OztBQXVCQTs7Ozs7O0FBaUJBOzs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7OztBQXNCQTs7Ozs7O0FBaUJBOzs7Ozs7QUFhQTs7Ozs7O0FBYUE7Ozs7OztBQVNBOzs7Ozs7QUFlQTs7Ozs7O0FBV0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7QUEwQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd01BOzs7Ozs7O0FBb0JBOzs7O0FBcUJBO0FBSUE7Ozs7OztBQU9BOzs7Ozs7OztBQWlCQTs7Ozs7QUFRQTs7Ozs7QUFRQTs7Ozs7QUFRQTs7Ozs7QUFRQTs7Ozs7QUFRQTs7Ozs7QUFRQTtBQUtBOzs7Ozs7QUFlQTs7Ozs7OztBQWtCQTs7Ozs7OztBQW1CQTs7Ozs7OztBQW9CQTtBQWtEQTs7Ozs7O0FBWUE7Ozs7OztBQWtCQTs7Ozs7Ozs7O0FBZUE7Ozs7Ozs7O0FBZUE7Ozs7Ozs7O0FBa0JBOzs7Ozs7Ozs7QUFlQTtBQVFBOzs7Ozs7QUFlQTs7Ozs7O0FBa0JBOzs7Ozs7OztBQWNBOzs7Ozs7OztBQTBCQTs7Ozs7Ozs7QUFnQkE7Ozs7Ozs7OztBQWNBO0FBY0E7Ozs7OztBQWVBOzs7Ozs7QUFrQkE7Ozs7Ozs7O0FBa0JBOzs7Ozs7OztBQWVBOzs7Ozs7OztBQWFBOzs7Ozs7Ozs7QUFjQTtBQVVBOzs7Ozs7O0FBZ0JBOzs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7O0FBY0E7QUFLQTs7Ozs7O0FBWUE7Ozs7OztBQVlBOzs7Ozs7OztBQWNBOzs7Ozs7OztBQWlCQTs7Ozs7Ozs7QUFhQTs7Ozs7Ozs7O0FBY0E7QUFpQkE7Ozs7Ozs7QUFnQkE7QUFhQTtBQUVBO0FBRUE7QUFFQTs7Ozs7O0FBZUE7Ozs7Ozs7QUFhQTs7Ozs7O0FBV0E7Ozs7Ozs7O0FBYUE7Ozs7Ozs7OztBQWlCQTs7Ozs7OztBQWdCQTs7Ozs7Ozs7OztBQXFCQTs7Ozs7Ozs7QUFnQkE7Ozs7Ozs7O0FBYUE7Ozs7Ozs7O0FBYUE7Ozs7Ozs7QUFxQkE7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7QUEyQ0E7QUFrQkE7Ozs7OztBQVlBOzs7Ozs7O0FBZUE7Ozs7Ozs7OztBQTRCQTs7Ozs7Ozs7OztBQWtCQTs7Ozs7OztBQXFEQTs7Ozs7OztBQVVBOzs7Ozs7OztBQVdBOzs7Ozs7Ozs7QUFtQkE7Ozs7Ozs7OztBQTZCQTs7Ozs7OztBQTBCQTs7Ozs7Ozs7OztBQXFCQTtBQVlBOzs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7QUFZQTs7Ozs7OztBQVVBOzs7Ozs7O0FBWUE7Ozs7Ozs7O0FBYUE7Ozs7Ozs7QUFjQTs7Ozs7Ozs7OztBQXVCQTs7Ozs7O0FBWUE7Ozs7Ozs7O0FBa0JBOzs7Ozs7O0FBWUE7Ozs7Ozs7QUFZQTs7Ozs7Ozs7QUFhQTs7Ozs7Ozs7O0FBY0E7Ozs7Ozs7Ozs7QUFnRUE7Ozs7Ozs7OztBQWlCQTs7Ozs7O0FBY0E7Ozs7OztBQVdBOzs7Ozs7QUFXQTs7Ozs7Ozs7Ozs7OztBQWtCQTs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7O0FBb0RBOzs7Ozs7Ozs7QUFjQTs7Ozs7OztBQW9EQTs7Ozs7O0FBZUE7Ozs7OztBQVdBOzs7Ozs7QUFXQTs7Ozs7O0FBWUE7QUFFQTtBQUNBOzs7Ozs7QUFxQkE7Ozs7OztBQW9CQTs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7QUFZQTs7Ozs7O0FBaUJBOzs7Ozs7O0FBa0JBOzs7Ozs7Ozs7O0FBdUJBOzs7Ozs7Ozs7Ozs7OztBQXFDQTtBQXVEQTs7Ozs7OztBQWVBOzs7Ozs7OztBQWtCQTs7Ozs7Ozs7QUF5QkE7Ozs7Ozs7O0FBZUE7Ozs7OztBQXVCQTs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7QUFvQ0E7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7O0FBZUE7Ozs7Ozs7QUFvQkE7QUFNQTtBQUNBOzs7Ozs7O0FBcUJBOzs7Ozs7QUFXQTs7Ozs7OztBQVlBOzs7Ozs7Ozs7QUFlQTs7Ozs7OztBQXNDQTs7Ozs7OztBQWFBOzs7Ozs7QUFnQkE7Ozs7Ozs7O0FBYUE7Ozs7Ozs7O0FBOEJBOzs7Ozs7Ozs7OztBQXNCQTs7Ozs7Ozs7Ozs7O0FBa0NBOzs7Ozs7OztBQWlEQTs7Ozs7OztBQTBCQTs7Ozs7OztBQWtCQTtBQUVBO0FBS0E7Ozs7Ozs7O0FBa0JBOzs7Ozs7O0FBNERBOzs7Ozs7Ozs7QUFnQkE7Ozs7Ozs7Ozs7QUFlQTs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7O0FBOEJBOzs7Ozs7QUFvQkE7Ozs7OztBQVdBOzs7Ozs7O0FBWUE7Ozs7Ozs7O0FBZ0JBOzs7Ozs7OztBQVdBOzs7OztBQVlBOzs7Ozs7O0FBWUE7Ozs7OztBQWtCQTs7Ozs7OztBQWNBOzs7Ozs7OztBQWNBOzs7Ozs7QUFZQTs7Ozs7Ozs7QUFlQTs7Ozs7O0FBWUE7Ozs7Ozs7QUFZQTs7Ozs7OztBQWFBOzs7Ozs7Ozs7Ozs7O0FBNENBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FBY0E7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7Ozs7QUFrQ0E7Ozs7Ozs7OztBQXFCQTs7Ozs7OztBQWtDQTs7Ozs7OztBQVlBOzs7Ozs7O0FBWUE7Ozs7OztBQWdCQTs7Ozs7OztBQWtDQTs7Ozs7O0FBNEJBOzs7Ozs7Ozs7QUEyQkE7Ozs7OztBQWtCQTs7Ozs7O0FBMkJBOzs7Ozs7O0FBY0E7QUFHQTtBQUNBO0FBQ0E7QUFlQTtBQUNBOzs7Ozs7OztBQWFBOzs7Ozs7QUFtQ0E7Ozs7OztBQW9CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUVBOzs7Ozs7O0FBOERBOzs7Ozs7O0FBY0E7Ozs7OztBQWlDQTs7Ozs7Ozs7QUFxQkE7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7QUE4QkE7QUFNQTs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7QUFpQ0E7QUFPQTtBQUNBOzs7Ozs7QUFpQkE7Ozs7OztBQVdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQ0E7Ozs7Ozs7Ozs7O0FBbUVBOzs7Ozs7Ozs7Ozs7O0FBc0JBO0FBR0E7Ozs7Ozs7O0FBZ0JBOzs7Ozs7Ozs7Ozs7QUFpQkE7QUFTQTtBQVlBO0FBaUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBd0NBO0FBcUJBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFhQTtBQU9BOzs7Ozs7Ozs7Ozs7QUEwQkE7QUFrQkE7QUFvQkE7QUFjQTs7Ozs7O0FBbUJBOzs7Ozs7QUFXQTs7Ozs7OztBQVlBOzs7Ozs7QUFXQTs7Ozs7O0FBV0E7Ozs7OztBQXNCQTs7Ozs7Ozs7OztBQWdCQTs7Ozs7OztBQWNBOzs7Ozs7QUFjQTs7Ozs7OztBQXFCQTs7Ozs7O0FBWUE7Ozs7OztBQTJCQTs7Ozs7O0FBaUJBOzs7Ozs7QUFnQkE7QUFHQTs7Ozs7Ozs7O0FBaUNBOzs7Ozs7QUF5QkE7Ozs7Ozs7O0FBY0E7Ozs7OztBQTZCQTtBQUtBOzs7Ozs7QUFjQTs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7O0FBNENBOzs7Ozs7QUFrQkE7Ozs7Ozs7QUFhQTs7Ozs7Ozs7O0FBaUJBOzs7Ozs7O0FBc0JBOzs7Ozs7QUFvQkE7Ozs7Ozs7QUFlQTs7Ozs7O0FBcUJBOzs7Ozs7QUFXQTs7Ozs7O0FBU0E7Ozs7Ozs7QUFlQTs7Ozs7Ozs7QUFhQTs7Ozs7OztBQWtCQTs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBO0FBWUE7QUFJQTtBQUdBO0FBR0E7QUFPQTtBQU9BO0FBS0E7QUFJQTtBQUlBOzs7Ozs7OztBQWVBOzs7Ozs7QUFpQkE7Ozs7Ozs7O0FBYUE7Ozs7Ozs7QUE2QkE7Ozs7Ozs7OztBQWNBOzs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7O0FBVUE7Ozs7Ozs7QUFZQTs7Ozs7Ozs7O0FBWUE7Ozs7Ozs7O0FBY0E7Ozs7Ozs7QUE0QkE7Ozs7OztBQXdCQTs7Ozs7O0FBa0JBOzs7Ozs7QUFlQTs7Ozs7OztBQW9CQTs7Ozs7O0FBaUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDQTs7Ozs7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0NBOzs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUNBOzs7Ozs7Ozs7Ozs7OztBQTRCQTs7Ozs7Ozs7Ozs7OztBQWtCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNENBOzs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOzs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUNBOzs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTs7Ozs7Ozs7Ozs7Ozs7QUFtQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtREE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0NBOzs7Ozs7Ozs7Ozs7O0FBZ0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpREE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUNBOzs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUNBOzs7Ozs7Ozs7Ozs7Ozs7QUErQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOEJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBdUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2REE7QUFtQ0E7QUFFQTtBQUVBO0FBZ0JBO0FBQ0E7QUFDQTtBQVVBO0FBT0E7QUFDQTtBQWlDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnREE7QUFxQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMENBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNERBOzs7Ozs7Ozs7Ozs7OztBQWlDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQXVCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0NBOzs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1DQTs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQTtBQUtBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUNBO0FBRUE7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOEJBOzs7Ozs7Ozs7Ozs7Ozs7OztBQTBCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5Q0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1DQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBDQTs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQ0E7QUFPQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWdDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrREE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQStCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkRBOzs7Ozs7Ozs7Ozs7OztBQW9CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBDQTs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBOzs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMENBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0hBO0FBRUE7QUFDQTtBQUNBO0FBbUJBO0FBUUE7QUFVQTtBQUdBO0FBY0E7QUFDQTtBQU1BO0FBQ0E7QUFLQTtBQUtBO0FBd0JBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbURBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUJBOzs7Ozs7Ozs7Ozs7Ozs7QUFrQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOENBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBDQTs7Ozs7Ozs7Ozs7O0FBaURBOzs7Ozs7Ozs7OztBQW1CQTtBQUlBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOzs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0NBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7Ozs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7Ozs7O0FBaUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3QkE7Ozs7Ozs7Ozs7Ozs7O0FBc0JBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCQTs7Ozs7Ozs7Ozs7OztBQW9CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7Ozs7Ozs7Ozs7Ozs7O0FBcUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7Ozs7Ozs7QUFrQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7QUFTQTtBQXVKQTtBQU1BO0FBS0E7QUF1SkE7Ozs7OztBQXVCQTtBQUdBO0FBS0E7QUF5QkE7QUFnQkE7QUFTQTtBQTZEQTtBQXVCQTtBQXNCQTtBQWtCQTtBQWdCQTtBQUtBO0FBU0E7QUFXQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQUE7QUFUQTtBQWdCQTtBQUVBO0FBSUE7QSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar FactionIDs = {\n    AEDUI: 'Aedui',\n    ARVERNI: 'Arverni',\n    BELGAE: 'Belgae',\n    ROMANS: 'Romans',\n    GERMANIC_TRIBES: 'Germanic'\n};\n\nexports.default = FactionIDs;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9jb25maWcvZmFjdGlvbklkcy5qcz9jZDJiIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEZhY3Rpb25JRHMgPSB7XG4gICAgQUVEVUk6ICdBZWR1aScsXG4gICAgQVJWRVJOSTogJ0FydmVybmknLFxuICAgIEJFTEdBRTogJ0JlbGdhZScsXG4gICAgUk9NQU5TOiAnUm9tYW5zJyxcbiAgICBHRVJNQU5JQ19UUklCRVM6ICdHZXJtYW5pYydcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEZhY3Rpb25JRHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbmZpZy9mYWN0aW9uSWRzLmpzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFPQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar CommandIDs = {\n    BATTLE: 'Battle',\n    MARCH: 'March',\n    RAID: 'Raid',\n    RALLY: 'Rally',\n    RECRUIT: 'Recruit',\n    SEIZE: 'Seize'\n};\n\nexports.default = CommandIDs;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9jb25maWcvY29tbWFuZElkcy5qcz83MjI5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENvbW1hbmRJRHMgPSB7XG4gICAgQkFUVExFOiAnQmF0dGxlJyxcbiAgICBNQVJDSDogJ01hcmNoJyxcbiAgICBSQUlEOiAnUmFpZCcsXG4gICAgUkFMTFk6ICdSYWxseScsXG4gICAgUkVDUlVJVDogJ1JlY3J1aXQnLFxuICAgIFNFSVpFOiAnU2VpemUnXG59O1xuXG5leHBvcnQgZGVmYXVsdCBDb21tYW5kSURzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb25maWcvY29tbWFuZElkcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar FactionActions = {\n    EVENT: 'Event',\n    COMMAND: 'Command',\n    COMMAND_AND_SPECIAL: 'Command and Special',\n    LIMITED_COMMAND: 'Limited Command',\n    PASS: 'Pass'\n};\n\nexports.default = FactionActions;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvY29tbW9uL2ZhY3Rpb25BY3Rpb25zLmpzP2ZkZjkiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgRmFjdGlvbkFjdGlvbnMgPSB7XG4gICAgRVZFTlQ6ICdFdmVudCcsXG4gICAgQ09NTUFORDogJ0NvbW1hbmQnLFxuICAgIENPTU1BTkRfQU5EX1NQRUNJQUw6ICdDb21tYW5kIGFuZCBTcGVjaWFsJyxcbiAgICBMSU1JVEVEX0NPTU1BTkQ6ICdMaW1pdGVkIENvbW1hbmQnLFxuICAgIFBBU1M6ICdQYXNzJ1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRmFjdGlvbkFjdGlvbnM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb21tb24vZmFjdGlvbkFjdGlvbnMuanMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RemoveResources = function (_Action) {\n    _inherits(RemoveResources, _Action);\n\n    function RemoveResources(args) {\n        _classCallCheck(this, RemoveResources);\n\n        var _this = _possibleConstructorReturn(this, (RemoveResources.__proto__ || Object.getPrototypeOf(RemoveResources)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.count = args.count;\n        _this.removed = args.removed;\n        _this.numAfter = args.numAfter;\n        return _this;\n    }\n\n    _createClass(RemoveResources, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var count = this.count;\n\n            this.removed = faction.removeResources(count);\n            this.numAfter = faction.resources();\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n\n            faction.addResources(this.removed);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            return ['Decrease ' + faction.name + ' resources by ' + this.removed + ' to ' + this.numAfter];\n        }\n    }]);\n\n    return RemoveResources;\n}(_action2.default);\n\nexports.default = RemoveResources;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9hY3Rpb25zL3JlbW92ZVJlc291cmNlcy5qcz85OWNkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBY3Rpb24gZnJvbSAnLi9hY3Rpb24nO1xuXG5jbGFzcyBSZW1vdmVSZXNvdXJjZXMgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLmNvdW50ID0gYXJncy5jb3VudDtcbiAgICAgICAgdGhpcy5yZW1vdmVkID0gYXJncy5yZW1vdmVkO1xuICAgICAgICB0aGlzLm51bUFmdGVyID0gYXJncy5udW1BZnRlcjtcbiAgICB9XG5cbiAgICBkb0V4ZWN1dGUoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcblxuICAgICAgICB0aGlzLnJlbW92ZWQgPSBmYWN0aW9uLnJlbW92ZVJlc291cmNlcyhjb3VudCk7XG4gICAgICAgIHRoaXMubnVtQWZ0ZXIgPSBmYWN0aW9uLnJlc291cmNlcygpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcblxuICAgICAgICBmYWN0aW9uLmFkZFJlc291cmNlcyh0aGlzLnJlbW92ZWQpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgcmV0dXJuIFsnRGVjcmVhc2UgJyArIGZhY3Rpb24ubmFtZSArICcgcmVzb3VyY2VzIGJ5ICcgKyB0aGlzLnJlbW92ZWQgKyAnIHRvICcgKyB0aGlzLm51bUFmdGVyXTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVtb3ZlUmVzb3VyY2VzXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar RegionIds = {\n    AEDUI: 'Aedui',\n    AQUITANIA: 'Aquitania',\n    ARVERNI: 'Arverni',\n    ATREBATES: 'Atrebates',\n    BITURIGES: 'Bituriges',\n    BRITANNIA: 'Britannia',\n    CARNUTES: 'Carnutes',\n    CISALPINA: 'Cisalpina',\n    MANDUBII: 'Mandubii',\n    MORINI: 'Morini',\n    NERVII: 'Nervii',\n    PICTONES: 'Pictones',\n    PROVINCIA: 'Provincia',\n    SEQUANI: 'Sequani',\n    SUGAMBRI: 'Sugambri',\n    TREVERI: 'Treveri',\n    UBII: 'Ubii',\n    VENETI: 'Veneti'\n};\n\nexports.default = RegionIds;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9jb25maWcvcmVnaW9uSWRzLmpzPzZmYjYiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUmVnaW9uSWRzID0ge1xuICAgIEFFRFVJOiAnQWVkdWknLFxuICAgIEFRVUlUQU5JQTogJ0FxdWl0YW5pYScsXG4gICAgQVJWRVJOSTogJ0FydmVybmknLFxuICAgIEFUUkVCQVRFUzogJ0F0cmViYXRlcycsXG4gICAgQklUVVJJR0VTOiAnQml0dXJpZ2VzJyxcbiAgICBCUklUQU5OSUE6ICdCcml0YW5uaWEnLFxuICAgIENBUk5VVEVTOiAnQ2FybnV0ZXMnLFxuICAgIENJU0FMUElOQTogJ0Npc2FscGluYScsXG4gICAgTUFORFVCSUk6ICdNYW5kdWJpaScsXG4gICAgTU9SSU5JOiAnTW9yaW5pJyxcbiAgICBORVJWSUk6ICdOZXJ2aWknLFxuICAgIFBJQ1RPTkVTOiAnUGljdG9uZXMnLFxuICAgIFBST1ZJTkNJQTogJ1Byb3ZpbmNpYScsXG4gICAgU0VRVUFOSTogJ1NlcXVhbmknLFxuICAgIFNVR0FNQlJJOiAnU3VnYW1icmknLFxuICAgIFRSRVZFUkk6ICdUcmV2ZXJpJyxcbiAgICBVQklJOiAnVWJpaScsXG4gICAgVkVORVRJOiAnVmVuZXRpJ1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUmVnaW9uSWRzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb25maWcvcmVnaW9uSWRzLmpzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbEJBO0FBQ0E7QUFvQkEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _CapabilityTitles;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar CapabilityStates = {\n    SHADED: 'shaded',\n    UNSHADED: 'unshaded'\n};\n\nvar CapabilityIDs = {\n    AQUITANI: 25,\n    BAGGAGE_TRAINS: 8,\n    BALEARIC_SLINGERS: 13,\n    BALLISTAE: 10,\n    COMMIUS: 55,\n    CONVICTOLITAVIS: 43,\n    GERMANIC_HORSE: 59,\n    LEGIO_X: 15,\n    MASSED_GALLIC_ARCHERS: 27,\n    TITUS_LABIENUS: 12,\n    VERCINGETORIXS_ELITE: 30\n};\n\nvar CapabilityTitles = (_CapabilityTitles = {}, _defineProperty(_CapabilityTitles, CapabilityIDs.AQUITANI, 'Aquitani'), _defineProperty(_CapabilityTitles, CapabilityIDs.BAGGAGE_TRAINS, 'Baggage Trains'), _defineProperty(_CapabilityTitles, CapabilityIDs.BALEARIC_SLINGERS, 'Balearic Slingers'), _defineProperty(_CapabilityTitles, CapabilityIDs.BALLISTAE, 'Ballistae'), _defineProperty(_CapabilityTitles, CapabilityIDs.COMMIUS, 'Commius'), _defineProperty(_CapabilityTitles, CapabilityIDs.CONVICTOLITAVIS, 'Convictolitavis'), _defineProperty(_CapabilityTitles, CapabilityIDs.GERMANIC_HORSE, 'Germanic Horse'), _defineProperty(_CapabilityTitles, CapabilityIDs.LEGIO_X, 'Legio X'), _defineProperty(_CapabilityTitles, CapabilityIDs.MASSED_GALLIC_ARCHERS, 'Massed Gallic Archers'), _defineProperty(_CapabilityTitles, CapabilityIDs.TITUS_LABIENUS, 'Titus Labienus'), _defineProperty(_CapabilityTitles, CapabilityIDs.VERCINGETORIXS_ELITE, 'Vercingetorix\\'s Elite'), _CapabilityTitles);\n\nexports.CapabilityStates = CapabilityStates;\nexports.CapabilityIDs = CapabilityIDs;\nexports.CapabilityTitles = CapabilityTitles;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9jb25maWcvY2FwYWJpbGl0aWVzLmpzPzJlMWMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQ2FwYWJpbGl0eVN0YXRlcyA9IHtcbiAgICBTSEFERUQ6ICdzaGFkZWQnLFxuICAgIFVOU0hBREVEOiAndW5zaGFkZWQnXG59O1xuXG5jb25zdCBDYXBhYmlsaXR5SURzID0ge1xuICAgIEFRVUlUQU5JOiAyNSxcbiAgICBCQUdHQUdFX1RSQUlOUzogOCxcbiAgICBCQUxFQVJJQ19TTElOR0VSUzogMTMsXG4gICAgQkFMTElTVEFFOiAxMCxcbiAgICBDT01NSVVTOiA1NSxcbiAgICBDT05WSUNUT0xJVEFWSVM6IDQzLFxuICAgIEdFUk1BTklDX0hPUlNFOiA1OSxcbiAgICBMRUdJT19YOiAxNSxcbiAgICBNQVNTRURfR0FMTElDX0FSQ0hFUlM6IDI3LFxuICAgIFRJVFVTX0xBQklFTlVTOiAxMixcbiAgICBWRVJDSU5HRVRPUklYU19FTElURTogMzBcbn07XG5cbmNvbnN0IENhcGFiaWxpdHlUaXRsZXMgPSB7XG4gICAgW0NhcGFiaWxpdHlJRHMuQVFVSVRBTkldIDogJ0FxdWl0YW5pJyxcbiAgICBbQ2FwYWJpbGl0eUlEcy5CQUdHQUdFX1RSQUlOU106ICdCYWdnYWdlIFRyYWlucycsXG4gICAgW0NhcGFiaWxpdHlJRHMuQkFMRUFSSUNfU0xJTkdFUlNdOiAnQmFsZWFyaWMgU2xpbmdlcnMnLFxuICAgIFtDYXBhYmlsaXR5SURzLkJBTExJU1RBRV06ICdCYWxsaXN0YWUnLFxuICAgIFtDYXBhYmlsaXR5SURzLkNPTU1JVVNdOiAnQ29tbWl1cycsXG4gICAgW0NhcGFiaWxpdHlJRHMuQ09OVklDVE9MSVRBVklTXTogJ0NvbnZpY3RvbGl0YXZpcycsXG4gICAgW0NhcGFiaWxpdHlJRHMuR0VSTUFOSUNfSE9SU0VdOiAnR2VybWFuaWMgSG9yc2UnLFxuICAgIFtDYXBhYmlsaXR5SURzLkxFR0lPX1hdOiAnTGVnaW8gWCcsXG4gICAgW0NhcGFiaWxpdHlJRHMuTUFTU0VEX0dBTExJQ19BUkNIRVJTXTogJ01hc3NlZCBHYWxsaWMgQXJjaGVycycsXG4gICAgW0NhcGFiaWxpdHlJRHMuVElUVVNfTEFCSUVOVVNdOiAnVGl0dXMgTGFiaWVudXMnLFxuICAgIFtDYXBhYmlsaXR5SURzLlZFUkNJTkdFVE9SSVhTX0VMSVRFXTogJ1ZlcmNpbmdldG9yaXhcXCdzIEVsaXRlJ1xufTtcblxuZXhwb3J0IHtcbiAgICBDYXBhYmlsaXR5U3RhdGVzLFxuICAgIENhcGFiaWxpdHlJRHMsXG4gICAgQ2FwYWJpbGl0eVRpdGxlc1xufVxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29uZmlnL2NhcGFiaWxpdGllcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQWNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Action = function () {\n    function Action(args) {\n        _classCallCheck(this, Action);\n    }\n\n    _createClass(Action, [{\n        key: 'execute',\n        value: function execute(state) {\n            this.doExecute(state);\n            state.actionHistory.addAction(this);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo() {}\n    }, {\n        key: 'doExecute',\n        value: function doExecute() {}\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            return [];\n        }\n    }], [{\n        key: 'execute',\n        value: function execute(state, args) {\n            var action = new this(args);\n            action.execute(state);\n        }\n    }]);\n\n    return Action;\n}();\n\nexports.default = Action;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9hY3Rpb25zL2FjdGlvbi5qcz85MWY5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuXG5jbGFzcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuXG4gICAgfVxuXG4gICAgc3RhdGljIGV4ZWN1dGUoc3RhdGUsIGFyZ3MpIHtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gbmV3IHRoaXMoYXJncyk7XG4gICAgICAgIGFjdGlvbi5leGVjdXRlKHN0YXRlKTtcbiAgICB9XG5cbiAgICBleGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuZG9FeGVjdXRlKHN0YXRlKTtcbiAgICAgICAgc3RhdGUuYWN0aW9uSGlzdG9yeS5hZGRBY3Rpb24odGhpcyk7XG4gICAgfVxuXG4gICAgZG9VbmRvKCkge1xuXG4gICAgfVxuXG5cbiAgICBkb0V4ZWN1dGUoKSB7XG5cbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBBY3Rpb247XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2FjdGlvbnMvYWN0aW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUVBO0FBQUE7QUFFQTtBQUNBOzs7QUFNQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7OztBQUtBOzs7QUFJQTtBQUNBO0FBQ0E7OztBQXJCQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBc0JBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RemovePieces = function (_Action) {\n    _inherits(RemovePieces, _Action);\n\n    function RemovePieces(args) {\n        _classCallCheck(this, RemovePieces);\n\n        var _this = _possibleConstructorReturn(this, (RemovePieces.__proto__ || Object.getPrototypeOf(RemovePieces)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.pieces = args.pieces;\n        _this.removalData = args.removalData;\n        return _this;\n    }\n\n    _createClass(RemovePieces, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var pieces = this.pieces;\n\n            if (!pieces || pieces.length === 0) {\n                throw 'No pieces specified for remove';\n            }\n\n            this.removalData = this.getRemovalData(pieces);\n            region.removePieces(pieces);\n\n            console.log('Removing the following ' + faction.name + ' pieces from region ' + region.name);\n            _logging2.default.logPieces(pieces);\n\n            (0, _lodash2.default)(pieces).groupBy('type').each(function (piecesOfType, type) {\n                if (type === 'warband') {\n                    faction.returnWarbands(piecesOfType);\n                } else if (type === 'alliedtribe') {\n                    _lodash2.default.each(piecesOfType, function (piece) {\n                        var tribe = state.tribesById[piece.tribeId];\n                        tribe.removeAlly(piece);\n                    });\n                    faction.returnAlliedTribes(piecesOfType);\n                } else if (type === 'citadel') {\n                    var piece = piecesOfType[0];\n                    var tribe = state.tribesById[piece.tribeId];\n                    tribe.removeAlly(piece);\n                    faction.returnCitadel(piece);\n                } else if (type === 'auxilia') {\n                    faction.returnAuxilia(piecesOfType);\n                } else if (type === 'legion') {\n                    faction.returnLegions(piecesOfType);\n                } else if (type === 'fort') {\n                    faction.returnFort(piecesOfType[0]);\n                } else if (type === 'leader') {\n                    faction.returnLeader(piecesOfType[0]);\n                }\n            });\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            (0, _lodash2.default)(this.removalData).each(function (pieceTypeData, type) {\n                if (type === 'warband') {\n                    _lodash2.default.each(pieceTypeData.data, function (count, status) {\n                        var warbands = faction.removeWarbands(count);\n                        if (status === 'revealed' || status === 'scouted') {\n                            _lodash2.default.each(warbands, function (warband) {\n                                warband.revealed(true);\n                                if (status === 'scouted') {\n                                    warband.scouted(true);\n                                }\n                            });\n                        }\n                        console.log('Adding back ' + count + 'x ' + status + ' ' + faction.name + ' Warbands to ' + region.name);\n                        region.addPieces(warbands);\n                    });\n                } else if (type === 'alliedtribe') {\n                    _lodash2.default.each(pieceTypeData.data, function (tribeId) {\n                        var alliedTribe = faction.removeAlliedTribe();\n                        var tribe = state.tribesById[tribeId];\n                        tribe.makeAllied(alliedTribe);\n                        region.addPiece(alliedTribe);\n                        console.log('Adding back ' + faction.name + ' Ally to ' + tribe.name + ' in ' + region.name);\n                    });\n                } else if (type === 'citadel') {\n                    var tribe = state.tribesById[pieceTypeData.data];\n                    var citadel = faction.removeCitadel();\n                    tribe.buildCitadel(citadel);\n                    region.addPiece(citadel);\n                    console.log('Adding back ' + faction.name + ' Citadel to ' + tribe.name + ' in ' + region.name);\n                } else if (type === 'auxilia') {\n                    _lodash2.default.each(pieceTypeData.data, function (count, status) {\n                        var auxilias = faction.removeAuxilia(count);\n                        if (status === 'revealed') {\n                            _lodash2.default.each(auxilias, function (auxilia) {\n                                auxilia.revealed(true);\n                            });\n                        }\n                        console.log('Adding back ' + count + 'x ' + status + ' ' + faction.name + ' Auxilia to ' + region.name);\n                        region.addPieces(auxilias);\n                    });\n                } else if (type === 'legion') {\n                    var legions = faction.getLegionsFromFallen(pieceTypeData.data);\n                    console.log('Adding back ' + pieceTypeData.data + 'x Roman Legions to ' + region.name);\n                    region.addPieces(legions);\n                } else if (type === 'fort') {\n                    console.log('Adding back Roman Fort to ' + region.name);\n                    region.addPiece(faction.removeFort());\n                } else if (type === 'leader') {\n                    var leader = faction.removeLeader();\n                    leader.successor = pieceTypeData.data.successor;\n                    region.addPiece(leader);\n                    console.log('Adding back ' + leader.toString() + ' to ' + region.name);\n                }\n            });\n        }\n    }, {\n        key: 'getRemovalData',\n        value: function getRemovalData(pieces) {\n            return (0, _lodash2.default)(pieces).groupBy('type').map(function (piecesOfType, type) {\n                if (type === 'warband') {\n                    return {\n                        type: type,\n                        data: _lodash2.default.countBy(piecesOfType, function (warband) {\n                            return warband.status();\n                        })\n                    };\n                } else if (type === 'alliedtribe') {\n                    return {\n                        type: type,\n                        data: _lodash2.default.map(piecesOfType, function (alliedTribe) {\n                            return alliedTribe.tribeId;\n                        })\n                    };\n                } else if (type === 'citadel') {\n                    var piece = piecesOfType[0];\n                    return {\n                        type: type,\n                        data: piece.tribeId\n                    };\n                } else if (type === 'auxilia') {\n                    return {\n                        type: type,\n                        data: _lodash2.default.countBy(piecesOfType, function (auxilia) {\n                            return auxilia.status();\n                        })\n                    };\n                } else if (type === 'legion') {\n                    return {\n                        type: type,\n                        data: piecesOfType.length\n                    };\n                } else if (type === 'fort') {\n                    return {\n                        type: type,\n                        data: piecesOfType.length\n                    };\n                } else if (type === 'leader') {\n                    return {\n                        type: type,\n                        data: {\n                            successor: piecesOfType[0].isSuccessor(),\n                            title: piecesOfType[0].toString()\n                        }\n                    };\n                }\n            }).keyBy('type').value();\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var removalData = this.removalData;\n\n            return (0, _lodash2.default)(removalData).map(function (pieceTypeData, type) {\n                if (type === 'warband') {\n                    return 'Remove ' + (pieceTypeData.data.scouted ? pieceTypeData.data.scouted + 'x scouted ' : '') + (pieceTypeData.data.revealed ? pieceTypeData.data.revealed + 'x revealed ' : '') + (pieceTypeData.data.hidden ? pieceTypeData.data.hidden + 'x hidden ' : '') + faction.name + ' Warbands from ' + region.name;\n                } else if (type === 'fort') {\n                    return 'Remove Roman Fort from ' + region.name;\n                } else if (type === 'legion') {\n                    return 'Remove ' + pieceTypeData.data + 'x Legions from ' + region.name;\n                } else if (type === 'auxilia') {\n                    return 'Remove ' + (pieceTypeData.data.revealed ? pieceTypeData.data.revealed + 'x revealed ' : '') + (pieceTypeData.data.hidden ? pieceTypeData.data.hidden + 'x hidden ' : '') + faction.name + ' Auxilia from ' + region.name;\n                } else if (type === 'leader') {\n                    return 'Remove ' + pieceTypeData.data.title + ' from ' + region.name;\n                } else if (type === 'alliedtribe') {\n                    return 'Remove ' + pieceTypeData.data.length + 'x ' + faction.name + ' Allies' + ' from ' + _lodash2.default.join(pieceTypeData.data) + ' in ' + region.name;\n                } else if (type === 'citadel') {\n                    return 'Remove ' + faction.name + ' Citadel' + ' from ' + pieceTypeData.data + ' in ' + region.name;\n                }\n            }).compact().value();\n        }\n    }]);\n\n    return RemovePieces;\n}(_action2.default);\n\nexports.default = RemovePieces;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9hY3Rpb25zL3JlbW92ZVBpZWNlcy5qcz8yNDI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMb2dnaW5nIGZyb20gJy4uL3V0aWwvbG9nZ2luZyc7XG5pbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcbmltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuXG5jbGFzcyBSZW1vdmVQaWVjZXMgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gYXJncy5yZWdpb25JZDtcbiAgICAgICAgdGhpcy5waWVjZXMgPSBhcmdzLnBpZWNlcztcbiAgICAgICAgdGhpcy5yZW1vdmFsRGF0YSA9IGFyZ3MucmVtb3ZhbERhdGE7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgcGllY2VzID0gdGhpcy5waWVjZXM7XG5cbiAgICAgICAgaWYgKCFwaWVjZXMgfHwgcGllY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgJ05vIHBpZWNlcyBzcGVjaWZpZWQgZm9yIHJlbW92ZSdcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVtb3ZhbERhdGEgPSB0aGlzLmdldFJlbW92YWxEYXRhKHBpZWNlcyk7XG4gICAgICAgIHJlZ2lvbi5yZW1vdmVQaWVjZXMocGllY2VzKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnUmVtb3ZpbmcgdGhlIGZvbGxvd2luZyAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgZnJvbSByZWdpb24gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgTG9nZ2luZy5sb2dQaWVjZXMocGllY2VzKTtcblxuICAgICAgICBfKHBpZWNlcykuZ3JvdXBCeSgndHlwZScpLmVhY2goXG4gICAgICAgICAgICAocGllY2VzT2ZUeXBlLCB0eXBlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd3YXJiYW5kJykge1xuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uLnJldHVybldhcmJhbmRzKHBpZWNlc09mVHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdhbGxpZWR0cmliZScpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzT2ZUeXBlLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmliZSA9IHN0YXRlLnRyaWJlc0J5SWRbcGllY2UudHJpYmVJZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpYmUucmVtb3ZlQWxseShwaWVjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbi5yZXR1cm5BbGxpZWRUcmliZXMocGllY2VzT2ZUeXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NpdGFkZWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlID0gcGllY2VzT2ZUeXBlWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmliZSA9IHN0YXRlLnRyaWJlc0J5SWRbcGllY2UudHJpYmVJZF07XG4gICAgICAgICAgICAgICAgICAgIHRyaWJlLnJlbW92ZUFsbHkocGllY2UpO1xuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uLnJldHVybkNpdGFkZWwocGllY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnYXV4aWxpYScpIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbi5yZXR1cm5BdXhpbGlhKHBpZWNlc09mVHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdsZWdpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb24ucmV0dXJuTGVnaW9ucyhwaWVjZXNPZlR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZm9ydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbi5yZXR1cm5Gb3J0KHBpZWNlc09mVHlwZVswXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdsZWFkZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb24ucmV0dXJuTGVhZGVyKHBpZWNlc09mVHlwZVswXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBfKHRoaXMucmVtb3ZhbERhdGEpLmVhY2goKHBpZWNlVHlwZURhdGEsdHlwZSkgPT4ge1xuICAgICAgICAgICAgaWYodHlwZSA9PT0gJ3dhcmJhbmQnKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHBpZWNlVHlwZURhdGEuZGF0YSwgKGNvdW50LCBzdGF0dXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FyYmFuZHMgPSBmYWN0aW9uLnJlbW92ZVdhcmJhbmRzKGNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYoc3RhdHVzID09PSAncmV2ZWFsZWQnIHx8IHN0YXR1cyA9PT0gJ3Njb3V0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2god2FyYmFuZHMsICh3YXJiYW5kKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FyYmFuZC5yZXZlYWxlZCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzdGF0dXMgPT09ICdzY291dGVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJiYW5kLnNjb3V0ZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWRkaW5nIGJhY2sgJyArIGNvdW50ICsgJ3ggJyArIHN0YXR1cyArICcgJyArIGZhY3Rpb24ubmFtZSArICcgV2FyYmFuZHMgdG8gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uLmFkZFBpZWNlcyh3YXJiYW5kcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHR5cGUgPT09ICdhbGxpZWR0cmliZScpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2gocGllY2VUeXBlRGF0YS5kYXRhLCAodHJpYmVJZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxpZWRUcmliZSA9IGZhY3Rpb24ucmVtb3ZlQWxsaWVkVHJpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJpYmUgPSBzdGF0ZS50cmliZXNCeUlkW3RyaWJlSWRdO1xuICAgICAgICAgICAgICAgICAgICB0cmliZS5tYWtlQWxsaWVkKGFsbGllZFRyaWJlKTtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uLmFkZFBpZWNlKGFsbGllZFRyaWJlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FkZGluZyBiYWNrICcgKyBmYWN0aW9uLm5hbWUgKyAnIEFsbHkgdG8gJyArIHRyaWJlLm5hbWUgKyAnIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFtwaWVjZVR5cGVEYXRhLmRhdGFdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNpdGFkZWwgPSBmYWN0aW9uLnJlbW92ZUNpdGFkZWwoKTtcbiAgICAgICAgICAgICAgICB0cmliZS5idWlsZENpdGFkZWwoY2l0YWRlbCk7XG4gICAgICAgICAgICAgICAgcmVnaW9uLmFkZFBpZWNlKGNpdGFkZWwpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgYmFjayAnICsgZmFjdGlvbi5uYW1lICsgJyBDaXRhZGVsIHRvICcgKyB0cmliZS5uYW1lICsgJyBpbiAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0eXBlID09PSAnYXV4aWxpYScpIHtcbiAgICAgICAgICAgICAgICAgXy5lYWNoKHBpZWNlVHlwZURhdGEuZGF0YSwgKGNvdW50LCBzdGF0dXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXV4aWxpYXMgPSBmYWN0aW9uLnJlbW92ZUF1eGlsaWEoY291bnQpO1xuICAgICAgICAgICAgICAgICAgICBpZihzdGF0dXMgPT09ICdyZXZlYWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChhdXhpbGlhcywgKGF1eGlsaWEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXhpbGlhLnJldmVhbGVkKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWRkaW5nIGJhY2sgJyArIGNvdW50ICsgJ3ggJyArIHN0YXR1cyArICcgJyArIGZhY3Rpb24ubmFtZSArICcgQXV4aWxpYSB0byAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICByZWdpb24uYWRkUGllY2VzKGF1eGlsaWFzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodHlwZSA9PT0gJ2xlZ2lvbicpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsZWdpb25zID0gZmFjdGlvbi5nZXRMZWdpb25zRnJvbUZhbGxlbihwaWVjZVR5cGVEYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgYmFjayAnICsgcGllY2VUeXBlRGF0YS5kYXRhICsgJ3ggUm9tYW4gTGVnaW9ucyB0byAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgICAgIHJlZ2lvbi5hZGRQaWVjZXMobGVnaW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHR5cGUgPT09ICdmb3J0Jykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgYmFjayBSb21hbiBGb3J0IHRvICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgICAgICAgICAgcmVnaW9uLmFkZFBpZWNlKGZhY3Rpb24ucmVtb3ZlRm9ydCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodHlwZSA9PT0gJ2xlYWRlcicpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsZWFkZXIgPSBmYWN0aW9uLnJlbW92ZUxlYWRlcigpO1xuICAgICAgICAgICAgICAgIGxlYWRlci5zdWNjZXNzb3IgPSBwaWVjZVR5cGVEYXRhLmRhdGEuc3VjY2Vzc29yO1xuICAgICAgICAgICAgICAgIHJlZ2lvbi5hZGRQaWVjZShsZWFkZXIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgYmFjayAnICsgbGVhZGVyLnRvU3RyaW5nKCkgKyAnIHRvICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldFJlbW92YWxEYXRhKHBpZWNlcykge1xuICAgICAgICByZXR1cm4gXyhwaWVjZXMpLmdyb3VwQnkoJ3R5cGUnKS5tYXAoXG4gICAgICAgICAgICAocGllY2VzT2ZUeXBlLCB0eXBlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd3YXJiYW5kJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IF8uY291bnRCeShwaWVjZXNPZlR5cGUsIHdhcmJhbmQgPT4gd2FyYmFuZC5zdGF0dXMoKSlcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2FsbGllZHRyaWJlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IF8ubWFwKHBpZWNlc09mVHlwZSwgYWxsaWVkVHJpYmUgPT4gYWxsaWVkVHJpYmUudHJpYmVJZClcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NpdGFkZWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlID0gcGllY2VzT2ZUeXBlWzBdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHBpZWNlLnRyaWJlSWRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2F1eGlsaWEnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogXy5jb3VudEJ5KHBpZWNlc09mVHlwZSwgYXV4aWxpYSA9PiBhdXhpbGlhLnN0YXR1cygpKVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnbGVnaW9uJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHBpZWNlc09mVHlwZS5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcGllY2VzT2ZUeXBlLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnbGVhZGVyJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzb3I6IHBpZWNlc09mVHlwZVswXS5pc1N1Y2Nlc3NvcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwaWVjZXNPZlR5cGVbMF0udG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmtleUJ5KCd0eXBlJykudmFsdWUoKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCByZW1vdmFsRGF0YSA9IHRoaXMucmVtb3ZhbERhdGE7XG5cbiAgICAgICAgcmV0dXJuIF8ocmVtb3ZhbERhdGEpLm1hcCgocGllY2VUeXBlRGF0YSwgdHlwZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd3YXJiYW5kJykge1xuICAgICAgICAgICAgICAgIHJldHVybiAnUmVtb3ZlICcgKyAocGllY2VUeXBlRGF0YS5kYXRhLnNjb3V0ZWQgPyBwaWVjZVR5cGVEYXRhLmRhdGEuc2NvdXRlZCArICd4IHNjb3V0ZWQgJyA6ICcnKSArXG4gICAgICAgICAgICAgICAgICAgICAgIChwaWVjZVR5cGVEYXRhLmRhdGEucmV2ZWFsZWQgPyBwaWVjZVR5cGVEYXRhLmRhdGEucmV2ZWFsZWQgKyAneCByZXZlYWxlZCAnIDogJycpICtcbiAgICAgICAgICAgICAgICAgICAgICAgKHBpZWNlVHlwZURhdGEuZGF0YS5oaWRkZW4gPyBwaWVjZVR5cGVEYXRhLmRhdGEuaGlkZGVuICsgJ3ggaGlkZGVuICcgOiAnJykgKyBmYWN0aW9uLm5hbWUgKyAnIFdhcmJhbmRzIGZyb20gJyArIHJlZ2lvbi5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZvcnQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdSZW1vdmUgUm9tYW4gRm9ydCBmcm9tICcgKyByZWdpb24ubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdsZWdpb24nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdSZW1vdmUgJyArIHBpZWNlVHlwZURhdGEuZGF0YSArICd4IExlZ2lvbnMgZnJvbSAnICsgcmVnaW9uLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnYXV4aWxpYScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1JlbW92ZSAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgKHBpZWNlVHlwZURhdGEuZGF0YS5yZXZlYWxlZCA/IHBpZWNlVHlwZURhdGEuZGF0YS5yZXZlYWxlZCArICd4IHJldmVhbGVkICcgOiAnJykgK1xuICAgICAgICAgICAgICAgICAgICAgICAocGllY2VUeXBlRGF0YS5kYXRhLmhpZGRlbiA/IHBpZWNlVHlwZURhdGEuZGF0YS5oaWRkZW4gKyAneCBoaWRkZW4gJyA6ICcnKSArIGZhY3Rpb24ubmFtZSArICcgQXV4aWxpYSBmcm9tICcgKyByZWdpb24ubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdsZWFkZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdSZW1vdmUgJyArIHBpZWNlVHlwZURhdGEuZGF0YS50aXRsZSArICcgZnJvbSAnICsgcmVnaW9uLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnYWxsaWVkdHJpYmUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdSZW1vdmUgJyArIHBpZWNlVHlwZURhdGEuZGF0YS5sZW5ndGggKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBBbGxpZXMnICsgJyBmcm9tICcgKyBfLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZVR5cGVEYXRhLmRhdGEpICsgJyBpbiAnICsgcmVnaW9uLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnY2l0YWRlbCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1JlbW92ZSAnICsgZmFjdGlvbi5uYW1lICsgJyBDaXRhZGVsJyArICcgZnJvbSAnICsgcGllY2VUeXBlRGF0YS5kYXRhICsgJyBpbiAnICsgcmVnaW9uLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBSZW1vdmVQaWVjZXM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUGllY2VzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBT0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUZBO0FBT0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Command = function () {\n    function Command() {\n        _classCallCheck(this, Command);\n    }\n\n    _createClass(Command, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {}\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {}\n    }, {\n        key: 'test',\n        value: function test(state, args) {\n            var resolvedArgs = this.resolveIds(state, args);\n            return this.doTest(state, resolvedArgs);\n        }\n    }, {\n        key: 'execute',\n        value: function execute(state, args) {\n            var resolvedArgs = this.resolveIds(state, args);\n            return this.doExecute(state, resolvedArgs);\n        }\n    }, {\n        key: 'resolveIds',\n        value: function resolveIds(state, args) {\n            if (!args) {\n                return;\n            }\n\n            var resolvedArgs = _.clone(args);\n            _.each(args, function (value, key) {\n                if (key.endsWith('Id')) {\n                    var nonIdPropName = key.substring(0, key.length - 2);\n                    if (!args[nonIdPropName]) {\n                        var keylower = key.toLowerCase();\n                        if (keylower.indexOf('faction') >= 0) {\n                            resolvedArgs[nonIdPropName] = state.factionsById[value];\n                        } else if (keylower.indexOf('region') >= 0) {\n                            resolvedArgs[nonIdPropName] = state.regionsById[value];\n                        } else if (keylower.indexOf('tribe') >= 0) {\n                            resolvedArgs[nonIdPropName] = state.tribesById[value];\n                        }\n                    }\n                }\n            });\n            return resolvedArgs;\n        }\n    }]);\n\n    return Command;\n}();\n\nexports.default = Command;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9zcmMvZmFsbGluZ3NreS9jb21tYW5kcy9jb21tYW5kLmpzPzdiZTgiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgZG9FeGVjdXRlKHN0YXRlLCBhcmdzKSB7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgdGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCByZXNvbHZlZEFyZ3MgPSB0aGlzLnJlc29sdmVJZHMoc3RhdGUsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gdGhpcy5kb1Rlc3Qoc3RhdGUsIHJlc29sdmVkQXJncyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGV4ZWN1dGUoc3RhdGUsIGFyZ3MpIHtcbiAgICAgICAgY29uc3QgcmVzb2x2ZWRBcmdzID0gdGhpcy5yZXNvbHZlSWRzKHN0YXRlLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9FeGVjdXRlKHN0YXRlLCByZXNvbHZlZEFyZ3MpO1xuICAgIH1cblxuICAgIHN0YXRpYyByZXNvbHZlSWRzKHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGlmICghYXJncykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzb2x2ZWRBcmdzID0gXy5jbG9uZShhcmdzKTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgYXJncywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5LmVuZHNXaXRoKCdJZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vbklkUHJvcE5hbWUgPSBrZXkuc3Vic3RyaW5nKDAsIGtleS5sZW5ndGggLSAyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhcmdzW25vbklkUHJvcE5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlsb3dlciA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleWxvd2VyLmluZGV4T2YoJ2ZhY3Rpb24nKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRBcmdzW25vbklkUHJvcE5hbWVdID0gc3RhdGUuZmFjdGlvbnNCeUlkW3ZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGtleWxvd2VyLmluZGV4T2YoJ3JlZ2lvbicpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlZEFyZ3Nbbm9uSWRQcm9wTmFtZV0gPSBzdGF0ZS5yZWdpb25zQnlJZFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChrZXlsb3dlci5pbmRleE9mKCd0cmliZScpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlZEFyZ3Nbbm9uSWRQcm9wTmFtZV0gPSBzdGF0ZS50cmliZXNCeUlkW3ZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzb2x2ZWRBcmdzO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29tbWFuZDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvY29tbWFuZC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7Ozs7O0FBRUE7OztBQUlBOzs7QUFJQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MovePieces = function (_Action) {\n    _inherits(MovePieces, _Action);\n\n    function MovePieces(args) {\n        _classCallCheck(this, MovePieces);\n\n        var _this = _possibleConstructorReturn(this, (MovePieces.__proto__ || Object.getPrototypeOf(MovePieces)).call(this, args));\n\n        _this.sourceRegionId = args.sourceRegionId;\n        _this.destRegionId = args.destRegionId;\n        _this.factionId = args.factionId;\n        _this.pieces = args.pieces;\n        _this.moveData = args.moveData;\n        return _this;\n    }\n\n    _createClass(MovePieces, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var sourceRegion = state.regionsById[this.sourceRegionId];\n            var destRegion = state.regionsById[this.destRegionId];\n            var pieces = this.pieces;\n\n            this.factionId = pieces[0].factionId;\n            this.moveData = this.getMoveData(pieces);\n\n            sourceRegion.removePieces(pieces);\n            destRegion.addPieces(pieces);\n\n            console.log('Moving these ' + this.factionId + ' pieces from ' + sourceRegion.name + ' to ' + destRegion.name);\n            _logging2.default.logPieces(pieces);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var _this2 = this;\n\n            var faction = state.factionsById[this.factionId];\n            var sourceRegion = state.regionsById[this.sourceRegionId];\n            var destRegion = state.regionsById[this.destRegionId];\n            (0, _lodash2.default)(this.moveData).each(function (pieceTypeData, type) {\n                if (type === 'warband') {\n                    var warbandsByStatus = _lodash2.default.groupBy(destRegion.getWarbandsOrAuxiliaForFaction(_this2.factionId), function (warband) {\n                        return warband.status();\n                    });\n                    _lodash2.default.each(pieceTypeData.data, function (count, status) {\n                        var warbands = _lodash2.default.take(warbandsByStatus[status], count);\n                        destRegion.removePieces(warbands);\n                        sourceRegion.addPieces(warbands);\n                        console.log('Returning ' + count + 'x ' + status + ' ' + faction.name + ' Warbands from ' + destRegion.name + ' to ' + sourceRegion.name);\n                    });\n                } else if (type === 'auxilia') {\n                    var auxiliaByStatus = _lodash2.default.groupBy(destRegion.getWarbandsOrAuxiliaForFaction(_this2.factionId), function (auxilia) {\n                        return auxilia.status();\n                    });\n                    _lodash2.default.each(pieceTypeData.data, function (count, status) {\n                        var auxilia = _lodash2.default.take(auxiliaByStatus[status], count);\n                        destRegion.removePieces(auxilia);\n                        sourceRegion.addPieces(auxilia);\n                        console.log('Returning ' + count + 'x ' + status + ' ' + faction.name + ' Auxilia from ' + destRegion.name + ' to ' + sourceRegion.name);\n                    });\n                } else if (type === 'legion') {\n                    var legions = _lodash2.default.take(destRegion.getLegions(), pieceTypeData.data);\n                    destRegion.removePieces(legions);\n                    sourceRegion.addPieces(legions);\n                    console.log('Returning ' + pieceTypeData.data + 'x Roman Legions from ' + destRegion.name + ' to ' + sourceRegion.name);\n                } else if (type === 'leader') {\n                    var leader = destRegion.getLeaderForFaction(_this2.factionId);\n                    destRegion.removePieces([leader]);\n                    sourceRegion.addPiece(leader);\n                    console.log('Returning ' + leader.toString() + ' from ' + destRegion.name + ' to ' + sourceRegion.name);\n                }\n            });\n        }\n    }, {\n        key: 'getMoveData',\n        value: function getMoveData(pieces) {\n            return (0, _lodash2.default)(pieces).groupBy('type').map(function (piecesOfType, type) {\n                if (type === 'warband') {\n                    return {\n                        type: type,\n                        data: _lodash2.default.countBy(piecesOfType, function (warband) {\n                            return warband.status();\n                        })\n                    };\n                } else if (type === 'auxilia') {\n                    return {\n                        type: type,\n                        data: _lodash2.default.countBy(piecesOfType, function (auxilia) {\n                            return auxilia.status();\n                        })\n                    };\n                } else if (type === 'legion') {\n                    return {\n                        type: type,\n                        data: piecesOfType.length\n                    };\n                } else if (type === 'leader') {\n                    return {\n                        type: type,\n                        data: {\n                            successor: piecesOfType[0].isSuccessor(),\n                            title: piecesOfType[0].toString()\n                        }\n                    };\n                }\n            }).keyBy('type').value();\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var sourceRegion = state.regionsById[this.sourceRegionId];\n            var destRegion = state.regionsById[this.destRegionId];\n            var pieces = this.pieces;\n            var faction = state.factionsById[pieces[0].factionId];\n            return _lodash2.default.map(_logging2.default.getPiecesList(pieces), function (pieceString) {\n                return 'Move ' + faction.name + ' ' + pieceString + ' from ' + sourceRegion.name + ' to ' + destRegion.name;\n            });\n        }\n    }]);\n\n    return MovePieces;\n}(_action2.default);\n\nexports.default = MovePieces;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9tb3ZlUGllY2VzLmpzP2I2ZjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZ2dpbmcgZnJvbSAnLi4vdXRpbC9sb2dnaW5nJztcbmltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5cbmNsYXNzIE1vdmVQaWVjZXMgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLnNvdXJjZVJlZ2lvbklkID0gYXJncy5zb3VyY2VSZWdpb25JZDtcbiAgICAgICAgdGhpcy5kZXN0UmVnaW9uSWQgPSBhcmdzLmRlc3RSZWdpb25JZDtcbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5waWVjZXMgPSBhcmdzLnBpZWNlcztcbiAgICAgICAgdGhpcy5tb3ZlRGF0YSA9IGFyZ3MubW92ZURhdGE7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZVJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMuc291cmNlUmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBkZXN0UmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5kZXN0UmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBwaWVjZXMgPSB0aGlzLnBpZWNlcztcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IHBpZWNlc1swXS5mYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMubW92ZURhdGEgPSB0aGlzLmdldE1vdmVEYXRhKHBpZWNlcyk7XG5cbiAgICAgICAgc291cmNlUmVnaW9uLnJlbW92ZVBpZWNlcyhwaWVjZXMpO1xuICAgICAgICBkZXN0UmVnaW9uLmFkZFBpZWNlcyhwaWVjZXMpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdNb3ZpbmcgdGhlc2UgJyArIHRoaXMuZmFjdGlvbklkICsgJyBwaWVjZXMgZnJvbSAnICsgc291cmNlUmVnaW9uLm5hbWUgKyAnIHRvICcgKyBkZXN0UmVnaW9uLm5hbWUpO1xuICAgICAgICBMb2dnaW5nLmxvZ1BpZWNlcyhwaWVjZXMpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3Qgc291cmNlUmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5zb3VyY2VSZWdpb25JZF07XG4gICAgICAgIGNvbnN0IGRlc3RSZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLmRlc3RSZWdpb25JZF07XG4gICAgICAgIF8odGhpcy5tb3ZlRGF0YSkuZWFjaCgocGllY2VUeXBlRGF0YSx0eXBlKSA9PiB7XG4gICAgICAgICAgICBpZih0eXBlID09PSAnd2FyYmFuZCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXJiYW5kc0J5U3RhdHVzID0gXy5ncm91cEJ5KGRlc3RSZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKSwgd2FyYmFuZD0+d2FyYmFuZC5zdGF0dXMoKSk7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHBpZWNlVHlwZURhdGEuZGF0YSwgKGNvdW50LCBzdGF0dXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FyYmFuZHMgPSBfLnRha2Uod2FyYmFuZHNCeVN0YXR1c1tzdGF0dXNdLCBjb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb24ucmVtb3ZlUGllY2VzKHdhcmJhbmRzKTtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uLmFkZFBpZWNlcyh3YXJiYW5kcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXR1cm5pbmcgJyArIGNvdW50ICsgJ3ggJyArIHN0YXR1cyArICcgJyArIGZhY3Rpb24ubmFtZSArICcgV2FyYmFuZHMgZnJvbSAnICsgZGVzdFJlZ2lvbi5uYW1lICsgJyB0byAnICsgc291cmNlUmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0eXBlID09PSAnYXV4aWxpYScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdXhpbGlhQnlTdGF0dXMgPSBfLmdyb3VwQnkoZGVzdFJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpLCBhdXhpbGlhPT5hdXhpbGlhLnN0YXR1cygpKTtcbiAgICAgICAgICAgICAgICBfLmVhY2gocGllY2VUeXBlRGF0YS5kYXRhLCAoY291bnQsIHN0YXR1cykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXhpbGlhID0gXy50YWtlKGF1eGlsaWFCeVN0YXR1c1tzdGF0dXNdLCBjb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb24ucmVtb3ZlUGllY2VzKGF1eGlsaWEpO1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb24uYWRkUGllY2VzKGF1eGlsaWEpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0dXJuaW5nICcgKyBjb3VudCArICd4ICcgKyBzdGF0dXMgKyAnICcgKyBmYWN0aW9uLm5hbWUgKyAnIEF1eGlsaWEgZnJvbSAnICsgZGVzdFJlZ2lvbi5uYW1lICsgJyB0byAnICsgc291cmNlUmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0eXBlID09PSAnbGVnaW9uJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlZ2lvbnMgPSBfLnRha2UoZGVzdFJlZ2lvbi5nZXRMZWdpb25zKCksIHBpZWNlVHlwZURhdGEuZGF0YSk7XG4gICAgICAgICAgICAgICAgZGVzdFJlZ2lvbi5yZW1vdmVQaWVjZXMobGVnaW9ucyk7XG4gICAgICAgICAgICAgICAgc291cmNlUmVnaW9uLmFkZFBpZWNlcyhsZWdpb25zKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0dXJuaW5nICcgKyBwaWVjZVR5cGVEYXRhLmRhdGEgKyAneCBSb21hbiBMZWdpb25zIGZyb20gJyArIGRlc3RSZWdpb24ubmFtZSArICcgdG8gJyArIHNvdXJjZVJlZ2lvbi5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodHlwZSA9PT0gJ2xlYWRlcicpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsZWFkZXIgPSBkZXN0UmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgIGRlc3RSZWdpb24ucmVtb3ZlUGllY2VzKFtsZWFkZXJdKTtcbiAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb24uYWRkUGllY2UobGVhZGVyKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0dXJuaW5nICcgKyBsZWFkZXIudG9TdHJpbmcoKSArICcgZnJvbSAnICsgZGVzdFJlZ2lvbi5uYW1lICsgJyB0byAnICsgc291cmNlUmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRNb3ZlRGF0YShwaWVjZXMpIHtcbiAgICAgICAgcmV0dXJuIF8ocGllY2VzKS5ncm91cEJ5KCd0eXBlJykubWFwKFxuICAgICAgICAgICAgKHBpZWNlc09mVHlwZSwgdHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnd2FyYmFuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBfLmNvdW50QnkocGllY2VzT2ZUeXBlLCB3YXJiYW5kID0+IHdhcmJhbmQuc3RhdHVzKCkpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdhdXhpbGlhJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IF8uY291bnRCeShwaWVjZXNPZlR5cGUsIGF1eGlsaWEgPT4gYXV4aWxpYS5zdGF0dXMoKSlcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2xlZ2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBwaWVjZXNPZlR5cGUubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdsZWFkZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NvcjogcGllY2VzT2ZUeXBlWzBdLmlzU3VjY2Vzc29yKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHBpZWNlc09mVHlwZVswXS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkua2V5QnkoJ3R5cGUnKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBzb3VyY2VSZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnNvdXJjZVJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgZGVzdFJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMuZGVzdFJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgcGllY2VzID0gdGhpcy5waWVjZXM7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbcGllY2VzWzBdLmZhY3Rpb25JZF07XG4gICAgICAgIHJldHVybiBfLm1hcChMb2dnaW5nLmdldFBpZWNlc0xpc3QocGllY2VzKSwgcGllY2VTdHJpbmcgPT4gJ01vdmUgJyArIGZhY3Rpb24ubmFtZSArICcgJyArIHBpZWNlU3RyaW5nICsgJyBmcm9tICcgKyBzb3VyY2VSZWdpb24ubmFtZSArICcgdG8gJyArIGRlc3RSZWdpb24ubmFtZSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb3ZlUGllY2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL21vdmVQaWVjZXMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVFBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUZBO0FBT0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar SpecialAbilityIDs = {\n    AMBUSH: 'Ambush',\n    BESIEGE: 'Besiege',\n    BUILD: 'Build',\n    DEVASTATE: 'Devastate',\n    ENLIST: 'Enlist',\n    ENTREAT: 'Entreat',\n    RAMPAGE: 'Rampage',\n    SCOUT: 'Scout',\n    SUBORN: 'Suborn',\n    TRADE: 'Trade'\n};\n\nexports.default = SpecialAbilityIDs;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzLmpzPzk0NWMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU3BlY2lhbEFiaWxpdHlJRHMgPSB7XG4gICAgQU1CVVNIOiAnQW1idXNoJyxcbiAgICBCRVNJRUdFOiAnQmVzaWVnZScsXG4gICAgQlVJTEQ6ICdCdWlsZCcsXG4gICAgREVWQVNUQVRFOiAnRGV2YXN0YXRlJyxcbiAgICBFTkxJU1Q6ICdFbmxpc3QnLFxuICAgIEVOVFJFQVQ6ICdFbnRyZWF0JyxcbiAgICBSQU1QQUdFOiAnUmFtcGFnZScsXG4gICAgU0NPVVQ6ICdTY291dCcsXG4gICAgU1VCT1JOOiAnU3Vib3JuJyxcbiAgICBUUkFERTogJ1RyYWRlJ1xufTtcblxuZXhwb3J0IGRlZmF1bHQgU3BlY2lhbEFiaWxpdHlJRHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFDQTtBQVlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/*!\n * Knockout JavaScript library v3.4.2\n * (c) The Knockout.js team - http://knockoutjs.com/\n * License: MIT (http://www.opensource.org/licenses/mit-license.php)\n */\n\n(function () {\n  (function (n) {\n    var x = this || (0, eval)(\"this\"),\n        t = x.document,\n        M = x.navigator,\n        u = x.jQuery,\n        H = x.JSON;(function (n) {\n       true ? !(__WEBPACK_AMD_DEFINE_ARRAY__ = [exports, __webpack_require__], __WEBPACK_AMD_DEFINE_FACTORY__ = (n),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : \"object\" === (typeof exports === \"undefined\" ? \"undefined\" : _typeof(exports)) && \"object\" === (typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) ? n(module.exports || exports) : n(x.ko = {});\n    })(function (N, O) {\n      function J(a, c) {\n        return null === a || (typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) in R ? a === c : !1;\n      }function S(b, c) {\n        var d;return function () {\n          d || (d = a.a.setTimeout(function () {\n            d = n;b();\n          }, c));\n        };\n      }function T(b, c) {\n        var d;return function () {\n          clearTimeout(d);d = a.a.setTimeout(b, c);\n        };\n      }function U(a, c) {\n        c && c !== E ? \"beforeChange\" === c ? this.Ob(a) : this.Ja(a, c) : this.Pb(a);\n      }function V(a, c) {\n        null !== c && c.k && c.k();\n      }function W(a, c) {\n        var d = this.Mc,\n            e = d[s];e.T || (this.ob && this.Oa[c] ? (d.Sb(c, a, this.Oa[c]), this.Oa[c] = null, --this.ob) : e.s[c] || d.Sb(c, a, e.t ? { $: a } : d.yc(a)), a.Ha && a.Hc());\n      }function K(b, c, d, e) {\n        a.d[b] = { init: function init(b, g, h, l, m) {\n            var k, r;a.m(function () {\n              var q = g(),\n                  p = a.a.c(q),\n                  p = !d !== !p,\n                  A = !r;if (A || c || p !== k) A && a.xa.Ca() && (r = a.a.wa(a.f.childNodes(b), !0)), p ? (A || a.f.fa(b, a.a.wa(r)), a.hb(e ? e(m, q) : m, b)) : a.f.za(b), k = p;\n            }, null, { i: b });return { controlsDescendantBindings: !0 };\n          } };a.h.va[b] = !1;a.f.aa[b] = !0;\n      }var a = \"undefined\" !== typeof N ? N : {};a.b = function (b, c) {\n        for (var d = b.split(\".\"), e = a, f = 0; f < d.length - 1; f++) {\n          e = e[d[f]];\n        }e[d[d.length - 1]] = c;\n      };a.H = function (a, c, d) {\n        a[c] = d;\n      };a.version = \"3.4.2\";a.b(\"version\", a.version);a.options = { deferUpdates: !1, useOnlyNativeEvents: !1 };a.a = function () {\n        function b(a, b) {\n          for (var c in a) {\n            a.hasOwnProperty(c) && b(c, a[c]);\n          }\n        }function c(a, b) {\n          if (b) for (var c in b) {\n            b.hasOwnProperty(c) && (a[c] = b[c]);\n          }return a;\n        }function d(a, b) {\n          a.__proto__ = b;return a;\n        }function e(b, c, d, e) {\n          var m = b[c].match(r) || [];a.a.r(d.match(r), function (b) {\n            a.a.ra(m, b, e);\n          });b[c] = m.join(\" \");\n        }var f = { __proto__: [] } instanceof Array,\n            g = \"function\" === typeof Symbol,\n            h = {},\n            l = {};h[M && /Firefox\\/2/i.test(M.userAgent) ? \"KeyboardEvent\" : \"UIEvents\"] = [\"keyup\", \"keydown\", \"keypress\"];h.MouseEvents = \"click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\".split(\" \");b(h, function (a, b) {\n          if (b.length) for (var c = 0, d = b.length; c < d; c++) {\n            l[b[c]] = a;\n          }\n        });var m = { propertychange: !0 },\n            k = t && function () {\n          for (var a = 3, b = t.createElement(\"div\"), c = b.getElementsByTagName(\"i\"); b.innerHTML = \"\\x3c!--[if gt IE \" + ++a + \"]><i></i><![endif]--\\x3e\", c[0];) {}return 4 < a ? a : n;\n        }(),\n            r = /\\S+/g;return { gc: [\"authenticity_token\", /^__RequestVerificationToken(_.*)?$/], r: function r(a, b) {\n            for (var c = 0, d = a.length; c < d; c++) {\n              b(a[c], c);\n            }\n          }, o: function o(a, b) {\n            if (\"function\" == typeof Array.prototype.indexOf) return Array.prototype.indexOf.call(a, b);for (var c = 0, d = a.length; c < d; c++) {\n              if (a[c] === b) return c;\n            }return -1;\n          }, Vb: function Vb(a, b, c) {\n            for (var d = 0, e = a.length; d < e; d++) {\n              if (b.call(c, a[d], d)) return a[d];\n            }return null;\n          }, Na: function Na(b, c) {\n            var d = a.a.o(b, c);0 < d ? b.splice(d, 1) : 0 === d && b.shift();\n          }, Wb: function Wb(b) {\n            b = b || [];for (var c = [], d = 0, e = b.length; d < e; d++) {\n              0 > a.a.o(c, b[d]) && c.push(b[d]);\n            }return c;\n          }, ib: function ib(a, b) {\n            a = a || [];for (var c = [], d = 0, e = a.length; d < e; d++) {\n              c.push(b(a[d], d));\n            }return c;\n          }, Ma: function Ma(a, b) {\n            a = a || [];for (var c = [], d = 0, e = a.length; d < e; d++) {\n              b(a[d], d) && c.push(a[d]);\n            }return c;\n          }, ta: function ta(a, b) {\n            if (b instanceof Array) a.push.apply(a, b);else for (var c = 0, d = b.length; c < d; c++) {\n              a.push(b[c]);\n            }return a;\n          }, ra: function ra(b, c, d) {\n            var e = a.a.o(a.a.Bb(b), c);0 > e ? d && b.push(c) : d || b.splice(e, 1);\n          }, la: f, extend: c, $a: d, ab: f ? d : c, D: b, Ea: function Ea(a, b) {\n            if (!a) return a;var c = {},\n                d;for (d in a) {\n              a.hasOwnProperty(d) && (c[d] = b(a[d], d, a));\n            }return c;\n          }, rb: function rb(b) {\n            for (; b.firstChild;) {\n              a.removeNode(b.firstChild);\n            }\n          }, nc: function nc(b) {\n            b = a.a.W(b);for (var c = (b[0] && b[0].ownerDocument || t).createElement(\"div\"), d = 0, e = b.length; d < e; d++) {\n              c.appendChild(a.ba(b[d]));\n            }return c;\n          }, wa: function wa(b, c) {\n            for (var d = 0, e = b.length, m = []; d < e; d++) {\n              var k = b[d].cloneNode(!0);m.push(c ? a.ba(k) : k);\n            }return m;\n          }, fa: function fa(b, c) {\n            a.a.rb(b);if (c) for (var d = 0, e = c.length; d < e; d++) {\n              b.appendChild(c[d]);\n            }\n          }, uc: function uc(b, c) {\n            var d = b.nodeType ? [b] : b;if (0 < d.length) {\n              for (var e = d[0], m = e.parentNode, k = 0, f = c.length; k < f; k++) {\n                m.insertBefore(c[k], e);\n              }k = 0;for (f = d.length; k < f; k++) {\n                a.removeNode(d[k]);\n              }\n            }\n          }, Ba: function Ba(a, b) {\n            if (a.length) {\n              for (b = 8 === b.nodeType && b.parentNode || b; a.length && a[0].parentNode !== b;) {\n                a.splice(0, 1);\n              }for (; 1 < a.length && a[a.length - 1].parentNode !== b;) {\n                a.length--;\n              }if (1 < a.length) {\n                var c = a[0],\n                    d = a[a.length - 1];for (a.length = 0; c !== d;) {\n                  a.push(c), c = c.nextSibling;\n                }a.push(d);\n              }\n            }return a;\n          }, wc: function wc(a, b) {\n            7 > k ? a.setAttribute(\"selected\", b) : a.selected = b;\n          }, cb: function cb(a) {\n            return null === a || a === n ? \"\" : a.trim ? a.trim() : a.toString().replace(/^[\\s\\xa0]+|[\\s\\xa0]+$/g, \"\");\n          }, sd: function sd(a, b) {\n            a = a || \"\";return b.length > a.length ? !1 : a.substring(0, b.length) === b;\n          }, Rc: function Rc(a, b) {\n            if (a === b) return !0;if (11 === a.nodeType) return !1;if (b.contains) return b.contains(3 === a.nodeType ? a.parentNode : a);if (b.compareDocumentPosition) return 16 == (b.compareDocumentPosition(a) & 16);for (; a && a != b;) {\n              a = a.parentNode;\n            }return !!a;\n          }, qb: function qb(b) {\n            return a.a.Rc(b, b.ownerDocument.documentElement);\n          }, Tb: function Tb(b) {\n            return !!a.a.Vb(b, a.a.qb);\n          }, A: function A(a) {\n            return a && a.tagName && a.tagName.toLowerCase();\n          }, Zb: function Zb(b) {\n            return a.onError ? function () {\n              try {\n                return b.apply(this, arguments);\n              } catch (c) {\n                throw a.onError && a.onError(c), c;\n              }\n            } : b;\n          }, setTimeout: function (_setTimeout) {\n            function setTimeout(_x, _x2) {\n              return _setTimeout.apply(this, arguments);\n            }\n\n            setTimeout.toString = function () {\n              return _setTimeout.toString();\n            };\n\n            return setTimeout;\n          }(function (b, c) {\n            return setTimeout(a.a.Zb(b), c);\n          }), dc: function dc(b) {\n            setTimeout(function () {\n              a.onError && a.onError(b);throw b;\n            }, 0);\n          }, q: function q(b, c, d) {\n            var e = a.a.Zb(d);d = k && m[c];if (a.options.useOnlyNativeEvents || d || !u) {\n              if (d || \"function\" != typeof b.addEventListener) {\n                if (\"undefined\" != typeof b.attachEvent) {\n                  var f = function f(a) {\n                    e.call(b, a);\n                  },\n                      l = \"on\" + c;b.attachEvent(l, f);a.a.G.qa(b, function () {\n                    b.detachEvent(l, f);\n                  });\n                } else throw Error(\"Browser doesn't support addEventListener or attachEvent\");\n              } else b.addEventListener(c, e, !1);\n            } else u(b).bind(c, e);\n          }, Fa: function Fa(b, c) {\n            if (!b || !b.nodeType) throw Error(\"element must be a DOM node when calling triggerEvent\");var d;\"input\" === a.a.A(b) && b.type && \"click\" == c.toLowerCase() ? (d = b.type, d = \"checkbox\" == d || \"radio\" == d) : d = !1;if (a.options.useOnlyNativeEvents || !u || d) {\n              if (\"function\" == typeof t.createEvent) {\n                if (\"function\" == typeof b.dispatchEvent) d = t.createEvent(l[c] || \"HTMLEvents\"), d.initEvent(c, !0, !0, x, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, b), b.dispatchEvent(d);else throw Error(\"The supplied element doesn't support dispatchEvent\");\n              } else if (d && b.click) b.click();else if (\"undefined\" != typeof b.fireEvent) b.fireEvent(\"on\" + c);else throw Error(\"Browser doesn't support triggering events\");\n            } else u(b).trigger(c);\n          }, c: function c(b) {\n            return a.I(b) ? b() : b;\n          }, Bb: function Bb(b) {\n            return a.I(b) ? b.p() : b;\n          }, fb: function fb(b, c, d) {\n            var k;c && (\"object\" === _typeof(b.classList) ? (k = b.classList[d ? \"add\" : \"remove\"], a.a.r(c.match(r), function (a) {\n              k.call(b.classList, a);\n            })) : \"string\" === typeof b.className.baseVal ? e(b.className, \"baseVal\", c, d) : e(b, \"className\", c, d));\n          }, bb: function bb(b, c) {\n            var d = a.a.c(c);if (null === d || d === n) d = \"\";var e = a.f.firstChild(b);!e || 3 != e.nodeType || a.f.nextSibling(e) ? a.f.fa(b, [b.ownerDocument.createTextNode(d)]) : e.data = d;a.a.Wc(b);\n          }, vc: function vc(a, b) {\n            a.name = b;if (7 >= k) try {\n              a.mergeAttributes(t.createElement(\"<input name='\" + a.name + \"'/>\"), !1);\n            } catch (c) {}\n          }, Wc: function Wc(a) {\n            9 <= k && (a = 1 == a.nodeType ? a : a.parentNode, a.style && (a.style.zoom = a.style.zoom));\n          }, Sc: function Sc(a) {\n            if (k) {\n              var b = a.style.width;a.style.width = 0;a.style.width = b;\n            }\n          }, nd: function nd(b, c) {\n            b = a.a.c(b);c = a.a.c(c);for (var d = [], e = b; e <= c; e++) {\n              d.push(e);\n            }return d;\n          }, W: function W(a) {\n            for (var b = [], c = 0, d = a.length; c < d; c++) {\n              b.push(a[c]);\n            }return b;\n          }, bc: function bc(a) {\n            return g ? Symbol(a) : a;\n          }, xd: 6 === k,\n          yd: 7 === k, C: k, ic: function ic(b, c) {\n            for (var d = a.a.W(b.getElementsByTagName(\"input\")).concat(a.a.W(b.getElementsByTagName(\"textarea\"))), e = \"string\" == typeof c ? function (a) {\n              return a.name === c;\n            } : function (a) {\n              return c.test(a.name);\n            }, k = [], m = d.length - 1; 0 <= m; m--) {\n              e(d[m]) && k.push(d[m]);\n            }return k;\n          }, kd: function kd(b) {\n            return \"string\" == typeof b && (b = a.a.cb(b)) ? H && H.parse ? H.parse(b) : new Function(\"return \" + b)() : null;\n          }, Gb: function Gb(b, c, d) {\n            if (!H || !H.stringify) throw Error(\"Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js\");\n            return H.stringify(a.a.c(b), c, d);\n          }, ld: function ld(c, d, e) {\n            e = e || {};var k = e.params || {},\n                m = e.includeFields || this.gc,\n                f = c;if (\"object\" == (typeof c === \"undefined\" ? \"undefined\" : _typeof(c)) && \"form\" === a.a.A(c)) for (var f = c.action, l = m.length - 1; 0 <= l; l--) {\n              for (var g = a.a.ic(c, m[l]), h = g.length - 1; 0 <= h; h--) {\n                k[g[h].name] = g[h].value;\n              }\n            }d = a.a.c(d);var r = t.createElement(\"form\");r.style.display = \"none\";r.action = f;r.method = \"post\";for (var n in d) {\n              c = t.createElement(\"input\"), c.type = \"hidden\", c.name = n, c.value = a.a.Gb(a.a.c(d[n])), r.appendChild(c);\n            }b(k, function (a, b) {\n              var c = t.createElement(\"input\");\n              c.type = \"hidden\";c.name = a;c.value = b;r.appendChild(c);\n            });t.body.appendChild(r);e.submitter ? e.submitter(r) : r.submit();setTimeout(function () {\n              r.parentNode.removeChild(r);\n            }, 0);\n          } };\n      }();a.b(\"utils\", a.a);a.b(\"utils.arrayForEach\", a.a.r);a.b(\"utils.arrayFirst\", a.a.Vb);a.b(\"utils.arrayFilter\", a.a.Ma);a.b(\"utils.arrayGetDistinctValues\", a.a.Wb);a.b(\"utils.arrayIndexOf\", a.a.o);a.b(\"utils.arrayMap\", a.a.ib);a.b(\"utils.arrayPushAll\", a.a.ta);a.b(\"utils.arrayRemoveItem\", a.a.Na);a.b(\"utils.extend\", a.a.extend);a.b(\"utils.fieldsIncludedWithJsonPost\", a.a.gc);a.b(\"utils.getFormFields\", a.a.ic);a.b(\"utils.peekObservable\", a.a.Bb);a.b(\"utils.postJson\", a.a.ld);a.b(\"utils.parseJson\", a.a.kd);a.b(\"utils.registerEventHandler\", a.a.q);a.b(\"utils.stringifyJson\", a.a.Gb);a.b(\"utils.range\", a.a.nd);a.b(\"utils.toggleDomNodeCssClass\", a.a.fb);a.b(\"utils.triggerEvent\", a.a.Fa);a.b(\"utils.unwrapObservable\", a.a.c);a.b(\"utils.objectForEach\", a.a.D);a.b(\"utils.addOrRemoveItem\", a.a.ra);a.b(\"utils.setTextContent\", a.a.bb);a.b(\"unwrap\", a.a.c);Function.prototype.bind || (Function.prototype.bind = function (a) {\n        var c = this;if (1 === arguments.length) return function () {\n          return c.apply(a, arguments);\n        };var d = Array.prototype.slice.call(arguments, 1);return function () {\n          var e = d.slice(0);e.push.apply(e, arguments);return c.apply(a, e);\n        };\n      });a.a.e = new function () {\n        function a(b, g) {\n          var h = b[d];if (!h || \"null\" === h || !e[h]) {\n            if (!g) return n;h = b[d] = \"ko\" + c++;e[h] = {};\n          }return e[h];\n        }var c = 0,\n            d = \"__ko__\" + new Date().getTime(),\n            e = {};return { get: function get(c, d) {\n            var e = a(c, !1);return e === n ? n : e[d];\n          }, set: function set(c, d, e) {\n            if (e !== n || a(c, !1) !== n) a(c, !0)[d] = e;\n          }, clear: function clear(a) {\n            var b = a[d];return b ? (delete e[b], a[d] = null, !0) : !1;\n          }, J: function J() {\n            return c++ + d;\n          } };\n      }();a.b(\"utils.domData\", a.a.e);a.b(\"utils.domData.clear\", a.a.e.clear);a.a.G = new function () {\n        function b(b, c) {\n          var e = a.a.e.get(b, d);e === n && c && (e = [], a.a.e.set(b, d, e));return e;\n        }function c(d) {\n          var e = b(d, !1);if (e) for (var e = e.slice(0), l = 0; l < e.length; l++) {\n            e[l](d);\n          }a.a.e.clear(d);a.a.G.cleanExternalData(d);if (f[d.nodeType]) for (e = d.firstChild; d = e;) {\n            e = d.nextSibling, 8 === d.nodeType && c(d);\n          }\n        }var d = a.a.e.J(),\n            e = { 1: !0, 8: !0, 9: !0 },\n            f = { 1: !0, 9: !0 };return { qa: function qa(a, c) {\n            if (\"function\" != typeof c) throw Error(\"Callback must be a function\");b(a, !0).push(c);\n          }, tc: function tc(c, e) {\n            var f = b(c, !1);f && (a.a.Na(f, e), 0 == f.length && a.a.e.set(c, d, n));\n          }, ba: function ba(b) {\n            if (e[b.nodeType] && (c(b), f[b.nodeType])) {\n              var d = [];a.a.ta(d, b.getElementsByTagName(\"*\"));for (var l = 0, m = d.length; l < m; l++) {\n                c(d[l]);\n              }\n            }return b;\n          }, removeNode: function removeNode(b) {\n            a.ba(b);b.parentNode && b.parentNode.removeChild(b);\n          }, cleanExternalData: function cleanExternalData(a) {\n            u && \"function\" == typeof u.cleanData && u.cleanData([a]);\n          } };\n      }();\n      a.ba = a.a.G.ba;a.removeNode = a.a.G.removeNode;a.b(\"cleanNode\", a.ba);a.b(\"removeNode\", a.removeNode);a.b(\"utils.domNodeDisposal\", a.a.G);a.b(\"utils.domNodeDisposal.addDisposeCallback\", a.a.G.qa);a.b(\"utils.domNodeDisposal.removeDisposeCallback\", a.a.G.tc);(function () {\n        var b = [0, \"\", \"\"],\n            c = [1, \"<table>\", \"</table>\"],\n            d = [3, \"<table><tbody><tr>\", \"</tr></tbody></table>\"],\n            e = [1, \"<select multiple='multiple'>\", \"</select>\"],\n            f = { thead: c, tbody: c, tfoot: c, tr: [2, \"<table><tbody>\", \"</tbody></table>\"], td: d, th: d, option: e, optgroup: e },\n            g = 8 >= a.a.C;a.a.na = function (c, d) {\n          var e;if (u) {\n            if (u.parseHTML) e = u.parseHTML(c, d) || [];else {\n              if ((e = u.clean([c], d)) && e[0]) {\n                for (var k = e[0]; k.parentNode && 11 !== k.parentNode.nodeType;) {\n                  k = k.parentNode;\n                }k.parentNode && k.parentNode.removeChild(k);\n              }\n            }\n          } else {\n            (e = d) || (e = t);var k = e.parentWindow || e.defaultView || x,\n                r = a.a.cb(c).toLowerCase(),\n                q = e.createElement(\"div\"),\n                p;p = (r = r.match(/^<([a-z]+)[ >]/)) && f[r[1]] || b;r = p[0];p = \"ignored<div>\" + p[1] + c + p[2] + \"</div>\";\"function\" == typeof k.innerShiv ? q.appendChild(k.innerShiv(p)) : (g && e.appendChild(q), q.innerHTML = p, g && q.parentNode.removeChild(q));for (; r--;) {\n              q = q.lastChild;\n            }e = a.a.W(q.lastChild.childNodes);\n          }return e;\n        };a.a.Eb = function (b, c) {\n          a.a.rb(b);c = a.a.c(c);if (null !== c && c !== n) if (\"string\" != typeof c && (c = c.toString()), u) u(b).html(c);else for (var d = a.a.na(c, b.ownerDocument), e = 0; e < d.length; e++) {\n            b.appendChild(d[e]);\n          }\n        };\n      })();a.b(\"utils.parseHtmlFragment\", a.a.na);a.b(\"utils.setHtml\", a.a.Eb);a.N = function () {\n        function b(c, e) {\n          if (c) if (8 == c.nodeType) {\n            var f = a.N.pc(c.nodeValue);null != f && e.push({ Qc: c, hd: f });\n          } else if (1 == c.nodeType) for (var f = 0, g = c.childNodes, h = g.length; f < h; f++) {\n            b(g[f], e);\n          }\n        }var c = {};return { yb: function yb(a) {\n            if (\"function\" != typeof a) throw Error(\"You can only pass a function to ko.memoization.memoize()\");var b = (4294967296 * (1 + Math.random()) | 0).toString(16).substring(1) + (4294967296 * (1 + Math.random()) | 0).toString(16).substring(1);c[b] = a;return \"\\x3c!--[ko_memo:\" + b + \"]--\\x3e\";\n          }, Bc: function Bc(a, b) {\n            var f = c[a];if (f === n) throw Error(\"Couldn't find any memo with ID \" + a + \". Perhaps it's already been unmemoized.\");try {\n              return f.apply(null, b || []), !0;\n            } finally {\n              delete c[a];\n            }\n          }, Cc: function Cc(c, e) {\n            var f = [];b(c, f);for (var g = 0, h = f.length; g < h; g++) {\n              var l = f[g].Qc,\n                  m = [l];e && a.a.ta(m, e);a.N.Bc(f[g].hd, m);l.nodeValue = \"\";l.parentNode && l.parentNode.removeChild(l);\n            }\n          }, pc: function pc(a) {\n            return (a = a.match(/^\\[ko_memo\\:(.*?)\\]$/)) ? a[1] : null;\n          } };\n      }();a.b(\"memoization\", a.N);a.b(\"memoization.memoize\", a.N.yb);a.b(\"memoization.unmemoize\", a.N.Bc);a.b(\"memoization.parseMemoText\", a.N.pc);a.b(\"memoization.unmemoizeDomNodeAndDescendants\", a.N.Cc);a.Z = function () {\n        function b() {\n          if (e) for (var b = e, c = 0, m; g < e;) {\n            if (m = d[g++]) {\n              if (g > b) {\n                if (5E3 <= ++c) {\n                  g = e;a.a.dc(Error(\"'Too much recursion' after processing \" + c + \" task groups.\"));break;\n                }b = e;\n              }try {\n                m();\n              } catch (k) {\n                a.a.dc(k);\n              }\n            }\n          }\n        }function c() {\n          b();g = e = d.length = 0;\n        }var d = [],\n            e = 0,\n            f = 1,\n            g = 0;return { scheduler: x.MutationObserver ? function (a) {\n            var b = t.createElement(\"div\");new MutationObserver(a).observe(b, { attributes: !0 });return function () {\n              b.classList.toggle(\"foo\");\n            };\n          }(c) : t && \"onreadystatechange\" in t.createElement(\"script\") ? function (a) {\n            var b = t.createElement(\"script\");b.onreadystatechange = function () {\n              b.onreadystatechange = null;t.documentElement.removeChild(b);b = null;a();\n            };t.documentElement.appendChild(b);\n          } : function (a) {\n            setTimeout(a, 0);\n          }, Za: function Za(b) {\n            e || a.Z.scheduler(c);d[e++] = b;return f++;\n          }, cancel: function cancel(a) {\n            a -= f - e;a >= g && a < e && (d[a] = null);\n          }, resetForTesting: function resetForTesting() {\n            var a = e - g;g = e = d.length = 0;return a;\n          }, rd: b };\n      }();a.b(\"tasks\", a.Z);a.b(\"tasks.schedule\", a.Z.Za);a.b(\"tasks.runEarly\", a.Z.rd);a.Aa = { throttle: function throttle(b, c) {\n          b.throttleEvaluation = c;var d = null;return a.B({ read: b, write: function write(e) {\n              clearTimeout(d);\n              d = a.a.setTimeout(function () {\n                b(e);\n              }, c);\n            } });\n        }, rateLimit: function rateLimit(a, c) {\n          var d, e, f;\"number\" == typeof c ? d = c : (d = c.timeout, e = c.method);a.gb = !1;f = \"notifyWhenChangesStop\" == e ? T : S;a.Wa(function (a) {\n            return f(a, d);\n          });\n        }, deferred: function deferred(b, c) {\n          if (!0 !== c) throw Error(\"The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.\");b.gb || (b.gb = !0, b.Wa(function (c) {\n            var e,\n                f = !1;return function () {\n              if (!f) {\n                a.Z.cancel(e);e = a.Z.Za(c);try {\n                  f = !0, b.notifySubscribers(n, \"dirty\");\n                } finally {\n                  f = !1;\n                }\n              }\n            };\n          }));\n        }, notify: function notify(a, c) {\n          a.equalityComparer = \"always\" == c ? null : J;\n        } };var R = { undefined: 1, \"boolean\": 1, number: 1, string: 1 };a.b(\"extenders\", a.Aa);a.zc = function (b, c, d) {\n        this.$ = b;this.jb = c;this.Pc = d;this.T = !1;a.H(this, \"dispose\", this.k);\n      };a.zc.prototype.k = function () {\n        this.T = !0;this.Pc();\n      };a.K = function () {\n        a.a.ab(this, D);D.ub(this);\n      };var E = \"change\",\n          D = { ub: function ub(a) {\n          a.F = { change: [] };a.Qb = 1;\n        }, Y: function Y(b, c, d) {\n          var e = this;d = d || E;var f = new a.zc(e, c ? b.bind(c) : b, function () {\n            a.a.Na(e.F[d], f);e.Ka && e.Ka(d);\n          });e.ua && e.ua(d);\n          e.F[d] || (e.F[d] = []);e.F[d].push(f);return f;\n        }, notifySubscribers: function notifySubscribers(b, c) {\n          c = c || E;c === E && this.Kb();if (this.Ra(c)) {\n            var d = c === E && this.Fc || this.F[c].slice(0);try {\n              a.l.Xb();for (var e = 0, f; f = d[e]; ++e) {\n                f.T || f.jb(b);\n              }\n            } finally {\n              a.l.end();\n            }\n          }\n        }, Pa: function Pa() {\n          return this.Qb;\n        }, Zc: function Zc(a) {\n          return this.Pa() !== a;\n        }, Kb: function Kb() {\n          ++this.Qb;\n        }, Wa: function Wa(b) {\n          var c = this,\n              d = a.I(c),\n              e,\n              f,\n              g,\n              h;c.Ja || (c.Ja = c.notifySubscribers, c.notifySubscribers = U);var l = b(function () {\n            c.Ha = !1;d && h === c && (h = c.Mb ? c.Mb() : c());var a = f || c.Ua(g, h);f = e = !1;\n            a && c.Ja(g = h);\n          });c.Pb = function (a) {\n            c.Fc = c.F[E].slice(0);c.Ha = e = !0;h = a;l();\n          };c.Ob = function (a) {\n            e || (g = a, c.Ja(a, \"beforeChange\"));\n          };c.Hc = function () {\n            c.Ua(g, c.p(!0)) && (f = !0);\n          };\n        }, Ra: function Ra(a) {\n          return this.F[a] && this.F[a].length;\n        }, Xc: function Xc(b) {\n          if (b) return this.F[b] && this.F[b].length || 0;var c = 0;a.a.D(this.F, function (a, b) {\n            \"dirty\" !== a && (c += b.length);\n          });return c;\n        }, Ua: function Ua(a, c) {\n          return !this.equalityComparer || !this.equalityComparer(a, c);\n        }, extend: function extend(b) {\n          var c = this;b && a.a.D(b, function (b, e) {\n            var f = a.Aa[b];\"function\" == typeof f && (c = f(c, e) || c);\n          });return c;\n        } };a.H(D, \"subscribe\", D.Y);a.H(D, \"extend\", D.extend);a.H(D, \"getSubscriptionsCount\", D.Xc);a.a.la && a.a.$a(D, Function.prototype);a.K.fn = D;a.lc = function (a) {\n        return null != a && \"function\" == typeof a.Y && \"function\" == typeof a.notifySubscribers;\n      };a.b(\"subscribable\", a.K);a.b(\"isSubscribable\", a.lc);a.xa = a.l = function () {\n        function b(a) {\n          d.push(e);e = a;\n        }function c() {\n          e = d.pop();\n        }var d = [],\n            e,\n            f = 0;return { Xb: b, end: c, sc: function sc(b) {\n            if (e) {\n              if (!a.lc(b)) throw Error(\"Only subscribable things can act as dependencies\");\n              e.jb.call(e.Lc, b, b.Gc || (b.Gc = ++f));\n            }\n          }, w: function w(a, d, e) {\n            try {\n              return b(), a.apply(d, e || []);\n            } finally {\n              c();\n            }\n          }, Ca: function Ca() {\n            if (e) return e.m.Ca();\n          }, Va: function Va() {\n            if (e) return e.Va;\n          } };\n      }();a.b(\"computedContext\", a.xa);a.b(\"computedContext.getDependenciesCount\", a.xa.Ca);a.b(\"computedContext.isInitial\", a.xa.Va);a.b(\"ignoreDependencies\", a.wd = a.l.w);var F = a.a.bc(\"_latestValue\");a.O = function (b) {\n        function c() {\n          if (0 < arguments.length) return c.Ua(c[F], arguments[0]) && (c.ia(), c[F] = arguments[0], c.ha()), this;a.l.sc(c);return c[F];\n        }\n        c[F] = b;a.a.la || a.a.extend(c, a.K.fn);a.K.fn.ub(c);a.a.ab(c, B);a.options.deferUpdates && a.Aa.deferred(c, !0);return c;\n      };var B = { equalityComparer: J, p: function p() {\n          return this[F];\n        }, ha: function ha() {\n          this.notifySubscribers(this[F]);\n        }, ia: function ia() {\n          this.notifySubscribers(this[F], \"beforeChange\");\n        } };a.a.la && a.a.$a(B, a.K.fn);var I = a.O.md = \"__ko_proto__\";B[I] = a.O;a.Qa = function (b, c) {\n        return null === b || b === n || b[I] === n ? !1 : b[I] === c ? !0 : a.Qa(b[I], c);\n      };a.I = function (b) {\n        return a.Qa(b, a.O);\n      };a.Da = function (b) {\n        return \"function\" == typeof b && b[I] === a.O || \"function\" == typeof b && b[I] === a.B && b.$c ? !0 : !1;\n      };a.b(\"observable\", a.O);a.b(\"isObservable\", a.I);a.b(\"isWriteableObservable\", a.Da);a.b(\"isWritableObservable\", a.Da);a.b(\"observable.fn\", B);a.H(B, \"peek\", B.p);a.H(B, \"valueHasMutated\", B.ha);a.H(B, \"valueWillMutate\", B.ia);a.ma = function (b) {\n        b = b || [];if (\"object\" != (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) || !(\"length\" in b)) throw Error(\"The argument passed when initializing an observable array must be an array, or null, or undefined.\");b = a.O(b);a.a.ab(b, a.ma.fn);return b.extend({ trackArrayChanges: !0 });\n      };\n      a.ma.fn = { remove: function remove(b) {\n          for (var c = this.p(), d = [], e = \"function\" != typeof b || a.I(b) ? function (a) {\n            return a === b;\n          } : b, f = 0; f < c.length; f++) {\n            var g = c[f];e(g) && (0 === d.length && this.ia(), d.push(g), c.splice(f, 1), f--);\n          }d.length && this.ha();return d;\n        }, removeAll: function removeAll(b) {\n          if (b === n) {\n            var c = this.p(),\n                d = c.slice(0);this.ia();c.splice(0, c.length);this.ha();return d;\n          }return b ? this.remove(function (c) {\n            return 0 <= a.a.o(b, c);\n          }) : [];\n        }, destroy: function destroy(b) {\n          var c = this.p(),\n              d = \"function\" != typeof b || a.I(b) ? function (a) {\n            return a === b;\n          } : b;this.ia();\n          for (var e = c.length - 1; 0 <= e; e--) {\n            d(c[e]) && (c[e]._destroy = !0);\n          }this.ha();\n        }, destroyAll: function destroyAll(b) {\n          return b === n ? this.destroy(function () {\n            return !0;\n          }) : b ? this.destroy(function (c) {\n            return 0 <= a.a.o(b, c);\n          }) : [];\n        }, indexOf: function indexOf(b) {\n          var c = this();return a.a.o(c, b);\n        }, replace: function replace(a, c) {\n          var d = this.indexOf(a);0 <= d && (this.ia(), this.p()[d] = c, this.ha());\n        } };a.a.la && a.a.$a(a.ma.fn, a.O.fn);a.a.r(\"pop push reverse shift sort splice unshift\".split(\" \"), function (b) {\n        a.ma.fn[b] = function () {\n          var a = this.p();this.ia();this.Yb(a, b, arguments);\n          var d = a[b].apply(a, arguments);this.ha();return d === a ? this : d;\n        };\n      });a.a.r([\"slice\"], function (b) {\n        a.ma.fn[b] = function () {\n          var a = this();return a[b].apply(a, arguments);\n        };\n      });a.b(\"observableArray\", a.ma);a.Aa.trackArrayChanges = function (b, c) {\n        function d() {\n          if (!e) {\n            e = !0;l = b.notifySubscribers;b.notifySubscribers = function (a, b) {\n              b && b !== E || ++h;return l.apply(this, arguments);\n            };var c = [].concat(b.p() || []);f = null;g = b.Y(function (d) {\n              d = [].concat(d || []);if (b.Ra(\"arrayChange\")) {\n                var e;if (!f || 1 < h) f = a.a.lb(c, d, b.kb);e = f;\n              }c = d;f = null;h = 0;\n              e && e.length && b.notifySubscribers(e, \"arrayChange\");\n            });\n          }\n        }b.kb = {};c && \"object\" == (typeof c === \"undefined\" ? \"undefined\" : _typeof(c)) && a.a.extend(b.kb, c);b.kb.sparse = !0;if (!b.Yb) {\n          var e = !1,\n              f = null,\n              g,\n              h = 0,\n              l,\n              m = b.ua,\n              k = b.Ka;b.ua = function (a) {\n            m && m.call(b, a);\"arrayChange\" === a && d();\n          };b.Ka = function (a) {\n            k && k.call(b, a);\"arrayChange\" !== a || b.Ra(\"arrayChange\") || (l && (b.notifySubscribers = l, l = n), g.k(), e = !1);\n          };b.Yb = function (b, c, d) {\n            function k(a, b, c) {\n              return m[m.length] = { status: a, value: b, index: c };\n            }if (e && !h) {\n              var m = [],\n                  l = b.length,\n                  g = d.length,\n                  G = 0;switch (c) {case \"push\":\n                  G = l;case \"unshift\":\n                  for (c = 0; c < g; c++) {\n                    k(\"added\", d[c], G + c);\n                  }break;case \"pop\":\n                  G = l - 1;case \"shift\":\n                  l && k(\"deleted\", b[G], G);break;case \"splice\":\n                  c = Math.min(Math.max(0, 0 > d[0] ? l + d[0] : d[0]), l);for (var l = 1 === g ? l : Math.min(c + (d[1] || 0), l), g = c + g - 2, G = Math.max(l, g), n = [], s = [], w = 2; c < G; ++c, ++w) {\n                    c < l && s.push(k(\"deleted\", b[c], c)), c < g && n.push(k(\"added\", d[w], c));\n                  }a.a.hc(s, n);break;default:\n                  return;}f = m;\n            }\n          };\n        }\n      };var s = a.a.bc(\"_state\");a.m = a.B = function (b, c, d) {\n        function e() {\n          if (0 < arguments.length) {\n            if (\"function\" === typeof f) f.apply(g.sb, arguments);else throw Error(\"Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.\");\n            return this;\n          }a.l.sc(e);(g.V || g.t && e.Sa()) && e.U();return g.M;\n        }\"object\" === (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) ? d = b : (d = d || {}, b && (d.read = b));if (\"function\" != typeof d.read) throw Error(\"Pass a function that returns the value of the ko.computed\");var f = d.write,\n            g = { M: n, da: !0, V: !0, Ta: !1, Hb: !1, T: !1, Ya: !1, t: !1, od: d.read, sb: c || d.owner, i: d.disposeWhenNodeIsRemoved || d.i || null, ya: d.disposeWhen || d.ya, pb: null, s: {}, L: 0, fc: null };e[s] = g;e.$c = \"function\" === typeof f;a.a.la || a.a.extend(e, a.K.fn);a.K.fn.ub(e);a.a.ab(e, z);d.pure ? (g.Ya = !0, g.t = !0, a.a.extend(e, Y)) : d.deferEvaluation && a.a.extend(e, Z);a.options.deferUpdates && a.Aa.deferred(e, !0);g.i && (g.Hb = !0, g.i.nodeType || (g.i = null));g.t || d.deferEvaluation || e.U();g.i && e.ca() && a.a.G.qa(g.i, g.pb = function () {\n          e.k();\n        });return e;\n      };var z = { equalityComparer: J, Ca: function Ca() {\n          return this[s].L;\n        }, Sb: function Sb(a, c, d) {\n          if (this[s].Ya && c === this) throw Error(\"A 'pure' computed must not be called recursively\");this[s].s[a] = d;d.Ia = this[s].L++;d.pa = c.Pa();\n        }, Sa: function Sa() {\n          var a,\n              c,\n              d = this[s].s;for (a in d) {\n            if (d.hasOwnProperty(a) && (c = d[a], this.oa && c.$.Ha || c.$.Zc(c.pa))) return !0;\n          }\n        }, gd: function gd() {\n          this.oa && !this[s].Ta && this.oa(!1);\n        }, ca: function ca() {\n          var a = this[s];return a.V || 0 < a.L;\n        }, qd: function qd() {\n          this.Ha ? this[s].V && (this[s].da = !0) : this.ec();\n        }, yc: function yc(a) {\n          if (a.gb && !this[s].i) {\n            var c = a.Y(this.gd, this, \"dirty\"),\n                d = a.Y(this.qd, this);return { $: a, k: function k() {\n                c.k();d.k();\n              } };\n          }return a.Y(this.ec, this);\n        }, ec: function ec() {\n          var b = this,\n              c = b.throttleEvaluation;c && 0 <= c ? (clearTimeout(this[s].fc), this[s].fc = a.a.setTimeout(function () {\n            b.U(!0);\n          }, c)) : b.oa ? b.oa(!0) : b.U(!0);\n        }, U: function U(b) {\n          var c = this[s],\n              d = c.ya,\n              e = !1;if (!c.Ta && !c.T) {\n            if (c.i && !a.a.qb(c.i) || d && d()) {\n              if (!c.Hb) {\n                this.k();return;\n              }\n            } else c.Hb = !1;c.Ta = !0;try {\n              e = this.Vc(b);\n            } finally {\n              c.Ta = !1;\n            }c.L || this.k();return e;\n          }\n        }, Vc: function Vc(b) {\n          var c = this[s],\n              d = !1,\n              e = c.Ya ? n : !c.L,\n              f = { Mc: this, Oa: c.s, ob: c.L };a.l.Xb({ Lc: f, jb: W, m: this, Va: e });c.s = {};c.L = 0;f = this.Uc(c, f);this.Ua(c.M, f) && (c.t || this.notifySubscribers(c.M, \"beforeChange\"), c.M = f, c.t ? this.Kb() : b && this.notifySubscribers(c.M), d = !0);e && this.notifySubscribers(c.M, \"awake\");return d;\n        }, Uc: function Uc(b, c) {\n          try {\n            var d = b.od;return b.sb ? d.call(b.sb) : d();\n          } finally {\n            a.l.end(), c.ob && !b.t && a.a.D(c.Oa, V), b.da = b.V = !1;\n          }\n        }, p: function p(a) {\n          var c = this[s];(c.V && (a || !c.L) || c.t && this.Sa()) && this.U();return c.M;\n        }, Wa: function Wa(b) {\n          a.K.fn.Wa.call(this, b);this.Mb = function () {\n            this[s].da ? this.U() : this[s].V = !1;return this[s].M;\n          };this.oa = function (a) {\n            this.Ob(this[s].M);this[s].V = !0;a && (this[s].da = !0);this.Pb(this);\n          };\n        }, k: function k() {\n          var b = this[s];!b.t && b.s && a.a.D(b.s, function (a, b) {\n            b.k && b.k();\n          });b.i && b.pb && a.a.G.tc(b.i, b.pb);b.s = null;b.L = 0;b.T = !0;b.da = !1;b.V = !1;b.t = !1;b.i = null;\n        } },\n          Y = { ua: function ua(b) {\n          var c = this,\n              d = c[s];if (!d.T && d.t && \"change\" == b) {\n            d.t = !1;if (d.da || c.Sa()) d.s = null, d.L = 0, c.U() && c.Kb();else {\n              var e = [];a.a.D(d.s, function (a, b) {\n                e[b.Ia] = a;\n              });a.a.r(e, function (a, b) {\n                var e = d.s[a],\n                    l = c.yc(e.$);l.Ia = b;l.pa = e.pa;d.s[a] = l;\n              });\n            }d.T || c.notifySubscribers(d.M, \"awake\");\n          }\n        }, Ka: function Ka(b) {\n          var c = this[s];c.T || \"change\" != b || this.Ra(\"change\") || (a.a.D(c.s, function (a, b) {\n            b.k && (c.s[a] = { $: b.$, Ia: b.Ia, pa: b.pa }, b.k());\n          }), c.t = !0, this.notifySubscribers(n, \"asleep\"));\n        }, Pa: function Pa() {\n          var b = this[s];b.t && (b.da || this.Sa()) && this.U();return a.K.fn.Pa.call(this);\n        } },\n          Z = { ua: function ua(a) {\n          \"change\" != a && \"beforeChange\" != a || this.p();\n        } };a.a.la && a.a.$a(z, a.K.fn);var P = a.O.md;a.m[P] = a.O;z[P] = a.m;a.bd = function (b) {\n        return a.Qa(b, a.m);\n      };a.cd = function (b) {\n        return a.Qa(b, a.m) && b[s] && b[s].Ya;\n      };a.b(\"computed\", a.m);a.b(\"dependentObservable\", a.m);a.b(\"isComputed\", a.bd);a.b(\"isPureComputed\", a.cd);a.b(\"computed.fn\", z);a.H(z, \"peek\", z.p);a.H(z, \"dispose\", z.k);a.H(z, \"isActive\", z.ca);a.H(z, \"getDependenciesCount\", z.Ca);a.rc = function (b, c) {\n        if (\"function\" === typeof b) return a.m(b, c, { pure: !0 });b = a.a.extend({}, b);b.pure = !0;return a.m(b, c);\n      };a.b(\"pureComputed\", a.rc);(function () {\n        function b(a, f, g) {\n          g = g || new d();a = f(a);if (\"object\" != (typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) || null === a || a === n || a instanceof RegExp || a instanceof Date || a instanceof String || a instanceof Number || a instanceof Boolean) return a;var h = a instanceof Array ? [] : {};g.save(a, h);c(a, function (c) {\n            var d = f(a[c]);switch (typeof d === \"undefined\" ? \"undefined\" : _typeof(d)) {case \"boolean\":case \"number\":case \"string\":case \"function\":\n                h[c] = d;break;case \"object\":case \"undefined\":\n                var k = g.get(d);h[c] = k !== n ? k : b(d, f, g);}\n          });return h;\n        }function c(a, b) {\n          if (a instanceof Array) {\n            for (var c = 0; c < a.length; c++) {\n              b(c);\n            }\"function\" == typeof a.toJSON && b(\"toJSON\");\n          } else for (c in a) {\n            b(c);\n          }\n        }function d() {\n          this.keys = [];this.Lb = [];\n        }a.Ac = function (c) {\n          if (0 == arguments.length) throw Error(\"When calling ko.toJS, pass the object you want to convert.\");return b(c, function (b) {\n            for (var c = 0; a.I(b) && 10 > c; c++) {\n              b = b();\n            }return b;\n          });\n        };a.toJSON = function (b, c, d) {\n          b = a.Ac(b);return a.a.Gb(b, c, d);\n        };d.prototype = { save: function save(b, c) {\n            var d = a.a.o(this.keys, b);0 <= d ? this.Lb[d] = c : (this.keys.push(b), this.Lb.push(c));\n          }, get: function get(b) {\n            b = a.a.o(this.keys, b);return 0 <= b ? this.Lb[b] : n;\n          } };\n      })();a.b(\"toJS\", a.Ac);a.b(\"toJSON\", a.toJSON);(function () {\n        a.j = { u: function u(b) {\n            switch (a.a.A(b)) {case \"option\":\n                return !0 === b.__ko__hasDomDataOptionValue__ ? a.a.e.get(b, a.d.options.zb) : 7 >= a.a.C ? b.getAttributeNode(\"value\") && b.getAttributeNode(\"value\").specified ? b.value : b.text : b.value;case \"select\":\n                return 0 <= b.selectedIndex ? a.j.u(b.options[b.selectedIndex]) : n;default:\n                return b.value;}\n          }, ja: function ja(b, c, d) {\n            switch (a.a.A(b)) {case \"option\":\n                switch (typeof c === \"undefined\" ? \"undefined\" : _typeof(c)) {case \"string\":\n                    a.a.e.set(b, a.d.options.zb, n);\"__ko__hasDomDataOptionValue__\" in b && delete b.__ko__hasDomDataOptionValue__;b.value = c;break;default:\n                    a.a.e.set(b, a.d.options.zb, c), b.__ko__hasDomDataOptionValue__ = !0, b.value = \"number\" === typeof c ? c : \"\";}break;case \"select\":\n                if (\"\" === c || null === c) c = n;for (var e = -1, f = 0, g = b.options.length, h; f < g; ++f) {\n                  if (h = a.j.u(b.options[f]), h == c || \"\" == h && c === n) {\n                    e = f;break;\n                  }\n                }if (d || 0 <= e || c === n && 1 < b.size) b.selectedIndex = e;break;default:\n                if (null === c || c === n) c = \"\";b.value = c;}\n          } };\n      })();a.b(\"selectExtensions\", a.j);a.b(\"selectExtensions.readValue\", a.j.u);a.b(\"selectExtensions.writeValue\", a.j.ja);a.h = function () {\n        function b(b) {\n          b = a.a.cb(b);123 === b.charCodeAt(0) && (b = b.slice(1, -1));var c = [],\n              d = b.match(e),\n              r,\n              h = [],\n              p = 0;if (d) {\n            d.push(\",\");for (var A = 0, y; y = d[A]; ++A) {\n              var v = y.charCodeAt(0);if (44 === v) {\n                if (0 >= p) {\n                  c.push(r && h.length ? { key: r, value: h.join(\"\") } : { unknown: r || h.join(\"\") });r = p = 0;h = [];continue;\n                }\n              } else if (58 === v) {\n                if (!p && !r && 1 === h.length) {\n                  r = h.pop();continue;\n                }\n              } else 47 === v && A && 1 < y.length ? (v = d[A - 1].match(f)) && !g[v[0]] && (b = b.substr(b.indexOf(y) + 1), d = b.match(e), d.push(\",\"), A = -1, y = \"/\") : 40 === v || 123 === v || 91 === v ? ++p : 41 === v || 125 === v || 93 === v ? --p : r || h.length || 34 !== v && 39 !== v || (y = y.slice(1, -1));h.push(y);\n            }\n          }return c;\n        }var c = [\"true\", \"false\", \"null\", \"undefined\"],\n            d = /^(?:[$_a-z][$\\w]*|(.+)(\\.\\s*[$_a-z][$\\w]*|\\[.+\\]))$/i,\n            e = RegExp(\"\\\"(?:[^\\\"\\\\\\\\]|\\\\\\\\.)*\\\"|'(?:[^'\\\\\\\\]|\\\\\\\\.)*'|/(?:[^/\\\\\\\\]|\\\\\\\\.)*/w*|[^\\\\s:,/][^,\\\"'{}()/:[\\\\]]*[^\\\\s,\\\"'{}()/:[\\\\]]|[^\\\\s]\", \"g\"),\n            f = /[\\])\"'A-Za-z0-9_$]+$/,\n            g = { \"in\": 1, \"return\": 1, \"typeof\": 1 },\n            h = {};return { va: [], ga: h, Ab: b, Xa: function Xa(e, m) {\n            function k(b, e) {\n              var m;if (!A) {\n                var l = a.getBindingHandler(b);if (l && l.preprocess && !(e = l.preprocess(e, b, k))) return;if (l = h[b]) m = e, 0 <= a.a.o(c, m) ? m = !1 : (l = m.match(d), m = null === l ? !1 : l[1] ? \"Object(\" + l[1] + \")\" + l[2] : m), l = m;l && g.push(\"'\" + b + \"':function(_z){\" + m + \"=_z}\");\n              }p && (e = \"function(){return \" + e + \" }\");f.push(\"'\" + b + \"':\" + e);\n            }m = m || {};var f = [],\n                g = [],\n                p = m.valueAccessors,\n                A = m.bindingParams,\n                y = \"string\" === typeof e ? b(e) : e;a.a.r(y, function (a) {\n              k(a.key || a.unknown, a.value);\n            });g.length && k(\"_ko_property_writers\", \"{\" + g.join(\",\") + \" }\");return f.join(\",\");\n          }, fd: function fd(a, b) {\n            for (var c = 0; c < a.length; c++) {\n              if (a[c].key == b) return !0;\n            }return !1;\n          }, Ga: function Ga(b, c, d, e, f) {\n            if (b && a.I(b)) !a.Da(b) || f && b.p() === e || b(e);else if ((b = c.get(\"_ko_property_writers\")) && b[d]) b[d](e);\n          } };\n      }();a.b(\"expressionRewriting\", a.h);a.b(\"expressionRewriting.bindingRewriteValidators\", a.h.va);a.b(\"expressionRewriting.parseObjectLiteral\", a.h.Ab);a.b(\"expressionRewriting.preProcessBindings\", a.h.Xa);a.b(\"expressionRewriting._twoWayBindings\", a.h.ga);a.b(\"jsonExpressionRewriting\", a.h);a.b(\"jsonExpressionRewriting.insertPropertyAccessorsIntoJson\", a.h.Xa);(function () {\n        function b(a) {\n          return 8 == a.nodeType && g.test(f ? a.text : a.nodeValue);\n        }function c(a) {\n          return 8 == a.nodeType && h.test(f ? a.text : a.nodeValue);\n        }function d(a, d) {\n          for (var e = a, f = 1, l = []; e = e.nextSibling;) {\n            if (c(e) && (f--, 0 === f)) return l;l.push(e);b(e) && f++;\n          }if (!d) throw Error(\"Cannot find closing comment tag to match: \" + a.nodeValue);return null;\n        }function e(a, b) {\n          var c = d(a, b);return c ? 0 < c.length ? c[c.length - 1].nextSibling : a.nextSibling : null;\n        }var f = t && \"\\x3c!--test--\\x3e\" === t.createComment(\"test\").text,\n            g = f ? /^\\x3c!--\\s*ko(?:\\s+([\\s\\S]+))?\\s*--\\x3e$/ : /^\\s*ko(?:\\s+([\\s\\S]+))?\\s*$/,\n            h = f ? /^\\x3c!--\\s*\\/ko\\s*--\\x3e$/ : /^\\s*\\/ko\\s*$/,\n            l = { ul: !0, ol: !0 };a.f = { aa: {}, childNodes: function childNodes(a) {\n            return b(a) ? d(a) : a.childNodes;\n          }, za: function za(c) {\n            if (b(c)) {\n              c = a.f.childNodes(c);for (var d = 0, e = c.length; d < e; d++) {\n                a.removeNode(c[d]);\n              }\n            } else a.a.rb(c);\n          }, fa: function fa(c, d) {\n            if (b(c)) {\n              a.f.za(c);for (var e = c.nextSibling, f = 0, l = d.length; f < l; f++) {\n                e.parentNode.insertBefore(d[f], e);\n              }\n            } else a.a.fa(c, d);\n          }, qc: function qc(a, c) {\n            b(a) ? a.parentNode.insertBefore(c, a.nextSibling) : a.firstChild ? a.insertBefore(c, a.firstChild) : a.appendChild(c);\n          }, kc: function kc(c, d, e) {\n            e ? b(c) ? c.parentNode.insertBefore(d, e.nextSibling) : e.nextSibling ? c.insertBefore(d, e.nextSibling) : c.appendChild(d) : a.f.qc(c, d);\n          }, firstChild: function firstChild(a) {\n            return b(a) ? !a.nextSibling || c(a.nextSibling) ? null : a.nextSibling : a.firstChild;\n          }, nextSibling: function nextSibling(a) {\n            b(a) && (a = e(a));return a.nextSibling && c(a.nextSibling) ? null : a.nextSibling;\n          }, Yc: b, vd: function vd(a) {\n            return (a = (f ? a.text : a.nodeValue).match(g)) ? a[1] : null;\n          }, oc: function oc(d) {\n            if (l[a.a.A(d)]) {\n              var k = d.firstChild;if (k) {\n                do {\n                  if (1 === k.nodeType) {\n                    var f;f = k.firstChild;var g = null;if (f) {\n                      do {\n                        if (g) g.push(f);else if (b(f)) {\n                          var h = e(f, !0);h ? f = h : g = [f];\n                        } else c(f) && (g = [f]);\n                      } while (f = f.nextSibling);\n                    }if (f = g) for (g = k.nextSibling, h = 0; h < f.length; h++) {\n                      g ? d.insertBefore(f[h], g) : d.appendChild(f[h]);\n                    }\n                  }\n                } while (k = k.nextSibling);\n              }\n            }\n          } };\n      })();a.b(\"virtualElements\", a.f);a.b(\"virtualElements.allowedBindings\", a.f.aa);a.b(\"virtualElements.emptyNode\", a.f.za);a.b(\"virtualElements.insertAfter\", a.f.kc);a.b(\"virtualElements.prepend\", a.f.qc);a.b(\"virtualElements.setDomNodeChildren\", a.f.fa);(function () {\n        a.S = function () {\n          this.Kc = {};\n        };a.a.extend(a.S.prototype, { nodeHasBindings: function nodeHasBindings(b) {\n            switch (b.nodeType) {case 1:\n                return null != b.getAttribute(\"data-bind\") || a.g.getComponentNameForNode(b);case 8:\n                return a.f.Yc(b);default:\n                return !1;}\n          }, getBindings: function getBindings(b, c) {\n            var d = this.getBindingsString(b, c),\n                d = d ? this.parseBindingsString(d, c, b) : null;return a.g.Rb(d, b, c, !1);\n          }, getBindingAccessors: function getBindingAccessors(b, c) {\n            var d = this.getBindingsString(b, c),\n                d = d ? this.parseBindingsString(d, c, b, { valueAccessors: !0 }) : null;return a.g.Rb(d, b, c, !0);\n          }, getBindingsString: function getBindingsString(b) {\n            switch (b.nodeType) {case 1:\n                return b.getAttribute(\"data-bind\");case 8:\n                return a.f.vd(b);default:\n                return null;}\n          }, parseBindingsString: function parseBindingsString(b, c, d, e) {\n            try {\n              var f = this.Kc,\n                  g = b + (e && e.valueAccessors || \"\"),\n                  h;if (!(h = f[g])) {\n                var l,\n                    m = \"with($context){with($data||{}){return{\" + a.h.Xa(b, e) + \"}}}\";l = new Function(\"$context\", \"$element\", m);h = f[g] = l;\n              }return h(c, d);\n            } catch (k) {\n              throw k.message = \"Unable to parse bindings.\\nBindings value: \" + b + \"\\nMessage: \" + k.message, k;\n            }\n          } });a.S.instance = new a.S();\n      })();a.b(\"bindingProvider\", a.S);(function () {\n        function b(a) {\n          return function () {\n            return a;\n          };\n        }function c(a) {\n          return a();\n        }function d(b) {\n          return a.a.Ea(a.l.w(b), function (a, c) {\n            return function () {\n              return b()[c];\n            };\n          });\n        }function e(c, e, k) {\n          return \"function\" === typeof c ? d(c.bind(null, e, k)) : a.a.Ea(c, b);\n        }function f(a, b) {\n          return d(this.getBindings.bind(this, a, b));\n        }function g(b, c, d) {\n          var e,\n              k = a.f.firstChild(c),\n              f = a.S.instance,\n              m = f.preprocessNode;if (m) {\n            for (; e = k;) {\n              k = a.f.nextSibling(e), m.call(f, e);\n            }k = a.f.firstChild(c);\n          }for (; e = k;) {\n            k = a.f.nextSibling(e), h(b, e, d);\n          }\n        }function h(b, c, d) {\n          var e = !0,\n              k = 1 === c.nodeType;k && a.f.oc(c);if (k && d || a.S.instance.nodeHasBindings(c)) e = m(c, null, b, d).shouldBindDescendants;e && !r[a.a.A(c)] && g(b, c, !k);\n        }function l(b) {\n          var c = [],\n              d = {},\n              e = [];a.a.D(b, function X(k) {\n            if (!d[k]) {\n              var f = a.getBindingHandler(k);f && (f.after && (e.push(k), a.a.r(f.after, function (c) {\n                if (b[c]) {\n                  if (-1 !== a.a.o(e, c)) throw Error(\"Cannot combine the following bindings, because they have a cyclic dependency: \" + e.join(\", \"));\n                  X(c);\n                }\n              }), e.length--), c.push({ key: k, jc: f }));d[k] = !0;\n            }\n          });return c;\n        }function m(b, d, e, k) {\n          var m = a.a.e.get(b, q);if (!d) {\n            if (m) throw Error(\"You cannot apply bindings multiple times to the same element.\");a.a.e.set(b, q, !0);\n          }!m && k && a.xc(b, e);var g;if (d && \"function\" !== typeof d) g = d;else {\n            var h = a.S.instance,\n                r = h.getBindingAccessors || f,\n                p = a.B(function () {\n              (g = d ? d(e, b) : r.call(h, b, e)) && e.Q && e.Q();return g;\n            }, null, { i: b });g && p.ca() || (p = null);\n          }var s;if (g) {\n            var t = p ? function (a) {\n              return function () {\n                return c(p()[a]);\n              };\n            } : function (a) {\n              return g[a];\n            },\n                u = function u() {\n              return a.a.Ea(p ? p() : g, c);\n            };u.get = function (a) {\n              return g[a] && c(t(a));\n            };u.has = function (a) {\n              return a in g;\n            };k = l(g);a.a.r(k, function (c) {\n              var d = c.jc.init,\n                  k = c.jc.update,\n                  f = c.key;if (8 === b.nodeType && !a.f.aa[f]) throw Error(\"The binding '\" + f + \"' cannot be used with virtual elements\");try {\n                \"function\" == typeof d && a.l.w(function () {\n                  var a = d(b, t(f), u, e.$data, e);if (a && a.controlsDescendantBindings) {\n                    if (s !== n) throw Error(\"Multiple bindings (\" + s + \" and \" + f + \") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.\");\n                    s = f;\n                  }\n                }), \"function\" == typeof k && a.B(function () {\n                  k(b, t(f), u, e.$data, e);\n                }, null, { i: b });\n              } catch (m) {\n                throw m.message = 'Unable to process binding \"' + f + \": \" + g[f] + '\"\\nMessage: ' + m.message, m;\n              }\n            });\n          }return { shouldBindDescendants: s === n };\n        }function k(b) {\n          return b && b instanceof a.R ? b : new a.R(b);\n        }a.d = {};var r = { script: !0, textarea: !0, template: !0 };a.getBindingHandler = function (b) {\n          return a.d[b];\n        };a.R = function (b, c, d, e, k) {\n          function f() {\n            var k = g ? b() : b,\n                m = a.a.c(k);c ? (c.Q && c.Q(), a.a.extend(l, c), l.Q = r) : (l.$parents = [], l.$root = m, l.ko = a);l.$rawData = k;l.$data = m;d && (l[d] = m);e && e(l, c, m);return l.$data;\n          }function m() {\n            return h && !a.a.Tb(h);\n          }var l = this,\n              g = \"function\" == typeof b && !a.I(b),\n              h,\n              r;k && k.exportDependencies ? f() : (r = a.B(f, null, { ya: m, i: !0 }), r.ca() && (l.Q = r, r.equalityComparer = null, h = [], r.Dc = function (b) {\n            h.push(b);a.a.G.qa(b, function (b) {\n              a.a.Na(h, b);h.length || (r.k(), l.Q = r = n);\n            });\n          }));\n        };a.R.prototype.createChildContext = function (b, c, d, e) {\n          return new a.R(b, this, c, function (a, b) {\n            a.$parentContext = b;a.$parent = b.$data;a.$parents = (b.$parents || []).slice(0);a.$parents.unshift(a.$parent);\n            d && d(a);\n          }, e);\n        };a.R.prototype.extend = function (b) {\n          return new a.R(this.Q || this.$data, this, null, function (c, d) {\n            c.$rawData = d.$rawData;a.a.extend(c, \"function\" == typeof b ? b() : b);\n          });\n        };a.R.prototype.ac = function (a, b) {\n          return this.createChildContext(a, b, null, { exportDependencies: !0 });\n        };var q = a.a.e.J(),\n            p = a.a.e.J();a.xc = function (b, c) {\n          if (2 == arguments.length) a.a.e.set(b, p, c), c.Q && c.Q.Dc(b);else return a.a.e.get(b, p);\n        };a.La = function (b, c, d) {\n          1 === b.nodeType && a.f.oc(b);return m(b, c, k(d), !0);\n        };a.Ic = function (b, c, d) {\n          d = k(d);return a.La(b, e(c, d, b), d);\n        };a.hb = function (a, b) {\n          1 !== b.nodeType && 8 !== b.nodeType || g(k(a), b, !0);\n        };a.Ub = function (a, b) {\n          !u && x.jQuery && (u = x.jQuery);if (b && 1 !== b.nodeType && 8 !== b.nodeType) throw Error(\"ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node\");b = b || x.document.body;h(k(a), b, !0);\n        };a.nb = function (b) {\n          switch (b.nodeType) {case 1:case 8:\n              var c = a.xc(b);if (c) return c;if (b.parentNode) return a.nb(b.parentNode);}return n;\n        };a.Oc = function (b) {\n          return (b = a.nb(b)) ? b.$data : n;\n        };a.b(\"bindingHandlers\", a.d);a.b(\"applyBindings\", a.Ub);a.b(\"applyBindingsToDescendants\", a.hb);a.b(\"applyBindingAccessorsToNode\", a.La);a.b(\"applyBindingsToNode\", a.Ic);a.b(\"contextFor\", a.nb);a.b(\"dataFor\", a.Oc);\n      })();(function (b) {\n        function c(c, e) {\n          var m = f.hasOwnProperty(c) ? f[c] : b,\n              k;m ? m.Y(e) : (m = f[c] = new a.K(), m.Y(e), d(c, function (b, d) {\n            var e = !(!d || !d.synchronous);g[c] = { definition: b, dd: e };delete f[c];k || e ? m.notifySubscribers(b) : a.Z.Za(function () {\n              m.notifySubscribers(b);\n            });\n          }), k = !0);\n        }function d(a, b) {\n          e(\"getConfig\", [a], function (c) {\n            c ? e(\"loadComponent\", [a, c], function (a) {\n              b(a, c);\n            }) : b(null, null);\n          });\n        }function e(c, d, f, k) {\n          k || (k = a.g.loaders.slice(0));var g = k.shift();if (g) {\n            var q = g[c];if (q) {\n              var p = !1;if (q.apply(g, d.concat(function (a) {\n                p ? f(null) : null !== a ? f(a) : e(c, d, f, k);\n              })) !== b && (p = !0, !g.suppressLoaderExceptions)) throw Error(\"Component loaders must supply values by invoking the callback, not by returning values synchronously.\");\n            } else e(c, d, f, k);\n          } else f(null);\n        }var f = {},\n            g = {};a.g = { get: function get(d, e) {\n            var f = g.hasOwnProperty(d) ? g[d] : b;f ? f.dd ? a.l.w(function () {\n              e(f.definition);\n            }) : a.Z.Za(function () {\n              e(f.definition);\n            }) : c(d, e);\n          }, $b: function $b(a) {\n            delete g[a];\n          }, Nb: e };a.g.loaders = [];a.b(\"components\", a.g);a.b(\"components.get\", a.g.get);a.b(\"components.clearCachedDefinition\", a.g.$b);\n      })();(function () {\n        function b(b, c, d, e) {\n          function g() {\n            0 === --y && e(h);\n          }var h = {},\n              y = 2,\n              v = d.template;d = d.viewModel;v ? f(c, v, function (c) {\n            a.g.Nb(\"loadTemplate\", [b, c], function (a) {\n              h.template = a;g();\n            });\n          }) : g();d ? f(c, d, function (c) {\n            a.g.Nb(\"loadViewModel\", [b, c], function (a) {\n              h[l] = a;g();\n            });\n          }) : g();\n        }function c(a, b, d) {\n          if (\"function\" === typeof b) d(function (a) {\n            return new b(a);\n          });else if (\"function\" === typeof b[l]) d(b[l]);else if (\"instance\" in b) {\n            var e = b.instance;d(function () {\n              return e;\n            });\n          } else \"viewModel\" in b ? c(a, b.viewModel, d) : a(\"Unknown viewModel value: \" + b);\n        }function d(b) {\n          switch (a.a.A(b)) {case \"script\":\n              return a.a.na(b.text);case \"textarea\":\n              return a.a.na(b.value);case \"template\":\n              if (e(b.content)) return a.a.wa(b.content.childNodes);}return a.a.wa(b.childNodes);\n        }function e(a) {\n          return x.DocumentFragment ? a instanceof DocumentFragment : a && 11 === a.nodeType;\n        }function f(a, b, c) {\n          \"string\" === typeof b.require ? O || x.require ? (O || x.require)([b.require], c) : a(\"Uses require, but no AMD loader is present\") : c(b);\n        }function g(a) {\n          return function (b) {\n            throw Error(\"Component '\" + a + \"': \" + b);\n          };\n        }var h = {};a.g.register = function (b, c) {\n          if (!c) throw Error(\"Invalid configuration for \" + b);if (a.g.wb(b)) throw Error(\"Component \" + b + \" is already registered\");h[b] = c;\n        };a.g.wb = function (a) {\n          return h.hasOwnProperty(a);\n        };a.g.ud = function (b) {\n          delete h[b];a.g.$b(b);\n        };a.g.cc = { getConfig: function getConfig(a, b) {\n            b(h.hasOwnProperty(a) ? h[a] : null);\n          }, loadComponent: function loadComponent(a, c, d) {\n            var e = g(a);f(e, c, function (c) {\n              b(a, e, c, d);\n            });\n          }, loadTemplate: function loadTemplate(b, c, f) {\n            b = g(b);if (\"string\" === typeof c) f(a.a.na(c));else if (c instanceof Array) f(c);else if (e(c)) f(a.a.W(c.childNodes));else if (c.element) {\n              if (c = c.element, x.HTMLElement ? c instanceof HTMLElement : c && c.tagName && 1 === c.nodeType) f(d(c));else if (\"string\" === typeof c) {\n                var l = t.getElementById(c);l ? f(d(l)) : b(\"Cannot find element with ID \" + c);\n              } else b(\"Unknown element type: \" + c);\n            } else b(\"Unknown template value: \" + c);\n          }, loadViewModel: function loadViewModel(a, b, d) {\n            c(g(a), b, d);\n          } };var l = \"createViewModel\";a.b(\"components.register\", a.g.register);a.b(\"components.isRegistered\", a.g.wb);a.b(\"components.unregister\", a.g.ud);a.b(\"components.defaultLoader\", a.g.cc);a.g.loaders.push(a.g.cc);a.g.Ec = h;\n      })();(function () {\n        function b(b, e) {\n          var f = b.getAttribute(\"params\");if (f) {\n            var f = c.parseBindingsString(f, e, b, { valueAccessors: !0, bindingParams: !0 }),\n                f = a.a.Ea(f, function (c) {\n              return a.m(c, null, { i: b });\n            }),\n                g = a.a.Ea(f, function (c) {\n              var e = c.p();return c.ca() ? a.m({ read: function read() {\n                  return a.a.c(c());\n                }, write: a.Da(e) && function (a) {\n                  c()(a);\n                }, i: b }) : e;\n            });g.hasOwnProperty(\"$raw\") || (g.$raw = f);return g;\n          }return { $raw: {} };\n        }a.g.getComponentNameForNode = function (b) {\n          var c = a.a.A(b);if (a.g.wb(c) && (-1 != c.indexOf(\"-\") || \"[object HTMLUnknownElement]\" == \"\" + b || 8 >= a.a.C && b.tagName === c)) return c;\n        };a.g.Rb = function (c, e, f, g) {\n          if (1 === e.nodeType) {\n            var h = a.g.getComponentNameForNode(e);if (h) {\n              c = c || {};if (c.component) throw Error('Cannot use the \"component\" binding on a custom element matching a component');var l = { name: h, params: b(e, f) };c.component = g ? function () {\n                return l;\n              } : l;\n            }\n          }return c;\n        };var c = new a.S();9 > a.a.C && (a.g.register = function (a) {\n          return function (b) {\n            t.createElement(b);return a.apply(this, arguments);\n          };\n        }(a.g.register), t.createDocumentFragment = function (b) {\n          return function () {\n            var c = b(),\n                f = a.g.Ec,\n                g;for (g in f) {\n              f.hasOwnProperty(g) && c.createElement(g);\n            }return c;\n          };\n        }(t.createDocumentFragment));\n      })();(function (b) {\n        function c(b, c, d) {\n          c = c.template;if (!c) throw Error(\"Component '\" + b + \"' has no template\");b = a.a.wa(c);a.f.fa(d, b);\n        }function d(a, b, c, d) {\n          var e = a.createViewModel;return e ? e.call(a, d, { element: b, templateNodes: c }) : d;\n        }var e = 0;a.d.component = { init: function init(f, g, h, l, m) {\n            function k() {\n              var a = r && r.dispose;\"function\" === typeof a && a.call(r);q = r = null;\n            }var r,\n                q,\n                p = a.a.W(a.f.childNodes(f));a.a.G.qa(f, k);a.m(function () {\n              var l = a.a.c(g()),\n                  h,\n                  v;\"string\" === typeof l ? h = l : (h = a.a.c(l.name), v = a.a.c(l.params));if (!h) throw Error(\"No component name specified\");var n = q = ++e;a.g.get(h, function (e) {\n                if (q === n) {\n                  k();if (!e) throw Error(\"Unknown component '\" + h + \"'\");c(h, e, f);var l = d(e, f, p, v);e = m.createChildContext(l, b, function (a) {\n                    a.$component = l;a.$componentTemplateNodes = p;\n                  });r = l;a.hb(e, f);\n                }\n              });\n            }, null, { i: f });return { controlsDescendantBindings: !0 };\n          } };a.f.aa.component = !0;\n      })();var Q = { \"class\": \"className\", \"for\": \"htmlFor\" };a.d.attr = { update: function update(b, c) {\n          var d = a.a.c(c()) || {};a.a.D(d, function (c, d) {\n            d = a.a.c(d);var g = !1 === d || null === d || d === n;g && b.removeAttribute(c);8 >= a.a.C && c in Q ? (c = Q[c], g ? b.removeAttribute(c) : b[c] = d) : g || b.setAttribute(c, d.toString());\"name\" === c && a.a.vc(b, g ? \"\" : d.toString());\n          });\n        } };(function () {\n        a.d.checked = { after: [\"value\", \"attr\"], init: function init(b, c, d) {\n            function e() {\n              var e = b.checked,\n                  f = p ? g() : e;if (!a.xa.Va() && (!l || e)) {\n                var h = a.l.w(c);if (k) {\n                  var m = r ? h.p() : h;q !== f ? (e && (a.a.ra(m, f, !0), a.a.ra(m, q, !1)), q = f) : a.a.ra(m, f, e);r && a.Da(h) && h(m);\n                } else a.h.Ga(h, d, \"checked\", f, !0);\n              }\n            }function f() {\n              var d = a.a.c(c());b.checked = k ? 0 <= a.a.o(d, g()) : h ? d : g() === d;\n            }var g = a.rc(function () {\n              return d.has(\"checkedValue\") ? a.a.c(d.get(\"checkedValue\")) : d.has(\"value\") ? a.a.c(d.get(\"value\")) : b.value;\n            }),\n                h = \"checkbox\" == b.type,\n                l = \"radio\" == b.type;if (h || l) {\n              var m = c(),\n                  k = h && a.a.c(m) instanceof Array,\n                  r = !(k && m.push && m.splice),\n                  q = k ? g() : n,\n                  p = l || k;l && !b.name && a.d.uniqueName.init(b, function () {\n                return !0;\n              });a.m(e, null, { i: b });a.a.q(b, \"click\", e);a.m(f, null, { i: b });m = n;\n            }\n          } };a.h.ga.checked = !0;a.d.checkedValue = { update: function update(b, c) {\n            b.value = a.a.c(c());\n          } };\n      })();a.d.css = { update: function update(b, c) {\n          var d = a.a.c(c());null !== d && \"object\" == (typeof d === \"undefined\" ? \"undefined\" : _typeof(d)) ? a.a.D(d, function (c, d) {\n            d = a.a.c(d);a.a.fb(b, c, d);\n          }) : (d = a.a.cb(String(d || \"\")), a.a.fb(b, b.__ko__cssValue, !1), b.__ko__cssValue = d, a.a.fb(b, d, !0));\n        } };a.d.enable = { update: function update(b, c) {\n          var d = a.a.c(c());\n          d && b.disabled ? b.removeAttribute(\"disabled\") : d || b.disabled || (b.disabled = !0);\n        } };a.d.disable = { update: function update(b, c) {\n          a.d.enable.update(b, function () {\n            return !a.a.c(c());\n          });\n        } };a.d.event = { init: function init(b, c, d, e, f) {\n          var g = c() || {};a.a.D(g, function (g) {\n            \"string\" == typeof g && a.a.q(b, g, function (b) {\n              var m,\n                  k = c()[g];if (k) {\n                try {\n                  var r = a.a.W(arguments);e = f.$data;r.unshift(e);m = k.apply(e, r);\n                } finally {\n                  !0 !== m && (b.preventDefault ? b.preventDefault() : b.returnValue = !1);\n                }!1 === d.get(g + \"Bubble\") && (b.cancelBubble = !0, b.stopPropagation && b.stopPropagation());\n              }\n            });\n          });\n        } };\n      a.d.foreach = { mc: function mc(b) {\n          return function () {\n            var c = b(),\n                d = a.a.Bb(c);if (!d || \"number\" == typeof d.length) return { foreach: c, templateEngine: a.X.vb };a.a.c(c);return { foreach: d.data, as: d.as, includeDestroyed: d.includeDestroyed, afterAdd: d.afterAdd, beforeRemove: d.beforeRemove, afterRender: d.afterRender, beforeMove: d.beforeMove, afterMove: d.afterMove, templateEngine: a.X.vb };\n          };\n        }, init: function init(b, c) {\n          return a.d.template.init(b, a.d.foreach.mc(c));\n        }, update: function update(b, c, d, e, f) {\n          return a.d.template.update(b, a.d.foreach.mc(c), d, e, f);\n        } };a.h.va.foreach = !1;a.f.aa.foreach = !0;a.d.hasfocus = { init: function init(b, c, d) {\n          function e(e) {\n            b.__ko_hasfocusUpdating = !0;var f = b.ownerDocument;if (\"activeElement\" in f) {\n              var g;try {\n                g = f.activeElement;\n              } catch (k) {\n                g = f.body;\n              }e = g === b;\n            }f = c();a.h.Ga(f, d, \"hasfocus\", e, !0);b.__ko_hasfocusLastValue = e;b.__ko_hasfocusUpdating = !1;\n          }var f = e.bind(null, !0),\n              g = e.bind(null, !1);a.a.q(b, \"focus\", f);a.a.q(b, \"focusin\", f);a.a.q(b, \"blur\", g);a.a.q(b, \"focusout\", g);\n        }, update: function update(b, c) {\n          var d = !!a.a.c(c());b.__ko_hasfocusUpdating || b.__ko_hasfocusLastValue === d || (d ? b.focus() : b.blur(), !d && b.__ko_hasfocusLastValue && b.ownerDocument.body.focus(), a.l.w(a.a.Fa, null, [b, d ? \"focusin\" : \"focusout\"]));\n        } };a.h.ga.hasfocus = !0;a.d.hasFocus = a.d.hasfocus;a.h.ga.hasFocus = !0;a.d.html = { init: function init() {\n          return { controlsDescendantBindings: !0 };\n        }, update: function update(b, c) {\n          a.a.Eb(b, c());\n        } };K(\"if\");K(\"ifnot\", !1, !0);K(\"with\", !0, !1, function (a, c) {\n        return a.ac(c);\n      });var L = {};a.d.options = { init: function init(b) {\n          if (\"select\" !== a.a.A(b)) throw Error(\"options binding applies only to SELECT elements\");for (; 0 < b.length;) {\n            b.remove(0);\n          }return { controlsDescendantBindings: !0 };\n        }, update: function update(b, c, d) {\n          function e() {\n            return a.a.Ma(b.options, function (a) {\n              return a.selected;\n            });\n          }function f(a, b, c) {\n            var d = typeof b === \"undefined\" ? \"undefined\" : _typeof(b);return \"function\" == d ? b(a) : \"string\" == d ? a[b] : c;\n          }function g(c, e) {\n            if (A && k) a.j.ja(b, a.a.c(d.get(\"value\")), !0);else if (p.length) {\n              var f = 0 <= a.a.o(p, a.j.u(e[0]));a.a.wc(e[0], f);A && !f && a.l.w(a.a.Fa, null, [b, \"change\"]);\n            }\n          }var h = b.multiple,\n              l = 0 != b.length && h ? b.scrollTop : null,\n              m = a.a.c(c()),\n              k = d.get(\"valueAllowUnset\") && d.has(\"value\"),\n              r = d.get(\"optionsIncludeDestroyed\");c = {};var q,\n              p = [];k || (h ? p = a.a.ib(e(), a.j.u) : 0 <= b.selectedIndex && p.push(a.j.u(b.options[b.selectedIndex])));m && (\"undefined\" == typeof m.length && (m = [m]), q = a.a.Ma(m, function (b) {\n            return r || b === n || null === b || !a.a.c(b._destroy);\n          }), d.has(\"optionsCaption\") && (m = a.a.c(d.get(\"optionsCaption\")), null !== m && m !== n && q.unshift(L)));var A = !1;c.beforeRemove = function (a) {\n            b.removeChild(a);\n          };m = g;d.has(\"optionsAfterRender\") && \"function\" == typeof d.get(\"optionsAfterRender\") && (m = function m(b, c) {\n            g(0, c);\n            a.l.w(d.get(\"optionsAfterRender\"), null, [c[0], b !== L ? b : n]);\n          });a.a.Db(b, q, function (c, e, g) {\n            g.length && (p = !k && g[0].selected ? [a.j.u(g[0])] : [], A = !0);e = b.ownerDocument.createElement(\"option\");c === L ? (a.a.bb(e, d.get(\"optionsCaption\")), a.j.ja(e, n)) : (g = f(c, d.get(\"optionsValue\"), c), a.j.ja(e, a.a.c(g)), c = f(c, d.get(\"optionsText\"), g), a.a.bb(e, c));return [e];\n          }, c, m);a.l.w(function () {\n            k ? a.j.ja(b, a.a.c(d.get(\"value\")), !0) : (h ? p.length && e().length < p.length : p.length && 0 <= b.selectedIndex ? a.j.u(b.options[b.selectedIndex]) !== p[0] : p.length || 0 <= b.selectedIndex) && a.a.Fa(b, \"change\");\n          });a.a.Sc(b);l && 20 < Math.abs(l - b.scrollTop) && (b.scrollTop = l);\n        } };a.d.options.zb = a.a.e.J();a.d.selectedOptions = { after: [\"options\", \"foreach\"], init: function init(b, c, d) {\n          a.a.q(b, \"change\", function () {\n            var e = c(),\n                f = [];a.a.r(b.getElementsByTagName(\"option\"), function (b) {\n              b.selected && f.push(a.j.u(b));\n            });a.h.Ga(e, d, \"selectedOptions\", f);\n          });\n        }, update: function update(b, c) {\n          if (\"select\" != a.a.A(b)) throw Error(\"values binding applies only to SELECT elements\");var d = a.a.c(c()),\n              e = b.scrollTop;\n          d && \"number\" == typeof d.length && a.a.r(b.getElementsByTagName(\"option\"), function (b) {\n            var c = 0 <= a.a.o(d, a.j.u(b));b.selected != c && a.a.wc(b, c);\n          });b.scrollTop = e;\n        } };a.h.ga.selectedOptions = !0;a.d.style = { update: function update(b, c) {\n          var d = a.a.c(c() || {});a.a.D(d, function (c, d) {\n            d = a.a.c(d);if (null === d || d === n || !1 === d) d = \"\";b.style[c] = d;\n          });\n        } };a.d.submit = { init: function init(b, c, d, e, f) {\n          if (\"function\" != typeof c()) throw Error(\"The value for a submit binding must be a function\");a.a.q(b, \"submit\", function (a) {\n            var d,\n                e = c();try {\n              d = e.call(f.$data, b);\n            } finally {\n              !0 !== d && (a.preventDefault ? a.preventDefault() : a.returnValue = !1);\n            }\n          });\n        } };a.d.text = { init: function init() {\n          return { controlsDescendantBindings: !0 };\n        }, update: function update(b, c) {\n          a.a.bb(b, c());\n        } };a.f.aa.text = !0;(function () {\n        if (x && x.navigator) var b = function b(a) {\n          if (a) return parseFloat(a[1]);\n        },\n            c = x.opera && x.opera.version && parseInt(x.opera.version()),\n            d = x.navigator.userAgent,\n            e = b(d.match(/^(?:(?!chrome).)*version\\/([^ ]*) safari/i)),\n            f = b(d.match(/Firefox\\/([^ ]*)/));if (10 > a.a.C) var g = a.a.e.J(),\n            h = a.a.e.J(),\n            l = function l(b) {\n          var c = this.activeElement;(c = c && a.a.e.get(c, h)) && c(b);\n        },\n            m = function m(b, c) {\n          var d = b.ownerDocument;a.a.e.get(d, g) || (a.a.e.set(d, g, !0), a.a.q(d, \"selectionchange\", l));a.a.e.set(b, h, c);\n        };a.d.textInput = { init: function init(b, d, g) {\n            function l(c, d) {\n              a.a.q(b, c, d);\n            }function h() {\n              var c = a.a.c(d());if (null === c || c === n) c = \"\";u !== n && c === u ? a.a.setTimeout(h, 4) : b.value !== c && (s = c, b.value = c);\n            }function y() {\n              t || (u = b.value, t = a.a.setTimeout(v, 4));\n            }function v() {\n              clearTimeout(t);u = t = n;var c = b.value;s !== c && (s = c, a.h.Ga(d(), g, \"textInput\", c));\n            }var s = b.value,\n                t,\n                u,\n                x = 9 == a.a.C ? y : v;10 > a.a.C ? (l(\"propertychange\", function (a) {\n              \"value\" === a.propertyName && x(a);\n            }), 8 == a.a.C && (l(\"keyup\", v), l(\"keydown\", v)), 8 <= a.a.C && (m(b, x), l(\"dragend\", y))) : (l(\"input\", v), 5 > e && \"textarea\" === a.a.A(b) ? (l(\"keydown\", y), l(\"paste\", y), l(\"cut\", y)) : 11 > c ? l(\"keydown\", y) : 4 > f && (l(\"DOMAutoComplete\", v), l(\"dragdrop\", v), l(\"drop\", v)));l(\"change\", v);a.m(h, null, { i: b });\n          } };a.h.ga.textInput = !0;a.d.textinput = { preprocess: function preprocess(a, b, c) {\n            c(\"textInput\", a);\n          } };\n      })();a.d.uniqueName = { init: function init(b, c) {\n          if (c()) {\n            var d = \"ko_unique_\" + ++a.d.uniqueName.Nc;a.a.vc(b, d);\n          }\n        } };a.d.uniqueName.Nc = 0;a.d.value = { after: [\"options\", \"foreach\"], init: function init(b, c, d) {\n          if (\"input\" != b.tagName.toLowerCase() || \"checkbox\" != b.type && \"radio\" != b.type) {\n            var e = [\"change\"],\n                f = d.get(\"valueUpdate\"),\n                g = !1,\n                h = null;f && (\"string\" == typeof f && (f = [f]), a.a.ta(e, f), e = a.a.Wb(e));var l = function l() {\n              h = null;g = !1;var e = c(),\n                  f = a.j.u(b);a.h.Ga(e, d, \"value\", f);\n            };!a.a.C || \"input\" != b.tagName.toLowerCase() || \"text\" != b.type || \"off\" == b.autocomplete || b.form && \"off\" == b.form.autocomplete || -1 != a.a.o(e, \"propertychange\") || (a.a.q(b, \"propertychange\", function () {\n              g = !0;\n            }), a.a.q(b, \"focus\", function () {\n              g = !1;\n            }), a.a.q(b, \"blur\", function () {\n              g && l();\n            }));a.a.r(e, function (c) {\n              var d = l;a.a.sd(c, \"after\") && (d = function d() {\n                h = a.j.u(b);a.a.setTimeout(l, 0);\n              }, c = c.substring(5));a.a.q(b, c, d);\n            });var m = function m() {\n              var e = a.a.c(c()),\n                  f = a.j.u(b);if (null !== h && e === h) a.a.setTimeout(m, 0);else if (e !== f) if (\"select\" === a.a.A(b)) {\n                var g = d.get(\"valueAllowUnset\"),\n                    f = function f() {\n                  a.j.ja(b, e, g);\n                };f();g || e === a.j.u(b) ? a.a.setTimeout(f, 0) : a.l.w(a.a.Fa, null, [b, \"change\"]);\n              } else a.j.ja(b, e);\n            };a.m(m, null, { i: b });\n          } else a.La(b, { checkedValue: c });\n        }, update: function update() {} };a.h.ga.value = !0;a.d.visible = { update: function update(b, c) {\n          var d = a.a.c(c()),\n              e = \"none\" != b.style.display;d && !e ? b.style.display = \"\" : !d && e && (b.style.display = \"none\");\n        } };(function (b) {\n        a.d[b] = { init: function init(c, d, e, f, g) {\n            return a.d.event.init.call(this, c, function () {\n              var a = {};a[b] = d();return a;\n            }, e, f, g);\n          } };\n      })(\"click\");a.P = function () {};a.P.prototype.renderTemplateSource = function () {\n        throw Error(\"Override renderTemplateSource\");\n      };a.P.prototype.createJavaScriptEvaluatorBlock = function () {\n        throw Error(\"Override createJavaScriptEvaluatorBlock\");\n      };a.P.prototype.makeTemplateSource = function (b, c) {\n        if (\"string\" == typeof b) {\n          c = c || t;var d = c.getElementById(b);if (!d) throw Error(\"Cannot find template with ID \" + b);return new a.v.n(d);\n        }if (1 == b.nodeType || 8 == b.nodeType) return new a.v.sa(b);throw Error(\"Unknown template type: \" + b);\n      };a.P.prototype.renderTemplate = function (a, c, d, e) {\n        a = this.makeTemplateSource(a, e);return this.renderTemplateSource(a, c, d, e);\n      };a.P.prototype.isTemplateRewritten = function (a, c) {\n        return !1 === this.allowTemplateRewriting ? !0 : this.makeTemplateSource(a, c).data(\"isRewritten\");\n      };a.P.prototype.rewriteTemplate = function (a, c, d) {\n        a = this.makeTemplateSource(a, d);c = c(a.text());a.text(c);a.data(\"isRewritten\", !0);\n      };a.b(\"templateEngine\", a.P);a.Ib = function () {\n        function b(b, c, d, h) {\n          b = a.h.Ab(b);for (var l = a.h.va, m = 0; m < b.length; m++) {\n            var k = b[m].key;if (l.hasOwnProperty(k)) {\n              var r = l[k];if (\"function\" === typeof r) {\n                if (k = r(b[m].value)) throw Error(k);\n              } else if (!r) throw Error(\"This template engine does not support the '\" + k + \"' binding within its templates\");\n            }\n          }d = \"ko.__tr_ambtns(function($context,$element){return(function(){return{ \" + a.h.Xa(b, { valueAccessors: !0 }) + \" } })()},'\" + d.toLowerCase() + \"')\";return h.createJavaScriptEvaluatorBlock(d) + c;\n        }var c = /(<([a-z]+\\d*)(?:\\s+(?!data-bind\\s*=\\s*)[a-z0-9\\-]+(?:=(?:\\\"[^\\\"]*\\\"|\\'[^\\']*\\'|[^>]*))?)*\\s+)data-bind\\s*=\\s*([\"'])([\\s\\S]*?)\\3/gi,\n            d = /\\x3c!--\\s*ko\\b\\s*([\\s\\S]*?)\\s*--\\x3e/g;return { Tc: function Tc(b, c, d) {\n            c.isTemplateRewritten(b, d) || c.rewriteTemplate(b, function (b) {\n              return a.Ib.jd(b, c);\n            }, d);\n          }, jd: function jd(a, f) {\n            return a.replace(c, function (a, c, d, e, k) {\n              return b(k, c, d, f);\n            }).replace(d, function (a, c) {\n              return b(c, \"\\x3c!-- ko --\\x3e\", \"#comment\", f);\n            });\n          }, Jc: function Jc(b, c) {\n            return a.N.yb(function (d, h) {\n              var l = d.nextSibling;l && l.nodeName.toLowerCase() === c && a.La(l, b, h);\n            });\n          } };\n      }();a.b(\"__tr_ambtns\", a.Ib.Jc);(function () {\n        a.v = {};a.v.n = function (b) {\n          if (this.n = b) {\n            var c = a.a.A(b);this.eb = \"script\" === c ? 1 : \"textarea\" === c ? 2 : \"template\" == c && b.content && 11 === b.content.nodeType ? 3 : 4;\n          }\n        };a.v.n.prototype.text = function () {\n          var b = 1 === this.eb ? \"text\" : 2 === this.eb ? \"value\" : \"innerHTML\";if (0 == arguments.length) return this.n[b];var c = arguments[0];\"innerHTML\" === b ? a.a.Eb(this.n, c) : this.n[b] = c;\n        };var b = a.a.e.J() + \"_\";a.v.n.prototype.data = function (c) {\n          if (1 === arguments.length) return a.a.e.get(this.n, b + c);a.a.e.set(this.n, b + c, arguments[1]);\n        };var c = a.a.e.J();a.v.n.prototype.nodes = function () {\n          var b = this.n;if (0 == arguments.length) return (a.a.e.get(b, c) || {}).mb || (3 === this.eb ? b.content : 4 === this.eb ? b : n);a.a.e.set(b, c, { mb: arguments[0] });\n        };a.v.sa = function (a) {\n          this.n = a;\n        };a.v.sa.prototype = new a.v.n();a.v.sa.prototype.text = function () {\n          if (0 == arguments.length) {\n            var b = a.a.e.get(this.n, c) || {};b.Jb === n && b.mb && (b.Jb = b.mb.innerHTML);return b.Jb;\n          }a.a.e.set(this.n, c, { Jb: arguments[0] });\n        };a.b(\"templateSources\", a.v);a.b(\"templateSources.domElement\", a.v.n);a.b(\"templateSources.anonymousTemplate\", a.v.sa);\n      })();(function () {\n        function b(b, c, d) {\n          var e;for (c = a.f.nextSibling(c); b && (e = b) !== c;) {\n            b = a.f.nextSibling(e), d(e, b);\n          }\n        }function c(c, d) {\n          if (c.length) {\n            var e = c[0],\n                f = c[c.length - 1],\n                g = e.parentNode,\n                h = a.S.instance,\n                n = h.preprocessNode;if (n) {\n              b(e, f, function (a, b) {\n                var c = a.previousSibling,\n                    d = n.call(h, a);d && (a === e && (e = d[0] || b), a === f && (f = d[d.length - 1] || c));\n              });c.length = 0;if (!e) return;e === f ? c.push(e) : (c.push(e, f), a.a.Ba(c, g));\n            }b(e, f, function (b) {\n              1 !== b.nodeType && 8 !== b.nodeType || a.Ub(d, b);\n            });b(e, f, function (b) {\n              1 !== b.nodeType && 8 !== b.nodeType || a.N.Cc(b, [d]);\n            });a.a.Ba(c, g);\n          }\n        }function d(a) {\n          return a.nodeType ? a : 0 < a.length ? a[0] : null;\n        }function e(b, e, f, h, q) {\n          q = q || {};var p = (b && d(b) || f || {}).ownerDocument,\n              n = q.templateEngine || g;\n          a.Ib.Tc(f, n, p);f = n.renderTemplate(f, h, q, p);if (\"number\" != typeof f.length || 0 < f.length && \"number\" != typeof f[0].nodeType) throw Error(\"Template engine must return an array of DOM nodes\");p = !1;switch (e) {case \"replaceChildren\":\n              a.f.fa(b, f);p = !0;break;case \"replaceNode\":\n              a.a.uc(b, f);p = !0;break;case \"ignoreTargetNode\":\n              break;default:\n              throw Error(\"Unknown renderMode: \" + e);}p && (c(f, h), q.afterRender && a.l.w(q.afterRender, null, [f, h.$data]));return f;\n        }function f(b, c, d) {\n          return a.I(b) ? b() : \"function\" === typeof b ? b(c, d) : b;\n        }\n        var g;a.Fb = function (b) {\n          if (b != n && !(b instanceof a.P)) throw Error(\"templateEngine must inherit from ko.templateEngine\");g = b;\n        };a.Cb = function (b, c, k, h, q) {\n          k = k || {};if ((k.templateEngine || g) == n) throw Error(\"Set a template engine before calling renderTemplate\");q = q || \"replaceChildren\";if (h) {\n            var p = d(h);return a.B(function () {\n              var g = c && c instanceof a.R ? c : new a.R(c, null, null, null, { exportDependencies: !0 }),\n                  n = f(b, g.$data, g),\n                  g = e(h, q, n, g, k);\"replaceNode\" == q && (h = g, p = d(h));\n            }, null, { ya: function ya() {\n                return !p || !a.a.qb(p);\n              }, i: p && \"replaceNode\" == q ? p.parentNode : p });\n          }return a.N.yb(function (d) {\n            a.Cb(b, c, k, d, \"replaceNode\");\n          });\n        };a.pd = function (b, d, g, h, q) {\n          function p(a, b) {\n            c(b, t);g.afterRender && g.afterRender(b, a);t = null;\n          }function s(a, c) {\n            t = q.createChildContext(a, g.as, function (a) {\n              a.$index = c;\n            });var d = f(b, a, t);return e(null, \"ignoreTargetNode\", d, t, g);\n          }var t;return a.B(function () {\n            var b = a.a.c(d) || [];\"undefined\" == typeof b.length && (b = [b]);b = a.a.Ma(b, function (b) {\n              return g.includeDestroyed || b === n || null === b || !a.a.c(b._destroy);\n            });a.l.w(a.a.Db, null, [h, b, s, g, p]);\n          }, null, { i: h });\n        };var h = a.a.e.J();a.d.template = { init: function init(b, c) {\n            var d = a.a.c(c());if (\"string\" == typeof d || d.name) a.f.za(b);else {\n              if (\"nodes\" in d) {\n                if (d = d.nodes || [], a.I(d)) throw Error('The \"nodes\" option must be a plain, non-observable array.');\n              } else d = a.f.childNodes(b);d = a.a.nc(d);new a.v.sa(b).nodes(d);\n            }return { controlsDescendantBindings: !0 };\n          }, update: function update(b, c, d, e, f) {\n            var g = c();c = a.a.c(g);d = !0;e = null;\"string\" == typeof c ? c = {} : (g = c.name, \"if\" in c && (d = a.a.c(c[\"if\"])), d && \"ifnot\" in c && (d = !a.a.c(c.ifnot)));\n            \"foreach\" in c ? e = a.pd(g || b, d && c.foreach || [], c, b, f) : d ? (f = \"data\" in c ? f.ac(c.data, c.as) : f, e = a.Cb(g || b, f, c, b)) : a.f.za(b);f = e;(c = a.a.e.get(b, h)) && \"function\" == typeof c.k && c.k();a.a.e.set(b, h, f && f.ca() ? f : n);\n          } };a.h.va.template = function (b) {\n          b = a.h.Ab(b);return 1 == b.length && b[0].unknown || a.h.fd(b, \"name\") ? null : \"This template engine does not support anonymous templates nested within its templates\";\n        };a.f.aa.template = !0;\n      })();a.b(\"setTemplateEngine\", a.Fb);a.b(\"renderTemplate\", a.Cb);a.a.hc = function (a, c, d) {\n        if (a.length && c.length) {\n          var e, f, g, h, l;for (e = f = 0; (!d || e < d) && (h = a[f]); ++f) {\n            for (g = 0; l = c[g]; ++g) {\n              if (h.value === l.value) {\n                h.moved = l.index;l.moved = h.index;c.splice(g, 1);e = g = 0;break;\n              }\n            }e += g;\n          }\n        }\n      };a.a.lb = function () {\n        function b(b, d, e, f, g) {\n          var h = Math.min,\n              l = Math.max,\n              m = [],\n              k,\n              n = b.length,\n              q,\n              p = d.length,\n              s = p - n || 1,\n              t = n + p + 1,\n              v,\n              u,\n              x;for (k = 0; k <= n; k++) {\n            for (u = v, m.push(v = []), x = h(p, k + s), q = l(0, k - 1); q <= x; q++) {\n              v[q] = q ? k ? b[k - 1] === d[q - 1] ? u[q - 1] : h(u[q] || t, v[q - 1] || t) + 1 : q + 1 : k + 1;\n            }\n          }h = [];l = [];s = [];k = n;for (q = p; k || q;) {\n            p = m[k][q] - 1, q && p === m[k][q - 1] ? l.push(h[h.length] = { status: e,\n              value: d[--q], index: q }) : k && p === m[k - 1][q] ? s.push(h[h.length] = { status: f, value: b[--k], index: k }) : (--q, --k, g.sparse || h.push({ status: \"retained\", value: d[q] }));\n          }a.a.hc(s, l, !g.dontLimitMoves && 10 * n);return h.reverse();\n        }return function (a, d, e) {\n          e = \"boolean\" === typeof e ? { dontLimitMoves: e } : e || {};a = a || [];d = d || [];return a.length < d.length ? b(a, d, \"added\", \"deleted\", e) : b(d, a, \"deleted\", \"added\", e);\n        };\n      }();a.b(\"utils.compareArrays\", a.a.lb);(function () {\n        function b(b, c, d, h, l) {\n          var m = [],\n              k = a.B(function () {\n            var k = c(d, l, a.a.Ba(m, b)) || [];0 < m.length && (a.a.uc(m, k), h && a.l.w(h, null, [d, k, l]));m.length = 0;a.a.ta(m, k);\n          }, null, { i: b, ya: function ya() {\n              return !a.a.Tb(m);\n            } });return { ea: m, B: k.ca() ? k : n };\n        }var c = a.a.e.J(),\n            d = a.a.e.J();a.a.Db = function (e, f, g, h, l) {\n          function m(b, c) {\n            w = q[c];u !== c && (D[b] = w);w.tb(u++);a.a.Ba(w.ea, e);t.push(w);z.push(w);\n          }function k(b, c) {\n            if (b) for (var d = 0, e = c.length; d < e; d++) {\n              c[d] && a.a.r(c[d].ea, function (a) {\n                b(a, d, c[d].ka);\n              });\n            }\n          }f = f || [];h = h || {};var r = a.a.e.get(e, c) === n,\n              q = a.a.e.get(e, c) || [],\n              p = a.a.ib(q, function (a) {\n            return a.ka;\n          }),\n              s = a.a.lb(p, f, h.dontLimitMoves),\n              t = [],\n              v = 0,\n              u = 0,\n              x = [],\n              z = [];f = [];for (var D = [], p = [], w, C = 0, B, E; B = s[C]; C++) {\n            switch (E = B.moved, B.status) {case \"deleted\":\n                E === n && (w = q[v], w.B && (w.B.k(), w.B = n), a.a.Ba(w.ea, e).length && (h.beforeRemove && (t.push(w), z.push(w), w.ka === d ? w = null : f[C] = w), w && x.push.apply(x, w.ea)));v++;break;case \"retained\":\n                m(C, v++);break;case \"added\":\n                E !== n ? m(C, E) : (w = { ka: B.value, tb: a.O(u++) }, t.push(w), z.push(w), r || (p[C] = w));}\n          }a.a.e.set(e, c, t);k(h.beforeMove, D);a.a.r(x, h.beforeRemove ? a.ba : a.removeNode);for (var C = 0, r = a.f.firstChild(e), F; w = z[C]; C++) {\n            w.ea || a.a.extend(w, b(e, g, w.ka, l, w.tb));for (v = 0; s = w.ea[v]; r = s.nextSibling, F = s, v++) {\n              s !== r && a.f.kc(e, s, F);\n            }!w.ad && l && (l(w.ka, w.ea, w.tb), w.ad = !0);\n          }k(h.beforeRemove, f);for (C = 0; C < f.length; ++C) {\n            f[C] && (f[C].ka = d);\n          }k(h.afterMove, D);k(h.afterAdd, p);\n        };\n      })();a.b(\"utils.setDomNodeChildrenFromArrayMapping\", a.a.Db);a.X = function () {\n        this.allowTemplateRewriting = !1;\n      };a.X.prototype = new a.P();a.X.prototype.renderTemplateSource = function (b, c, d, e) {\n        if (c = (9 > a.a.C ? 0 : b.nodes) ? b.nodes() : null) return a.a.W(c.cloneNode(!0).childNodes);b = b.text();\n        return a.a.na(b, e);\n      };a.X.vb = new a.X();a.Fb(a.X.vb);a.b(\"nativeTemplateEngine\", a.X);(function () {\n        a.xb = function () {\n          var a = this.ed = function () {\n            if (!u || !u.tmpl) return 0;try {\n              if (0 <= u.tmpl.tag.tmpl.open.toString().indexOf(\"__\")) return 2;\n            } catch (a) {}return 1;\n          }();this.renderTemplateSource = function (b, e, f, g) {\n            g = g || t;f = f || {};if (2 > a) throw Error(\"Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.\");var h = b.data(\"precompiled\");h || (h = b.text() || \"\", h = u.template(null, \"{{ko_with $item.koBindingContext}}\" + h + \"{{/ko_with}}\"), b.data(\"precompiled\", h));b = [e.$data];e = u.extend({ koBindingContext: e }, f.templateOptions);e = u.tmpl(h, b, e);e.appendTo(g.createElement(\"div\"));u.fragments = {};return e;\n          };this.createJavaScriptEvaluatorBlock = function (a) {\n            return \"{{ko_code ((function() { return \" + a + \" })()) }}\";\n          };this.addTemplate = function (a, b) {\n            t.write(\"<script type='text/html' id='\" + a + \"'>\" + b + \"\\x3c/script>\");\n          };0 < a && (u.tmpl.tag.ko_code = { open: \"__.push($1 || '');\" }, u.tmpl.tag.ko_with = { open: \"with($1) {\", close: \"} \" });\n        };a.xb.prototype = new a.P();var b = new a.xb();0 < b.ed && a.Fb(b);a.b(\"jqueryTmplTemplateEngine\", a.xb);\n      })();\n    });\n  })();\n})();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2xpYi9rbm9ja291dC5qcz9hZjdlIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogS25vY2tvdXQgSmF2YVNjcmlwdCBsaWJyYXJ5IHYzLjQuMlxuICogKGMpIFRoZSBLbm9ja291dC5qcyB0ZWFtIC0gaHR0cDovL2tub2Nrb3V0anMuY29tL1xuICogTGljZW5zZTogTUlUIChodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocClcbiAqL1xuXG4oZnVuY3Rpb24oKSB7KGZ1bmN0aW9uKG4pe3ZhciB4PXRoaXN8fCgwLGV2YWwpKFwidGhpc1wiKSx0PXguZG9jdW1lbnQsTT14Lm5hdmlnYXRvcix1PXgualF1ZXJ5LEg9eC5KU09OOyhmdW5jdGlvbihuKXtcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXCJleHBvcnRzXCIsXCJyZXF1aXJlXCJdLG4pOlwib2JqZWN0XCI9PT10eXBlb2YgZXhwb3J0cyYmXCJvYmplY3RcIj09PXR5cGVvZiBtb2R1bGU/bihtb2R1bGUuZXhwb3J0c3x8ZXhwb3J0cyk6bih4LmtvPXt9KX0pKGZ1bmN0aW9uKE4sTyl7ZnVuY3Rpb24gSihhLGMpe3JldHVybiBudWxsPT09YXx8dHlwZW9mIGEgaW4gUj9hPT09YzohMX1mdW5jdGlvbiBTKGIsYyl7dmFyIGQ7cmV0dXJuIGZ1bmN0aW9uKCl7ZHx8KGQ9YS5hLnNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPW47YigpfSxjKSl9fWZ1bmN0aW9uIFQoYixjKXt2YXIgZDtyZXR1cm4gZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQoZCk7ZD1hLmEuc2V0VGltZW91dChiLGMpfX1mdW5jdGlvbiBVKGEsXG5jKXtjJiZjIT09RT9cImJlZm9yZUNoYW5nZVwiPT09Yz90aGlzLk9iKGEpOnRoaXMuSmEoYSxjKTp0aGlzLlBiKGEpfWZ1bmN0aW9uIFYoYSxjKXtudWxsIT09YyYmYy5rJiZjLmsoKX1mdW5jdGlvbiBXKGEsYyl7dmFyIGQ9dGhpcy5NYyxlPWRbc107ZS5UfHwodGhpcy5vYiYmdGhpcy5PYVtjXT8oZC5TYihjLGEsdGhpcy5PYVtjXSksdGhpcy5PYVtjXT1udWxsLC0tdGhpcy5vYik6ZS5zW2NdfHxkLlNiKGMsYSxlLnQ/eyQ6YX06ZC55YyhhKSksYS5IYSYmYS5IYygpKX1mdW5jdGlvbiBLKGIsYyxkLGUpe2EuZFtiXT17aW5pdDpmdW5jdGlvbihiLGcsaCxsLG0pe3ZhciBrLHI7YS5tKGZ1bmN0aW9uKCl7dmFyIHE9ZygpLHA9YS5hLmMocSkscD0hZCE9PSFwLEE9IXI7aWYoQXx8Y3x8cCE9PWspQSYmYS54YS5DYSgpJiYocj1hLmEud2EoYS5mLmNoaWxkTm9kZXMoYiksITApKSxwPyhBfHxhLmYuZmEoYixhLmEud2EocikpLGEuaGIoZT9lKG0scSk6bSxiKSk6YS5mLnphKGIpLGs9cH0sbnVsbCxcbntpOmJ9KTtyZXR1cm57Y29udHJvbHNEZXNjZW5kYW50QmluZGluZ3M6ITB9fX07YS5oLnZhW2JdPSExO2EuZi5hYVtiXT0hMH12YXIgYT1cInVuZGVmaW5lZFwiIT09dHlwZW9mIE4/Tjp7fTthLmI9ZnVuY3Rpb24oYixjKXtmb3IodmFyIGQ9Yi5zcGxpdChcIi5cIiksZT1hLGY9MDtmPGQubGVuZ3RoLTE7ZisrKWU9ZVtkW2ZdXTtlW2RbZC5sZW5ndGgtMV1dPWN9O2EuSD1mdW5jdGlvbihhLGMsZCl7YVtjXT1kfTthLnZlcnNpb249XCIzLjQuMlwiO2EuYihcInZlcnNpb25cIixhLnZlcnNpb24pO2Eub3B0aW9ucz17ZGVmZXJVcGRhdGVzOiExLHVzZU9ubHlOYXRpdmVFdmVudHM6ITF9O2EuYT1mdW5jdGlvbigpe2Z1bmN0aW9uIGIoYSxiKXtmb3IodmFyIGMgaW4gYSlhLmhhc093blByb3BlcnR5KGMpJiZiKGMsYVtjXSl9ZnVuY3Rpb24gYyhhLGIpe2lmKGIpZm9yKHZhciBjIGluIGIpYi5oYXNPd25Qcm9wZXJ0eShjKSYmKGFbY109YltjXSk7cmV0dXJuIGF9ZnVuY3Rpb24gZChhLGIpe2EuX19wcm90b19fPVxuYjtyZXR1cm4gYX1mdW5jdGlvbiBlKGIsYyxkLGUpe3ZhciBtPWJbY10ubWF0Y2gocil8fFtdO2EuYS5yKGQubWF0Y2gociksZnVuY3Rpb24oYil7YS5hLnJhKG0sYixlKX0pO2JbY109bS5qb2luKFwiIFwiKX12YXIgZj17X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXksZz1cImZ1bmN0aW9uXCI9PT10eXBlb2YgU3ltYm9sLGg9e30sbD17fTtoW00mJi9GaXJlZm94XFwvMi9pLnRlc3QoTS51c2VyQWdlbnQpP1wiS2V5Ym9hcmRFdmVudFwiOlwiVUlFdmVudHNcIl09W1wia2V5dXBcIixcImtleWRvd25cIixcImtleXByZXNzXCJdO2guTW91c2VFdmVudHM9XCJjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZVwiLnNwbGl0KFwiIFwiKTtiKGgsZnVuY3Rpb24oYSxiKXtpZihiLmxlbmd0aClmb3IodmFyIGM9MCxkPWIubGVuZ3RoO2M8ZDtjKyspbFtiW2NdXT1hfSk7dmFyIG09e3Byb3BlcnR5Y2hhbmdlOiEwfSxrPVxudCYmZnVuY3Rpb24oKXtmb3IodmFyIGE9MyxiPXQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxjPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpXCIpO2IuaW5uZXJIVE1MPVwiXFx4M2MhLS1baWYgZ3QgSUUgXCIrICsrYStcIl0+PGk+PC9pPjwhW2VuZGlmXS0tXFx4M2VcIixjWzBdOyk7cmV0dXJuIDQ8YT9hOm59KCkscj0vXFxTKy9nO3JldHVybntnYzpbXCJhdXRoZW50aWNpdHlfdG9rZW5cIiwvXl9fUmVxdWVzdFZlcmlmaWNhdGlvblRva2VuKF8uKik/JC9dLHI6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspYihhW2NdLGMpfSxvOmZ1bmN0aW9uKGEsYil7aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgQXJyYXkucHJvdG90eXBlLmluZGV4T2YpcmV0dXJuIEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYSxiKTtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspaWYoYVtjXT09PWIpcmV0dXJuIGM7cmV0dXJuLTF9LFZiOmZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9XG4wLGU9YS5sZW5ndGg7ZDxlO2QrKylpZihiLmNhbGwoYyxhW2RdLGQpKXJldHVybiBhW2RdO3JldHVybiBudWxsfSxOYTpmdW5jdGlvbihiLGMpe3ZhciBkPWEuYS5vKGIsYyk7MDxkP2Iuc3BsaWNlKGQsMSk6MD09PWQmJmIuc2hpZnQoKX0sV2I6ZnVuY3Rpb24oYil7Yj1ifHxbXTtmb3IodmFyIGM9W10sZD0wLGU9Yi5sZW5ndGg7ZDxlO2QrKykwPmEuYS5vKGMsYltkXSkmJmMucHVzaChiW2RdKTtyZXR1cm4gY30saWI6ZnVuY3Rpb24oYSxiKXthPWF8fFtdO2Zvcih2YXIgYz1bXSxkPTAsZT1hLmxlbmd0aDtkPGU7ZCsrKWMucHVzaChiKGFbZF0sZCkpO3JldHVybiBjfSxNYTpmdW5jdGlvbihhLGIpe2E9YXx8W107Zm9yKHZhciBjPVtdLGQ9MCxlPWEubGVuZ3RoO2Q8ZTtkKyspYihhW2RdLGQpJiZjLnB1c2goYVtkXSk7cmV0dXJuIGN9LHRhOmZ1bmN0aW9uKGEsYil7aWYoYiBpbnN0YW5jZW9mIEFycmF5KWEucHVzaC5hcHBseShhLGIpO2Vsc2UgZm9yKHZhciBjPTAsZD1iLmxlbmd0aDtjPFxuZDtjKyspYS5wdXNoKGJbY10pO3JldHVybiBhfSxyYTpmdW5jdGlvbihiLGMsZCl7dmFyIGU9YS5hLm8oYS5hLkJiKGIpLGMpOzA+ZT9kJiZiLnB1c2goYyk6ZHx8Yi5zcGxpY2UoZSwxKX0sbGE6ZixleHRlbmQ6YywkYTpkLGFiOmY/ZDpjLEQ6YixFYTpmdW5jdGlvbihhLGIpe2lmKCFhKXJldHVybiBhO3ZhciBjPXt9LGQ7Zm9yKGQgaW4gYSlhLmhhc093blByb3BlcnR5KGQpJiYoY1tkXT1iKGFbZF0sZCxhKSk7cmV0dXJuIGN9LHJiOmZ1bmN0aW9uKGIpe2Zvcig7Yi5maXJzdENoaWxkOylhLnJlbW92ZU5vZGUoYi5maXJzdENoaWxkKX0sbmM6ZnVuY3Rpb24oYil7Yj1hLmEuVyhiKTtmb3IodmFyIGM9KGJbMF0mJmJbMF0ub3duZXJEb2N1bWVudHx8dCkuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkPTAsZT1iLmxlbmd0aDtkPGU7ZCsrKWMuYXBwZW5kQ2hpbGQoYS5iYShiW2RdKSk7cmV0dXJuIGN9LHdhOmZ1bmN0aW9uKGIsYyl7Zm9yKHZhciBkPTAsZT1iLmxlbmd0aCxtPVtdO2Q8ZTtkKyspe3ZhciBrPVxuYltkXS5jbG9uZU5vZGUoITApO20ucHVzaChjP2EuYmEoayk6ayl9cmV0dXJuIG19LGZhOmZ1bmN0aW9uKGIsYyl7YS5hLnJiKGIpO2lmKGMpZm9yKHZhciBkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKWIuYXBwZW5kQ2hpbGQoY1tkXSl9LHVjOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yi5ub2RlVHlwZT9bYl06YjtpZigwPGQubGVuZ3RoKXtmb3IodmFyIGU9ZFswXSxtPWUucGFyZW50Tm9kZSxrPTAsZj1jLmxlbmd0aDtrPGY7aysrKW0uaW5zZXJ0QmVmb3JlKGNba10sZSk7az0wO2ZvcihmPWQubGVuZ3RoO2s8ZjtrKyspYS5yZW1vdmVOb2RlKGRba10pfX0sQmE6ZnVuY3Rpb24oYSxiKXtpZihhLmxlbmd0aCl7Zm9yKGI9OD09PWIubm9kZVR5cGUmJmIucGFyZW50Tm9kZXx8YjthLmxlbmd0aCYmYVswXS5wYXJlbnROb2RlIT09YjspYS5zcGxpY2UoMCwxKTtmb3IoOzE8YS5sZW5ndGgmJmFbYS5sZW5ndGgtMV0ucGFyZW50Tm9kZSE9PWI7KWEubGVuZ3RoLS07aWYoMTxhLmxlbmd0aCl7dmFyIGM9XG5hWzBdLGQ9YVthLmxlbmd0aC0xXTtmb3IoYS5sZW5ndGg9MDtjIT09ZDspYS5wdXNoKGMpLGM9Yy5uZXh0U2libGluZzthLnB1c2goZCl9fXJldHVybiBhfSx3YzpmdW5jdGlvbihhLGIpezc+az9hLnNldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsYik6YS5zZWxlY3RlZD1ifSxjYjpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09PWF8fGE9PT1uP1wiXCI6YS50cmltP2EudHJpbSgpOmEudG9TdHJpbmcoKS5yZXBsYWNlKC9eW1xcc1xceGEwXSt8W1xcc1xceGEwXSskL2csXCJcIil9LHNkOmZ1bmN0aW9uKGEsYil7YT1hfHxcIlwiO3JldHVybiBiLmxlbmd0aD5hLmxlbmd0aD8hMTphLnN1YnN0cmluZygwLGIubGVuZ3RoKT09PWJ9LFJjOmZ1bmN0aW9uKGEsYil7aWYoYT09PWIpcmV0dXJuITA7aWYoMTE9PT1hLm5vZGVUeXBlKXJldHVybiExO2lmKGIuY29udGFpbnMpcmV0dXJuIGIuY29udGFpbnMoMz09PWEubm9kZVR5cGU/YS5wYXJlbnROb2RlOmEpO2lmKGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24pcmV0dXJuIDE2PT1cbihiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGEpJjE2KTtmb3IoO2EmJmEhPWI7KWE9YS5wYXJlbnROb2RlO3JldHVybiEhYX0scWI6ZnVuY3Rpb24oYil7cmV0dXJuIGEuYS5SYyhiLGIub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpfSxUYjpmdW5jdGlvbihiKXtyZXR1cm4hIWEuYS5WYihiLGEuYS5xYil9LEE6ZnVuY3Rpb24oYSl7cmV0dXJuIGEmJmEudGFnTmFtZSYmYS50YWdOYW1lLnRvTG93ZXJDYXNlKCl9LFpiOmZ1bmN0aW9uKGIpe3JldHVybiBhLm9uRXJyb3I/ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGIuYXBwbHkodGhpcyxhcmd1bWVudHMpfWNhdGNoKGMpe3Rocm93IGEub25FcnJvciYmYS5vbkVycm9yKGMpLGM7fX06Yn0sc2V0VGltZW91dDpmdW5jdGlvbihiLGMpe3JldHVybiBzZXRUaW1lb3V0KGEuYS5aYihiKSxjKX0sZGM6ZnVuY3Rpb24oYil7c2V0VGltZW91dChmdW5jdGlvbigpe2Eub25FcnJvciYmYS5vbkVycm9yKGIpO3Rocm93IGI7fSwwKX0scTpmdW5jdGlvbihiLFxuYyxkKXt2YXIgZT1hLmEuWmIoZCk7ZD1rJiZtW2NdO2lmKGEub3B0aW9ucy51c2VPbmx5TmF0aXZlRXZlbnRzfHxkfHwhdSlpZihkfHxcImZ1bmN0aW9uXCIhPXR5cGVvZiBiLmFkZEV2ZW50TGlzdGVuZXIpaWYoXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGIuYXR0YWNoRXZlbnQpe3ZhciBmPWZ1bmN0aW9uKGEpe2UuY2FsbChiLGEpfSxsPVwib25cIitjO2IuYXR0YWNoRXZlbnQobCxmKTthLmEuRy5xYShiLGZ1bmN0aW9uKCl7Yi5kZXRhY2hFdmVudChsLGYpfSl9ZWxzZSB0aHJvdyBFcnJvcihcIkJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IGFkZEV2ZW50TGlzdGVuZXIgb3IgYXR0YWNoRXZlbnRcIik7ZWxzZSBiLmFkZEV2ZW50TGlzdGVuZXIoYyxlLCExKTtlbHNlIHUoYikuYmluZChjLGUpfSxGYTpmdW5jdGlvbihiLGMpe2lmKCFifHwhYi5ub2RlVHlwZSl0aHJvdyBFcnJvcihcImVsZW1lbnQgbXVzdCBiZSBhIERPTSBub2RlIHdoZW4gY2FsbGluZyB0cmlnZ2VyRXZlbnRcIik7dmFyIGQ7XCJpbnB1dFwiPT09XG5hLmEuQShiKSYmYi50eXBlJiZcImNsaWNrXCI9PWMudG9Mb3dlckNhc2UoKT8oZD1iLnR5cGUsZD1cImNoZWNrYm94XCI9PWR8fFwicmFkaW9cIj09ZCk6ZD0hMTtpZihhLm9wdGlvbnMudXNlT25seU5hdGl2ZUV2ZW50c3x8IXV8fGQpaWYoXCJmdW5jdGlvblwiPT10eXBlb2YgdC5jcmVhdGVFdmVudClpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBiLmRpc3BhdGNoRXZlbnQpZD10LmNyZWF0ZUV2ZW50KGxbY118fFwiSFRNTEV2ZW50c1wiKSxkLmluaXRFdmVudChjLCEwLCEwLHgsMCwwLDAsMCwwLCExLCExLCExLCExLDAsYiksYi5kaXNwYXRjaEV2ZW50KGQpO2Vsc2UgdGhyb3cgRXJyb3IoXCJUaGUgc3VwcGxpZWQgZWxlbWVudCBkb2Vzbid0IHN1cHBvcnQgZGlzcGF0Y2hFdmVudFwiKTtlbHNlIGlmKGQmJmIuY2xpY2spYi5jbGljaygpO2Vsc2UgaWYoXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGIuZmlyZUV2ZW50KWIuZmlyZUV2ZW50KFwib25cIitjKTtlbHNlIHRocm93IEVycm9yKFwiQnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgdHJpZ2dlcmluZyBldmVudHNcIik7XG5lbHNlIHUoYikudHJpZ2dlcihjKX0sYzpmdW5jdGlvbihiKXtyZXR1cm4gYS5JKGIpP2IoKTpifSxCYjpmdW5jdGlvbihiKXtyZXR1cm4gYS5JKGIpP2IucCgpOmJ9LGZiOmZ1bmN0aW9uKGIsYyxkKXt2YXIgaztjJiYoXCJvYmplY3RcIj09PXR5cGVvZiBiLmNsYXNzTGlzdD8oaz1iLmNsYXNzTGlzdFtkP1wiYWRkXCI6XCJyZW1vdmVcIl0sYS5hLnIoYy5tYXRjaChyKSxmdW5jdGlvbihhKXtrLmNhbGwoYi5jbGFzc0xpc3QsYSl9KSk6XCJzdHJpbmdcIj09PXR5cGVvZiBiLmNsYXNzTmFtZS5iYXNlVmFsP2UoYi5jbGFzc05hbWUsXCJiYXNlVmFsXCIsYyxkKTplKGIsXCJjbGFzc05hbWVcIixjLGQpKX0sYmI6ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmEuYyhjKTtpZihudWxsPT09ZHx8ZD09PW4pZD1cIlwiO3ZhciBlPWEuZi5maXJzdENoaWxkKGIpOyFlfHwzIT1lLm5vZGVUeXBlfHxhLmYubmV4dFNpYmxpbmcoZSk/YS5mLmZhKGIsW2Iub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkKV0pOmUuZGF0YT1cbmQ7YS5hLldjKGIpfSx2YzpmdW5jdGlvbihhLGIpe2EubmFtZT1iO2lmKDc+PWspdHJ5e2EubWVyZ2VBdHRyaWJ1dGVzKHQuY3JlYXRlRWxlbWVudChcIjxpbnB1dCBuYW1lPSdcIithLm5hbWUrXCInLz5cIiksITEpfWNhdGNoKGMpe319LFdjOmZ1bmN0aW9uKGEpezk8PWsmJihhPTE9PWEubm9kZVR5cGU/YTphLnBhcmVudE5vZGUsYS5zdHlsZSYmKGEuc3R5bGUuem9vbT1hLnN0eWxlLnpvb20pKX0sU2M6ZnVuY3Rpb24oYSl7aWYoayl7dmFyIGI9YS5zdHlsZS53aWR0aDthLnN0eWxlLndpZHRoPTA7YS5zdHlsZS53aWR0aD1ifX0sbmQ6ZnVuY3Rpb24oYixjKXtiPWEuYS5jKGIpO2M9YS5hLmMoYyk7Zm9yKHZhciBkPVtdLGU9YjtlPD1jO2UrKylkLnB1c2goZSk7cmV0dXJuIGR9LFc6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPVtdLGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspYi5wdXNoKGFbY10pO3JldHVybiBifSxiYzpmdW5jdGlvbihhKXtyZXR1cm4gZz9TeW1ib2woYSk6YX0seGQ6Nj09PWssXG55ZDo3PT09ayxDOmssaWM6ZnVuY3Rpb24oYixjKXtmb3IodmFyIGQ9YS5hLlcoYi5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpKS5jb25jYXQoYS5hLlcoYi5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRleHRhcmVhXCIpKSksZT1cInN0cmluZ1wiPT10eXBlb2YgYz9mdW5jdGlvbihhKXtyZXR1cm4gYS5uYW1lPT09Y306ZnVuY3Rpb24oYSl7cmV0dXJuIGMudGVzdChhLm5hbWUpfSxrPVtdLG09ZC5sZW5ndGgtMTswPD1tO20tLSllKGRbbV0pJiZrLnB1c2goZFttXSk7cmV0dXJuIGt9LGtkOmZ1bmN0aW9uKGIpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBiJiYoYj1hLmEuY2IoYikpP0gmJkgucGFyc2U/SC5wYXJzZShiKToobmV3IEZ1bmN0aW9uKFwicmV0dXJuIFwiK2IpKSgpOm51bGx9LEdiOmZ1bmN0aW9uKGIsYyxkKXtpZighSHx8IUguc3RyaW5naWZ5KXRocm93IEVycm9yKFwiQ2Fubm90IGZpbmQgSlNPTi5zdHJpbmdpZnkoKS4gU29tZSBicm93c2VycyAoZS5nLiwgSUUgPCA4KSBkb24ndCBzdXBwb3J0IGl0IG5hdGl2ZWx5LCBidXQgeW91IGNhbiBvdmVyY29tZSB0aGlzIGJ5IGFkZGluZyBhIHNjcmlwdCByZWZlcmVuY2UgdG8ganNvbjIuanMsIGRvd25sb2FkYWJsZSBmcm9tIGh0dHA6Ly93d3cuanNvbi5vcmcvanNvbjIuanNcIik7XG5yZXR1cm4gSC5zdHJpbmdpZnkoYS5hLmMoYiksYyxkKX0sbGQ6ZnVuY3Rpb24oYyxkLGUpe2U9ZXx8e307dmFyIGs9ZS5wYXJhbXN8fHt9LG09ZS5pbmNsdWRlRmllbGRzfHx0aGlzLmdjLGY9YztpZihcIm9iamVjdFwiPT10eXBlb2YgYyYmXCJmb3JtXCI9PT1hLmEuQShjKSlmb3IodmFyIGY9Yy5hY3Rpb24sbD1tLmxlbmd0aC0xOzA8PWw7bC0tKWZvcih2YXIgZz1hLmEuaWMoYyxtW2xdKSxoPWcubGVuZ3RoLTE7MDw9aDtoLS0pa1tnW2hdLm5hbWVdPWdbaF0udmFsdWU7ZD1hLmEuYyhkKTt2YXIgcj10LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO3Iuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjtyLmFjdGlvbj1mO3IubWV0aG9kPVwicG9zdFwiO2Zvcih2YXIgbiBpbiBkKWM9dC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksYy50eXBlPVwiaGlkZGVuXCIsYy5uYW1lPW4sYy52YWx1ZT1hLmEuR2IoYS5hLmMoZFtuXSkpLHIuYXBwZW5kQ2hpbGQoYyk7YihrLGZ1bmN0aW9uKGEsYil7dmFyIGM9dC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5jLnR5cGU9XCJoaWRkZW5cIjtjLm5hbWU9YTtjLnZhbHVlPWI7ci5hcHBlbmRDaGlsZChjKX0pO3QuYm9keS5hcHBlbmRDaGlsZChyKTtlLnN1Ym1pdHRlcj9lLnN1Ym1pdHRlcihyKTpyLnN1Ym1pdCgpO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocil9LDApfX19KCk7YS5iKFwidXRpbHNcIixhLmEpO2EuYihcInV0aWxzLmFycmF5Rm9yRWFjaFwiLGEuYS5yKTthLmIoXCJ1dGlscy5hcnJheUZpcnN0XCIsYS5hLlZiKTthLmIoXCJ1dGlscy5hcnJheUZpbHRlclwiLGEuYS5NYSk7YS5iKFwidXRpbHMuYXJyYXlHZXREaXN0aW5jdFZhbHVlc1wiLGEuYS5XYik7YS5iKFwidXRpbHMuYXJyYXlJbmRleE9mXCIsYS5hLm8pO2EuYihcInV0aWxzLmFycmF5TWFwXCIsYS5hLmliKTthLmIoXCJ1dGlscy5hcnJheVB1c2hBbGxcIixhLmEudGEpO2EuYihcInV0aWxzLmFycmF5UmVtb3ZlSXRlbVwiLGEuYS5OYSk7YS5iKFwidXRpbHMuZXh0ZW5kXCIsYS5hLmV4dGVuZCk7YS5iKFwidXRpbHMuZmllbGRzSW5jbHVkZWRXaXRoSnNvblBvc3RcIixcbmEuYS5nYyk7YS5iKFwidXRpbHMuZ2V0Rm9ybUZpZWxkc1wiLGEuYS5pYyk7YS5iKFwidXRpbHMucGVla09ic2VydmFibGVcIixhLmEuQmIpO2EuYihcInV0aWxzLnBvc3RKc29uXCIsYS5hLmxkKTthLmIoXCJ1dGlscy5wYXJzZUpzb25cIixhLmEua2QpO2EuYihcInV0aWxzLnJlZ2lzdGVyRXZlbnRIYW5kbGVyXCIsYS5hLnEpO2EuYihcInV0aWxzLnN0cmluZ2lmeUpzb25cIixhLmEuR2IpO2EuYihcInV0aWxzLnJhbmdlXCIsYS5hLm5kKTthLmIoXCJ1dGlscy50b2dnbGVEb21Ob2RlQ3NzQ2xhc3NcIixhLmEuZmIpO2EuYihcInV0aWxzLnRyaWdnZXJFdmVudFwiLGEuYS5GYSk7YS5iKFwidXRpbHMudW53cmFwT2JzZXJ2YWJsZVwiLGEuYS5jKTthLmIoXCJ1dGlscy5vYmplY3RGb3JFYWNoXCIsYS5hLkQpO2EuYihcInV0aWxzLmFkZE9yUmVtb3ZlSXRlbVwiLGEuYS5yYSk7YS5iKFwidXRpbHMuc2V0VGV4dENvbnRlbnRcIixhLmEuYmIpO2EuYihcInVud3JhcFwiLGEuYS5jKTtGdW5jdGlvbi5wcm90b3R5cGUuYmluZHx8KEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kPVxuZnVuY3Rpb24oYSl7dmFyIGM9dGhpcztpZigxPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYy5hcHBseShhLGFyZ3VtZW50cyl9O3ZhciBkPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT1kLnNsaWNlKDApO2UucHVzaC5hcHBseShlLGFyZ3VtZW50cyk7cmV0dXJuIGMuYXBwbHkoYSxlKX19KTthLmEuZT1uZXcgZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsZyl7dmFyIGg9YltkXTtpZighaHx8XCJudWxsXCI9PT1ofHwhZVtoXSl7aWYoIWcpcmV0dXJuIG47aD1iW2RdPVwia29cIitjKys7ZVtoXT17fX1yZXR1cm4gZVtoXX12YXIgYz0wLGQ9XCJfX2tvX19cIisobmV3IERhdGUpLmdldFRpbWUoKSxlPXt9O3JldHVybntnZXQ6ZnVuY3Rpb24oYyxkKXt2YXIgZT1hKGMsITEpO3JldHVybiBlPT09bj9uOmVbZF19LHNldDpmdW5jdGlvbihjLGQsZSl7aWYoZSE9PW58fGEoYywhMSkhPT1uKWEoYywhMClbZF09XG5lfSxjbGVhcjpmdW5jdGlvbihhKXt2YXIgYj1hW2RdO3JldHVybiBiPyhkZWxldGUgZVtiXSxhW2RdPW51bGwsITApOiExfSxKOmZ1bmN0aW9uKCl7cmV0dXJuIGMrKyArZH19fTthLmIoXCJ1dGlscy5kb21EYXRhXCIsYS5hLmUpO2EuYihcInV0aWxzLmRvbURhdGEuY2xlYXJcIixhLmEuZS5jbGVhcik7YS5hLkc9bmV3IGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiLGMpe3ZhciBlPWEuYS5lLmdldChiLGQpO2U9PT1uJiZjJiYoZT1bXSxhLmEuZS5zZXQoYixkLGUpKTtyZXR1cm4gZX1mdW5jdGlvbiBjKGQpe3ZhciBlPWIoZCwhMSk7aWYoZSlmb3IodmFyIGU9ZS5zbGljZSgwKSxsPTA7bDxlLmxlbmd0aDtsKyspZVtsXShkKTthLmEuZS5jbGVhcihkKTthLmEuRy5jbGVhbkV4dGVybmFsRGF0YShkKTtpZihmW2Qubm9kZVR5cGVdKWZvcihlPWQuZmlyc3RDaGlsZDtkPWU7KWU9ZC5uZXh0U2libGluZyw4PT09ZC5ub2RlVHlwZSYmYyhkKX12YXIgZD1hLmEuZS5KKCksZT17MTohMCw4OiEwLDk6ITB9LFxuZj17MTohMCw5OiEwfTtyZXR1cm57cWE6ZnVuY3Rpb24oYSxjKXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBjKXRocm93IEVycm9yKFwiQ2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO2IoYSwhMCkucHVzaChjKX0sdGM6ZnVuY3Rpb24oYyxlKXt2YXIgZj1iKGMsITEpO2YmJihhLmEuTmEoZixlKSwwPT1mLmxlbmd0aCYmYS5hLmUuc2V0KGMsZCxuKSl9LGJhOmZ1bmN0aW9uKGIpe2lmKGVbYi5ub2RlVHlwZV0mJihjKGIpLGZbYi5ub2RlVHlwZV0pKXt2YXIgZD1bXTthLmEudGEoZCxiLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSk7Zm9yKHZhciBsPTAsbT1kLmxlbmd0aDtsPG07bCsrKWMoZFtsXSl9cmV0dXJuIGJ9LHJlbW92ZU5vZGU6ZnVuY3Rpb24oYil7YS5iYShiKTtiLnBhcmVudE5vZGUmJmIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChiKX0sY2xlYW5FeHRlcm5hbERhdGE6ZnVuY3Rpb24oYSl7dSYmXCJmdW5jdGlvblwiPT10eXBlb2YgdS5jbGVhbkRhdGEmJnUuY2xlYW5EYXRhKFthXSl9fX07XG5hLmJhPWEuYS5HLmJhO2EucmVtb3ZlTm9kZT1hLmEuRy5yZW1vdmVOb2RlO2EuYihcImNsZWFuTm9kZVwiLGEuYmEpO2EuYihcInJlbW92ZU5vZGVcIixhLnJlbW92ZU5vZGUpO2EuYihcInV0aWxzLmRvbU5vZGVEaXNwb3NhbFwiLGEuYS5HKTthLmIoXCJ1dGlscy5kb21Ob2RlRGlzcG9zYWwuYWRkRGlzcG9zZUNhbGxiYWNrXCIsYS5hLkcucWEpO2EuYihcInV0aWxzLmRvbU5vZGVEaXNwb3NhbC5yZW1vdmVEaXNwb3NlQ2FsbGJhY2tcIixhLmEuRy50Yyk7KGZ1bmN0aW9uKCl7dmFyIGI9WzAsXCJcIixcIlwiXSxjPVsxLFwiPHRhYmxlPlwiLFwiPC90YWJsZT5cIl0sZD1bMyxcIjx0YWJsZT48dGJvZHk+PHRyPlwiLFwiPC90cj48L3Rib2R5PjwvdGFibGU+XCJdLGU9WzEsXCI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+XCIsXCI8L3NlbGVjdD5cIl0sZj17dGhlYWQ6Yyx0Ym9keTpjLHRmb290OmMsdHI6WzIsXCI8dGFibGU+PHRib2R5PlwiLFwiPC90Ym9keT48L3RhYmxlPlwiXSx0ZDpkLHRoOmQsb3B0aW9uOmUsb3B0Z3JvdXA6ZX0sXG5nPTg+PWEuYS5DO2EuYS5uYT1mdW5jdGlvbihjLGQpe3ZhciBlO2lmKHUpaWYodS5wYXJzZUhUTUwpZT11LnBhcnNlSFRNTChjLGQpfHxbXTtlbHNle2lmKChlPXUuY2xlYW4oW2NdLGQpKSYmZVswXSl7Zm9yKHZhciBrPWVbMF07ay5wYXJlbnROb2RlJiYxMSE9PWsucGFyZW50Tm9kZS5ub2RlVHlwZTspaz1rLnBhcmVudE5vZGU7ay5wYXJlbnROb2RlJiZrLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoayl9fWVsc2V7KGU9ZCl8fChlPXQpO3ZhciBrPWUucGFyZW50V2luZG93fHxlLmRlZmF1bHRWaWV3fHx4LHI9YS5hLmNiKGMpLnRvTG93ZXJDYXNlKCkscT1lLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikscDtwPShyPXIubWF0Y2goL148KFthLXpdKylbID5dLykpJiZmW3JbMV1dfHxiO3I9cFswXTtwPVwiaWdub3JlZDxkaXY+XCIrcFsxXStjK3BbMl0rXCI8L2Rpdj5cIjtcImZ1bmN0aW9uXCI9PXR5cGVvZiBrLmlubmVyU2hpdj9xLmFwcGVuZENoaWxkKGsuaW5uZXJTaGl2KHApKTooZyYmZS5hcHBlbmRDaGlsZChxKSxcbnEuaW5uZXJIVE1MPXAsZyYmcS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHEpKTtmb3IoO3ItLTspcT1xLmxhc3RDaGlsZDtlPWEuYS5XKHEubGFzdENoaWxkLmNoaWxkTm9kZXMpfXJldHVybiBlfTthLmEuRWI9ZnVuY3Rpb24oYixjKXthLmEucmIoYik7Yz1hLmEuYyhjKTtpZihudWxsIT09YyYmYyE9PW4paWYoXCJzdHJpbmdcIiE9dHlwZW9mIGMmJihjPWMudG9TdHJpbmcoKSksdSl1KGIpLmh0bWwoYyk7ZWxzZSBmb3IodmFyIGQ9YS5hLm5hKGMsYi5vd25lckRvY3VtZW50KSxlPTA7ZTxkLmxlbmd0aDtlKyspYi5hcHBlbmRDaGlsZChkW2VdKX19KSgpO2EuYihcInV0aWxzLnBhcnNlSHRtbEZyYWdtZW50XCIsYS5hLm5hKTthLmIoXCJ1dGlscy5zZXRIdG1sXCIsYS5hLkViKTthLk49ZnVuY3Rpb24oKXtmdW5jdGlvbiBiKGMsZSl7aWYoYylpZig4PT1jLm5vZGVUeXBlKXt2YXIgZj1hLk4ucGMoYy5ub2RlVmFsdWUpO251bGwhPWYmJmUucHVzaCh7UWM6YyxoZDpmfSl9ZWxzZSBpZigxPT1jLm5vZGVUeXBlKWZvcih2YXIgZj1cbjAsZz1jLmNoaWxkTm9kZXMsaD1nLmxlbmd0aDtmPGg7ZisrKWIoZ1tmXSxlKX12YXIgYz17fTtyZXR1cm57eWI6ZnVuY3Rpb24oYSl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgYSl0aHJvdyBFcnJvcihcIllvdSBjYW4gb25seSBwYXNzIGEgZnVuY3Rpb24gdG8ga28ubWVtb2l6YXRpb24ubWVtb2l6ZSgpXCIpO3ZhciBiPSg0Mjk0OTY3Mjk2KigxK01hdGgucmFuZG9tKCkpfDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSkrKDQyOTQ5NjcyOTYqKDErTWF0aC5yYW5kb20oKSl8MCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtjW2JdPWE7cmV0dXJuXCJcXHgzYyEtLVtrb19tZW1vOlwiK2IrXCJdLS1cXHgzZVwifSxCYzpmdW5jdGlvbihhLGIpe3ZhciBmPWNbYV07aWYoZj09PW4pdGhyb3cgRXJyb3IoXCJDb3VsZG4ndCBmaW5kIGFueSBtZW1vIHdpdGggSUQgXCIrYStcIi4gUGVyaGFwcyBpdCdzIGFscmVhZHkgYmVlbiB1bm1lbW9pemVkLlwiKTt0cnl7cmV0dXJuIGYuYXBwbHkobnVsbCxifHxbXSksXG4hMH1maW5hbGx5e2RlbGV0ZSBjW2FdfX0sQ2M6ZnVuY3Rpb24oYyxlKXt2YXIgZj1bXTtiKGMsZik7Zm9yKHZhciBnPTAsaD1mLmxlbmd0aDtnPGg7ZysrKXt2YXIgbD1mW2ddLlFjLG09W2xdO2UmJmEuYS50YShtLGUpO2EuTi5CYyhmW2ddLmhkLG0pO2wubm9kZVZhbHVlPVwiXCI7bC5wYXJlbnROb2RlJiZsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobCl9fSxwYzpmdW5jdGlvbihhKXtyZXR1cm4oYT1hLm1hdGNoKC9eXFxba29fbWVtb1xcOiguKj8pXFxdJC8pKT9hWzFdOm51bGx9fX0oKTthLmIoXCJtZW1vaXphdGlvblwiLGEuTik7YS5iKFwibWVtb2l6YXRpb24ubWVtb2l6ZVwiLGEuTi55Yik7YS5iKFwibWVtb2l6YXRpb24udW5tZW1vaXplXCIsYS5OLkJjKTthLmIoXCJtZW1vaXphdGlvbi5wYXJzZU1lbW9UZXh0XCIsYS5OLnBjKTthLmIoXCJtZW1vaXphdGlvbi51bm1lbW9pemVEb21Ob2RlQW5kRGVzY2VuZGFudHNcIixhLk4uQ2MpO2EuWj1mdW5jdGlvbigpe2Z1bmN0aW9uIGIoKXtpZihlKWZvcih2YXIgYj1cbmUsYz0wLG07ZzxlOylpZihtPWRbZysrXSl7aWYoZz5iKXtpZig1RTM8PSsrYyl7Zz1lO2EuYS5kYyhFcnJvcihcIidUb28gbXVjaCByZWN1cnNpb24nIGFmdGVyIHByb2Nlc3NpbmcgXCIrYytcIiB0YXNrIGdyb3Vwcy5cIikpO2JyZWFrfWI9ZX10cnl7bSgpfWNhdGNoKGspe2EuYS5kYyhrKX19fWZ1bmN0aW9uIGMoKXtiKCk7Zz1lPWQubGVuZ3RoPTB9dmFyIGQ9W10sZT0wLGY9MSxnPTA7cmV0dXJue3NjaGVkdWxlcjp4Lk11dGF0aW9uT2JzZXJ2ZXI/ZnVuY3Rpb24oYSl7dmFyIGI9dC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyhuZXcgTXV0YXRpb25PYnNlcnZlcihhKSkub2JzZXJ2ZShiLHthdHRyaWJ1dGVzOiEwfSk7cmV0dXJuIGZ1bmN0aW9uKCl7Yi5jbGFzc0xpc3QudG9nZ2xlKFwiZm9vXCIpfX0oYyk6dCYmXCJvbnJlYWR5c3RhdGVjaGFuZ2VcImluIHQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKT9mdW5jdGlvbihhKXt2YXIgYj10LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7Yi5vbnJlYWR5c3RhdGVjaGFuZ2U9XG5mdW5jdGlvbigpe2Iub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7dC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoYik7Yj1udWxsO2EoKX07dC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoYil9OmZ1bmN0aW9uKGEpe3NldFRpbWVvdXQoYSwwKX0sWmE6ZnVuY3Rpb24oYil7ZXx8YS5aLnNjaGVkdWxlcihjKTtkW2UrK109YjtyZXR1cm4gZisrfSxjYW5jZWw6ZnVuY3Rpb24oYSl7YS09Zi1lO2E+PWcmJmE8ZSYmKGRbYV09bnVsbCl9LHJlc2V0Rm9yVGVzdGluZzpmdW5jdGlvbigpe3ZhciBhPWUtZztnPWU9ZC5sZW5ndGg9MDtyZXR1cm4gYX0scmQ6Yn19KCk7YS5iKFwidGFza3NcIixhLlopO2EuYihcInRhc2tzLnNjaGVkdWxlXCIsYS5aLlphKTthLmIoXCJ0YXNrcy5ydW5FYXJseVwiLGEuWi5yZCk7YS5BYT17dGhyb3R0bGU6ZnVuY3Rpb24oYixjKXtiLnRocm90dGxlRXZhbHVhdGlvbj1jO3ZhciBkPW51bGw7cmV0dXJuIGEuQih7cmVhZDpiLHdyaXRlOmZ1bmN0aW9uKGUpe2NsZWFyVGltZW91dChkKTtcbmQ9YS5hLnNldFRpbWVvdXQoZnVuY3Rpb24oKXtiKGUpfSxjKX19KX0scmF0ZUxpbWl0OmZ1bmN0aW9uKGEsYyl7dmFyIGQsZSxmO1wibnVtYmVyXCI9PXR5cGVvZiBjP2Q9YzooZD1jLnRpbWVvdXQsZT1jLm1ldGhvZCk7YS5nYj0hMTtmPVwibm90aWZ5V2hlbkNoYW5nZXNTdG9wXCI9PWU/VDpTO2EuV2EoZnVuY3Rpb24oYSl7cmV0dXJuIGYoYSxkKX0pfSxkZWZlcnJlZDpmdW5jdGlvbihiLGMpe2lmKCEwIT09Yyl0aHJvdyBFcnJvcihcIlRoZSAnZGVmZXJyZWQnIGV4dGVuZGVyIG9ubHkgYWNjZXB0cyB0aGUgdmFsdWUgJ3RydWUnLCBiZWNhdXNlIGl0IGlzIG5vdCBzdXBwb3J0ZWQgdG8gdHVybiBkZWZlcnJhbCBvZmYgb25jZSBlbmFibGVkLlwiKTtiLmdifHwoYi5nYj0hMCxiLldhKGZ1bmN0aW9uKGMpe3ZhciBlLGY9ITE7cmV0dXJuIGZ1bmN0aW9uKCl7aWYoIWYpe2EuWi5jYW5jZWwoZSk7ZT1hLlouWmEoYyk7dHJ5e2Y9ITAsYi5ub3RpZnlTdWJzY3JpYmVycyhuLFwiZGlydHlcIil9ZmluYWxseXtmPVxuITF9fX19KSl9LG5vdGlmeTpmdW5jdGlvbihhLGMpe2EuZXF1YWxpdHlDb21wYXJlcj1cImFsd2F5c1wiPT1jP251bGw6Sn19O3ZhciBSPXt1bmRlZmluZWQ6MSxcImJvb2xlYW5cIjoxLG51bWJlcjoxLHN0cmluZzoxfTthLmIoXCJleHRlbmRlcnNcIixhLkFhKTthLnpjPWZ1bmN0aW9uKGIsYyxkKXt0aGlzLiQ9Yjt0aGlzLmpiPWM7dGhpcy5QYz1kO3RoaXMuVD0hMTthLkgodGhpcyxcImRpc3Bvc2VcIix0aGlzLmspfTthLnpjLnByb3RvdHlwZS5rPWZ1bmN0aW9uKCl7dGhpcy5UPSEwO3RoaXMuUGMoKX07YS5LPWZ1bmN0aW9uKCl7YS5hLmFiKHRoaXMsRCk7RC51Yih0aGlzKX07dmFyIEU9XCJjaGFuZ2VcIixEPXt1YjpmdW5jdGlvbihhKXthLkY9e2NoYW5nZTpbXX07YS5RYj0xfSxZOmZ1bmN0aW9uKGIsYyxkKXt2YXIgZT10aGlzO2Q9ZHx8RTt2YXIgZj1uZXcgYS56YyhlLGM/Yi5iaW5kKGMpOmIsZnVuY3Rpb24oKXthLmEuTmEoZS5GW2RdLGYpO2UuS2EmJmUuS2EoZCl9KTtlLnVhJiZlLnVhKGQpO1xuZS5GW2RdfHwoZS5GW2RdPVtdKTtlLkZbZF0ucHVzaChmKTtyZXR1cm4gZn0sbm90aWZ5U3Vic2NyaWJlcnM6ZnVuY3Rpb24oYixjKXtjPWN8fEU7Yz09PUUmJnRoaXMuS2IoKTtpZih0aGlzLlJhKGMpKXt2YXIgZD1jPT09RSYmdGhpcy5GY3x8dGhpcy5GW2NdLnNsaWNlKDApO3RyeXthLmwuWGIoKTtmb3IodmFyIGU9MCxmO2Y9ZFtlXTsrK2UpZi5UfHxmLmpiKGIpfWZpbmFsbHl7YS5sLmVuZCgpfX19LFBhOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuUWJ9LFpjOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLlBhKCkhPT1hfSxLYjpmdW5jdGlvbigpeysrdGhpcy5RYn0sV2E6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcyxkPWEuSShjKSxlLGYsZyxoO2MuSmF8fChjLkphPWMubm90aWZ5U3Vic2NyaWJlcnMsYy5ub3RpZnlTdWJzY3JpYmVycz1VKTt2YXIgbD1iKGZ1bmN0aW9uKCl7Yy5IYT0hMTtkJiZoPT09YyYmKGg9Yy5NYj9jLk1iKCk6YygpKTt2YXIgYT1mfHxjLlVhKGcsaCk7Zj1lPSExO1xuYSYmYy5KYShnPWgpfSk7Yy5QYj1mdW5jdGlvbihhKXtjLkZjPWMuRltFXS5zbGljZSgwKTtjLkhhPWU9ITA7aD1hO2woKX07Yy5PYj1mdW5jdGlvbihhKXtlfHwoZz1hLGMuSmEoYSxcImJlZm9yZUNoYW5nZVwiKSl9O2MuSGM9ZnVuY3Rpb24oKXtjLlVhKGcsYy5wKCEwKSkmJihmPSEwKX19LFJhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLkZbYV0mJnRoaXMuRlthXS5sZW5ndGh9LFhjOmZ1bmN0aW9uKGIpe2lmKGIpcmV0dXJuIHRoaXMuRltiXSYmdGhpcy5GW2JdLmxlbmd0aHx8MDt2YXIgYz0wO2EuYS5EKHRoaXMuRixmdW5jdGlvbihhLGIpe1wiZGlydHlcIiE9PWEmJihjKz1iLmxlbmd0aCl9KTtyZXR1cm4gY30sVWE6ZnVuY3Rpb24oYSxjKXtyZXR1cm4hdGhpcy5lcXVhbGl0eUNvbXBhcmVyfHwhdGhpcy5lcXVhbGl0eUNvbXBhcmVyKGEsYyl9LGV4dGVuZDpmdW5jdGlvbihiKXt2YXIgYz10aGlzO2ImJmEuYS5EKGIsZnVuY3Rpb24oYixlKXt2YXIgZj1hLkFhW2JdO1wiZnVuY3Rpb25cIj09XG50eXBlb2YgZiYmKGM9ZihjLGUpfHxjKX0pO3JldHVybiBjfX07YS5IKEQsXCJzdWJzY3JpYmVcIixELlkpO2EuSChELFwiZXh0ZW5kXCIsRC5leHRlbmQpO2EuSChELFwiZ2V0U3Vic2NyaXB0aW9uc0NvdW50XCIsRC5YYyk7YS5hLmxhJiZhLmEuJGEoRCxGdW5jdGlvbi5wcm90b3R5cGUpO2EuSy5mbj1EO2EubGM9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPWEmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuWSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYS5ub3RpZnlTdWJzY3JpYmVyc307YS5iKFwic3Vic2NyaWJhYmxlXCIsYS5LKTthLmIoXCJpc1N1YnNjcmliYWJsZVwiLGEubGMpO2EueGE9YS5sPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihhKXtkLnB1c2goZSk7ZT1hfWZ1bmN0aW9uIGMoKXtlPWQucG9wKCl9dmFyIGQ9W10sZSxmPTA7cmV0dXJue1hiOmIsZW5kOmMsc2M6ZnVuY3Rpb24oYil7aWYoZSl7aWYoIWEubGMoYikpdGhyb3cgRXJyb3IoXCJPbmx5IHN1YnNjcmliYWJsZSB0aGluZ3MgY2FuIGFjdCBhcyBkZXBlbmRlbmNpZXNcIik7XG5lLmpiLmNhbGwoZS5MYyxiLGIuR2N8fChiLkdjPSsrZikpfX0sdzpmdW5jdGlvbihhLGQsZSl7dHJ5e3JldHVybiBiKCksYS5hcHBseShkLGV8fFtdKX1maW5hbGx5e2MoKX19LENhOmZ1bmN0aW9uKCl7aWYoZSlyZXR1cm4gZS5tLkNhKCl9LFZhOmZ1bmN0aW9uKCl7aWYoZSlyZXR1cm4gZS5WYX19fSgpO2EuYihcImNvbXB1dGVkQ29udGV4dFwiLGEueGEpO2EuYihcImNvbXB1dGVkQ29udGV4dC5nZXREZXBlbmRlbmNpZXNDb3VudFwiLGEueGEuQ2EpO2EuYihcImNvbXB1dGVkQ29udGV4dC5pc0luaXRpYWxcIixhLnhhLlZhKTthLmIoXCJpZ25vcmVEZXBlbmRlbmNpZXNcIixhLndkPWEubC53KTt2YXIgRj1hLmEuYmMoXCJfbGF0ZXN0VmFsdWVcIik7YS5PPWZ1bmN0aW9uKGIpe2Z1bmN0aW9uIGMoKXtpZigwPGFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGMuVWEoY1tGXSxhcmd1bWVudHNbMF0pJiYoYy5pYSgpLGNbRl09YXJndW1lbnRzWzBdLGMuaGEoKSksdGhpczthLmwuc2MoYyk7cmV0dXJuIGNbRl19XG5jW0ZdPWI7YS5hLmxhfHxhLmEuZXh0ZW5kKGMsYS5LLmZuKTthLksuZm4udWIoYyk7YS5hLmFiKGMsQik7YS5vcHRpb25zLmRlZmVyVXBkYXRlcyYmYS5BYS5kZWZlcnJlZChjLCEwKTtyZXR1cm4gY307dmFyIEI9e2VxdWFsaXR5Q29tcGFyZXI6SixwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXNbRl19LGhhOmZ1bmN0aW9uKCl7dGhpcy5ub3RpZnlTdWJzY3JpYmVycyh0aGlzW0ZdKX0saWE6ZnVuY3Rpb24oKXt0aGlzLm5vdGlmeVN1YnNjcmliZXJzKHRoaXNbRl0sXCJiZWZvcmVDaGFuZ2VcIil9fTthLmEubGEmJmEuYS4kYShCLGEuSy5mbik7dmFyIEk9YS5PLm1kPVwiX19rb19wcm90b19fXCI7QltJXT1hLk87YS5RYT1mdW5jdGlvbihiLGMpe3JldHVybiBudWxsPT09Ynx8Yj09PW58fGJbSV09PT1uPyExOmJbSV09PT1jPyEwOmEuUWEoYltJXSxjKX07YS5JPWZ1bmN0aW9uKGIpe3JldHVybiBhLlFhKGIsYS5PKX07YS5EYT1mdW5jdGlvbihiKXtyZXR1cm5cImZ1bmN0aW9uXCI9PXR5cGVvZiBiJiZcbmJbSV09PT1hLk98fFwiZnVuY3Rpb25cIj09dHlwZW9mIGImJmJbSV09PT1hLkImJmIuJGM/ITA6ITF9O2EuYihcIm9ic2VydmFibGVcIixhLk8pO2EuYihcImlzT2JzZXJ2YWJsZVwiLGEuSSk7YS5iKFwiaXNXcml0ZWFibGVPYnNlcnZhYmxlXCIsYS5EYSk7YS5iKFwiaXNXcml0YWJsZU9ic2VydmFibGVcIixhLkRhKTthLmIoXCJvYnNlcnZhYmxlLmZuXCIsQik7YS5IKEIsXCJwZWVrXCIsQi5wKTthLkgoQixcInZhbHVlSGFzTXV0YXRlZFwiLEIuaGEpO2EuSChCLFwidmFsdWVXaWxsTXV0YXRlXCIsQi5pYSk7YS5tYT1mdW5jdGlvbihiKXtiPWJ8fFtdO2lmKFwib2JqZWN0XCIhPXR5cGVvZiBifHwhKFwibGVuZ3RoXCJpbiBiKSl0aHJvdyBFcnJvcihcIlRoZSBhcmd1bWVudCBwYXNzZWQgd2hlbiBpbml0aWFsaXppbmcgYW4gb2JzZXJ2YWJsZSBhcnJheSBtdXN0IGJlIGFuIGFycmF5LCBvciBudWxsLCBvciB1bmRlZmluZWQuXCIpO2I9YS5PKGIpO2EuYS5hYihiLGEubWEuZm4pO3JldHVybiBiLmV4dGVuZCh7dHJhY2tBcnJheUNoYW5nZXM6ITB9KX07XG5hLm1hLmZuPXtyZW1vdmU6ZnVuY3Rpb24oYil7Zm9yKHZhciBjPXRoaXMucCgpLGQ9W10sZT1cImZ1bmN0aW9uXCIhPXR5cGVvZiBifHxhLkkoYik/ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1ifTpiLGY9MDtmPGMubGVuZ3RoO2YrKyl7dmFyIGc9Y1tmXTtlKGcpJiYoMD09PWQubGVuZ3RoJiZ0aGlzLmlhKCksZC5wdXNoKGcpLGMuc3BsaWNlKGYsMSksZi0tKX1kLmxlbmd0aCYmdGhpcy5oYSgpO3JldHVybiBkfSxyZW1vdmVBbGw6ZnVuY3Rpb24oYil7aWYoYj09PW4pe3ZhciBjPXRoaXMucCgpLGQ9Yy5zbGljZSgwKTt0aGlzLmlhKCk7Yy5zcGxpY2UoMCxjLmxlbmd0aCk7dGhpcy5oYSgpO3JldHVybiBkfXJldHVybiBiP3RoaXMucmVtb3ZlKGZ1bmN0aW9uKGMpe3JldHVybiAwPD1hLmEubyhiLGMpfSk6W119LGRlc3Ryb3k6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5wKCksZD1cImZ1bmN0aW9uXCIhPXR5cGVvZiBifHxhLkkoYik/ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1ifTpiO3RoaXMuaWEoKTtcbmZvcih2YXIgZT1jLmxlbmd0aC0xOzA8PWU7ZS0tKWQoY1tlXSkmJihjW2VdLl9kZXN0cm95PSEwKTt0aGlzLmhhKCl9LGRlc3Ryb3lBbGw6ZnVuY3Rpb24oYil7cmV0dXJuIGI9PT1uP3RoaXMuZGVzdHJveShmdW5jdGlvbigpe3JldHVybiEwfSk6Yj90aGlzLmRlc3Ryb3koZnVuY3Rpb24oYyl7cmV0dXJuIDA8PWEuYS5vKGIsYyl9KTpbXX0saW5kZXhPZjpmdW5jdGlvbihiKXt2YXIgYz10aGlzKCk7cmV0dXJuIGEuYS5vKGMsYil9LHJlcGxhY2U6ZnVuY3Rpb24oYSxjKXt2YXIgZD10aGlzLmluZGV4T2YoYSk7MDw9ZCYmKHRoaXMuaWEoKSx0aGlzLnAoKVtkXT1jLHRoaXMuaGEoKSl9fTthLmEubGEmJmEuYS4kYShhLm1hLmZuLGEuTy5mbik7YS5hLnIoXCJwb3AgcHVzaCByZXZlcnNlIHNoaWZ0IHNvcnQgc3BsaWNlIHVuc2hpZnRcIi5zcGxpdChcIiBcIiksZnVuY3Rpb24oYil7YS5tYS5mbltiXT1mdW5jdGlvbigpe3ZhciBhPXRoaXMucCgpO3RoaXMuaWEoKTt0aGlzLlliKGEsYixhcmd1bWVudHMpO1xudmFyIGQ9YVtiXS5hcHBseShhLGFyZ3VtZW50cyk7dGhpcy5oYSgpO3JldHVybiBkPT09YT90aGlzOmR9fSk7YS5hLnIoW1wic2xpY2VcIl0sZnVuY3Rpb24oYil7YS5tYS5mbltiXT1mdW5jdGlvbigpe3ZhciBhPXRoaXMoKTtyZXR1cm4gYVtiXS5hcHBseShhLGFyZ3VtZW50cyl9fSk7YS5iKFwib2JzZXJ2YWJsZUFycmF5XCIsYS5tYSk7YS5BYS50cmFja0FycmF5Q2hhbmdlcz1mdW5jdGlvbihiLGMpe2Z1bmN0aW9uIGQoKXtpZighZSl7ZT0hMDtsPWIubm90aWZ5U3Vic2NyaWJlcnM7Yi5ub3RpZnlTdWJzY3JpYmVycz1mdW5jdGlvbihhLGIpe2ImJmIhPT1FfHwrK2g7cmV0dXJuIGwuYXBwbHkodGhpcyxhcmd1bWVudHMpfTt2YXIgYz1bXS5jb25jYXQoYi5wKCl8fFtdKTtmPW51bGw7Zz1iLlkoZnVuY3Rpb24oZCl7ZD1bXS5jb25jYXQoZHx8W10pO2lmKGIuUmEoXCJhcnJheUNoYW5nZVwiKSl7dmFyIGU7aWYoIWZ8fDE8aClmPWEuYS5sYihjLGQsYi5rYik7ZT1mfWM9ZDtmPW51bGw7aD0wO1xuZSYmZS5sZW5ndGgmJmIubm90aWZ5U3Vic2NyaWJlcnMoZSxcImFycmF5Q2hhbmdlXCIpfSl9fWIua2I9e307YyYmXCJvYmplY3RcIj09dHlwZW9mIGMmJmEuYS5leHRlbmQoYi5rYixjKTtiLmtiLnNwYXJzZT0hMDtpZighYi5ZYil7dmFyIGU9ITEsZj1udWxsLGcsaD0wLGwsbT1iLnVhLGs9Yi5LYTtiLnVhPWZ1bmN0aW9uKGEpe20mJm0uY2FsbChiLGEpO1wiYXJyYXlDaGFuZ2VcIj09PWEmJmQoKX07Yi5LYT1mdW5jdGlvbihhKXtrJiZrLmNhbGwoYixhKTtcImFycmF5Q2hhbmdlXCIhPT1hfHxiLlJhKFwiYXJyYXlDaGFuZ2VcIil8fChsJiYoYi5ub3RpZnlTdWJzY3JpYmVycz1sLGw9biksZy5rKCksZT0hMSl9O2IuWWI9ZnVuY3Rpb24oYixjLGQpe2Z1bmN0aW9uIGsoYSxiLGMpe3JldHVybiBtW20ubGVuZ3RoXT17c3RhdHVzOmEsdmFsdWU6YixpbmRleDpjfX1pZihlJiYhaCl7dmFyIG09W10sbD1iLmxlbmd0aCxnPWQubGVuZ3RoLEc9MDtzd2l0Y2goYyl7Y2FzZSBcInB1c2hcIjpHPWw7Y2FzZSBcInVuc2hpZnRcIjpmb3IoYz1cbjA7YzxnO2MrKylrKFwiYWRkZWRcIixkW2NdLEcrYyk7YnJlYWs7Y2FzZSBcInBvcFwiOkc9bC0xO2Nhc2UgXCJzaGlmdFwiOmwmJmsoXCJkZWxldGVkXCIsYltHXSxHKTticmVhaztjYXNlIFwic3BsaWNlXCI6Yz1NYXRoLm1pbihNYXRoLm1heCgwLDA+ZFswXT9sK2RbMF06ZFswXSksbCk7Zm9yKHZhciBsPTE9PT1nP2w6TWF0aC5taW4oYysoZFsxXXx8MCksbCksZz1jK2ctMixHPU1hdGgubWF4KGwsZyksbj1bXSxzPVtdLHc9MjtjPEc7KytjLCsrdyljPGwmJnMucHVzaChrKFwiZGVsZXRlZFwiLGJbY10sYykpLGM8ZyYmbi5wdXNoKGsoXCJhZGRlZFwiLGRbd10sYykpO2EuYS5oYyhzLG4pO2JyZWFrO2RlZmF1bHQ6cmV0dXJufWY9bX19fX07dmFyIHM9YS5hLmJjKFwiX3N0YXRlXCIpO2EubT1hLkI9ZnVuY3Rpb24oYixjLGQpe2Z1bmN0aW9uIGUoKXtpZigwPGFyZ3VtZW50cy5sZW5ndGgpe2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBmKWYuYXBwbHkoZy5zYixhcmd1bWVudHMpO2Vsc2UgdGhyb3cgRXJyb3IoXCJDYW5ub3Qgd3JpdGUgYSB2YWx1ZSB0byBhIGtvLmNvbXB1dGVkIHVubGVzcyB5b3Ugc3BlY2lmeSBhICd3cml0ZScgb3B0aW9uLiBJZiB5b3Ugd2lzaCB0byByZWFkIHRoZSBjdXJyZW50IHZhbHVlLCBkb24ndCBwYXNzIGFueSBwYXJhbWV0ZXJzLlwiKTtcbnJldHVybiB0aGlzfWEubC5zYyhlKTsoZy5WfHxnLnQmJmUuU2EoKSkmJmUuVSgpO3JldHVybiBnLk19XCJvYmplY3RcIj09PXR5cGVvZiBiP2Q9YjooZD1kfHx7fSxiJiYoZC5yZWFkPWIpKTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBkLnJlYWQpdGhyb3cgRXJyb3IoXCJQYXNzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUga28uY29tcHV0ZWRcIik7dmFyIGY9ZC53cml0ZSxnPXtNOm4sZGE6ITAsVjohMCxUYTohMSxIYjohMSxUOiExLFlhOiExLHQ6ITEsb2Q6ZC5yZWFkLHNiOmN8fGQub3duZXIsaTpkLmRpc3Bvc2VXaGVuTm9kZUlzUmVtb3ZlZHx8ZC5pfHxudWxsLHlhOmQuZGlzcG9zZVdoZW58fGQueWEscGI6bnVsbCxzOnt9LEw6MCxmYzpudWxsfTtlW3NdPWc7ZS4kYz1cImZ1bmN0aW9uXCI9PT10eXBlb2YgZjthLmEubGF8fGEuYS5leHRlbmQoZSxhLksuZm4pO2EuSy5mbi51YihlKTthLmEuYWIoZSx6KTtkLnB1cmU/KGcuWWE9ITAsZy50PSEwLGEuYS5leHRlbmQoZSxcblkpKTpkLmRlZmVyRXZhbHVhdGlvbiYmYS5hLmV4dGVuZChlLFopO2Eub3B0aW9ucy5kZWZlclVwZGF0ZXMmJmEuQWEuZGVmZXJyZWQoZSwhMCk7Zy5pJiYoZy5IYj0hMCxnLmkubm9kZVR5cGV8fChnLmk9bnVsbCkpO2cudHx8ZC5kZWZlckV2YWx1YXRpb258fGUuVSgpO2cuaSYmZS5jYSgpJiZhLmEuRy5xYShnLmksZy5wYj1mdW5jdGlvbigpe2UuaygpfSk7cmV0dXJuIGV9O3ZhciB6PXtlcXVhbGl0eUNvbXBhcmVyOkosQ2E6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc1tzXS5MfSxTYjpmdW5jdGlvbihhLGMsZCl7aWYodGhpc1tzXS5ZYSYmYz09PXRoaXMpdGhyb3cgRXJyb3IoXCJBICdwdXJlJyBjb21wdXRlZCBtdXN0IG5vdCBiZSBjYWxsZWQgcmVjdXJzaXZlbHlcIik7dGhpc1tzXS5zW2FdPWQ7ZC5JYT10aGlzW3NdLkwrKztkLnBhPWMuUGEoKX0sU2E6ZnVuY3Rpb24oKXt2YXIgYSxjLGQ9dGhpc1tzXS5zO2ZvcihhIGluIGQpaWYoZC5oYXNPd25Qcm9wZXJ0eShhKSYmKGM9ZFthXSx0aGlzLm9hJiZcbmMuJC5IYXx8Yy4kLlpjKGMucGEpKSlyZXR1cm4hMH0sZ2Q6ZnVuY3Rpb24oKXt0aGlzLm9hJiYhdGhpc1tzXS5UYSYmdGhpcy5vYSghMSl9LGNhOmZ1bmN0aW9uKCl7dmFyIGE9dGhpc1tzXTtyZXR1cm4gYS5WfHwwPGEuTH0scWQ6ZnVuY3Rpb24oKXt0aGlzLkhhP3RoaXNbc10uViYmKHRoaXNbc10uZGE9ITApOnRoaXMuZWMoKX0seWM6ZnVuY3Rpb24oYSl7aWYoYS5nYiYmIXRoaXNbc10uaSl7dmFyIGM9YS5ZKHRoaXMuZ2QsdGhpcyxcImRpcnR5XCIpLGQ9YS5ZKHRoaXMucWQsdGhpcyk7cmV0dXJueyQ6YSxrOmZ1bmN0aW9uKCl7Yy5rKCk7ZC5rKCl9fX1yZXR1cm4gYS5ZKHRoaXMuZWMsdGhpcyl9LGVjOmZ1bmN0aW9uKCl7dmFyIGI9dGhpcyxjPWIudGhyb3R0bGVFdmFsdWF0aW9uO2MmJjA8PWM/KGNsZWFyVGltZW91dCh0aGlzW3NdLmZjKSx0aGlzW3NdLmZjPWEuYS5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi5VKCEwKX0sYykpOmIub2E/Yi5vYSghMCk6Yi5VKCEwKX0sVTpmdW5jdGlvbihiKXt2YXIgYz1cbnRoaXNbc10sZD1jLnlhLGU9ITE7aWYoIWMuVGEmJiFjLlQpe2lmKGMuaSYmIWEuYS5xYihjLmkpfHxkJiZkKCkpe2lmKCFjLkhiKXt0aGlzLmsoKTtyZXR1cm59fWVsc2UgYy5IYj0hMTtjLlRhPSEwO3RyeXtlPXRoaXMuVmMoYil9ZmluYWxseXtjLlRhPSExfWMuTHx8dGhpcy5rKCk7cmV0dXJuIGV9fSxWYzpmdW5jdGlvbihiKXt2YXIgYz10aGlzW3NdLGQ9ITEsZT1jLllhP246IWMuTCxmPXtNYzp0aGlzLE9hOmMucyxvYjpjLkx9O2EubC5YYih7TGM6ZixqYjpXLG06dGhpcyxWYTplfSk7Yy5zPXt9O2MuTD0wO2Y9dGhpcy5VYyhjLGYpO3RoaXMuVWEoYy5NLGYpJiYoYy50fHx0aGlzLm5vdGlmeVN1YnNjcmliZXJzKGMuTSxcImJlZm9yZUNoYW5nZVwiKSxjLk09ZixjLnQ/dGhpcy5LYigpOmImJnRoaXMubm90aWZ5U3Vic2NyaWJlcnMoYy5NKSxkPSEwKTtlJiZ0aGlzLm5vdGlmeVN1YnNjcmliZXJzKGMuTSxcImF3YWtlXCIpO3JldHVybiBkfSxVYzpmdW5jdGlvbihiLGMpe3RyeXt2YXIgZD1cbmIub2Q7cmV0dXJuIGIuc2I/ZC5jYWxsKGIuc2IpOmQoKX1maW5hbGx5e2EubC5lbmQoKSxjLm9iJiYhYi50JiZhLmEuRChjLk9hLFYpLGIuZGE9Yi5WPSExfX0scDpmdW5jdGlvbihhKXt2YXIgYz10aGlzW3NdOyhjLlYmJihhfHwhYy5MKXx8Yy50JiZ0aGlzLlNhKCkpJiZ0aGlzLlUoKTtyZXR1cm4gYy5NfSxXYTpmdW5jdGlvbihiKXthLksuZm4uV2EuY2FsbCh0aGlzLGIpO3RoaXMuTWI9ZnVuY3Rpb24oKXt0aGlzW3NdLmRhP3RoaXMuVSgpOnRoaXNbc10uVj0hMTtyZXR1cm4gdGhpc1tzXS5NfTt0aGlzLm9hPWZ1bmN0aW9uKGEpe3RoaXMuT2IodGhpc1tzXS5NKTt0aGlzW3NdLlY9ITA7YSYmKHRoaXNbc10uZGE9ITApO3RoaXMuUGIodGhpcyl9fSxrOmZ1bmN0aW9uKCl7dmFyIGI9dGhpc1tzXTshYi50JiZiLnMmJmEuYS5EKGIucyxmdW5jdGlvbihhLGIpe2IuayYmYi5rKCl9KTtiLmkmJmIucGImJmEuYS5HLnRjKGIuaSxiLnBiKTtiLnM9bnVsbDtiLkw9MDtiLlQ9ITA7Yi5kYT1cbiExO2IuVj0hMTtiLnQ9ITE7Yi5pPW51bGx9fSxZPXt1YTpmdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9Y1tzXTtpZighZC5UJiZkLnQmJlwiY2hhbmdlXCI9PWIpe2QudD0hMTtpZihkLmRhfHxjLlNhKCkpZC5zPW51bGwsZC5MPTAsYy5VKCkmJmMuS2IoKTtlbHNle3ZhciBlPVtdO2EuYS5EKGQucyxmdW5jdGlvbihhLGIpe2VbYi5JYV09YX0pO2EuYS5yKGUsZnVuY3Rpb24oYSxiKXt2YXIgZT1kLnNbYV0sbD1jLnljKGUuJCk7bC5JYT1iO2wucGE9ZS5wYTtkLnNbYV09bH0pfWQuVHx8Yy5ub3RpZnlTdWJzY3JpYmVycyhkLk0sXCJhd2FrZVwiKX19LEthOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXNbc107Yy5UfHxcImNoYW5nZVwiIT1ifHx0aGlzLlJhKFwiY2hhbmdlXCIpfHwoYS5hLkQoYy5zLGZ1bmN0aW9uKGEsYil7Yi5rJiYoYy5zW2FdPXskOmIuJCxJYTpiLklhLHBhOmIucGF9LGIuaygpKX0pLGMudD0hMCx0aGlzLm5vdGlmeVN1YnNjcmliZXJzKG4sXCJhc2xlZXBcIikpfSxQYTpmdW5jdGlvbigpe3ZhciBiPVxudGhpc1tzXTtiLnQmJihiLmRhfHx0aGlzLlNhKCkpJiZ0aGlzLlUoKTtyZXR1cm4gYS5LLmZuLlBhLmNhbGwodGhpcyl9fSxaPXt1YTpmdW5jdGlvbihhKXtcImNoYW5nZVwiIT1hJiZcImJlZm9yZUNoYW5nZVwiIT1hfHx0aGlzLnAoKX19O2EuYS5sYSYmYS5hLiRhKHosYS5LLmZuKTt2YXIgUD1hLk8ubWQ7YS5tW1BdPWEuTzt6W1BdPWEubTthLmJkPWZ1bmN0aW9uKGIpe3JldHVybiBhLlFhKGIsYS5tKX07YS5jZD1mdW5jdGlvbihiKXtyZXR1cm4gYS5RYShiLGEubSkmJmJbc10mJmJbc10uWWF9O2EuYihcImNvbXB1dGVkXCIsYS5tKTthLmIoXCJkZXBlbmRlbnRPYnNlcnZhYmxlXCIsYS5tKTthLmIoXCJpc0NvbXB1dGVkXCIsYS5iZCk7YS5iKFwiaXNQdXJlQ29tcHV0ZWRcIixhLmNkKTthLmIoXCJjb21wdXRlZC5mblwiLHopO2EuSCh6LFwicGVla1wiLHoucCk7YS5IKHosXCJkaXNwb3NlXCIsei5rKTthLkgoeixcImlzQWN0aXZlXCIsei5jYSk7YS5IKHosXCJnZXREZXBlbmRlbmNpZXNDb3VudFwiLHouQ2EpO2EucmM9XG5mdW5jdGlvbihiLGMpe2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBiKXJldHVybiBhLm0oYixjLHtwdXJlOiEwfSk7Yj1hLmEuZXh0ZW5kKHt9LGIpO2IucHVyZT0hMDtyZXR1cm4gYS5tKGIsYyl9O2EuYihcInB1cmVDb21wdXRlZFwiLGEucmMpOyhmdW5jdGlvbigpe2Z1bmN0aW9uIGIoYSxmLGcpe2c9Z3x8bmV3IGQ7YT1mKGEpO2lmKFwib2JqZWN0XCIhPXR5cGVvZiBhfHxudWxsPT09YXx8YT09PW58fGEgaW5zdGFuY2VvZiBSZWdFeHB8fGEgaW5zdGFuY2VvZiBEYXRlfHxhIGluc3RhbmNlb2YgU3RyaW5nfHxhIGluc3RhbmNlb2YgTnVtYmVyfHxhIGluc3RhbmNlb2YgQm9vbGVhbilyZXR1cm4gYTt2YXIgaD1hIGluc3RhbmNlb2YgQXJyYXk/W106e307Zy5zYXZlKGEsaCk7YyhhLGZ1bmN0aW9uKGMpe3ZhciBkPWYoYVtjXSk7c3dpdGNoKHR5cGVvZiBkKXtjYXNlIFwiYm9vbGVhblwiOmNhc2UgXCJudW1iZXJcIjpjYXNlIFwic3RyaW5nXCI6Y2FzZSBcImZ1bmN0aW9uXCI6aFtjXT1kO2JyZWFrO2Nhc2UgXCJvYmplY3RcIjpjYXNlIFwidW5kZWZpbmVkXCI6dmFyIGs9XG5nLmdldChkKTtoW2NdPWshPT1uP2s6YihkLGYsZyl9fSk7cmV0dXJuIGh9ZnVuY3Rpb24gYyhhLGIpe2lmKGEgaW5zdGFuY2VvZiBBcnJheSl7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspYihjKTtcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLnRvSlNPTiYmYihcInRvSlNPTlwiKX1lbHNlIGZvcihjIGluIGEpYihjKX1mdW5jdGlvbiBkKCl7dGhpcy5rZXlzPVtdO3RoaXMuTGI9W119YS5BYz1mdW5jdGlvbihjKXtpZigwPT1hcmd1bWVudHMubGVuZ3RoKXRocm93IEVycm9yKFwiV2hlbiBjYWxsaW5nIGtvLnRvSlMsIHBhc3MgdGhlIG9iamVjdCB5b3Ugd2FudCB0byBjb252ZXJ0LlwiKTtyZXR1cm4gYihjLGZ1bmN0aW9uKGIpe2Zvcih2YXIgYz0wO2EuSShiKSYmMTA+YztjKyspYj1iKCk7cmV0dXJuIGJ9KX07YS50b0pTT049ZnVuY3Rpb24oYixjLGQpe2I9YS5BYyhiKTtyZXR1cm4gYS5hLkdiKGIsYyxkKX07ZC5wcm90b3R5cGU9e3NhdmU6ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmEubyh0aGlzLmtleXMsXG5iKTswPD1kP3RoaXMuTGJbZF09YzoodGhpcy5rZXlzLnB1c2goYiksdGhpcy5MYi5wdXNoKGMpKX0sZ2V0OmZ1bmN0aW9uKGIpe2I9YS5hLm8odGhpcy5rZXlzLGIpO3JldHVybiAwPD1iP3RoaXMuTGJbYl06bn19fSkoKTthLmIoXCJ0b0pTXCIsYS5BYyk7YS5iKFwidG9KU09OXCIsYS50b0pTT04pOyhmdW5jdGlvbigpe2Euaj17dTpmdW5jdGlvbihiKXtzd2l0Y2goYS5hLkEoYikpe2Nhc2UgXCJvcHRpb25cIjpyZXR1cm4hMD09PWIuX19rb19faGFzRG9tRGF0YU9wdGlvblZhbHVlX18/YS5hLmUuZ2V0KGIsYS5kLm9wdGlvbnMuemIpOjc+PWEuYS5DP2IuZ2V0QXR0cmlidXRlTm9kZShcInZhbHVlXCIpJiZiLmdldEF0dHJpYnV0ZU5vZGUoXCJ2YWx1ZVwiKS5zcGVjaWZpZWQ/Yi52YWx1ZTpiLnRleHQ6Yi52YWx1ZTtjYXNlIFwic2VsZWN0XCI6cmV0dXJuIDA8PWIuc2VsZWN0ZWRJbmRleD9hLmoudShiLm9wdGlvbnNbYi5zZWxlY3RlZEluZGV4XSk6bjtkZWZhdWx0OnJldHVybiBiLnZhbHVlfX0samE6ZnVuY3Rpb24oYixcbmMsZCl7c3dpdGNoKGEuYS5BKGIpKXtjYXNlIFwib3B0aW9uXCI6c3dpdGNoKHR5cGVvZiBjKXtjYXNlIFwic3RyaW5nXCI6YS5hLmUuc2V0KGIsYS5kLm9wdGlvbnMuemIsbik7XCJfX2tvX19oYXNEb21EYXRhT3B0aW9uVmFsdWVfX1wiaW4gYiYmZGVsZXRlIGIuX19rb19faGFzRG9tRGF0YU9wdGlvblZhbHVlX187Yi52YWx1ZT1jO2JyZWFrO2RlZmF1bHQ6YS5hLmUuc2V0KGIsYS5kLm9wdGlvbnMuemIsYyksYi5fX2tvX19oYXNEb21EYXRhT3B0aW9uVmFsdWVfXz0hMCxiLnZhbHVlPVwibnVtYmVyXCI9PT10eXBlb2YgYz9jOlwiXCJ9YnJlYWs7Y2FzZSBcInNlbGVjdFwiOmlmKFwiXCI9PT1jfHxudWxsPT09YyljPW47Zm9yKHZhciBlPS0xLGY9MCxnPWIub3B0aW9ucy5sZW5ndGgsaDtmPGc7KytmKWlmKGg9YS5qLnUoYi5vcHRpb25zW2ZdKSxoPT1jfHxcIlwiPT1oJiZjPT09bil7ZT1mO2JyZWFrfWlmKGR8fDA8PWV8fGM9PT1uJiYxPGIuc2l6ZSliLnNlbGVjdGVkSW5kZXg9ZTticmVhaztkZWZhdWx0OmlmKG51bGw9PT1cbmN8fGM9PT1uKWM9XCJcIjtiLnZhbHVlPWN9fX19KSgpO2EuYihcInNlbGVjdEV4dGVuc2lvbnNcIixhLmopO2EuYihcInNlbGVjdEV4dGVuc2lvbnMucmVhZFZhbHVlXCIsYS5qLnUpO2EuYihcInNlbGVjdEV4dGVuc2lvbnMud3JpdGVWYWx1ZVwiLGEuai5qYSk7YS5oPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiKXtiPWEuYS5jYihiKTsxMjM9PT1iLmNoYXJDb2RlQXQoMCkmJihiPWIuc2xpY2UoMSwtMSkpO3ZhciBjPVtdLGQ9Yi5tYXRjaChlKSxyLGg9W10scD0wO2lmKGQpe2QucHVzaChcIixcIik7Zm9yKHZhciBBPTAseTt5PWRbQV07KytBKXt2YXIgdj15LmNoYXJDb2RlQXQoMCk7aWYoNDQ9PT12KXtpZigwPj1wKXtjLnB1c2gociYmaC5sZW5ndGg/e2tleTpyLHZhbHVlOmguam9pbihcIlwiKX06e3Vua25vd246cnx8aC5qb2luKFwiXCIpfSk7cj1wPTA7aD1bXTtjb250aW51ZX19ZWxzZSBpZig1OD09PXYpe2lmKCFwJiYhciYmMT09PWgubGVuZ3RoKXtyPWgucG9wKCk7Y29udGludWV9fWVsc2UgNDc9PT1cbnYmJkEmJjE8eS5sZW5ndGg/KHY9ZFtBLTFdLm1hdGNoKGYpKSYmIWdbdlswXV0mJihiPWIuc3Vic3RyKGIuaW5kZXhPZih5KSsxKSxkPWIubWF0Y2goZSksZC5wdXNoKFwiLFwiKSxBPS0xLHk9XCIvXCIpOjQwPT09dnx8MTIzPT09dnx8OTE9PT12PysrcDo0MT09PXZ8fDEyNT09PXZ8fDkzPT09dj8tLXA6cnx8aC5sZW5ndGh8fDM0IT09diYmMzkhPT12fHwoeT15LnNsaWNlKDEsLTEpKTtoLnB1c2goeSl9fXJldHVybiBjfXZhciBjPVtcInRydWVcIixcImZhbHNlXCIsXCJudWxsXCIsXCJ1bmRlZmluZWRcIl0sZD0vXig/OlskX2Etel1bJFxcd10qfCguKykoXFwuXFxzKlskX2Etel1bJFxcd10qfFxcWy4rXFxdKSkkL2ksZT1SZWdFeHAoXCJcXFwiKD86W15cXFwiXFxcXFxcXFxdfFxcXFxcXFxcLikqXFxcInwnKD86W14nXFxcXFxcXFxdfFxcXFxcXFxcLikqJ3wvKD86W14vXFxcXFxcXFxdfFxcXFxcXFxcLikqL3cqfFteXFxcXHM6LC9dW14sXFxcIid7fSgpLzpbXFxcXF1dKlteXFxcXHMsXFxcIid7fSgpLzpbXFxcXF1dfFteXFxcXHNdXCIsXCJnXCIpLGY9L1tcXF0pXCInQS1aYS16MC05XyRdKyQvLFxuZz17XCJpblwiOjEsXCJyZXR1cm5cIjoxLFwidHlwZW9mXCI6MX0saD17fTtyZXR1cm57dmE6W10sZ2E6aCxBYjpiLFhhOmZ1bmN0aW9uKGUsbSl7ZnVuY3Rpb24gayhiLGUpe3ZhciBtO2lmKCFBKXt2YXIgbD1hLmdldEJpbmRpbmdIYW5kbGVyKGIpO2lmKGwmJmwucHJlcHJvY2VzcyYmIShlPWwucHJlcHJvY2VzcyhlLGIsaykpKXJldHVybjtpZihsPWhbYl0pbT1lLDA8PWEuYS5vKGMsbSk/bT0hMToobD1tLm1hdGNoKGQpLG09bnVsbD09PWw/ITE6bFsxXT9cIk9iamVjdChcIitsWzFdK1wiKVwiK2xbMl06bSksbD1tO2wmJmcucHVzaChcIidcIitiK1wiJzpmdW5jdGlvbihfeil7XCIrbStcIj1fen1cIil9cCYmKGU9XCJmdW5jdGlvbigpe3JldHVybiBcIitlK1wiIH1cIik7Zi5wdXNoKFwiJ1wiK2IrXCInOlwiK2UpfW09bXx8e307dmFyIGY9W10sZz1bXSxwPW0udmFsdWVBY2Nlc3NvcnMsQT1tLmJpbmRpbmdQYXJhbXMseT1cInN0cmluZ1wiPT09dHlwZW9mIGU/YihlKTplO2EuYS5yKHksZnVuY3Rpb24oYSl7ayhhLmtleXx8XG5hLnVua25vd24sYS52YWx1ZSl9KTtnLmxlbmd0aCYmayhcIl9rb19wcm9wZXJ0eV93cml0ZXJzXCIsXCJ7XCIrZy5qb2luKFwiLFwiKStcIiB9XCIpO3JldHVybiBmLmpvaW4oXCIsXCIpfSxmZDpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7YysrKWlmKGFbY10ua2V5PT1iKXJldHVybiEwO3JldHVybiExfSxHYTpmdW5jdGlvbihiLGMsZCxlLGYpe2lmKGImJmEuSShiKSkhYS5EYShiKXx8ZiYmYi5wKCk9PT1lfHxiKGUpO2Vsc2UgaWYoKGI9Yy5nZXQoXCJfa29fcHJvcGVydHlfd3JpdGVyc1wiKSkmJmJbZF0pYltkXShlKX19fSgpO2EuYihcImV4cHJlc3Npb25SZXdyaXRpbmdcIixhLmgpO2EuYihcImV4cHJlc3Npb25SZXdyaXRpbmcuYmluZGluZ1Jld3JpdGVWYWxpZGF0b3JzXCIsYS5oLnZhKTthLmIoXCJleHByZXNzaW9uUmV3cml0aW5nLnBhcnNlT2JqZWN0TGl0ZXJhbFwiLGEuaC5BYik7YS5iKFwiZXhwcmVzc2lvblJld3JpdGluZy5wcmVQcm9jZXNzQmluZGluZ3NcIixhLmguWGEpO2EuYihcImV4cHJlc3Npb25SZXdyaXRpbmcuX3R3b1dheUJpbmRpbmdzXCIsXG5hLmguZ2EpO2EuYihcImpzb25FeHByZXNzaW9uUmV3cml0aW5nXCIsYS5oKTthLmIoXCJqc29uRXhwcmVzc2lvblJld3JpdGluZy5pbnNlcnRQcm9wZXJ0eUFjY2Vzc29yc0ludG9Kc29uXCIsYS5oLlhhKTsoZnVuY3Rpb24oKXtmdW5jdGlvbiBiKGEpe3JldHVybiA4PT1hLm5vZGVUeXBlJiZnLnRlc3QoZj9hLnRleHQ6YS5ub2RlVmFsdWUpfWZ1bmN0aW9uIGMoYSl7cmV0dXJuIDg9PWEubm9kZVR5cGUmJmgudGVzdChmP2EudGV4dDphLm5vZGVWYWx1ZSl9ZnVuY3Rpb24gZChhLGQpe2Zvcih2YXIgZT1hLGY9MSxsPVtdO2U9ZS5uZXh0U2libGluZzspe2lmKGMoZSkmJihmLS0sMD09PWYpKXJldHVybiBsO2wucHVzaChlKTtiKGUpJiZmKyt9aWYoIWQpdGhyb3cgRXJyb3IoXCJDYW5ub3QgZmluZCBjbG9zaW5nIGNvbW1lbnQgdGFnIHRvIG1hdGNoOiBcIithLm5vZGVWYWx1ZSk7cmV0dXJuIG51bGx9ZnVuY3Rpb24gZShhLGIpe3ZhciBjPWQoYSxiKTtyZXR1cm4gYz8wPGMubGVuZ3RoP2NbYy5sZW5ndGgtXG4xXS5uZXh0U2libGluZzphLm5leHRTaWJsaW5nOm51bGx9dmFyIGY9dCYmXCJcXHgzYyEtLXRlc3QtLVxceDNlXCI9PT10LmNyZWF0ZUNvbW1lbnQoXCJ0ZXN0XCIpLnRleHQsZz1mPy9eXFx4M2MhLS1cXHMqa28oPzpcXHMrKFtcXHNcXFNdKykpP1xccyotLVxceDNlJC86L15cXHMqa28oPzpcXHMrKFtcXHNcXFNdKykpP1xccyokLyxoPWY/L15cXHgzYyEtLVxccypcXC9rb1xccyotLVxceDNlJC86L15cXHMqXFwva29cXHMqJC8sbD17dWw6ITAsb2w6ITB9O2EuZj17YWE6e30sY2hpbGROb2RlczpmdW5jdGlvbihhKXtyZXR1cm4gYihhKT9kKGEpOmEuY2hpbGROb2Rlc30semE6ZnVuY3Rpb24oYyl7aWYoYihjKSl7Yz1hLmYuY2hpbGROb2RlcyhjKTtmb3IodmFyIGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspYS5yZW1vdmVOb2RlKGNbZF0pfWVsc2UgYS5hLnJiKGMpfSxmYTpmdW5jdGlvbihjLGQpe2lmKGIoYykpe2EuZi56YShjKTtmb3IodmFyIGU9Yy5uZXh0U2libGluZyxmPTAsbD1kLmxlbmd0aDtmPGw7ZisrKWUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZFtmXSxcbmUpfWVsc2UgYS5hLmZhKGMsZCl9LHFjOmZ1bmN0aW9uKGEsYyl7YihhKT9hLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGMsYS5uZXh0U2libGluZyk6YS5maXJzdENoaWxkP2EuaW5zZXJ0QmVmb3JlKGMsYS5maXJzdENoaWxkKTphLmFwcGVuZENoaWxkKGMpfSxrYzpmdW5jdGlvbihjLGQsZSl7ZT9iKGMpP2MucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZCxlLm5leHRTaWJsaW5nKTplLm5leHRTaWJsaW5nP2MuaW5zZXJ0QmVmb3JlKGQsZS5uZXh0U2libGluZyk6Yy5hcHBlbmRDaGlsZChkKTphLmYucWMoYyxkKX0sZmlyc3RDaGlsZDpmdW5jdGlvbihhKXtyZXR1cm4gYihhKT8hYS5uZXh0U2libGluZ3x8YyhhLm5leHRTaWJsaW5nKT9udWxsOmEubmV4dFNpYmxpbmc6YS5maXJzdENoaWxkfSxuZXh0U2libGluZzpmdW5jdGlvbihhKXtiKGEpJiYoYT1lKGEpKTtyZXR1cm4gYS5uZXh0U2libGluZyYmYyhhLm5leHRTaWJsaW5nKT9udWxsOmEubmV4dFNpYmxpbmd9LFljOmIsdmQ6ZnVuY3Rpb24oYSl7cmV0dXJuKGE9XG4oZj9hLnRleHQ6YS5ub2RlVmFsdWUpLm1hdGNoKGcpKT9hWzFdOm51bGx9LG9jOmZ1bmN0aW9uKGQpe2lmKGxbYS5hLkEoZCldKXt2YXIgaz1kLmZpcnN0Q2hpbGQ7aWYoayl7ZG8gaWYoMT09PWsubm9kZVR5cGUpe3ZhciBmO2Y9ay5maXJzdENoaWxkO3ZhciBnPW51bGw7aWYoZil7ZG8gaWYoZylnLnB1c2goZik7ZWxzZSBpZihiKGYpKXt2YXIgaD1lKGYsITApO2g/Zj1oOmc9W2ZdfWVsc2UgYyhmKSYmKGc9W2ZdKTt3aGlsZShmPWYubmV4dFNpYmxpbmcpfWlmKGY9Zylmb3IoZz1rLm5leHRTaWJsaW5nLGg9MDtoPGYubGVuZ3RoO2grKylnP2QuaW5zZXJ0QmVmb3JlKGZbaF0sZyk6ZC5hcHBlbmRDaGlsZChmW2hdKX13aGlsZShrPWsubmV4dFNpYmxpbmcpfX19fX0pKCk7YS5iKFwidmlydHVhbEVsZW1lbnRzXCIsYS5mKTthLmIoXCJ2aXJ0dWFsRWxlbWVudHMuYWxsb3dlZEJpbmRpbmdzXCIsYS5mLmFhKTthLmIoXCJ2aXJ0dWFsRWxlbWVudHMuZW1wdHlOb2RlXCIsYS5mLnphKTthLmIoXCJ2aXJ0dWFsRWxlbWVudHMuaW5zZXJ0QWZ0ZXJcIixcbmEuZi5rYyk7YS5iKFwidmlydHVhbEVsZW1lbnRzLnByZXBlbmRcIixhLmYucWMpO2EuYihcInZpcnR1YWxFbGVtZW50cy5zZXREb21Ob2RlQ2hpbGRyZW5cIixhLmYuZmEpOyhmdW5jdGlvbigpe2EuUz1mdW5jdGlvbigpe3RoaXMuS2M9e319O2EuYS5leHRlbmQoYS5TLnByb3RvdHlwZSx7bm9kZUhhc0JpbmRpbmdzOmZ1bmN0aW9uKGIpe3N3aXRjaChiLm5vZGVUeXBlKXtjYXNlIDE6cmV0dXJuIG51bGwhPWIuZ2V0QXR0cmlidXRlKFwiZGF0YS1iaW5kXCIpfHxhLmcuZ2V0Q29tcG9uZW50TmFtZUZvck5vZGUoYik7Y2FzZSA4OnJldHVybiBhLmYuWWMoYik7ZGVmYXVsdDpyZXR1cm4hMX19LGdldEJpbmRpbmdzOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5nZXRCaW5kaW5nc1N0cmluZyhiLGMpLGQ9ZD90aGlzLnBhcnNlQmluZGluZ3NTdHJpbmcoZCxjLGIpOm51bGw7cmV0dXJuIGEuZy5SYihkLGIsYywhMSl9LGdldEJpbmRpbmdBY2Nlc3NvcnM6ZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLmdldEJpbmRpbmdzU3RyaW5nKGIsXG5jKSxkPWQ/dGhpcy5wYXJzZUJpbmRpbmdzU3RyaW5nKGQsYyxiLHt2YWx1ZUFjY2Vzc29yczohMH0pOm51bGw7cmV0dXJuIGEuZy5SYihkLGIsYywhMCl9LGdldEJpbmRpbmdzU3RyaW5nOmZ1bmN0aW9uKGIpe3N3aXRjaChiLm5vZGVUeXBlKXtjYXNlIDE6cmV0dXJuIGIuZ2V0QXR0cmlidXRlKFwiZGF0YS1iaW5kXCIpO2Nhc2UgODpyZXR1cm4gYS5mLnZkKGIpO2RlZmF1bHQ6cmV0dXJuIG51bGx9fSxwYXJzZUJpbmRpbmdzU3RyaW5nOmZ1bmN0aW9uKGIsYyxkLGUpe3RyeXt2YXIgZj10aGlzLktjLGc9YisoZSYmZS52YWx1ZUFjY2Vzc29yc3x8XCJcIiksaDtpZighKGg9ZltnXSkpe3ZhciBsLG09XCJ3aXRoKCRjb250ZXh0KXt3aXRoKCRkYXRhfHx7fSl7cmV0dXJue1wiK2EuaC5YYShiLGUpK1wifX19XCI7bD1uZXcgRnVuY3Rpb24oXCIkY29udGV4dFwiLFwiJGVsZW1lbnRcIixtKTtoPWZbZ109bH1yZXR1cm4gaChjLGQpfWNhdGNoKGspe3Rocm93IGsubWVzc2FnZT1cIlVuYWJsZSB0byBwYXJzZSBiaW5kaW5ncy5cXG5CaW5kaW5ncyB2YWx1ZTogXCIrXG5iK1wiXFxuTWVzc2FnZTogXCIray5tZXNzYWdlLGs7fX19KTthLlMuaW5zdGFuY2U9bmV3IGEuU30pKCk7YS5iKFwiYmluZGluZ1Byb3ZpZGVyXCIsYS5TKTsoZnVuY3Rpb24oKXtmdW5jdGlvbiBiKGEpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBhfX1mdW5jdGlvbiBjKGEpe3JldHVybiBhKCl9ZnVuY3Rpb24gZChiKXtyZXR1cm4gYS5hLkVhKGEubC53KGIpLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGIoKVtjXX19KX1mdW5jdGlvbiBlKGMsZSxrKXtyZXR1cm5cImZ1bmN0aW9uXCI9PT10eXBlb2YgYz9kKGMuYmluZChudWxsLGUsaykpOmEuYS5FYShjLGIpfWZ1bmN0aW9uIGYoYSxiKXtyZXR1cm4gZCh0aGlzLmdldEJpbmRpbmdzLmJpbmQodGhpcyxhLGIpKX1mdW5jdGlvbiBnKGIsYyxkKXt2YXIgZSxrPWEuZi5maXJzdENoaWxkKGMpLGY9YS5TLmluc3RhbmNlLG09Zi5wcmVwcm9jZXNzTm9kZTtpZihtKXtmb3IoO2U9azspaz1hLmYubmV4dFNpYmxpbmcoZSksXG5tLmNhbGwoZixlKTtrPWEuZi5maXJzdENoaWxkKGMpfWZvcig7ZT1rOylrPWEuZi5uZXh0U2libGluZyhlKSxoKGIsZSxkKX1mdW5jdGlvbiBoKGIsYyxkKXt2YXIgZT0hMCxrPTE9PT1jLm5vZGVUeXBlO2smJmEuZi5vYyhjKTtpZihrJiZkfHxhLlMuaW5zdGFuY2Uubm9kZUhhc0JpbmRpbmdzKGMpKWU9bShjLG51bGwsYixkKS5zaG91bGRCaW5kRGVzY2VuZGFudHM7ZSYmIXJbYS5hLkEoYyldJiZnKGIsYywhayl9ZnVuY3Rpb24gbChiKXt2YXIgYz1bXSxkPXt9LGU9W107YS5hLkQoYixmdW5jdGlvbiBYKGspe2lmKCFkW2tdKXt2YXIgZj1hLmdldEJpbmRpbmdIYW5kbGVyKGspO2YmJihmLmFmdGVyJiYoZS5wdXNoKGspLGEuYS5yKGYuYWZ0ZXIsZnVuY3Rpb24oYyl7aWYoYltjXSl7aWYoLTEhPT1hLmEubyhlLGMpKXRocm93IEVycm9yKFwiQ2Fubm90IGNvbWJpbmUgdGhlIGZvbGxvd2luZyBiaW5kaW5ncywgYmVjYXVzZSB0aGV5IGhhdmUgYSBjeWNsaWMgZGVwZW5kZW5jeTogXCIrZS5qb2luKFwiLCBcIikpO1xuWChjKX19KSxlLmxlbmd0aC0tKSxjLnB1c2goe2tleTprLGpjOmZ9KSk7ZFtrXT0hMH19KTtyZXR1cm4gY31mdW5jdGlvbiBtKGIsZCxlLGspe3ZhciBtPWEuYS5lLmdldChiLHEpO2lmKCFkKXtpZihtKXRocm93IEVycm9yKFwiWW91IGNhbm5vdCBhcHBseSBiaW5kaW5ncyBtdWx0aXBsZSB0aW1lcyB0byB0aGUgc2FtZSBlbGVtZW50LlwiKTthLmEuZS5zZXQoYixxLCEwKX0hbSYmayYmYS54YyhiLGUpO3ZhciBnO2lmKGQmJlwiZnVuY3Rpb25cIiE9PXR5cGVvZiBkKWc9ZDtlbHNle3ZhciBoPWEuUy5pbnN0YW5jZSxyPWguZ2V0QmluZGluZ0FjY2Vzc29yc3x8ZixwPWEuQihmdW5jdGlvbigpeyhnPWQ/ZChlLGIpOnIuY2FsbChoLGIsZSkpJiZlLlEmJmUuUSgpO3JldHVybiBnfSxudWxsLHtpOmJ9KTtnJiZwLmNhKCl8fChwPW51bGwpfXZhciBzO2lmKGcpe3ZhciB0PXA/ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGMocCgpW2FdKX19OmZ1bmN0aW9uKGEpe3JldHVybiBnW2FdfSxcbnU9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hLkVhKHA/cCgpOmcsYyl9O3UuZ2V0PWZ1bmN0aW9uKGEpe3JldHVybiBnW2FdJiZjKHQoYSkpfTt1Lmhhcz1mdW5jdGlvbihhKXtyZXR1cm4gYSBpbiBnfTtrPWwoZyk7YS5hLnIoayxmdW5jdGlvbihjKXt2YXIgZD1jLmpjLmluaXQsaz1jLmpjLnVwZGF0ZSxmPWMua2V5O2lmKDg9PT1iLm5vZGVUeXBlJiYhYS5mLmFhW2ZdKXRocm93IEVycm9yKFwiVGhlIGJpbmRpbmcgJ1wiK2YrXCInIGNhbm5vdCBiZSB1c2VkIHdpdGggdmlydHVhbCBlbGVtZW50c1wiKTt0cnl7XCJmdW5jdGlvblwiPT10eXBlb2YgZCYmYS5sLncoZnVuY3Rpb24oKXt2YXIgYT1kKGIsdChmKSx1LGUuJGRhdGEsZSk7aWYoYSYmYS5jb250cm9sc0Rlc2NlbmRhbnRCaW5kaW5ncyl7aWYocyE9PW4pdGhyb3cgRXJyb3IoXCJNdWx0aXBsZSBiaW5kaW5ncyAoXCIrcytcIiBhbmQgXCIrZitcIikgYXJlIHRyeWluZyB0byBjb250cm9sIGRlc2NlbmRhbnQgYmluZGluZ3Mgb2YgdGhlIHNhbWUgZWxlbWVudC4gWW91IGNhbm5vdCB1c2UgdGhlc2UgYmluZGluZ3MgdG9nZXRoZXIgb24gdGhlIHNhbWUgZWxlbWVudC5cIik7XG5zPWZ9fSksXCJmdW5jdGlvblwiPT10eXBlb2YgayYmYS5CKGZ1bmN0aW9uKCl7ayhiLHQoZiksdSxlLiRkYXRhLGUpfSxudWxsLHtpOmJ9KX1jYXRjaChtKXt0aHJvdyBtLm1lc3NhZ2U9J1VuYWJsZSB0byBwcm9jZXNzIGJpbmRpbmcgXCInK2YrXCI6IFwiK2dbZl0rJ1wiXFxuTWVzc2FnZTogJyttLm1lc3NhZ2UsbTt9fSl9cmV0dXJue3Nob3VsZEJpbmREZXNjZW5kYW50czpzPT09bn19ZnVuY3Rpb24gayhiKXtyZXR1cm4gYiYmYiBpbnN0YW5jZW9mIGEuUj9iOm5ldyBhLlIoYil9YS5kPXt9O3ZhciByPXtzY3JpcHQ6ITAsdGV4dGFyZWE6ITAsdGVtcGxhdGU6ITB9O2EuZ2V0QmluZGluZ0hhbmRsZXI9ZnVuY3Rpb24oYil7cmV0dXJuIGEuZFtiXX07YS5SPWZ1bmN0aW9uKGIsYyxkLGUsayl7ZnVuY3Rpb24gZigpe3ZhciBrPWc/YigpOmIsbT1hLmEuYyhrKTtjPyhjLlEmJmMuUSgpLGEuYS5leHRlbmQobCxjKSxsLlE9cik6KGwuJHBhcmVudHM9W10sbC4kcm9vdD1tLGwua289YSk7bC4kcmF3RGF0YT1cbms7bC4kZGF0YT1tO2QmJihsW2RdPW0pO2UmJmUobCxjLG0pO3JldHVybiBsLiRkYXRhfWZ1bmN0aW9uIG0oKXtyZXR1cm4gaCYmIWEuYS5UYihoKX12YXIgbD10aGlzLGc9XCJmdW5jdGlvblwiPT10eXBlb2YgYiYmIWEuSShiKSxoLHI7ayYmay5leHBvcnREZXBlbmRlbmNpZXM/ZigpOihyPWEuQihmLG51bGwse3lhOm0saTohMH0pLHIuY2EoKSYmKGwuUT1yLHIuZXF1YWxpdHlDb21wYXJlcj1udWxsLGg9W10sci5EYz1mdW5jdGlvbihiKXtoLnB1c2goYik7YS5hLkcucWEoYixmdW5jdGlvbihiKXthLmEuTmEoaCxiKTtoLmxlbmd0aHx8KHIuaygpLGwuUT1yPW4pfSl9KSl9O2EuUi5wcm90b3R5cGUuY3JlYXRlQ2hpbGRDb250ZXh0PWZ1bmN0aW9uKGIsYyxkLGUpe3JldHVybiBuZXcgYS5SKGIsdGhpcyxjLGZ1bmN0aW9uKGEsYil7YS4kcGFyZW50Q29udGV4dD1iO2EuJHBhcmVudD1iLiRkYXRhO2EuJHBhcmVudHM9KGIuJHBhcmVudHN8fFtdKS5zbGljZSgwKTthLiRwYXJlbnRzLnVuc2hpZnQoYS4kcGFyZW50KTtcbmQmJmQoYSl9LGUpfTthLlIucHJvdG90eXBlLmV4dGVuZD1mdW5jdGlvbihiKXtyZXR1cm4gbmV3IGEuUih0aGlzLlF8fHRoaXMuJGRhdGEsdGhpcyxudWxsLGZ1bmN0aW9uKGMsZCl7Yy4kcmF3RGF0YT1kLiRyYXdEYXRhO2EuYS5leHRlbmQoYyxcImZ1bmN0aW9uXCI9PXR5cGVvZiBiP2IoKTpiKX0pfTthLlIucHJvdG90eXBlLmFjPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuY3JlYXRlQ2hpbGRDb250ZXh0KGEsYixudWxsLHtleHBvcnREZXBlbmRlbmNpZXM6ITB9KX07dmFyIHE9YS5hLmUuSigpLHA9YS5hLmUuSigpO2EueGM9ZnVuY3Rpb24oYixjKXtpZigyPT1hcmd1bWVudHMubGVuZ3RoKWEuYS5lLnNldChiLHAsYyksYy5RJiZjLlEuRGMoYik7ZWxzZSByZXR1cm4gYS5hLmUuZ2V0KGIscCl9O2EuTGE9ZnVuY3Rpb24oYixjLGQpezE9PT1iLm5vZGVUeXBlJiZhLmYub2MoYik7cmV0dXJuIG0oYixjLGsoZCksITApfTthLkljPWZ1bmN0aW9uKGIsYyxkKXtkPWsoZCk7cmV0dXJuIGEuTGEoYixcbmUoYyxkLGIpLGQpfTthLmhiPWZ1bmN0aW9uKGEsYil7MSE9PWIubm9kZVR5cGUmJjghPT1iLm5vZGVUeXBlfHxnKGsoYSksYiwhMCl9O2EuVWI9ZnVuY3Rpb24oYSxiKXshdSYmeC5qUXVlcnkmJih1PXgualF1ZXJ5KTtpZihiJiYxIT09Yi5ub2RlVHlwZSYmOCE9PWIubm9kZVR5cGUpdGhyb3cgRXJyb3IoXCJrby5hcHBseUJpbmRpbmdzOiBmaXJzdCBwYXJhbWV0ZXIgc2hvdWxkIGJlIHlvdXIgdmlldyBtb2RlbDsgc2Vjb25kIHBhcmFtZXRlciBzaG91bGQgYmUgYSBET00gbm9kZVwiKTtiPWJ8fHguZG9jdW1lbnQuYm9keTtoKGsoYSksYiwhMCl9O2EubmI9ZnVuY3Rpb24oYil7c3dpdGNoKGIubm9kZVR5cGUpe2Nhc2UgMTpjYXNlIDg6dmFyIGM9YS54YyhiKTtpZihjKXJldHVybiBjO2lmKGIucGFyZW50Tm9kZSlyZXR1cm4gYS5uYihiLnBhcmVudE5vZGUpfXJldHVybiBufTthLk9jPWZ1bmN0aW9uKGIpe3JldHVybihiPWEubmIoYikpP2IuJGRhdGE6bn07YS5iKFwiYmluZGluZ0hhbmRsZXJzXCIsXG5hLmQpO2EuYihcImFwcGx5QmluZGluZ3NcIixhLlViKTthLmIoXCJhcHBseUJpbmRpbmdzVG9EZXNjZW5kYW50c1wiLGEuaGIpO2EuYihcImFwcGx5QmluZGluZ0FjY2Vzc29yc1RvTm9kZVwiLGEuTGEpO2EuYihcImFwcGx5QmluZGluZ3NUb05vZGVcIixhLkljKTthLmIoXCJjb250ZXh0Rm9yXCIsYS5uYik7YS5iKFwiZGF0YUZvclwiLGEuT2MpfSkoKTsoZnVuY3Rpb24oYil7ZnVuY3Rpb24gYyhjLGUpe3ZhciBtPWYuaGFzT3duUHJvcGVydHkoYyk/ZltjXTpiLGs7bT9tLlkoZSk6KG09ZltjXT1uZXcgYS5LLG0uWShlKSxkKGMsZnVuY3Rpb24oYixkKXt2YXIgZT0hKCFkfHwhZC5zeW5jaHJvbm91cyk7Z1tjXT17ZGVmaW5pdGlvbjpiLGRkOmV9O2RlbGV0ZSBmW2NdO2t8fGU/bS5ub3RpZnlTdWJzY3JpYmVycyhiKTphLlouWmEoZnVuY3Rpb24oKXttLm5vdGlmeVN1YnNjcmliZXJzKGIpfSl9KSxrPSEwKX1mdW5jdGlvbiBkKGEsYil7ZShcImdldENvbmZpZ1wiLFthXSxmdW5jdGlvbihjKXtjP2UoXCJsb2FkQ29tcG9uZW50XCIsXG5bYSxjXSxmdW5jdGlvbihhKXtiKGEsYyl9KTpiKG51bGwsbnVsbCl9KX1mdW5jdGlvbiBlKGMsZCxmLGspe2t8fChrPWEuZy5sb2FkZXJzLnNsaWNlKDApKTt2YXIgZz1rLnNoaWZ0KCk7aWYoZyl7dmFyIHE9Z1tjXTtpZihxKXt2YXIgcD0hMTtpZihxLmFwcGx5KGcsZC5jb25jYXQoZnVuY3Rpb24oYSl7cD9mKG51bGwpOm51bGwhPT1hP2YoYSk6ZShjLGQsZixrKX0pKSE9PWImJihwPSEwLCFnLnN1cHByZXNzTG9hZGVyRXhjZXB0aW9ucykpdGhyb3cgRXJyb3IoXCJDb21wb25lbnQgbG9hZGVycyBtdXN0IHN1cHBseSB2YWx1ZXMgYnkgaW52b2tpbmcgdGhlIGNhbGxiYWNrLCBub3QgYnkgcmV0dXJuaW5nIHZhbHVlcyBzeW5jaHJvbm91c2x5LlwiKTt9ZWxzZSBlKGMsZCxmLGspfWVsc2UgZihudWxsKX12YXIgZj17fSxnPXt9O2EuZz17Z2V0OmZ1bmN0aW9uKGQsZSl7dmFyIGY9Zy5oYXNPd25Qcm9wZXJ0eShkKT9nW2RdOmI7Zj9mLmRkP2EubC53KGZ1bmN0aW9uKCl7ZShmLmRlZmluaXRpb24pfSk6XG5hLlouWmEoZnVuY3Rpb24oKXtlKGYuZGVmaW5pdGlvbil9KTpjKGQsZSl9LCRiOmZ1bmN0aW9uKGEpe2RlbGV0ZSBnW2FdfSxOYjplfTthLmcubG9hZGVycz1bXTthLmIoXCJjb21wb25lbnRzXCIsYS5nKTthLmIoXCJjb21wb25lbnRzLmdldFwiLGEuZy5nZXQpO2EuYihcImNvbXBvbmVudHMuY2xlYXJDYWNoZWREZWZpbml0aW9uXCIsYS5nLiRiKX0pKCk7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiLGMsZCxlKXtmdW5jdGlvbiBnKCl7MD09PS0teSYmZShoKX12YXIgaD17fSx5PTIsdj1kLnRlbXBsYXRlO2Q9ZC52aWV3TW9kZWw7dj9mKGMsdixmdW5jdGlvbihjKXthLmcuTmIoXCJsb2FkVGVtcGxhdGVcIixbYixjXSxmdW5jdGlvbihhKXtoLnRlbXBsYXRlPWE7ZygpfSl9KTpnKCk7ZD9mKGMsZCxmdW5jdGlvbihjKXthLmcuTmIoXCJsb2FkVmlld01vZGVsXCIsW2IsY10sZnVuY3Rpb24oYSl7aFtsXT1hO2coKX0pfSk6ZygpfWZ1bmN0aW9uIGMoYSxiLGQpe2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBiKWQoZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBiKGEpfSk7XG5lbHNlIGlmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBiW2xdKWQoYltsXSk7ZWxzZSBpZihcImluc3RhbmNlXCJpbiBiKXt2YXIgZT1iLmluc3RhbmNlO2QoZnVuY3Rpb24oKXtyZXR1cm4gZX0pfWVsc2VcInZpZXdNb2RlbFwiaW4gYj9jKGEsYi52aWV3TW9kZWwsZCk6YShcIlVua25vd24gdmlld01vZGVsIHZhbHVlOiBcIitiKX1mdW5jdGlvbiBkKGIpe3N3aXRjaChhLmEuQShiKSl7Y2FzZSBcInNjcmlwdFwiOnJldHVybiBhLmEubmEoYi50ZXh0KTtjYXNlIFwidGV4dGFyZWFcIjpyZXR1cm4gYS5hLm5hKGIudmFsdWUpO2Nhc2UgXCJ0ZW1wbGF0ZVwiOmlmKGUoYi5jb250ZW50KSlyZXR1cm4gYS5hLndhKGIuY29udGVudC5jaGlsZE5vZGVzKX1yZXR1cm4gYS5hLndhKGIuY2hpbGROb2Rlcyl9ZnVuY3Rpb24gZShhKXtyZXR1cm4geC5Eb2N1bWVudEZyYWdtZW50P2EgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50OmEmJjExPT09YS5ub2RlVHlwZX1mdW5jdGlvbiBmKGEsYixjKXtcInN0cmluZ1wiPT09dHlwZW9mIGIucmVxdWlyZT9cbk98fHgucmVxdWlyZT8oT3x8eC5yZXF1aXJlKShbYi5yZXF1aXJlXSxjKTphKFwiVXNlcyByZXF1aXJlLCBidXQgbm8gQU1EIGxvYWRlciBpcyBwcmVzZW50XCIpOmMoYil9ZnVuY3Rpb24gZyhhKXtyZXR1cm4gZnVuY3Rpb24oYil7dGhyb3cgRXJyb3IoXCJDb21wb25lbnQgJ1wiK2ErXCInOiBcIitiKTt9fXZhciBoPXt9O2EuZy5yZWdpc3Rlcj1mdW5jdGlvbihiLGMpe2lmKCFjKXRocm93IEVycm9yKFwiSW52YWxpZCBjb25maWd1cmF0aW9uIGZvciBcIitiKTtpZihhLmcud2IoYikpdGhyb3cgRXJyb3IoXCJDb21wb25lbnQgXCIrYitcIiBpcyBhbHJlYWR5IHJlZ2lzdGVyZWRcIik7aFtiXT1jfTthLmcud2I9ZnVuY3Rpb24oYSl7cmV0dXJuIGguaGFzT3duUHJvcGVydHkoYSl9O2EuZy51ZD1mdW5jdGlvbihiKXtkZWxldGUgaFtiXTthLmcuJGIoYil9O2EuZy5jYz17Z2V0Q29uZmlnOmZ1bmN0aW9uKGEsYil7YihoLmhhc093blByb3BlcnR5KGEpP2hbYV06bnVsbCl9LGxvYWRDb21wb25lbnQ6ZnVuY3Rpb24oYSxcbmMsZCl7dmFyIGU9ZyhhKTtmKGUsYyxmdW5jdGlvbihjKXtiKGEsZSxjLGQpfSl9LGxvYWRUZW1wbGF0ZTpmdW5jdGlvbihiLGMsZil7Yj1nKGIpO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYylmKGEuYS5uYShjKSk7ZWxzZSBpZihjIGluc3RhbmNlb2YgQXJyYXkpZihjKTtlbHNlIGlmKGUoYykpZihhLmEuVyhjLmNoaWxkTm9kZXMpKTtlbHNlIGlmKGMuZWxlbWVudClpZihjPWMuZWxlbWVudCx4LkhUTUxFbGVtZW50P2MgaW5zdGFuY2VvZiBIVE1MRWxlbWVudDpjJiZjLnRhZ05hbWUmJjE9PT1jLm5vZGVUeXBlKWYoZChjKSk7ZWxzZSBpZihcInN0cmluZ1wiPT09dHlwZW9mIGMpe3ZhciBsPXQuZ2V0RWxlbWVudEJ5SWQoYyk7bD9mKGQobCkpOmIoXCJDYW5ub3QgZmluZCBlbGVtZW50IHdpdGggSUQgXCIrYyl9ZWxzZSBiKFwiVW5rbm93biBlbGVtZW50IHR5cGU6IFwiK2MpO2Vsc2UgYihcIlVua25vd24gdGVtcGxhdGUgdmFsdWU6IFwiK2MpfSxsb2FkVmlld01vZGVsOmZ1bmN0aW9uKGEsYixkKXtjKGcoYSksXG5iLGQpfX07dmFyIGw9XCJjcmVhdGVWaWV3TW9kZWxcIjthLmIoXCJjb21wb25lbnRzLnJlZ2lzdGVyXCIsYS5nLnJlZ2lzdGVyKTthLmIoXCJjb21wb25lbnRzLmlzUmVnaXN0ZXJlZFwiLGEuZy53Yik7YS5iKFwiY29tcG9uZW50cy51bnJlZ2lzdGVyXCIsYS5nLnVkKTthLmIoXCJjb21wb25lbnRzLmRlZmF1bHRMb2FkZXJcIixhLmcuY2MpO2EuZy5sb2FkZXJzLnB1c2goYS5nLmNjKTthLmcuRWM9aH0pKCk7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiLGUpe3ZhciBmPWIuZ2V0QXR0cmlidXRlKFwicGFyYW1zXCIpO2lmKGYpe3ZhciBmPWMucGFyc2VCaW5kaW5nc1N0cmluZyhmLGUsYix7dmFsdWVBY2Nlc3NvcnM6ITAsYmluZGluZ1BhcmFtczohMH0pLGY9YS5hLkVhKGYsZnVuY3Rpb24oYyl7cmV0dXJuIGEubShjLG51bGwse2k6Yn0pfSksZz1hLmEuRWEoZixmdW5jdGlvbihjKXt2YXIgZT1jLnAoKTtyZXR1cm4gYy5jYSgpP2EubSh7cmVhZDpmdW5jdGlvbigpe3JldHVybiBhLmEuYyhjKCkpfSx3cml0ZTphLkRhKGUpJiZcbmZ1bmN0aW9uKGEpe2MoKShhKX0saTpifSk6ZX0pO2cuaGFzT3duUHJvcGVydHkoXCIkcmF3XCIpfHwoZy4kcmF3PWYpO3JldHVybiBnfXJldHVybnskcmF3Ont9fX1hLmcuZ2V0Q29tcG9uZW50TmFtZUZvck5vZGU9ZnVuY3Rpb24oYil7dmFyIGM9YS5hLkEoYik7aWYoYS5nLndiKGMpJiYoLTEhPWMuaW5kZXhPZihcIi1cIil8fFwiW29iamVjdCBIVE1MVW5rbm93bkVsZW1lbnRdXCI9PVwiXCIrYnx8OD49YS5hLkMmJmIudGFnTmFtZT09PWMpKXJldHVybiBjfTthLmcuUmI9ZnVuY3Rpb24oYyxlLGYsZyl7aWYoMT09PWUubm9kZVR5cGUpe3ZhciBoPWEuZy5nZXRDb21wb25lbnROYW1lRm9yTm9kZShlKTtpZihoKXtjPWN8fHt9O2lmKGMuY29tcG9uZW50KXRocm93IEVycm9yKCdDYW5ub3QgdXNlIHRoZSBcImNvbXBvbmVudFwiIGJpbmRpbmcgb24gYSBjdXN0b20gZWxlbWVudCBtYXRjaGluZyBhIGNvbXBvbmVudCcpO3ZhciBsPXtuYW1lOmgscGFyYW1zOmIoZSxmKX07Yy5jb21wb25lbnQ9Zz9mdW5jdGlvbigpe3JldHVybiBsfTpcbmx9fXJldHVybiBjfTt2YXIgYz1uZXcgYS5TOzk+YS5hLkMmJihhLmcucmVnaXN0ZXI9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3QuY3JlYXRlRWxlbWVudChiKTtyZXR1cm4gYS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShhLmcucmVnaXN0ZXIpLHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudD1mdW5jdGlvbihiKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYz1iKCksZj1hLmcuRWMsZztmb3IoZyBpbiBmKWYuaGFzT3duUHJvcGVydHkoZykmJmMuY3JlYXRlRWxlbWVudChnKTtyZXR1cm4gY319KHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCkpfSkoKTsoZnVuY3Rpb24oYil7ZnVuY3Rpb24gYyhiLGMsZCl7Yz1jLnRlbXBsYXRlO2lmKCFjKXRocm93IEVycm9yKFwiQ29tcG9uZW50ICdcIitiK1wiJyBoYXMgbm8gdGVtcGxhdGVcIik7Yj1hLmEud2EoYyk7YS5mLmZhKGQsYil9ZnVuY3Rpb24gZChhLGIsYyxkKXt2YXIgZT1hLmNyZWF0ZVZpZXdNb2RlbDtyZXR1cm4gZT9lLmNhbGwoYSxcbmQse2VsZW1lbnQ6Yix0ZW1wbGF0ZU5vZGVzOmN9KTpkfXZhciBlPTA7YS5kLmNvbXBvbmVudD17aW5pdDpmdW5jdGlvbihmLGcsaCxsLG0pe2Z1bmN0aW9uIGsoKXt2YXIgYT1yJiZyLmRpc3Bvc2U7XCJmdW5jdGlvblwiPT09dHlwZW9mIGEmJmEuY2FsbChyKTtxPXI9bnVsbH12YXIgcixxLHA9YS5hLlcoYS5mLmNoaWxkTm9kZXMoZikpO2EuYS5HLnFhKGYsayk7YS5tKGZ1bmN0aW9uKCl7dmFyIGw9YS5hLmMoZygpKSxoLHY7XCJzdHJpbmdcIj09PXR5cGVvZiBsP2g9bDooaD1hLmEuYyhsLm5hbWUpLHY9YS5hLmMobC5wYXJhbXMpKTtpZighaCl0aHJvdyBFcnJvcihcIk5vIGNvbXBvbmVudCBuYW1lIHNwZWNpZmllZFwiKTt2YXIgbj1xPSsrZTthLmcuZ2V0KGgsZnVuY3Rpb24oZSl7aWYocT09PW4pe2soKTtpZighZSl0aHJvdyBFcnJvcihcIlVua25vd24gY29tcG9uZW50ICdcIitoK1wiJ1wiKTtjKGgsZSxmKTt2YXIgbD1kKGUsZixwLHYpO2U9bS5jcmVhdGVDaGlsZENvbnRleHQobCxiLGZ1bmN0aW9uKGEpe2EuJGNvbXBvbmVudD1cbmw7YS4kY29tcG9uZW50VGVtcGxhdGVOb2Rlcz1wfSk7cj1sO2EuaGIoZSxmKX19KX0sbnVsbCx7aTpmfSk7cmV0dXJue2NvbnRyb2xzRGVzY2VuZGFudEJpbmRpbmdzOiEwfX19O2EuZi5hYS5jb21wb25lbnQ9ITB9KSgpO3ZhciBRPXtcImNsYXNzXCI6XCJjbGFzc05hbWVcIixcImZvclwiOlwiaHRtbEZvclwifTthLmQuYXR0cj17dXBkYXRlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5hLmMoYygpKXx8e307YS5hLkQoZCxmdW5jdGlvbihjLGQpe2Q9YS5hLmMoZCk7dmFyIGc9ITE9PT1kfHxudWxsPT09ZHx8ZD09PW47ZyYmYi5yZW1vdmVBdHRyaWJ1dGUoYyk7OD49YS5hLkMmJmMgaW4gUT8oYz1RW2NdLGc/Yi5yZW1vdmVBdHRyaWJ1dGUoYyk6YltjXT1kKTpnfHxiLnNldEF0dHJpYnV0ZShjLGQudG9TdHJpbmcoKSk7XCJuYW1lXCI9PT1jJiZhLmEudmMoYixnP1wiXCI6ZC50b1N0cmluZygpKX0pfX07KGZ1bmN0aW9uKCl7YS5kLmNoZWNrZWQ9e2FmdGVyOltcInZhbHVlXCIsXCJhdHRyXCJdLGluaXQ6ZnVuY3Rpb24oYixcbmMsZCl7ZnVuY3Rpb24gZSgpe3ZhciBlPWIuY2hlY2tlZCxmPXA/ZygpOmU7aWYoIWEueGEuVmEoKSYmKCFsfHxlKSl7dmFyIGg9YS5sLncoYyk7aWYoayl7dmFyIG09cj9oLnAoKTpoO3EhPT1mPyhlJiYoYS5hLnJhKG0sZiwhMCksYS5hLnJhKG0scSwhMSkpLHE9Zik6YS5hLnJhKG0sZixlKTtyJiZhLkRhKGgpJiZoKG0pfWVsc2UgYS5oLkdhKGgsZCxcImNoZWNrZWRcIixmLCEwKX19ZnVuY3Rpb24gZigpe3ZhciBkPWEuYS5jKGMoKSk7Yi5jaGVja2VkPWs/MDw9YS5hLm8oZCxnKCkpOmg/ZDpnKCk9PT1kfXZhciBnPWEucmMoZnVuY3Rpb24oKXtyZXR1cm4gZC5oYXMoXCJjaGVja2VkVmFsdWVcIik/YS5hLmMoZC5nZXQoXCJjaGVja2VkVmFsdWVcIikpOmQuaGFzKFwidmFsdWVcIik/YS5hLmMoZC5nZXQoXCJ2YWx1ZVwiKSk6Yi52YWx1ZX0pLGg9XCJjaGVja2JveFwiPT1iLnR5cGUsbD1cInJhZGlvXCI9PWIudHlwZTtpZihofHxsKXt2YXIgbT1jKCksaz1oJiZhLmEuYyhtKWluc3RhbmNlb2YgQXJyYXksXG5yPSEoayYmbS5wdXNoJiZtLnNwbGljZSkscT1rP2coKTpuLHA9bHx8aztsJiYhYi5uYW1lJiZhLmQudW5pcXVlTmFtZS5pbml0KGIsZnVuY3Rpb24oKXtyZXR1cm4hMH0pO2EubShlLG51bGwse2k6Yn0pO2EuYS5xKGIsXCJjbGlja1wiLGUpO2EubShmLG51bGwse2k6Yn0pO209bn19fTthLmguZ2EuY2hlY2tlZD0hMDthLmQuY2hlY2tlZFZhbHVlPXt1cGRhdGU6ZnVuY3Rpb24oYixjKXtiLnZhbHVlPWEuYS5jKGMoKSl9fX0pKCk7YS5kLmNzcz17dXBkYXRlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5hLmMoYygpKTtudWxsIT09ZCYmXCJvYmplY3RcIj09dHlwZW9mIGQ/YS5hLkQoZCxmdW5jdGlvbihjLGQpe2Q9YS5hLmMoZCk7YS5hLmZiKGIsYyxkKX0pOihkPWEuYS5jYihTdHJpbmcoZHx8XCJcIikpLGEuYS5mYihiLGIuX19rb19fY3NzVmFsdWUsITEpLGIuX19rb19fY3NzVmFsdWU9ZCxhLmEuZmIoYixkLCEwKSl9fTthLmQuZW5hYmxlPXt1cGRhdGU6ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmEuYyhjKCkpO1xuZCYmYi5kaXNhYmxlZD9iLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpOmR8fGIuZGlzYWJsZWR8fChiLmRpc2FibGVkPSEwKX19O2EuZC5kaXNhYmxlPXt1cGRhdGU6ZnVuY3Rpb24oYixjKXthLmQuZW5hYmxlLnVwZGF0ZShiLGZ1bmN0aW9uKCl7cmV0dXJuIWEuYS5jKGMoKSl9KX19O2EuZC5ldmVudD17aW5pdDpmdW5jdGlvbihiLGMsZCxlLGYpe3ZhciBnPWMoKXx8e307YS5hLkQoZyxmdW5jdGlvbihnKXtcInN0cmluZ1wiPT10eXBlb2YgZyYmYS5hLnEoYixnLGZ1bmN0aW9uKGIpe3ZhciBtLGs9YygpW2ddO2lmKGspe3RyeXt2YXIgcj1hLmEuVyhhcmd1bWVudHMpO2U9Zi4kZGF0YTtyLnVuc2hpZnQoZSk7bT1rLmFwcGx5KGUscil9ZmluYWxseXshMCE9PW0mJihiLnByZXZlbnREZWZhdWx0P2IucHJldmVudERlZmF1bHQoKTpiLnJldHVyblZhbHVlPSExKX0hMT09PWQuZ2V0KGcrXCJCdWJibGVcIikmJihiLmNhbmNlbEJ1YmJsZT0hMCxiLnN0b3BQcm9wYWdhdGlvbiYmYi5zdG9wUHJvcGFnYXRpb24oKSl9fSl9KX19O1xuYS5kLmZvcmVhY2g9e21jOmZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbigpe3ZhciBjPWIoKSxkPWEuYS5CYihjKTtpZighZHx8XCJudW1iZXJcIj09dHlwZW9mIGQubGVuZ3RoKXJldHVybntmb3JlYWNoOmMsdGVtcGxhdGVFbmdpbmU6YS5YLnZifTthLmEuYyhjKTtyZXR1cm57Zm9yZWFjaDpkLmRhdGEsYXM6ZC5hcyxpbmNsdWRlRGVzdHJveWVkOmQuaW5jbHVkZURlc3Ryb3llZCxhZnRlckFkZDpkLmFmdGVyQWRkLGJlZm9yZVJlbW92ZTpkLmJlZm9yZVJlbW92ZSxhZnRlclJlbmRlcjpkLmFmdGVyUmVuZGVyLGJlZm9yZU1vdmU6ZC5iZWZvcmVNb3ZlLGFmdGVyTW92ZTpkLmFmdGVyTW92ZSx0ZW1wbGF0ZUVuZ2luZTphLlgudmJ9fX0saW5pdDpmdW5jdGlvbihiLGMpe3JldHVybiBhLmQudGVtcGxhdGUuaW5pdChiLGEuZC5mb3JlYWNoLm1jKGMpKX0sdXBkYXRlOmZ1bmN0aW9uKGIsYyxkLGUsZil7cmV0dXJuIGEuZC50ZW1wbGF0ZS51cGRhdGUoYixhLmQuZm9yZWFjaC5tYyhjKSxcbmQsZSxmKX19O2EuaC52YS5mb3JlYWNoPSExO2EuZi5hYS5mb3JlYWNoPSEwO2EuZC5oYXNmb2N1cz17aW5pdDpmdW5jdGlvbihiLGMsZCl7ZnVuY3Rpb24gZShlKXtiLl9fa29faGFzZm9jdXNVcGRhdGluZz0hMDt2YXIgZj1iLm93bmVyRG9jdW1lbnQ7aWYoXCJhY3RpdmVFbGVtZW50XCJpbiBmKXt2YXIgZzt0cnl7Zz1mLmFjdGl2ZUVsZW1lbnR9Y2F0Y2goayl7Zz1mLmJvZHl9ZT1nPT09Yn1mPWMoKTthLmguR2EoZixkLFwiaGFzZm9jdXNcIixlLCEwKTtiLl9fa29faGFzZm9jdXNMYXN0VmFsdWU9ZTtiLl9fa29faGFzZm9jdXNVcGRhdGluZz0hMX12YXIgZj1lLmJpbmQobnVsbCwhMCksZz1lLmJpbmQobnVsbCwhMSk7YS5hLnEoYixcImZvY3VzXCIsZik7YS5hLnEoYixcImZvY3VzaW5cIixmKTthLmEucShiLFwiYmx1clwiLGcpO2EuYS5xKGIsXCJmb2N1c291dFwiLGcpfSx1cGRhdGU6ZnVuY3Rpb24oYixjKXt2YXIgZD0hIWEuYS5jKGMoKSk7Yi5fX2tvX2hhc2ZvY3VzVXBkYXRpbmd8fGIuX19rb19oYXNmb2N1c0xhc3RWYWx1ZT09PVxuZHx8KGQ/Yi5mb2N1cygpOmIuYmx1cigpLCFkJiZiLl9fa29faGFzZm9jdXNMYXN0VmFsdWUmJmIub3duZXJEb2N1bWVudC5ib2R5LmZvY3VzKCksYS5sLncoYS5hLkZhLG51bGwsW2IsZD9cImZvY3VzaW5cIjpcImZvY3Vzb3V0XCJdKSl9fTthLmguZ2EuaGFzZm9jdXM9ITA7YS5kLmhhc0ZvY3VzPWEuZC5oYXNmb2N1czthLmguZ2EuaGFzRm9jdXM9ITA7YS5kLmh0bWw9e2luaXQ6ZnVuY3Rpb24oKXtyZXR1cm57Y29udHJvbHNEZXNjZW5kYW50QmluZGluZ3M6ITB9fSx1cGRhdGU6ZnVuY3Rpb24oYixjKXthLmEuRWIoYixjKCkpfX07SyhcImlmXCIpO0soXCJpZm5vdFwiLCExLCEwKTtLKFwid2l0aFwiLCEwLCExLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGEuYWMoYyl9KTt2YXIgTD17fTthLmQub3B0aW9ucz17aW5pdDpmdW5jdGlvbihiKXtpZihcInNlbGVjdFwiIT09YS5hLkEoYikpdGhyb3cgRXJyb3IoXCJvcHRpb25zIGJpbmRpbmcgYXBwbGllcyBvbmx5IHRvIFNFTEVDVCBlbGVtZW50c1wiKTtmb3IoOzA8XG5iLmxlbmd0aDspYi5yZW1vdmUoMCk7cmV0dXJue2NvbnRyb2xzRGVzY2VuZGFudEJpbmRpbmdzOiEwfX0sdXBkYXRlOmZ1bmN0aW9uKGIsYyxkKXtmdW5jdGlvbiBlKCl7cmV0dXJuIGEuYS5NYShiLm9wdGlvbnMsZnVuY3Rpb24oYSl7cmV0dXJuIGEuc2VsZWN0ZWR9KX1mdW5jdGlvbiBmKGEsYixjKXt2YXIgZD10eXBlb2YgYjtyZXR1cm5cImZ1bmN0aW9uXCI9PWQ/YihhKTpcInN0cmluZ1wiPT1kP2FbYl06Y31mdW5jdGlvbiBnKGMsZSl7aWYoQSYmaylhLmouamEoYixhLmEuYyhkLmdldChcInZhbHVlXCIpKSwhMCk7ZWxzZSBpZihwLmxlbmd0aCl7dmFyIGY9MDw9YS5hLm8ocCxhLmoudShlWzBdKSk7YS5hLndjKGVbMF0sZik7QSYmIWYmJmEubC53KGEuYS5GYSxudWxsLFtiLFwiY2hhbmdlXCJdKX19dmFyIGg9Yi5tdWx0aXBsZSxsPTAhPWIubGVuZ3RoJiZoP2Iuc2Nyb2xsVG9wOm51bGwsbT1hLmEuYyhjKCkpLGs9ZC5nZXQoXCJ2YWx1ZUFsbG93VW5zZXRcIikmJmQuaGFzKFwidmFsdWVcIikscj1cbmQuZ2V0KFwib3B0aW9uc0luY2x1ZGVEZXN0cm95ZWRcIik7Yz17fTt2YXIgcSxwPVtdO2t8fChoP3A9YS5hLmliKGUoKSxhLmoudSk6MDw9Yi5zZWxlY3RlZEluZGV4JiZwLnB1c2goYS5qLnUoYi5vcHRpb25zW2Iuc2VsZWN0ZWRJbmRleF0pKSk7bSYmKFwidW5kZWZpbmVkXCI9PXR5cGVvZiBtLmxlbmd0aCYmKG09W21dKSxxPWEuYS5NYShtLGZ1bmN0aW9uKGIpe3JldHVybiByfHxiPT09bnx8bnVsbD09PWJ8fCFhLmEuYyhiLl9kZXN0cm95KX0pLGQuaGFzKFwib3B0aW9uc0NhcHRpb25cIikmJihtPWEuYS5jKGQuZ2V0KFwib3B0aW9uc0NhcHRpb25cIikpLG51bGwhPT1tJiZtIT09biYmcS51bnNoaWZ0KEwpKSk7dmFyIEE9ITE7Yy5iZWZvcmVSZW1vdmU9ZnVuY3Rpb24oYSl7Yi5yZW1vdmVDaGlsZChhKX07bT1nO2QuaGFzKFwib3B0aW9uc0FmdGVyUmVuZGVyXCIpJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBkLmdldChcIm9wdGlvbnNBZnRlclJlbmRlclwiKSYmKG09ZnVuY3Rpb24oYixjKXtnKDAsYyk7XG5hLmwudyhkLmdldChcIm9wdGlvbnNBZnRlclJlbmRlclwiKSxudWxsLFtjWzBdLGIhPT1MP2I6bl0pfSk7YS5hLkRiKGIscSxmdW5jdGlvbihjLGUsZyl7Zy5sZW5ndGgmJihwPSFrJiZnWzBdLnNlbGVjdGVkP1thLmoudShnWzBdKV06W10sQT0hMCk7ZT1iLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtjPT09TD8oYS5hLmJiKGUsZC5nZXQoXCJvcHRpb25zQ2FwdGlvblwiKSksYS5qLmphKGUsbikpOihnPWYoYyxkLmdldChcIm9wdGlvbnNWYWx1ZVwiKSxjKSxhLmouamEoZSxhLmEuYyhnKSksYz1mKGMsZC5nZXQoXCJvcHRpb25zVGV4dFwiKSxnKSxhLmEuYmIoZSxjKSk7cmV0dXJuW2VdfSxjLG0pO2EubC53KGZ1bmN0aW9uKCl7az9hLmouamEoYixhLmEuYyhkLmdldChcInZhbHVlXCIpKSwhMCk6KGg/cC5sZW5ndGgmJmUoKS5sZW5ndGg8cC5sZW5ndGg6cC5sZW5ndGgmJjA8PWIuc2VsZWN0ZWRJbmRleD9hLmoudShiLm9wdGlvbnNbYi5zZWxlY3RlZEluZGV4XSkhPT1wWzBdOlxucC5sZW5ndGh8fDA8PWIuc2VsZWN0ZWRJbmRleCkmJmEuYS5GYShiLFwiY2hhbmdlXCIpfSk7YS5hLlNjKGIpO2wmJjIwPE1hdGguYWJzKGwtYi5zY3JvbGxUb3ApJiYoYi5zY3JvbGxUb3A9bCl9fTthLmQub3B0aW9ucy56Yj1hLmEuZS5KKCk7YS5kLnNlbGVjdGVkT3B0aW9ucz17YWZ0ZXI6W1wib3B0aW9uc1wiLFwiZm9yZWFjaFwiXSxpbml0OmZ1bmN0aW9uKGIsYyxkKXthLmEucShiLFwiY2hhbmdlXCIsZnVuY3Rpb24oKXt2YXIgZT1jKCksZj1bXTthLmEucihiLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwib3B0aW9uXCIpLGZ1bmN0aW9uKGIpe2Iuc2VsZWN0ZWQmJmYucHVzaChhLmoudShiKSl9KTthLmguR2EoZSxkLFwic2VsZWN0ZWRPcHRpb25zXCIsZil9KX0sdXBkYXRlOmZ1bmN0aW9uKGIsYyl7aWYoXCJzZWxlY3RcIiE9YS5hLkEoYikpdGhyb3cgRXJyb3IoXCJ2YWx1ZXMgYmluZGluZyBhcHBsaWVzIG9ubHkgdG8gU0VMRUNUIGVsZW1lbnRzXCIpO3ZhciBkPWEuYS5jKGMoKSksZT1iLnNjcm9sbFRvcDtcbmQmJlwibnVtYmVyXCI9PXR5cGVvZiBkLmxlbmd0aCYmYS5hLnIoYi5nZXRFbGVtZW50c0J5VGFnTmFtZShcIm9wdGlvblwiKSxmdW5jdGlvbihiKXt2YXIgYz0wPD1hLmEubyhkLGEuai51KGIpKTtiLnNlbGVjdGVkIT1jJiZhLmEud2MoYixjKX0pO2Iuc2Nyb2xsVG9wPWV9fTthLmguZ2Euc2VsZWN0ZWRPcHRpb25zPSEwO2EuZC5zdHlsZT17dXBkYXRlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5hLmMoYygpfHx7fSk7YS5hLkQoZCxmdW5jdGlvbihjLGQpe2Q9YS5hLmMoZCk7aWYobnVsbD09PWR8fGQ9PT1ufHwhMT09PWQpZD1cIlwiO2Iuc3R5bGVbY109ZH0pfX07YS5kLnN1Ym1pdD17aW5pdDpmdW5jdGlvbihiLGMsZCxlLGYpe2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGMoKSl0aHJvdyBFcnJvcihcIlRoZSB2YWx1ZSBmb3IgYSBzdWJtaXQgYmluZGluZyBtdXN0IGJlIGEgZnVuY3Rpb25cIik7YS5hLnEoYixcInN1Ym1pdFwiLGZ1bmN0aW9uKGEpe3ZhciBkLGU9YygpO3RyeXtkPWUuY2FsbChmLiRkYXRhLFxuYil9ZmluYWxseXshMCE9PWQmJihhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExKX19KX19O2EuZC50ZXh0PXtpbml0OmZ1bmN0aW9uKCl7cmV0dXJue2NvbnRyb2xzRGVzY2VuZGFudEJpbmRpbmdzOiEwfX0sdXBkYXRlOmZ1bmN0aW9uKGIsYyl7YS5hLmJiKGIsYygpKX19O2EuZi5hYS50ZXh0PSEwOyhmdW5jdGlvbigpe2lmKHgmJngubmF2aWdhdG9yKXZhciBiPWZ1bmN0aW9uKGEpe2lmKGEpcmV0dXJuIHBhcnNlRmxvYXQoYVsxXSl9LGM9eC5vcGVyYSYmeC5vcGVyYS52ZXJzaW9uJiZwYXJzZUludCh4Lm9wZXJhLnZlcnNpb24oKSksZD14Lm5hdmlnYXRvci51c2VyQWdlbnQsZT1iKGQubWF0Y2goL14oPzooPyFjaHJvbWUpLikqdmVyc2lvblxcLyhbXiBdKikgc2FmYXJpL2kpKSxmPWIoZC5tYXRjaCgvRmlyZWZveFxcLyhbXiBdKikvKSk7aWYoMTA+YS5hLkMpdmFyIGc9YS5hLmUuSigpLGg9YS5hLmUuSigpLGw9ZnVuY3Rpb24oYil7dmFyIGM9XG50aGlzLmFjdGl2ZUVsZW1lbnQ7KGM9YyYmYS5hLmUuZ2V0KGMsaCkpJiZjKGIpfSxtPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yi5vd25lckRvY3VtZW50O2EuYS5lLmdldChkLGcpfHwoYS5hLmUuc2V0KGQsZywhMCksYS5hLnEoZCxcInNlbGVjdGlvbmNoYW5nZVwiLGwpKTthLmEuZS5zZXQoYixoLGMpfTthLmQudGV4dElucHV0PXtpbml0OmZ1bmN0aW9uKGIsZCxnKXtmdW5jdGlvbiBsKGMsZCl7YS5hLnEoYixjLGQpfWZ1bmN0aW9uIGgoKXt2YXIgYz1hLmEuYyhkKCkpO2lmKG51bGw9PT1jfHxjPT09biljPVwiXCI7dSE9PW4mJmM9PT11P2EuYS5zZXRUaW1lb3V0KGgsNCk6Yi52YWx1ZSE9PWMmJihzPWMsYi52YWx1ZT1jKX1mdW5jdGlvbiB5KCl7dHx8KHU9Yi52YWx1ZSx0PWEuYS5zZXRUaW1lb3V0KHYsNCkpfWZ1bmN0aW9uIHYoKXtjbGVhclRpbWVvdXQodCk7dT10PW47dmFyIGM9Yi52YWx1ZTtzIT09YyYmKHM9YyxhLmguR2EoZCgpLGcsXCJ0ZXh0SW5wdXRcIixjKSl9dmFyIHM9Yi52YWx1ZSxcbnQsdSx4PTk9PWEuYS5DP3k6djsxMD5hLmEuQz8obChcInByb3BlcnR5Y2hhbmdlXCIsZnVuY3Rpb24oYSl7XCJ2YWx1ZVwiPT09YS5wcm9wZXJ0eU5hbWUmJngoYSl9KSw4PT1hLmEuQyYmKGwoXCJrZXl1cFwiLHYpLGwoXCJrZXlkb3duXCIsdikpLDg8PWEuYS5DJiYobShiLHgpLGwoXCJkcmFnZW5kXCIseSkpKToobChcImlucHV0XCIsdiksNT5lJiZcInRleHRhcmVhXCI9PT1hLmEuQShiKT8obChcImtleWRvd25cIix5KSxsKFwicGFzdGVcIix5KSxsKFwiY3V0XCIseSkpOjExPmM/bChcImtleWRvd25cIix5KTo0PmYmJihsKFwiRE9NQXV0b0NvbXBsZXRlXCIsdiksbChcImRyYWdkcm9wXCIsdiksbChcImRyb3BcIix2KSkpO2woXCJjaGFuZ2VcIix2KTthLm0oaCxudWxsLHtpOmJ9KX19O2EuaC5nYS50ZXh0SW5wdXQ9ITA7YS5kLnRleHRpbnB1dD17cHJlcHJvY2VzczpmdW5jdGlvbihhLGIsYyl7YyhcInRleHRJbnB1dFwiLGEpfX19KSgpO2EuZC51bmlxdWVOYW1lPXtpbml0OmZ1bmN0aW9uKGIsYyl7aWYoYygpKXt2YXIgZD1cImtvX3VuaXF1ZV9cIitcbisrYS5kLnVuaXF1ZU5hbWUuTmM7YS5hLnZjKGIsZCl9fX07YS5kLnVuaXF1ZU5hbWUuTmM9MDthLmQudmFsdWU9e2FmdGVyOltcIm9wdGlvbnNcIixcImZvcmVhY2hcIl0saW5pdDpmdW5jdGlvbihiLGMsZCl7aWYoXCJpbnB1dFwiIT1iLnRhZ05hbWUudG9Mb3dlckNhc2UoKXx8XCJjaGVja2JveFwiIT1iLnR5cGUmJlwicmFkaW9cIiE9Yi50eXBlKXt2YXIgZT1bXCJjaGFuZ2VcIl0sZj1kLmdldChcInZhbHVlVXBkYXRlXCIpLGc9ITEsaD1udWxsO2YmJihcInN0cmluZ1wiPT10eXBlb2YgZiYmKGY9W2ZdKSxhLmEudGEoZSxmKSxlPWEuYS5XYihlKSk7dmFyIGw9ZnVuY3Rpb24oKXtoPW51bGw7Zz0hMTt2YXIgZT1jKCksZj1hLmoudShiKTthLmguR2EoZSxkLFwidmFsdWVcIixmKX07IWEuYS5DfHxcImlucHV0XCIhPWIudGFnTmFtZS50b0xvd2VyQ2FzZSgpfHxcInRleHRcIiE9Yi50eXBlfHxcIm9mZlwiPT1iLmF1dG9jb21wbGV0ZXx8Yi5mb3JtJiZcIm9mZlwiPT1iLmZvcm0uYXV0b2NvbXBsZXRlfHwtMSE9YS5hLm8oZSxcInByb3BlcnR5Y2hhbmdlXCIpfHxcbihhLmEucShiLFwicHJvcGVydHljaGFuZ2VcIixmdW5jdGlvbigpe2c9ITB9KSxhLmEucShiLFwiZm9jdXNcIixmdW5jdGlvbigpe2c9ITF9KSxhLmEucShiLFwiYmx1clwiLGZ1bmN0aW9uKCl7ZyYmbCgpfSkpO2EuYS5yKGUsZnVuY3Rpb24oYyl7dmFyIGQ9bDthLmEuc2QoYyxcImFmdGVyXCIpJiYoZD1mdW5jdGlvbigpe2g9YS5qLnUoYik7YS5hLnNldFRpbWVvdXQobCwwKX0sYz1jLnN1YnN0cmluZyg1KSk7YS5hLnEoYixjLGQpfSk7dmFyIG09ZnVuY3Rpb24oKXt2YXIgZT1hLmEuYyhjKCkpLGY9YS5qLnUoYik7aWYobnVsbCE9PWgmJmU9PT1oKWEuYS5zZXRUaW1lb3V0KG0sMCk7ZWxzZSBpZihlIT09ZilpZihcInNlbGVjdFwiPT09YS5hLkEoYikpe3ZhciBnPWQuZ2V0KFwidmFsdWVBbGxvd1Vuc2V0XCIpLGY9ZnVuY3Rpb24oKXthLmouamEoYixlLGcpfTtmKCk7Z3x8ZT09PWEuai51KGIpP2EuYS5zZXRUaW1lb3V0KGYsMCk6YS5sLncoYS5hLkZhLG51bGwsW2IsXCJjaGFuZ2VcIl0pfWVsc2UgYS5qLmphKGIsXG5lKX07YS5tKG0sbnVsbCx7aTpifSl9ZWxzZSBhLkxhKGIse2NoZWNrZWRWYWx1ZTpjfSl9LHVwZGF0ZTpmdW5jdGlvbigpe319O2EuaC5nYS52YWx1ZT0hMDthLmQudmlzaWJsZT17dXBkYXRlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5hLmMoYygpKSxlPVwibm9uZVwiIT1iLnN0eWxlLmRpc3BsYXk7ZCYmIWU/Yi5zdHlsZS5kaXNwbGF5PVwiXCI6IWQmJmUmJihiLnN0eWxlLmRpc3BsYXk9XCJub25lXCIpfX07KGZ1bmN0aW9uKGIpe2EuZFtiXT17aW5pdDpmdW5jdGlvbihjLGQsZSxmLGcpe3JldHVybiBhLmQuZXZlbnQuaW5pdC5jYWxsKHRoaXMsYyxmdW5jdGlvbigpe3ZhciBhPXt9O2FbYl09ZCgpO3JldHVybiBhfSxlLGYsZyl9fX0pKFwiY2xpY2tcIik7YS5QPWZ1bmN0aW9uKCl7fTthLlAucHJvdG90eXBlLnJlbmRlclRlbXBsYXRlU291cmNlPWZ1bmN0aW9uKCl7dGhyb3cgRXJyb3IoXCJPdmVycmlkZSByZW5kZXJUZW1wbGF0ZVNvdXJjZVwiKTt9O2EuUC5wcm90b3R5cGUuY3JlYXRlSmF2YVNjcmlwdEV2YWx1YXRvckJsb2NrPVxuZnVuY3Rpb24oKXt0aHJvdyBFcnJvcihcIk92ZXJyaWRlIGNyZWF0ZUphdmFTY3JpcHRFdmFsdWF0b3JCbG9ja1wiKTt9O2EuUC5wcm90b3R5cGUubWFrZVRlbXBsYXRlU291cmNlPWZ1bmN0aW9uKGIsYyl7aWYoXCJzdHJpbmdcIj09dHlwZW9mIGIpe2M9Y3x8dDt2YXIgZD1jLmdldEVsZW1lbnRCeUlkKGIpO2lmKCFkKXRocm93IEVycm9yKFwiQ2Fubm90IGZpbmQgdGVtcGxhdGUgd2l0aCBJRCBcIitiKTtyZXR1cm4gbmV3IGEudi5uKGQpfWlmKDE9PWIubm9kZVR5cGV8fDg9PWIubm9kZVR5cGUpcmV0dXJuIG5ldyBhLnYuc2EoYik7dGhyb3cgRXJyb3IoXCJVbmtub3duIHRlbXBsYXRlIHR5cGU6IFwiK2IpO307YS5QLnByb3RvdHlwZS5yZW5kZXJUZW1wbGF0ZT1mdW5jdGlvbihhLGMsZCxlKXthPXRoaXMubWFrZVRlbXBsYXRlU291cmNlKGEsZSk7cmV0dXJuIHRoaXMucmVuZGVyVGVtcGxhdGVTb3VyY2UoYSxjLGQsZSl9O2EuUC5wcm90b3R5cGUuaXNUZW1wbGF0ZVJld3JpdHRlbj1mdW5jdGlvbihhLFxuYyl7cmV0dXJuITE9PT10aGlzLmFsbG93VGVtcGxhdGVSZXdyaXRpbmc/ITA6dGhpcy5tYWtlVGVtcGxhdGVTb3VyY2UoYSxjKS5kYXRhKFwiaXNSZXdyaXR0ZW5cIil9O2EuUC5wcm90b3R5cGUucmV3cml0ZVRlbXBsYXRlPWZ1bmN0aW9uKGEsYyxkKXthPXRoaXMubWFrZVRlbXBsYXRlU291cmNlKGEsZCk7Yz1jKGEudGV4dCgpKTthLnRleHQoYyk7YS5kYXRhKFwiaXNSZXdyaXR0ZW5cIiwhMCl9O2EuYihcInRlbXBsYXRlRW5naW5lXCIsYS5QKTthLkliPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiLGMsZCxoKXtiPWEuaC5BYihiKTtmb3IodmFyIGw9YS5oLnZhLG09MDttPGIubGVuZ3RoO20rKyl7dmFyIGs9YlttXS5rZXk7aWYobC5oYXNPd25Qcm9wZXJ0eShrKSl7dmFyIHI9bFtrXTtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2Ygcil7aWYoaz1yKGJbbV0udmFsdWUpKXRocm93IEVycm9yKGspO31lbHNlIGlmKCFyKXRocm93IEVycm9yKFwiVGhpcyB0ZW1wbGF0ZSBlbmdpbmUgZG9lcyBub3Qgc3VwcG9ydCB0aGUgJ1wiK1xuaytcIicgYmluZGluZyB3aXRoaW4gaXRzIHRlbXBsYXRlc1wiKTt9fWQ9XCJrby5fX3RyX2FtYnRucyhmdW5jdGlvbigkY29udGV4dCwkZWxlbWVudCl7cmV0dXJuKGZ1bmN0aW9uKCl7cmV0dXJueyBcIithLmguWGEoYix7dmFsdWVBY2Nlc3NvcnM6ITB9KStcIiB9IH0pKCl9LCdcIitkLnRvTG93ZXJDYXNlKCkrXCInKVwiO3JldHVybiBoLmNyZWF0ZUphdmFTY3JpcHRFdmFsdWF0b3JCbG9jayhkKStjfXZhciBjPS8oPChbYS16XStcXGQqKSg/OlxccysoPyFkYXRhLWJpbmRcXHMqPVxccyopW2EtejAtOVxcLV0rKD86PSg/OlxcXCJbXlxcXCJdKlxcXCJ8XFwnW15cXCddKlxcJ3xbXj5dKikpPykqXFxzKylkYXRhLWJpbmRcXHMqPVxccyooW1wiJ10pKFtcXHNcXFNdKj8pXFwzL2dpLGQ9L1xceDNjIS0tXFxzKmtvXFxiXFxzKihbXFxzXFxTXSo/KVxccyotLVxceDNlL2c7cmV0dXJue1RjOmZ1bmN0aW9uKGIsYyxkKXtjLmlzVGVtcGxhdGVSZXdyaXR0ZW4oYixkKXx8Yy5yZXdyaXRlVGVtcGxhdGUoYixmdW5jdGlvbihiKXtyZXR1cm4gYS5JYi5qZChiLFxuYyl9LGQpfSxqZDpmdW5jdGlvbihhLGYpe3JldHVybiBhLnJlcGxhY2UoYyxmdW5jdGlvbihhLGMsZCxlLGspe3JldHVybiBiKGssYyxkLGYpfSkucmVwbGFjZShkLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGIoYyxcIlxceDNjIS0tIGtvIC0tXFx4M2VcIixcIiNjb21tZW50XCIsZil9KX0sSmM6ZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5OLnliKGZ1bmN0aW9uKGQsaCl7dmFyIGw9ZC5uZXh0U2libGluZztsJiZsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1jJiZhLkxhKGwsYixoKX0pfX19KCk7YS5iKFwiX190cl9hbWJ0bnNcIixhLkliLkpjKTsoZnVuY3Rpb24oKXthLnY9e307YS52Lm49ZnVuY3Rpb24oYil7aWYodGhpcy5uPWIpe3ZhciBjPWEuYS5BKGIpO3RoaXMuZWI9XCJzY3JpcHRcIj09PWM/MTpcInRleHRhcmVhXCI9PT1jPzI6XCJ0ZW1wbGF0ZVwiPT1jJiZiLmNvbnRlbnQmJjExPT09Yi5jb250ZW50Lm5vZGVUeXBlPzM6NH19O2Eudi5uLnByb3RvdHlwZS50ZXh0PWZ1bmN0aW9uKCl7dmFyIGI9MT09PVxudGhpcy5lYj9cInRleHRcIjoyPT09dGhpcy5lYj9cInZhbHVlXCI6XCJpbm5lckhUTUxcIjtpZigwPT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiB0aGlzLm5bYl07dmFyIGM9YXJndW1lbnRzWzBdO1wiaW5uZXJIVE1MXCI9PT1iP2EuYS5FYih0aGlzLm4sYyk6dGhpcy5uW2JdPWN9O3ZhciBiPWEuYS5lLkooKStcIl9cIjthLnYubi5wcm90b3R5cGUuZGF0YT1mdW5jdGlvbihjKXtpZigxPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gYS5hLmUuZ2V0KHRoaXMubixiK2MpO2EuYS5lLnNldCh0aGlzLm4sYitjLGFyZ3VtZW50c1sxXSl9O3ZhciBjPWEuYS5lLkooKTthLnYubi5wcm90b3R5cGUubm9kZXM9ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm47aWYoMD09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4oYS5hLmUuZ2V0KGIsYyl8fHt9KS5tYnx8KDM9PT10aGlzLmViP2IuY29udGVudDo0PT09dGhpcy5lYj9iOm4pO2EuYS5lLnNldChiLGMse21iOmFyZ3VtZW50c1swXX0pfTthLnYuc2E9ZnVuY3Rpb24oYSl7dGhpcy5uPVxuYX07YS52LnNhLnByb3RvdHlwZT1uZXcgYS52Lm47YS52LnNhLnByb3RvdHlwZS50ZXh0PWZ1bmN0aW9uKCl7aWYoMD09YXJndW1lbnRzLmxlbmd0aCl7dmFyIGI9YS5hLmUuZ2V0KHRoaXMubixjKXx8e307Yi5KYj09PW4mJmIubWImJihiLkpiPWIubWIuaW5uZXJIVE1MKTtyZXR1cm4gYi5KYn1hLmEuZS5zZXQodGhpcy5uLGMse0piOmFyZ3VtZW50c1swXX0pfTthLmIoXCJ0ZW1wbGF0ZVNvdXJjZXNcIixhLnYpO2EuYihcInRlbXBsYXRlU291cmNlcy5kb21FbGVtZW50XCIsYS52Lm4pO2EuYihcInRlbXBsYXRlU291cmNlcy5hbm9ueW1vdXNUZW1wbGF0ZVwiLGEudi5zYSl9KSgpOyhmdW5jdGlvbigpe2Z1bmN0aW9uIGIoYixjLGQpe3ZhciBlO2ZvcihjPWEuZi5uZXh0U2libGluZyhjKTtiJiYoZT1iKSE9PWM7KWI9YS5mLm5leHRTaWJsaW5nKGUpLGQoZSxiKX1mdW5jdGlvbiBjKGMsZCl7aWYoYy5sZW5ndGgpe3ZhciBlPWNbMF0sZj1jW2MubGVuZ3RoLTFdLGc9ZS5wYXJlbnROb2RlLGg9XG5hLlMuaW5zdGFuY2Usbj1oLnByZXByb2Nlc3NOb2RlO2lmKG4pe2IoZSxmLGZ1bmN0aW9uKGEsYil7dmFyIGM9YS5wcmV2aW91c1NpYmxpbmcsZD1uLmNhbGwoaCxhKTtkJiYoYT09PWUmJihlPWRbMF18fGIpLGE9PT1mJiYoZj1kW2QubGVuZ3RoLTFdfHxjKSl9KTtjLmxlbmd0aD0wO2lmKCFlKXJldHVybjtlPT09Zj9jLnB1c2goZSk6KGMucHVzaChlLGYpLGEuYS5CYShjLGcpKX1iKGUsZixmdW5jdGlvbihiKXsxIT09Yi5ub2RlVHlwZSYmOCE9PWIubm9kZVR5cGV8fGEuVWIoZCxiKX0pO2IoZSxmLGZ1bmN0aW9uKGIpezEhPT1iLm5vZGVUeXBlJiY4IT09Yi5ub2RlVHlwZXx8YS5OLkNjKGIsW2RdKX0pO2EuYS5CYShjLGcpfX1mdW5jdGlvbiBkKGEpe3JldHVybiBhLm5vZGVUeXBlP2E6MDxhLmxlbmd0aD9hWzBdOm51bGx9ZnVuY3Rpb24gZShiLGUsZixoLHEpe3E9cXx8e307dmFyIHA9KGImJmQoYil8fGZ8fHt9KS5vd25lckRvY3VtZW50LG49cS50ZW1wbGF0ZUVuZ2luZXx8ZztcbmEuSWIuVGMoZixuLHApO2Y9bi5yZW5kZXJUZW1wbGF0ZShmLGgscSxwKTtpZihcIm51bWJlclwiIT10eXBlb2YgZi5sZW5ndGh8fDA8Zi5sZW5ndGgmJlwibnVtYmVyXCIhPXR5cGVvZiBmWzBdLm5vZGVUeXBlKXRocm93IEVycm9yKFwiVGVtcGxhdGUgZW5naW5lIG11c3QgcmV0dXJuIGFuIGFycmF5IG9mIERPTSBub2Rlc1wiKTtwPSExO3N3aXRjaChlKXtjYXNlIFwicmVwbGFjZUNoaWxkcmVuXCI6YS5mLmZhKGIsZik7cD0hMDticmVhaztjYXNlIFwicmVwbGFjZU5vZGVcIjphLmEudWMoYixmKTtwPSEwO2JyZWFrO2Nhc2UgXCJpZ25vcmVUYXJnZXROb2RlXCI6YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihcIlVua25vd24gcmVuZGVyTW9kZTogXCIrZSk7fXAmJihjKGYsaCkscS5hZnRlclJlbmRlciYmYS5sLncocS5hZnRlclJlbmRlcixudWxsLFtmLGguJGRhdGFdKSk7cmV0dXJuIGZ9ZnVuY3Rpb24gZihiLGMsZCl7cmV0dXJuIGEuSShiKT9iKCk6XCJmdW5jdGlvblwiPT09dHlwZW9mIGI/YihjLGQpOmJ9XG52YXIgZzthLkZiPWZ1bmN0aW9uKGIpe2lmKGIhPW4mJiEoYiBpbnN0YW5jZW9mIGEuUCkpdGhyb3cgRXJyb3IoXCJ0ZW1wbGF0ZUVuZ2luZSBtdXN0IGluaGVyaXQgZnJvbSBrby50ZW1wbGF0ZUVuZ2luZVwiKTtnPWJ9O2EuQ2I9ZnVuY3Rpb24oYixjLGssaCxxKXtrPWt8fHt9O2lmKChrLnRlbXBsYXRlRW5naW5lfHxnKT09bil0aHJvdyBFcnJvcihcIlNldCBhIHRlbXBsYXRlIGVuZ2luZSBiZWZvcmUgY2FsbGluZyByZW5kZXJUZW1wbGF0ZVwiKTtxPXF8fFwicmVwbGFjZUNoaWxkcmVuXCI7aWYoaCl7dmFyIHA9ZChoKTtyZXR1cm4gYS5CKGZ1bmN0aW9uKCl7dmFyIGc9YyYmYyBpbnN0YW5jZW9mIGEuUj9jOm5ldyBhLlIoYyxudWxsLG51bGwsbnVsbCx7ZXhwb3J0RGVwZW5kZW5jaWVzOiEwfSksbj1mKGIsZy4kZGF0YSxnKSxnPWUoaCxxLG4sZyxrKTtcInJlcGxhY2VOb2RlXCI9PXEmJihoPWcscD1kKGgpKX0sbnVsbCx7eWE6ZnVuY3Rpb24oKXtyZXR1cm4hcHx8IWEuYS5xYihwKX0saTpwJiZcblwicmVwbGFjZU5vZGVcIj09cT9wLnBhcmVudE5vZGU6cH0pfXJldHVybiBhLk4ueWIoZnVuY3Rpb24oZCl7YS5DYihiLGMsayxkLFwicmVwbGFjZU5vZGVcIil9KX07YS5wZD1mdW5jdGlvbihiLGQsZyxoLHEpe2Z1bmN0aW9uIHAoYSxiKXtjKGIsdCk7Zy5hZnRlclJlbmRlciYmZy5hZnRlclJlbmRlcihiLGEpO3Q9bnVsbH1mdW5jdGlvbiBzKGEsYyl7dD1xLmNyZWF0ZUNoaWxkQ29udGV4dChhLGcuYXMsZnVuY3Rpb24oYSl7YS4kaW5kZXg9Y30pO3ZhciBkPWYoYixhLHQpO3JldHVybiBlKG51bGwsXCJpZ25vcmVUYXJnZXROb2RlXCIsZCx0LGcpfXZhciB0O3JldHVybiBhLkIoZnVuY3Rpb24oKXt2YXIgYj1hLmEuYyhkKXx8W107XCJ1bmRlZmluZWRcIj09dHlwZW9mIGIubGVuZ3RoJiYoYj1bYl0pO2I9YS5hLk1hKGIsZnVuY3Rpb24oYil7cmV0dXJuIGcuaW5jbHVkZURlc3Ryb3llZHx8Yj09PW58fG51bGw9PT1ifHwhYS5hLmMoYi5fZGVzdHJveSl9KTthLmwudyhhLmEuRGIsbnVsbCxbaCxiLFxucyxnLHBdKX0sbnVsbCx7aTpofSl9O3ZhciBoPWEuYS5lLkooKTthLmQudGVtcGxhdGU9e2luaXQ6ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmEuYyhjKCkpO2lmKFwic3RyaW5nXCI9PXR5cGVvZiBkfHxkLm5hbWUpYS5mLnphKGIpO2Vsc2V7aWYoXCJub2Rlc1wiaW4gZCl7aWYoZD1kLm5vZGVzfHxbXSxhLkkoZCkpdGhyb3cgRXJyb3IoJ1RoZSBcIm5vZGVzXCIgb3B0aW9uIG11c3QgYmUgYSBwbGFpbiwgbm9uLW9ic2VydmFibGUgYXJyYXkuJyk7fWVsc2UgZD1hLmYuY2hpbGROb2RlcyhiKTtkPWEuYS5uYyhkKTsobmV3IGEudi5zYShiKSkubm9kZXMoZCl9cmV0dXJue2NvbnRyb2xzRGVzY2VuZGFudEJpbmRpbmdzOiEwfX0sdXBkYXRlOmZ1bmN0aW9uKGIsYyxkLGUsZil7dmFyIGc9YygpO2M9YS5hLmMoZyk7ZD0hMDtlPW51bGw7XCJzdHJpbmdcIj09dHlwZW9mIGM/Yz17fTooZz1jLm5hbWUsXCJpZlwiaW4gYyYmKGQ9YS5hLmMoY1tcImlmXCJdKSksZCYmXCJpZm5vdFwiaW4gYyYmKGQ9IWEuYS5jKGMuaWZub3QpKSk7XG5cImZvcmVhY2hcImluIGM/ZT1hLnBkKGd8fGIsZCYmYy5mb3JlYWNofHxbXSxjLGIsZik6ZD8oZj1cImRhdGFcImluIGM/Zi5hYyhjLmRhdGEsYy5hcyk6ZixlPWEuQ2IoZ3x8YixmLGMsYikpOmEuZi56YShiKTtmPWU7KGM9YS5hLmUuZ2V0KGIsaCkpJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBjLmsmJmMuaygpO2EuYS5lLnNldChiLGgsZiYmZi5jYSgpP2Y6bil9fTthLmgudmEudGVtcGxhdGU9ZnVuY3Rpb24oYil7Yj1hLmguQWIoYik7cmV0dXJuIDE9PWIubGVuZ3RoJiZiWzBdLnVua25vd258fGEuaC5mZChiLFwibmFtZVwiKT9udWxsOlwiVGhpcyB0ZW1wbGF0ZSBlbmdpbmUgZG9lcyBub3Qgc3VwcG9ydCBhbm9ueW1vdXMgdGVtcGxhdGVzIG5lc3RlZCB3aXRoaW4gaXRzIHRlbXBsYXRlc1wifTthLmYuYWEudGVtcGxhdGU9ITB9KSgpO2EuYihcInNldFRlbXBsYXRlRW5naW5lXCIsYS5GYik7YS5iKFwicmVuZGVyVGVtcGxhdGVcIixhLkNiKTthLmEuaGM9ZnVuY3Rpb24oYSxjLGQpe2lmKGEubGVuZ3RoJiZcbmMubGVuZ3RoKXt2YXIgZSxmLGcsaCxsO2ZvcihlPWY9MDsoIWR8fGU8ZCkmJihoPWFbZl0pOysrZil7Zm9yKGc9MDtsPWNbZ107KytnKWlmKGgudmFsdWU9PT1sLnZhbHVlKXtoLm1vdmVkPWwuaW5kZXg7bC5tb3ZlZD1oLmluZGV4O2Muc3BsaWNlKGcsMSk7ZT1nPTA7YnJlYWt9ZSs9Z319fTthLmEubGI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBiKGIsZCxlLGYsZyl7dmFyIGg9TWF0aC5taW4sbD1NYXRoLm1heCxtPVtdLGssbj1iLmxlbmd0aCxxLHA9ZC5sZW5ndGgscz1wLW58fDEsdD1uK3ArMSx2LHUseDtmb3Ioaz0wO2s8PW47aysrKWZvcih1PXYsbS5wdXNoKHY9W10pLHg9aChwLGsrcykscT1sKDAsay0xKTtxPD14O3ErKyl2W3FdPXE/az9iW2stMV09PT1kW3EtMV0/dVtxLTFdOmgodVtxXXx8dCx2W3EtMV18fHQpKzE6cSsxOmsrMTtoPVtdO2w9W107cz1bXTtrPW47Zm9yKHE9cDtrfHxxOylwPW1ba11bcV0tMSxxJiZwPT09bVtrXVtxLTFdP2wucHVzaChoW2gubGVuZ3RoXT17c3RhdHVzOmUsXG52YWx1ZTpkWy0tcV0saW5kZXg6cX0pOmsmJnA9PT1tW2stMV1bcV0/cy5wdXNoKGhbaC5sZW5ndGhdPXtzdGF0dXM6Zix2YWx1ZTpiWy0ta10saW5kZXg6a30pOigtLXEsLS1rLGcuc3BhcnNlfHxoLnB1c2goe3N0YXR1czpcInJldGFpbmVkXCIsdmFsdWU6ZFtxXX0pKTthLmEuaGMocyxsLCFnLmRvbnRMaW1pdE1vdmVzJiYxMCpuKTtyZXR1cm4gaC5yZXZlcnNlKCl9cmV0dXJuIGZ1bmN0aW9uKGEsZCxlKXtlPVwiYm9vbGVhblwiPT09dHlwZW9mIGU/e2RvbnRMaW1pdE1vdmVzOmV9OmV8fHt9O2E9YXx8W107ZD1kfHxbXTtyZXR1cm4gYS5sZW5ndGg8ZC5sZW5ndGg/YihhLGQsXCJhZGRlZFwiLFwiZGVsZXRlZFwiLGUpOmIoZCxhLFwiZGVsZXRlZFwiLFwiYWRkZWRcIixlKX19KCk7YS5iKFwidXRpbHMuY29tcGFyZUFycmF5c1wiLGEuYS5sYik7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYihiLGMsZCxoLGwpe3ZhciBtPVtdLGs9YS5CKGZ1bmN0aW9uKCl7dmFyIGs9YyhkLGwsYS5hLkJhKG0sYikpfHxbXTswPFxubS5sZW5ndGgmJihhLmEudWMobSxrKSxoJiZhLmwudyhoLG51bGwsW2QsayxsXSkpO20ubGVuZ3RoPTA7YS5hLnRhKG0sayl9LG51bGwse2k6Yix5YTpmdW5jdGlvbigpe3JldHVybiFhLmEuVGIobSl9fSk7cmV0dXJue2VhOm0sQjprLmNhKCk/azpufX12YXIgYz1hLmEuZS5KKCksZD1hLmEuZS5KKCk7YS5hLkRiPWZ1bmN0aW9uKGUsZixnLGgsbCl7ZnVuY3Rpb24gbShiLGMpe3c9cVtjXTt1IT09YyYmKERbYl09dyk7dy50Yih1KyspO2EuYS5CYSh3LmVhLGUpO3QucHVzaCh3KTt6LnB1c2godyl9ZnVuY3Rpb24gayhiLGMpe2lmKGIpZm9yKHZhciBkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKWNbZF0mJmEuYS5yKGNbZF0uZWEsZnVuY3Rpb24oYSl7YihhLGQsY1tkXS5rYSl9KX1mPWZ8fFtdO2g9aHx8e307dmFyIHI9YS5hLmUuZ2V0KGUsYyk9PT1uLHE9YS5hLmUuZ2V0KGUsYyl8fFtdLHA9YS5hLmliKHEsZnVuY3Rpb24oYSl7cmV0dXJuIGEua2F9KSxzPWEuYS5sYihwLGYsaC5kb250TGltaXRNb3ZlcyksXG50PVtdLHY9MCx1PTAseD1bXSx6PVtdO2Y9W107Zm9yKHZhciBEPVtdLHA9W10sdyxDPTAsQixFO0I9c1tDXTtDKyspc3dpdGNoKEU9Qi5tb3ZlZCxCLnN0YXR1cyl7Y2FzZSBcImRlbGV0ZWRcIjpFPT09biYmKHc9cVt2XSx3LkImJih3LkIuaygpLHcuQj1uKSxhLmEuQmEody5lYSxlKS5sZW5ndGgmJihoLmJlZm9yZVJlbW92ZSYmKHQucHVzaCh3KSx6LnB1c2godyksdy5rYT09PWQ/dz1udWxsOmZbQ109dyksdyYmeC5wdXNoLmFwcGx5KHgsdy5lYSkpKTt2Kys7YnJlYWs7Y2FzZSBcInJldGFpbmVkXCI6bShDLHYrKyk7YnJlYWs7Y2FzZSBcImFkZGVkXCI6RSE9PW4/bShDLEUpOih3PXtrYTpCLnZhbHVlLHRiOmEuTyh1KyspfSx0LnB1c2godyksei5wdXNoKHcpLHJ8fChwW0NdPXcpKX1hLmEuZS5zZXQoZSxjLHQpO2soaC5iZWZvcmVNb3ZlLEQpO2EuYS5yKHgsaC5iZWZvcmVSZW1vdmU/YS5iYTphLnJlbW92ZU5vZGUpO2Zvcih2YXIgQz0wLHI9YS5mLmZpcnN0Q2hpbGQoZSksRjt3PXpbQ107QysrKXt3LmVhfHxcbmEuYS5leHRlbmQodyxiKGUsZyx3LmthLGwsdy50YikpO2Zvcih2PTA7cz13LmVhW3ZdO3I9cy5uZXh0U2libGluZyxGPXMsdisrKXMhPT1yJiZhLmYua2MoZSxzLEYpOyF3LmFkJiZsJiYobCh3LmthLHcuZWEsdy50Yiksdy5hZD0hMCl9ayhoLmJlZm9yZVJlbW92ZSxmKTtmb3IoQz0wO0M8Zi5sZW5ndGg7KytDKWZbQ10mJihmW0NdLmthPWQpO2soaC5hZnRlck1vdmUsRCk7ayhoLmFmdGVyQWRkLHApfX0pKCk7YS5iKFwidXRpbHMuc2V0RG9tTm9kZUNoaWxkcmVuRnJvbUFycmF5TWFwcGluZ1wiLGEuYS5EYik7YS5YPWZ1bmN0aW9uKCl7dGhpcy5hbGxvd1RlbXBsYXRlUmV3cml0aW5nPSExfTthLlgucHJvdG90eXBlPW5ldyBhLlA7YS5YLnByb3RvdHlwZS5yZW5kZXJUZW1wbGF0ZVNvdXJjZT1mdW5jdGlvbihiLGMsZCxlKXtpZihjPSg5PmEuYS5DPzA6Yi5ub2Rlcyk/Yi5ub2RlcygpOm51bGwpcmV0dXJuIGEuYS5XKGMuY2xvbmVOb2RlKCEwKS5jaGlsZE5vZGVzKTtiPWIudGV4dCgpO1xucmV0dXJuIGEuYS5uYShiLGUpfTthLlgudmI9bmV3IGEuWDthLkZiKGEuWC52Yik7YS5iKFwibmF0aXZlVGVtcGxhdGVFbmdpbmVcIixhLlgpOyhmdW5jdGlvbigpe2EueGI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmVkPWZ1bmN0aW9uKCl7aWYoIXV8fCF1LnRtcGwpcmV0dXJuIDA7dHJ5e2lmKDA8PXUudG1wbC50YWcudG1wbC5vcGVuLnRvU3RyaW5nKCkuaW5kZXhPZihcIl9fXCIpKXJldHVybiAyfWNhdGNoKGEpe31yZXR1cm4gMX0oKTt0aGlzLnJlbmRlclRlbXBsYXRlU291cmNlPWZ1bmN0aW9uKGIsZSxmLGcpe2c9Z3x8dDtmPWZ8fHt9O2lmKDI+YSl0aHJvdyBFcnJvcihcIllvdXIgdmVyc2lvbiBvZiBqUXVlcnkudG1wbCBpcyB0b28gb2xkLiBQbGVhc2UgdXBncmFkZSB0byBqUXVlcnkudG1wbCAxLjAuMHByZSBvciBsYXRlci5cIik7dmFyIGg9Yi5kYXRhKFwicHJlY29tcGlsZWRcIik7aHx8KGg9Yi50ZXh0KCl8fFwiXCIsaD11LnRlbXBsYXRlKG51bGwsXCJ7e2tvX3dpdGggJGl0ZW0ua29CaW5kaW5nQ29udGV4dH19XCIrXG5oK1wie3sva29fd2l0aH19XCIpLGIuZGF0YShcInByZWNvbXBpbGVkXCIsaCkpO2I9W2UuJGRhdGFdO2U9dS5leHRlbmQoe2tvQmluZGluZ0NvbnRleHQ6ZX0sZi50ZW1wbGF0ZU9wdGlvbnMpO2U9dS50bXBsKGgsYixlKTtlLmFwcGVuZFRvKGcuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7dS5mcmFnbWVudHM9e307cmV0dXJuIGV9O3RoaXMuY3JlYXRlSmF2YVNjcmlwdEV2YWx1YXRvckJsb2NrPWZ1bmN0aW9uKGEpe3JldHVyblwie3trb19jb2RlICgoZnVuY3Rpb24oKSB7IHJldHVybiBcIithK1wiIH0pKCkpIH19XCJ9O3RoaXMuYWRkVGVtcGxhdGU9ZnVuY3Rpb24oYSxiKXt0LndyaXRlKFwiPHNjcmlwdCB0eXBlPSd0ZXh0L2h0bWwnIGlkPSdcIithK1wiJz5cIitiK1wiXFx4M2Mvc2NyaXB0PlwiKX07MDxhJiYodS50bXBsLnRhZy5rb19jb2RlPXtvcGVuOlwiX18ucHVzaCgkMSB8fCAnJyk7XCJ9LHUudG1wbC50YWcua29fd2l0aD17b3BlbjpcIndpdGgoJDEpIHtcIixjbG9zZTpcIn0gXCJ9KX07YS54Yi5wcm90b3R5cGU9XG5uZXcgYS5QO3ZhciBiPW5ldyBhLnhiOzA8Yi5lZCYmYS5GYihiKTthLmIoXCJqcXVlcnlUbXBsVGVtcGxhdGVFbmdpbmVcIixhLnhiKX0pKCl9KX0pKCk7fSkoKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2xpYi9rbm9ja291dC5qcyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7Ozs7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFEQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQURBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUpBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTEE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceAlliedTribe = function (_Action) {\n    _inherits(PlaceAlliedTribe, _Action);\n\n    function PlaceAlliedTribe(args) {\n        _classCallCheck(this, PlaceAlliedTribe);\n\n        var _this = _possibleConstructorReturn(this, (PlaceAlliedTribe.__proto__ || Object.getPrototypeOf(PlaceAlliedTribe)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.tribeId = args.tribeId;\n        return _this;\n    }\n\n    _createClass(PlaceAlliedTribe, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n\n            if (!tribe) {\n                debugger;\n                throw 'Invalid PlaceAlliedTribe Action';\n            }\n\n            if (!region.inPlay() || !faction.hasAvailableAlliedTribe() || !tribe.isSubdued()) {\n                debugger;\n                throw 'Invalid PlaceAlliedTribe Action';\n            }\n\n            var alliedTribe = faction.removeAlliedTribe();\n            tribe.makeAllied(alliedTribe);\n            region.addPiece(alliedTribe);\n            console.log('Placing ' + faction.name + ' Ally in ' + tribe.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n            var ally = _.find(region.getAlliesForFaction(faction.id), { tribeId: this.tribeId });\n            tribe.removeAlly(ally);\n            region.removePieces([ally]);\n            faction.returnAlliedTribes([ally]);\n            console.log('Taking back ' + faction.name + ' Ally from ' + tribe.name + ' in ' + region.name);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n            return ['Place ' + faction.name + ' Ally in ' + tribe.name + ' in region ' + region.name];\n        }\n    }]);\n\n    return PlaceAlliedTribe;\n}(_action2.default);\n\nexports.default = PlaceAlliedTribe;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUFsbGllZFRyaWJlLmpzPzY4ZTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5cbmNsYXNzIFBsYWNlQWxsaWVkVHJpYmUgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gYXJncy5yZWdpb25JZDtcbiAgICAgICAgdGhpcy50cmliZUlkID0gYXJncy50cmliZUlkO1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFt0aGlzLnRyaWJlSWRdO1xuXG4gICAgICAgIGlmICghdHJpYmUpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgUGxhY2VBbGxpZWRUcmliZSBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZWdpb24uaW5QbGF5KCkgfHwgIWZhY3Rpb24uaGFzQXZhaWxhYmxlQWxsaWVkVHJpYmUoKSB8fCAhdHJpYmUuaXNTdWJkdWVkKCkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgUGxhY2VBbGxpZWRUcmliZSBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWxsaWVkVHJpYmUgPSBmYWN0aW9uLnJlbW92ZUFsbGllZFRyaWJlKCk7XG4gICAgICAgIHRyaWJlLm1ha2VBbGxpZWQoYWxsaWVkVHJpYmUpO1xuICAgICAgICByZWdpb24uYWRkUGllY2UoYWxsaWVkVHJpYmUpO1xuICAgICAgICBjb25zb2xlLmxvZygnUGxhY2luZyAnICsgZmFjdGlvbi5uYW1lICsgJyBBbGx5IGluICcgKyB0cmliZS5uYW1lKTtcbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCB0cmliZSA9IHN0YXRlLnRyaWJlc0J5SWRbdGhpcy50cmliZUlkXTtcbiAgICAgICAgY29uc3QgYWxseSA9IF8uZmluZChyZWdpb24uZ2V0QWxsaWVzRm9yRmFjdGlvbihmYWN0aW9uLmlkKSwge3RyaWJlSWQ6IHRoaXMudHJpYmVJZH0pO1xuICAgICAgICB0cmliZS5yZW1vdmVBbGx5KGFsbHkpO1xuICAgICAgICByZWdpb24ucmVtb3ZlUGllY2VzKFthbGx5XSk7XG4gICAgICAgIGZhY3Rpb24ucmV0dXJuQWxsaWVkVHJpYmVzKFthbGx5XSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUYWtpbmcgYmFjayAnICsgZmFjdGlvbi5uYW1lICsgJyBBbGx5IGZyb20gJyArIHRyaWJlLm5hbWUgKyAnIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgdHJpYmUgPSBzdGF0ZS50cmliZXNCeUlkW3RoaXMudHJpYmVJZF07XG4gICAgICAgIHJldHVybiBbJ1BsYWNlICcgKyBmYWN0aW9uLm5hbWUgKyAnIEFsbHkgaW4gJyArIHRyaWJlLm5hbWUgKyAnIGluIHJlZ2lvbiAnICsgcmVnaW9uLm5hbWVdO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBQbGFjZUFsbGllZFRyaWJlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUxBO0FBTUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar RegionGroups = {\n    AQUITANIA: 'Aquitania',\n    BRITANNIA: 'Britannia',\n    BELGICA: 'Belgica',\n    CELTICA: 'Celtica',\n    GERMANIA: 'Germania',\n    PROVINCIA: 'Provincia'\n};\n\nexports.default = RegionGroups;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbkdyb3Vwcy5qcz8zYzFmIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJlZ2lvbkdyb3VwcyA9IHtcbiAgICBBUVVJVEFOSUE6ICdBcXVpdGFuaWEnLFxuICAgIEJSSVRBTk5JQTogJ0JyaXRhbm5pYScsXG4gICAgQkVMR0lDQTogJ0JlbGdpY2EnLFxuICAgIENFTFRJQ0E6ICdDZWx0aWNhJyxcbiAgICBHRVJNQU5JQTogJ0dlcm1hbmlhJyxcbiAgICBQUk9WSU5DSUE6ICdQcm92aW5jaWEnXG59O1xuXG5leHBvcnQgZGVmYXVsdCBSZWdpb25Hcm91cHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbmZpZy9yZWdpb25Hcm91cHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceWarbands = function (_Action) {\n    _inherits(PlaceWarbands, _Action);\n\n    function PlaceWarbands(args) {\n        _classCallCheck(this, PlaceWarbands);\n\n        var _this = _possibleConstructorReturn(this, (PlaceWarbands.__proto__ || Object.getPrototypeOf(PlaceWarbands)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.count = args.count;\n        return _this;\n    }\n\n    _createClass(PlaceWarbands, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n\n            if (!region.inPlay() || !faction.hasAvailableWarbands(count)) {\n                throw 'Invalid PlaceWarbands Action';\n            }\n\n            region.addPieces(faction.removeWarbands(count));\n            console.log('Placing ' + count + 'x ' + faction.name + ' Warbands in ' + region.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n\n            console.log('Taking back ' + count + 'x ' + faction.name + ' Warbands from ' + region.name);\n            var warbands = _lodash2.default.take(region.getHiddenPiecesForFaction(faction.id), count);\n            if (warbands.length !== count) {\n                throw 'Unable to undo PlaceWarbands Action';\n            }\n            region.removePieces(warbands);\n            faction.returnWarbands(warbands);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n            return ['Place ' + count + 'x ' + faction.name + ' Warbands in ' + region.name];\n        }\n    }]);\n\n    return PlaceWarbands;\n}(_action2.default);\n\nexports.default = PlaceWarbands;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZVdhcmJhbmRzLmpzP2FiMWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5pbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcblxuY2xhc3MgUGxhY2VXYXJiYW5kcyBleHRlbmRzIEFjdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgICAgIHRoaXMuZmFjdGlvbklkID0gYXJncy5mYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMucmVnaW9uSWQgPSBhcmdzLnJlZ2lvbklkO1xuICAgICAgICB0aGlzLmNvdW50ID0gYXJncy5jb3VudDtcbiAgICB9XG5cbiAgICBkb0V4ZWN1dGUoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQ7XG5cbiAgICAgICAgaWYoIXJlZ2lvbi5pblBsYXkoKSB8fCAhZmFjdGlvbi5oYXNBdmFpbGFibGVXYXJiYW5kcyhjb3VudCkpIHtcbiAgICAgICAgICAgIHRocm93ICdJbnZhbGlkIFBsYWNlV2FyYmFuZHMgQWN0aW9uJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZ2lvbi5hZGRQaWVjZXMoZmFjdGlvbi5yZW1vdmVXYXJiYW5kcyhjb3VudCkpO1xuICAgICAgICBjb25zb2xlLmxvZygnUGxhY2luZyAnICsgY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBXYXJiYW5kcyBpbiAnICsgcmVnaW9uLm5hbWUpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcblxuICAgICAgICBjb25zb2xlLmxvZygnVGFraW5nIGJhY2sgJyArIGNvdW50ICsgJ3ggJyArIGZhY3Rpb24ubmFtZSArICcgV2FyYmFuZHMgZnJvbSAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICBjb25zdCB3YXJiYW5kcyA9IF8udGFrZShyZWdpb24uZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihmYWN0aW9uLmlkKSwgY291bnQpO1xuICAgICAgICBpZih3YXJiYW5kcy5sZW5ndGggIT09IGNvdW50KSB7XG4gICAgICAgICAgICB0aHJvdyAnVW5hYmxlIHRvIHVuZG8gUGxhY2VXYXJiYW5kcyBBY3Rpb24nO1xuICAgICAgICB9XG4gICAgICAgIHJlZ2lvbi5yZW1vdmVQaWVjZXMod2FyYmFuZHMpO1xuICAgICAgICBmYWN0aW9uLnJldHVybldhcmJhbmRzKHdhcmJhbmRzKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQ7XG4gICAgICAgIHJldHVybiBbJ1BsYWNlICcgKyBjb3VudCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIFdhcmJhbmRzIGluICcgKyByZWdpb24ubmFtZV07XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQbGFjZVdhcmJhbmRzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlV2FyYmFuZHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUxBO0FBTUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RevealPieces = function (_Action) {\n    _inherits(RevealPieces, _Action);\n\n    function RevealPieces(args) {\n        _classCallCheck(this, RevealPieces);\n\n        var _this = _possibleConstructorReturn(this, (RevealPieces.__proto__ || Object.getPrototypeOf(RevealPieces)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.count = args.count;\n        return _this;\n    }\n\n    _createClass(RevealPieces, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var revealable = region.getHiddenPiecesForFaction(faction.id);\n\n            if (!this.count) {\n                this.count = revealable.length;\n            } else {\n                revealable = _lodash2.default.take(revealable, this.count);\n            }\n\n            if (this.count && revealable.length < this.count) {\n                throw 'Invalid RevealPieces Action';\n            }\n\n            _lodash2.default.each(revealable, function (piece) {\n                piece.revealed(true);\n            });\n\n            if (this.count) {\n                console.log('Revealing ' + this.count + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            if (this.count === 0) {\n                return;\n            }\n\n            var revealable = (0, _lodash2.default)(region.getWarbandsOrAuxiliaForFaction(faction.id)).filter(function (piece) {\n                return piece.revealed() && !piece.scouted();\n            }).take(this.count).value();\n            if (revealable.length === 0) {\n                throw 'Unable to undo RevealPieces Action';\n            }\n\n            _lodash2.default.each(revealable, function (piece) {\n                piece.revealed(false);\n            });\n            console.log('Hid ' + this.count + 'x ' + faction.name + ' pieces in ' + region.name);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            if (this.count) {\n                return ['Reveal ' + this.count + 'x ' + faction.name + ' pieces in ' + region.name];\n            }\n        }\n    }]);\n\n    return RevealPieces;\n}(_action2.default);\n\nexports.default = RevealPieces;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9yZXZlYWxQaWVjZXMuanM/OWZiYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBBY3Rpb24gZnJvbSAnLi9hY3Rpb24nO1xuXG5jbGFzcyBSZXZlYWxQaWVjZXMgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gYXJncy5yZWdpb25JZDtcbiAgICAgICAgdGhpcy5jb3VudCA9IGFyZ3MuY291bnQ7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgbGV0IHJldmVhbGFibGUgPSByZWdpb24uZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihmYWN0aW9uLmlkKTtcblxuICAgICAgICBpZighdGhpcy5jb3VudCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IHJldmVhbGFibGUubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV2ZWFsYWJsZSA9IF8udGFrZShyZXZlYWxhYmxlLCB0aGlzLmNvdW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNvdW50ICYmIHJldmVhbGFibGUubGVuZ3RoIDwgdGhpcy5jb3VudCkge1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgUmV2ZWFsUGllY2VzIEFjdGlvbic7XG4gICAgICAgIH1cblxuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICByZXZlYWxhYmxlLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICBwaWVjZS5yZXZlYWxlZCh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmKHRoaXMuY291bnQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZlYWxpbmcgJyArIHRoaXMuY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGlmKHRoaXMuY291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJldmVhbGFibGUgPSBfKHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oZmFjdGlvbi5pZCkpLmZpbHRlciggcGllY2UgPT4gKHBpZWNlLnJldmVhbGVkKCkgJiYgIXBpZWNlLnNjb3V0ZWQoKSkpLnRha2UodGhpcy5jb3VudCkudmFsdWUoKTtcbiAgICAgICAgaWYgKHJldmVhbGFibGUubGVuZ3RoID09PSAwICkge1xuICAgICAgICAgICAgdGhyb3cgJ1VuYWJsZSB0byB1bmRvIFJldmVhbFBpZWNlcyBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgcmV2ZWFsYWJsZSwgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgcGllY2UucmV2ZWFsZWQoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdIaWQgJyArIHRoaXMuY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBpZih0aGlzLmNvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gWydSZXZlYWwgJyArIHRoaXMuY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lXTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmV2ZWFsUGllY2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3JldmVhbFBpZWNlcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBTEE7QUFNQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Capability = function Capability(definition) {\n    _classCallCheck(this, Capability);\n\n    this.id = definition.id;\n    this.state = definition.state;\n    this.factionId = definition.factionId;\n};\n\nexports.default = Capability;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9jYXBhYmlsaXR5LmpzPzNkYTUiXSwic291cmNlc0NvbnRlbnQiOlsiXG5jbGFzcyBDYXBhYmlsaXR5IHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMuaWQgPSBkZWZpbml0aW9uLmlkO1xuICAgICAgICB0aGlzLnN0YXRlID0gZGVmaW5pdGlvbi5zdGF0ZTtcbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBkZWZpbml0aW9uLmZhY3Rpb25JZDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENhcGFiaWxpdHk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi9jYXBhYmlsaXR5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PlayerInteraction = function PlayerInteraction(definition) {\n    _classCallCheck(this, PlayerInteraction);\n\n    this.type = definition.type || 'PlayerInteraction';\n    this.requestingFactionId = definition.requestingFactionId;\n    this.respondingFactionId = definition.respondingFactionId;\n    this.status = definition.status || 'requested';\n};\n\nexports.default = PlayerInteraction;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbi5qcz8yMWFjIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFBsYXllckludGVyYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IGRlZmluaXRpb24udHlwZSB8fCAnUGxheWVySW50ZXJhY3Rpb24nO1xuICAgICAgICB0aGlzLnJlcXVlc3RpbmdGYWN0aW9uSWQgPSBkZWZpbml0aW9uLnJlcXVlc3RpbmdGYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMucmVzcG9uZGluZ0ZhY3Rpb25JZCA9IGRlZmluaXRpb24ucmVzcG9uZGluZ0ZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBkZWZpbml0aW9uLnN0YXR1cyB8fCAncmVxdWVzdGVkJztcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllckludGVyYWN0aW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL3BsYXllckludGVyYWN0aW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TurnContext = function () {\n    function TurnContext() {\n        var definition = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        _classCallCheck(this, TurnContext);\n\n        this.id = definition.id || '' + Math.random(); // need to make uuid\n        this.limited = definition.limited;\n        this.allowLimitedSpecial = definition.allowLimitedSpecial;\n        this.noSpecial = definition.noSpecial;\n        this.free = definition.free;\n        this.winter = definition.winter;\n        this.context = definition.context || {};\n        this.currentFactionId = definition.currentFactionId;\n        this.allowedRegions = (0, _lodash2.default)(_regionIds2.default).values().filter(function (regionId) {\n            return !definition.allowedRegions || _lodash2.default.indexOf(definition.allowedRegions, regionId) >= 0;\n        }).reject(function (regionId) {\n            return definition.restrictedRegions && _lodash2.default.indexOf(definition.restrictedRegions, regionId) >= 0;\n        }).value();\n\n        this.allowedCommands = (0, _lodash2.default)(_commandIds2.default).values().filter(function (commandId) {\n            return !definition.allowedCommands || _lodash2.default.indexOf(definition.allowedCommands, commandId) >= 0;\n        }).reject(function (commandId) {\n            return definition.restrictedCommands && _lodash2.default.indexOf(definition.restrictedCommands, commandId) >= 0;\n        }).value();\n    }\n\n    _createClass(TurnContext, [{\n        key: 'canDoSpecial',\n        value: function canDoSpecial() {\n            return !this.noSpecial && (!this.limited || this.allowLimitedSpecial);\n        }\n    }, {\n        key: 'isCommandAllowed',\n        value: function isCommandAllowed(commandId) {\n            return _lodash2.default.indexOf(this.allowedCommands, commandId) >= 0;\n        }\n    }, {\n        key: 'isRegionAllowed',\n        value: function isRegionAllowed(regionId) {\n            return _lodash2.default.indexOf(this.allowedRegions, regionId) >= 0;\n        }\n    }, {\n        key: 'getContextValue',\n        value: function getContextValue(key) {\n            return this.context[key];\n        }\n    }, {\n        key: 'asTest',\n        value: function asTest() {\n            var testVersion = _lodash2.default.cloneDeep(this);\n            testVersion.test = true;\n            return testVersion;\n        }\n    }]);\n\n    return TurnContext;\n}();\n\nexports.default = TurnContext;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi90dXJuQ29udGV4dC5qcz9hYTdkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnZmFsbGluZ3NreS9jb25maWcvY29tbWFuZElkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbklkcyc7XG5cbmNsYXNzIFR1cm5Db250ZXh0IHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uID0ge30pIHtcbiAgICAgICAgdGhpcy5pZCA9IGRlZmluaXRpb24uaWQgfHwgJycgKyBNYXRoLnJhbmRvbSgpOyAvLyBuZWVkIHRvIG1ha2UgdXVpZFxuICAgICAgICB0aGlzLmxpbWl0ZWQgPSBkZWZpbml0aW9uLmxpbWl0ZWQ7XG4gICAgICAgIHRoaXMuYWxsb3dMaW1pdGVkU3BlY2lhbCA9IGRlZmluaXRpb24uYWxsb3dMaW1pdGVkU3BlY2lhbDtcbiAgICAgICAgdGhpcy5ub1NwZWNpYWwgPSBkZWZpbml0aW9uLm5vU3BlY2lhbDtcbiAgICAgICAgdGhpcy5mcmVlID0gZGVmaW5pdGlvbi5mcmVlO1xuICAgICAgICB0aGlzLndpbnRlciA9IGRlZmluaXRpb24ud2ludGVyO1xuICAgICAgICB0aGlzLmNvbnRleHQgPSBkZWZpbml0aW9uLmNvbnRleHQgfHwge307XG4gICAgICAgIHRoaXMuY3VycmVudEZhY3Rpb25JZCA9IGRlZmluaXRpb24uY3VycmVudEZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5hbGxvd2VkUmVnaW9ucyA9IF8oUmVnaW9uSURzKS52YWx1ZXMoKS5maWx0ZXIoZnVuY3Rpb24ocmVnaW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiAhZGVmaW5pdGlvbi5hbGxvd2VkUmVnaW9ucyB8fCBfLmluZGV4T2YoZGVmaW5pdGlvbi5hbGxvd2VkUmVnaW9ucyAsIHJlZ2lvbklkKSA+PSAwO1xuICAgICAgICB9KS5yZWplY3QoZnVuY3Rpb24ocmVnaW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZpbml0aW9uLnJlc3RyaWN0ZWRSZWdpb25zICYmIF8uaW5kZXhPZihkZWZpbml0aW9uLnJlc3RyaWN0ZWRSZWdpb25zLCByZWdpb25JZCkgPj0gMDtcbiAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICB0aGlzLmFsbG93ZWRDb21tYW5kcyA9IF8oQ29tbWFuZElEcykudmFsdWVzKCkuZmlsdGVyKGZ1bmN0aW9uKGNvbW1hbmRJZCkge1xuICAgICAgICAgICAgcmV0dXJuICFkZWZpbml0aW9uLmFsbG93ZWRDb21tYW5kcyB8fCBfLmluZGV4T2YoZGVmaW5pdGlvbi5hbGxvd2VkQ29tbWFuZHMgLCBjb21tYW5kSWQpID49IDA7XG4gICAgICAgIH0pLnJlamVjdChmdW5jdGlvbihjb21tYW5kSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZpbml0aW9uLnJlc3RyaWN0ZWRDb21tYW5kcyAmJiBfLmluZGV4T2YoZGVmaW5pdGlvbi5yZXN0cmljdGVkQ29tbWFuZHMsIGNvbW1hbmRJZCkgPj0gMDtcbiAgICAgICAgfSkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBjYW5Eb1NwZWNpYWwoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5ub1NwZWNpYWwgJiYgKCF0aGlzLmxpbWl0ZWQgfHwgdGhpcy5hbGxvd0xpbWl0ZWRTcGVjaWFsKTtcbiAgICB9XG5cbiAgICBpc0NvbW1hbmRBbGxvd2VkKGNvbW1hbmRJZCkge1xuICAgICAgICByZXR1cm4gXy5pbmRleE9mKHRoaXMuYWxsb3dlZENvbW1hbmRzLCBjb21tYW5kSWQpID49IDA7XG4gICAgfVxuXG4gICAgaXNSZWdpb25BbGxvd2VkKHJlZ2lvbklkKSB7XG4gICAgICAgIHJldHVybiBfLmluZGV4T2YodGhpcy5hbGxvd2VkUmVnaW9ucywgcmVnaW9uSWQpID49IDA7XG4gICAgfVxuXG4gICAgZ2V0Q29udGV4dFZhbHVlKCBrZXkgKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRleHRba2V5XTtcbiAgICB9XG5cbiAgICBhc1Rlc3QoKSB7XG4gICAgICAgIGNvbnN0IHRlc3RWZXJzaW9uID0gXy5jbG9uZURlZXAodGhpcyk7XG4gICAgICAgIHRlc3RWZXJzaW9uLnRlc3QgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGVzdFZlcnNpb247XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUdXJuQ29udGV4dDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi90dXJuQ29udGV4dC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar AddResources = function (_Action) {\n    _inherits(AddResources, _Action);\n\n    function AddResources(args) {\n        _classCallCheck(this, AddResources);\n\n        var _this = _possibleConstructorReturn(this, (AddResources.__proto__ || Object.getPrototypeOf(AddResources)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.count = args.count;\n        _this.added = args.added;\n        _this.numAfter = args.numAfter;\n        return _this;\n    }\n\n    _createClass(AddResources, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var count = this.count;\n\n            this.added = faction.addResources(count);\n            this.numAfter = faction.resources();\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n\n            faction.removeResources(this.added);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            return ['Increase ' + faction.name + ' resources by ' + this.added + ' to ' + this.numAfter];\n        }\n    }]);\n\n    return AddResources;\n}(_action2.default);\n\nexports.default = AddResources;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9hZGRSZXNvdXJjZXMuanM/NzYyMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcblxuY2xhc3MgQWRkUmVzb3VyY2VzIGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5jb3VudCA9IGFyZ3MuY291bnQ7XG4gICAgICAgIHRoaXMuYWRkZWQgPSBhcmdzLmFkZGVkO1xuICAgICAgICB0aGlzLm51bUFmdGVyID0gYXJncy5udW1BZnRlcjtcbiAgICB9XG5cbiAgICBkb0V4ZWN1dGUoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcblxuICAgICAgICB0aGlzLmFkZGVkID0gZmFjdGlvbi5hZGRSZXNvdXJjZXMoY291bnQpO1xuICAgICAgICB0aGlzLm51bUFmdGVyID0gZmFjdGlvbi5yZXNvdXJjZXMoKTtcbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG5cbiAgICAgICAgZmFjdGlvbi5yZW1vdmVSZXNvdXJjZXModGhpcy5hZGRlZCk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICByZXR1cm4gWydJbmNyZWFzZSAnICsgZmFjdGlvbi5uYW1lICsgJyByZXNvdXJjZXMgYnkgJyArIHRoaXMuYWRkZWQgKyAnIHRvICcgKyB0aGlzLm51bUFmdGVyXTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWRkUmVzb3VyY2VzXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9hZGRSZXNvdXJjZXMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battleResults = __webpack_require__(154);\n\nvar _battleResults2 = _interopRequireDefault(_battleResults);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Battle = function (_Command) {\n    _inherits(Battle, _Command);\n\n    function Battle() {\n        _classCallCheck(this, Battle);\n\n        return _possibleConstructorReturn(this, (Battle.__proto__ || Object.getPrototypeOf(Battle)).apply(this, arguments));\n    }\n\n    _createClass(Battle, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var region = args.region;\n            var enlistingGermans = args.enlistingGermans;\n            var withGermanicHorse = args.withGermanicHorse;\n\n            var attackingFaction = args.attackingFaction;\n            var defendingFaction = args.defendingFaction;\n\n            var attackingPieces = region.getPiecesForFaction(attackingFaction.id);\n            if (enlistingGermans) {\n                var germanicPieces = region.getPiecesForFaction(_factionIds2.default.GERMANIC_TRIBES);\n                attackingPieces = _lodash2.default.concat(attackingPieces, germanicPieces);\n            }\n            var defendingPieces = args.defendingPieces || region.getPiecesForFaction(defendingFaction.id);\n            var canAmbush = !enlistingGermans && this.canAmbush(state, region, attackingFaction, attackingPieces, defendingPieces);\n\n            if (defendingFaction.id === _factionIds2.default.ROMANS && state.hasUnshadedCapability(_capabilities.CapabilityIDs.BALEARIC_SLINGERS)) {\n                attackingPieces = this.simulateBalearicSlingers(state, region, attackingFaction, attackingPieces, defendingFaction);\n            }\n\n            if (state.hasShadedCapability(_capabilities.CapabilityIDs.MASSED_GALLIC_ARCHERS)) {\n                var _simulateMassedGallic = this.simulateMassedGallicArchers(state, region, attackingFaction, attackingPieces, defendingFaction, defendingPieces),\n                    updatedAttackingPieces = _simulateMassedGallic.updatedAttackingPieces,\n                    updatedDefendingPieces = _simulateMassedGallic.updatedDefendingPieces;\n\n                attackingPieces = updatedAttackingPieces;\n                defendingPieces = updatedDefendingPieces;\n            }\n\n            var defenderCanRetreat = this.canRetreat(attackingFaction, defendingFaction, region);\n            var defenderCanGuaranteeSafeRetreat = defenderCanRetreat && this.hasGuaranteedSafeRetreat(attackingFaction, defendingFaction, region);\n\n            // Base Losses\n            var unmodifiedDefenderLosses = _losses2.default.calculateUnmodifiedLosses(state, attackingFaction, attackingPieces, false, withGermanicHorse);\n\n            if (attackingFaction.id === _factionIds2.default.ARVERNI && state.hasUnshadedCapability(_capabilities.CapabilityIDs.MASSED_GALLIC_ARCHERS)) {\n                unmodifiedDefenderLosses = Math.max(0, unmodifiedDefenderLosses - 1);\n            }\n\n            // No Retreat\n            var noRetreatDefenderLosses = unmodifiedDefenderLosses;\n            if (this.defenderHasCitadelOrFort(state, defendingPieces, state.hasUnshadedCapability(_capabilities.CapabilityIDs.BALLISTAE, attackingFaction.id))) {\n                noRetreatDefenderLosses /= 2;\n            } else if (withGermanicHorse && state.hasShadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE, attackingFaction.id) && !this.defenderHasCitadelOrFort(state, defendingPieces)) {\n                noRetreatDefenderLosses *= 2;\n            }\n            noRetreatDefenderLosses = Math.floor(noRetreatDefenderLosses);\n\n            if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                noRetreatDefenderLosses -= 1;\n            }\n            if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                noRetreatDefenderLosses += 2;\n            }\n\n            var noRetreatRollOrderedDefendingPieces = _losses2.default.orderPiecesRollsFirst(defendingPieces, false);\n            var worstCaseNoRetreatDefenderResults = this.calculateLeastAttackResults(noRetreatRollOrderedDefendingPieces, noRetreatDefenderLosses, false);\n            var worstCaseNoRetreatDefenderResultsWithAmbush = this.calculateLeastAttackResults(noRetreatRollOrderedDefendingPieces, noRetreatDefenderLosses, true);\n\n            // Retreat\n            var retreatDefenderLosses = Math.floor(unmodifiedDefenderLosses / 2);\n            if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                retreatDefenderLosses -= 1;\n            }\n            if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                retreatDefenderLosses += 2;\n            }\n            var retreatOrderedDefendingPieces = _losses2.default.orderPiecesRollsFirst(defendingPieces, true);\n            var worstCaseRetreatDefenderResults = this.calculateLeastAttackResults(retreatOrderedDefendingPieces, retreatDefenderLosses, false);\n\n            // Counterattack\n            var defenderCanCounterattack = this.canCounterattack(false, retreatDefenderLosses, defendingPieces);\n            var defenderCanCounterattackAmbush = this.canCounterattack(true, retreatDefenderLosses, defendingPieces);\n\n            var romansUseGermanicHorseOnDefense = defendingFaction.id === _factionIds2.default.ROMANS && state.hasUnshadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE);\n            var gallicUseGermanicHorseOnDefense = state.hasShadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE, defendingFaction.id);\n            var worstCaseAttackerLosses = _losses2.default.calculateUnmodifiedLosses(state, defendingFaction, worstCaseNoRetreatDefenderResults.remaining, true, romansUseGermanicHorseOnDefense);\n            if (gallicUseGermanicHorseOnDefense && !this.defenderHasCitadelOrFort(state, defendingPieces)) {\n                worstCaseAttackerLosses *= 2;\n            }\n            worstCaseAttackerLosses = Math.floor(worstCaseAttackerLosses);\n            if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                worstCaseAttackerLosses -= 1;\n            }\n            if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                worstCaseAttackerLosses += 2;\n            }\n            var worstCaseAttackerLossesAmbush = defenderCanCounterattackAmbush ? worstCaseAttackerLosses : 0;\n\n            var helpingFactionId = enlistingGermans ? _factionIds2.default.GERMANIC_TRIBES : null;\n            var orderedAttackingPieces = _losses2.default.orderPiecesForRemoval(state, attackingPieces, false, helpingFactionId);\n            var worstCaseCounterattackResults = this.calculateMostAttackResults(orderedAttackingPieces, worstCaseAttackerLosses, false);\n            var worstCaseCounterattackResultsWithAmbush = this.calculateMostAttackResults(orderedAttackingPieces, worstCaseAttackerLossesAmbush, false);\n\n            var worstCaseDefenderLosses = _lodash2.default.min([defenderCanRetreat ? worstCaseRetreatDefenderResults.targets.length : worstCaseNoRetreatDefenderResults.targets.length, worstCaseNoRetreatDefenderResults.targets.length, defendingPieces.length]);\n            var worstCaseDefenderLossesAmbush = worstCaseNoRetreatDefenderResultsWithAmbush.targets.length;\n\n            return new _battleResults2.default({\n                region: region,\n                cost: (region.devastated() ? 2 : 1) * (attackingFaction.id === _factionIds2.default.ROMANS ? 2 : 1),\n\n                attackingFaction: attackingFaction,\n                defendingFaction: defendingFaction,\n\n                attackingPieces: attackingPieces,\n                defendingPieces: defendingPieces,\n\n                canAmbush: canAmbush,\n                enlistingGermans: enlistingGermans,\n                defenderCanRetreat: defenderCanRetreat,\n                defenderCanGuaranteeSafeRetreat: defenderCanGuaranteeSafeRetreat,\n                defenderCanCounterattack: { normal: defenderCanCounterattack, ambush: defenderCanCounterattackAmbush },\n\n                defenderLosses: { normal: noRetreatDefenderLosses, retreat: retreatDefenderLosses },\n\n                worstCaseRetreatDefenderResults: worstCaseRetreatDefenderResults,\n                worstCaseNoRetreatDefenderResults: {\n                    normal: worstCaseNoRetreatDefenderResults,\n                    ambush: worstCaseNoRetreatDefenderResultsWithAmbush\n                },\n                worstCaseDefenderLosses: { normal: worstCaseDefenderLosses, ambush: worstCaseDefenderLossesAmbush },\n                worstCaseAttackerLosses: { normal: worstCaseAttackerLosses, ambush: worstCaseAttackerLossesAmbush },\n                worstCaseCounterattackResults: {\n                    normal: worstCaseCounterattackResults,\n                    ambush: worstCaseCounterattackResultsWithAmbush\n                }\n            });\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            var battleResults = args.battleResults || args;\n            var region = battleResults.region;\n            var attackingFaction = battleResults.attackingFaction;\n            var defendingFaction = battleResults.defendingFaction;\n            var attackingPlayer = state.playersByFaction[attackingFaction.id];\n            var defendingPlayer = state.playersByFaction[defendingFaction.id];\n            var enlistingGermans = battleResults.willEnlistGermans;\n            var ambush = battleResults.willAmbush;\n\n            console.log(attackingFaction.name + ' is battling ' + defendingFaction.name + ' in region ' + region.name + (enlistingGermans ? ' with German help' : ''));\n            console.log('*** Battleground: ***');\n            region.logState();\n            console.log('*** Battle: ***');\n            if (ambush) {\n                console.log(attackingFaction.name + ' is ambushing!');\n            }\n\n            var attackingPieces = Battle.getAttackingPieces(battleResults);\n            this.handleGermanicHorse(state, battleResults, region, attackingFaction, defendingFaction);\n\n            if (!battleResults.handledBalearicSlingers) {\n                this.handleBalearicSlingers(state, battleResults, region, attackingFaction, defendingFaction);\n                battleResults.handledBalearicSlingers = true;\n            }\n\n            if (state.hasShadedCapability(_capabilities.CapabilityIDs.MASSED_GALLIC_ARCHERS)) {\n                if (!battleResults.handledMassedGallicArchers) {\n                    this.handleMassedGallicArchers(state, battleResults, region, attackingFaction, defendingFaction);\n                    battleResults.handledMassedGallicArchers = true;\n                }\n            }\n\n            // We may have removed some attackers or defenders in balearic slingers or massed gallic archers\n            attackingPieces = Battle.getAttackingPieces(battleResults);\n\n            if (!battleResults.calculatedDefenderResults) {\n                var defendingPieces = Battle.getDefendingPieces(battleResults);\n\n                var unmodifiedDefenderLosses = _losses2.default.calculateUnmodifiedLosses(state, attackingFaction, attackingPieces, false, battleResults.willApplyGermanicHorse);\n                if (attackingFaction.id === _factionIds2.default.ARVERNI && state.hasUnshadedCapability(_capabilities.CapabilityIDs.MASSED_GALLIC_ARCHERS)) {\n                    unmodifiedDefenderLosses = Math.max(0, unmodifiedDefenderLosses - 1);\n                }\n                // No Retreat\n                var noRetreatDefenderLosses = unmodifiedDefenderLosses;\n                if (this.defenderHasCitadelOrFort(state, defendingPieces, state.hasUnshadedCapability(_capabilities.CapabilityIDs.BALLISTAE, attackingFaction.id))) {\n                    noRetreatDefenderLosses /= 2;\n                } else if (battleResults.willApplyGermanicHorse && attackingFaction.id !== _factionIds2.default.ROMANS && state.hasShadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE, attackingFaction.id)) {\n                    noRetreatDefenderLosses *= 2;\n                }\n                noRetreatDefenderLosses = Math.floor(noRetreatDefenderLosses);\n\n                if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                    noRetreatDefenderLosses -= 1;\n                }\n                if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                    noRetreatDefenderLosses += 2;\n                }\n\n                var defenderResults = {\n                    losses: noRetreatDefenderLosses,\n                    targets: [],\n                    remaining: []\n                };\n\n                if (!ambush && this.canRetreat(attackingFaction, defendingFaction, region)) {\n                    var retreatDefenderLosses = Math.floor(unmodifiedDefenderLosses / 2);\n                    if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                        retreatDefenderLosses -= 1;\n                    }\n                    if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                        retreatDefenderLosses += 2;\n                    }\n\n                    var retreatDeclaration = this.getRetreatDeclaration(state, region, attackingFaction, defendingFaction, noRetreatDefenderLosses, retreatDefenderLosses);\n                    if (retreatDeclaration.willRetreat) {\n                        console.log(defendingFaction.name + ' is retreating!');\n                        battleResults.willRetreat = true;\n                        defenderResults.losses = retreatDefenderLosses;\n                        defenderResults.agreeingFactionId = retreatDeclaration.agreeingFactionId;\n                    }\n                }\n\n                battleResults.calculatedDefenderResults = defenderResults;\n            }\n\n            if (battleResults.willBesiege && !battleResults.besieged) {\n                var pieceToRemove = _lodash2.default.find(battleResults.defendingPieces, { type: 'citadel' }) || _lodash2.default.find(battleResults.defendingPieces, { type: 'alliedtribe' });\n                if (pieceToRemove) {\n                    console.log('*** Attacker is Besieging ***');\n                    _removePieces2.default.execute(state, {\n                        factionId: defendingFaction.id,\n                        regionId: region.id,\n                        pieces: [pieceToRemove]\n                    });\n                }\n                battleResults.besieged = true;\n            }\n\n            if (!battleResults.committedDefenderResults) {\n                this.handleLosses(state, battleResults, battleResults.calculatedDefenderResults, false);\n                battleResults.committedDefenderResults = battleResults.calculatedDefenderResults;\n            }\n\n            if (battleResults.committedDefenderResults.counterattackPossible && !battleResults.willRetreat) {\n                var _defendingPieces = region.piecesByFaction()[defendingFaction.id];\n                var attackerLosses = _losses2.default.calculateUnmodifiedLosses(state, defendingFaction, battleResults.committedDefenderResults.remaining, true, battleResults.willApplyGermanicHorse);\n                if (battleResults.willApplyGermanicHorse && defendingFaction.id !== _factionIds2.default.ROMANS && state.hasShadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE, defendingFaction.id) && !this.defenderHasCitadelOrFort(state, _defendingPieces)) {\n                    attackerLosses *= 2;\n                }\n                attackerLosses = Math.floor(attackerLosses);\n                if (this.partyHasUnshadedLegioX(state, region, attackingFaction)) {\n                    attackerLosses -= 1;\n                }\n                if (this.partyHasUnshadedLegioX(state, region, defendingFaction)) {\n                    attackerLosses += 2;\n                }\n                if (attackerLosses > 0) {\n                    var counterattackResults = {\n                        losses: attackerLosses,\n                        targets: [],\n                        remaining: []\n                    };\n                    this.handleLosses(state, battleResults, counterattackResults, true);\n                }\n            }\n\n            if (battleResults.willRetreat && !battleResults.retreated) {\n                this.handleRetreat(state, battleResults, battleResults.committedDefenderResults);\n                battleResults.retreated = true;\n            }\n\n            if (!battleResults.willRetreat) {\n                _revealPieces2.default.execute(state, { factionId: attackingFaction.id, regionId: region.id });\n                _revealPieces2.default.execute(state, { factionId: defendingFaction.id, regionId: region.id });\n            }\n\n            if (ambush && state.hasShadedCapability(_capabilities.CapabilityIDs.BALLISTAE, attackingFaction.id)) {\n                var citadelOrFort = _lodash2.default.find(region.getPiecesForFaction(defendingFaction.id), function (piece) {\n                    return piece.type === 'citadel' || piece.type === 'fort';\n                });\n                if (citadelOrFort) {\n                    console.log('*** Attacker is using Ballistae ***');\n                    _removePieces2.default.execute(state, {\n                        factionId: defendingFaction.id,\n                        regionId: region.id,\n                        pieces: [citadelOrFort]\n                    });\n                }\n            }\n            battleResults.complete = true;\n            console.log('Battle complete');\n        }\n    }, {\n        key: 'getAttackingPieces',\n        value: function getAttackingPieces(battleResults) {\n            var pieces = battleResults.region.getPiecesForFaction(battleResults.attackingFaction.id);\n            if (battleResults.willEnlistGermans) {\n                var germans = battleResults.region.getPiecesForFaction(_factionIds2.default.GERMANIC_TRIBES);\n                pieces = _lodash2.default.concat(pieces, germans);\n            }\n            // diviciacus too\n\n            return pieces;\n        }\n    }, {\n        key: 'getDefendingPieces',\n        value: function getDefendingPieces(battleResults) {\n            var pieces = battleResults.region.getPiecesForFaction(battleResults.defendingFaction.id);\n            // diviciacus too\n\n            return pieces;\n        }\n    }, {\n        key: 'partyHasUnshadedLegioX',\n        value: function partyHasUnshadedLegioX(state, region, faction) {\n            if (faction.id !== _factionIds2.default.ROMANS) {\n                return false;\n            }\n\n            if (!region.getLeaderForFaction(_factionIds2.default.ROMANS) || region.getLegions().length === 0) {\n                return false;\n            }\n\n            return state.hasUnshadedCapability(_capabilities.CapabilityIDs.LEGIO_X);\n        }\n    }, {\n        key: 'handleGermanicHorse',\n        value: function handleGermanicHorse(state, battleResults, region, attackingFaction, defendingFaction) {\n\n            if (state.hasUnshadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE) && defendingFaction.id === _factionIds2.default.ROMANS || state.hasShadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE, defendingFaction.id)) {\n                var existingGermanicHorseDeclaration = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                    return interaction.type === 'GermanicHorseDeclaration' && interaction.regionId === region.id && interaction.respondingFactionId === defendingFaction.id;\n                });\n                if (existingGermanicHorseDeclaration) {\n                    battleResults.willApplyGermanicHorse = existingGermanicHorseDeclaration.status === 'agreed';\n                } else {\n                    battleResults.willApplyGermanicHorse = state.playersByFaction[defendingFaction.id].willApplyGermanicHorse(state, region, attackingFaction);\n                }\n            }\n        }\n    }, {\n        key: 'handleBalearicSlingers',\n        value: function handleBalearicSlingers(state, battleResults, region, attackingFaction, defendingFaction) {\n\n            if (state.hasUnshadedCapability(_capabilities.CapabilityIDs.BALEARIC_SLINGERS) && attackingFaction.id !== _factionIds2.default.ROMANS) {\n                var existingBalearicSlingersDeclaration = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                    return interaction.type === 'BalearicSlingersDeclaration' && interaction.regionId === region.id && interaction.respondingFactionId === _factionIds2.default.ROMANS;\n                });\n                if (existingBalearicSlingersDeclaration) {\n                    battleResults.willApplyBalearicSlingers = existingBalearicSlingersDeclaration.status === 'agreed';\n                } else {\n                    battleResults.willApplyBalearicSlingers = state.playersByFaction[_factionIds2.default.ROMANS].willApplyBalearicSlingers(state, region, attackingFaction, defendingFaction);\n                }\n            }\n\n            if (battleResults.willApplyBalearicSlingers) {\n                var attackerLosses = Math.floor(_losses2.default.calculateUnmodifiedLosses(state, defendingFaction, region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), false, battleResults.willApplyGermanicHorse));\n                if (attackerLosses > 0) {\n                    var existingLosses = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                        return interaction.type === 'Losses' && interaction.regionId === battleResults.region.id && interaction.respondingFactionId === attackingFaction.id && interaction.balearicSlingers;\n                    });\n                    if (!existingLosses) {\n                        console.log('*** Romans are using their Balearic Slingers *** ');\n                        state.playersByFaction[attackingFaction.id].takeLosses(state, battleResults, { losses: attackerLosses }, false, true);\n                    }\n                }\n            }\n        }\n    }, {\n        key: 'simulateBalearicSlingers',\n        value: function simulateBalearicSlingers(state, region, attackingFaction, attackerPieces, defendingFaction) {\n            var attackerLosses = Math.floor(_losses2.default.calculateUnmodifiedLosses(state, defendingFaction, region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), false, state.hasUnshadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE)));\n\n            // Arverni can use the elite to soak up the losses if lucky\n            if (attackingFaction.id === _factionIds2.default.ARVERNI && _lodash2.default.find(attackerPieces, { type: 'leader' }) && state.hasShadedCapability(_capabilities.CapabilityIDs.VERCINGETORIXS_ELITE, attackingFaction.id)) {\n                return attackerPieces;\n            }\n\n            return _lodash2.default.drop(_losses2.default.orderPiecesRollsFirst(attackerPieces, false), attackerLosses);\n        }\n    }, {\n        key: 'handleMassedGallicArchers',\n        value: function handleMassedGallicArchers(state, battleResults, region, attackingFaction, defendingFaction) {\n            if ((attackingFaction.id === _factionIds2.default.ARVERNI || defendingFaction.id === _factionIds2.default.ARVERNI) && region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length < 6) {\n                return;\n            }\n\n            var targetFaction = attackingFaction.id === _factionIds2.default.ARVERNI ? defendingFaction : attackingFaction;\n            var existingLosses = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                return interaction.type === 'Losses' && interaction.regionId === battleResults.region.id && interaction.respondingFactionId === targetFaction.id && interaction.massedGallicArchers;\n            });\n\n            if (!existingLosses) {\n                console.log('*** Arverni are using their Massed Gallic Archers *** ');\n                state.playersByFaction[targetFaction.id].takeLosses(state, battleResults, { losses: 1 }, false, true);\n            }\n        }\n    }, {\n        key: 'simulateMassedGallicArchers',\n        value: function simulateMassedGallicArchers(state, region, attackingFaction, attackingPieces, defendingFaction, defendingPieces, enlistingGermans) {\n            var updatedAttackingPieces = attackingPieces;\n            var updatedDefendingPieces = defendingPieces;\n            if (attackingFaction.id === _factionIds2.default.ARVERNI && (_lodash2.default.countBy(attackingPieces, 'type').warband || 0) >= 6) {\n                var rollFirstOrderedPieces = _losses2.default.orderPiecesRollsFirst(defendingPieces, false);\n                var firstPiece = _lodash2.default.first(rollFirstOrderedPieces);\n                if (firstPiece && !firstPiece.canRoll) {\n                    var weakestOrderedPieces = _losses2.default.orderPiecesForRemoval(state, defendingPieces, false);\n                    updatedDefendingPieces = _lodash2.default.drop(weakestOrderedPieces, 1);\n                }\n            } else if (defendingFaction.id === _factionIds2.default.ARVERNI && (_lodash2.default.countBy(defendingPieces, 'type').warband || 0) >= 6) {\n                var helpingFactionId = enlistingGermans ? _factionIds2.default.GERMANIC_TRIBES : null;\n                updatedAttackingPieces = _lodash2.default.drop(_losses2.default.orderPiecesForRemoval(state, attackingPieces, false, helpingFactionId), 1);\n            }\n            return { updatedAttackingPieces: updatedAttackingPieces, updatedDefendingPieces: updatedDefendingPieces };\n        }\n    }, {\n        key: 'getRetreatDeclaration',\n        value: function getRetreatDeclaration(state, region, attackingFaction, defendingFaction, noRetreatLosses, retreatLosses) {\n\n            var existingRetreatDeclaration = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                return interaction.type === 'RetreatDeclaration' && interaction.regionId === region.id && interaction.respondingFactionId === defendingFaction.id;\n            });\n\n            if (existingRetreatDeclaration) {\n                return { willRetreat: existingRetreatDeclaration.status === 'agreed' };\n            }\n\n            return state.playersByFaction[defendingFaction.id].willRetreat(state, region, attackingFaction, noRetreatLosses, retreatLosses);\n        }\n    }, {\n        key: 'handleLosses',\n        value: function handleLosses(state, battleResults, attackResults, counterattack) {\n            var defender = counterattack ? battleResults.attackingFaction : battleResults.defendingFaction;\n\n            if (battleResults.region.getPiecesForFaction(defender.id).length === 0) {\n                return;\n            }\n\n            var existingLosses = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                return interaction.type === 'Losses' && interaction.regionId === battleResults.region.id && interaction.respondingFactionId === defender.id;\n            });\n            if (existingLosses) {\n                attackResults.removed = existingLosses.removed;\n                attackResults.remaining = battleResults.region.getPiecesForFaction(defender.id);\n                attackResults.counterattackPossible = !counterattack && (!battleResults.willAmbush || existingLosses.caesarCanCounterattack);\n            } else {\n                state.playersByFaction[defender.id].takeLosses(state, battleResults, attackResults, counterattack);\n            }\n        }\n    }, {\n        key: 'handleRetreat',\n        value: function handleRetreat(state, battleResults, attackResults) {\n            var defender = battleResults.defendingFaction;\n\n            var existingRetreat = _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (interaction) {\n                return interaction.type === 'Retreat' && interaction.regionId === battleResults.region.id && interaction.respondingFactionId === defender.id;\n            });\n            if (!existingRetreat) {\n                state.playersByFaction[defender.id].retreatFromBattle(state, battleResults, attackResults);\n            }\n        }\n    }, {\n        key: 'canRetreat',\n        value: function canRetreat(attackingFaction, defendingFaction, region) {\n\n            // Germans always ambush\n            if (attackingFaction.id === _factionIds2.default.GERMANIC_TRIBES) {\n                return false;\n            }\n\n            // Germans never retreat\n            if (defendingFaction.id === _factionIds2.default.GERMANIC_TRIBES) {\n                return false;\n            }\n\n            // Have to have mobile pieces to retreat\n            var mobileDefenders = _lodash2.default.filter(region.piecesByFaction()[defendingFaction.id], function (piece) {\n                return piece.isMobile;\n            });\n\n            if (mobileDefenders.length === 0) {\n                return false;\n            }\n\n            // Have to have a non-german and non-controlled adjacent region, or be defending against romans\n            var adjacentNonGermanicControlledRegion = _lodash2.default.find(region.adjacent, function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() && adjacentRegion.controllingFactionId() !== _factionIds2.default.GERMANIC_TRIBES;\n            });\n\n            if (!adjacentNonGermanicControlledRegion && attackingFaction.id !== _factionIds2.default.ROMANS) {\n                return false;\n            }\n\n            return true;\n        }\n    }, {\n        key: 'hasGuaranteedSafeRetreat',\n        value: function hasGuaranteedSafeRetreat(attackingFaction, defendingFaction, region) {\n            if (attackingFaction.id === _factionIds2.default.ROMANS) {\n                return true;\n            }\n\n            return _lodash2.default.find(region.adjacent, function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() === defendingFaction.id;\n            });\n        }\n    }, {\n        key: 'calculateLeastAttackResults',\n        value: function calculateLeastAttackResults(orderedFactionPieces, calculatedLosses, ambush) {\n            var allowRolls = !ambush || this.caesarDefending(orderedFactionPieces);\n            var firstRollablePieceIndex = _lodash2.default.findIndex(orderedFactionPieces, this.canRollForType);\n            var removalCount = allowRolls ? Math.min(firstRollablePieceIndex === -1 ? orderedFactionPieces.length : firstRollablePieceIndex, calculatedLosses) : calculatedLosses;\n            var targets = _lodash2.default.take(orderedFactionPieces, removalCount);\n            var remaining = _lodash2.default.drop(orderedFactionPieces, targets.length);\n\n            return {\n                losses: calculatedLosses,\n                targets: targets,\n                remaining: remaining\n            };\n        }\n    }, {\n        key: 'calculateMostAttackResults',\n        value: function calculateMostAttackResults(orderedFactionPieces, calculatedLosses) {\n            var targets = _lodash2.default.take(orderedFactionPieces, calculatedLosses);\n            var remaining = _lodash2.default.drop(orderedFactionPieces, targets.length);\n\n            return {\n                losses: calculatedLosses,\n                targets: targets,\n                remaining: remaining\n            };\n        }\n    }, {\n        key: 'canRollForType',\n        value: function canRollForType(piece) {\n            var typesForRolls = ['leader', 'citadel', 'legion', 'fort'];\n            return _lodash2.default.indexOf(typesForRolls, piece.type) >= 0;\n        }\n    }, {\n        key: 'defenderHasCitadelOrFort',\n        value: function defenderHasCitadelOrFort(state, defendingPieces, ballistae) {\n            return _lodash2.default.find(defendingPieces, function (piece) {\n                return piece.type === 'citadel' && !ballistae || piece.type === 'fort';\n            });\n        }\n    }, {\n        key: 'canAmbush',\n        value: function canAmbush(state, region, attackingFaction, attackingPieces, defendingPieces) {\n\n            if (attackingFaction.id === _factionIds2.default.ROMANS) {\n                return false;\n            }\n\n            if (attackingFaction.id === _factionIds2.default.BELGAE || attackingFaction.id === _factionIds2.default.ARVERNI) {\n                var leaderRegion = _lodash2.default.find(state.regions, function (region) {\n                    return region.getLeaderForFaction(attackingFaction.id);\n                });\n                if (!leaderRegion) {\n                    return false;\n                }\n                var leader = leaderRegion.getLeaderForFaction(attackingFaction.id);\n                var isAmbiorixOrVercingetorix = leader && !leader.isSuccessor();\n                var validRegionIds = isAmbiorixOrVercingetorix ? (0, _lodash2.default)(leaderRegion.adjacent).concat([leaderRegion]).map('id').value() : [leaderRegion];\n\n                if (_lodash2.default.indexOf(validRegionIds, region.id) < 0) {\n                    return false;\n                }\n            }\n\n            var numAttackersHidden = this.calculateHidden(attackingPieces);\n            var numDefendersHidden = this.calculateHidden(defendingPieces);\n            return numAttackersHidden > numDefendersHidden;\n        }\n    }, {\n        key: 'canCounterattack',\n        value: function canCounterattack(ambush, defenderLosses, defendingPieces) {\n            // Caesar might roll for a counterattack\n            if (this.caesarDefending(defendingPieces)) {\n                return true;\n            }\n\n            // Without Caesar an ambush will disallow\n            if (ambush) {\n                return false;\n            }\n\n            // Leaders and legions might survive loss rolls\n            if (this.leaderOrLegionsDefending(defendingPieces)) {\n                return true;\n            }\n\n            // Not enough losses will allow (but a single warband/auxilia cannot counterattack)\n            var mobileDefenders = _lodash2.default.filter(defendingPieces, { isMobile: true });\n            return defenderLosses < mobileDefenders.length - 1;\n        }\n    }, {\n        key: 'calculateHidden',\n        value: function calculateHidden(pieces) {\n            return _lodash2.default.filter(pieces, function (piece) {\n                return (piece.type === 'auxilia' || piece.type === 'warband') && !piece.revealed();\n            }).length;\n        }\n    }, {\n        key: 'caesarDefending',\n        value: function caesarDefending(defendingPieces) {\n            var defendingRomanLeader = _lodash2.default.find(defendingPieces, { type: 'leader', factionId: _factionIds2.default.ROMANS });\n            return defendingRomanLeader && !defendingRomanLeader.isSuccessor();\n        }\n    }, {\n        key: 'leaderOrLegionsDefending',\n        value: function leaderOrLegionsDefending(defendingPieces) {\n            var defendingPiecesByType = _lodash2.default.groupBy(defendingPieces, 'type');\n            return defendingPiecesByType.leader || defendingPiecesByType.legion;\n        }\n    }]);\n\n    return Battle;\n}(_command2.default);\n\nexports.default = Battle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYmF0dGxlLmpzPzIwYjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZCBmcm9tICcuL2NvbW1hbmQnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IEJhdHRsZVJlc3VsdHMgZnJvbSAnLi9iYXR0bGVSZXN1bHRzJztcblxuaW1wb3J0IFJldmVhbFBpZWNlcyBmcm9tICcuLi9hY3Rpb25zL3JldmVhbFBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzICBmcm9tICcuLi9hY3Rpb25zL3JlbW92ZVBpZWNlcyc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHN9IGZyb20gJy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IExvc3NlcyBmcm9tICdmYWxsaW5nc2t5L3V0aWwvbG9zc2VzJztcblxuY2xhc3MgQmF0dGxlIGV4dGVuZHMgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IGFyZ3MucmVnaW9uO1xuICAgICAgICBjb25zdCBlbmxpc3RpbmdHZXJtYW5zID0gYXJncy5lbmxpc3RpbmdHZXJtYW5zO1xuICAgICAgICBjb25zdCB3aXRoR2VybWFuaWNIb3JzZSA9IGFyZ3Mud2l0aEdlcm1hbmljSG9yc2U7XG5cbiAgICAgICAgY29uc3QgYXR0YWNraW5nRmFjdGlvbiA9IGFyZ3MuYXR0YWNraW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgZGVmZW5kaW5nRmFjdGlvbiA9IGFyZ3MuZGVmZW5kaW5nRmFjdGlvbjtcblxuICAgICAgICBsZXQgYXR0YWNraW5nUGllY2VzID0gcmVnaW9uLmdldFBpZWNlc0ZvckZhY3Rpb24oYXR0YWNraW5nRmFjdGlvbi5pZCk7XG4gICAgICAgIGlmIChlbmxpc3RpbmdHZXJtYW5zKSB7XG4gICAgICAgICAgICBjb25zdCBnZXJtYW5pY1BpZWNlcyA9IHJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTKTtcbiAgICAgICAgICAgIGF0dGFja2luZ1BpZWNlcyA9IF8uY29uY2F0KGF0dGFja2luZ1BpZWNlcywgZ2VybWFuaWNQaWVjZXMpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBkZWZlbmRpbmdQaWVjZXMgPSBhcmdzLmRlZmVuZGluZ1BpZWNlcyB8fCByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihkZWZlbmRpbmdGYWN0aW9uLmlkKTtcbiAgICAgICAgY29uc3QgY2FuQW1idXNoID0gIWVubGlzdGluZ0dlcm1hbnMgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5BbWJ1c2goc3RhdGUsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbiwgYXR0YWNraW5nUGllY2VzLCBkZWZlbmRpbmdQaWVjZXMpO1xuXG5cbiAgICAgICAgaWYoZGVmZW5kaW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMgJiYgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFMRUFSSUNfU0xJTkdFUlMpKSB7XG4gICAgICAgICAgICBhdHRhY2tpbmdQaWVjZXMgPSB0aGlzLnNpbXVsYXRlQmFsZWFyaWNTbGluZ2VycyhzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBhdHRhY2tpbmdQaWVjZXMsIGRlZmVuZGluZ0ZhY3Rpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLk1BU1NFRF9HQUxMSUNfQVJDSEVSUykpIHtcbiAgICAgICAgICAgIGNvbnN0IHt1cGRhdGVkQXR0YWNraW5nUGllY2VzLCB1cGRhdGVkRGVmZW5kaW5nUGllY2VzfSA9IHRoaXMuc2ltdWxhdGVNYXNzZWRHYWxsaWNBcmNoZXJzKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2luZ1BpZWNlcywgZGVmZW5kaW5nRmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nUGllY2VzKTtcblxuICAgICAgICAgICAgYXR0YWNraW5nUGllY2VzID0gdXBkYXRlZEF0dGFja2luZ1BpZWNlcztcbiAgICAgICAgICAgIGRlZmVuZGluZ1BpZWNlcyA9IHVwZGF0ZWREZWZlbmRpbmdQaWVjZXM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkZWZlbmRlckNhblJldHJlYXQgPSB0aGlzLmNhblJldHJlYXQoYXR0YWNraW5nRmFjdGlvbiwgZGVmZW5kaW5nRmFjdGlvbiwgcmVnaW9uKTtcbiAgICAgICAgY29uc3QgZGVmZW5kZXJDYW5HdWFyYW50ZWVTYWZlUmV0cmVhdCA9IGRlZmVuZGVyQ2FuUmV0cmVhdCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNHdWFyYW50ZWVkU2FmZVJldHJlYXQoYXR0YWNraW5nRmFjdGlvbiwgZGVmZW5kaW5nRmFjdGlvbiwgcmVnaW9uKTtcblxuICAgICAgICAvLyBCYXNlIExvc3Nlc1xuICAgICAgICBsZXQgdW5tb2RpZmllZERlZmVuZGVyTG9zc2VzID0gTG9zc2VzLmNhbGN1bGF0ZVVubW9kaWZpZWRMb3NzZXMoc3RhdGUsIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2luZ1BpZWNlcywgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoR2VybWFuaWNIb3JzZSk7XG5cbiAgICAgICAgaWYgKGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQVJWRVJOSSAmJiBzdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5NQVNTRURfR0FMTElDX0FSQ0hFUlMpKSB7XG4gICAgICAgICAgICB1bm1vZGlmaWVkRGVmZW5kZXJMb3NzZXMgPSBNYXRoLm1heCgwLCB1bm1vZGlmaWVkRGVmZW5kZXJMb3NzZXMgLSAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIFJldHJlYXRcbiAgICAgICAgbGV0IG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzID0gdW5tb2RpZmllZERlZmVuZGVyTG9zc2VzO1xuICAgICAgICBpZiAodGhpcy5kZWZlbmRlckhhc0NpdGFkZWxPckZvcnQoc3RhdGUsIGRlZmVuZGluZ1BpZWNlcywgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFMTElTVEFFLCBhdHRhY2tpbmdGYWN0aW9uLmlkKSkpIHtcbiAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzIC89IDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod2l0aEdlcm1hbmljSG9yc2UgJiYgc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLkdFUk1BTklDX0hPUlNFLCBhdHRhY2tpbmdGYWN0aW9uLmlkKSAmJiAhdGhpcy5kZWZlbmRlckhhc0NpdGFkZWxPckZvcnQoc3RhdGUsIGRlZmVuZGluZ1BpZWNlcykpIHtcbiAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzICo9IDI7XG4gICAgICAgIH1cbiAgICAgICAgbm9SZXRyZWF0RGVmZW5kZXJMb3NzZXMgPSBNYXRoLmZsb29yKG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzKTtcblxuICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGRlZmVuZGluZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICBub1JldHJlYXREZWZlbmRlckxvc3NlcyAtPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcnR5SGFzVW5zaGFkZWRMZWdpb1goc3RhdGUsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbikpIHtcbiAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzICs9IDI7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub1JldHJlYXRSb2xsT3JkZXJlZERlZmVuZGluZ1BpZWNlcyA9IExvc3Nlcy5vcmRlclBpZWNlc1JvbGxzRmlyc3QoZGVmZW5kaW5nUGllY2VzLCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0cyA9IHRoaXMuY2FsY3VsYXRlTGVhc3RBdHRhY2tSZXN1bHRzKG5vUmV0cmVhdFJvbGxPcmRlcmVkRGVmZW5kaW5nUGllY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub1JldHJlYXREZWZlbmRlckxvc3NlcywgZmFsc2UpO1xuICAgICAgICBjb25zdCB3b3JzdENhc2VOb1JldHJlYXREZWZlbmRlclJlc3VsdHNXaXRoQW1idXNoID0gdGhpcy5jYWxjdWxhdGVMZWFzdEF0dGFja1Jlc3VsdHMoXG4gICAgICAgICAgICBub1JldHJlYXRSb2xsT3JkZXJlZERlZmVuZGluZ1BpZWNlcyxcbiAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzLCB0cnVlKTtcblxuICAgICAgICAvLyBSZXRyZWF0XG4gICAgICAgIGxldCByZXRyZWF0RGVmZW5kZXJMb3NzZXMgPSBNYXRoLmZsb29yKHVubW9kaWZpZWREZWZlbmRlckxvc3NlcyAvIDIpO1xuICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGRlZmVuZGluZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICByZXRyZWF0RGVmZW5kZXJMb3NzZXMgLT0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICByZXRyZWF0RGVmZW5kZXJMb3NzZXMgKz0gMjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXRyZWF0T3JkZXJlZERlZmVuZGluZ1BpZWNlcyA9IExvc3Nlcy5vcmRlclBpZWNlc1JvbGxzRmlyc3QoZGVmZW5kaW5nUGllY2VzLCB0cnVlKTtcbiAgICAgICAgY29uc3Qgd29yc3RDYXNlUmV0cmVhdERlZmVuZGVyUmVzdWx0cyA9IHRoaXMuY2FsY3VsYXRlTGVhc3RBdHRhY2tSZXN1bHRzKHJldHJlYXRPcmRlcmVkRGVmZW5kaW5nUGllY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmVhdERlZmVuZGVyTG9zc2VzLCBmYWxzZSk7XG5cbiAgICAgICAgLy8gQ291bnRlcmF0dGFja1xuICAgICAgICBjb25zdCBkZWZlbmRlckNhbkNvdW50ZXJhdHRhY2sgPSB0aGlzLmNhbkNvdW50ZXJhdHRhY2soZmFsc2UsIHJldHJlYXREZWZlbmRlckxvc3NlcywgZGVmZW5kaW5nUGllY2VzKTtcbiAgICAgICAgY29uc3QgZGVmZW5kZXJDYW5Db3VudGVyYXR0YWNrQW1idXNoID0gdGhpcy5jYW5Db3VudGVyYXR0YWNrKHRydWUsIHJldHJlYXREZWZlbmRlckxvc3NlcywgZGVmZW5kaW5nUGllY2VzKTtcblxuICAgICAgICBjb25zdCByb21hbnNVc2VHZXJtYW5pY0hvcnNlT25EZWZlbnNlID0gZGVmZW5kaW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMgJiYgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuR0VSTUFOSUNfSE9SU0UpO1xuICAgICAgICBjb25zdCBnYWxsaWNVc2VHZXJtYW5pY0hvcnNlT25EZWZlbnNlID0gc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLkdFUk1BTklDX0hPUlNFLCBkZWZlbmRpbmdGYWN0aW9uLmlkKTtcbiAgICAgICAgbGV0IHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzID0gTG9zc2VzLmNhbGN1bGF0ZVVubW9kaWZpZWRMb3NzZXMoc3RhdGUsIGRlZmVuZGluZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0cy5yZW1haW5pbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIHJvbWFuc1VzZUdlcm1hbmljSG9yc2VPbkRlZmVuc2UpO1xuICAgICAgICBpZiAoZ2FsbGljVXNlR2VybWFuaWNIb3JzZU9uRGVmZW5zZSAmJiAhdGhpcy5kZWZlbmRlckhhc0NpdGFkZWxPckZvcnQoc3RhdGUsIGRlZmVuZGluZ1BpZWNlcykpIHtcbiAgICAgICAgICAgIHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzICo9IDI7XG4gICAgICAgIH1cbiAgICAgICAgd29yc3RDYXNlQXR0YWNrZXJMb3NzZXMgPSBNYXRoLmZsb29yKHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzKTtcbiAgICAgICAgaWYgKHRoaXMucGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uKSkge1xuICAgICAgICAgICAgd29yc3RDYXNlQXR0YWNrZXJMb3NzZXMgLT0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGRlZmVuZGluZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICB3b3JzdENhc2VBdHRhY2tlckxvc3NlcyArPSAyO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzQW1idXNoID0gZGVmZW5kZXJDYW5Db3VudGVyYXR0YWNrQW1idXNoID8gd29yc3RDYXNlQXR0YWNrZXJMb3NzZXMgOiAwO1xuXG4gICAgICAgIGNvbnN0IGhlbHBpbmdGYWN0aW9uSWQgPSBlbmxpc3RpbmdHZXJtYW5zID8gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgOiBudWxsO1xuICAgICAgICBjb25zdCBvcmRlcmVkQXR0YWNraW5nUGllY2VzID0gTG9zc2VzLm9yZGVyUGllY2VzRm9yUmVtb3ZhbChzdGF0ZSwgYXR0YWNraW5nUGllY2VzLCBmYWxzZSwgaGVscGluZ0ZhY3Rpb25JZCk7XG4gICAgICAgIGNvbnN0IHdvcnN0Q2FzZUNvdW50ZXJhdHRhY2tSZXN1bHRzID0gdGhpcy5jYWxjdWxhdGVNb3N0QXR0YWNrUmVzdWx0cyhvcmRlcmVkQXR0YWNraW5nUGllY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yc3RDYXNlQXR0YWNrZXJMb3NzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSk7XG4gICAgICAgIGNvbnN0IHdvcnN0Q2FzZUNvdW50ZXJhdHRhY2tSZXN1bHRzV2l0aEFtYnVzaCA9IHRoaXMuY2FsY3VsYXRlTW9zdEF0dGFja1Jlc3VsdHMob3JkZXJlZEF0dGFja2luZ1BpZWNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JzdENhc2VBdHRhY2tlckxvc3Nlc0FtYnVzaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSk7XG5cbiAgICAgICAgY29uc3Qgd29yc3RDYXNlRGVmZW5kZXJMb3NzZXMgPSBfLm1pbihcbiAgICAgICAgICAgIFsoZGVmZW5kZXJDYW5SZXRyZWF0ID8gd29yc3RDYXNlUmV0cmVhdERlZmVuZGVyUmVzdWx0cy50YXJnZXRzLmxlbmd0aCA6IHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0cy50YXJnZXRzLmxlbmd0aCksIHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0cy50YXJnZXRzLmxlbmd0aCwgZGVmZW5kaW5nUGllY2VzLmxlbmd0aF0pO1xuICAgICAgICBjb25zdCB3b3JzdENhc2VEZWZlbmRlckxvc3Nlc0FtYnVzaCA9IHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0c1dpdGhBbWJ1c2gudGFyZ2V0cy5sZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBCYXR0bGVSZXN1bHRzKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgIGNvc3Q6IChyZWdpb24uZGV2YXN0YXRlZCgpID8gMiA6IDEpICogKGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TID8gMiA6IDEpLFxuXG4gICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbjogYXR0YWNraW5nRmFjdGlvbixcbiAgICAgICAgICAgICAgICBkZWZlbmRpbmdGYWN0aW9uOiBkZWZlbmRpbmdGYWN0aW9uLFxuXG4gICAgICAgICAgICAgICAgYXR0YWNraW5nUGllY2VzOiBhdHRhY2tpbmdQaWVjZXMsXG4gICAgICAgICAgICAgICAgZGVmZW5kaW5nUGllY2VzOiBkZWZlbmRpbmdQaWVjZXMsXG5cbiAgICAgICAgICAgICAgICBjYW5BbWJ1c2g6IGNhbkFtYnVzaCxcbiAgICAgICAgICAgICAgICBlbmxpc3RpbmdHZXJtYW5zOiBlbmxpc3RpbmdHZXJtYW5zLFxuICAgICAgICAgICAgICAgIGRlZmVuZGVyQ2FuUmV0cmVhdDogZGVmZW5kZXJDYW5SZXRyZWF0LFxuICAgICAgICAgICAgICAgIGRlZmVuZGVyQ2FuR3VhcmFudGVlU2FmZVJldHJlYXQ6IGRlZmVuZGVyQ2FuR3VhcmFudGVlU2FmZVJldHJlYXQsXG4gICAgICAgICAgICAgICAgZGVmZW5kZXJDYW5Db3VudGVyYXR0YWNrOiB7bm9ybWFsOiBkZWZlbmRlckNhbkNvdW50ZXJhdHRhY2ssIGFtYnVzaDogZGVmZW5kZXJDYW5Db3VudGVyYXR0YWNrQW1idXNofSxcblxuICAgICAgICAgICAgICAgIGRlZmVuZGVyTG9zc2VzOiB7bm9ybWFsOiBub1JldHJlYXREZWZlbmRlckxvc3NlcywgcmV0cmVhdDogcmV0cmVhdERlZmVuZGVyTG9zc2VzfSxcblxuICAgICAgICAgICAgICAgIHdvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHM6IHdvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHMsXG4gICAgICAgICAgICAgICAgd29yc3RDYXNlTm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbDogd29yc3RDYXNlTm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBhbWJ1c2g6IHdvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0c1dpdGhBbWJ1c2hcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHdvcnN0Q2FzZURlZmVuZGVyTG9zc2VzOiB7bm9ybWFsOiB3b3JzdENhc2VEZWZlbmRlckxvc3NlcywgYW1idXNoOiB3b3JzdENhc2VEZWZlbmRlckxvc3Nlc0FtYnVzaH0sXG4gICAgICAgICAgICAgICAgd29yc3RDYXNlQXR0YWNrZXJMb3NzZXM6IHtub3JtYWw6IHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLCBhbWJ1c2g6IHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzQW1idXNofSxcbiAgICAgICAgICAgICAgICB3b3JzdENhc2VDb3VudGVyYXR0YWNrUmVzdWx0czoge1xuICAgICAgICAgICAgICAgICAgICBub3JtYWw6IHdvcnN0Q2FzZUNvdW50ZXJhdHRhY2tSZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBhbWJ1c2g6IHdvcnN0Q2FzZUNvdW50ZXJhdHRhY2tSZXN1bHRzV2l0aEFtYnVzaFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBkb0V4ZWN1dGUoc3RhdGUsIGFyZ3MpIHtcbiAgICAgICAgY29uc3QgYmF0dGxlUmVzdWx0cyA9IGFyZ3MuYmF0dGxlUmVzdWx0cyB8fCBhcmdzO1xuICAgICAgICBjb25zdCByZWdpb24gPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbjtcbiAgICAgICAgY29uc3QgYXR0YWNraW5nRmFjdGlvbiA9IGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgZGVmZW5kaW5nRmFjdGlvbiA9IGJhdHRsZVJlc3VsdHMuZGVmZW5kaW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgYXR0YWNraW5nUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvblthdHRhY2tpbmdGYWN0aW9uLmlkXTtcbiAgICAgICAgY29uc3QgZGVmZW5kaW5nUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltkZWZlbmRpbmdGYWN0aW9uLmlkXTtcbiAgICAgICAgY29uc3QgZW5saXN0aW5nR2VybWFucyA9IGJhdHRsZVJlc3VsdHMud2lsbEVubGlzdEdlcm1hbnM7XG4gICAgICAgIGNvbnN0IGFtYnVzaCA9IGJhdHRsZVJlc3VsdHMud2lsbEFtYnVzaDtcblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb24ubmFtZSArICcgaXMgYmF0dGxpbmcgJyArIGRlZmVuZGluZ0ZhY3Rpb24ubmFtZSArICcgaW4gcmVnaW9uICcgKyByZWdpb24ubmFtZSArIChlbmxpc3RpbmdHZXJtYW5zID8gJyB3aXRoIEdlcm1hbiBoZWxwJyA6ICcnICkpO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEJhdHRsZWdyb3VuZDogKioqJyk7XG4gICAgICAgIHJlZ2lvbi5sb2dTdGF0ZSgpO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEJhdHRsZTogKioqJyk7XG4gICAgICAgIGlmIChhbWJ1c2gpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGF0dGFja2luZ0ZhY3Rpb24ubmFtZSArICcgaXMgYW1idXNoaW5nIScpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGF0dGFja2luZ1BpZWNlcyA9IEJhdHRsZS5nZXRBdHRhY2tpbmdQaWVjZXMoYmF0dGxlUmVzdWx0cyk7XG4gICAgICAgIHRoaXMuaGFuZGxlR2VybWFuaWNIb3JzZShzdGF0ZSwgYmF0dGxlUmVzdWx0cywgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKTtcblxuICAgICAgICBpZiAoIWJhdHRsZVJlc3VsdHMuaGFuZGxlZEJhbGVhcmljU2xpbmdlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlQmFsZWFyaWNTbGluZ2VycyhzdGF0ZSwgYmF0dGxlUmVzdWx0cywgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKTtcbiAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMuaGFuZGxlZEJhbGVhcmljU2xpbmdlcnMgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLk1BU1NFRF9HQUxMSUNfQVJDSEVSUykpIHtcbiAgICAgICAgICAgIGlmICghYmF0dGxlUmVzdWx0cy5oYW5kbGVkTWFzc2VkR2FsbGljQXJjaGVycykge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTWFzc2VkR2FsbGljQXJjaGVycyhzdGF0ZSwgYmF0dGxlUmVzdWx0cywgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKTtcbiAgICAgICAgICAgICAgICBiYXR0bGVSZXN1bHRzLmhhbmRsZWRNYXNzZWRHYWxsaWNBcmNoZXJzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdlIG1heSBoYXZlIHJlbW92ZWQgc29tZSBhdHRhY2tlcnMgb3IgZGVmZW5kZXJzIGluIGJhbGVhcmljIHNsaW5nZXJzIG9yIG1hc3NlZCBnYWxsaWMgYXJjaGVyc1xuICAgICAgICBhdHRhY2tpbmdQaWVjZXMgPSBCYXR0bGUuZ2V0QXR0YWNraW5nUGllY2VzKGJhdHRsZVJlc3VsdHMpO1xuXG4gICAgICAgIGlmICghYmF0dGxlUmVzdWx0cy5jYWxjdWxhdGVkRGVmZW5kZXJSZXN1bHRzKSB7XG4gICAgICAgICAgICBjb25zdCBkZWZlbmRpbmdQaWVjZXMgPSBCYXR0bGUuZ2V0RGVmZW5kaW5nUGllY2VzKGJhdHRsZVJlc3VsdHMpO1xuXG4gICAgICAgICAgICBsZXQgdW5tb2RpZmllZERlZmVuZGVyTG9zc2VzID0gTG9zc2VzLmNhbGN1bGF0ZVVubW9kaWZpZWRMb3NzZXMoc3RhdGUsIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2luZ1BpZWNlcywgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0cy53aWxsQXBwbHlHZXJtYW5pY0hvcnNlKTtcbiAgICAgICAgICAgIGlmIChhdHRhY2tpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkFSVkVSTkkgJiYgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KFxuICAgICAgICAgICAgICAgICAgICBDYXBhYmlsaXR5SURzLk1BU1NFRF9HQUxMSUNfQVJDSEVSUykpIHtcbiAgICAgICAgICAgICAgICB1bm1vZGlmaWVkRGVmZW5kZXJMb3NzZXMgPSBNYXRoLm1heCgwLCB1bm1vZGlmaWVkRGVmZW5kZXJMb3NzZXMgLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5vIFJldHJlYXRcbiAgICAgICAgICAgIGxldCBub1JldHJlYXREZWZlbmRlckxvc3NlcyA9IHVubW9kaWZpZWREZWZlbmRlckxvc3NlcztcbiAgICAgICAgICAgIGlmICh0aGlzLmRlZmVuZGVySGFzQ2l0YWRlbE9yRm9ydChzdGF0ZSwgZGVmZW5kaW5nUGllY2VzLCBzdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5CQUxMSVNUQUUsIGF0dGFja2luZ0ZhY3Rpb24uaWQpKSkge1xuICAgICAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzIC89IDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChiYXR0bGVSZXN1bHRzLndpbGxBcHBseUdlcm1hbmljSG9yc2UgJiYgYXR0YWNraW5nRmFjdGlvbi5pZCAhPT0gRmFjdGlvbklEcy5ST01BTlMgJiYgc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShcbiAgICAgICAgICAgICAgICAgICAgQ2FwYWJpbGl0eUlEcy5HRVJNQU5JQ19IT1JTRSwgYXR0YWNraW5nRmFjdGlvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICBub1JldHJlYXREZWZlbmRlckxvc3NlcyAqPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9SZXRyZWF0RGVmZW5kZXJMb3NzZXMgPSBNYXRoLmZsb29yKG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMucGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBkZWZlbmRpbmdGYWN0aW9uKSkge1xuICAgICAgICAgICAgICAgIG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzIC09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgbm9SZXRyZWF0RGVmZW5kZXJMb3NzZXMgKz0gMjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGRlZmVuZGVyUmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICBsb3NzZXM6IG5vUmV0cmVhdERlZmVuZGVyTG9zc2VzLFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFtdLFxuICAgICAgICAgICAgICAgIHJlbWFpbmluZzogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICghYW1idXNoICYmIHRoaXMuY2FuUmV0cmVhdChhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uLCByZWdpb24pKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJldHJlYXREZWZlbmRlckxvc3NlcyA9IE1hdGguZmxvb3IodW5tb2RpZmllZERlZmVuZGVyTG9zc2VzIC8gMik7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBkZWZlbmRpbmdGYWN0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICByZXRyZWF0RGVmZW5kZXJMb3NzZXMgLT0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICByZXRyZWF0RGVmZW5kZXJMb3NzZXMgKz0gMjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXRyZWF0RGVjbGFyYXRpb24gPSB0aGlzLmdldFJldHJlYXREZWNsYXJhdGlvbihzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9SZXRyZWF0RGVmZW5kZXJMb3NzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmVhdERlZmVuZGVyTG9zc2VzKTtcbiAgICAgICAgICAgICAgICBpZiAocmV0cmVhdERlY2xhcmF0aW9uLndpbGxSZXRyZWF0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRlZmVuZGluZ0ZhY3Rpb24ubmFtZSArICcgaXMgcmV0cmVhdGluZyEnKTtcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0cy53aWxsUmV0cmVhdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVuZGVyUmVzdWx0cy5sb3NzZXMgPSByZXRyZWF0RGVmZW5kZXJMb3NzZXM7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVuZGVyUmVzdWx0cy5hZ3JlZWluZ0ZhY3Rpb25JZCA9IHJldHJlYXREZWNsYXJhdGlvbi5hZ3JlZWluZ0ZhY3Rpb25JZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMuY2FsY3VsYXRlZERlZmVuZGVyUmVzdWx0cyA9IGRlZmVuZGVyUmVzdWx0c1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJhdHRsZVJlc3VsdHMud2lsbEJlc2llZ2UgJiYgIWJhdHRsZVJlc3VsdHMuYmVzaWVnZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlVG9SZW1vdmUgPSBfLmZpbmQoYmF0dGxlUmVzdWx0cy5kZWZlbmRpbmdQaWVjZXMsIHt0eXBlOiAnY2l0YWRlbCd9KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZmluZChiYXR0bGVSZXN1bHRzLmRlZmVuZGluZ1BpZWNlcywge3R5cGU6ICdhbGxpZWR0cmliZSd9KTtcbiAgICAgICAgICAgIGlmIChwaWVjZVRvUmVtb3ZlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKiBBdHRhY2tlciBpcyBCZXNpZWdpbmcgKioqJyk7XG4gICAgICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGRlZmVuZGluZ0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogW3BpZWNlVG9SZW1vdmVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiYXR0bGVSZXN1bHRzLmJlc2llZ2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghYmF0dGxlUmVzdWx0cy5jb21taXR0ZWREZWZlbmRlclJlc3VsdHMpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTG9zc2VzKHN0YXRlLCBiYXR0bGVSZXN1bHRzLCBiYXR0bGVSZXN1bHRzLmNhbGN1bGF0ZWREZWZlbmRlclJlc3VsdHMsIGZhbHNlKTtcbiAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMuY29tbWl0dGVkRGVmZW5kZXJSZXN1bHRzID0gYmF0dGxlUmVzdWx0cy5jYWxjdWxhdGVkRGVmZW5kZXJSZXN1bHRzO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0cy5jb21taXR0ZWREZWZlbmRlclJlc3VsdHMuY291bnRlcmF0dGFja1Bvc3NpYmxlICYmICFiYXR0bGVSZXN1bHRzLndpbGxSZXRyZWF0KSB7XG4gICAgICAgICAgICBjb25zdCBkZWZlbmRpbmdQaWVjZXMgPSByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbZGVmZW5kaW5nRmFjdGlvbi5pZF07XG4gICAgICAgICAgICBsZXQgYXR0YWNrZXJMb3NzZXMgPSBMb3NzZXMuY2FsY3VsYXRlVW5tb2RpZmllZExvc3NlcyhzdGF0ZSwgZGVmZW5kaW5nRmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMuY29tbWl0dGVkRGVmZW5kZXJSZXN1bHRzLnJlbWFpbmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIGJhdHRsZVJlc3VsdHMud2lsbEFwcGx5R2VybWFuaWNIb3JzZSk7XG4gICAgICAgICAgICBpZiAoYmF0dGxlUmVzdWx0cy53aWxsQXBwbHlHZXJtYW5pY0hvcnNlICYmIGRlZmVuZGluZ0ZhY3Rpb24uaWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TICYmXG4gICAgICAgICAgICAgICAgc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLkdFUk1BTklDX0hPUlNFLCBkZWZlbmRpbmdGYWN0aW9uLmlkKSAmJlxuICAgICAgICAgICAgICAgICF0aGlzLmRlZmVuZGVySGFzQ2l0YWRlbE9yRm9ydChzdGF0ZSwgZGVmZW5kaW5nUGllY2VzKSkge1xuICAgICAgICAgICAgICAgIGF0dGFja2VyTG9zc2VzICo9IDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdHRhY2tlckxvc3NlcyA9IE1hdGguZmxvb3IoYXR0YWNrZXJMb3NzZXMpO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uKSkge1xuICAgICAgICAgICAgICAgIGF0dGFja2VyTG9zc2VzIC09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJ0eUhhc1Vuc2hhZGVkTGVnaW9YKHN0YXRlLCByZWdpb24sIGRlZmVuZGluZ0ZhY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgYXR0YWNrZXJMb3NzZXMgKz0gMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhdHRhY2tlckxvc3NlcyA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudGVyYXR0YWNrUmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgbG9zc2VzOiBhdHRhY2tlckxvc3NlcyxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogW10sXG4gICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZzogW11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTG9zc2VzKHN0YXRlLCBiYXR0bGVSZXN1bHRzLCBjb3VudGVyYXR0YWNrUmVzdWx0cywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0cy53aWxsUmV0cmVhdCAmJiAhYmF0dGxlUmVzdWx0cy5yZXRyZWF0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmV0cmVhdChzdGF0ZSwgYmF0dGxlUmVzdWx0cywgYmF0dGxlUmVzdWx0cy5jb21taXR0ZWREZWZlbmRlclJlc3VsdHMpO1xuICAgICAgICAgICAgYmF0dGxlUmVzdWx0cy5yZXRyZWF0ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFiYXR0bGVSZXN1bHRzLndpbGxSZXRyZWF0KSB7XG4gICAgICAgICAgICBSZXZlYWxQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogYXR0YWNraW5nRmFjdGlvbi5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZH0pO1xuICAgICAgICAgICAgUmV2ZWFsUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IGRlZmVuZGluZ0ZhY3Rpb24uaWQsIHJlZ2lvbklkOiByZWdpb24uaWR9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhbWJ1c2ggJiYgc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLkJBTExJU1RBRSwgYXR0YWNraW5nRmFjdGlvbi5pZCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNpdGFkZWxPckZvcnQgPSBfLmZpbmQocmVnaW9uLmdldFBpZWNlc0ZvckZhY3Rpb24oZGVmZW5kaW5nRmFjdGlvbi5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwaWVjZSkgPT4gcGllY2UudHlwZSA9PT0gJ2NpdGFkZWwnIHx8IHBpZWNlLnR5cGUgPT09ICdmb3J0Jyk7XG4gICAgICAgICAgICBpZiAoY2l0YWRlbE9yRm9ydCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcqKiogQXR0YWNrZXIgaXMgdXNpbmcgQmFsbGlzdGFlICoqKicpO1xuICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBkZWZlbmRpbmdGYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IFtjaXRhZGVsT3JGb3J0XVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJhdHRsZVJlc3VsdHMuY29tcGxldGUgPSB0cnVlO1xuICAgICAgICBjb25zb2xlLmxvZygnQmF0dGxlIGNvbXBsZXRlJyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEF0dGFja2luZ1BpZWNlcyhiYXR0bGVSZXN1bHRzKSB7XG4gICAgICAgIGxldCBwaWVjZXMgPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbi5pZCk7XG4gICAgICAgIGlmKGJhdHRsZVJlc3VsdHMud2lsbEVubGlzdEdlcm1hbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGdlcm1hbnMgPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTKTtcbiAgICAgICAgICAgIHBpZWNlcyA9IF8uY29uY2F0KHBpZWNlcyxnZXJtYW5zKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBkaXZpY2lhY3VzIHRvb1xuXG4gICAgICAgIHJldHVybiBwaWVjZXM7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldERlZmVuZGluZ1BpZWNlcyhiYXR0bGVSZXN1bHRzKSB7XG4gICAgICAgIGxldCBwaWVjZXMgPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGJhdHRsZVJlc3VsdHMuZGVmZW5kaW5nRmFjdGlvbi5pZCk7XG4gICAgICAgIC8vIGRpdmljaWFjdXMgdG9vXG5cbiAgICAgICAgcmV0dXJuIHBpZWNlcztcbiAgICB9XG5cbiAgICBzdGF0aWMgcGFydHlIYXNVbnNoYWRlZExlZ2lvWChzdGF0ZSwgcmVnaW9uLCBmYWN0aW9uKSB7XG4gICAgICAgIGlmIChmYWN0aW9uLmlkICE9PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykgfHwgcmVnaW9uLmdldExlZ2lvbnMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5MRUdJT19YKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaGFuZGxlR2VybWFuaWNIb3JzZShzdGF0ZSwgYmF0dGxlUmVzdWx0cywgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKSB7XG5cbiAgICAgICAgaWYgKChzdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoXG4gICAgICAgICAgICAgICAgQ2FwYWJpbGl0eUlEcy5HRVJNQU5JQ19IT1JTRSkgJiYgZGVmZW5kaW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpIHx8IHN0YXRlLmhhc1NoYWRlZENhcGFiaWxpdHkoXG4gICAgICAgICAgICAgICAgQ2FwYWJpbGl0eUlEcy5HRVJNQU5JQ19IT1JTRSwgZGVmZW5kaW5nRmFjdGlvbi5pZCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nR2VybWFuaWNIb3JzZURlY2xhcmF0aW9uID0gXy5maW5kKHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuZ2V0Q3VycmVudEludGVyYWN0aW9ucygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT4gaW50ZXJhY3Rpb24udHlwZSA9PT0gJ0dlcm1hbmljSG9yc2VEZWNsYXJhdGlvbicgJiYgaW50ZXJhY3Rpb24ucmVnaW9uSWQgPT09IHJlZ2lvbi5pZCAmJiBpbnRlcmFjdGlvbi5yZXNwb25kaW5nRmFjdGlvbklkID09PSBkZWZlbmRpbmdGYWN0aW9uLmlkKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0dlcm1hbmljSG9yc2VEZWNsYXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMud2lsbEFwcGx5R2VybWFuaWNIb3JzZSA9IGV4aXN0aW5nR2VybWFuaWNIb3JzZURlY2xhcmF0aW9uLnN0YXR1cyA9PT0gJ2FncmVlZCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBiYXR0bGVSZXN1bHRzLndpbGxBcHBseUdlcm1hbmljSG9yc2UgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2RlZmVuZGluZ0ZhY3Rpb24uaWRdLndpbGxBcHBseUdlcm1hbmljSG9yc2UoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGhhbmRsZUJhbGVhcmljU2xpbmdlcnMoc3RhdGUsIGJhdHRsZVJlc3VsdHMsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbiwgZGVmZW5kaW5nRmFjdGlvbikge1xuXG4gICAgICAgIGlmIChzdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5CQUxFQVJJQ19TTElOR0VSUykgJiYgYXR0YWNraW5nRmFjdGlvbi5pZCAhPT0gRmFjdGlvbklEcy5ST01BTlMpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQmFsZWFyaWNTbGluZ2Vyc0RlY2xhcmF0aW9uID0gXy5maW5kKFxuICAgICAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuZ2V0Q3VycmVudEludGVyYWN0aW9ucygpLFxuICAgICAgICAgICAgICAgIGludGVyYWN0aW9uID0+IGludGVyYWN0aW9uLnR5cGUgPT09ICdCYWxlYXJpY1NsaW5nZXJzRGVjbGFyYXRpb24nICYmIGludGVyYWN0aW9uLnJlZ2lvbklkID09PSByZWdpb24uaWQgJiYgaW50ZXJhY3Rpb24ucmVzcG9uZGluZ0ZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nQmFsZWFyaWNTbGluZ2Vyc0RlY2xhcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0cy53aWxsQXBwbHlCYWxlYXJpY1NsaW5nZXJzID0gZXhpc3RpbmdCYWxlYXJpY1NsaW5nZXJzRGVjbGFyYXRpb24uc3RhdHVzID09PSAnYWdyZWVkJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMud2lsbEFwcGx5QmFsZWFyaWNTbGluZ2VycyA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5ST01BTlNdLndpbGxBcHBseUJhbGVhcmljU2xpbmdlcnMoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIGRlZmVuZGluZ0ZhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJhdHRsZVJlc3VsdHMud2lsbEFwcGx5QmFsZWFyaWNTbGluZ2Vycykge1xuICAgICAgICAgICAgY29uc3QgYXR0YWNrZXJMb3NzZXMgPSBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgIExvc3Nlcy5jYWxjdWxhdGVVbm1vZGlmaWVkTG9zc2VzKHN0YXRlLCBkZWZlbmRpbmdGYWN0aW9uLCByZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgYmF0dGxlUmVzdWx0cy53aWxsQXBwbHlHZXJtYW5pY0hvcnNlKSk7XG4gICAgICAgICAgICBpZiAoYXR0YWNrZXJMb3NzZXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdMb3NzZXMgPSBfLmZpbmQoc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5nZXRDdXJyZW50SW50ZXJhY3Rpb25zKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT4gaW50ZXJhY3Rpb24udHlwZSA9PT0gJ0xvc3NlcycgJiYgaW50ZXJhY3Rpb24ucmVnaW9uSWQgPT09IGJhdHRsZVJlc3VsdHMucmVnaW9uLmlkICYmIGludGVyYWN0aW9uLnJlc3BvbmRpbmdGYWN0aW9uSWQgPT09IGF0dGFja2luZ0ZhY3Rpb24uaWQgJiYgaW50ZXJhY3Rpb24uYmFsZWFyaWNTbGluZ2Vycyk7XG4gICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZ0xvc3Nlcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIFJvbWFucyBhcmUgdXNpbmcgdGhlaXIgQmFsZWFyaWMgU2xpbmdlcnMgKioqICcpO1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2F0dGFja2luZ0ZhY3Rpb24uaWRdLnRha2VMb3NzZXMoc3RhdGUsIGJhdHRsZVJlc3VsdHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bG9zc2VzOiBhdHRhY2tlckxvc3Nlc30sIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgc2ltdWxhdGVCYWxlYXJpY1NsaW5nZXJzKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2VyUGllY2VzLCBkZWZlbmRpbmdGYWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IGF0dGFja2VyTG9zc2VzID0gTWF0aC5mbG9vcihMb3NzZXMuY2FsY3VsYXRlVW5tb2RpZmllZExvc3NlcyhzdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuR0VSTUFOSUNfSE9SU0UpKSk7XG5cbiAgICAgICAgLy8gQXJ2ZXJuaSBjYW4gdXNlIHRoZSBlbGl0ZSB0byBzb2FrIHVwIHRoZSBsb3NzZXMgaWYgbHVja3lcbiAgICAgICAgaWYoYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5BUlZFUk5JICYmIF8uZmluZChhdHRhY2tlclBpZWNlcywge3R5cGUgOiAnbGVhZGVyJ30pICYmIHN0YXRlLmhhc1NoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5WRVJDSU5HRVRPUklYU19FTElURSwgYXR0YWNraW5nRmFjdGlvbi5pZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBhdHRhY2tlclBpZWNlcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfLmRyb3AoTG9zc2VzLm9yZGVyUGllY2VzUm9sbHNGaXJzdChhdHRhY2tlclBpZWNlcywgZmFsc2UpLCBhdHRhY2tlckxvc3Nlcyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGhhbmRsZU1hc3NlZEdhbGxpY0FyY2hlcnMoc3RhdGUsIGJhdHRsZVJlc3VsdHMsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbiwgZGVmZW5kaW5nRmFjdGlvbikge1xuICAgICAgICBpZigoYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5BUlZFUk5JIHx8IGRlZmVuZGluZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQVJWRVJOSSkgJiYgcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldEZhY3Rpb24gPSBhdHRhY2tpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkFSVkVSTkkgPyBkZWZlbmRpbmdGYWN0aW9uIDogYXR0YWNraW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdMb3NzZXMgPSBfLmZpbmQoc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5nZXRDdXJyZW50SW50ZXJhY3Rpb25zKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGlvbiA9PiBpbnRlcmFjdGlvbi50eXBlID09PSAnTG9zc2VzJyAmJiBpbnRlcmFjdGlvbi5yZWdpb25JZCA9PT0gYmF0dGxlUmVzdWx0cy5yZWdpb24uaWQgJiYgaW50ZXJhY3Rpb24ucmVzcG9uZGluZ0ZhY3Rpb25JZCA9PT0gdGFyZ2V0RmFjdGlvbi5pZCAmJiBpbnRlcmFjdGlvbi5tYXNzZWRHYWxsaWNBcmNoZXJzKTtcblxuICAgICAgICBpZiAoIWV4aXN0aW5nTG9zc2VzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEFydmVybmkgYXJlIHVzaW5nIHRoZWlyIE1hc3NlZCBHYWxsaWMgQXJjaGVycyAqKiogJyk7XG4gICAgICAgICAgICBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW3RhcmdldEZhY3Rpb24uaWRdLnRha2VMb3NzZXMoc3RhdGUsIGJhdHRsZVJlc3VsdHMsIHtsb3NzZXM6IDF9LCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgc2ltdWxhdGVNYXNzZWRHYWxsaWNBcmNoZXJzKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2luZ1BpZWNlcywgZGVmZW5kaW5nRmFjdGlvbiwgZGVmZW5kaW5nUGllY2VzLCBlbmxpc3RpbmdHZXJtYW5zKSB7XG4gICAgICAgIGxldCB1cGRhdGVkQXR0YWNraW5nUGllY2VzID0gYXR0YWNraW5nUGllY2VzO1xuICAgICAgICBsZXQgdXBkYXRlZERlZmVuZGluZ1BpZWNlcyA9IGRlZmVuZGluZ1BpZWNlcztcbiAgICAgICAgaWYoYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5BUlZFUk5JICYmIChfLmNvdW50QnkoYXR0YWNraW5nUGllY2VzLCAndHlwZScpLndhcmJhbmQgfHwgMCkgPj02ICkge1xuICAgICAgICAgICAgY29uc3Qgcm9sbEZpcnN0T3JkZXJlZFBpZWNlcyA9IExvc3Nlcy5vcmRlclBpZWNlc1JvbGxzRmlyc3QoZGVmZW5kaW5nUGllY2VzLCBmYWxzZSk7XG4gICAgICAgICAgICBjb25zdCBmaXJzdFBpZWNlID0gXy5maXJzdChyb2xsRmlyc3RPcmRlcmVkUGllY2VzKTtcbiAgICAgICAgICAgIGlmKGZpcnN0UGllY2UgJiYgIWZpcnN0UGllY2UuY2FuUm9sbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdlYWtlc3RPcmRlcmVkUGllY2VzID0gTG9zc2VzLm9yZGVyUGllY2VzRm9yUmVtb3ZhbChzdGF0ZSwgZGVmZW5kaW5nUGllY2VzLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlZERlZmVuZGluZ1BpZWNlcyA9IF8uZHJvcCh3ZWFrZXN0T3JkZXJlZFBpZWNlcywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihkZWZlbmRpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkFSVkVSTkkgJiYgKF8uY291bnRCeShkZWZlbmRpbmdQaWVjZXMsICd0eXBlJykud2FyYmFuZCB8fCAwKSA+PTYpIHtcbiAgICAgICAgICAgIGNvbnN0IGhlbHBpbmdGYWN0aW9uSWQgPSBlbmxpc3RpbmdHZXJtYW5zID8gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgOiBudWxsO1xuICAgICAgICAgICAgdXBkYXRlZEF0dGFja2luZ1BpZWNlcyA9IF8uZHJvcChMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBhdHRhY2tpbmdQaWVjZXMsIGZhbHNlLCBoZWxwaW5nRmFjdGlvbklkKSwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgdXBkYXRlZEF0dGFja2luZ1BpZWNlcywgdXBkYXRlZERlZmVuZGluZ1BpZWNlcyB9O1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRSZXRyZWF0RGVjbGFyYXRpb24oc3RhdGUsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbiwgZGVmZW5kaW5nRmFjdGlvbiwgbm9SZXRyZWF0TG9zc2VzLCByZXRyZWF0TG9zc2VzKSB7XG5cbiAgICAgICAgY29uc3QgZXhpc3RpbmdSZXRyZWF0RGVjbGFyYXRpb24gPSBfLmZpbmQoc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5nZXRDdXJyZW50SW50ZXJhY3Rpb25zKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyYWN0aW9uID0+IGludGVyYWN0aW9uLnR5cGUgPT09ICdSZXRyZWF0RGVjbGFyYXRpb24nICYmIGludGVyYWN0aW9uLnJlZ2lvbklkID09PSByZWdpb24uaWQgJiYgaW50ZXJhY3Rpb24ucmVzcG9uZGluZ0ZhY3Rpb25JZCA9PT0gZGVmZW5kaW5nRmFjdGlvbi5pZCk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUmV0cmVhdERlY2xhcmF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4ge3dpbGxSZXRyZWF0OiBleGlzdGluZ1JldHJlYXREZWNsYXJhdGlvbi5zdGF0dXMgPT09ICdhZ3JlZWQnfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bZGVmZW5kaW5nRmFjdGlvbi5pZF0ud2lsbFJldHJlYXQoc3RhdGUsIHJlZ2lvbiwgYXR0YWNraW5nRmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9SZXRyZWF0TG9zc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyZWF0TG9zc2VzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaGFuZGxlTG9zc2VzKHN0YXRlLCBiYXR0bGVSZXN1bHRzLCBhdHRhY2tSZXN1bHRzLCBjb3VudGVyYXR0YWNrKSB7XG4gICAgICAgIGNvbnN0IGRlZmVuZGVyID0gY291bnRlcmF0dGFjayA/IGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbiA6IGJhdHRsZVJlc3VsdHMuZGVmZW5kaW5nRmFjdGlvbjtcblxuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0cy5yZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihkZWZlbmRlci5pZCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBleGlzdGluZ0xvc3NlcyA9IF8uZmluZChzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmdldEN1cnJlbnRJbnRlcmFjdGlvbnMoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT4gaW50ZXJhY3Rpb24udHlwZSA9PT0gJ0xvc3NlcycgJiYgaW50ZXJhY3Rpb24ucmVnaW9uSWQgPT09IGJhdHRsZVJlc3VsdHMucmVnaW9uLmlkICYmIGludGVyYWN0aW9uLnJlc3BvbmRpbmdGYWN0aW9uSWQgPT09IGRlZmVuZGVyLmlkKTtcbiAgICAgICAgaWYgKGV4aXN0aW5nTG9zc2VzKSB7XG4gICAgICAgICAgICBhdHRhY2tSZXN1bHRzLnJlbW92ZWQgPSBleGlzdGluZ0xvc3Nlcy5yZW1vdmVkO1xuICAgICAgICAgICAgYXR0YWNrUmVzdWx0cy5yZW1haW5pbmcgPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGRlZmVuZGVyLmlkKTtcbiAgICAgICAgICAgIGF0dGFja1Jlc3VsdHMuY291bnRlcmF0dGFja1Bvc3NpYmxlID0gIWNvdW50ZXJhdHRhY2sgJiYgKCFiYXR0bGVSZXN1bHRzLndpbGxBbWJ1c2ggfHwgZXhpc3RpbmdMb3NzZXMuY2Flc2FyQ2FuQ291bnRlcmF0dGFjayk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2RlZmVuZGVyLmlkXS50YWtlTG9zc2VzKHN0YXRlLCBiYXR0bGVSZXN1bHRzLCBhdHRhY2tSZXN1bHRzLCBjb3VudGVyYXR0YWNrKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGhhbmRsZVJldHJlYXQoc3RhdGUsIGJhdHRsZVJlc3VsdHMsIGF0dGFja1Jlc3VsdHMpIHtcbiAgICAgICAgY29uc3QgZGVmZW5kZXIgPSBiYXR0bGVSZXN1bHRzLmRlZmVuZGluZ0ZhY3Rpb247XG5cbiAgICAgICAgY29uc3QgZXhpc3RpbmdSZXRyZWF0ID0gXy5maW5kKHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuZ2V0Q3VycmVudEludGVyYWN0aW9ucygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT4gaW50ZXJhY3Rpb24udHlwZSA9PT0gJ1JldHJlYXQnICYmIGludGVyYWN0aW9uLnJlZ2lvbklkID09PSBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5pZCAmJiBpbnRlcmFjdGlvbi5yZXNwb25kaW5nRmFjdGlvbklkID09PSBkZWZlbmRlci5pZCk7XG4gICAgICAgIGlmICghZXhpc3RpbmdSZXRyZWF0KSB7XG4gICAgICAgICAgICBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2RlZmVuZGVyLmlkXS5yZXRyZWF0RnJvbUJhdHRsZShzdGF0ZSwgYmF0dGxlUmVzdWx0cywgYXR0YWNrUmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgY2FuUmV0cmVhdChhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uLCByZWdpb24pIHtcblxuICAgICAgICAvLyBHZXJtYW5zIGFsd2F5cyBhbWJ1c2hcbiAgICAgICAgaWYgKGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXJtYW5zIG5ldmVyIHJldHJlYXRcbiAgICAgICAgaWYgKGRlZmVuZGluZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYXZlIHRvIGhhdmUgbW9iaWxlIHBpZWNlcyB0byByZXRyZWF0XG4gICAgICAgIGNvbnN0IG1vYmlsZURlZmVuZGVycyA9IF8uZmlsdGVyKFxuICAgICAgICAgICAgcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2RlZmVuZGluZ0ZhY3Rpb24uaWRdLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UuaXNNb2JpbGU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAobW9iaWxlRGVmZW5kZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGF2ZSB0byBoYXZlIGEgbm9uLWdlcm1hbiBhbmQgbm9uLWNvbnRyb2xsZWQgYWRqYWNlbnQgcmVnaW9uLCBvciBiZSBkZWZlbmRpbmcgYWdhaW5zdCByb21hbnNcbiAgICAgICAgY29uc3QgYWRqYWNlbnROb25HZXJtYW5pY0NvbnRyb2xsZWRSZWdpb24gPSBfLmZpbmQoXG4gICAgICAgICAgICByZWdpb24uYWRqYWNlbnQsIGZ1bmN0aW9uIChhZGphY2VudFJlZ2lvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpICYmIGFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgIT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFhZGphY2VudE5vbkdlcm1hbmljQ29udHJvbGxlZFJlZ2lvbiAmJiBhdHRhY2tpbmdGYWN0aW9uLmlkICE9PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGhhc0d1YXJhbnRlZWRTYWZlUmV0cmVhdChhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uLCByZWdpb24pIHtcbiAgICAgICAgaWYgKGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfLmZpbmQocmVnaW9uLmFkamFjZW50LCBmdW5jdGlvbiAoYWRqYWNlbnRSZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBkZWZlbmRpbmdGYWN0aW9uLmlkO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHN0YXRpYyBjYWxjdWxhdGVMZWFzdEF0dGFja1Jlc3VsdHMob3JkZXJlZEZhY3Rpb25QaWVjZXMsIGNhbGN1bGF0ZWRMb3NzZXMsIGFtYnVzaCkge1xuICAgICAgICBjb25zdCBhbGxvd1JvbGxzID0gIWFtYnVzaCB8fCB0aGlzLmNhZXNhckRlZmVuZGluZyhvcmRlcmVkRmFjdGlvblBpZWNlcyk7XG4gICAgICAgIGNvbnN0IGZpcnN0Um9sbGFibGVQaWVjZUluZGV4ID0gXy5maW5kSW5kZXgob3JkZXJlZEZhY3Rpb25QaWVjZXMsIHRoaXMuY2FuUm9sbEZvclR5cGUpO1xuICAgICAgICBjb25zdCByZW1vdmFsQ291bnQgPSBhbGxvd1JvbGxzID8gTWF0aC5taW4oXG4gICAgICAgICAgICAoZmlyc3RSb2xsYWJsZVBpZWNlSW5kZXggPT09IC0xID8gb3JkZXJlZEZhY3Rpb25QaWVjZXMubGVuZ3RoIDogZmlyc3RSb2xsYWJsZVBpZWNlSW5kZXgpLFxuICAgICAgICAgICAgY2FsY3VsYXRlZExvc3NlcykgOiBjYWxjdWxhdGVkTG9zc2VzO1xuICAgICAgICBjb25zdCB0YXJnZXRzID0gXy50YWtlKG9yZGVyZWRGYWN0aW9uUGllY2VzLCByZW1vdmFsQ291bnQpO1xuICAgICAgICBjb25zdCByZW1haW5pbmcgPSBfLmRyb3Aob3JkZXJlZEZhY3Rpb25QaWVjZXMsIHRhcmdldHMubGVuZ3RoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9zc2VzOiBjYWxjdWxhdGVkTG9zc2VzLFxuICAgICAgICAgICAgdGFyZ2V0czogdGFyZ2V0cyxcbiAgICAgICAgICAgIHJlbWFpbmluZzogcmVtYWluaW5nXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc3RhdGljIGNhbGN1bGF0ZU1vc3RBdHRhY2tSZXN1bHRzKG9yZGVyZWRGYWN0aW9uUGllY2VzLCBjYWxjdWxhdGVkTG9zc2VzKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSBfLnRha2Uob3JkZXJlZEZhY3Rpb25QaWVjZXMsIGNhbGN1bGF0ZWRMb3NzZXMpO1xuICAgICAgICBjb25zdCByZW1haW5pbmcgPSBfLmRyb3Aob3JkZXJlZEZhY3Rpb25QaWVjZXMsIHRhcmdldHMubGVuZ3RoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9zc2VzOiBjYWxjdWxhdGVkTG9zc2VzLFxuICAgICAgICAgICAgdGFyZ2V0czogdGFyZ2V0cyxcbiAgICAgICAgICAgIHJlbWFpbmluZzogcmVtYWluaW5nXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc3RhdGljIGNhblJvbGxGb3JUeXBlKHBpZWNlKSB7XG4gICAgICAgIGNvbnN0IHR5cGVzRm9yUm9sbHMgPSBbJ2xlYWRlcicsICdjaXRhZGVsJywgJ2xlZ2lvbicsICdmb3J0J107XG4gICAgICAgIHJldHVybiBfLmluZGV4T2YodHlwZXNGb3JSb2xscywgcGllY2UudHlwZSkgPj0gMDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZGVmZW5kZXJIYXNDaXRhZGVsT3JGb3J0KHN0YXRlLCBkZWZlbmRpbmdQaWVjZXMsIGJhbGxpc3RhZSkge1xuICAgICAgICByZXR1cm4gXy5maW5kKFxuICAgICAgICAgICAgZGVmZW5kaW5nUGllY2VzLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJyAmJiAhYmFsbGlzdGFlKSB8fCBwaWVjZS50eXBlID09PSAnZm9ydCc7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY2FuQW1idXNoKHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIGF0dGFja2luZ1BpZWNlcywgZGVmZW5kaW5nUGllY2VzKSB7XG5cbiAgICAgICAgaWYoYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhdHRhY2tpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkJFTEdBRSB8fCBhdHRhY2tpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkFSVkVSTkkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxlYWRlclJlZ2lvbiA9IF8uZmluZChzdGF0ZS5yZWdpb25zLCByZWdpb24gPT4gcmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oYXR0YWNraW5nRmFjdGlvbi5pZCkpO1xuICAgICAgICAgICAgaWYgKCFsZWFkZXJSZWdpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBsZWFkZXIgPSBsZWFkZXJSZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihhdHRhY2tpbmdGYWN0aW9uLmlkKTtcbiAgICAgICAgICAgIGNvbnN0IGlzQW1iaW9yaXhPclZlcmNpbmdldG9yaXggPSBsZWFkZXIgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICAgICAgY29uc3QgdmFsaWRSZWdpb25JZHMgPSBpc0FtYmlvcml4T3JWZXJjaW5nZXRvcml4ID8gXyhsZWFkZXJSZWdpb24uYWRqYWNlbnQpLmNvbmNhdChbbGVhZGVyUmVnaW9uXSkubWFwKFxuICAgICAgICAgICAgICAgICdpZCcpLnZhbHVlKCkgOiBbbGVhZGVyUmVnaW9uXTtcblxuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZih2YWxpZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBudW1BdHRhY2tlcnNIaWRkZW4gPSB0aGlzLmNhbGN1bGF0ZUhpZGRlbihhdHRhY2tpbmdQaWVjZXMpO1xuICAgICAgICBjb25zdCBudW1EZWZlbmRlcnNIaWRkZW4gPSB0aGlzLmNhbGN1bGF0ZUhpZGRlbihkZWZlbmRpbmdQaWVjZXMpO1xuICAgICAgICByZXR1cm4gbnVtQXR0YWNrZXJzSGlkZGVuID4gbnVtRGVmZW5kZXJzSGlkZGVuO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYW5Db3VudGVyYXR0YWNrKGFtYnVzaCwgZGVmZW5kZXJMb3NzZXMsIGRlZmVuZGluZ1BpZWNlcykge1xuICAgICAgICAvLyBDYWVzYXIgbWlnaHQgcm9sbCBmb3IgYSBjb3VudGVyYXR0YWNrXG4gICAgICAgIGlmICh0aGlzLmNhZXNhckRlZmVuZGluZyhkZWZlbmRpbmdQaWVjZXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdpdGhvdXQgQ2Flc2FyIGFuIGFtYnVzaCB3aWxsIGRpc2FsbG93XG4gICAgICAgIGlmIChhbWJ1c2gpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExlYWRlcnMgYW5kIGxlZ2lvbnMgbWlnaHQgc3Vydml2ZSBsb3NzIHJvbGxzXG4gICAgICAgIGlmICh0aGlzLmxlYWRlck9yTGVnaW9uc0RlZmVuZGluZyhkZWZlbmRpbmdQaWVjZXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdCBlbm91Z2ggbG9zc2VzIHdpbGwgYWxsb3cgKGJ1dCBhIHNpbmdsZSB3YXJiYW5kL2F1eGlsaWEgY2Fubm90IGNvdW50ZXJhdHRhY2spXG4gICAgICAgIGNvbnN0IG1vYmlsZURlZmVuZGVycyA9IF8uZmlsdGVyKGRlZmVuZGluZ1BpZWNlcywge2lzTW9iaWxlOiB0cnVlfSk7XG4gICAgICAgIHJldHVybiBkZWZlbmRlckxvc3NlcyA8IG1vYmlsZURlZmVuZGVycy5sZW5ndGggLSAxO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYWxjdWxhdGVIaWRkZW4ocGllY2VzKSB7XG4gICAgICAgIHJldHVybiBfLmZpbHRlcihcbiAgICAgICAgICAgIHBpZWNlcywgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgocGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnIHx8IHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJykgJiYgIXBpZWNlLnJldmVhbGVkKCkpO1xuICAgICAgICAgICAgfSkubGVuZ3RoO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYWVzYXJEZWZlbmRpbmcoZGVmZW5kaW5nUGllY2VzKSB7XG4gICAgICAgIGNvbnN0IGRlZmVuZGluZ1JvbWFuTGVhZGVyID0gXy5maW5kKGRlZmVuZGluZ1BpZWNlcywge3R5cGU6ICdsZWFkZXInLCBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuUk9NQU5TfSk7XG4gICAgICAgIHJldHVybiBkZWZlbmRpbmdSb21hbkxlYWRlciAmJiAhZGVmZW5kaW5nUm9tYW5MZWFkZXIuaXNTdWNjZXNzb3IoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbGVhZGVyT3JMZWdpb25zRGVmZW5kaW5nKGRlZmVuZGluZ1BpZWNlcykge1xuICAgICAgICBjb25zdCBkZWZlbmRpbmdQaWVjZXNCeVR5cGUgPSBfLmdyb3VwQnkoZGVmZW5kaW5nUGllY2VzLCAndHlwZScpO1xuICAgICAgICByZXR1cm4gZGVmZW5kaW5nUGllY2VzQnlUeXBlLmxlYWRlciB8fCBkZWZlbmRpbmdQaWVjZXNCeVR5cGUubGVnaW9uO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBCYXR0bGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2JhdHRsZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFDQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7Ozs7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUF6QkE7QUE4QkE7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar AddCapability = function (_Action) {\n    _inherits(AddCapability, _Action);\n\n    function AddCapability(args) {\n        _classCallCheck(this, AddCapability);\n\n        var _this = _possibleConstructorReturn(this, (AddCapability.__proto__ || Object.getPrototypeOf(AddCapability)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.id = args.id;\n        _this.state = args.state;\n        return _this;\n    }\n\n    _createClass(AddCapability, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var capability = new _capability2.default({\n                id: this.id,\n                state: this.state,\n                factionId: this.factionId\n            });\n            state.addCapability(capability);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            state.removeCapability(this.id);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            return ['Added ' + _capabilities.CapabilityTitles[this.id] + ' capability' + (this.factionId ? ' to ' + this.factionId : '')];\n        }\n    }]);\n\n    return AddCapability;\n}(_action2.default);\n\nexports.default = AddCapability;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9hZGRDYXBhYmlsaXR5LmpzP2QyNWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5pbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlUaXRsZXN9IGZyb20gJy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuXG5jbGFzcyBBZGRDYXBhYmlsaXR5IGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5pZCA9IGFyZ3MuaWQ7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBhcmdzLnN0YXRlO1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBjYXBhYmlsaXR5ID0gbmV3IENhcGFiaWxpdHkoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHN0YXRlLmFkZENhcGFiaWxpdHkoY2FwYWJpbGl0eSk7XG4gICAgfVxuXG4gICAgZG9VbmRvKHN0YXRlKSB7XG4gICAgICAgIHN0YXRlLnJlbW92ZUNhcGFiaWxpdHkodGhpcy5pZCk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBbJ0FkZGVkICcgKyBDYXBhYmlsaXR5VGl0bGVzW3RoaXMuaWRdICsgJyBjYXBhYmlsaXR5JyArICh0aGlzLmZhY3Rpb25JZCA/ICcgdG8gJyArIHRoaXMuZmFjdGlvbklkIDogJycpXTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWRkQ2FwYWJpbGl0eVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2FjdGlvbnMvYWRkQ2FwYWJpbGl0eS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUxBO0FBTUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar TribeIDs = {\n    AEDUI: 'Aedui',\n    ARVERNI: 'Arverni',\n    ATREBATES: 'Atrebates',\n    AULERCI: 'Aulerci',\n    BELLOVACI: 'Bellovaci',\n    BITURIGES: 'Bituriges',\n    CADURCI: 'Cadurci',\n    CARNUTES: 'Carnutes',\n    CATUVELLAUNI: 'Catuvellauni',\n    COLONY: 'Colony',\n    EBURONES: 'Eburones',\n    HELVETII: 'Helvetii',\n    HELVII: 'Helvii',\n    LINGONES: 'Lingones',\n    MANDUBII: 'Mandubii',\n    MENAPII: 'Menapii',\n    MORINI: 'Morini',\n    NAMNETES: 'Namnetes',\n    NERVII: 'Nervii',\n    PICTONES: 'Pictones',\n    REMI: 'Remi',\n    SANTONES: 'Santones',\n    SENONES: 'Senones',\n    SEQUANI: 'Sequani',\n    SUEBI_NORTH: 'SuebiNorth',\n    SUEBI_SOUTH: 'SuebiSouth',\n    SUGAMBRI: 'Sugambri',\n    TREVERI: 'Treveri',\n    UBII: 'Ubii',\n    VENETI: 'Veneti',\n    VOLCAE: 'Volcae'\n};\n\nexports.default = TribeIDs;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3RyaWJlSWRzLmpzPzQ4MmMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVHJpYmVJRHMgPSB7XG4gICAgQUVEVUk6ICdBZWR1aScsXG4gICAgQVJWRVJOSTogJ0FydmVybmknLFxuICAgIEFUUkVCQVRFUzogJ0F0cmViYXRlcycsXG4gICAgQVVMRVJDSTogJ0F1bGVyY2knLFxuICAgIEJFTExPVkFDSTogJ0JlbGxvdmFjaScsXG4gICAgQklUVVJJR0VTOiAnQml0dXJpZ2VzJyxcbiAgICBDQURVUkNJOiAnQ2FkdXJjaScsXG4gICAgQ0FSTlVURVM6ICdDYXJudXRlcycsXG4gICAgQ0FUVVZFTExBVU5JOiAnQ2F0dXZlbGxhdW5pJyxcbiAgICBDT0xPTlk6ICdDb2xvbnknLFxuICAgIEVCVVJPTkVTOiAnRWJ1cm9uZXMnLFxuICAgIEhFTFZFVElJOiAnSGVsdmV0aWknLFxuICAgIEhFTFZJSTogJ0hlbHZpaScsXG4gICAgTElOR09ORVM6ICdMaW5nb25lcycsXG4gICAgTUFORFVCSUk6ICdNYW5kdWJpaScsXG4gICAgTUVOQVBJSTogJ01lbmFwaWknLFxuICAgIE1PUklOSTogJ01vcmluaScsXG4gICAgTkFNTkVURVM6ICdOYW1uZXRlcycsXG4gICAgTkVSVklJOiAnTmVydmlpJyxcbiAgICBQSUNUT05FUzogJ1BpY3RvbmVzJyxcbiAgICBSRU1JOiAnUmVtaScsXG4gICAgU0FOVE9ORVM6ICdTYW50b25lcycsXG4gICAgU0VOT05FUzogJ1Nlbm9uZXMnLFxuICAgIFNFUVVBTkk6ICdTZXF1YW5pJyxcbiAgICBTVUVCSV9OT1JUSDogJ1N1ZWJpTm9ydGgnLFxuICAgIFNVRUJJX1NPVVRIOiAnU3VlYmlTb3V0aCcsXG4gICAgU1VHQU1CUkk6ICdTdWdhbWJyaScsXG4gICAgVFJFVkVSSTogJ1RyZXZlcmknLFxuICAgIFVCSUk6ICdVYmlpJyxcbiAgICBWRU5FVEk6ICdWZW5ldGknLFxuICAgIFZPTENBRTogJ1ZvbGNhZSdcbn07XG5cblxuZXhwb3J0IGRlZmF1bHQgVHJpYmVJRHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbmZpZy90cmliZUlkcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0JBO0FBQ0E7QUFrQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar FactionPiece = function () {\n    function FactionPiece(definition) {\n        _classCallCheck(this, FactionPiece);\n\n        this.factionId = definition.factionId;\n        this.type = definition.type;\n        this.isMobile = definition.isMobile;\n        this.canRoll = definition.canRoll;\n    }\n\n    _createClass(FactionPiece, [{\n        key: 'identifier',\n        value: function identifier() {\n            return this.factionId + '|' + this.type;\n        }\n    }]);\n\n    return FactionPiece;\n}();\n\nexports.default = FactionPiece;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9mYWN0aW9uUGllY2UuanM/MDE0MSJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIEZhY3Rpb25QaWVjZSB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGRlZmluaXRpb24uZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnR5cGUgPSBkZWZpbml0aW9uLnR5cGU7XG4gICAgICAgIHRoaXMuaXNNb2JpbGUgPSBkZWZpbml0aW9uLmlzTW9iaWxlO1xuICAgICAgICB0aGlzLmNhblJvbGwgPSBkZWZpbml0aW9uLmNhblJvbGw7XG4gICAgfVxuXG4gICAgaWRlbnRpZmllcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmFjdGlvbklkICsgJ3wnICsgdGhpcy50eXBlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRmFjdGlvblBpZWNlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL2ZhY3Rpb25QaWVjZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Losses = function () {\n    function Losses() {\n        _classCallCheck(this, Losses);\n    }\n\n    _createClass(Losses, null, [{\n        key: 'calculateUnmodifiedLosses',\n        value: function calculateUnmodifiedLosses(state, attackingFaction, attackingPieces) {\n            var counterattack = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n            var germanicHorse = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n            var losses = 0;\n            var leader = _lodash2.default.find(attackingPieces, { type: 'leader' });\n            var usedLegioXLegion = false;\n            _lodash2.default.each(attackingPieces, function (piece) {\n                if (piece.type === 'warband') {\n                    if (!counterattack && leader && !leader.isSuccessor() && attackingFaction.id === _factionIds2.default.BELGAE) {\n                        losses += 1;\n                    } else {\n                        losses += 0.5;\n                    }\n                } else if (piece.type === 'auxilia') {\n                    losses += germanicHorse && state.hasUnshadedCapability(_capabilities.CapabilityIDs.GERMANIC_HORSE) ? 1 : 0.5;\n                } else if (piece.type === 'legion') {\n                    if (!counterattack && leader && !leader.isSuccessor() && piece.factionId === _factionIds2.default.ROMANS && !usedLegioXLegion) {\n                        losses += 2;\n                        if (state.hasShadedCapability(_capabilities.CapabilityIDs.LEGIO_X)) {\n                            usedLegioXLegion = true;\n                        }\n                    } else {\n                        losses += 1;\n                    }\n                } else if (piece.type === 'leader') {\n                    losses += 1;\n                }\n            });\n\n            var useVercingetorixElite = leader && leader.factionId === _factionIds2.default.ARVERNI && !leader.isSuccessor() && state.hasShadedCapability(_capabilities.CapabilityIDs.VERCINGETORIXS_ELITE);\n            var numWarbands = _lodash2.default.filter(attackingPieces, { type: 'warband' }).length;\n            if (useVercingetorixElite && numWarbands > 0) {\n                losses += Math.min(numWarbands, 2);\n            }\n\n            return losses;\n        }\n    }, {\n        key: 'orderPiecesForRemoval',\n        value: function orderPiecesForRemoval(state, pieces, retreat, helpingFactionId) {\n            var alliesFortsAndCitadels = (0, _lodash2.default)(pieces).filter(function (piece) {\n                return piece.type === 'alliedtribe' || piece.type === 'fort' || piece.type === 'citadel';\n            }).sortBy(function (piece) {\n                if (piece.type === 'alliedtribe') {\n                    if (piece.factionId === helpingFactionId) {\n                        return 'a';\n                    }\n\n                    var tribe = state.tribesById[piece.tribeId];\n                    if (!tribe.isCity) {\n                        return 'b';\n                    } else {\n                        return 'c';\n                    }\n                } else if (piece.type === 'fort') {\n                    return 'd';\n                } else if (piece.type === 'citadel') {\n                    return 'e';\n                }\n            }).value();\n\n            var warbandsAuxiliaLegionsAndLeader = (0, _lodash2.default)(pieces).filter(function (piece) {\n                return piece.type === 'warband' || piece.type === 'auxilia' || piece.type === 'legion' || piece.type === 'leader';\n            }).sortBy(function (piece) {\n                if (piece.type === 'warband' || piece.type === 'auxilia') {\n                    if (piece.factionId === helpingFactionId) {\n                        return 'a';\n                    }\n                    if (piece.scouted()) {\n                        return 'b';\n                    } else if (piece.revealed()) {\n                        return 'c';\n                    } else {\n                        return 'd';\n                    }\n                } else if (piece.type === 'legion') {\n                    return 'e';\n                } else if (piece.type === 'leader') {\n                    return 'f';\n                }\n            }).value();\n\n            var piecesForRemoval = [];\n            if (retreat) {\n                piecesForRemoval = _lodash2.default.concat(alliesFortsAndCitadels, warbandsAuxiliaLegionsAndLeader);\n            } else {\n                piecesForRemoval = _lodash2.default.concat(warbandsAuxiliaLegionsAndLeader, alliesFortsAndCitadels);\n            }\n            return piecesForRemoval;\n        }\n    }, {\n        key: 'orderPiecesRollsFirst',\n        value: function orderPiecesRollsFirst(pieces, retreat) {\n            var alliesFortsAndCitadels = (0, _lodash2.default)(pieces).filter(function (piece) {\n                return piece.type === 'alliedtribe' || piece.type === 'fort' || piece.type === 'citadel';\n            }).sortBy(function (piece) {\n                if (piece.type === 'fort' || piece.type === 'citadel') {\n                    return 'a';\n                } else {\n                    return 'b';\n                }\n            }).value();\n\n            var warbandsAuxiliaLegionsAndLeader = (0, _lodash2.default)(pieces).filter(function (piece) {\n                return piece.type === 'warband' || piece.type === 'auxilia' || piece.type === 'legion' || piece.type === 'leader';\n            }).sortBy(function (piece) {\n                if (piece.type === 'legion' || piece.type === 'leader') {\n                    return 'a';\n                } else {\n                    return 'b';\n                }\n            }).value();\n\n            var piecesForRemoval = [];\n            if (retreat) {\n                piecesForRemoval = _lodash2.default.concat(alliesFortsAndCitadels, warbandsAuxiliaLegionsAndLeader);\n            } else {\n                piecesForRemoval = _lodash2.default.concat(warbandsAuxiliaLegionsAndLeader, alliesFortsAndCitadels);\n            }\n            return piecesForRemoval;\n        }\n    }]);\n\n    return Losses;\n}();\n\nexports.default = Losses;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvdXRpbC9sb3NzZXMuanM/MTkyYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsaWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IHtDYXBhYmlsaXR5SURzfSBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuY2xhc3MgTG9zc2VzIHtcblxuICAgIHN0YXRpYyBjYWxjdWxhdGVVbm1vZGlmaWVkTG9zc2VzKHN0YXRlLCBhdHRhY2tpbmdGYWN0aW9uLCBhdHRhY2tpbmdQaWVjZXMsIGNvdW50ZXJhdHRhY2s9ZmFsc2UsIGdlcm1hbmljSG9yc2U9ZmFsc2UpIHtcbiAgICAgICAgbGV0IGxvc3NlcyA9IDA7XG4gICAgICAgIGNvbnN0IGxlYWRlciA9IF8uZmluZChhdHRhY2tpbmdQaWVjZXMsIHt0eXBlOiAnbGVhZGVyJ30pO1xuICAgICAgICBsZXQgdXNlZExlZ2lvWExlZ2lvbiA9IGZhbHNlO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBhdHRhY2tpbmdQaWVjZXMsIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgIGlmIChwaWVjZS50eXBlID09PSAnd2FyYmFuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb3VudGVyYXR0YWNrICYmIGxlYWRlciAmJiAhbGVhZGVyLmlzU3VjY2Vzc29yKCkgJiYgYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5CRUxHQUUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvc3NlcyArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9zc2VzICs9IDAuNTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS50eXBlID09PSAnYXV4aWxpYScpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9zc2VzICs9IGdlcm1hbmljSG9yc2UgJiYgc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuR0VSTUFOSUNfSE9SU0UpID8gMSA6IDAuNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGllY2UudHlwZSA9PT0gJ2xlZ2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb3VudGVyYXR0YWNrICYmIGxlYWRlciAmJiAhbGVhZGVyLmlzU3VjY2Vzc29yKCkgJiYgcGllY2UuZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUyAmJiAhdXNlZExlZ2lvWExlZ2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9zc2VzICs9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzdGF0ZS5oYXNTaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuTEVHSU9fWCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VkTGVnaW9YTGVnaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvc3NlcyArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnR5cGUgPT09ICdsZWFkZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvc3NlcyArPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHVzZVZlcmNpbmdldG9yaXhFbGl0ZSA9IGxlYWRlciAmJiBsZWFkZXIuZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFSVkVSTkkgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmhhc1NoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5WRVJDSU5HRVRPUklYU19FTElURSk7XG4gICAgICAgIGNvbnN0IG51bVdhcmJhbmRzID0gXy5maWx0ZXIoYXR0YWNraW5nUGllY2VzLCB7dHlwZTogJ3dhcmJhbmQnfSkubGVuZ3RoO1xuICAgICAgICBpZiAodXNlVmVyY2luZ2V0b3JpeEVsaXRlICYmIG51bVdhcmJhbmRzID4gMCkge1xuICAgICAgICAgICAgbG9zc2VzICs9IE1hdGgubWluKG51bVdhcmJhbmRzLCAyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBsb3NzZXM7XG4gICAgfVxuXG4gICAgc3RhdGljIG9yZGVyUGllY2VzRm9yUmVtb3ZhbChzdGF0ZSwgcGllY2VzLCByZXRyZWF0LCBoZWxwaW5nRmFjdGlvbklkKSB7XG4gICAgICAgIGNvbnN0IGFsbGllc0ZvcnRzQW5kQ2l0YWRlbHMgPSBfKHBpZWNlcykuZmlsdGVyKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2ZvcnQnIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJztcbiAgICAgICAgICAgIH0pLnNvcnRCeShcbiAgICAgICAgICAgIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgIGlmIChwaWVjZS50eXBlID09PSAnYWxsaWVkdHJpYmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBpZWNlLmZhY3Rpb25JZCA9PT0gaGVscGluZ0ZhY3Rpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdhJ1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJpYmUgPSBzdGF0ZS50cmliZXNCeUlkW3BpZWNlLnRyaWJlSWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRyaWJlLmlzQ2l0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdiJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGllY2UudHlwZSA9PT0gJ2ZvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnZCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2UnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3Qgd2FyYmFuZHNBdXhpbGlhTGVnaW9uc0FuZExlYWRlciA9IF8ocGllY2VzKS5maWx0ZXIoXG4gICAgICAgICAgICBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ3dhcmJhbmQnIHx8IHBpZWNlLnR5cGUgPT09ICdhdXhpbGlhJyB8fCBwaWVjZS50eXBlID09PSAnbGVnaW9uJyB8fCBwaWVjZS50eXBlID09PSAnbGVhZGVyJztcbiAgICAgICAgICAgIH0pLnNvcnRCeShcbiAgICAgICAgICAgIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgIGlmIChwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgfHwgcGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBpZWNlLmZhY3Rpb25JZCA9PT0gaGVscGluZ0ZhY3Rpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdhJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwaWVjZS5zY291dGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGllY2UucmV2ZWFsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdjJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnZCc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS50eXBlID09PSAnbGVnaW9uJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2UnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS50eXBlID09PSAnbGVhZGVyJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2YnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgbGV0IHBpZWNlc0ZvclJlbW92YWwgPSBbXTtcbiAgICAgICAgaWYgKHJldHJlYXQpIHtcbiAgICAgICAgICAgIHBpZWNlc0ZvclJlbW92YWwgPSBfLmNvbmNhdChhbGxpZXNGb3J0c0FuZENpdGFkZWxzLCB3YXJiYW5kc0F1eGlsaWFMZWdpb25zQW5kTGVhZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBpZWNlc0ZvclJlbW92YWwgPSBfLmNvbmNhdCh3YXJiYW5kc0F1eGlsaWFMZWdpb25zQW5kTGVhZGVyLCBhbGxpZXNGb3J0c0FuZENpdGFkZWxzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGllY2VzRm9yUmVtb3ZhbDtcbiAgICB9XG5cbiAgICBzdGF0aWMgb3JkZXJQaWVjZXNSb2xsc0ZpcnN0KHBpZWNlcywgcmV0cmVhdCkge1xuICAgICAgICBjb25zdCBhbGxpZXNGb3J0c0FuZENpdGFkZWxzID0gXyhwaWVjZXMpLmZpbHRlcihcbiAgICAgICAgICAgIChwaWVjZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnYWxsaWVkdHJpYmUnIHx8IHBpZWNlLnR5cGUgPT09ICdmb3J0JyB8fCBwaWVjZS50eXBlID09PSAnY2l0YWRlbCc7XG4gICAgICAgICAgICB9KS5zb3J0QnkoXG4gICAgICAgICAgICAocGllY2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ2ZvcnQnIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2EnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdiJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IHdhcmJhbmRzQXV4aWxpYUxlZ2lvbnNBbmRMZWFkZXIgPSBfKHBpZWNlcykuZmlsdGVyKFxuICAgICAgICAgICAgKHBpZWNlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyB8fCBwaWVjZS50eXBlID09PSAnYXV4aWxpYScgfHwgcGllY2UudHlwZSA9PT0gJ2xlZ2lvbicgfHwgcGllY2UudHlwZSA9PT0gJ2xlYWRlcic7XG4gICAgICAgICAgICB9KS5zb3J0QnkoXG4gICAgICAgICAgICAocGllY2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ2xlZ2lvbicgfHwgcGllY2UudHlwZSA9PT0gJ2xlYWRlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdhJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICBsZXQgcGllY2VzRm9yUmVtb3ZhbCA9IFtdO1xuICAgICAgICBpZiAocmV0cmVhdCkge1xuICAgICAgICAgICAgcGllY2VzRm9yUmVtb3ZhbCA9IF8uY29uY2F0KGFsbGllc0ZvcnRzQW5kQ2l0YWRlbHMsIHdhcmJhbmRzQXV4aWxpYUxlZ2lvbnNBbmRMZWFkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGllY2VzRm9yUmVtb3ZhbCA9IF8uY29uY2F0KHdhcmJhbmRzQXV4aWxpYUxlZ2lvbnNBbmRMZWFkZXIsIGFsbGllc0ZvcnRzQW5kQ2l0YWRlbHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwaWVjZXNGb3JSZW1vdmFsO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9zc2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS91dGlsL2xvc3Nlcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7OztBQUFBOzs7Ozs7O0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar HidePieces = function (_Action) {\n    _inherits(HidePieces, _Action);\n\n    function HidePieces(args) {\n        _classCallCheck(this, HidePieces);\n\n        var _this = _possibleConstructorReturn(this, (HidePieces.__proto__ || Object.getPrototypeOf(HidePieces)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.numHiddenFromScouted = args.numHiddenFromScouted || 0;\n        _this.numHiddenFromRevealed = args.numHiddenFromRevealed || 0;\n        return _this;\n    }\n\n    _createClass(HidePieces, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var _this2 = this;\n\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var revealable = region.getWarbandsOrAuxiliaForFaction(faction.id);\n            if (revealable.length === 0) {\n                return;\n            }\n\n            _lodash2.default.each(revealable, function (piece) {\n                if (piece.scouted()) {\n                    _this2.numHiddenFromScouted += 1;\n                    piece.scouted(false);\n                } else if (piece.revealed()) {\n                    _this2.numHiddenFromRevealed += 1;\n                    piece.revealed(false);\n                }\n            });\n\n            if (this.numHiddenFromRevealed > 0) {\n                console.log('Hiding ' + this.numHiddenFromRevealed + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n\n            if (this.numHiddenFromScouted > 0) {\n                console.log('Removing scout marker from ' + this.numHiddenFromScouted + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var revealable = region.getWarbandsOrAuxiliaForFaction(faction.id);\n            if (revealable.length === 0) {\n                return;\n            }\n\n            var numToReveal = this.numHiddenFromRevealed;\n            _lodash2.default.each(revealable, function (piece) {\n                if (!piece.revealed() && numToReveal > 0) {\n                    piece.revealed(true);\n                    numToReveal -= 1;\n                } else if (piece.revealed()) {\n                    piece.scouted(true);\n                }\n            });\n\n            if (this.numHiddenFromScouted > 0) {\n                console.log('Adding scout marker to ' + this.numHiddenFromScouted + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n\n            if (this.numHiddenFromRevealed > 0) {\n                console.log('Revealing ' + this.numHiddenFromRevealed + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var instructions = [];\n            if (this.numHiddenFromScouted > 0) {\n                instructions.push('Remove scouted marker from ' + this.numHiddenFromScouted + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n            if (this.numHiddenFromRevealed > 0) {\n                instructions.push('Hide ' + this.numHiddenFromRevealed + 'x ' + faction.name + ' pieces in ' + region.name);\n            }\n            return instructions;\n        }\n    }]);\n\n    return HidePieces;\n}(_action2.default);\n\nexports.default = HidePieces;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9oaWRlUGllY2VzLmpzP2U5NmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcblxuY2xhc3MgSGlkZVBpZWNlcyBleHRlbmRzIEFjdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgICAgIHRoaXMuZmFjdGlvbklkID0gYXJncy5mYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMucmVnaW9uSWQgPSBhcmdzLnJlZ2lvbklkO1xuICAgICAgICB0aGlzLm51bUhpZGRlbkZyb21TY291dGVkID0gYXJncy5udW1IaWRkZW5Gcm9tU2NvdXRlZCB8fCAwO1xuICAgICAgICB0aGlzLm51bUhpZGRlbkZyb21SZXZlYWxlZCA9IGFyZ3MubnVtSGlkZGVuRnJvbVJldmVhbGVkIHx8IDA7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgcmV2ZWFsYWJsZSA9IHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oZmFjdGlvbi5pZCk7XG4gICAgICAgIGlmIChyZXZlYWxhYmxlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKHJldmVhbGFibGUsIChwaWVjZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHBpZWNlLnNjb3V0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubnVtSGlkZGVuRnJvbVNjb3V0ZWQgKz0gMTtcbiAgICAgICAgICAgICAgICBwaWVjZS5zY291dGVkKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnJldmVhbGVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm51bUhpZGRlbkZyb21SZXZlYWxlZCArPSAxO1xuICAgICAgICAgICAgICAgIHBpZWNlLnJldmVhbGVkKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYodGhpcy5udW1IaWRkZW5Gcm9tUmV2ZWFsZWQgPiAwICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0hpZGluZyAnICsgdGhpcy5udW1IaWRkZW5Gcm9tUmV2ZWFsZWQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXMubnVtSGlkZGVuRnJvbVNjb3V0ZWQgPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAnUmVtb3Zpbmcgc2NvdXQgbWFya2VyIGZyb20gJyArIHRoaXMubnVtSGlkZGVuRnJvbVNjb3V0ZWQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IHJldmVhbGFibGUgPSByZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKGZhY3Rpb24uaWQpO1xuICAgICAgICBpZiAocmV2ZWFsYWJsZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBudW1Ub1JldmVhbCA9IHRoaXMubnVtSGlkZGVuRnJvbVJldmVhbGVkO1xuICAgICAgICBfLmVhY2gocmV2ZWFsYWJsZSwgKHBpZWNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXBpZWNlLnJldmVhbGVkKCkgJiYgbnVtVG9SZXZlYWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgcGllY2UucmV2ZWFsZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgbnVtVG9SZXZlYWwgLT0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnJldmVhbGVkKCkpIHtcbiAgICAgICAgICAgICAgICBwaWVjZS5zY291dGVkKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZih0aGlzLm51bUhpZGRlbkZyb21TY291dGVkID4gMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgJ0FkZGluZyBzY291dCBtYXJrZXIgdG8gJyArIHRoaXMubnVtSGlkZGVuRnJvbVNjb3V0ZWQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBwaWVjZXMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXMubnVtSGlkZGVuRnJvbVJldmVhbGVkID4gMCApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZlYWxpbmcgJyArIHRoaXMubnVtSGlkZGVuRnJvbVJldmVhbGVkICsgJ3ggJyArIGZhY3Rpb24ubmFtZSArICcgcGllY2VzIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBbXTtcbiAgICAgICAgaWYodGhpcy5udW1IaWRkZW5Gcm9tU2NvdXRlZCA+IDApIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgICdSZW1vdmUgc2NvdXRlZCBtYXJrZXIgZnJvbSAnICsgdGhpcy5udW1IaWRkZW5Gcm9tU2NvdXRlZCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIHBpZWNlcyBpbiAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMubnVtSGlkZGVuRnJvbVJldmVhbGVkID4gMCApIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKCdIaWRlICcgKyB0aGlzLm51bUhpZGRlbkZyb21SZXZlYWxlZCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIHBpZWNlcyBpbiAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbnM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBIaWRlUGllY2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL2hpZGVQaWVjZXMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _EnemyFactionPriority;\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar EnemyFactionPriority = (_EnemyFactionPriority = {}, _defineProperty(_EnemyFactionPriority, _factionIds2.default.ROMANS, 1), _defineProperty(_EnemyFactionPriority, _factionIds2.default.AEDUI, 2), _defineProperty(_EnemyFactionPriority, _factionIds2.default.ARVERNI, 3), _defineProperty(_EnemyFactionPriority, _factionIds2.default.GERMANIC_TRIBES, 4), _EnemyFactionPriority);\n\nexports.default = EnemyFactionPriority;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvZW5lbXlGYWN0aW9uUHJpb3JpdHkuanM/N2VjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5cbmNvbnN0IEVuZW15RmFjdGlvblByaW9yaXR5ID0ge1xuICAgIFtGYWN0aW9uSURzLlJPTUFOU106IDEsXG4gICAgW0ZhY3Rpb25JRHMuQUVEVUldOiAyLFxuICAgIFtGYWN0aW9uSURzLkFSVkVSTkldOiAzLFxuICAgIFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU106IDRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEVuZW15RmFjdGlvblByaW9yaXR5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9lbmVteUZhY3Rpb25Qcmlvcml0eS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQU1BIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _marchResults = __webpack_require__(157);\n\nvar _marchResults2 = _interopRequireDefault(_marchResults);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar March = function (_Command) {\n    _inherits(March, _Command);\n\n    function March() {\n        _classCallCheck(this, March);\n\n        return _possibleConstructorReturn(this, (March.__proto__ || Object.getPrototypeOf(March)).apply(this, arguments));\n    }\n\n    _createClass(March, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var faction = args.faction;\n            return this.generateResultsForRegions(state, faction, state.regions);\n        }\n    }, {\n        key: 'generateResultsForRegions',\n        value: function generateResultsForRegions(state, faction, regions) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(regions).map(function (region) {\n                var isArverni = faction.id === _factionIds2.default.ARVERNI;\n                var isRomans = faction.id === _factionIds2.default.ROMANS;\n                var isGermanic = faction.id === _factionIds2.default.GERMANIC_TRIBES;\n\n                var mobileFactionPieces = _lodash2.default.filter(region.piecesByFaction()[faction.id], { isMobile: true });\n\n                if (mobileFactionPieces.length === 0 || state.frost() && !isGermanic) {\n                    return;\n                }\n\n                var firstRegions = (0, _lodash2.default)(region.adjacent).filter(function (destination) {\n                    return destination.inPlay();\n                }).value();\n                var secondRegions = [];\n                var thirdRegions = [];\n\n                var hasVercingetorix = isArverni && _lodash2.default.find(mobileFactionPieces, function (piece) {\n                    return piece.type === 'leader' && !piece.isSuccessor();\n                });\n                var hasCaesar = isRomans && _lodash2.default.find(mobileFactionPieces, function (piece) {\n                    return piece.type === 'leader' && !piece.isSuccessor();\n                });\n\n                if (hasVercingetorix || isRomans) {\n                    secondRegions = (0, _lodash2.default)(firstRegions).map(function (adjacentRegion) {\n                        return adjacentRegion.adjacent;\n                    }).flatten().uniq().value();\n                }\n\n                if (hasCaesar) {\n                    thirdRegions = (0, _lodash2.default)(secondRegions).map(function (adjacentRegion) {\n                        return adjacentRegion.adjacent;\n                    }).flatten().uniq().value();\n                }\n\n                var destinations = _lodash2.default.concat(firstRegions, secondRegions, thirdRegions);\n                destinations = (0, _lodash2.default)(destinations).reject(function (destination) {\n                    return destination.id === region.id;\n                }).filter(function (destination) {\n                    return destination.inPlay();\n                }).uniq().value();\n\n                var marchLimit = hasCaesar ? 3 : isRomans || hasVercingetorix ? 2 : 1;\n                destinations = (0, _lodash2.default)(destinations).filter(function (destination) {\n                    var paths = (0, _lodash2.default)(_map2.default.findPathsToRegion(state, region.id, destination.id, marchLimit)).reject(function (path) {\n                        return _this2.isInvalidMarchPath(state, path);\n                    }).value();\n                    return paths.length > 0;\n                }).value();\n\n                var cost = region.devastated() ? 2 : 1;\n                if (isRomans) {\n                    cost *= 2;\n                }\n\n                if (isGermanic) {\n                    cost = 0;\n                }\n\n                return new _marchResults2.default({\n                    region: region,\n                    faction: faction,\n                    mobilePieces: mobileFactionPieces,\n                    adjacentDestinations: firstRegions,\n                    destinations: destinations,\n                    cost: cost\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'isInvalidMarchPath',\n        value: function isInvalidMarchPath(state, path) {\n            var _this3 = this;\n\n            if (path.length < 3) {\n                return false;\n            }\n\n            // Britannia\n            var subPath = path.slice(0, path.length - 1);\n            if (_lodash2.default.indexOf(subPath, _regionIds2.default.BRITANNIA) >= 0) {\n                return true;\n            }\n\n            // Devastated\n            subPath = path.slice(1, path.length - 1);\n            if (_lodash2.default.find(subPath, function (id) {\n                return state.regionsById[id].devastated();\n            })) {\n                return true;\n            }\n\n            // Rhenus\n            if (_lodash2.default.find(_lodash2.default.range(1, path.length - 1), function (index) {\n                var from = path[index - 1];\n                var to = path[index];\n                return _this3.crossesRhenus(state, from, to);\n            })) {\n                return true;\n            }\n        }\n    }, {\n        key: 'crossesRhenus',\n        value: function crossesRhenus(state, fromId, toId) {\n            var fromRegion = state.regionsById[fromId];\n            var toRegion = state.regionsById[toId];\n\n            return (fromRegion.group === _regionGroups2.default.GERMANIA || toRegion.group === _regionGroups2.default.GERMANIA) && !(fromRegion.group === _regionGroups2.default.GERMANIA && toRegion.group === _regionGroups2.default.GERMANIA);\n        }\n    }]);\n\n    return March;\n}(_command2.default);\n\nexports.default = March;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvbWFyY2guanM/Yjk5NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kIGZyb20gJy4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBNYXJjaFJlc3VsdHMgZnJvbSAnLi9tYXJjaFJlc3VsdHMnO1xuaW1wb3J0IE1hcCBmcm9tICcuLi91dGlsL21hcCc7XG5cbmNsYXNzIE1hcmNoIGV4dGVuZHMgQ29tbWFuZCB7XG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gYXJncy5mYWN0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVJlc3VsdHNGb3JSZWdpb25zKHN0YXRlLCBmYWN0aW9uLCBzdGF0ZS5yZWdpb25zKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2VuZXJhdGVSZXN1bHRzRm9yUmVnaW9ucyhzdGF0ZSwgZmFjdGlvbiwgcmVnaW9ucykge1xuICAgICAgICByZXR1cm4gXyhyZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNBcnZlcm5pID0gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5BUlZFUk5JO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzUm9tYW5zID0gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlM7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNHZXJtYW5pYyA9IGZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgbW9iaWxlRmFjdGlvblBpZWNlcyA9IF8uZmlsdGVyKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uLmlkXSwge2lzTW9iaWxlOiB0cnVlfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobW9iaWxlRmFjdGlvblBpZWNlcy5sZW5ndGggPT09IDAgfHwgKHN0YXRlLmZyb3N0KCkgJiYgIWlzR2VybWFuaWMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFJlZ2lvbnMgPSBfKHJlZ2lvbi5hZGphY2VudCkuZmlsdGVyKGRlc3RpbmF0aW9uID0+IGRlc3RpbmF0aW9uLmluUGxheSgpKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIGxldCBzZWNvbmRSZWdpb25zID0gW107XG4gICAgICAgICAgICAgICAgbGV0IHRoaXJkUmVnaW9ucyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzVmVyY2luZ2V0b3JpeCA9IGlzQXJ2ZXJuaSAmJiBfLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2JpbGVGYWN0aW9uUGllY2VzLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ2xlYWRlcicgJiYgIXBpZWNlLmlzU3VjY2Vzc29yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNDYWVzYXIgPSBpc1JvbWFucyAmJiBfLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2JpbGVGYWN0aW9uUGllY2VzLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ2xlYWRlcicgJiYgIXBpZWNlLmlzU3VjY2Vzc29yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChoYXNWZXJjaW5nZXRvcml4IHx8IGlzUm9tYW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY29uZFJlZ2lvbnMgPSBfKGZpcnN0UmVnaW9ucykubWFwKFxuICAgICAgICAgICAgICAgICAgICAgICAgYWRqYWNlbnRSZWdpb24gPT4gYWRqYWNlbnRSZWdpb24uYWRqYWNlbnQpLmZsYXR0ZW4oKS51bmlxKCkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaGFzQ2Flc2FyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXJkUmVnaW9ucyA9IF8oc2Vjb25kUmVnaW9ucykubWFwKFxuICAgICAgICAgICAgICAgICAgICAgICAgYWRqYWNlbnRSZWdpb24gPT4gYWRqYWNlbnRSZWdpb24uYWRqYWNlbnQpLmZsYXR0ZW4oKS51bmlxKCkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgZGVzdGluYXRpb25zID0gXy5jb25jYXQoZmlyc3RSZWdpb25zLCBzZWNvbmRSZWdpb25zLCB0aGlyZFJlZ2lvbnMpO1xuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9ucyA9IF8oZGVzdGluYXRpb25zKS5yZWplY3QoZGVzdGluYXRpb24gPT4gZGVzdGluYXRpb24uaWQgPT09IHJlZ2lvbi5pZCkuZmlsdGVyKFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbiA9PiBkZXN0aW5hdGlvbi5pblBsYXkoKSkudW5pcSgpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBtYXJjaExpbWl0ID0gaGFzQ2Flc2FyID8gMyA6IGlzUm9tYW5zIHx8IGhhc1ZlcmNpbmdldG9yaXggPyAyIDogMTtcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbnMgPSBfKGRlc3RpbmF0aW9ucykuZmlsdGVyKChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRocyA9IF8oTWFwLmZpbmRQYXRoc1RvUmVnaW9uKHN0YXRlLCByZWdpb24uaWQsIGRlc3RpbmF0aW9uLmlkLCBtYXJjaExpbWl0KSkucmVqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgKHBhdGgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc0ludmFsaWRNYXJjaFBhdGgoc3RhdGUsIHBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhzLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgIGxldCBjb3N0ID0gcmVnaW9uLmRldmFzdGF0ZWQoKSA/IDIgOiAxO1xuICAgICAgICAgICAgICAgIGlmIChpc1JvbWFucykge1xuICAgICAgICAgICAgICAgICAgICBjb3N0ICo9IDI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlzR2VybWFuaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29zdCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXJjaFJlc3VsdHMoXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbjogZmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vYmlsZVBpZWNlczogbW9iaWxlRmFjdGlvblBpZWNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkamFjZW50RGVzdGluYXRpb25zOiBmaXJzdFJlZ2lvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbnM6IGRlc3RpbmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc3Q6IGNvc3RcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNJbnZhbGlkTWFyY2hQYXRoKHN0YXRlLCBwYXRoKSB7XG4gICAgICAgIGlmIChwYXRoLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEJyaXRhbm5pYVxuICAgICAgICBsZXQgc3ViUGF0aCA9IHBhdGguc2xpY2UoMCwgcGF0aC5sZW5ndGggLSAxKTtcbiAgICAgICAgaWYgKF8uaW5kZXhPZihzdWJQYXRoLCBSZWdpb25JRHMuQlJJVEFOTklBKSA+PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERldmFzdGF0ZWRcbiAgICAgICAgc3ViUGF0aCA9IHBhdGguc2xpY2UoMSwgcGF0aC5sZW5ndGggLSAxKTtcbiAgICAgICAgaWYgKF8uZmluZChzdWJQYXRoLCBpZCA9PiBzdGF0ZS5yZWdpb25zQnlJZFtpZF0uZGV2YXN0YXRlZCgpKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSaGVudXNcbiAgICAgICAgaWYgKF8uZmluZChfLnJhbmdlKDEsIHBhdGgubGVuZ3RoIC0gMSksIChpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyb20gPSBwYXRoW2luZGV4IC0gMV07XG4gICAgICAgICAgICAgICAgY29uc3QgdG8gPSBwYXRoW2luZGV4XTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcm9zc2VzUmhlbnVzKHN0YXRlLCBmcm9tLCB0byk7XG5cbiAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBjcm9zc2VzUmhlbnVzKHN0YXRlLCBmcm9tSWQsIHRvSWQpIHtcbiAgICAgICAgY29uc3QgZnJvbVJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW2Zyb21JZF07XG4gICAgICAgIGNvbnN0IHRvUmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdG9JZF07XG5cbiAgICAgICAgcmV0dXJuIChmcm9tUmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuR0VSTUFOSUEgfHwgdG9SZWdpb24uZ3JvdXAgPT09IFJlZ2lvbkdyb3Vwcy5HRVJNQU5JQSkgJiZcbiAgICAgICAgICAgICAgICEoZnJvbVJlZ2lvbi5ncm91cCA9PT0gUmVnaW9uR3JvdXBzLkdFUk1BTklBICYmIHRvUmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuR0VSTUFOSUEpO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBNYXJjaDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvbWFyY2guanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _rallyRegionResults = __webpack_require__(159);\n\nvar _rallyRegionResults2 = _interopRequireDefault(_rallyRegionResults);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeCitadel = __webpack_require__(33);\n\nvar _placeCitadel2 = _interopRequireDefault(_placeCitadel);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _placeAuxilia = __webpack_require__(32);\n\nvar _placeAuxilia2 = _interopRequireDefault(_placeAuxilia);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Rally = function (_Command) {\n    _inherits(Rally, _Command);\n\n    function Rally() {\n        _classCallCheck(this, Rally);\n\n        return _possibleConstructorReturn(this, (Rally.__proto__ || Object.getPrototypeOf(Rally)).apply(this, arguments));\n    }\n\n    _createClass(Rally, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var faction = args.faction;\n            var regions = args.regions;\n            return this.generateResultsForRegions(state, faction, regions || state.regions);\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            console.log('*** ' + args.faction.name + ' ' + (args.faction.id === _factionIds2.default.ROMANS ? 'Recruit' : 'Rally') + ' *** ');\n            var faction = args.faction;\n            var regionResult = args.regionResult;\n\n            var factionPieces = regionResult.region.getPiecesForFaction(faction.id);\n\n            var isArverni = faction.id === _factionIds2.default.ARVERNI;\n            var isGermanic = faction.id === _factionIds2.default.GERMANIC_TRIBES;\n            var hasVercingetorix = isArverni && _lodash2.default.find(factionPieces, function (piece) {\n                return piece.type === 'leader' && !piece.isSuccessor();\n            });\n\n            var citadelAdded = false;\n            var allyAdded = false;\n            var warbandsAdded = false;\n            var auxiliaAdded = false;\n\n            var actions = [];\n\n            if (regionResult.addCitadel && faction.availableCitadels().length > 0) {\n                var tribeForCity = regionResult.region.getAlliedCityForFaction(faction.id);\n                actions.push(new _placeCitadel2.default({ factionId: faction.id, regionId: regionResult.region.id, tribeId: tribeForCity.id }));\n                citadelAdded = true;\n            }\n\n            if (!citadelAdded && regionResult.addAlly && faction.availableAlliedTribes().length > 0) {\n                var tribeForAlly = (0, _lodash2.default)(regionResult.region.subduedTribesForFaction(faction.id)).sortBy(function (tribe) {\n                    return tribe.isCity ? 'a' : 'b';\n                }).groupBy(function (tribe) {\n                    return tribe.isCity ? 'a' : 'b';\n                }).map(_lodash2.default.shuffle).flatten().first();\n\n                actions.push(new _placeAlliedTribe2.default({ factionId: faction.id, regionId: regionResult.region.id, tribeId: tribeForAlly.id }));\n                allyAdded = true;\n            }\n\n            if (!citadelAdded && !allyAdded || hasVercingetorix || isGermanic) {\n                if (regionResult.addNumAuxilia > 0 && faction.availableAuxilia().length > 0) {\n                    actions.push(new _placeAuxilia2.default({\n                        factionId: faction.id,\n                        regionId: regionResult.region.id,\n                        count: Math.min(regionResult.addNumAuxilia, faction.availableAuxilia().length)\n                    }));\n                    auxiliaAdded = true;\n                }\n\n                if (regionResult.addNumWarbands > 0 && faction.availableWarbands().length > 0) {\n                    actions.push(new _placeWarbands2.default({\n                        factionId: faction.id,\n                        regionId: regionResult.region.id,\n                        count: Math.min(regionResult.addNumWarbands, faction.availableWarbands().length)\n                    }));\n                    warbandsAdded = true;\n                }\n            }\n\n            if (citadelAdded || allyAdded || warbandsAdded || auxiliaAdded) {\n                _lodash2.default.each(actions, function (action) {\n                    return action.execute(state);\n                });\n            }\n        }\n    }, {\n        key: 'generateResultsForRegions',\n        value: function generateResultsForRegions(state, faction, regions) {\n            return (0, _lodash2.default)(regions).map(function (region) {\n\n                var factionPieces = region.getPiecesForFaction(faction.id);\n\n                var isRomans = faction.id === _factionIds2.default.ROMANS;\n                var isArverni = faction.id === _factionIds2.default.ARVERNI;\n                var isBelgae = faction.id === _factionIds2.default.BELGAE;\n                var isGermanic = faction.id === _factionIds2.default.GERMANIC_TRIBES;\n\n                var hasLeader = _lodash2.default.find(factionPieces, function (piece) {\n                    return piece.type === 'leader' && !piece.isSuccessor();\n                });\n\n                var hasVercingetorix = hasLeader && isArverni;\n                var hasCaesar = hasLeader && isRomans;\n\n                if (region.devastated() && !hasVercingetorix) {\n                    return;\n                }\n\n                var isBelgaeOutsideOfBelgica = isBelgae && region.group !== _regionGroups2.default.BELGICA;\n                var cost = isRomans ? 2 : isGermanic ? 0 : region.devastated() || isBelgaeOutsideOfBelgica ? 2 : 1;\n\n                var allyAdded = false;\n                var citadelAdded = false;\n                var numWarbandsOrAuxiliaAdded = 0;\n\n                var hasAllyInCity = region.getAlliedCityForFaction(faction.id);\n                if (hasAllyInCity && faction.availableCitadels().length > 0) {\n                    citadelAdded = true;\n                }\n\n                var hasSubduedTribe = region.subduedTribesForFaction(faction.id).length > 0;\n                if (hasSubduedTribe && faction.availableAlliedTribes().length > 0 && (region.controllingFactionId() === faction.id || hasVercingetorix || hasCaesar)) {\n                    allyAdded = true;\n                }\n\n                var countedPieces = _lodash2.default.countBy(factionPieces, 'type');\n                numWarbandsOrAuxiliaAdded += (countedPieces.alliedtribe || 0) + (countedPieces.citadel || 0);\n                if (isArverni) {\n                    if (countedPieces.leader) {\n                        numWarbandsOrAuxiliaAdded += 1;\n                    }\n                    if (numWarbandsOrAuxiliaAdded) {\n                        numWarbandsOrAuxiliaAdded += 1;\n                    }\n                }\n\n                if (isRomans) {\n                    if (countedPieces.leader) {\n                        numWarbandsOrAuxiliaAdded += 1;\n                    }\n                }\n\n                if (numWarbandsOrAuxiliaAdded === 0 && faction.isHomeRegion(region)) {\n                    numWarbandsOrAuxiliaAdded += 1;\n                }\n\n                if (!isRomans && state.hasShadedCapability(_capabilities.CapabilityIDs.AQUITANI, faction.id) && (region.id === _regionIds2.default.PICTONES || region.id === _regionIds2.default.ARVERNI)) {\n                    numWarbandsOrAuxiliaAdded += 2;\n                }\n\n                var numWarbandsAdded = 0;\n                var numAuxiliaAdded = 0;\n                if (isRomans) {\n                    numAuxiliaAdded = Math.min(numWarbandsOrAuxiliaAdded, faction.availableAuxilia().length);\n                } else {\n                    numWarbandsAdded = Math.min(numWarbandsOrAuxiliaAdded, faction.availableWarbands().length);\n                }\n\n                if (allyAdded || citadelAdded || numWarbandsAdded > 0 || numAuxiliaAdded > 0) {\n                    return new _rallyRegionResults2.default({\n                        region: region,\n                        faction: faction,\n                        cost: cost,\n                        canAddAlly: allyAdded,\n                        canAddCitadel: citadelAdded,\n                        canAddNumWarbands: numWarbandsAdded,\n                        canAddNumAuxilia: numAuxiliaAdded\n                    });\n                }\n            }).compact().value();\n        }\n    }]);\n\n    return Rally;\n}(_command2.default);\n\nexports.default = Rally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcmFsbHkuanM/Y2ZiNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kIGZyb20gJy4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBSYWxseVJlZ2lvblJlc3VsdHMgZnJvbSAnLi9yYWxseVJlZ2lvblJlc3VsdHMnO1xuXG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFBsYWNlQ2l0YWRlbCAgZnJvbSAnLi4vYWN0aW9ucy9wbGFjZUNpdGFkZWwnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyAgZnJvbSAnLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IFBsYWNlV2FyYmFuZHMgIGZyb20gJy4uL2FjdGlvbnMvcGxhY2VXYXJiYW5kcyc7XG5pbXBvcnQgUGxhY2VBdXhpbGlhICBmcm9tICcuLi9hY3Rpb25zL3BsYWNlQXV4aWxpYSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHN9IGZyb20gJy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuXG5cbmNsYXNzIFJhbGx5IGV4dGVuZHMgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBhcmdzLmZhY3Rpb247XG4gICAgICAgIGNvbnN0IHJlZ2lvbnMgPSBhcmdzLnJlZ2lvbnM7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlUmVzdWx0c0ZvclJlZ2lvbnMoc3RhdGUsIGZhY3Rpb24sIHJlZ2lvbnMgfHwgc3RhdGUucmVnaW9ucyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvRXhlY3V0ZShzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICcqKiogJyArIGFyZ3MuZmFjdGlvbi5uYW1lICsgJyAnICsgKGFyZ3MuZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMgPyAnUmVjcnVpdCcgOiAnUmFsbHknKSArICcgKioqICcpO1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gYXJncy5mYWN0aW9uO1xuICAgICAgICBjb25zdCByZWdpb25SZXN1bHQgPSBhcmdzLnJlZ2lvblJlc3VsdDtcblxuICAgICAgICBjb25zdCBmYWN0aW9uUGllY2VzID0gcmVnaW9uUmVzdWx0LnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb24uaWQpO1xuXG4gICAgICAgIGNvbnN0IGlzQXJ2ZXJuaSA9IGZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQVJWRVJOSTtcbiAgICAgICAgY29uc3QgaXNHZXJtYW5pYyA9IGZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuICAgICAgICBjb25zdCBoYXNWZXJjaW5nZXRvcml4ID0gaXNBcnZlcm5pICYmIF8uZmluZChcbiAgICAgICAgICAgICAgICBmYWN0aW9uUGllY2VzLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBpZWNlLnR5cGUgPT09ICdsZWFkZXInICYmICFwaWVjZS5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBjaXRhZGVsQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGFsbHlBZGRlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgd2FyYmFuZHNBZGRlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgYXV4aWxpYUFkZGVkID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgYWN0aW9ucyA9IFtdO1xuXG4gICAgICAgIGlmIChyZWdpb25SZXN1bHQuYWRkQ2l0YWRlbCAmJiBmYWN0aW9uLmF2YWlsYWJsZUNpdGFkZWxzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdHJpYmVGb3JDaXR5ID0gcmVnaW9uUmVzdWx0LnJlZ2lvbi5nZXRBbGxpZWRDaXR5Rm9yRmFjdGlvbihmYWN0aW9uLmlkKTtcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgUGxhY2VDaXRhZGVsKHtmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsIHJlZ2lvbklkOiByZWdpb25SZXN1bHQucmVnaW9uLmlkLCB0cmliZUlkOiB0cmliZUZvckNpdHkuaWR9KSk7XG4gICAgICAgICAgICBjaXRhZGVsQWRkZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjaXRhZGVsQWRkZWQgJiYgcmVnaW9uUmVzdWx0LmFkZEFsbHkgJiYgZmFjdGlvbi5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCB0cmliZUZvckFsbHkgPSBfKHJlZ2lvblJlc3VsdC5yZWdpb24uc3ViZHVlZFRyaWJlc0ZvckZhY3Rpb24oZmFjdGlvbi5pZCkpLnNvcnRCeShcbiAgICAgICAgICAgICAgICB0cmliZSA9PiB0cmliZS5pc0NpdHkgPyAnYScgOiAnYicpLmdyb3VwQnkoXG4gICAgICAgICAgICAgICAgdHJpYmUgPT4gdHJpYmUuaXNDaXR5ID8gJ2EnIDogJ2InKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcblxuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKG5ldyBQbGFjZUFsbGllZFRyaWJlKFxuICAgICAgICAgICAgICAgIHtmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsIHJlZ2lvbklkOiByZWdpb25SZXN1bHQucmVnaW9uLmlkLCB0cmliZUlkOiB0cmliZUZvckFsbHkuaWR9KSk7XG4gICAgICAgICAgICBhbGx5QWRkZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCghY2l0YWRlbEFkZGVkICYmICFhbGx5QWRkZWQpIHx8IGhhc1ZlcmNpbmdldG9yaXggfHwgaXNHZXJtYW5pYykge1xuICAgICAgICAgICAgaWYgKHJlZ2lvblJlc3VsdC5hZGROdW1BdXhpbGlhID4gMCAmJiBmYWN0aW9uLmF2YWlsYWJsZUF1eGlsaWEoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKG5ldyBQbGFjZUF1eGlsaWEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb25SZXN1bHQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogTWF0aC5taW4ocmVnaW9uUmVzdWx0LmFkZE51bUF1eGlsaWEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uLmF2YWlsYWJsZUF1eGlsaWEoKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIGF1eGlsaWFBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHMgPiAwICYmIGZhY3Rpb24uYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKG5ldyBQbGFjZVdhcmJhbmRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogZmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb25SZXN1bHQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IE1hdGgubWluKHJlZ2lvblJlc3VsdC5hZGROdW1XYXJiYW5kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgd2FyYmFuZHNBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2l0YWRlbEFkZGVkIHx8IGFsbHlBZGRlZCB8fCB3YXJiYW5kc0FkZGVkIHx8IGF1eGlsaWFBZGRlZCkge1xuICAgICAgICAgICAgXy5lYWNoKGFjdGlvbnMsIGFjdGlvbiA9PiBhY3Rpb24uZXhlY3V0ZShzdGF0ZSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdlbmVyYXRlUmVzdWx0c0ZvclJlZ2lvbnMoc3RhdGUsIGZhY3Rpb24sIHJlZ2lvbnMpIHtcbiAgICAgICAgcmV0dXJuIF8ocmVnaW9ucykubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlZ2lvbikge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvblBpZWNlcyA9IHJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb24uaWQpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaXNSb21hbnMgPSBmYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLlJPTUFOUztcbiAgICAgICAgICAgICAgICBjb25zdCBpc0FydmVybmkgPSBmYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkFSVkVSTkk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNCZWxnYWUgPSBmYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLkJFTEdBRTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0dlcm1hbmljID0gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVM7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBoYXNMZWFkZXIgPSBfLmZpbmQoZmFjdGlvblBpZWNlcywgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnbGVhZGVyJyAmJiAhcGllY2UuaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc1ZlcmNpbmdldG9yaXggPSBoYXNMZWFkZXIgJiYgaXNBcnZlcm5pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0NhZXNhciA9IGhhc0xlYWRlciAmJiBpc1JvbWFucztcblxuICAgICAgICAgICAgICAgIGlmIChyZWdpb24uZGV2YXN0YXRlZCgpICYmICFoYXNWZXJjaW5nZXRvcml4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBpc0JlbGdhZU91dHNpZGVPZkJlbGdpY2EgPSAoaXNCZWxnYWUgJiYgcmVnaW9uLmdyb3VwICE9PSBSZWdpb25Hcm91cHMuQkVMR0lDQSk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IGlzUm9tYW5zID8gMiA6IGlzR2VybWFuaWMgPyAwIDogKHJlZ2lvbi5kZXZhc3RhdGVkKCkgfHwgaXNCZWxnYWVPdXRzaWRlT2ZCZWxnaWNhID8gMiA6IDEpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGFsbHlBZGRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGxldCBjaXRhZGVsQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgbnVtV2FyYmFuZHNPckF1eGlsaWFBZGRlZCA9IDA7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbGx5SW5DaXR5ID0gcmVnaW9uLmdldEFsbGllZENpdHlGb3JGYWN0aW9uKGZhY3Rpb24uaWQpO1xuICAgICAgICAgICAgICAgIGlmIChoYXNBbGx5SW5DaXR5ICYmIGZhY3Rpb24uYXZhaWxhYmxlQ2l0YWRlbHMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNpdGFkZWxBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzU3ViZHVlZFRyaWJlID0gcmVnaW9uLnN1YmR1ZWRUcmliZXNGb3JGYWN0aW9uKGZhY3Rpb24uaWQpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1N1YmR1ZWRUcmliZSAmJiBmYWN0aW9uLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCA+IDAgJiYgKHJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBmYWN0aW9uLmlkIHx8IGhhc1ZlcmNpbmdldG9yaXggfHwgaGFzQ2Flc2FyKSkge1xuICAgICAgICAgICAgICAgICAgICBhbGx5QWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ZWRQaWVjZXMgPSBfLmNvdW50QnkoZmFjdGlvblBpZWNlcywgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICBudW1XYXJiYW5kc09yQXV4aWxpYUFkZGVkICs9IChjb3VudGVkUGllY2VzLmFsbGllZHRyaWJlIHx8IDApICsgKGNvdW50ZWRQaWVjZXMuY2l0YWRlbCB8fCAwKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnZlcm5pKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb3VudGVkUGllY2VzLmxlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtV2FyYmFuZHNPckF1eGlsaWFBZGRlZCArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW1XYXJiYW5kc09yQXV4aWxpYUFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1XYXJiYW5kc09yQXV4aWxpYUFkZGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNSb21hbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZWRQaWVjZXMubGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1XYXJiYW5kc09yQXV4aWxpYUFkZGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobnVtV2FyYmFuZHNPckF1eGlsaWFBZGRlZCA9PT0gMCAmJiBmYWN0aW9uLmlzSG9tZVJlZ2lvbihyZWdpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzT3JBdXhpbGlhQWRkZWQgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWlzUm9tYW5zICYmIHN0YXRlLmhhc1NoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5BUVVJVEFOSSwgZmFjdGlvbi5pZCkgJiZcbiAgICAgICAgICAgICAgICAgICAgKHJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLlBJQ1RPTkVTIHx8IHJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLkFSVkVSTkkpKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzT3JBdXhpbGlhQWRkZWQgKz0gMjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgbnVtV2FyYmFuZHNBZGRlZCA9IDA7XG4gICAgICAgICAgICAgICAgbGV0IG51bUF1eGlsaWFBZGRlZCA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKGlzUm9tYW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bUF1eGlsaWFBZGRlZCA9IE1hdGgubWluKG51bVdhcmJhbmRzT3JBdXhpbGlhQWRkZWQsIGZhY3Rpb24uYXZhaWxhYmxlQXV4aWxpYSgpLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBudW1XYXJiYW5kc0FkZGVkID0gTWF0aC5taW4obnVtV2FyYmFuZHNPckF1eGlsaWFBZGRlZCwgZmFjdGlvbi5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFsbHlBZGRlZCB8fCBjaXRhZGVsQWRkZWQgfHwgbnVtV2FyYmFuZHNBZGRlZCA+IDAgfHwgbnVtQXV4aWxpYUFkZGVkID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJhbGx5UmVnaW9uUmVzdWx0cyhcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uOiBmYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvc3Q6IGNvc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuQWRkQWxseTogYWxseUFkZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkFkZENpdGFkZWw6IGNpdGFkZWxBZGRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5BZGROdW1XYXJiYW5kczogbnVtV2FyYmFuZHNBZGRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5BZGROdW1BdXhpbGlhOiBudW1BdXhpbGlhQWRkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJhbGx5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9yYWxseS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFDQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7QUFFQTs7Ozs7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBRUE7QUFFQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Logging = function () {\n    function Logging() {\n        _classCallCheck(this, Logging);\n    }\n\n    _createClass(Logging, null, [{\n        key: 'logPieces',\n        value: function logPieces(pieces) {\n            _lodash2.default.each(this.getPiecesList(pieces), function (piece) {\n                console.log('    ' + piece);\n            });\n        }\n    }, {\n        key: 'getPiecesList',\n        value: function getPiecesList(pieces) {\n            var list = [];\n\n            var piecesByType = _lodash2.default.groupBy(pieces, 'type');\n\n            var leaders = piecesByType.leader;\n            _lodash2.default.each(leaders, function (leader) {\n                list.push(leader.toString());\n            });\n\n            var citadels = piecesByType.citadel;\n            _lodash2.default.each(citadels, function (citadel) {\n                list.push(citadel.tribeId + ' Citadel');\n            });\n\n            var forts = piecesByType.fort;\n            if (forts) {\n                list.push('Roman Fort');\n            }\n\n            var allies = piecesByType.alliedtribe;\n            _lodash2.default.each(allies, function (ally) {\n                list.push(ally.tribeId + ' Ally');\n            });\n\n            var legions = piecesByType.legion;\n            if (legions) {\n                list.push(legions.length + 'x Legions');\n            }\n\n            var status = void 0;\n            var warbands = piecesByType.warband;\n            if (warbands) {\n                status = _lodash2.default.groupBy(warbands, function (warband) {\n                    return warband.revealed() ? 'revealed' : 'hidden';\n                });\n                list.push(warbands.length + 'x Warbands (' + (status.hidden ? status.hidden.length : 0) + ' hidden, ' + (status.revealed ? status.revealed.length : 0) + ' revealed)');\n            }\n\n            var auxilia = piecesByType.auxilia;\n            if (auxilia) {\n                status = _lodash2.default.groupBy(auxilia, function (auxilia) {\n                    return auxilia.revealed() ? 'revealed' : 'hidden';\n                });\n                list.push(auxilia.length + 'x Auxilia (' + (status.hidden ? status.hidden.length : 0) + ' hidden, ' + (status.revealed ? status.revealed.length : 0) + ' revealed)');\n            }\n\n            return list;\n        }\n    }]);\n\n    return Logging;\n}();\n\nexports.default = Logging;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvdXRpbC9sb2dnaW5nLmpzPzY4MTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5cbmNsYXNzIExvZ2dpbmcge1xuXG4gICAgc3RhdGljIGxvZ1BpZWNlcyhwaWVjZXMpIHtcbiAgICAgICAgXy5lYWNoKHRoaXMuZ2V0UGllY2VzTGlzdChwaWVjZXMpLCAocGllY2UpPT57XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnICAgICcgKyBwaWVjZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQaWVjZXNMaXN0KHBpZWNlcykge1xuICAgICAgICBjb25zdCBsaXN0ID0gW107XG5cbiAgICAgICAgY29uc3QgcGllY2VzQnlUeXBlID0gXy5ncm91cEJ5KHBpZWNlcywgJ3R5cGUnKTtcblxuICAgICAgICBjb25zdCBsZWFkZXJzID0gcGllY2VzQnlUeXBlLmxlYWRlcjtcbiAgICAgICAgXy5lYWNoKGxlYWRlcnMsIGZ1bmN0aW9uIChsZWFkZXIpIHtcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2gobGVhZGVyLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY2l0YWRlbHMgPSBwaWVjZXNCeVR5cGUuY2l0YWRlbDtcbiAgICAgICAgXy5lYWNoKGNpdGFkZWxzLCBmdW5jdGlvbiAoY2l0YWRlbCkge1xuICAgICAgICAgICAgICAgIGxpc3QucHVzaChjaXRhZGVsLnRyaWJlSWQgKyAnIENpdGFkZWwnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGZvcnRzID0gcGllY2VzQnlUeXBlLmZvcnQ7XG4gICAgICAgIGlmIChmb3J0cykge1xuICAgICAgICAgICAgbGlzdC5wdXNoKCdSb21hbiBGb3J0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbGxpZXMgPSBwaWVjZXNCeVR5cGUuYWxsaWVkdHJpYmU7XG4gICAgICAgIF8uZWFjaChhbGxpZXMsIGZ1bmN0aW9uIChhbGx5KSB7XG4gICAgICAgICAgICAgICAgbGlzdC5wdXNoKGFsbHkudHJpYmVJZCArICcgQWxseScpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgbGVnaW9ucyA9IHBpZWNlc0J5VHlwZS5sZWdpb247XG4gICAgICAgIGlmIChsZWdpb25zKSB7XG4gICAgICAgICAgICBsaXN0LnB1c2gobGVnaW9ucy5sZW5ndGggKyAneCBMZWdpb25zJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc3RhdHVzO1xuICAgICAgICBjb25zdCB3YXJiYW5kcyA9IHBpZWNlc0J5VHlwZS53YXJiYW5kO1xuICAgICAgICBpZiAod2FyYmFuZHMpIHtcbiAgICAgICAgICAgIHN0YXR1cyA9IF8uZ3JvdXBCeSh3YXJiYW5kcywgZnVuY3Rpb24gKHdhcmJhbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdhcmJhbmQucmV2ZWFsZWQoKSA/ICdyZXZlYWxlZCcgOiAnaGlkZGVuJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxpc3QucHVzaCh3YXJiYW5kcy5sZW5ndGggKyAneCBXYXJiYW5kcyAoJyArXG4gICAgICAgICAgICAgICAgKHN0YXR1cy5oaWRkZW4gPyBzdGF0dXMuaGlkZGVuLmxlbmd0aCA6IDApICsgJyBoaWRkZW4sICcgK1xuICAgICAgICAgICAgICAgIChzdGF0dXMucmV2ZWFsZWQgPyBzdGF0dXMucmV2ZWFsZWQubGVuZ3RoIDogMCkgKyAnIHJldmVhbGVkKScpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXV4aWxpYSA9IHBpZWNlc0J5VHlwZS5hdXhpbGlhO1xuICAgICAgICBpZiAoYXV4aWxpYSkge1xuICAgICAgICAgICAgc3RhdHVzID0gXy5ncm91cEJ5KGF1eGlsaWEsIGZ1bmN0aW9uIChhdXhpbGlhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhdXhpbGlhLnJldmVhbGVkKCkgPyAncmV2ZWFsZWQnIDogJ2hpZGRlbic7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsaXN0LnB1c2goYXV4aWxpYS5sZW5ndGggKyAneCBBdXhpbGlhICgnICtcbiAgICAgICAgICAgICAgICAoc3RhdHVzLmhpZGRlbiA/IHN0YXR1cy5oaWRkZW4ubGVuZ3RoIDogMCkgKyAnIGhpZGRlbiwgJyArXG4gICAgICAgICAgICAgICAgKHN0YXR1cy5yZXZlYWxlZCA/IHN0YXR1cy5yZXZlYWxlZC5sZW5ndGggOiAwKSArICcgcmV2ZWFsZWQpJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbGlzdDtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9nZ2luZztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvdXRpbC9sb2dnaW5nLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Map = function () {\n    function Map() {\n        _classCallCheck(this, Map);\n    }\n\n    _createClass(Map, null, [{\n        key: 'findMinimumAdjacent',\n        value: function findMinimumAdjacent(regions) {\n            var _this = this;\n\n            var numRegions = regions.length;\n            var regionIds = _lodash2.default.map(regions, 'id');\n            var possibleDestinationIds = (0, _lodash2.default)(regions).map(function (region) {\n                return (0, _lodash2.default)(region.adjacent).map('id').reject(function (id) {\n                    return _lodash2.default.indexOf(regionIds, id) >= 0;\n                }).value();\n            }).value();\n            var union = _lodash2.default.reduce(possibleDestinationIds, function (union, destinations) {\n                return _lodash2.default.union(union, destinations);\n            }, []);\n            var rankings = this.generateRankings(union, possibleDestinationIds);\n            var groupedRankings = _lodash2.default.groupBy(rankings, 'count');\n\n            if (groupedRankings[numRegions]) {\n                return _lodash2.default.map(groupedRankings[numRegions], function (ranking) {\n                    return [ranking];\n                });\n            }\n\n            var solutions = [];\n            var groupsToCheck = _lodash2.default.range(1, numRegions).reverse();\n            _lodash2.default.each(groupsToCheck, function (groupId) {\n                var rankingGroup = groupedRankings[groupId];\n                var solutionsForGroup = _this.generateSolutionsForGroup(rankings, groupedRankings, rankingGroup, groupId);\n                if (solutionsForGroup.length > 0) {\n                    solutions = solutionsForGroup;\n                    return false;\n                }\n            });\n            return solutions;\n        }\n    }, {\n        key: 'findPathsToRegion',\n        value: function findPathsToRegion(state, startRegionId, targetId) {\n            var limit = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n\n            var paths = [];\n            var visited = [startRegionId];\n            this.depthFirst(paths, state.regionsById, targetId, visited, limit);\n            return _lodash2.default.sortBy(paths, function (path) {\n                return path.length;\n            });\n        }\n    }, {\n        key: 'measureDistanceToRegion',\n        value: function measureDistanceToRegion(state, startRegionId, targetId) {\n            if (startRegionId === targetId) {\n                return 0;\n            }\n            var paths = this.findPathsToRegion(state, startRegionId, targetId, 5); // None are more than 4 away by shortest distance\n            return paths[0].length - 1;\n        }\n    }, {\n        key: 'depthFirst',\n        value: function depthFirst(paths, regionsById, targetId, visited, limit) {\n            var _this2 = this;\n\n            var adjacentRegions = regionsById[_lodash2.default.last(visited)].adjacent;\n\n            _lodash2.default.each(adjacentRegions, function (region) {\n                if (_lodash2.default.indexOf(visited, region.id) >= 0 || !region.inPlay()) {\n                    return;\n                }\n\n                if (region.id === targetId) {\n                    visited.push(targetId);\n                    paths.push(_lodash2.default.clone(visited));\n                    visited.pop();\n                    return false;\n                }\n            });\n\n            _lodash2.default.each(adjacentRegions, function (region) {\n                if (visited.length >= limit || _lodash2.default.indexOf(visited, region.id) >= 0 || !region.inPlay() || _lodash2.default.intersection(_lodash2.default.initial(visited), _lodash2.default.map(region.adjacent, 'id')).length > 0 || region.id === targetId) {\n                    return;\n                }\n                visited.push(region.id);\n                _this2.depthFirst(paths, regionsById, targetId, visited, limit);\n                visited.pop();\n            });\n        }\n    }, {\n        key: 'generateRankings',\n        value: function generateRankings(allAdjacentRegions, adjacentPerStartRegion) {\n            var allSets = _lodash2.default.range(0, adjacentPerStartRegion.length);\n            return (0, _lodash2.default)(allAdjacentRegions).map(function (id) {\n                var count = 0;\n                var sets = [];\n                _lodash2.default.each(adjacentPerStartRegion, function (possibleIds, index) {\n                    var found = _lodash2.default.indexOf(possibleIds, id) >= 0;\n                    if (found) {\n                        count += 1;\n                        sets.push(index);\n                    }\n                });\n                sets.sort();\n                return {\n                    id: id,\n                    sets: sets,\n                    remaining: _lodash2.default.difference(allSets, sets),\n                    count: count\n                };\n            }).sortBy('count').reverse().value();\n        }\n    }, {\n        key: 'generateSolutionsForGroup',\n        value: function generateSolutionsForGroup(rankings, groupedRankings, rankingGroup, groupId) {\n            var uncheckedRankings = [];\n            _lodash2.default.each(_lodash2.default.range(1, groupId + 1).reverse(), function (id) {\n                uncheckedRankings = _lodash2.default.concat(uncheckedRankings, groupedRankings[id]);\n            });\n\n            return (0, _lodash2.default)(rankingGroup).map(function (ranking) {\n                var solutionsForRegion = [];\n\n                if (ranking.count <= 1) {\n                    return;\n                }\n\n                if (ranking.remaining.length === 0) {\n                    solutionsForRegion.push([ranking.id]);\n                } else {\n                    var regions = _lodash2.default.clone(rankings);\n\n                    var _loop = function _loop() {\n                        var solution = [ranking];\n                        var remaining = _lodash2.default.clone(ranking.remaining);\n                        _lodash2.default.each(regions, function (otherRanking) {\n                            var difference = _lodash2.default.difference(remaining, otherRanking.sets);\n                            if (difference.length === 0 || difference.length <= remaining.length - otherRanking.sets.length) {\n                                solution.push(otherRanking);\n                            }\n                            remaining = difference;\n                            if (difference.length === 0) {\n                                return false;\n                            }\n                        });\n                        solution.sort();\n                        if (remaining.length === 0) {\n                            solutionsForRegion.push(solution);\n                        }\n                        regions.shift();\n                    };\n\n                    while (regions.length > 0) {\n                        _loop();\n                    }\n                }\n                return {\n                    id: ranking.id,\n                    solutions: solutionsForRegion\n                };\n            }).compact().map('solutions').flatten().uniqWith(_lodash2.default.isEqual).orderBy(function (solution) {\n                return solution.length;\n            }).value();\n        }\n    }]);\n\n    return Map;\n}();\n\nexports.default = Map;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvdXRpbC9tYXAuanM/Njc1NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcblxuY2xhc3MgTWFwIHtcblxuICAgIHN0YXRpYyBmaW5kTWluaW11bUFkamFjZW50KHJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3QgbnVtUmVnaW9ucyA9IHJlZ2lvbnMubGVuZ3RoO1xuICAgICAgICBjb25zdCByZWdpb25JZHMgPSBfLm1hcChyZWdpb25zLCAnaWQnKTtcbiAgICAgICAgY29uc3QgcG9zc2libGVEZXN0aW5hdGlvbklkcyA9IF8ocmVnaW9ucykubWFwKFxuICAgICAgICAgICAgcmVnaW9uID0+IF8ocmVnaW9uLmFkamFjZW50KS5tYXAoJ2lkJykucmVqZWN0KGlkID0+IF8uaW5kZXhPZihyZWdpb25JZHMsIGlkKSA+PSAwKS52YWx1ZSgpKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCB1bmlvbiA9IF8ucmVkdWNlKHBvc3NpYmxlRGVzdGluYXRpb25JZHMsICh1bmlvbiwgZGVzdGluYXRpb25zKSA9PiBfLnVuaW9uKHVuaW9uLCBkZXN0aW5hdGlvbnMpLCBbXSk7XG4gICAgICAgIGNvbnN0IHJhbmtpbmdzID0gdGhpcy5nZW5lcmF0ZVJhbmtpbmdzKHVuaW9uLCBwb3NzaWJsZURlc3RpbmF0aW9uSWRzKTtcbiAgICAgICAgY29uc3QgZ3JvdXBlZFJhbmtpbmdzID0gXy5ncm91cEJ5KHJhbmtpbmdzLCAnY291bnQnKTtcblxuICAgICAgICBpZiAoZ3JvdXBlZFJhbmtpbmdzW251bVJlZ2lvbnNdKSB7XG4gICAgICAgICAgICByZXR1cm4gXy5tYXAoXG4gICAgICAgICAgICAgICAgZ3JvdXBlZFJhbmtpbmdzW251bVJlZ2lvbnNdLCByYW5raW5nID0+IFtyYW5raW5nXSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc29sdXRpb25zID0gW107XG4gICAgICAgIGNvbnN0IGdyb3Vwc1RvQ2hlY2sgPSBfLnJhbmdlKDEsIG51bVJlZ2lvbnMpLnJldmVyc2UoKTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgZ3JvdXBzVG9DaGVjaywgKGdyb3VwSWQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5raW5nR3JvdXAgPSBncm91cGVkUmFua2luZ3NbZ3JvdXBJZF07XG4gICAgICAgICAgICAgICAgY29uc3Qgc29sdXRpb25zRm9yR3JvdXAgPSB0aGlzLmdlbmVyYXRlU29sdXRpb25zRm9yR3JvdXAocmFua2luZ3MsIGdyb3VwZWRSYW5raW5ncywgcmFua2luZ0dyb3VwLCBncm91cElkKTtcbiAgICAgICAgICAgICAgICBpZiAoc29sdXRpb25zRm9yR3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzb2x1dGlvbnMgPSBzb2x1dGlvbnNGb3JHcm91cDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc29sdXRpb25zO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kUGF0aHNUb1JlZ2lvbihzdGF0ZSwgc3RhcnRSZWdpb25JZCwgdGFyZ2V0SWQsIGxpbWl0PTEwKSB7XG4gICAgICAgIGNvbnN0IHBhdGhzID0gW107XG4gICAgICAgIGNvbnN0IHZpc2l0ZWQgPSBbc3RhcnRSZWdpb25JZF07XG4gICAgICAgIHRoaXMuZGVwdGhGaXJzdChwYXRocywgc3RhdGUucmVnaW9uc0J5SWQsIHRhcmdldElkLCB2aXNpdGVkLCBsaW1pdCk7XG4gICAgICAgIHJldHVybiBfLnNvcnRCeShwYXRocywgcGF0aCA9PiBwYXRoLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIG1lYXN1cmVEaXN0YW5jZVRvUmVnaW9uKHN0YXRlLCBzdGFydFJlZ2lvbklkLCB0YXJnZXRJZCkge1xuICAgICAgICBpZihzdGFydFJlZ2lvbklkID09PSB0YXJnZXRJZCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0aHMgPSB0aGlzLmZpbmRQYXRoc1RvUmVnaW9uKHN0YXRlLCBzdGFydFJlZ2lvbklkLCB0YXJnZXRJZCwgNSk7IC8vIE5vbmUgYXJlIG1vcmUgdGhhbiA0IGF3YXkgYnkgc2hvcnRlc3QgZGlzdGFuY2VcbiAgICAgICAgcmV0dXJuIHBhdGhzWzBdLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgc3RhdGljIGRlcHRoRmlyc3QocGF0aHMsIHJlZ2lvbnNCeUlkLCB0YXJnZXRJZCwgdmlzaXRlZCwgbGltaXQpIHtcbiAgICAgICAgY29uc3QgYWRqYWNlbnRSZWdpb25zID0gcmVnaW9uc0J5SWRbXy5sYXN0KHZpc2l0ZWQpXS5hZGphY2VudDtcblxuICAgICAgICBfLmVhY2goYWRqYWNlbnRSZWdpb25zLCBmdW5jdGlvbihyZWdpb24pIHtcbiAgICAgICAgICAgIGlmKF8uaW5kZXhPZih2aXNpdGVkLCByZWdpb24uaWQpID49IDAgfHwgIXJlZ2lvbi5pblBsYXkoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYocmVnaW9uLmlkID09PSB0YXJnZXRJZCkge1xuICAgICAgICAgICAgICAgIHZpc2l0ZWQucHVzaCh0YXJnZXRJZCk7XG4gICAgICAgICAgICAgICAgcGF0aHMucHVzaChfLmNsb25lKHZpc2l0ZWQpKTtcbiAgICAgICAgICAgICAgICB2aXNpdGVkLnBvcCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgXy5lYWNoKGFkamFjZW50UmVnaW9ucywgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgaWYgKHZpc2l0ZWQubGVuZ3RoID49IGxpbWl0IHx8IF8uaW5kZXhPZih2aXNpdGVkLCByZWdpb24uaWQpID49IDAgfHwgIXJlZ2lvbi5pblBsYXkoKSB8fFxuICAgICAgICAgICAgICAgIF8uaW50ZXJzZWN0aW9uKF8uaW5pdGlhbCh2aXNpdGVkKSwgXy5tYXAocmVnaW9uLmFkamFjZW50LCAnaWQnKSkubGVuZ3RoID4gMCB8fCByZWdpb24uaWQgPT09IHRhcmdldElkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlzaXRlZC5wdXNoKHJlZ2lvbi5pZCk7XG4gICAgICAgICAgICB0aGlzLmRlcHRoRmlyc3QocGF0aHMsIHJlZ2lvbnNCeUlkLCB0YXJnZXRJZCwgdmlzaXRlZCwgbGltaXQpO1xuICAgICAgICAgICAgdmlzaXRlZC5wb3AoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdlbmVyYXRlUmFua2luZ3MoYWxsQWRqYWNlbnRSZWdpb25zLCBhZGphY2VudFBlclN0YXJ0UmVnaW9uKSB7XG4gICAgICAgIGNvbnN0IGFsbFNldHMgPSBfLnJhbmdlKDAsIGFkamFjZW50UGVyU3RhcnRSZWdpb24ubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIF8oYWxsQWRqYWNlbnRSZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAoaWQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIGxldCBzZXRzID0gW107XG4gICAgICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgICAgICBhZGphY2VudFBlclN0YXJ0UmVnaW9uLCAocG9zc2libGVJZHMsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3VuZCA9IF8uaW5kZXhPZihwb3NzaWJsZUlkcywgaWQpID49IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHMucHVzaChpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNldHMuc29ydCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgICAgICBzZXRzLFxuICAgICAgICAgICAgICAgICAgICByZW1haW5pbmc6IF8uZGlmZmVyZW5jZShhbGxTZXRzLCBzZXRzKSxcbiAgICAgICAgICAgICAgICAgICAgY291bnRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ2NvdW50JykucmV2ZXJzZSgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdlbmVyYXRlU29sdXRpb25zRm9yR3JvdXAocmFua2luZ3MsIGdyb3VwZWRSYW5raW5ncywgcmFua2luZ0dyb3VwLCBncm91cElkKSB7XG4gICAgICAgIGxldCB1bmNoZWNrZWRSYW5raW5ncyA9IFtdO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBfLnJhbmdlKDEsIGdyb3VwSWQgKyAxKS5yZXZlcnNlKCksIChpZCkgPT4ge1xuICAgICAgICAgICAgICAgIHVuY2hlY2tlZFJhbmtpbmdzID0gXy5jb25jYXQodW5jaGVja2VkUmFua2luZ3MsIGdyb3VwZWRSYW5raW5nc1tpZF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIF8ocmFua2luZ0dyb3VwKS5tYXAoXG4gICAgICAgICAgICAocmFua2luZykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHV0aW9uc0ZvclJlZ2lvbiA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJhbmtpbmcuY291bnQgPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJhbmtpbmcucmVtYWluaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzb2x1dGlvbnNGb3JSZWdpb24ucHVzaChbcmFua2luZy5pZF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uY2xvbmUocmFua2luZ3MpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVnaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb2x1dGlvbiA9IFtyYW5raW5nXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZW1haW5pbmcgPSBfLmNsb25lKHJhbmtpbmcucmVtYWluaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zLCAob3RoZXJSYW5raW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSBfLmRpZmZlcmVuY2UocmVtYWluaW5nLCBvdGhlclJhbmtpbmcuc2V0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlLmxlbmd0aCA9PT0gMCB8fCBkaWZmZXJlbmNlLmxlbmd0aCA8PSByZW1haW5pbmcubGVuZ3RoIC0gb3RoZXJSYW5raW5nLnNldHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2x1dGlvbi5wdXNoKG90aGVyUmFua2luZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gZGlmZmVyZW5jZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uLnNvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sdXRpb25zRm9yUmVnaW9uLnB1c2goc29sdXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9ucy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiByYW5raW5nLmlkLFxuICAgICAgICAgICAgICAgICAgICBzb2x1dGlvbnM6IHNvbHV0aW9uc0ZvclJlZ2lvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5tYXAoJ3NvbHV0aW9ucycpLmZsYXR0ZW4oKS51bmlxV2l0aChfLmlzRXF1YWwpLm9yZGVyQnkoc29sdXRpb24gPT4gc29sdXRpb24ubGVuZ3RoKS52YWx1ZSgpO1xuXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNYXBcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvdXRpbC9tYXAuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBCQTtBQUNBO0FBQ0E7QUFBQTtBQW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUFBO0FBQUE7QUFFQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceAuxilia = function (_Action) {\n    _inherits(PlaceAuxilia, _Action);\n\n    function PlaceAuxilia(args) {\n        _classCallCheck(this, PlaceAuxilia);\n\n        var _this = _possibleConstructorReturn(this, (PlaceAuxilia.__proto__ || Object.getPrototypeOf(PlaceAuxilia)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.count = args.count;\n        return _this;\n    }\n\n    _createClass(PlaceAuxilia, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n\n            if (!region.inPlay() || !faction.hasAvailableAuxilia(count)) {\n                throw 'Invalid PlaceAuxilia Action';\n            }\n\n            region.addPieces(faction.removeAuxilia(count));\n            console.log('Placing ' + count + 'x ' + faction.name + ' Auxilia in ' + region.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n\n            console.log('Taking back ' + count + 'x ' + faction.name + ' Auxilia from ' + region.name);\n            var auxilia = _.take(region.getHiddenPiecesForFaction(faction.id), count);\n            if (auxilia.length !== count) {\n                throw 'Unable to undo PlaceAuxilia Action';\n            }\n            region.removePieces(auxilia);\n            faction.returnAuxilia(auxilia);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n            return ['Place ' + count + 'x ' + faction.name + ' Auxilia in ' + region.name];\n        }\n    }]);\n\n    return PlaceAuxilia;\n}(_action2.default);\n\nexports.default = PlaceAuxilia;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUF1eGlsaWEuanM/ZmZjOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcblxuY2xhc3MgUGxhY2VBdXhpbGlhIGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5yZWdpb25JZCA9IGFyZ3MucmVnaW9uSWQ7XG4gICAgICAgIHRoaXMuY291bnQgPSBhcmdzLmNvdW50O1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcblxuICAgICAgICBpZighcmVnaW9uLmluUGxheSgpIHx8ICFmYWN0aW9uLmhhc0F2YWlsYWJsZUF1eGlsaWEoY291bnQpKSB7XG4gICAgICAgICAgICB0aHJvdyAnSW52YWxpZCBQbGFjZUF1eGlsaWEgQWN0aW9uJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZ2lvbi5hZGRQaWVjZXMoZmFjdGlvbi5yZW1vdmVBdXhpbGlhKGNvdW50KSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQbGFjaW5nICcgKyBjb3VudCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIEF1eGlsaWEgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQ7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1Rha2luZyBiYWNrICcgKyBjb3VudCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIEF1eGlsaWEgZnJvbSAnICsgcmVnaW9uLm5hbWUpO1xuICAgICAgICBjb25zdCBhdXhpbGlhID0gXy50YWtlKHJlZ2lvbi5nZXRIaWRkZW5QaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb24uaWQpLCBjb3VudCk7XG4gICAgICAgIGlmKGF1eGlsaWEubGVuZ3RoICE9PSBjb3VudCkge1xuICAgICAgICAgICAgdGhyb3cgJ1VuYWJsZSB0byB1bmRvIFBsYWNlQXV4aWxpYSBBY3Rpb24nO1xuICAgICAgICB9XG4gICAgICAgIHJlZ2lvbi5yZW1vdmVQaWVjZXMoYXV4aWxpYSk7XG4gICAgICAgIGZhY3Rpb24ucmV0dXJuQXV4aWxpYShhdXhpbGlhKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQ7XG4gICAgICAgIHJldHVybiBbJ1BsYWNlICcgKyBjb3VudCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIEF1eGlsaWEgaW4gJyArIHJlZ2lvbi5uYW1lXTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBsYWNlQXV4aWxpYTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUF1eGlsaWEuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUxBO0FBTUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceCitadel = function (_Action) {\n    _inherits(PlaceCitadel, _Action);\n\n    function PlaceCitadel(args) {\n        _classCallCheck(this, PlaceCitadel);\n\n        var _this = _possibleConstructorReturn(this, (PlaceCitadel.__proto__ || Object.getPrototypeOf(PlaceCitadel)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.tribeId = args.tribeId;\n        _this.hadAlly = args.hadAlly;\n        return _this;\n    }\n\n    _createClass(PlaceCitadel, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n\n            if (!region.inPlay() || !faction.hasAvailableCitadel() || !tribe.isCity) {\n                throw 'Invalid PlaceCitadel Action';\n            }\n\n            var removedAlliedTribe = region.removeAlliedTribe(faction.id, tribe.id);\n            if (removedAlliedTribe) {\n                this.hadAlly = true;\n                faction.returnAlliedTribe(removedAlliedTribe);\n            }\n\n            var citadel = faction.removeCitadel();\n            tribe.buildCitadel(citadel);\n            region.addPiece(citadel);\n            console.log('Placing ' + faction.name + ' Citadel in ' + tribe.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n\n            var citadel = region.getCitadelForFaction(faction.id);\n            tribe.removeAlly(citadel);\n            region.removePieces([citadel]);\n            faction.returnCitadel(citadel);\n\n            if (this.hadAlly) {\n                var alliedTribe = faction.removeAlliedTribe();\n                tribe.makeAllied(alliedTribe);\n                region.addPiece(alliedTribe);\n            }\n            console.log('Taking back ' + faction.name + ' Citadel from ' + tribe.name);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var tribe = state.tribesById[this.tribeId];\n            return ['Place ' + faction.name + ' Citadel in ' + tribe.name + ' in region ' + region.name];\n        }\n    }]);\n\n    return PlaceCitadel;\n}(_action2.default);\n\nexports.default = PlaceCitadel;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUNpdGFkZWwuanM/ZjI0YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcbmltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuXG5jbGFzcyBQbGFjZUNpdGFkZWwgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gYXJncy5yZWdpb25JZDtcbiAgICAgICAgdGhpcy50cmliZUlkID0gYXJncy50cmliZUlkO1xuICAgICAgICB0aGlzLmhhZEFsbHkgPSBhcmdzLmhhZEFsbHk7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgdHJpYmUgPSBzdGF0ZS50cmliZXNCeUlkW3RoaXMudHJpYmVJZF07XG5cbiAgICAgICAgaWYoIXJlZ2lvbi5pblBsYXkoKSB8fCAhZmFjdGlvbi5oYXNBdmFpbGFibGVDaXRhZGVsKCkgfHwgIXRyaWJlLmlzQ2l0eSkge1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgUGxhY2VDaXRhZGVsIEFjdGlvbic7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZW1vdmVkQWxsaWVkVHJpYmUgPSByZWdpb24ucmVtb3ZlQWxsaWVkVHJpYmUoZmFjdGlvbi5pZCwgdHJpYmUuaWQpO1xuICAgICAgICBpZihyZW1vdmVkQWxsaWVkVHJpYmUpIHtcbiAgICAgICAgICAgIHRoaXMuaGFkQWxseSA9IHRydWU7XG4gICAgICAgICAgICBmYWN0aW9uLnJldHVybkFsbGllZFRyaWJlKHJlbW92ZWRBbGxpZWRUcmliZSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjaXRhZGVsID0gZmFjdGlvbi5yZW1vdmVDaXRhZGVsKCk7XG4gICAgICAgIHRyaWJlLmJ1aWxkQ2l0YWRlbChjaXRhZGVsKTtcbiAgICAgICAgcmVnaW9uLmFkZFBpZWNlKGNpdGFkZWwpO1xuICAgICAgICBjb25zb2xlLmxvZygnUGxhY2luZyAnICsgZmFjdGlvbi5uYW1lICsgJyBDaXRhZGVsIGluICcgKyB0cmliZS5uYW1lKTtcbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuICAgICAgICBjb25zdCB0cmliZSA9IHN0YXRlLnRyaWJlc0J5SWRbdGhpcy50cmliZUlkXTtcblxuICAgICAgICBjb25zdCBjaXRhZGVsID0gcmVnaW9uLmdldENpdGFkZWxGb3JGYWN0aW9uKGZhY3Rpb24uaWQpO1xuICAgICAgICB0cmliZS5yZW1vdmVBbGx5KGNpdGFkZWwpO1xuICAgICAgICByZWdpb24ucmVtb3ZlUGllY2VzKFtjaXRhZGVsXSk7XG4gICAgICAgIGZhY3Rpb24ucmV0dXJuQ2l0YWRlbChjaXRhZGVsKTtcblxuICAgICAgICBpZih0aGlzLmhhZEFsbHkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFsbGllZFRyaWJlID0gZmFjdGlvbi5yZW1vdmVBbGxpZWRUcmliZSgpO1xuICAgICAgICAgICAgdHJpYmUubWFrZUFsbGllZChhbGxpZWRUcmliZSk7XG4gICAgICAgICAgICByZWdpb24uYWRkUGllY2UoYWxsaWVkVHJpYmUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdUYWtpbmcgYmFjayAnICsgZmFjdGlvbi5uYW1lICsgJyBDaXRhZGVsIGZyb20gJyArIHRyaWJlLm5hbWUpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFt0aGlzLnRyaWJlSWRdO1xuICAgICAgICByZXR1cm4gWydQbGFjZSAnICsgZmFjdGlvbi5uYW1lICsgJyBDaXRhZGVsIGluICcgKyB0cmliZS5uYW1lICsgJyBpbiByZWdpb24gJyArIHJlZ2lvbi5uYW1lXTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBsYWNlQ2l0YWRlbDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUNpdGFkZWwuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _EnemyFactionPriority;\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar EnemyFactionPriority = (_EnemyFactionPriority = {}, _defineProperty(_EnemyFactionPriority, _factionIds2.default.ARVERNI, 1), _defineProperty(_EnemyFactionPriority, _factionIds2.default.BELGAE, 2), _defineProperty(_EnemyFactionPriority, _factionIds2.default.GERMANIC_TRIBES, 3), _defineProperty(_EnemyFactionPriority, _factionIds2.default.ROMANS, 4), _EnemyFactionPriority);\n\nexports.default = EnemyFactionPriority;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9lbmVteUZhY3Rpb25Qcmlvcml0eS5qcz9jZjZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY29uc3QgRW5lbXlGYWN0aW9uUHJpb3JpdHkgPSB7XG4gICAgW0ZhY3Rpb25JRHMuQVJWRVJOSV06IDEsXG4gICAgW0ZhY3Rpb25JRHMuQkVMR0FFXTogMixcbiAgICBbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdOiAzLFxuICAgIFtGYWN0aW9uSURzLlJPTUFOU106IDRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEVuZW15RmFjdGlvblByaW9yaXR5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2VuZW15RmFjdGlvblByaW9yaXR5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBTUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _fallingSkyPlayer = __webpack_require__(79);\n\nvar _fallingSkyPlayer2 = _interopRequireDefault(_fallingSkyPlayer);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _placeLeader = __webpack_require__(48);\n\nvar _placeLeader2 = _interopRequireDefault(_placeLeader);\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _playerInteractionNeededError = __webpack_require__(60);\n\nvar _playerInteractionNeededError2 = _interopRequireDefault(_playerInteractionNeededError);\n\nvar _supplyLineAgreement = __webpack_require__(78);\n\nvar _supplyLineAgreement2 = _interopRequireDefault(_supplyLineAgreement);\n\nvar _quartersAgreement = __webpack_require__(76);\n\nvar _quartersAgreement2 = _interopRequireDefault(_quartersAgreement);\n\nvar _retreatAgreement = __webpack_require__(77);\n\nvar _retreatAgreement2 = _interopRequireDefault(_retreatAgreement);\n\nvar _harassment = __webpack_require__(75);\n\nvar _harassment2 = _interopRequireDefault(_harassment);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Bot = function (_FallingSkyPlayer) {\n    _inherits(Bot, _FallingSkyPlayer);\n\n    function Bot(definition) {\n        _classCallCheck(this, Bot);\n\n        var _this = _possibleConstructorReturn(this, (Bot.__proto__ || Object.getPrototypeOf(Bot)).call(this, { isNonPlayer: true }));\n\n        _this.factionId = definition.factionId;\n        return _this;\n    }\n\n    _createClass(Bot, [{\n        key: 'takeTurn',\n        value: function takeTurn(state) {}\n    }, {\n        key: 'resume',\n        value: function resume(state) {\n            state.turnHistory.currentTurn.resume();\n            this.takeTurn(state);\n        }\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {}\n    }, {\n        key: 'placeLeader',\n        value: function placeLeader(state) {\n            var _this2 = this;\n\n            var faction = state.factionsById[this.factionId];\n            if (faction.hasAvailableLeader()) {\n                var region = (0, _lodash2.default)(state.regions).map(function (region) {\n                    var pieces = region.piecesByFaction()[_this2.factionId] || [];\n                    return {\n                        region: region,\n                        numPieces: pieces.length\n                    };\n                }).sortBy('numPieces').groupBy('numPieces').map(_lodash2.default.shuffle).flatten().map('region').reverse().first();\n                _placeLeader2.default.execute(state, { factionId: faction.id, regionId: region.id });\n            }\n        }\n    }, {\n        key: 'canPlayEvent',\n        value: function canPlayEvent(currentState) {\n            return _lodash2.default.indexOf(currentState.sequenceOfPlay.availableActions(), _factionActions2.default.EVENT) >= 0;\n        }\n    }, {\n        key: 'willHarass',\n        value: function willHarass(factionId, context) {\n            return true;\n        }\n    }, {\n        key: 'willAgreeToQuarters',\n        value: function willAgreeToQuarters(state, factionId) {\n            return false;\n        }\n    }, {\n        key: 'willAgreeToRetreat',\n        value: function willAgreeToRetreat(state, factionId) {\n            return false;\n        }\n    }, {\n        key: 'willAgreeToSupplyLine',\n        value: function willAgreeToSupplyLine(state, factionId) {\n            return false;\n        }\n    }, {\n        key: 'willRetreat',\n        value: function willRetreat(state, region, attackingFaction, noRetreatLosses, retreatLosses) {\n            var _this3 = this;\n\n            var wantToRetreat = false;\n            var defendingPieces = region.getPiecesForFaction(this.factionId);\n\n            // 3.2.4 - The defender may opt to have any Retreating Leader and/or Hidden Warbands stay put.\n            var canRetreatInPlace = attackingFaction.id === _factionIds2.default.ROMANS && this.factionId !== _factionIds2.default.GERMANIC_TRIBES;\n            var hasRevealedPieces = _lodash2.default.find(defendingPieces, function (piece) {\n                return (piece.type === 'warband' || piece.type === 'auxilia') && piece.revealed();\n            });\n            var hasLossesFromRetreat = !canRetreatInPlace || !hasSafeRetreatRegion && hasRevealedPieces;\n\n            var hasSafeRetreatRegion = _lodash2.default.find(region.adjacent, function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() && adjacentRegion.controllingFactionId() === _this3.factionId;\n            }) || !hasLossesFromRetreat;\n\n            var noRetreatOrderedPieces = _losses2.default.orderPiecesForRemoval(state, defendingPieces, false);\n            var retreatOrderedPieces = _losses2.default.orderPiecesForRemoval(state, defendingPieces, false);\n\n            var noRetreatRemoved = _lodash2.default.take(noRetreatOrderedPieces, noRetreatLosses);\n            var noRetreatRemaining = _lodash2.default.drop(noRetreatOrderedPieces, noRetreatLosses);\n            var retreatRemoved = _lodash2.default.take(retreatOrderedPieces, retreatLosses);\n            var retreatRemaining = _lodash2.default.drop(retreatOrderedPieces, retreatLosses);\n\n            var worstCaseAttackerLosses = Math.floor(_losses2.default.calculateUnmodifiedLosses(state, noRetreatRemaining, true));\n\n            // 8.4.3 - When needed to ensure the survival off their last Defending piece.\n            if (noRetreatRemaining.length === 0 && retreatRemaining.length > 0) {\n                console.log(this.factionId + ' wants to retreat to save last piece');\n                wantToRetreat = true;\n            }\n\n            // 8.4.3 - If Roman, when needed to lower the number of forced Loss rolls against Legions\n            if (this.factionId === _factionIds2.default.ROMANS) {\n                var nonRetreatLegionsRemoved = _lodash2.default.countBy(noRetreatRemoved, 'type').legion || 0;\n                var retreatLegionsRemoved = _lodash2.default.countBy(retreatRemoved, 'type').legion || 0;\n\n                if (retreatLegionsRemoved < nonRetreatLegionsRemoved) {\n                    console.log(this.factionId + ' wants to retreat to lower legion losses');\n                    wantToRetreat = true;\n                }\n            }\n\n            // 8.4.3 - If defending without a Fort or Citadel and a Retreat itself would not remove any\n            // defending pieces, when they cannot guarantee inflicting at least half the Losses against\n            // the Attacker that they will suffer (regardless of how many pieces might be removed by the\n            // Losses).\n            var hasDefendingCitadelOrFort = _lodash2.default.find(defendingPieces, function (piece) {\n                return piece.type === 'citadel' || piece.type === 'fort';\n            });\n            var counterAttackLossesTooFew = worstCaseAttackerLosses < noRetreatLosses / 2;\n\n            if (!hasDefendingCitadelOrFort && counterAttackLossesTooFew) {\n                console.log(this.factionId + ' wants to retreat due to lack of citadel or fort and too few counterattack losses');\n                wantToRetreat = true;\n            }\n\n            if (wantToRetreat && hasSafeRetreatRegion) {\n                console.log(this.factionId + ' will be able to retreat safely');\n            }\n\n            var agreeingFactionId = void 0;\n            if (wantToRetreat && !hasSafeRetreatRegion) {\n                agreeingFactionId = this.getRetreatAgreement(state, region);\n            }\n\n            var willRetreat = wantToRetreat && (hasSafeRetreatRegion || agreeingFactionId);\n            return {\n                willRetreat: willRetreat,\n                agreeingFactionId: agreeingFactionId\n            };\n        }\n    }, {\n        key: 'getRetreatAgreement',\n        value: function getRetreatAgreement(state, region) {\n            var _this4 = this;\n\n            console.log(this.factionId + ' has to ask for agreement to retreat');\n            var agreementRequiredRetreatRegions = _lodash2.default.filter(region.adjacent, function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() && adjacentRegion.controllingFactionId() !== _this4.factionId;\n            });\n\n            if (agreementRequiredRetreatRegions.length === 0) {\n                console.log('No adjacent regions can be asked');\n            }\n\n            var factionsAsked = {};\n            var agreeingRegion = _lodash2.default.find(agreementRequiredRetreatRegions, function (agreementRequiredRegion) {\n                var regionFactionId = agreementRequiredRegion.controllingFactionId();\n                if (factionsAsked[regionFactionId]) {\n                    return false;\n                }\n                console.log('Asking ' + regionFactionId + ' for region ' + agreementRequiredRegion.name);\n                factionsAsked[regionFactionId] = true;\n                var existingAgreement = _this4.getExistingAgreement(state, regionFactionId, 'RetreatAgreement');\n                return existingAgreement ? existingAgreement.status === 'agreed' : state.playersByFaction[regionFactionId].willAgreeToRetreat(state, regionFactionId);\n            });\n\n            if (agreeingRegion) {\n                console.log(agreeingRegion.controllingFactionId() + ' has agreed');\n            } else {\n                console.log('No agreement could be reached');\n            }\n            return agreeingRegion ? agreeingRegion.controllingFactionId() : null;\n        }\n    }, {\n        key: 'getExistingAgreement',\n        value: function getExistingAgreement(state, factionId, agreementType) {\n            return _lodash2.default.find(state.turnHistory.getCurrentTurn().getCurrentInteractions(), function (agreement) {\n                return agreement.type === agreementType && agreement.respondingFactionId === factionId;\n            });\n        }\n    }, {\n        key: 'getSupplyLineAgreements',\n        value: function getSupplyLineAgreements(state, modifiers, factionIds) {\n            var _this5 = this;\n\n            var agreements = [];\n            _lodash2.default.each(factionIds, function (factionId) {\n                var existingAgreement = _this5.getExistingAgreement(state, factionId, 'SupplyLineAgreement');\n                var agreed = existingAgreement ? existingAgreement.status === 'agreed' : state.playersByFaction[factionId].willAgreeToSupplyLine(state, _this5.factionId);\n                console.log(_this5.factionId + ' asked ' + factionId + ' for supply line agreement -> ' + factionId + (agreed ? ' agreed' : ' denied'));\n                if (agreed) {\n                    agreements.push(factionId);\n                }\n            });\n\n            return agreements;\n        }\n    }, {\n        key: 'takeLosses',\n        value: function takeLosses(state, battleResults, attackResults, counterattack, causedByCapability) {\n            var region = battleResults.region;\n            var attackingFaction = counterattack ? battleResults.defendingFaction : battleResults.attackingFaction;\n            var ambush = battleResults.willAmbush && !causedByCapability;\n\n            var ballistae = state.hasUnshadedCapability(_capabilities.CapabilityIDs.BALLISTAE) && this.factionId === _factionIds2.default.ROMANS;\n            var allowRolls = causedByCapability || !ambush && !counterattack;\n\n            if (!allowRolls && !counterattack && this.factionId === _factionIds2.default.ROMANS) {\n                var defendingLeader = _lodash2.default.find(region.piecesByFaction()[this.factionId], { type: 'leader' });\n                var caesarDefending = defendingLeader && !defendingLeader.isSuccessor();\n\n                if (caesarDefending) {\n                    var minRoll = attackingFaction.id === _factionIds2.default.BELGAE ? 5 : 4;\n                    var roll = _lodash2.default.random(1, 6);\n                    console.log('Caesar is defending, requires a roll > ' + minRoll + ', got ' + roll);\n                    allowRolls = roll >= minRoll;\n                    if (allowRolls) {\n                        console.log('Loss rolls and counterattack allowed!');\n                    }\n                }\n            }\n\n            var amAttacker = battleResults.attackingFaction.id === this.factionId;\n            var myPieces = amAttacker ? _battle2.default.getAttackingPieces(battleResults) : _battle2.default.getDefendingPieces(battleResults);\n            var helpingFactionId = amAttacker && battleResults.willEnlistGermans ? _factionIds2.default.GERMANIC_TRIBES : null;\n\n            var targets = _lodash2.default.clone(_losses2.default.orderPiecesForRemoval(state, myPieces, battleResults.willRetreat, helpingFactionId));\n            var losses = attackResults.losses;\n\n            var removed = [];\n\n            if (targets.length > 0) {\n                _lodash2.default.each(_lodash2.default.range(0, losses), function (index) {\n                    var piece = _lodash2.default.first(targets);\n                    var willRemove = true;\n                    var canRollForLoss = piece.type === 'leader' || piece.type === 'citadel' || piece.type === 'legion' || piece.type === 'fort';\n                    if (canRollForLoss && allowRolls) {\n                        var _roll = _lodash2.default.random(1, 6);\n                        console.log('Rolling for loss of ' + piece.type + ', need 4-6 and got ' + _roll);\n                        willRemove = _roll < (piece.type === 'fort' && ballistae ? 3 : 4);\n                    }\n\n                    if (willRemove) {\n                        removed.push(targets.shift());\n                    } else {\n                        console.log(piece.type + ' saved!');\n                    }\n\n                    if (targets.length === 0) {\n                        return false;\n                    }\n                });\n            }\n\n            attackResults.removed = removed;\n            attackResults.remaining = targets;\n\n            if (attackResults.removed.length > 0) {\n                _removePieces2.default.execute(state, {\n                    regionId: region.id,\n                    factionId: this.factionId,\n                    pieces: attackResults.removed\n                });\n            }\n\n            attackResults.counterattackPossible = allowRolls && _lodash2.default.find(attackResults.remaining, { isMobile: true });\n        }\n    }, {\n        key: 'retreatFromBattle',\n        value: function retreatFromBattle(state, battleResults, attackResults) {\n            var region = battleResults.region;\n            var attackingFaction = battleResults.attackingFaction;\n            var canRetreatInPlace = attackingFaction.id === _factionIds2.default.ROMANS && this.factionId !== _factionIds2.default.GERMANIC_TRIBES;\n\n            var leader = _lodash2.default.find(attackResults.remaining, { type: 'leader' });\n            var groupedPieces = _lodash2.default.groupBy(attackResults.remaining, function (piece) {\n                if (piece.type === 'warband' && !piece.revealed() && canRetreatInPlace) {\n                    return 'staying';\n                }\n\n                if (piece.type === 'leader' && canRetreatInPlace) {\n                    return 'leader';\n                }\n\n                if (piece.isMobile) {\n                    return 'leaving';\n                }\n\n                return 'staying';\n            });\n\n            var retreatRegion = this.retreatPieces(state, region, groupedPieces.leaving || [], attackResults.agreeingFactionId);\n\n            if (groupedPieces.leader && retreatRegion) {\n                var sourceFriendlyPieces = region.piecesByFaction()[this.factionId];\n                var targetFriendlyPieces = retreatRegion.piecesByFaction()[this.factionId];\n                if (targetFriendlyPieces.length > sourceFriendlyPieces.length) {\n                    _movePieces2.default.execute(state, {\n                        sourceRegionId: region.id,\n                        destRegionId: retreatRegion.id,\n                        pieces: groupedPieces.leader\n                    });\n                }\n            }\n        }\n    }, {\n        key: 'retreatPieces',\n        value: function retreatPieces(state, region, pieces, agreeingFactionId) {\n            if (pieces.length === 0) {\n                return;\n            }\n\n            var targetRegion = this.findRetreatRegion(state, region, agreeingFactionId);\n            if (targetRegion) {\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: region.id,\n                    destRegionId: targetRegion.id,\n                    pieces: pieces\n                });\n            } else {\n                _removePieces2.default.execute(state, {\n                    regionId: region.id,\n                    factionId: this.factionId,\n                    pieces: pieces\n                });\n            }\n\n            return targetRegion;\n        }\n    }, {\n        key: 'findRetreatRegion',\n        value: function findRetreatRegion(state, region, agreeingFactionId) {\n            var _this6 = this;\n\n            return (0, _lodash2.default)(region.adjacent).reject(function (adjacent) {\n                return !adjacent.controllingFactionId() || adjacent.controllingFactionId() !== _this6.factionId && adjacent.controllingFactionId() !== agreeingFactionId;\n            }).map(function (adjacent) {\n                var friendlyPieces = adjacent.getPiecesForFaction(_this6.factionId);\n                return {\n                    numFriendly: friendlyPieces.length,\n                    region: adjacent\n                };\n            }).sortBy('numFriendly').groupBy('numFriendly').map(_lodash2.default.shuffle).flatten().reverse().map('region').first();\n        }\n    }]);\n\n    return Bot;\n}(_fallingSkyPlayer2.default);\n\nexports.default = Bot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9ib3QuanM/MzYzOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFsbGluZ1NreVBsYXllciBmcm9tICcuLi9wbGF5ZXIvZmFsbGluZ1NreVBsYXllcic7XG5pbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBCYXR0bGUgZnJvbSAnLi4vY29tbWFuZHMvYmF0dGxlJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnLi4vYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuaW1wb3J0IE1vdmVQaWVjZXMgZnJvbSAnLi4vYWN0aW9ucy9tb3ZlUGllY2VzJztcbmltcG9ydCBQbGFjZUxlYWRlciBmcm9tICcuLi9hY3Rpb25zL3BsYWNlTGVhZGVyJztcbmltcG9ydCBMb2dnaW5nIGZyb20gJy4uL3V0aWwvbG9nZ2luZyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yIGZyb20gJy4uLy4uL2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yJztcbmltcG9ydCBTdXBwbHlMaW5lQWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3N1cHBseUxpbmVBZ3JlZW1lbnQnO1xuaW1wb3J0IFF1YXJ0ZXJzQWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3F1YXJ0ZXJzQWdyZWVtZW50JztcbmltcG9ydCBSZXRyZWF0QWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3JldHJlYXRBZ3JlZW1lbnQnO1xuaW1wb3J0IEhhcmFzc21lbnQgZnJvbSAnZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvaGFyYXNzbWVudCc7XG5pbXBvcnQgTG9zc2VzIGZyb20gJ2ZhbGxpbmdza3kvdXRpbC9sb3NzZXMnO1xuaW1wb3J0IHtDYXBhYmlsaXR5SURzfSBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuXG5jbGFzcyBCb3QgZXh0ZW5kcyBGYWxsaW5nU2t5UGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHN1cGVyKHtpc05vblBsYXllcjogdHJ1ZX0pO1xuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGRlZmluaXRpb24uZmFjdGlvbklkO1xuICAgIH1cblxuICAgIHRha2VUdXJuKHN0YXRlKSB7XG5cbiAgICB9XG5cbiAgICByZXN1bWUoc3RhdGUpIHtcbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuY3VycmVudFR1cm4ucmVzdW1lKCk7XG4gICAgICAgIHRoaXMudGFrZVR1cm4oc3RhdGUpXG4gICAgfVxuXG4gICAgcXVhcnRlcnMoc3RhdGUpIHtcblxuICAgIH1cblxuICAgIHBsYWNlTGVhZGVyKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBpZiAoZmFjdGlvbi5oYXNBdmFpbGFibGVMZWFkZXIoKSkge1xuICAgICAgICAgICAgY29uc3QgcmVnaW9uID0gXyhzdGF0ZS5yZWdpb25zKS5tYXAoKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVt0aGlzLmZhY3Rpb25JZF0gfHwgW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgIG51bVBpZWNlczogcGllY2VzLmxlbmd0aFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnNvcnRCeSgnbnVtUGllY2VzJykuZ3JvdXBCeSgnbnVtUGllY2VzJykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLm1hcCgncmVnaW9uJykucmV2ZXJzZSgpLmZpcnN0KCk7XG4gICAgICAgICAgICBQbGFjZUxlYWRlci5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBmYWN0aW9uLmlkLCByZWdpb25JZDogcmVnaW9uLmlkfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjYW5QbGF5RXZlbnQoY3VycmVudFN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfLmluZGV4T2YoY3VycmVudFN0YXRlLnNlcXVlbmNlT2ZQbGF5LmF2YWlsYWJsZUFjdGlvbnMoKSwgRmFjdGlvbkFjdGlvbnMuRVZFTlQpID49IDA7XG4gICAgfVxuXG4gICAgd2lsbEhhcmFzcyhmYWN0aW9uSWQsIGNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9RdWFydGVycyhzdGF0ZSwgZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB3aWxsQWdyZWVUb1JldHJlYXQoc3RhdGUsIGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9TdXBwbHlMaW5lKHN0YXRlLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHdpbGxSZXRyZWF0KHN0YXRlLCByZWdpb24sIGF0dGFja2luZ0ZhY3Rpb24sIG5vUmV0cmVhdExvc3NlcywgcmV0cmVhdExvc3Nlcykge1xuICAgICAgICBsZXQgd2FudFRvUmV0cmVhdCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBkZWZlbmRpbmdQaWVjZXMgPSByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG5cbiAgICAgICAgLy8gMy4yLjQgLSBUaGUgZGVmZW5kZXIgbWF5IG9wdCB0byBoYXZlIGFueSBSZXRyZWF0aW5nIExlYWRlciBhbmQvb3IgSGlkZGVuIFdhcmJhbmRzIHN0YXkgcHV0LlxuICAgICAgICBjb25zdCBjYW5SZXRyZWF0SW5QbGFjZSA9IGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWN0aW9uSWQgIT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuICAgICAgICBjb25zdCBoYXNSZXZlYWxlZFBpZWNlcyA9IF8uZmluZChkZWZlbmRpbmdQaWVjZXMsIHBpZWNlID0+IChwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgfHwgcGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnKSAmJiAgcGllY2UucmV2ZWFsZWQoKSk7XG4gICAgICAgIGNvbnN0IGhhc0xvc3Nlc0Zyb21SZXRyZWF0ID0gIWNhblJldHJlYXRJblBsYWNlIHx8ICghaGFzU2FmZVJldHJlYXRSZWdpb24gJiYgaGFzUmV2ZWFsZWRQaWVjZXMpO1xuXG4gICAgICAgIGNvbnN0IGhhc1NhZmVSZXRyZWF0UmVnaW9uID0gXy5maW5kKFxuICAgICAgICAgICAgICAgIHJlZ2lvbi5hZGphY2VudCwgKGFkamFjZW50UmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpICYmIGFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IHRoaXMuZmFjdGlvbklkO1xuICAgICAgICAgICAgICAgIH0pIHx8ICFoYXNMb3NzZXNGcm9tUmV0cmVhdDtcblxuXG4gICAgICAgIGNvbnN0IG5vUmV0cmVhdE9yZGVyZWRQaWVjZXMgPSBMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBkZWZlbmRpbmdQaWVjZXMsIGZhbHNlKTtcbiAgICAgICAgY29uc3QgcmV0cmVhdE9yZGVyZWRQaWVjZXMgPSBMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBkZWZlbmRpbmdQaWVjZXMsIGZhbHNlKTtcblxuICAgICAgICBjb25zdCBub1JldHJlYXRSZW1vdmVkID0gXy50YWtlKG5vUmV0cmVhdE9yZGVyZWRQaWVjZXMsIG5vUmV0cmVhdExvc3Nlcyk7XG4gICAgICAgIGNvbnN0IG5vUmV0cmVhdFJlbWFpbmluZyA9IF8uZHJvcChub1JldHJlYXRPcmRlcmVkUGllY2VzLCBub1JldHJlYXRMb3NzZXMpO1xuICAgICAgICBjb25zdCByZXRyZWF0UmVtb3ZlZCA9IF8udGFrZShyZXRyZWF0T3JkZXJlZFBpZWNlcywgcmV0cmVhdExvc3Nlcyk7XG4gICAgICAgIGNvbnN0IHJldHJlYXRSZW1haW5pbmcgPSBfLmRyb3AocmV0cmVhdE9yZGVyZWRQaWVjZXMsIHJldHJlYXRMb3NzZXMpO1xuXG4gICAgICAgIGNvbnN0IHdvcnN0Q2FzZUF0dGFja2VyTG9zc2VzID0gTWF0aC5mbG9vcihMb3NzZXMuY2FsY3VsYXRlVW5tb2RpZmllZExvc3NlcyhzdGF0ZSwgbm9SZXRyZWF0UmVtYWluaW5nLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gOC40LjMgLSBXaGVuIG5lZWRlZCB0byBlbnN1cmUgdGhlIHN1cnZpdmFsIG9mZiB0aGVpciBsYXN0IERlZmVuZGluZyBwaWVjZS5cbiAgICAgICAgaWYgKG5vUmV0cmVhdFJlbWFpbmluZy5sZW5ndGggPT09IDAgJiYgcmV0cmVhdFJlbWFpbmluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmZhY3Rpb25JZCArICcgd2FudHMgdG8gcmV0cmVhdCB0byBzYXZlIGxhc3QgcGllY2UnKTtcbiAgICAgICAgICAgIHdhbnRUb1JldHJlYXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gOC40LjMgLSBJZiBSb21hbiwgd2hlbiBuZWVkZWQgdG8gbG93ZXIgdGhlIG51bWJlciBvZiBmb3JjZWQgTG9zcyByb2xscyBhZ2FpbnN0IExlZ2lvbnNcbiAgICAgICAgaWYgKHRoaXMuZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgY29uc3Qgbm9uUmV0cmVhdExlZ2lvbnNSZW1vdmVkID0gXy5jb3VudEJ5KG5vUmV0cmVhdFJlbW92ZWQsICd0eXBlJykubGVnaW9uIHx8IDA7XG4gICAgICAgICAgICBjb25zdCByZXRyZWF0TGVnaW9uc1JlbW92ZWQgPSBfLmNvdW50QnkocmV0cmVhdFJlbW92ZWQsICd0eXBlJykubGVnaW9uIHx8IDA7XG5cbiAgICAgICAgICAgIGlmIChyZXRyZWF0TGVnaW9uc1JlbW92ZWQgPCBub25SZXRyZWF0TGVnaW9uc1JlbW92ZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmZhY3Rpb25JZCArICcgd2FudHMgdG8gcmV0cmVhdCB0byBsb3dlciBsZWdpb24gbG9zc2VzJyk7XG4gICAgICAgICAgICAgICAgd2FudFRvUmV0cmVhdCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyA4LjQuMyAtIElmIGRlZmVuZGluZyB3aXRob3V0IGEgRm9ydCBvciBDaXRhZGVsIGFuZCBhIFJldHJlYXQgaXRzZWxmIHdvdWxkIG5vdCByZW1vdmUgYW55XG4gICAgICAgIC8vIGRlZmVuZGluZyBwaWVjZXMsIHdoZW4gdGhleSBjYW5ub3QgZ3VhcmFudGVlIGluZmxpY3RpbmcgYXQgbGVhc3QgaGFsZiB0aGUgTG9zc2VzIGFnYWluc3RcbiAgICAgICAgLy8gdGhlIEF0dGFja2VyIHRoYXQgdGhleSB3aWxsIHN1ZmZlciAocmVnYXJkbGVzcyBvZiBob3cgbWFueSBwaWVjZXMgbWlnaHQgYmUgcmVtb3ZlZCBieSB0aGVcbiAgICAgICAgLy8gTG9zc2VzKS5cbiAgICAgICAgY29uc3QgaGFzRGVmZW5kaW5nQ2l0YWRlbE9yRm9ydCA9IF8uZmluZChkZWZlbmRpbmdQaWVjZXMsIHBpZWNlID0+IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJyB8fCBwaWVjZS50eXBlID09PSAnZm9ydCcpO1xuICAgICAgICBjb25zdCBjb3VudGVyQXR0YWNrTG9zc2VzVG9vRmV3ID0gd29yc3RDYXNlQXR0YWNrZXJMb3NzZXMgPCAobm9SZXRyZWF0TG9zc2VzIC8gMik7XG5cbiAgICAgICAgaWYgKCFoYXNEZWZlbmRpbmdDaXRhZGVsT3JGb3J0ICYmIGNvdW50ZXJBdHRhY2tMb3NzZXNUb29GZXcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjdGlvbklkICsgJyB3YW50cyB0byByZXRyZWF0IGR1ZSB0byBsYWNrIG9mIGNpdGFkZWwgb3IgZm9ydCBhbmQgdG9vIGZldyBjb3VudGVyYXR0YWNrIGxvc3NlcycpO1xuICAgICAgICAgICAgd2FudFRvUmV0cmVhdCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAod2FudFRvUmV0cmVhdCAmJiBoYXNTYWZlUmV0cmVhdFJlZ2lvbikge1xuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5mYWN0aW9uSWQgKyAnIHdpbGwgYmUgYWJsZSB0byByZXRyZWF0IHNhZmVseScpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGFncmVlaW5nRmFjdGlvbklkO1xuICAgICAgICBpZiAod2FudFRvUmV0cmVhdCAmJiAhaGFzU2FmZVJldHJlYXRSZWdpb24pIHtcbiAgICAgICAgICAgIGFncmVlaW5nRmFjdGlvbklkID0gdGhpcy5nZXRSZXRyZWF0QWdyZWVtZW50KHN0YXRlLCByZWdpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgd2lsbFJldHJlYXQgPSB3YW50VG9SZXRyZWF0ICYmIChoYXNTYWZlUmV0cmVhdFJlZ2lvbiB8fCBhZ3JlZWluZ0ZhY3Rpb25JZCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3aWxsUmV0cmVhdCxcbiAgICAgICAgICAgIGFncmVlaW5nRmFjdGlvbklkXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2V0UmV0cmVhdEFncmVlbWVudChzdGF0ZSwgcmVnaW9uKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZmFjdGlvbklkICsgJyBoYXMgdG8gYXNrIGZvciBhZ3JlZW1lbnQgdG8gcmV0cmVhdCcpO1xuICAgICAgICBjb25zdCBhZ3JlZW1lbnRSZXF1aXJlZFJldHJlYXRSZWdpb25zID0gXy5maWx0ZXIoXG4gICAgICAgICAgICByZWdpb24uYWRqYWNlbnQsIChhZGphY2VudFJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpICYmIGFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgIT09IHRoaXMuZmFjdGlvbklkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGFncmVlbWVudFJlcXVpcmVkUmV0cmVhdFJlZ2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gYWRqYWNlbnQgcmVnaW9ucyBjYW4gYmUgYXNrZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZhY3Rpb25zQXNrZWQgPSB7fTtcbiAgICAgICAgY29uc3QgYWdyZWVpbmdSZWdpb24gPSBfLmZpbmQoXG4gICAgICAgICAgICBhZ3JlZW1lbnRSZXF1aXJlZFJldHJlYXRSZWdpb25zLCAoYWdyZWVtZW50UmVxdWlyZWRSZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWdpb25GYWN0aW9uSWQgPSBhZ3JlZW1lbnRSZXF1aXJlZFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpO1xuICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uc0Fza2VkW3JlZ2lvbkZhY3Rpb25JZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXNraW5nICcgKyByZWdpb25GYWN0aW9uSWQgKyAnIGZvciByZWdpb24gJyArIGFncmVlbWVudFJlcXVpcmVkUmVnaW9uLm5hbWUpO1xuICAgICAgICAgICAgICAgIGZhY3Rpb25zQXNrZWRbcmVnaW9uRmFjdGlvbklkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdBZ3JlZW1lbnQgPSB0aGlzLmdldEV4aXN0aW5nQWdyZWVtZW50KHN0YXRlLCByZWdpb25GYWN0aW9uSWQsICdSZXRyZWF0QWdyZWVtZW50Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nQWdyZWVtZW50ID8gZXhpc3RpbmdBZ3JlZW1lbnQuc3RhdHVzID09PSAnYWdyZWVkJyA6IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bcmVnaW9uRmFjdGlvbklkXS53aWxsQWdyZWVUb1JldHJlYXQoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCByZWdpb25GYWN0aW9uSWQpO1xuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICBpZiAoYWdyZWVpbmdSZWdpb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFncmVlaW5nUmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgKyAnIGhhcyBhZ3JlZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBhZ3JlZW1lbnQgY291bGQgYmUgcmVhY2hlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhZ3JlZWluZ1JlZ2lvbiA/IGFncmVlaW5nUmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgOiBudWxsO1xuICAgIH1cblxuICAgIGdldEV4aXN0aW5nQWdyZWVtZW50KHN0YXRlLCBmYWN0aW9uSWQsIGFncmVlbWVudFR5cGUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmdldEN1cnJlbnRJbnRlcmFjdGlvbnMoKSxcbiAgICAgICAgICAgICAgICAgICAgICBhZ3JlZW1lbnQgPT4gYWdyZWVtZW50LnR5cGUgPT09IGFncmVlbWVudFR5cGUgJiYgYWdyZWVtZW50LnJlc3BvbmRpbmdGYWN0aW9uSWQgPT09IGZhY3Rpb25JZCk7XG4gICAgfVxuXG4gICAgZ2V0U3VwcGx5TGluZUFncmVlbWVudHMoc3RhdGUsIG1vZGlmaWVycywgZmFjdGlvbklkcykge1xuICAgICAgICBjb25zdCBhZ3JlZW1lbnRzID0gW107XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIGZhY3Rpb25JZHMsIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0FncmVlbWVudCA9IHRoaXMuZ2V0RXhpc3RpbmdBZ3JlZW1lbnQoc3RhdGUsIGZhY3Rpb25JZCwgJ1N1cHBseUxpbmVBZ3JlZW1lbnQnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhZ3JlZWQgPSBleGlzdGluZ0FncmVlbWVudCA/IGV4aXN0aW5nQWdyZWVtZW50LnN0YXR1cyA9PT0gJ2FncmVlZCcgOiBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0ud2lsbEFncmVlVG9TdXBwbHlMaW5lKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhY3Rpb25JZCArICcgYXNrZWQgJyArIGZhY3Rpb25JZCArICcgZm9yIHN1cHBseSBsaW5lIGFncmVlbWVudCAtPiAnICsgZmFjdGlvbklkICsgKGFncmVlZCA/ICcgYWdyZWVkJyA6ICcgZGVuaWVkJykpO1xuICAgICAgICAgICAgICAgIGlmIChhZ3JlZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWdyZWVtZW50cy5wdXNoKGZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGFncmVlbWVudHM7XG4gICAgfVxuXG4gICAgdGFrZUxvc3NlcyhzdGF0ZSwgYmF0dGxlUmVzdWx0cywgYXR0YWNrUmVzdWx0cywgY291bnRlcmF0dGFjaywgY2F1c2VkQnlDYXBhYmlsaXR5KSB7XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IGJhdHRsZVJlc3VsdHMucmVnaW9uO1xuICAgICAgICBjb25zdCBhdHRhY2tpbmdGYWN0aW9uID0gY291bnRlcmF0dGFjayA/IGJhdHRsZVJlc3VsdHMuZGVmZW5kaW5nRmFjdGlvbiA6IGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgYW1idXNoID0gYmF0dGxlUmVzdWx0cy53aWxsQW1idXNoICYmICFjYXVzZWRCeUNhcGFiaWxpdHk7XG5cbiAgICAgICAgY29uc3QgYmFsbGlzdGFlID0gc3RhdGUuaGFzVW5zaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFMTElTVEFFKSAmJiB0aGlzLmZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5ST01BTlM7XG4gICAgICAgIGxldCBhbGxvd1JvbGxzID0gY2F1c2VkQnlDYXBhYmlsaXR5IHx8ICghYW1idXNoICYmICFjb3VudGVyYXR0YWNrKTtcblxuICAgICAgICBpZiAoIWFsbG93Um9sbHMgJiYgIWNvdW50ZXJhdHRhY2sgJiYgdGhpcy5mYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TKSB7XG4gICAgICAgICAgICBjb25zdCBkZWZlbmRpbmdMZWFkZXIgPSBfLmZpbmQocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW3RoaXMuZmFjdGlvbklkXSwge3R5cGU6ICdsZWFkZXInfSk7XG4gICAgICAgICAgICBjb25zdCBjYWVzYXJEZWZlbmRpbmcgPSBkZWZlbmRpbmdMZWFkZXIgJiYgIWRlZmVuZGluZ0xlYWRlci5pc1N1Y2Nlc3NvcigpO1xuXG4gICAgICAgICAgICBpZiAoY2Flc2FyRGVmZW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWluUm9sbCA9IGF0dGFja2luZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQkVMR0FFID8gNSA6IDQ7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9sbCA9IF8ucmFuZG9tKDEsIDYpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDYWVzYXIgaXMgZGVmZW5kaW5nLCByZXF1aXJlcyBhIHJvbGwgPiAnICsgbWluUm9sbCArICcsIGdvdCAnICsgcm9sbCk7XG4gICAgICAgICAgICAgICAgYWxsb3dSb2xscyA9IHJvbGwgPj0gbWluUm9sbDtcbiAgICAgICAgICAgICAgICBpZiAoYWxsb3dSb2xscykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTG9zcyByb2xscyBhbmQgY291bnRlcmF0dGFjayBhbGxvd2VkIScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICAgICAgY29uc3QgYW1BdHRhY2tlciA9IGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbi5pZCA9PT0gdGhpcy5mYWN0aW9uSWQ7XG4gICAgICAgIGNvbnN0IG15UGllY2VzID0gYW1BdHRhY2tlciA/IEJhdHRsZS5nZXRBdHRhY2tpbmdQaWVjZXMoYmF0dGxlUmVzdWx0cykgOiBCYXR0bGUuZ2V0RGVmZW5kaW5nUGllY2VzKGJhdHRsZVJlc3VsdHMpO1xuICAgICAgICBjb25zdCBoZWxwaW5nRmFjdGlvbklkID0gKGFtQXR0YWNrZXIgJiYgYmF0dGxlUmVzdWx0cy53aWxsRW5saXN0R2VybWFucykgPyBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUyA6IG51bGw7XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IF8uY2xvbmUoTG9zc2VzLm9yZGVyUGllY2VzRm9yUmVtb3ZhbChzdGF0ZSwgbXlQaWVjZXMsIGJhdHRsZVJlc3VsdHMud2lsbFJldHJlYXQsIGhlbHBpbmdGYWN0aW9uSWQpKTtcbiAgICAgICAgY29uc3QgbG9zc2VzID0gYXR0YWNrUmVzdWx0cy5sb3NzZXM7XG5cbiAgICAgICAgY29uc3QgcmVtb3ZlZCA9IFtdO1xuXG4gICAgICAgIGlmKHRhcmdldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgXy5lYWNoKF8ucmFuZ2UoMCwgbG9zc2VzKSwgKGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2UgPSBfLmZpcnN0KHRhcmdldHMpO1xuICAgICAgICAgICAgICAgIGxldCB3aWxsUmVtb3ZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYW5Sb2xsRm9yTG9zcyA9IHBpZWNlLnR5cGUgPT09ICdsZWFkZXInIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJyB8fCBwaWVjZS50eXBlID09PSAnbGVnaW9uJyB8fCBwaWVjZS50eXBlID09PSAnZm9ydCc7XG4gICAgICAgICAgICAgICAgaWYgKGNhblJvbGxGb3JMb3NzICYmIGFsbG93Um9sbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sbCA9IF8ucmFuZG9tKDEsIDYpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUm9sbGluZyBmb3IgbG9zcyBvZiAnICsgcGllY2UudHlwZSArICcsIG5lZWQgNC02IGFuZCBnb3QgJyArIHJvbGwpO1xuICAgICAgICAgICAgICAgICAgICB3aWxsUmVtb3ZlID0gcm9sbCA8ICgocGllY2UudHlwZSA9PT0gJ2ZvcnQnICYmIGJhbGxpc3RhZSkgPyAzIDogNCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHdpbGxSZW1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKHRhcmdldHMuc2hpZnQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwaWVjZS50eXBlICsgJyBzYXZlZCEnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXR0YWNrUmVzdWx0cy5yZW1vdmVkID0gcmVtb3ZlZDtcbiAgICAgICAgYXR0YWNrUmVzdWx0cy5yZW1haW5pbmcgPSB0YXJnZXRzO1xuXG4gICAgICAgIGlmIChhdHRhY2tSZXN1bHRzLnJlbW92ZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBhdHRhY2tSZXN1bHRzLnJlbW92ZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF0dGFja1Jlc3VsdHMuY291bnRlcmF0dGFja1Bvc3NpYmxlID0gYWxsb3dSb2xscyAmJiBfLmZpbmQoYXR0YWNrUmVzdWx0cy5yZW1haW5pbmcsIHtpc01vYmlsZTogdHJ1ZX0pO1xuICAgIH1cblxuXG5cbiAgICByZXRyZWF0RnJvbUJhdHRsZShzdGF0ZSwgYmF0dGxlUmVzdWx0cywgYXR0YWNrUmVzdWx0cykge1xuICAgICAgICBjb25zdCByZWdpb24gPSBiYXR0bGVSZXN1bHRzLnJlZ2lvbjtcbiAgICAgICAgY29uc3QgYXR0YWNraW5nRmFjdGlvbiA9IGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbjtcbiAgICAgICAgY29uc3QgY2FuUmV0cmVhdEluUGxhY2UgPSBhdHRhY2tpbmdGYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLlJPTUFOUyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFjdGlvbklkICE9PSBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUztcblxuICAgICAgICBjb25zdCBsZWFkZXIgPSBfLmZpbmQoYXR0YWNrUmVzdWx0cy5yZW1haW5pbmcsIHt0eXBlOiAnbGVhZGVyJ30pO1xuICAgICAgICBjb25zdCBncm91cGVkUGllY2VzID0gXy5ncm91cEJ5KFxuICAgICAgICAgICAgYXR0YWNrUmVzdWx0cy5yZW1haW5pbmcsIChwaWVjZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgJiYgIXBpZWNlLnJldmVhbGVkKCkgJiYgY2FuUmV0cmVhdEluUGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzdGF5aW5nJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ2xlYWRlcicgJiYgY2FuUmV0cmVhdEluUGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsZWFkZXInO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChwaWVjZS5pc01vYmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2xlYXZpbmcnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAnc3RheWluZyc7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgcmV0cmVhdFJlZ2lvbiA9IHRoaXMucmV0cmVhdFBpZWNlcyhzdGF0ZSwgcmVnaW9uLCBncm91cGVkUGllY2VzLmxlYXZpbmcgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja1Jlc3VsdHMuYWdyZWVpbmdGYWN0aW9uSWQpO1xuXG5cbiAgICAgICAgaWYgKGdyb3VwZWRQaWVjZXMubGVhZGVyICYmIHJldHJlYXRSZWdpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUZyaWVuZGx5UGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldEZyaWVuZGx5UGllY2VzID0gcmV0cmVhdFJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgICAgICBpZiAodGFyZ2V0RnJpZW5kbHlQaWVjZXMubGVuZ3RoID4gc291cmNlRnJpZW5kbHlQaWVjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgTW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IHJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogcmV0cmVhdFJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogZ3JvdXBlZFBpZWNlcy5sZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXRyZWF0UGllY2VzKHN0YXRlLCByZWdpb24sIHBpZWNlcywgYWdyZWVpbmdGYWN0aW9uSWQpIHtcbiAgICAgICAgaWYgKHBpZWNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldFJlZ2lvbiA9IHRoaXMuZmluZFJldHJlYXRSZWdpb24oc3RhdGUsIHJlZ2lvbiwgYWdyZWVpbmdGYWN0aW9uSWQpO1xuICAgICAgICBpZiAodGFyZ2V0UmVnaW9uKSB7XG4gICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IHJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiB0YXJnZXRSZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlczogcGllY2VzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IHRoaXMuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhcmdldFJlZ2lvbjtcbiAgICB9XG5cbiAgICBmaW5kUmV0cmVhdFJlZ2lvbihzdGF0ZSwgcmVnaW9uLCBhZ3JlZWluZ0ZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXyhyZWdpb24uYWRqYWNlbnQpLnJlamVjdChcbiAgICAgICAgICAgIGFkamFjZW50ID0+ICghYWRqYWNlbnQuY29udHJvbGxpbmdGYWN0aW9uSWQoKSB8fCAoYWRqYWNlbnQuY29udHJvbGxpbmdGYWN0aW9uSWQoKSAhPT0gdGhpcy5mYWN0aW9uSWQgJiYgYWRqYWNlbnQuY29udHJvbGxpbmdGYWN0aW9uSWQoKSAhPT0gYWdyZWVpbmdGYWN0aW9uSWQpKSkubWFwKFxuICAgICAgICAgICAgKGFkamFjZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZnJpZW5kbHlQaWVjZXMgPSBhZGphY2VudC5nZXRQaWVjZXNGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBudW1GcmllbmRseTogZnJpZW5kbHlQaWVjZXMubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICByZWdpb246IGFkamFjZW50XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc29ydEJ5KCdudW1GcmllbmRseScpLmdyb3VwQnkoJ251bUZyaWVuZGx5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLnJldmVyc2UoKS5tYXAoJ3JlZ2lvbicpLmZpcnN0KCk7XG5cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEJvdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9ib3QuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUZBO0FBR0E7QUFDQTs7O0FBQ0E7OztBQUlBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTs7O0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUVBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _raidResults = __webpack_require__(158);\n\nvar _raidResults2 = _interopRequireDefault(_raidResults);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Raid = function (_Command) {\n    _inherits(Raid, _Command);\n\n    function Raid() {\n        _classCallCheck(this, Raid);\n\n        return _possibleConstructorReturn(this, (Raid.__proto__ || Object.getPrototypeOf(Raid)).apply(this, arguments));\n    }\n\n    _createClass(Raid, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var faction = args.faction;\n            return this.generateResultsForRegions(state, faction, state.regions);\n        }\n    }, {\n        key: 'generateResultsForRegions',\n        value: function generateResultsForRegions(state, faction, regions) {\n            var isGermanic = faction.id === _factionIds2.default.GERMANIC_TRIBES;\n            return (0, _lodash2.default)(regions).map(function (region) {\n                var hiddenWarbands = _lodash2.default.filter(region.piecesByFaction()[faction.id], function (piece) {\n                    return piece.type === 'warband' && !piece.revealed();\n                });\n\n                if (hiddenWarbands.length === 0) {\n                    return;\n                }\n\n                var hasBaggageTrain = state.hasShadedCapability(_capabilities.CapabilityIDs.BAGGAGE_TRAINS, faction.id);\n                var raidableFactions = (0, _lodash2.default)(region.piecesByFaction()).map(function (pieces, factionId) {\n                    if (factionId === faction.id || factionId === _factionIds2.default.GERMANIC_TRIBES) {\n                        return;\n                    }\n\n                    if (state.factionsById[factionId].resources() === 0) {\n                        return;\n                    }\n\n                    var hasCitadelOrFort = _lodash2.default.find(pieces, function (piece) {\n                        return piece.type === 'citadel' || piece.type === 'fort';\n                    });\n\n                    if (hasCitadelOrFort && !hasBaggageTrain) {\n                        return;\n                    }\n\n                    return factionId;\n                }).compact().value();\n\n                if (raidableFactions.length === 0 && (region.devastated() || isGermanic)) {\n                    return;\n                }\n\n                return new _raidResults2.default({\n                    region: region,\n                    faction: faction,\n                    raidableFactions: raidableFactions\n                });\n            }).compact().value();\n        }\n    }]);\n\n    return Raid;\n}(_command2.default);\n\nexports.default = Raid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcmFpZC5qcz8yMzgxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi9jb21tYW5kJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSYWlkUmVzdWx0cyBmcm9tICcuL3JhaWRSZXN1bHRzJztcbmltcG9ydCB7Q2FwYWJpbGl0eUlEc30gZnJvbSAnLi4vY29uZmlnL2NhcGFiaWxpdGllcyc7XG5cblxuY2xhc3MgUmFpZCBleHRlbmRzIENvbW1hbmQge1xuICAgIHN0YXRpYyBkb1Rlc3Qoc3RhdGUsIGFyZ3MpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IGFyZ3MuZmFjdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVSZXN1bHRzRm9yUmVnaW9ucyhzdGF0ZSwgZmFjdGlvbiwgc3RhdGUucmVnaW9ucyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdlbmVyYXRlUmVzdWx0c0ZvclJlZ2lvbnMoc3RhdGUsIGZhY3Rpb24sIHJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3QgaXNHZXJtYW5pYyA9IGZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuICAgICAgICByZXR1cm4gXyhyZWdpb25zKS5tYXAoXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGlkZGVuV2FyYmFuZHMgPSBfLmZpbHRlcihyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbi5pZF0sIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyAmJiAhcGllY2UucmV2ZWFsZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaGlkZGVuV2FyYmFuZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBoYXNCYWdnYWdlVHJhaW4gPSBzdGF0ZS5oYXNTaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFHR0FHRV9UUkFJTlMsIGZhY3Rpb24uaWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhaWRhYmxlRmFjdGlvbnMgPSBfKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKSkubWFwKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocGllY2VzLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uSWQgPT09IGZhY3Rpb24uaWQgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZhY3Rpb25zQnlJZFtmYWN0aW9uSWRdLnJlc291cmNlcygpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNDaXRhZGVsT3JGb3J0ID0gXy5maW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlcywgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnY2l0YWRlbCcgfHwgcGllY2UudHlwZSA9PT0gJ2ZvcnQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2l0YWRlbE9yRm9ydCAmJiAhaGFzQmFnZ2FnZVRyYWluKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgIGlmIChyYWlkYWJsZUZhY3Rpb25zLmxlbmd0aCA9PT0gMCAmJiAocmVnaW9uLmRldmFzdGF0ZWQoKSB8fCBpc0dlcm1hbmljKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSYWlkUmVzdWx0cyhcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uOiBmYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmFpZGFibGVGYWN0aW9uczogcmFpZGFibGVGYWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJhaWQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcmFpZC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7QUFFQTs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQU9BO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _SenateApprovalStateN;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar SenateApprovalStates = {\n    UPROAR: 0,\n    INTRIGUE: 1,\n    ADULATION: 2\n};\n\nvar SenateApprovalStateNames = (_SenateApprovalStateN = {}, _defineProperty(_SenateApprovalStateN, SenateApprovalStates.UPROAR, 'Uproar'), _defineProperty(_SenateApprovalStateN, SenateApprovalStates.INTRIGUE, 'Intrigue'), _defineProperty(_SenateApprovalStateN, SenateApprovalStates.ADULATION, 'Adulation'), _SenateApprovalStateN);\n\nexports.SenateApprovalStates = SenateApprovalStates;\nexports.SenateApprovalStateNames = SenateApprovalStateNames;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3NlbmF0ZUFwcHJvdmFsU3RhdGVzLmpzPzczZmIiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2VuYXRlQXBwcm92YWxTdGF0ZXMgPSB7XG4gICAgVVBST0FSOiAwLFxuICAgIElOVFJJR1VFOiAxLFxuICAgIEFEVUxBVElPTjogMlxufTtcblxuY29uc3QgU2VuYXRlQXBwcm92YWxTdGF0ZU5hbWVzID0ge1xuICAgIFtTZW5hdGVBcHByb3ZhbFN0YXRlcy5VUFJPQVJdIDogJ1Vwcm9hcicsXG4gICAgW1NlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFXTogJ0ludHJpZ3VlJyxcbiAgICBbU2VuYXRlQXBwcm92YWxTdGF0ZXMuQURVTEFUSU9OXTogJ0FkdWxhdGlvbidcbn07XG5cbmV4cG9ydCB7IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLCBTZW5hdGVBcHByb3ZhbFN0YXRlTmFtZXMgfTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29uZmlnL3NlbmF0ZUFwcHJvdmFsU3RhdGVzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUtBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _faction = __webpack_require__(85);\n\nvar _faction2 = _interopRequireDefault(_faction);\n\nvar _warband = __webpack_require__(185);\n\nvar _warband2 = _interopRequireDefault(_warband);\n\nvar _leader = __webpack_require__(183);\n\nvar _leader2 = _interopRequireDefault(_leader);\n\nvar _alliedTribe = __webpack_require__(179);\n\nvar _alliedTribe2 = _interopRequireDefault(_alliedTribe);\n\nvar _citadel = __webpack_require__(181);\n\nvar _citadel2 = _interopRequireDefault(_citadel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar FallingSkyFaction = function (_Faction) {\n    _inherits(FallingSkyFaction, _Faction);\n\n    function FallingSkyFaction(definition) {\n        _classCallCheck(this, FallingSkyFaction);\n\n        var _this = _possibleConstructorReturn(this, (FallingSkyFaction.__proto__ || Object.getPrototypeOf(FallingSkyFaction)).call(this, definition));\n\n        _this.resources = _knockout2.default.observable(0);\n        _this.numStartingWarbands = definition.numWarbands || 0;\n        _this.numStartingAlliedTribes = definition.numAlliedTribes || 0;\n        _this.numStartingCitadels = definition.numCitadels || 0;\n        _this.hasLeader = definition.hasLeader || false;\n        _this.passResources = definition.passResources || 1;\n\n        _this.availableLeader = _knockout2.default.observable();\n        if (_this.hasLeader) {\n            _this.availableLeader(new _leader2.default({ factionId: definition.id, name: definition.leaderName }));\n        }\n\n        _this.availableWarbands = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(definition.numWarbands), function () {\n            return new _warband2.default({ factionId: definition.id });\n        }));\n        _this.availableAlliedTribes = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(definition.numAlliedTribes), function () {\n            return new _alliedTribe2.default({ factionId: definition.id });\n        }));\n        _this.availableCitadels = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(definition.numCitadels), function () {\n            return new _citadel2.default({ factionId: definition.id });\n        }));\n\n        _this.numAlliedTribesAndCitadelsPlaced = _knockout2.default.pureComputed(function () {\n            return _this.numStartingAlliedTribes + _this.numStartingCitadels - (_this.availableAlliedTribes().length + _this.availableCitadels().length);\n        });\n        return _this;\n    }\n\n    _createClass(FallingSkyFaction, [{\n        key: 'victoryMargin',\n        value: function victoryMargin(state) {\n            return -100;\n        }\n    }, {\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return false;\n        }\n    }, {\n        key: 'setResources',\n        value: function setResources(count) {\n            this.resources(count);\n        }\n    }, {\n        key: 'addResources',\n        value: function addResources(count) {\n            var resourcesBeforeAdd = this.resources();\n            var resourcesAfterAdd = Math.min(this.resources() + count, 45);\n            if (resourcesBeforeAdd === resourcesAfterAdd) {\n                return 0;\n            }\n            this.resources(resourcesAfterAdd);\n            console.log(this.name + ' is adding ' + (resourcesAfterAdd - resourcesBeforeAdd) + ' resources.  Now at ' + resourcesAfterAdd);\n            return resourcesAfterAdd - resourcesBeforeAdd;\n        }\n    }, {\n        key: 'removeResources',\n        value: function removeResources(count) {\n            var resourcesBeforeRemove = this.resources();\n            var resourcesAfterRemove = Math.max(this.resources() - count, 0);\n            if (resourcesBeforeRemove === resourcesAfterRemove) {\n                return 0;\n            }\n            this.resources(resourcesAfterRemove);\n            console.log(this.name + ' is removing ' + (resourcesBeforeRemove - resourcesAfterRemove) + ' resources.  Now at ' + resourcesAfterRemove);\n            return resourcesBeforeRemove - resourcesAfterRemove;\n        }\n    }, {\n        key: 'hasAvailableLeader',\n        value: function hasAvailableLeader() {\n            return this.availableLeader();\n        }\n    }, {\n        key: 'removeLeader',\n        value: function removeLeader() {\n            var leader = this.availableLeader();\n            this.availableLeader(null);\n            return leader;\n        }\n    }, {\n        key: 'returnLeader',\n        value: function returnLeader(leader) {\n            leader.isSuccessor(true);\n            this.availableLeader(leader);\n        }\n    }, {\n        key: 'hasAvailableWarbands',\n        value: function hasAvailableWarbands(count) {\n            return count <= this.availableWarbands().length;\n        }\n    }, {\n        key: 'removeWarbands',\n        value: function removeWarbands(count) {\n            return this.availableWarbands.splice(0, count);\n        }\n    }, {\n        key: 'returnWarbands',\n        value: function returnWarbands(warbands) {\n            _lodash2.default.each(warbands, function (warband) {\n                warband.revealed(false);\n                warband.scouted(false);\n            });\n            this.availableWarbands.push.apply(this.availableWarbands, warbands);\n        }\n    }, {\n        key: 'hasAvailableAlliedTribe',\n        value: function hasAvailableAlliedTribe() {\n            return this.availableAlliedTribes().length > 0;\n        }\n    }, {\n        key: 'removeAlliedTribe',\n        value: function removeAlliedTribe() {\n            return this.availableAlliedTribes.pop();\n        }\n    }, {\n        key: 'returnAlliedTribe',\n        value: function returnAlliedTribe(alliedTribe) {\n            if (alliedTribe) {\n                this.availableAlliedTribes.push(alliedTribe);\n            }\n        }\n    }, {\n        key: 'returnAlliedTribes',\n        value: function returnAlliedTribes(alliedTribes) {\n            if (alliedTribes) {\n                this.availableAlliedTribes.push.apply(this.availableAlliedTribes, alliedTribes);\n            }\n        }\n    }, {\n        key: 'hasAvailableCitadel',\n        value: function hasAvailableCitadel() {\n            return this.availableCitadels().length > 0;\n        }\n    }, {\n        key: 'removeCitadel',\n        value: function removeCitadel() {\n            return this.availableCitadels.pop();\n        }\n    }, {\n        key: 'returnCitadel',\n        value: function returnCitadel(citadel) {\n            this.availableCitadels.push(citadel);\n        }\n    }, {\n        key: 'hasPlacedCitadel',\n        value: function hasPlacedCitadel() {\n            return this.numStartingCitadels - this.availableCitadels().length;\n        }\n    }, {\n        key: 'logState',\n        value: function logState(state) {\n            console.log('*** ' + this.name + ' Faction ***');\n            if (state) {\n                console.log('    Victory Margin: ' + this.victoryMargin(state));\n            }\n            console.log('    Resources: ' + this.resources());\n            if (this.availableLeader) {\n                console.log('    Available Leader: ' + (this.availableLeader() ? this.availableLeader().toString() : 'None'));\n            }\n            console.log('    Available Citadels: ' + this.availableCitadels().length);\n            console.log('    Available Allies: ' + this.availableAlliedTribes().length);\n            console.log('    Available Warbands: ' + this.availableWarbands().length);\n        }\n    }]);\n\n    return FallingSkyFaction;\n}(_faction2.default);\n\nexports.default = FallingSkyFaction;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvZmFjdGlvbnMvZmFsbGluZ1NreUZhY3Rpb24uanM/NzI4NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBrbyBmcm9tICcuLi8uLi9saWIva25vY2tvdXQnO1xuaW1wb3J0IEZhY3Rpb24gZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3Rpb24nO1xuaW1wb3J0IFdhcmJhbmQgZnJvbSAnLi4vcGllY2VzL3dhcmJhbmQnO1xuaW1wb3J0IExlYWRlciBmcm9tICcuLi9waWVjZXMvbGVhZGVyJztcbmltcG9ydCBBbGxpZWRUcmliZSBmcm9tICcuLi9waWVjZXMvYWxsaWVkVHJpYmUnO1xuaW1wb3J0IENpdGFkZWwgZnJvbSAnLi4vcGllY2VzL2NpdGFkZWwnO1xuXG5jbGFzcyBGYWxsaW5nU2t5RmFjdGlvbiBleHRlbmRzIEZhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgICAgIHRoaXMucmVzb3VyY2VzID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgdGhpcy5udW1TdGFydGluZ1dhcmJhbmRzID0gZGVmaW5pdGlvbi5udW1XYXJiYW5kcyB8fCAwO1xuICAgICAgICB0aGlzLm51bVN0YXJ0aW5nQWxsaWVkVHJpYmVzID0gZGVmaW5pdGlvbi5udW1BbGxpZWRUcmliZXMgfHwgMDtcbiAgICAgICAgdGhpcy5udW1TdGFydGluZ0NpdGFkZWxzID0gZGVmaW5pdGlvbi5udW1DaXRhZGVscyB8fCAwO1xuICAgICAgICB0aGlzLmhhc0xlYWRlciA9IGRlZmluaXRpb24uaGFzTGVhZGVyIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLnBhc3NSZXNvdXJjZXMgPSBkZWZpbml0aW9uLnBhc3NSZXNvdXJjZXMgfHwgMTtcblxuICAgICAgICB0aGlzLmF2YWlsYWJsZUxlYWRlciA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgaWYodGhpcy5oYXNMZWFkZXIpIHtcbiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlTGVhZGVyIChuZXcgTGVhZGVyKHtmYWN0aW9uSWQ6IGRlZmluaXRpb24uaWQsIG5hbWU6IGRlZmluaXRpb24ubGVhZGVyTmFtZX0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlV2FyYmFuZHMgPSBrby5vYnNlcnZhYmxlQXJyYXkoXG4gICAgICAgICAgICBfLm1hcChcbiAgICAgICAgICAgICAgICBfLnJhbmdlKGRlZmluaXRpb24ubnVtV2FyYmFuZHMpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgV2FyYmFuZCh7ZmFjdGlvbklkOiBkZWZpbml0aW9uLmlkfSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLmF2YWlsYWJsZUFsbGllZFRyaWJlcyA9IGtvLm9ic2VydmFibGVBcnJheShcbiAgICAgICAgICAgIF8ubWFwKFxuICAgICAgICAgICAgICAgIF8ucmFuZ2UoZGVmaW5pdGlvbi5udW1BbGxpZWRUcmliZXMpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQWxsaWVkVHJpYmUoe2ZhY3Rpb25JZDogZGVmaW5pdGlvbi5pZH0pO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5hdmFpbGFibGVDaXRhZGVscyA9IGtvLm9ic2VydmFibGVBcnJheShcbiAgICAgICAgICAgIF8ubWFwKFxuICAgICAgICAgICAgICAgIF8ucmFuZ2UoZGVmaW5pdGlvbi5udW1DaXRhZGVscyksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaXRhZGVsKHtmYWN0aW9uSWQ6IGRlZmluaXRpb24uaWR9KTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy5udW1BbGxpZWRUcmliZXNBbmRDaXRhZGVsc1BsYWNlZCA9IGtvLnB1cmVDb21wdXRlZChcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMubnVtU3RhcnRpbmdBbGxpZWRUcmliZXMgKyB0aGlzLm51bVN0YXJ0aW5nQ2l0YWRlbHMpIC1cbiAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkubGVuZ3RoICsgdGhpcy5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2aWN0b3J5TWFyZ2luKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiAtMTAwO1xuICAgIH1cblxuICAgIGlzSG9tZVJlZ2lvbihyZWdpb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHNldFJlc291cmNlcyhjb3VudCkge1xuICAgICAgICB0aGlzLnJlc291cmNlcyhjb3VudCk7XG4gICAgfVxuXG4gICAgYWRkUmVzb3VyY2VzKGNvdW50KSB7XG4gICAgICAgIGNvbnN0IHJlc291cmNlc0JlZm9yZUFkZCA9IHRoaXMucmVzb3VyY2VzKCk7XG4gICAgICAgIGNvbnN0IHJlc291cmNlc0FmdGVyQWRkID0gTWF0aC5taW4odGhpcy5yZXNvdXJjZXMoKSArIGNvdW50LCA0NSk7XG4gICAgICAgIGlmIChyZXNvdXJjZXNCZWZvcmVBZGQgPT09IHJlc291cmNlc0FmdGVyQWRkKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc291cmNlcyhyZXNvdXJjZXNBZnRlckFkZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubmFtZSArICcgaXMgYWRkaW5nICcgKyAocmVzb3VyY2VzQWZ0ZXJBZGQgLSByZXNvdXJjZXNCZWZvcmVBZGQpICsgJyByZXNvdXJjZXMuICBOb3cgYXQgJyArIHJlc291cmNlc0FmdGVyQWRkKTtcbiAgICAgICAgcmV0dXJuIHJlc291cmNlc0FmdGVyQWRkIC0gcmVzb3VyY2VzQmVmb3JlQWRkO1xuICAgIH1cblxuICAgIHJlbW92ZVJlc291cmNlcyhjb3VudCkge1xuICAgICAgICBjb25zdCByZXNvdXJjZXNCZWZvcmVSZW1vdmUgPSB0aGlzLnJlc291cmNlcygpO1xuICAgICAgICBjb25zdCByZXNvdXJjZXNBZnRlclJlbW92ZSA9IE1hdGgubWF4KHRoaXMucmVzb3VyY2VzKCkgLSBjb3VudCwgMCk7XG4gICAgICAgIGlmIChyZXNvdXJjZXNCZWZvcmVSZW1vdmUgPT09IHJlc291cmNlc0FmdGVyUmVtb3ZlKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc291cmNlcyhyZXNvdXJjZXNBZnRlclJlbW92ZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubmFtZSArICcgaXMgcmVtb3ZpbmcgJyArIChyZXNvdXJjZXNCZWZvcmVSZW1vdmUgLSByZXNvdXJjZXNBZnRlclJlbW92ZSkgKyAnIHJlc291cmNlcy4gIE5vdyBhdCAnICsgcmVzb3VyY2VzQWZ0ZXJSZW1vdmUpO1xuICAgICAgICByZXR1cm4gcmVzb3VyY2VzQmVmb3JlUmVtb3ZlIC0gcmVzb3VyY2VzQWZ0ZXJSZW1vdmU7XG4gICAgfVxuXG4gICAgaGFzQXZhaWxhYmxlTGVhZGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hdmFpbGFibGVMZWFkZXIoKTtcbiAgICB9XG5cbiAgICByZW1vdmVMZWFkZXIoKSB7XG4gICAgICAgIGNvbnN0IGxlYWRlciA9IHRoaXMuYXZhaWxhYmxlTGVhZGVyKCk7XG4gICAgICAgIHRoaXMuYXZhaWxhYmxlTGVhZGVyKG51bGwpO1xuICAgICAgICByZXR1cm4gbGVhZGVyO1xuICAgIH1cblxuICAgIHJldHVybkxlYWRlcihsZWFkZXIpIHtcbiAgICAgICAgbGVhZGVyLmlzU3VjY2Vzc29yKHRydWUpO1xuICAgICAgICB0aGlzLmF2YWlsYWJsZUxlYWRlcihsZWFkZXIpO1xuICAgIH1cblxuXG4gICAgaGFzQXZhaWxhYmxlV2FyYmFuZHMoY291bnQpIHtcbiAgICAgICAgcmV0dXJuIGNvdW50IDw9IHRoaXMuYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgcmVtb3ZlV2FyYmFuZHMoY291bnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlV2FyYmFuZHMuc3BsaWNlKDAsIGNvdW50KTtcbiAgICB9XG5cbiAgICByZXR1cm5XYXJiYW5kcyh3YXJiYW5kcykge1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICB3YXJiYW5kcywgZnVuY3Rpb24gKHdhcmJhbmQpIHtcbiAgICAgICAgICAgICAgICB3YXJiYW5kLnJldmVhbGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB3YXJiYW5kLnNjb3V0ZWQoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYXZhaWxhYmxlV2FyYmFuZHMucHVzaC5hcHBseSh0aGlzLmF2YWlsYWJsZVdhcmJhbmRzLCB3YXJiYW5kcyk7XG4gICAgfVxuXG4gICAgaGFzQXZhaWxhYmxlQWxsaWVkVHJpYmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgcmVtb3ZlQWxsaWVkVHJpYmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF2YWlsYWJsZUFsbGllZFRyaWJlcy5wb3AoKTtcbiAgICB9XG5cbiAgICByZXR1cm5BbGxpZWRUcmliZShhbGxpZWRUcmliZSkge1xuICAgICAgICBpZiAoYWxsaWVkVHJpYmUpIHtcbiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlQWxsaWVkVHJpYmVzLnB1c2goYWxsaWVkVHJpYmUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuQWxsaWVkVHJpYmVzKGFsbGllZFRyaWJlcykge1xuICAgICAgICBpZiAoYWxsaWVkVHJpYmVzKSB7XG4gICAgICAgICAgICB0aGlzLmF2YWlsYWJsZUFsbGllZFRyaWJlcy5wdXNoLmFwcGx5KHRoaXMuYXZhaWxhYmxlQWxsaWVkVHJpYmVzLCBhbGxpZWRUcmliZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzQXZhaWxhYmxlQ2l0YWRlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlQ2l0YWRlbHMoKS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHJlbW92ZUNpdGFkZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF2YWlsYWJsZUNpdGFkZWxzLnBvcCgpO1xuICAgIH1cblxuICAgIHJldHVybkNpdGFkZWwoY2l0YWRlbCkge1xuICAgICAgICB0aGlzLmF2YWlsYWJsZUNpdGFkZWxzLnB1c2goY2l0YWRlbCk7XG4gICAgfVxuXG4gICAgaGFzUGxhY2VkQ2l0YWRlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubnVtU3RhcnRpbmdDaXRhZGVscyAtIHRoaXMuYXZhaWxhYmxlQ2l0YWRlbHMoKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgbG9nU3RhdGUoc3RhdGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiAnICsgdGhpcy5uYW1lICsgJyBGYWN0aW9uICoqKicpO1xuICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgICAgVmljdG9yeSBNYXJnaW46ICcgKyB0aGlzLnZpY3RvcnlNYXJnaW4oc3RhdGUpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnICAgIFJlc291cmNlczogJyArIHRoaXMucmVzb3VyY2VzKCkpO1xuICAgICAgICBpZiAodGhpcy5hdmFpbGFibGVMZWFkZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgICAgQXZhaWxhYmxlIExlYWRlcjogJyArICh0aGlzLmF2YWlsYWJsZUxlYWRlcigpID8gdGhpcy5hdmFpbGFibGVMZWFkZXIoKS50b1N0cmluZygpIDogJ05vbmUnKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJyAgICBBdmFpbGFibGUgQ2l0YWRlbHM6ICcgKyB0aGlzLmF2YWlsYWJsZUNpdGFkZWxzKCkubGVuZ3RoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBBdmFpbGFibGUgQWxsaWVzOiAnICsgdGhpcy5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGgpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAgIEF2YWlsYWJsZSBXYXJiYW5kczogJyArIHRoaXMuYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRmFsbGluZ1NreUZhY3Rpb247XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2ZhbGxpbmdTa3lGYWN0aW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQWxDQTtBQW1DQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _trade = __webpack_require__(148);\n\nvar _trade2 = _interopRequireDefault(_trade);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AeduiTrade = function () {\n    function AeduiTrade() {\n        _classCallCheck(this, AeduiTrade);\n    }\n\n    _createClass(AeduiTrade, null, [{\n        key: 'trade',\n        value: function trade(state, modifiers) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var romanFaction = state.factionsById[_factionIds2.default.ROMANS];\n\n            if (aeduiFaction.resources() >= 10 && aeduiFaction.resources() + romanFaction.resources() >= 20) {\n                return false;\n            }\n\n            if (aeduiFaction.resources() > 42) {\n                return false;\n            }\n\n            var possibleTrades = _trade2.default.test(state);\n            if (!possibleTrades || possibleTrades.length === 0) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.TRADE);\n            console.log('*** Aedui checking trade viability ***');\n            var bot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var agreeingFactionsNeeded = (0, _lodash2.default)(possibleTrades).map('agreementsNeeded').flatten().flatten().concat([_factionIds2.default.ROMANS]).uniq().value();\n            var agreements = bot.getSupplyLineAgreements(state, modifiers, agreeingFactionsNeeded);\n\n            var resourcesToBeGained = _lodash2.default.reduce(possibleTrades, function (sum, regionResult) {\n                var inSupplyLine = regionResult.inSupplyLine || _lodash2.default.find(regionResult.agreementsNeeded, function (factionList) {\n                    return _lodash2.default.difference(factionList, agreements).length === 0;\n                });\n\n                if (!inSupplyLine) {\n                    return sum;\n                }\n\n                var romanAgreement = _lodash2.default.indexOf(agreements, _factionIds2.default.ROMANS) >= 0;\n                return sum + (romanAgreement ? regionResult.totalAeduiWithRoman : regionResult.totalAedui);\n            }, 0);\n\n            if (resourcesToBeGained <= 2) {\n                console.log('*** Aedui cannot viably trade ***');\n                state.turnHistory.getCurrentTurn().rollbackSpecialAbility();\n                return false;\n            }\n            console.log('*** Aedui Trading ***');\n\n            _addResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: resourcesToBeGained });\n            state.turnHistory.getCurrentTurn().commitSpecialAbility();\n\n            return true;\n        }\n    }]);\n\n    return AeduiTrade;\n}();\n\nexports.default = AeduiTrade;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aVRyYWRlLmpzP2MzYzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgU3BlY2lhbEFiaWxpdHlJRHMgZnJvbSAnLi4vLi4vY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBUcmFkZSBmcm9tICcuLi8uLi9jb21tYW5kcy9hZWR1aS90cmFkZSc7XG5pbXBvcnQgQWRkUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcblxuY2xhc3MgQWVkdWlUcmFkZSB7XG5cbiAgICBzdGF0aWMgdHJhZGUoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IHJvbWFuRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLlJPTUFOU107XG5cbiAgICAgICAgaWYgKGFlZHVpRmFjdGlvbi5yZXNvdXJjZXMoKSA+PSAxMCAmJiAoYWVkdWlGYWN0aW9uLnJlc291cmNlcygpICsgcm9tYW5GYWN0aW9uLnJlc291cmNlcygpID49IDIwKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFlZHVpRmFjdGlvbi5yZXNvdXJjZXMoKSA+IDQyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGNvbnN0IHBvc3NpYmxlVHJhZGVzID0gVHJhZGUudGVzdChzdGF0ZSk7XG4gICAgICAgIGlmKCFwb3NzaWJsZVRyYWRlcyB8fCBwb3NzaWJsZVRyYWRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuc3RhcnRTcGVjaWFsQWJpbGl0eShTcGVjaWFsQWJpbGl0eUlEcy5UUkFERSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQWVkdWkgY2hlY2tpbmcgdHJhZGUgdmlhYmlsaXR5ICoqKicpO1xuICAgICAgICBjb25zdCBib3QgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICBjb25zdCBhZ3JlZWluZ0ZhY3Rpb25zTmVlZGVkID0gXyhwb3NzaWJsZVRyYWRlcykubWFwKCdhZ3JlZW1lbnRzTmVlZGVkJykuZmxhdHRlbigpLmZsYXR0ZW4oKS5jb25jYXQoW0ZhY3Rpb25JRHMuUk9NQU5TXSkudW5pcSgpLnZhbHVlKCk7XG4gICAgICAgIGNvbnN0IGFncmVlbWVudHMgPSBib3QuZ2V0U3VwcGx5TGluZUFncmVlbWVudHMoc3RhdGUsIG1vZGlmaWVycywgYWdyZWVpbmdGYWN0aW9uc05lZWRlZCk7XG5cblxuXG4gICAgICAgIGNvbnN0IHJlc291cmNlc1RvQmVHYWluZWQgPSBfLnJlZHVjZShcbiAgICAgICAgICAgIHBvc3NpYmxlVHJhZGVzLCBmdW5jdGlvbiAoc3VtLCByZWdpb25SZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpblN1cHBseUxpbmUgPSByZWdpb25SZXN1bHQuaW5TdXBwbHlMaW5lIHx8IF8uZmluZChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvblJlc3VsdC5hZ3JlZW1lbnRzTmVlZGVkLCBmdW5jdGlvbiAoZmFjdGlvbkxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGZhY3Rpb25MaXN0LCBhZ3JlZW1lbnRzKS5sZW5ndGggPT09IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghaW5TdXBwbHlMaW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgcm9tYW5BZ3JlZW1lbnQgPSBfLmluZGV4T2YoYWdyZWVtZW50cywgRmFjdGlvbklEcy5ST01BTlMpID49IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIChyb21hbkFncmVlbWVudCA/IHJlZ2lvblJlc3VsdC50b3RhbEFlZHVpV2l0aFJvbWFuIDogcmVnaW9uUmVzdWx0LnRvdGFsQWVkdWkpO1xuICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYgKHJlc291cmNlc1RvQmVHYWluZWQgPD0gMikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKiBBZWR1aSBjYW5ub3QgdmlhYmx5IHRyYWRlICoqKicpO1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5yb2xsYmFja1NwZWNpYWxBYmlsaXR5KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBBZWR1aSBUcmFkaW5nICoqKicpO1xuXG4gICAgICAgIEFkZFJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IHJlc291cmNlc1RvQmVHYWluZWR9KTtcbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRTcGVjaWFsQWJpbGl0eSgpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWVkdWlUcmFkZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aVRyYWRlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _devastate = __webpack_require__(150);\n\nvar _devastate2 = _interopRequireDefault(_devastate);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ArverniDevastate = function () {\n    function ArverniDevastate() {\n        _classCallCheck(this, ArverniDevastate);\n    }\n\n    _createClass(ArverniDevastate, null, [{\n        key: 'devastate',\n        value: function devastate(state, modifiers) {\n\n            var effectiveDevastations = this.getEffectiveDevastations(state, modifiers);\n            if (modifiers.test) {\n                return effectiveDevastations;\n            }\n\n            if (effectiveDevastations.length === 0) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.DEVASTATE);\n            _lodash2.default.each(effectiveDevastations, function (devastation) {\n                _devastate2.default.execute(state, {\n                    devastation: devastation\n                });\n            });\n            state.turnHistory.getCurrentTurn().commitSpecialAbility();\n\n            return true;\n        }\n    }, {\n        key: 'getEffectiveDevastations',\n        value: function getEffectiveDevastations(state, modifiers) {\n            return _lodash2.default.filter(_devastate2.default.test(state), function (possibleDevastation) {\n                var romanRemovals = possibleDevastation.removedRomans;\n                if (_lodash2.default.find(romanRemovals, { type: 'legion' })) {\n                    return true;\n                }\n                var aeduiRemovals = possibleDevastation.removedAedui;\n                var arverniRemovals = possibleDevastation.removedArverni;\n                return romanRemovals.length + aeduiRemovals.length > 0 && romanRemovals.length + aeduiRemovals.length >= arverniRemovals.length;\n            });\n        }\n    }]);\n\n    return ArverniDevastate;\n}();\n\nexports.default = ArverniDevastate;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlEZXZhc3RhdGUuanM/YjhmNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBEZXZhc3RhdGUgZnJvbSAnLi4vLi4vY29tbWFuZHMvYXJ2ZXJuaS9kZXZhc3RhdGUnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5cbmNsYXNzIEFydmVybmlEZXZhc3RhdGUge1xuXG4gICAgc3RhdGljIGRldmFzdGF0ZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG5cbiAgICAgICAgY29uc3QgZWZmZWN0aXZlRGV2YXN0YXRpb25zID0gdGhpcy5nZXRFZmZlY3RpdmVEZXZhc3RhdGlvbnMoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIGlmKG1vZGlmaWVycy50ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gZWZmZWN0aXZlRGV2YXN0YXRpb25zO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoZWZmZWN0aXZlRGV2YXN0YXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydFNwZWNpYWxBYmlsaXR5KFNwZWNpYWxBYmlsaXR5SURzLkRFVkFTVEFURSk7XG4gICAgICAgIF8uZWFjaChlZmZlY3RpdmVEZXZhc3RhdGlvbnMsIChkZXZhc3RhdGlvbikgPT4ge1xuICAgICAgICAgICAgRGV2YXN0YXRlLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICBkZXZhc3RhdGlvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdFNwZWNpYWxBYmlsaXR5KCk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEVmZmVjdGl2ZURldmFzdGF0aW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIHJldHVybiBfLmZpbHRlcihcbiAgICAgICAgICAgIERldmFzdGF0ZS50ZXN0KHN0YXRlKSwgKHBvc3NpYmxlRGV2YXN0YXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb21hblJlbW92YWxzID0gcG9zc2libGVEZXZhc3RhdGlvbi5yZW1vdmVkUm9tYW5zO1xuICAgICAgICAgICAgICAgIGlmKF8uZmluZChyb21hblJlbW92YWxzLCB7dHlwZTogJ2xlZ2lvbid9KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgYWVkdWlSZW1vdmFscyA9IHBvc3NpYmxlRGV2YXN0YXRpb24ucmVtb3ZlZEFlZHVpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFydmVybmlSZW1vdmFscyA9IHBvc3NpYmxlRGV2YXN0YXRpb24ucmVtb3ZlZEFydmVybmk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChyb21hblJlbW92YWxzLmxlbmd0aCArIGFlZHVpUmVtb3ZhbHMubGVuZ3RoKSA+IDAgJiYgKHJvbWFuUmVtb3ZhbHMubGVuZ3RoICsgYWVkdWlSZW1vdmFscy5sZW5ndGggPj0gYXJ2ZXJuaVJlbW92YWxzLmxlbmd0aCk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcnZlcm5pRGV2YXN0YXRlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FydmVybmkvYXJ2ZXJuaURldmFzdGF0ZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _entreat = __webpack_require__(152);\n\nvar _entreat2 = _interopRequireDefault(_entreat);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _enemyFactionPriority = __webpack_require__(42);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ArverniEntreat = function () {\n    function ArverniEntreat() {\n        _classCallCheck(this, ArverniEntreat);\n    }\n\n    _createClass(ArverniEntreat, null, [{\n        key: 'entreat',\n        value: function entreat(state, modifiers) {\n            var effective = false;\n            var arverni = state.arverni;\n\n            var effectiveEntreats = this.getEffectiveEntreats(state, modifiers);\n            if (modifiers.test) {\n                return effectiveEntreats;\n            }\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.ENTREAT);\n            _lodash2.default.each(effectiveEntreats, function (entreat) {\n                if (!modifiers.free && arverni.resources() < entreat.cost) {\n                    return false;\n                }\n                _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: entreat.cost });\n                _entreat2.default.execute(state, {\n                    entreat: entreat\n                });\n                effective = true;\n            });\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackSpecialAbility();\n            } else {\n                state.turnHistory.getCurrentTurn().commitSpecialAbility();\n            }\n            return effective;\n        }\n    }, {\n        key: 'getEffectiveEntreats',\n        value: function getEffectiveEntreats(state, modifiers) {\n            var _this = this;\n\n            var prioritizedEntreats = (0, _lodash2.default)(_entreat2.default.test(state)).map(function (possibleEntreat) {\n                var priority = 'z';\n                var chosenAlly = null;\n                var chosenPlayerAlly = null;\n\n                if (possibleEntreat.canReplaceAlly) {\n                    var chosenAllyFaction = (0, _lodash2.default)(possibleEntreat.replaceableAllyFactions).sortBy(function (factionId) {\n                        return _enemyFactionPriority2.default[factionId];\n                    }).first();\n                    chosenAlly = _this.chooseAllyForFaction(possibleEntreat, chosenAllyFaction);\n                    chosenPlayerAlly = _this.choosePlayerAlly(state, possibleEntreat);\n                    priority = 'a' + _enemyFactionPriority2.default[chosenAllyFaction];\n                }\n\n                var chosenMobileFaction = (0, _lodash2.default)(possibleEntreat.replaceableMobileFactions).filter(function (factionId) {\n                    return factionId === _factionIds2.default.ROMANS || factionId === _factionIds2.default.AEDUI;\n                }).sortBy(function (factionId) {\n                    return _enemyFactionPriority2.default[factionId];\n                }).first();\n\n                if (!chosenAlly && !chosenMobileFaction) {\n                    return;\n                }\n\n                var bot = state.playersByFaction[_factionIds2.default.ARVERNI];\n                var warbands = possibleEntreat.region.getWarbandsOrAuxiliaForFaction(chosenMobileFaction);\n                var chosenWarband = (0, _lodash2.default)(_losses2.default.orderPiecesForRemoval(state, warbands, false)).reverse().first();\n\n                if (!chosenAlly) {\n                    priority = 'b' + _enemyFactionPriority2.default[chosenMobileFaction];\n                }\n\n                return {\n                    entreat: possibleEntreat,\n                    priority: priority,\n                    chosenAlly: chosenAlly,\n                    chosenPlayerAlly: chosenPlayerAlly,\n                    chosenWarband: chosenWarband\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n\n            var numAllies = state.arverni.availableAlliedTribes().length;\n            var prioritizedAccountingForNumAllies = [];\n            var playerAllies = [];\n            _lodash2.default.each(prioritizedEntreats, function (entreatData) {\n                if (numAllies > 0 || entreatData.chosenWarband) {\n                    if (numAllies > 0 && entreatData.chosenAlly) {\n                        entreatData.entreat.allyToReplace = entreatData.chosenAlly;\n                        numAllies -= 1;\n                    } else {\n                        entreatData.entreat.mobileToReplace = entreatData.chosenWarband;\n                    }\n                    prioritizedAccountingForNumAllies.push(entreatData);\n                } else if (entreatData.chosenPlayerAlly) {\n                    entreatData.entreat.allyToReplace = entreatData.chosenPlayerAlly;\n                    playerAllies.push(entreatData);\n                }\n            });\n\n            return _lodash2.default.map(_lodash2.default.concat(prioritizedAccountingForNumAllies, playerAllies), 'entreat');\n        }\n    }, {\n        key: 'chooseAllyForFaction',\n        value: function chooseAllyForFaction(entreat, factionId) {\n            var alliedCity = entreat.region.getAlliedCityForFaction(factionId);\n            var allies = entreat.region.getAlliesForFaction(factionId);\n            return alliedCity ? _lodash2.default.find(allies, { tribeId: alliedCity.id }) : _lodash2.default.sample(allies);\n        }\n    }, {\n        key: 'choosePlayerAlly',\n        value: function choosePlayerAlly(state, entreat) {\n            return (0, _lodash2.default)(entreat.region.pieces()).filter({ type: 'alliedtribe' }).filter(function (piece) {\n                return state.playersByFaction[piece.factionId];\n            }).partition(function (piece) {\n                return state.tribesById[piece.tribeId].isCity;\n            }).map(_lodash2.default.shuffle).flatten().first();\n        }\n    }]);\n\n    return ArverniEntreat;\n}();\n\nexports.default = ArverniEntreat;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlFbnRyZWF0LmpzP2U1NTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRW50cmVhdCBmcm9tICcuLi8uLi9jb21tYW5kcy9hcnZlcm5pL2VudHJlYXQnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JlbW92ZVJlc291cmNlcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgU3BlY2lhbEFiaWxpdHlJRHMgZnJvbSAnLi4vLi4vY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBMb3NzZXMgZnJvbSAnZmFsbGluZ3NreS91dGlsL2xvc3Nlcyc7XG5cbmNsYXNzIEFydmVybmlFbnRyZWF0IHtcblxuICAgIHN0YXRpYyBlbnRyZWF0KHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBhcnZlcm5pID0gc3RhdGUuYXJ2ZXJuaTtcblxuICAgICAgICBjb25zdCBlZmZlY3RpdmVFbnRyZWF0cyA9IHRoaXMuZ2V0RWZmZWN0aXZlRW50cmVhdHMoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIGlmIChtb2RpZmllcnMudGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZUVudHJlYXRzO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydFNwZWNpYWxBYmlsaXR5KFNwZWNpYWxBYmlsaXR5SURzLkVOVFJFQVQpO1xuICAgICAgICBfLmVhY2goZWZmZWN0aXZlRW50cmVhdHMsIChlbnRyZWF0KSA9PiB7XG4gICAgICAgICAgICBpZighbW9kaWZpZXJzLmZyZWUgJiYgYXJ2ZXJuaS5yZXNvdXJjZXMoKSA8IGVudHJlYXQuY29zdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLCBjb3VudDogZW50cmVhdC5jb3N0fSk7XG4gICAgICAgICAgICBFbnRyZWF0LmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICBlbnRyZWF0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmKCFlZmZlY3RpdmUpIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkucm9sbGJhY2tTcGVjaWFsQWJpbGl0eSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRTcGVjaWFsQWJpbGl0eSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEVmZmVjdGl2ZUVudHJlYXRzKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgbGV0IHByaW9yaXRpemVkRW50cmVhdHMgPSBfKEVudHJlYXQudGVzdChzdGF0ZSkpLm1hcCgocG9zc2libGVFbnRyZWF0KSA9PiB7XG4gICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAneic7XG4gICAgICAgICAgICBsZXQgY2hvc2VuQWxseSA9IG51bGw7XG4gICAgICAgICAgICBsZXQgY2hvc2VuUGxheWVyQWxseSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChwb3NzaWJsZUVudHJlYXQuY2FuUmVwbGFjZUFsbHkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaG9zZW5BbGx5RmFjdGlvbiA9IF8ocG9zc2libGVFbnRyZWF0LnJlcGxhY2VhYmxlQWxseUZhY3Rpb25zKS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZCA9PiBFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdKS5maXJzdCgpO1xuICAgICAgICAgICAgICAgIGNob3NlbkFsbHkgPSB0aGlzLmNob29zZUFsbHlGb3JGYWN0aW9uKHBvc3NpYmxlRW50cmVhdCwgY2hvc2VuQWxseUZhY3Rpb24pO1xuICAgICAgICAgICAgICAgIGNob3NlblBsYXllckFsbHkgPSB0aGlzLmNob29zZVBsYXllckFsbHkoc3RhdGUsIHBvc3NpYmxlRW50cmVhdCk7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYScgKyBFbmVteUZhY3Rpb25Qcmlvcml0eVtjaG9zZW5BbGx5RmFjdGlvbl07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNob3Nlbk1vYmlsZUZhY3Rpb24gPSBfKHBvc3NpYmxlRW50cmVhdC5yZXBsYWNlYWJsZU1vYmlsZUZhY3Rpb25zKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkID0+IGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5ST01BTlMgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFFRFVJKS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkID0+IEVuZW15RmFjdGlvblByaW9yaXR5W2ZhY3Rpb25JZF0pLmZpcnN0KCk7XG5cbiAgICAgICAgICAgIGlmICghY2hvc2VuQWxseSAmJiAhY2hvc2VuTW9iaWxlRmFjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYm90ID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkFSVkVSTkldO1xuICAgICAgICAgICAgY29uc3Qgd2FyYmFuZHMgPSBwb3NzaWJsZUVudHJlYXQucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihjaG9zZW5Nb2JpbGVGYWN0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGNob3NlbldhcmJhbmQgPSBfKExvc3Nlcy5vcmRlclBpZWNlc0ZvclJlbW92YWwoc3RhdGUsIHdhcmJhbmRzLCBmYWxzZSkpLnJldmVyc2UoKS5maXJzdCgpO1xuXG4gICAgICAgICAgICBpZighY2hvc2VuQWxseSkge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2InICsgRW5lbXlGYWN0aW9uUHJpb3JpdHlbY2hvc2VuTW9iaWxlRmFjdGlvbl07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZW50cmVhdDogcG9zc2libGVFbnRyZWF0LFxuICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGNob3NlbkFsbHksXG4gICAgICAgICAgICAgICAgY2hvc2VuUGxheWVyQWxseSxcbiAgICAgICAgICAgICAgICBjaG9zZW5XYXJiYW5kXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS52YWx1ZSgpO1xuXG5cbiAgICAgICAgbGV0IG51bUFsbGllcyA9IHN0YXRlLmFydmVybmkuYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCBwcmlvcml0aXplZEFjY291bnRpbmdGb3JOdW1BbGxpZXMgPSBbXTtcbiAgICAgICAgY29uc3QgcGxheWVyQWxsaWVzID0gW107XG4gICAgICAgIF8uZWFjaChwcmlvcml0aXplZEVudHJlYXRzLCAoZW50cmVhdERhdGEpID0+IHtcbiAgICAgICAgICAgIGlmKG51bUFsbGllcyA+IDAgfHwgZW50cmVhdERhdGEuY2hvc2VuV2FyYmFuZCkge1xuICAgICAgICAgICAgICAgIGlmKG51bUFsbGllcyA+IDAgJiYgZW50cmVhdERhdGEuY2hvc2VuQWxseSkge1xuICAgICAgICAgICAgICAgICAgICBlbnRyZWF0RGF0YS5lbnRyZWF0LmFsbHlUb1JlcGxhY2UgPSBlbnRyZWF0RGF0YS5jaG9zZW5BbGx5O1xuICAgICAgICAgICAgICAgICAgICBudW1BbGxpZXMgLT0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVudHJlYXREYXRhLmVudHJlYXQubW9iaWxlVG9SZXBsYWNlID0gZW50cmVhdERhdGEuY2hvc2VuV2FyYmFuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJpb3JpdGl6ZWRBY2NvdW50aW5nRm9yTnVtQWxsaWVzLnB1c2goZW50cmVhdERhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihlbnRyZWF0RGF0YS5jaG9zZW5QbGF5ZXJBbGx5KSB7XG4gICAgICAgICAgICAgICAgZW50cmVhdERhdGEuZW50cmVhdC5hbGx5VG9SZXBsYWNlID0gZW50cmVhdERhdGEuY2hvc2VuUGxheWVyQWxseTtcbiAgICAgICAgICAgICAgICBwbGF5ZXJBbGxpZXMucHVzaChlbnRyZWF0RGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfLm1hcChfLmNvbmNhdChwcmlvcml0aXplZEFjY291bnRpbmdGb3JOdW1BbGxpZXMsIHBsYXllckFsbGllcyksICdlbnRyZWF0Jyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGNob29zZUFsbHlGb3JGYWN0aW9uKGVudHJlYXQsIGZhY3Rpb25JZCkge1xuICAgICAgICBjb25zdCBhbGxpZWRDaXR5ID0gZW50cmVhdC5yZWdpb24uZ2V0QWxsaWVkQ2l0eUZvckZhY3Rpb24oZmFjdGlvbklkKTtcbiAgICAgICAgY29uc3QgYWxsaWVzID0gZW50cmVhdC5yZWdpb24uZ2V0QWxsaWVzRm9yRmFjdGlvbihmYWN0aW9uSWQpO1xuICAgICAgICByZXR1cm4gYWxsaWVkQ2l0eSA/IF8uZmluZChhbGxpZXMsIHt0cmliZUlkOiBhbGxpZWRDaXR5LmlkfSkgOiBfLnNhbXBsZShhbGxpZXMpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjaG9vc2VQbGF5ZXJBbGx5KHN0YXRlLCBlbnRyZWF0KSB7XG4gICAgICAgIHJldHVybiBfKGVudHJlYXQucmVnaW9uLnBpZWNlcygpKS5maWx0ZXIoe3R5cGU6ICdhbGxpZWR0cmliZSd9KS5maWx0ZXIoXG4gICAgICAgICAgICBwaWVjZSA9PiBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW3BpZWNlLmZhY3Rpb25JZF0pLnBhcnRpdGlvbihcbiAgICAgICAgICAgIHBpZWNlID0+IHN0YXRlLnRyaWJlc0J5SWRbcGllY2UudHJpYmVJZF0uaXNDaXR5KS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcblxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXJ2ZXJuaUVudHJlYXQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pRW50cmVhdC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _EnemyFactionPriority;\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar EnemyFactionPriority = (_EnemyFactionPriority = {}, _defineProperty(_EnemyFactionPriority, _factionIds2.default.ROMANS, 1), _defineProperty(_EnemyFactionPriority, _factionIds2.default.AEDUI, 2), _defineProperty(_EnemyFactionPriority, _factionIds2.default.BELGAE, 3), _defineProperty(_EnemyFactionPriority, _factionIds2.default.GERMANIC_TRIBES, 4), _EnemyFactionPriority);\n\nexports.default = EnemyFactionPriority;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2VuZW15RmFjdGlvblByaW9yaXR5LmpzPzkzMTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuXG5jb25zdCBFbmVteUZhY3Rpb25Qcmlvcml0eSA9IHtcbiAgICBbRmFjdGlvbklEcy5ST01BTlNdOiAxLFxuICAgIFtGYWN0aW9uSURzLkFFRFVJXTogMixcbiAgICBbRmFjdGlvbklEcy5CRUxHQUVdOiAzLFxuICAgIFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU106IDRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEVuZW15RmFjdGlvblByaW9yaXR5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FydmVybmkvZW5lbXlGYWN0aW9uUHJpb3JpdHkuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFNQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _enlist = __webpack_require__(55);\n\nvar _enlist2 = _interopRequireDefault(_enlist);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _belgaeGermanicBattle = __webpack_require__(131);\n\nvar _belgaeGermanicBattle2 = _interopRequireDefault(_belgaeGermanicBattle);\n\nvar _belgaeGermanicMarch = __webpack_require__(132);\n\nvar _belgaeGermanicMarch2 = _interopRequireDefault(_belgaeGermanicMarch);\n\nvar _belgaeGermanicRally = __webpack_require__(134);\n\nvar _belgaeGermanicRally2 = _interopRequireDefault(_belgaeGermanicRally);\n\nvar _belgaeGermanicRaid = __webpack_require__(133);\n\nvar _belgaeGermanicRaid2 = _interopRequireDefault(_belgaeGermanicRaid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeEnlist = function () {\n    function BelgaeEnlist() {\n        _classCallCheck(this, BelgaeEnlist);\n    }\n\n    _createClass(BelgaeEnlist, null, [{\n        key: 'enlist',\n        value: function enlist(state, modifiers) {\n            var enlistResults = _enlist2.default.test(state);\n            var effective = false;\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.ENLIST);\n            if (modifiers.context.battles) {\n                effective = this.enlistForBattle(state, modifiers, enlistResults);\n            } else {\n                effective = this.enlistForCommand(state, modifiers, enlistResults);\n            }\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackSpecialAbility();\n            } else {\n                state.turnHistory.getCurrentTurn().commitSpecialAbility();\n            }\n\n            return effective;\n        }\n    }, {\n        key: 'enlistForBattle',\n        value: function enlistForBattle(state, modifiers, enlistResults) {\n            var _this = this;\n\n            var battleResults = modifiers.context.battles;\n            _lodash2.default.each(battleResults, function (battleResult) {\n                return _this.checkAndUpdateBattleResult(state, modifiers, enlistResults, battleResult);\n            });\n            return _lodash2.default.find(battleResults, { willEnlistGermans: true });\n        }\n    }, {\n        key: 'enlistForCommand',\n        value: function enlistForCommand(state, modifiers, enlistResults) {\n            return _belgaeGermanicBattle2.default.battle(state, modifiers, enlistResults) || _belgaeGermanicMarch2.default.march(state, modifiers, enlistResults) || _belgaeGermanicRally2.default.rally(state, modifiers, enlistResults) || _belgaeGermanicRaid2.default.raid(state, modifiers, enlistResults);\n        }\n    }, {\n        key: 'checkAndUpdateBattleResult',\n        value: function checkAndUpdateBattleResult(state, modifiers, enlistResults, battleResults) {\n            var enlistResultForBattleRegion = _lodash2.default.find(enlistResults, function (result) {\n                return result.region.id === battleResults.region.id;\n            });\n            if (enlistResultForBattleRegion) {\n                var enlistedBattleResults = _battle2.default.test(state, {\n                    region: battleResults.region,\n                    attackingFaction: battleResults.attackingFaction,\n                    defendingFaction: battleResults.defendingFaction,\n                    enlistingGermans: true\n                });\n\n                if (enlistedBattleResults.worstCaseAttackerLosses.normal < battleResults.worstCaseAttackerLosses.normal || enlistedBattleResults.worstCaseDefenderLosses.normal > battleResults.worstCaseDefenderLosses.normal) {\n                    battleResults.willEnlistGermans = true;\n                }\n            }\n        }\n    }]);\n\n    return BelgaeEnlist;\n}();\n\nexports.default = BelgaeEnlist;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlRW5saXN0LmpzP2IyYTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgU3BlY2lhbEFiaWxpdHlJRHMgZnJvbSAnLi4vLi4vY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBFbmxpc3QgZnJvbSAnLi4vLi4vY29tbWFuZHMvYmVsZ2FlL2VubGlzdCc7XG5pbXBvcnQgQmF0dGxlIGZyb20gJy4uLy4uL2NvbW1hbmRzL2JhdHRsZSc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgQmVsZ2FlR2VybWFuaWNCYXR0bGUgZnJvbSAnLi9iZWxnYWVHZXJtYW5pY0JhdHRsZSc7XG5pbXBvcnQgQmVsZ2FlR2VybWFuaWNNYXJjaCBmcm9tICcuL2JlbGdhZUdlcm1hbmljTWFyY2gnO1xuaW1wb3J0IEJlbGdhZUdlcm1hbmljUmFsbHkgZnJvbSAnLi9iZWxnYWVHZXJtYW5pY1JhbGx5JztcbmltcG9ydCBCZWxnYWVHZXJtYW5pY1JhaWQgZnJvbSAnLi9iZWxnYWVHZXJtYW5pY1JhaWQnO1xuXG5jbGFzcyBCZWxnYWVFbmxpc3Qge1xuXG4gICAgc3RhdGljIGVubGlzdChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGVubGlzdFJlc3VsdHMgPSBFbmxpc3QudGVzdChzdGF0ZSk7XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0U3BlY2lhbEFiaWxpdHkoU3BlY2lhbEFiaWxpdHlJRHMuRU5MSVNUKTtcbiAgICAgICAgaWYobW9kaWZpZXJzLmNvbnRleHQuYmF0dGxlcykge1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdGhpcy5lbmxpc3RGb3JCYXR0bGUoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0aGlzLmVubGlzdEZvckNvbW1hbmQoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZighZWZmZWN0aXZlKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrU3BlY2lhbEFiaWxpdHkoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0U3BlY2lhbEFiaWxpdHkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxuXG4gICAgc3RhdGljIGVubGlzdEZvckJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzLCBlbmxpc3RSZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IGJhdHRsZVJlc3VsdHMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzO1xuICAgICAgICBfLmVhY2goYmF0dGxlUmVzdWx0cywgYmF0dGxlUmVzdWx0ID0+IHRoaXMuY2hlY2tBbmRVcGRhdGVCYXR0bGVSZXN1bHQoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cywgYmF0dGxlUmVzdWx0KSk7XG4gICAgICAgIHJldHVybiBfLmZpbmQoYmF0dGxlUmVzdWx0cywge3dpbGxFbmxpc3RHZXJtYW5zOiB0cnVlfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGVubGlzdEZvckNvbW1hbmQoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cykge1xuICAgICAgICByZXR1cm4gQmVsZ2FlR2VybWFuaWNCYXR0bGUuYmF0dGxlKHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHx8XG4gICAgICAgICAgICAgICBCZWxnYWVHZXJtYW5pY01hcmNoLm1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHx8XG4gICAgICAgICAgICAgICBCZWxnYWVHZXJtYW5pY1JhbGx5LnJhbGx5KHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHx8XG4gICAgICAgICAgICAgICBCZWxnYWVHZXJtYW5pY1JhaWQucmFpZChzdGF0ZSwgbW9kaWZpZXJzLCBlbmxpc3RSZXN1bHRzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY2hlY2tBbmRVcGRhdGVCYXR0bGVSZXN1bHQoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cywgYmF0dGxlUmVzdWx0cykge1xuICAgICAgICBjb25zdCBlbmxpc3RSZXN1bHRGb3JCYXR0bGVSZWdpb24gPSBfLmZpbmQoZW5saXN0UmVzdWx0cywgcmVzdWx0ID0+IHJlc3VsdC5yZWdpb24uaWQgPT09IGJhdHRsZVJlc3VsdHMucmVnaW9uLmlkKTtcbiAgICAgICAgaWYgKGVubGlzdFJlc3VsdEZvckJhdHRsZVJlZ2lvbikge1xuICAgICAgICAgICAgY29uc3QgZW5saXN0ZWRCYXR0bGVSZXN1bHRzID0gQmF0dGxlLnRlc3QoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBiYXR0bGVSZXN1bHRzLnJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbjogYmF0dGxlUmVzdWx0cy5hdHRhY2tpbmdGYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkZWZlbmRpbmdGYWN0aW9uOiBiYXR0bGVSZXN1bHRzLmRlZmVuZGluZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGVubGlzdGluZ0dlcm1hbnM6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGVubGlzdGVkQmF0dGxlUmVzdWx0cy53b3JzdENhc2VBdHRhY2tlckxvc3Nlcy5ub3JtYWwgPCBiYXR0bGVSZXN1bHRzLndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLm5vcm1hbCB8fFxuICAgICAgICAgICAgICAgIGVubGlzdGVkQmF0dGxlUmVzdWx0cy53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5ub3JtYWwgPiBiYXR0bGVSZXN1bHRzLndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCkge1xuICAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdHMud2lsbEVubGlzdEdlcm1hbnMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEJlbGdhZUVubGlzdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlRW5saXN0LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFJQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _EnemyFactionPriority;\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar EnemyFactionPriority = (_EnemyFactionPriority = {}, _defineProperty(_EnemyFactionPriority, _factionIds2.default.ARVERNI, 1), _defineProperty(_EnemyFactionPriority, _factionIds2.default.BELGAE, 2), _defineProperty(_EnemyFactionPriority, _factionIds2.default.GERMANIC_TRIBES, 3), _defineProperty(_EnemyFactionPriority, _factionIds2.default.AEDUI, 4), _EnemyFactionPriority);\n\nexports.default = EnemyFactionPriority;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvZW5lbXlGYWN0aW9uUHJpb3JpdHkuanM/NGQxMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5cbmNvbnN0IEVuZW15RmFjdGlvblByaW9yaXR5ID0ge1xuICAgIFtGYWN0aW9uSURzLkFSVkVSTkldOiAxLFxuICAgIFtGYWN0aW9uSURzLkJFTEdBRV06IDIsXG4gICAgW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXTogMyxcbiAgICBbRmFjdGlvbklEcy5BRURVSV06IDRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEVuZW15RmFjdGlvblByaW9yaXR5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL3JvbWFucy9lbmVteUZhY3Rpb25Qcmlvcml0eS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQU1BIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Pass = function (_Command) {\n    _inherits(Pass, _Command);\n\n    function Pass() {\n        _classCallCheck(this, Pass);\n\n        return _possibleConstructorReturn(this, (Pass.__proto__ || Object.getPrototypeOf(Pass)).apply(this, arguments));\n    }\n\n    _createClass(Pass, null, [{\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            console.log('*** ' + args.faction.name + ' Passes *** ');\n            var faction = args.faction;\n            _addResources2.default.execute(state, { factionId: faction.id, count: faction.passResources });\n        }\n    }]);\n\n    return Pass;\n}(_command2.default);\n\nexports.default = Pass;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcGFzcy5qcz9mOGY1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi9jb21tYW5kJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBBZGRSZXNvdXJjZXMgIGZyb20gJy4uL2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcblxuY2xhc3MgUGFzcyBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvRXhlY3V0ZShzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqICcgKyBhcmdzLmZhY3Rpb24ubmFtZSArICcgUGFzc2VzICoqKiAnKTtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IGFyZ3MuZmFjdGlvbjtcbiAgICAgICAgQWRkUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBmYWN0aW9uLmlkLCBjb3VudDogZmFjdGlvbi5wYXNzUmVzb3VyY2VzIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGFzcztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcGFzcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7Ozs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _fallingSkyRegion = __webpack_require__(95);\n\nvar _fallingSkyRegion2 = _interopRequireDefault(_fallingSkyRegion);\n\nvar _supplyLines = __webpack_require__(168);\n\nvar _supplyLines2 = _interopRequireDefault(_supplyLines);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Definitions = {};\n\nDefinitions[_regionIds2.default.AEDUI] = {\n    id: _regionIds2.default.AEDUI,\n    name: 'Aedui',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.ARVERNI, _regionIds2.default.BITURIGES, _regionIds2.default.MANDUBII, _regionIds2.default.PROVINCIA, _regionIds2.default.SEQUANI],\n    tribes: [_tribeIds2.default.AEDUI]\n};\n\nDefinitions[_regionIds2.default.AQUITANIA] = {\n    id: _regionIds2.default.AQUITANIA,\n    name: 'Aquitania',\n    group: _regionGroups2.default.AQUITANIA,\n    controlValue: 0,\n    inPlay: false,\n    adjacent: [_regionIds2.default.ARVERNI],\n    tribes: []\n};\n\nDefinitions[_regionIds2.default.ARVERNI] = {\n    id: _regionIds2.default.ARVERNI,\n    name: 'Arverni',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 3,\n    adjacent: [_regionIds2.default.AEDUI, _regionIds2.default.BITURIGES, _regionIds2.default.PICTONES, _regionIds2.default.PROVINCIA],\n    tribes: [_tribeIds2.default.ARVERNI, _tribeIds2.default.CADURCI, _tribeIds2.default.VOLCAE]\n};\n\nDefinitions[_regionIds2.default.ATREBATES] = {\n    id: _regionIds2.default.ATREBATES,\n    name: 'Atrebates',\n    group: _regionGroups2.default.BELGICA,\n    controlValue: 3,\n    adjacent: [_regionIds2.default.BRITANNIA, _regionIds2.default.CARNUTES, _regionIds2.default.MANDUBII, _regionIds2.default.MORINI, _regionIds2.default.NERVII, _regionIds2.default.TREVERI, _regionIds2.default.VENETI],\n    tribes: [_tribeIds2.default.ATREBATES, _tribeIds2.default.BELLOVACI, _tribeIds2.default.REMI]\n};\n\nDefinitions[_regionIds2.default.BITURIGES] = {\n    id: _regionIds2.default.BITURIGES,\n    name: 'Bituriges',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.AEDUI, _regionIds2.default.ARVERNI, _regionIds2.default.CARNUTES, _regionIds2.default.MANDUBII, _regionIds2.default.PICTONES],\n    tribes: [_tribeIds2.default.BITURIGES]\n};\n\nDefinitions[_regionIds2.default.BRITANNIA] = {\n    id: _regionIds2.default.BRITANNIA,\n    name: 'Britannia',\n    group: _regionGroups2.default.BRITANNIA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.VENETI, _regionIds2.default.ATREBATES, _regionIds2.default.MORINI],\n    tribes: [_tribeIds2.default.CATUVELLAUNI]\n};\n\nDefinitions[_regionIds2.default.CARNUTES] = {\n    id: _regionIds2.default.CARNUTES,\n    name: 'Carnutes',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.ATREBATES, _regionIds2.default.BITURIGES, _regionIds2.default.MANDUBII, _regionIds2.default.PICTONES, _regionIds2.default.VENETI],\n    tribes: [_tribeIds2.default.CARNUTES, _tribeIds2.default.AULERCI]\n};\n\nDefinitions[_regionIds2.default.CISALPINA] = {\n    id: _regionIds2.default.CISALPINA,\n    name: 'Cisalpina',\n    group: _regionGroups2.default.CISALPINA,\n    controlValue: 0,\n    inPlay: false,\n    adjacent: [_regionIds2.default.PROVINCIA, _regionIds2.default.SEQUANI, _regionIds2.default.UBII],\n    tribes: []\n};\n\nDefinitions[_regionIds2.default.MANDUBII] = {\n    id: _regionIds2.default.MANDUBII,\n    name: 'Mandubii',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 3,\n    adjacent: [_regionIds2.default.AEDUI, _regionIds2.default.ATREBATES, _regionIds2.default.BITURIGES, _regionIds2.default.CARNUTES, _regionIds2.default.TREVERI, _regionIds2.default.SEQUANI],\n    tribes: [_tribeIds2.default.MANDUBII, _tribeIds2.default.SENONES, _tribeIds2.default.LINGONES]\n};\n\nDefinitions[_regionIds2.default.MORINI] = {\n    id: _regionIds2.default.MORINI,\n    name: 'Morini',\n    group: _regionGroups2.default.BELGICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.ATREBATES, _regionIds2.default.BRITANNIA, _regionIds2.default.NERVII, _regionIds2.default.SUGAMBRI],\n    tribes: [_tribeIds2.default.MORINI, _tribeIds2.default.MENAPII]\n};\n\nDefinitions[_regionIds2.default.NERVII] = {\n    id: _regionIds2.default.NERVII,\n    name: 'Nervii',\n    group: _regionGroups2.default.BELGICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.ATREBATES, _regionIds2.default.MORINI, _regionIds2.default.SUGAMBRI, _regionIds2.default.TREVERI],\n    tribes: [_tribeIds2.default.NERVII, _tribeIds2.default.EBURONES]\n};\n\nDefinitions[_regionIds2.default.PICTONES] = {\n    id: _regionIds2.default.PICTONES,\n    name: 'Pictones',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.ARVERNI, _regionIds2.default.BITURIGES, _regionIds2.default.CARNUTES, _regionIds2.default.VENETI],\n    tribes: [_tribeIds2.default.PICTONES, _tribeIds2.default.SANTONES]\n};\n\nDefinitions[_regionIds2.default.PROVINCIA] = {\n    id: _regionIds2.default.PROVINCIA,\n    name: 'Provincia',\n    group: _regionGroups2.default.PROVINCIA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.AEDUI, _regionIds2.default.ARVERNI, _regionIds2.default.CISALPINA, _regionIds2.default.SEQUANI],\n    tribes: [_tribeIds2.default.HELVII]\n};\n\nDefinitions[_regionIds2.default.SEQUANI] = {\n    id: _regionIds2.default.SEQUANI,\n    name: 'Sequani',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.AEDUI, _regionIds2.default.CISALPINA, _regionIds2.default.MANDUBII, _regionIds2.default.PROVINCIA, _regionIds2.default.TREVERI, _regionIds2.default.UBII],\n    tribes: [_tribeIds2.default.SEQUANI, _tribeIds2.default.HELVETII]\n};\n\nDefinitions[_regionIds2.default.SUGAMBRI] = {\n    id: _regionIds2.default.SUGAMBRI,\n    name: 'Sugambri',\n    group: _regionGroups2.default.GERMANIA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.MORINI, _regionIds2.default.NERVII, _regionIds2.default.TREVERI, _regionIds2.default.UBII],\n    tribes: [_tribeIds2.default.SUGAMBRI, _tribeIds2.default.SUEBI_NORTH]\n};\n\nDefinitions[_regionIds2.default.TREVERI] = {\n    id: _regionIds2.default.TREVERI,\n    name: 'Treveri',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.ATREBATES, _regionIds2.default.MANDUBII, _regionIds2.default.NERVII, _regionIds2.default.SEQUANI, _regionIds2.default.SUGAMBRI, _regionIds2.default.UBII],\n    tribes: [_tribeIds2.default.TREVERI]\n};\n\nDefinitions[_regionIds2.default.UBII] = {\n    id: _regionIds2.default.UBII,\n    name: 'Ubii',\n    group: _regionGroups2.default.GERMANIA,\n    controlValue: 1,\n    adjacent: [_regionIds2.default.CISALPINA, _regionIds2.default.SEQUANI, _regionIds2.default.SUGAMBRI, _regionIds2.default.TREVERI],\n    tribes: [_tribeIds2.default.UBII, _tribeIds2.default.SUEBI_SOUTH]\n};\n\nDefinitions[_regionIds2.default.VENETI] = {\n    id: _regionIds2.default.VENETI,\n    name: 'Veneti',\n    group: _regionGroups2.default.CELTICA,\n    controlValue: 2,\n    adjacent: [_regionIds2.default.ATREBATES, _regionIds2.default.BRITANNIA, _regionIds2.default.CARNUTES, _regionIds2.default.PICTONES],\n    tribes: [_tribeIds2.default.VENETI, _tribeIds2.default.NAMNETES]\n};\n\nvar Regions = function () {\n    function Regions() {\n        _classCallCheck(this, Regions);\n    }\n\n    _createClass(Regions, null, [{\n        key: 'generateRegions',\n        value: function generateRegions(tribesById) {\n            var regions = _lodash2.default.map(Definitions, function (definition) {\n                return new _fallingSkyRegion2.default(definition, tribesById);\n            });\n            var regionsById = _lodash2.default.keyBy(regions, 'id');\n            _lodash2.default.each(regions, function (region) {\n                region.adjacent = _lodash2.default.map(region.adjacent, function (regionId) {\n                    return regionsById[regionId];\n                });\n            });\n            _supplyLines2.default.populateSupplyLines(regionsById, _regionIds2.default.CISALPINA);\n            return regions;\n        }\n    }]);\n\n    return Regions;\n}();\n\nexports.default = Regions;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbnMuanM/NTcyNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWxsaW5nU2t5UmVnaW9uIGZyb20gJy4uL2JvYXJkL2ZhbGxpbmdTa3lSZWdpb24nO1xuaW1wb3J0IFN1cHBseUxpbmVzIGZyb20gJy4vc3VwcGx5TGluZXMnO1xuaW1wb3J0IFRyaWJlSURzIGZyb20gJy4vdHJpYmVJZHMnO1xuaW1wb3J0IFJlZ2lvbklEcyBmcm9tICcuL3JlZ2lvbklkcyc7XG5pbXBvcnQgUmVnaW9uR3JvdXBzIGZyb20gJy4vcmVnaW9uR3JvdXBzJztcblxuY29uc3QgRGVmaW5pdGlvbnMgPSB7fTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLkFFRFVJXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLkFFRFVJLFxuICAgIG5hbWU6ICdBZWR1aScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5DRUxUSUNBLFxuICAgIGNvbnRyb2xWYWx1ZTogMSxcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BUlZFUk5JLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkJJVFVSSUdFUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5NQU5EVUJJSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5QUk9WSU5DSUEsXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuU0VRVUFOSV0sXG4gICAgdHJpYmVzOiBbVHJpYmVJRHMuQUVEVUldXG59O1xuXG5EZWZpbml0aW9uc1tSZWdpb25JRHMuQVFVSVRBTklBXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLkFRVUlUQU5JQSxcbiAgICBuYW1lOiAnQXF1aXRhbmlhJyxcbiAgICBncm91cDogUmVnaW9uR3JvdXBzLkFRVUlUQU5JQSxcbiAgICBjb250cm9sVmFsdWU6IDAsXG4gICAgaW5QbGF5OiBmYWxzZSxcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BUlZFUk5JXSxcbiAgICB0cmliZXM6IFtdXG59O1xuXG5EZWZpbml0aW9uc1tSZWdpb25JRHMuQVJWRVJOSV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5BUlZFUk5JLFxuICAgIG5hbWU6ICdBcnZlcm5pJyxcbiAgICBncm91cDogUmVnaW9uR3JvdXBzLkNFTFRJQ0EsXG4gICAgY29udHJvbFZhbHVlOiAzLFxuICAgIGFkamFjZW50OiBbUmVnaW9uSURzLkFFRFVJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkJJVFVSSUdFUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5QSUNUT05FUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5QUk9WSU5DSUFdLFxuICAgIHRyaWJlczogW1RyaWJlSURzLkFSVkVSTkksIFRyaWJlSURzLkNBRFVSQ0ksIFRyaWJlSURzLlZPTENBRV1cbn07XG5cbkRlZmluaXRpb25zW1JlZ2lvbklEcy5BVFJFQkFURVNdID0ge1xuICAgIGlkOiBSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgIG5hbWU6ICdBdHJlYmF0ZXMnLFxuICAgIGdyb3VwOiBSZWdpb25Hcm91cHMuQkVMR0lDQSxcbiAgICBjb250cm9sVmFsdWU6IDMsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuQlJJVEFOTklBLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkNBUk5VVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk1BTkRVQklJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk1PUklOSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5ORVJWSUksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuVFJFVkVSSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5WRU5FVEldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLkFUUkVCQVRFUywgVHJpYmVJRHMuQkVMTE9WQUNJLCBUcmliZUlEcy5SRU1JXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLkJJVFVSSUdFU10gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5CSVRVUklHRVMsXG4gICAgbmFtZTogJ0JpdHVyaWdlcycsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5DRUxUSUNBLFxuICAgIGNvbnRyb2xWYWx1ZTogMSxcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BRURVSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5BUlZFUk5JLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkNBUk5VVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk1BTkRVQklJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlBJQ1RPTkVTXSxcbiAgICB0cmliZXM6IFtUcmliZUlEcy5CSVRVUklHRVNdXG59O1xuXG5EZWZpbml0aW9uc1tSZWdpb25JRHMuQlJJVEFOTklBXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLkJSSVRBTk5JQSxcbiAgICBuYW1lOiAnQnJpdGFubmlhJyxcbiAgICBncm91cDogUmVnaW9uR3JvdXBzLkJSSVRBTk5JQSxcbiAgICBjb250cm9sVmFsdWU6IDEsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuVkVORVRJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkFUUkVCQVRFUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5NT1JJTkldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLkNBVFVWRUxMQVVOSV1cbn07XG5cbkRlZmluaXRpb25zW1JlZ2lvbklEcy5DQVJOVVRFU10gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5DQVJOVVRFUyxcbiAgICBuYW1lOiAnQ2FybnV0ZXMnLFxuICAgIGdyb3VwOiBSZWdpb25Hcm91cHMuQ0VMVElDQSxcbiAgICBjb250cm9sVmFsdWU6IDIsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkJJVFVSSUdFUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5NQU5EVUJJSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5QSUNUT05FUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5WRU5FVEldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLkNBUk5VVEVTLCBUcmliZUlEcy5BVUxFUkNJXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLkNJU0FMUElOQV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5DSVNBTFBJTkEsXG4gICAgbmFtZTogJ0Npc2FscGluYScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5DSVNBTFBJTkEsXG4gICAgY29udHJvbFZhbHVlOiAwLFxuICAgIGluUGxheTogZmFsc2UsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuUFJPVklOQ0lBLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlNFUVVBTkksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuVUJJSV0sXG4gICAgdHJpYmVzOiBbXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLk1BTkRVQklJXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLk1BTkRVQklJLFxuICAgIG5hbWU6ICdNYW5kdWJpaScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5DRUxUSUNBLFxuICAgIGNvbnRyb2xWYWx1ZTogMyxcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BRURVSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5BVFJFQkFURVMsXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuQklUVVJJR0VTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkNBUk5VVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlRSRVZFUkksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuU0VRVUFOSV0sXG4gICAgdHJpYmVzOiBbVHJpYmVJRHMuTUFORFVCSUksIFRyaWJlSURzLlNFTk9ORVMsIFRyaWJlSURzLkxJTkdPTkVTXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLk1PUklOSV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5NT1JJTkksXG4gICAgbmFtZTogJ01vcmluaScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5CRUxHSUNBLFxuICAgIGNvbnRyb2xWYWx1ZTogMixcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BVFJFQkFURVMsXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuQlJJVEFOTklBLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk5FUlZJSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5TVUdBTUJSSV0sXG4gICAgdHJpYmVzOiBbVHJpYmVJRHMuTU9SSU5JLCBUcmliZUlEcy5NRU5BUElJXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLk5FUlZJSV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5ORVJWSUksXG4gICAgbmFtZTogJ05lcnZpaScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5CRUxHSUNBLFxuICAgIGNvbnRyb2xWYWx1ZTogMixcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5BVFJFQkFURVMsXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuTU9SSU5JLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlNVR0FNQlJJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlRSRVZFUkldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLk5FUlZJSSwgVHJpYmVJRHMuRUJVUk9ORVNdXG59O1xuXG5EZWZpbml0aW9uc1tSZWdpb25JRHMuUElDVE9ORVNdID0ge1xuICAgIGlkOiBSZWdpb25JRHMuUElDVE9ORVMsXG4gICAgbmFtZTogJ1BpY3RvbmVzJyxcbiAgICBncm91cDogUmVnaW9uR3JvdXBzLkNFTFRJQ0EsXG4gICAgY29udHJvbFZhbHVlOiAyLFxuICAgIGFkamFjZW50OiBbUmVnaW9uSURzLkFSVkVSTkksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuQklUVVJJR0VTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkNBUk5VVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlZFTkVUSV0sXG4gICAgdHJpYmVzOiBbVHJpYmVJRHMuUElDVE9ORVMsIFRyaWJlSURzLlNBTlRPTkVTXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLlBST1ZJTkNJQV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5QUk9WSU5DSUEsXG4gICAgbmFtZTogJ1Byb3ZpbmNpYScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5QUk9WSU5DSUEsXG4gICAgY29udHJvbFZhbHVlOiAxLFxuICAgIGFkamFjZW50OiBbUmVnaW9uSURzLkFFRFVJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkFSVkVSTkksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuQ0lTQUxQSU5BLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlNFUVVBTkldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLkhFTFZJSV1cbn07XG5cbkRlZmluaXRpb25zW1JlZ2lvbklEcy5TRVFVQU5JXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLlNFUVVBTkksXG4gICAgbmFtZTogJ1NlcXVhbmknLFxuICAgIGdyb3VwOiBSZWdpb25Hcm91cHMuQ0VMVElDQSxcbiAgICBjb250cm9sVmFsdWU6IDIsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuQUVEVUksXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuQ0lTQUxQSU5BLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk1BTkRVQklJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlBST1ZJTkNJQSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5UUkVWRVJJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlVCSUldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLlNFUVVBTkksIFRyaWJlSURzLkhFTFZFVElJXVxufTtcblxuRGVmaW5pdGlvbnNbUmVnaW9uSURzLlNVR0FNQlJJXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLlNVR0FNQlJJLFxuICAgIG5hbWU6ICdTdWdhbWJyaScsXG4gICAgZ3JvdXA6IFJlZ2lvbkdyb3Vwcy5HRVJNQU5JQSxcbiAgICBjb250cm9sVmFsdWU6IDEsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuTU9SSU5JLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk5FUlZJSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5UUkVWRVJJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlVCSUldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLlNVR0FNQlJJLCBUcmliZUlEcy5TVUVCSV9OT1JUSF1cbn07XG5cbkRlZmluaXRpb25zW1JlZ2lvbklEcy5UUkVWRVJJXSA9IHtcbiAgICBpZDogUmVnaW9uSURzLlRSRVZFUkksXG4gICAgbmFtZTogJ1RyZXZlcmknLFxuICAgIGdyb3VwOiBSZWdpb25Hcm91cHMuQ0VMVElDQSxcbiAgICBjb250cm9sVmFsdWU6IDEsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk1BTkRVQklJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLk5FUlZJSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5TRVFVQU5JLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlNVR0FNQlJJLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLlVCSUldLFxuICAgIHRyaWJlczogW1RyaWJlSURzLlRSRVZFUkldXG59O1xuXG5EZWZpbml0aW9uc1tSZWdpb25JRHMuVUJJSV0gPSB7XG4gICAgaWQ6IFJlZ2lvbklEcy5VQklJLFxuICAgIG5hbWU6ICdVYmlpJyxcbiAgICBncm91cDogUmVnaW9uR3JvdXBzLkdFUk1BTklBLFxuICAgIGNvbnRyb2xWYWx1ZTogMSxcbiAgICBhZGphY2VudDogW1JlZ2lvbklEcy5DSVNBTFBJTkEsXG4gICAgICAgICAgICAgICBSZWdpb25JRHMuU0VRVUFOSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5TVUdBTUJSSSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5UUkVWRVJJXSxcbiAgICB0cmliZXM6IFtUcmliZUlEcy5VQklJLCBUcmliZUlEcy5TVUVCSV9TT1VUSF1cbn07XG5cbkRlZmluaXRpb25zW1JlZ2lvbklEcy5WRU5FVEldID0ge1xuICAgIGlkOiBSZWdpb25JRHMuVkVORVRJLFxuICAgIG5hbWU6ICdWZW5ldGknLFxuICAgIGdyb3VwOiBSZWdpb25Hcm91cHMuQ0VMVElDQSxcbiAgICBjb250cm9sVmFsdWU6IDIsXG4gICAgYWRqYWNlbnQ6IFtSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgICAgICAgICAgICAgUmVnaW9uSURzLkJSSVRBTk5JQSxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5DQVJOVVRFUyxcbiAgICAgICAgICAgICAgIFJlZ2lvbklEcy5QSUNUT05FU10sXG4gICAgdHJpYmVzOiBbVHJpYmVJRHMuVkVORVRJLCBUcmliZUlEcy5OQU1ORVRFU11cbn07XG5cbmNsYXNzIFJlZ2lvbnMge1xuICAgIHN0YXRpYyBnZW5lcmF0ZVJlZ2lvbnModHJpYmVzQnlJZCkge1xuICAgICAgICBjb25zdCByZWdpb25zID0gXy5tYXAoRGVmaW5pdGlvbnMsIGZ1bmN0aW9uIChkZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGYWxsaW5nU2t5UmVnaW9uKGRlZmluaXRpb24sIHRyaWJlc0J5SWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlZ2lvbnNCeUlkID0gXy5rZXlCeShyZWdpb25zLCAnaWQnKTtcbiAgICAgICAgXy5lYWNoKHJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICByZWdpb24uYWRqYWNlbnQgPSBfLm1hcChyZWdpb24uYWRqYWNlbnQsIGZ1bmN0aW9uIChyZWdpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbnNCeUlkW3JlZ2lvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgU3VwcGx5TGluZXMucG9wdWxhdGVTdXBwbHlMaW5lcyhyZWdpb25zQnlJZCwgUmVnaW9uSURzLkNJU0FMUElOQSk7XG4gICAgICAgIHJldHVybiByZWdpb25zO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVnaW9ucztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbnMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVZBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBVEE7QUFDQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBWkE7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBVkE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBUkE7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBVkE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFUQTtBQUNBO0FBV0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceFort = function (_Action) {\n    _inherits(PlaceFort, _Action);\n\n    function PlaceFort(args) {\n        _classCallCheck(this, PlaceFort);\n\n        var _this = _possibleConstructorReturn(this, (PlaceFort.__proto__ || Object.getPrototypeOf(PlaceFort)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        return _this;\n    }\n\n    _createClass(PlaceFort, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n\n            if (!region.inPlay() || !faction.hasAvailableForts() || region.hasFort()) {\n                throw 'Invalid PlaceFort Action';\n            }\n\n            region.addPiece(faction.removeFort());\n            console.log('Placing ' + faction.name + ' Fort in ' + region.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n\n            var fort = region.getFort();\n            region.removePieces([fort]);\n            faction.returnFort(fort);\n            console.log('Taking back ' + faction.name + ' Fort from ' + region.name);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            return ['Place ' + faction.name + ' Fort in ' + region.name];\n        }\n    }]);\n\n    return PlaceFort;\n}(_action2.default);\n\nexports.default = PlaceFort;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUZvcnQuanM/MWNjOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcblxuY2xhc3MgUGxhY2VGb3J0IGV4dGVuZHMgQWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgICAgIHRoaXMuZmFjdGlvbklkID0gYXJncy5mYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMucmVnaW9uSWQgPSBhcmdzLnJlZ2lvbklkO1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG5cbiAgICAgICAgaWYoIXJlZ2lvbi5pblBsYXkoKSB8fCAhZmFjdGlvbi5oYXNBdmFpbGFibGVGb3J0cygpIHx8IHJlZ2lvbi5oYXNGb3J0KCkpIHtcbiAgICAgICAgICAgIHRocm93ICdJbnZhbGlkIFBsYWNlRm9ydCBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVnaW9uLmFkZFBpZWNlKGZhY3Rpb24ucmVtb3ZlRm9ydCgpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1BsYWNpbmcgJyArIGZhY3Rpb24ubmFtZSArICcgRm9ydCBpbiAnICsgcmVnaW9uLm5hbWUpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG5cbiAgICAgICAgY29uc3QgZm9ydCA9IHJlZ2lvbi5nZXRGb3J0KCk7XG4gICAgICAgIHJlZ2lvbi5yZW1vdmVQaWVjZXMoW2ZvcnRdKTtcbiAgICAgICAgZmFjdGlvbi5yZXR1cm5Gb3J0KGZvcnQpO1xuICAgICAgICBjb25zb2xlLmxvZygnVGFraW5nIGJhY2sgJyArIGZhY3Rpb24ubmFtZSArICcgRm9ydCBmcm9tICcgKyByZWdpb24ubmFtZSk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgcmV0dXJuIFsnUGxhY2UgJyArIGZhY3Rpb24ubmFtZSArICcgRm9ydCBpbiAnICsgcmVnaW9uLm5hbWVdO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxhY2VGb3J0O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlRm9ydC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUpBO0FBS0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceLeader = function (_Action) {\n    _inherits(PlaceLeader, _Action);\n\n    function PlaceLeader(args) {\n        _classCallCheck(this, PlaceLeader);\n\n        var _this = _possibleConstructorReturn(this, (PlaceLeader.__proto__ || Object.getPrototypeOf(PlaceLeader)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        return _this;\n    }\n\n    _createClass(PlaceLeader, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n\n            if (!region.inPlay() || !faction.hasAvailableLeader()) {\n                throw 'Invalid PlaceAlliedTribe Action';\n            }\n\n            var leader = faction.removeLeader();\n            region.addPiece(leader);\n            console.log('Placing ' + leader.toString() + ' in ' + region.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n\n            var leader = region.getLeaderForFaction(faction.id);\n            region.removePieces([leader]);\n            faction.returnLeader(leader);\n\n            console.log('Taking back ' + leader.toString() + ' from ' + region.name);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            return ['Place ' + faction.name + ' Leader in ' + region.name];\n        }\n    }]);\n\n    return PlaceLeader;\n}(_action2.default);\n\nexports.default = PlaceLeader;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUxlYWRlci5qcz9kMDY1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBY3Rpb24gZnJvbSAnLi9hY3Rpb24nO1xuXG5jbGFzcyBQbGFjZUxlYWRlciBleHRlbmRzIEFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcblxuICAgICAgICB0aGlzLmZhY3Rpb25JZCA9IGFyZ3MuZmFjdGlvbklkO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gYXJncy5yZWdpb25JZDtcbiAgICB9XG5cbiAgICBkb0V4ZWN1dGUoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuXG4gICAgICAgIGlmKCFyZWdpb24uaW5QbGF5KCkgfHwgIWZhY3Rpb24uaGFzQXZhaWxhYmxlTGVhZGVyKCkpIHtcbiAgICAgICAgICAgIHRocm93ICdJbnZhbGlkIFBsYWNlQWxsaWVkVHJpYmUgQWN0aW9uJztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxlYWRlciA9IGZhY3Rpb24ucmVtb3ZlTGVhZGVyKCk7XG4gICAgICAgIHJlZ2lvbi5hZGRQaWVjZShsZWFkZXIpO1xuICAgICAgICBjb25zb2xlLmxvZygnUGxhY2luZyAnICsgbGVhZGVyLnRvU3RyaW5nKCkgKyAnIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgfVxuXG4gICAgZG9VbmRvKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcblxuICAgICAgICBjb25zdCBsZWFkZXIgPSByZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihmYWN0aW9uLmlkKTtcbiAgICAgICAgcmVnaW9uLnJlbW92ZVBpZWNlcyhbbGVhZGVyXSk7XG4gICAgICAgIGZhY3Rpb24ucmV0dXJuTGVhZGVyKGxlYWRlcik7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1Rha2luZyBiYWNrICcgKyBsZWFkZXIudG9TdHJpbmcoKSArICcgZnJvbSAnICsgcmVnaW9uLm5hbWUpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIHJldHVybiBbJ1BsYWNlICcgKyBmYWN0aW9uLm5hbWUgKyAnIExlYWRlciBpbiAnICsgcmVnaW9uLm5hbWVdO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxhY2VMZWFkZXI7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VMZWFkZXIuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFKQTtBQUtBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _senateApprovalStates = __webpack_require__(37);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PlaceLegions = function (_Action) {\n    _inherits(PlaceLegions, _Action);\n\n    function PlaceLegions(args) {\n        _classCallCheck(this, PlaceLegions);\n\n        var _this = _possibleConstructorReturn(this, (PlaceLegions.__proto__ || Object.getPrototypeOf(PlaceLegions)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.count = args.count;\n        _this.sourceCounts = args.sourceCounts;\n        return _this;\n    }\n\n    _createClass(PlaceLegions, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n\n            if (!region.inPlay() || !faction.hasAvailableLegions(count)) {\n                throw 'Invalid PlaceLegions Action';\n            }\n\n            var legionData = faction.removeLegions(count);\n            region.addPieces(legionData.legions);\n            this.sourceCounts = legionData.sourceCounts;\n            console.log('Placing ' + count + 'x ' + faction.name + ' Legions in ' + region.name);\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n            var sourceCounts = this.sourceCounts;\n\n            _lodash2.default.each(sourceCounts, function (count, source) {\n                var legions = _lodash2.default.take(region.getLegions(), count);\n                region.removePieces(legions);\n                state.romans.returnLegions(legions, source);\n                console.log('Returning ' + count + 'x ' + faction.name + ' Legions to ' + _senateApprovalStates.SenateApprovalStateNames[source] + ' track');\n            });\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var count = this.count;\n            return ['Place ' + count + 'x ' + faction.name + ' Legions in ' + region.name];\n        }\n    }]);\n\n    return PlaceLegions;\n}(_action2.default);\n\nexports.default = PlaceLegions;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9wbGFjZUxlZ2lvbnMuanM/NzIxNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsaWIvbG9kYXNoJztcbmltcG9ydCBBY3Rpb24gZnJvbSAnLi9hY3Rpb24nO1xuaW1wb3J0IHtTZW5hdGVBcHByb3ZhbFN0YXRlTmFtZXN9IGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3NlbmF0ZUFwcHJvdmFsU3RhdGVzJztcblxuY2xhc3MgUGxhY2VMZWdpb25zIGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5yZWdpb25JZCA9IGFyZ3MucmVnaW9uSWQ7XG4gICAgICAgIHRoaXMuY291bnQgPSBhcmdzLmNvdW50O1xuICAgICAgICB0aGlzLnNvdXJjZUNvdW50cyA9IGFyZ3Muc291cmNlQ291bnRzO1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcblxuICAgICAgICBpZiAoIXJlZ2lvbi5pblBsYXkoKSB8fCAhZmFjdGlvbi5oYXNBdmFpbGFibGVMZWdpb25zKGNvdW50KSkge1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgUGxhY2VMZWdpb25zIEFjdGlvbic7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsZWdpb25EYXRhID0gZmFjdGlvbi5yZW1vdmVMZWdpb25zKGNvdW50KTtcbiAgICAgICAgcmVnaW9uLmFkZFBpZWNlcyhsZWdpb25EYXRhLmxlZ2lvbnMpO1xuICAgICAgICB0aGlzLnNvdXJjZUNvdW50cyA9IGxlZ2lvbkRhdGEuc291cmNlQ291bnRzO1xuICAgICAgICBjb25zb2xlLmxvZygnUGxhY2luZyAnICsgY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBMZWdpb25zIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgfVxuXG4gICAgZG9VbmRvKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmNvdW50O1xuICAgICAgICBjb25zdCBzb3VyY2VDb3VudHMgPSB0aGlzLnNvdXJjZUNvdW50cztcblxuXG4gICAgICAgIF8uZWFjaChzb3VyY2VDb3VudHMsIChjb3VudCwgc291cmNlKT0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxlZ2lvbnMgPSBfLnRha2UocmVnaW9uLmdldExlZ2lvbnMoKSwgY291bnQpO1xuICAgICAgICAgICAgcmVnaW9uLnJlbW92ZVBpZWNlcyhsZWdpb25zKTtcbiAgICAgICAgICAgIHN0YXRlLnJvbWFucy5yZXR1cm5MZWdpb25zKGxlZ2lvbnMsIHNvdXJjZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0dXJuaW5nICcgKyBjb3VudCArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIExlZ2lvbnMgdG8gJyArIFNlbmF0ZUFwcHJvdmFsU3RhdGVOYW1lc1tzb3VyY2VdICsgJyB0cmFjaycpO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcbiAgICAgICAgcmV0dXJuIFsnUGxhY2UgJyArIGNvdW50ICsgJ3ggJyArIGZhY3Rpb24ubmFtZSArICcgTGVnaW9ucyBpbiAnICsgcmVnaW9uLm5hbWVdO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxhY2VMZWdpb25zO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlTGVnaW9ucy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _suborn = __webpack_require__(146);\n\nvar _suborn2 = _interopRequireDefault(_suborn);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _enemyFactionPriority = __webpack_require__(34);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AeduiSuborn = function () {\n    function AeduiSuborn() {\n        _classCallCheck(this, AeduiSuborn);\n    }\n\n    _createClass(AeduiSuborn, null, [{\n        key: 'suborn',\n        value: function suborn(currentState, modifiers) {\n            var _this = this;\n\n            console.log('*** Is Aedui Suborn effective? ***');\n            var aeduiFaction = currentState.factionsById[_factionIds2.default.AEDUI];\n            if (!modifiers.free && aeduiFaction.resources() === 0) {\n                return false;\n            }\n\n            var possibleSuborns = _suborn2.default.test(currentState);\n            _lodash2.default.each(possibleSuborns, function (subornResult) {\n                var priority = 'z';\n                if ((aeduiFaction.resources() >= 2 || modifiers.free) && aeduiFaction.hasAvailableAlliedTribe() && subornResult.canPlaceAlly) {\n                    var hasSubduedCity = _lodash2.default.find(subornResult.region.tribes, function (tribe) {\n                        return tribe.isSubdued() && tribe.isCity && (!tribe.factionRestriction || tribe.factionRestriction === _factionIds2.default.AEDUI);\n                    });\n                    if (hasSubduedCity) {\n                        priority = 'a1';\n                    } else {\n                        priority = 'a2';\n                    }\n                } else if ((aeduiFaction.resources() >= 2 || modifiers.free) && subornResult.alliedFactions.length > 0) {\n                    var topAllyRemovePriority = 'z';\n                    _lodash2.default.each(subornResult.alliedFactions, function (factionId) {\n                        var faction = currentState.factionsById[factionId];\n                        // Need non-player roman check involved here.\n                        var priority = 'b' + (99 - faction.numAlliedTribesAndCitadelsPlaced()) + _enemyFactionPriority2.default[factionId];\n                        if (priority < topAllyRemovePriority) {\n                            topAllyRemovePriority = priority;\n                        }\n                    });\n                    priority = topAllyRemovePriority;\n                } else if (aeduiFaction.availableWarbands().length > 0) {\n                    priority = 'c';\n                } else if (subornResult.mobileFactions.length > 0) {\n                    var topMobileRemovePriority = 'z';\n                    _lodash2.default.each(subornResult.alliedFactions, function (factionId) {\n                        var priority = 'd' + _enemyFactionPriority2.default[factionId];\n                        if (priority < topMobileRemovePriority) {\n                            topMobileRemovePriority = priority;\n                        }\n                    });\n                    priority = topMobileRemovePriority;\n                }\n\n                subornResult.priority = priority;\n            });\n\n            var prioritizedGroups = (0, _lodash2.default)(possibleSuborns).reject({ priority: 'z' }).groupBy('priority').value();\n\n            var sortedKeys = _lodash2.default.keys(prioritizedGroups).sort();\n            var subornChoices = prioritizedGroups[sortedKeys[0]];\n            var convictolitavis = currentState.hasUnshadedCapability(_capabilities.CapabilityIDs.CONVICTOLITAVIS);\n            var chosenSuborns = _lodash2.default.sampleSize(subornChoices, convictolitavis ? 2 : 1);\n\n            if (chosenSuborns.length > 0) {\n                currentState.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.SUBORN);\n                _lodash2.default.each(chosenSuborns, function (chosenSuborn) {\n                    _this.executeSuborn(currentState, modifiers, chosenSuborn);\n                });\n                currentState.turnHistory.getCurrentTurn().commitSpecialAbility();\n                return true;\n            }\n\n            return false;\n        }\n    }, {\n        key: 'executeSuborn',\n        value: function executeSuborn(state, modifiers, subornResult) {\n            console.log('*** Aedui Suborn in ' + subornResult.region.name);\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var piecesHandled = 0;\n            if ((aeduiFaction.resources() >= 2 || modifiers.free) && aeduiFaction.hasAvailableAlliedTribe() && subornResult.canPlaceAlly) {\n                var subdued = subornResult.region.subduedTribesForFaction(_factionIds2.default.AEDUI);\n                var tribe = _lodash2.default.find(subdued, { 'isCity': true });\n                if (!tribe) {\n                    tribe = _lodash2.default.sample(subdued);\n                }\n\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: 2 });\n                }\n                _placeAlliedTribe2.default.execute(state, { factionId: aeduiFaction.id, regionId: subornResult.region.id, tribeId: tribe.id });\n                piecesHandled += 1;\n            } else if ((aeduiFaction.resources() >= 2 || modifiers.free) && subornResult.alliedFactions.length > 0) {\n                var prioritized = _lodash2.default.sortBy(subornResult.alliedFactions, function (factionId) {\n                    var faction = state.factionsById[factionId];\n                    // Need non-player roman check involved here.\n                    return 'b' + (99 - faction.numAlliedTribesAndCitadelsPlaced()) + _enemyFactionPriority2.default[factionId];\n                });\n\n                var alliedTribes = _lodash2.default.filter(subornResult.region.piecesByFaction()[_lodash2.default.first(prioritized)], { type: 'alliedtribe' });\n                var alliedTribe = _lodash2.default.find(alliedTribes, function (ally) {\n                    var tribe = state.tribesById[ally.tribeId];\n                    return tribe.isCity;\n                });\n                if (!alliedTribe) {\n                    alliedTribe = _lodash2.default.sample(alliedTribes);\n                }\n                console.log('Suborn allied tribe');\n                subornResult.region.logState();\n                if (!alliedTribe) {\n                    debugger;\n                }\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: 2 });\n                }\n                _removePieces2.default.execute(state, {\n                    factionId: alliedTribe.factionId,\n                    regionId: subornResult.region.id,\n                    pieces: [alliedTribe]\n                });\n\n                piecesHandled += 1;\n            }\n\n            var numWarbandsToAdd = _lodash2.default.min([modifiers.free ? 999 : aeduiFaction.resources(), aeduiFaction.availableWarbands().length, 3 - piecesHandled]);\n            if (numWarbandsToAdd) {\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: numWarbandsToAdd });\n                }\n                _placeWarbands2.default.execute(state, { factionId: aeduiFaction.id, regionId: subornResult.region.id, count: numWarbandsToAdd });\n                piecesHandled += numWarbandsToAdd;\n            }\n\n            var prioritizedFactions = _lodash2.default.sortBy(subornResult.mobileFactions, function (factionId) {\n                return _enemyFactionPriority2.default[factionId];\n            });\n\n            if (aeduiFaction.resources() > 0 || modifiers.free) {\n                _lodash2.default.each(prioritizedFactions, function (factionId) {\n                    var pieces = (0, _lodash2.default)(subornResult.region.piecesByFaction()[factionId]).filter(function (piece) {\n                        return piece.type === 'warband' || piece.type === 'auxilia';\n                    }).sortBy(function (piece) {\n                        if (!piece.revealed()) {\n                            return 'a';\n                        } else if (piece.scouted()) {\n                            return 'c';\n                        } else {\n                            return 'b';\n                        }\n                    }).value();\n\n                    var numPiecesToRemove = _lodash2.default.min([modifiers.free ? 999 : aeduiFaction.resources(), pieces.length, 3 - piecesHandled]);\n                    if (numPiecesToRemove) {\n                        if (!modifiers.free) {\n                            _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: numPiecesToRemove });\n                        }\n                        _removePieces2.default.execute(state, {\n                            factionId: factionId,\n                            regionId: subornResult.region.id,\n                            pieces: _lodash2.default.take(pieces, numPiecesToRemove)\n                        });\n\n                        piecesHandled += numPiecesToRemove;\n                    }\n\n                    if (piecesHandled === 3 || aeduiFaction.resources() === 0 && !modifiers.free) {\n                        return false;\n                    }\n                });\n            }\n        }\n    }]);\n\n    return AeduiSuborn;\n}();\n\nexports.default = AeduiSuborn;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aVN1Ym9ybi5qcz9kZmE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5pbXBvcnQgU3Vib3JuIGZyb20gJy4uLy4uL2NvbW1hbmRzL2FlZHVpL3N1Ym9ybic7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi8uLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFJlbW92ZVBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JlbW92ZVBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBQbGFjZVdhcmJhbmRzIGZyb20gJy4uLy4uL2FjdGlvbnMvcGxhY2VXYXJiYW5kcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHN9IGZyb20gJy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuXG5jbGFzcyBBZWR1aVN1Ym9ybiB7XG5cbiAgICBzdGF0aWMgc3Vib3JuKGN1cnJlbnRTdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogSXMgQWVkdWkgU3Vib3JuIGVmZmVjdGl2ZT8gKioqJyk7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IGN1cnJlbnRTdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGlmICghbW9kaWZpZXJzLmZyZWUgJiYgYWVkdWlGYWN0aW9uLnJlc291cmNlcygpID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3NzaWJsZVN1Ym9ybnMgPSBTdWJvcm4udGVzdChjdXJyZW50U3RhdGUpO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBwb3NzaWJsZVN1Ym9ybnMsIGZ1bmN0aW9uIChzdWJvcm5SZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAneic7XG4gICAgICAgICAgICAgICAgaWYgKChhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPj0gMiB8fCBtb2RpZmllcnMuZnJlZSkgJiYgYWVkdWlGYWN0aW9uLmhhc0F2YWlsYWJsZUFsbGllZFRyaWJlKCkgJiYgc3Vib3JuUmVzdWx0LmNhblBsYWNlQWxseSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNTdWJkdWVkQ2l0eSA9IF8uZmluZChcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym9yblJlc3VsdC5yZWdpb24udHJpYmVzLCBmdW5jdGlvbiAodHJpYmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpYmUuaXNTdWJkdWVkKCkgJiYgdHJpYmUuaXNDaXR5ICYmICghdHJpYmUuZmFjdGlvblJlc3RyaWN0aW9uIHx8IHRyaWJlLmZhY3Rpb25SZXN0cmljdGlvbiA9PT0gRmFjdGlvbklEcy5BRURVSSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1N1YmR1ZWRDaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhMSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhMic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoKGFlZHVpRmFjdGlvbi5yZXNvdXJjZXMoKSA+PSAyIHx8IG1vZGlmaWVycy5mcmVlKSAmJiBzdWJvcm5SZXN1bHQuYWxsaWVkRmFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdG9wQWxseVJlbW92ZVByaW9yaXR5ID0gJ3onO1xuICAgICAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJvcm5SZXN1bHQuYWxsaWVkRmFjdGlvbnMsIGZ1bmN0aW9uIChmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWN0aW9uID0gY3VycmVudFN0YXRlLmZhY3Rpb25zQnlJZFtmYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5lZWQgbm9uLXBsYXllciByb21hbiBjaGVjayBpbnZvbHZlZCBoZXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5ID0gJ2InICsgKDk5IC0gZmFjdGlvbi5udW1BbGxpZWRUcmliZXNBbmRDaXRhZGVsc1BsYWNlZCgpKSArIChFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJpb3JpdHkgPCB0b3BBbGx5UmVtb3ZlUHJpb3JpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wQWxseVJlbW92ZVByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gdG9wQWxseVJlbW92ZVByaW9yaXR5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhZWR1aUZhY3Rpb24uYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2MnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzdWJvcm5SZXN1bHQubW9iaWxlRmFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdG9wTW9iaWxlUmVtb3ZlUHJpb3JpdHkgPSAneic7XG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym9yblJlc3VsdC5hbGxpZWRGYWN0aW9ucywgZnVuY3Rpb24gKGZhY3Rpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5ID0gJ2QnICsgKEVuZW15RmFjdGlvblByaW9yaXR5W2ZhY3Rpb25JZF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmlvcml0eSA8IHRvcE1vYmlsZVJlbW92ZVByaW9yaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcE1vYmlsZVJlbW92ZVByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gdG9wTW9iaWxlUmVtb3ZlUHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3Vib3JuUmVzdWx0LnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBwcmlvcml0aXplZEdyb3VwcyA9IF8ocG9zc2libGVTdWJvcm5zKS5yZWplY3Qoe3ByaW9yaXR5OiAneid9KS5ncm91cEJ5KCdwcmlvcml0eScpLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3Qgc29ydGVkS2V5cyA9IF8ua2V5cyhwcmlvcml0aXplZEdyb3Vwcykuc29ydCgpO1xuICAgICAgICBjb25zdCBzdWJvcm5DaG9pY2VzID0gcHJpb3JpdGl6ZWRHcm91cHNbc29ydGVkS2V5c1swXV07XG4gICAgICAgIGNvbnN0IGNvbnZpY3RvbGl0YXZpcyA9IGN1cnJlbnRTdGF0ZS5oYXNVbnNoYWRlZENhcGFiaWxpdHkoQ2FwYWJpbGl0eUlEcy5DT05WSUNUT0xJVEFWSVMpO1xuICAgICAgICBjb25zdCBjaG9zZW5TdWJvcm5zID0gXy5zYW1wbGVTaXplKHN1Ym9ybkNob2ljZXMsIGNvbnZpY3RvbGl0YXZpcyA/IDIgOiAxKTtcblxuICAgICAgICBpZiAoY2hvc2VuU3Vib3Jucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjdXJyZW50U3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydFNwZWNpYWxBYmlsaXR5KFNwZWNpYWxBYmlsaXR5SURzLlNVQk9STik7XG4gICAgICAgICAgICBfLmVhY2goY2hvc2VuU3Vib3JucywgKGNob3NlblN1Ym9ybikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXhlY3V0ZVN1Ym9ybihjdXJyZW50U3RhdGUsIG1vZGlmaWVycywgY2hvc2VuU3Vib3JuKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY3VycmVudFN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0U3BlY2lhbEFiaWxpdHkoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHN0YXRpYyBleGVjdXRlU3Vib3JuKHN0YXRlLCBtb2RpZmllcnMsIHN1Ym9yblJlc3VsdCkge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEFlZHVpIFN1Ym9ybiBpbiAnICsgc3Vib3JuUmVzdWx0LnJlZ2lvbi5uYW1lKTtcbiAgICAgICAgY29uc3QgYWVkdWlGYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICBsZXQgcGllY2VzSGFuZGxlZCA9IDA7XG4gICAgICAgIGlmICgoYWVkdWlGYWN0aW9uLnJlc291cmNlcygpID49IDIgfHwgbW9kaWZpZXJzLmZyZWUpICYmIGFlZHVpRmFjdGlvbi5oYXNBdmFpbGFibGVBbGxpZWRUcmliZSgpICYmIHN1Ym9yblJlc3VsdC5jYW5QbGFjZUFsbHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YmR1ZWQgPSBzdWJvcm5SZXN1bHQucmVnaW9uLnN1YmR1ZWRUcmliZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQUVEVUkpO1xuICAgICAgICAgICAgbGV0IHRyaWJlID0gXy5maW5kKHN1YmR1ZWQsIHsnaXNDaXR5JzogdHJ1ZX0pO1xuICAgICAgICAgICAgaWYgKCF0cmliZSkge1xuICAgICAgICAgICAgICAgIHRyaWJlID0gXy5zYW1wbGUoc3ViZHVlZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogMn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBhZWR1aUZhY3Rpb24uaWQsIHJlZ2lvbklkOiBzdWJvcm5SZXN1bHQucmVnaW9uLmlkLCB0cmliZUlkOiB0cmliZS5pZH0pO1xuICAgICAgICAgICAgcGllY2VzSGFuZGxlZCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPj0gMiB8fCBtb2RpZmllcnMuZnJlZSkgJiYgc3Vib3JuUmVzdWx0LmFsbGllZEZhY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHByaW9yaXRpemVkID0gXy5zb3J0QnkoXG4gICAgICAgICAgICAgICAgc3Vib3JuUmVzdWx0LmFsbGllZEZhY3Rpb25zLCBmdW5jdGlvbiAoZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbZmFjdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTmVlZCBub24tcGxheWVyIHJvbWFuIGNoZWNrIGludm9sdmVkIGhlcmUuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYicgKyAoOTkgLSBmYWN0aW9uLm51bUFsbGllZFRyaWJlc0FuZENpdGFkZWxzUGxhY2VkKCkpICsgKEVuZW15RmFjdGlvblByaW9yaXR5W2ZhY3Rpb25JZF0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhbGxpZWRUcmliZXMgPSBfLmZpbHRlcihzdWJvcm5SZXN1bHQucmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW18uZmlyc3QocHJpb3JpdGl6ZWQpXSwge3R5cGU6ICdhbGxpZWR0cmliZSd9KTtcbiAgICAgICAgICAgIGxldCBhbGxpZWRUcmliZSA9IF8uZmluZChcbiAgICAgICAgICAgICAgICBhbGxpZWRUcmliZXMsIGZ1bmN0aW9uIChhbGx5KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFthbGx5LnRyaWJlSWRdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpYmUuaXNDaXR5O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFhbGxpZWRUcmliZSkge1xuICAgICAgICAgICAgICAgIGFsbGllZFRyaWJlID0gXy5zYW1wbGUoYWxsaWVkVHJpYmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTdWJvcm4gYWxsaWVkIHRyaWJlJyk7XG4gICAgICAgICAgICBzdWJvcm5SZXN1bHQucmVnaW9uLmxvZ1N0YXRlKCk7XG4gICAgICAgICAgICBpZighYWxsaWVkVHJpYmUpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IDJ9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogYWxsaWVkVHJpYmUuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogc3Vib3JuUmVzdWx0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBbYWxsaWVkVHJpYmVdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBpZWNlc0hhbmRsZWQgKz0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG51bVdhcmJhbmRzVG9BZGQgPSBfLm1pbihbKG1vZGlmaWVycy5mcmVlID8gOTk5IDogYWVkdWlGYWN0aW9uLnJlc291cmNlcygpKSwgYWVkdWlGYWN0aW9uLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoLCAzIC0gcGllY2VzSGFuZGxlZF0pO1xuICAgICAgICBpZiAobnVtV2FyYmFuZHNUb0FkZCkge1xuICAgICAgICAgICAgaWYoIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogbnVtV2FyYmFuZHNUb0FkZH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBhZWR1aUZhY3Rpb24uaWQsIHJlZ2lvbklkOiBzdWJvcm5SZXN1bHQucmVnaW9uLmlkLCBjb3VudDogbnVtV2FyYmFuZHNUb0FkZH0pO1xuICAgICAgICAgICAgcGllY2VzSGFuZGxlZCArPSBudW1XYXJiYW5kc1RvQWRkO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWRGYWN0aW9ucyA9IF8uc29ydEJ5KFxuICAgICAgICAgICAgc3Vib3JuUmVzdWx0Lm1vYmlsZUZhY3Rpb25zLCBmdW5jdGlvbiAoZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEVuZW15RmFjdGlvblByaW9yaXR5W2ZhY3Rpb25JZF07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAoYWVkdWlGYWN0aW9uLnJlc291cmNlcygpID4gMCB8fCBtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgIHByaW9yaXRpemVkRmFjdGlvbnMsIGZ1bmN0aW9uIChmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGllY2VzID0gXyhzdWJvcm5SZXN1bHQucmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0pLmZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgfHwgcGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc29ydEJ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwaWVjZS5yZXZlYWxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnNjb3V0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2MnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdiJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bVBpZWNlc1RvUmVtb3ZlID0gXy5taW4oWyhtb2RpZmllcnMuZnJlZSA/IDk5OSA6IGFlZHVpRmFjdGlvbi5yZXNvdXJjZXMoKSksIHBpZWNlcy5sZW5ndGgsIDMgLSBwaWVjZXNIYW5kbGVkXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW1QaWVjZXNUb1JlbW92ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogbnVtUGllY2VzVG9SZW1vdmV9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogc3Vib3JuUmVzdWx0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBfLnRha2UocGllY2VzLCBudW1QaWVjZXNUb1JlbW92ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzSGFuZGxlZCArPSBudW1QaWVjZXNUb1JlbW92ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwaWVjZXNIYW5kbGVkID09PSAzIHx8IChhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPT09IDAgJiYgIW1vZGlmaWVycy5mcmVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFlZHVpU3Vib3JuO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2FlZHVpU3Vib3JuLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _arverniDevastate = __webpack_require__(40);\n\nvar _arverniDevastate2 = _interopRequireDefault(_arverniDevastate);\n\nvar _arverniEntreat = __webpack_require__(41);\n\nvar _arverniEntreat2 = _interopRequireDefault(_arverniEntreat);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nvar _enemyFactionPriority = __webpack_require__(42);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ArverniMarch = function () {\n    function ArverniMarch() {\n        _classCallCheck(this, ArverniMarch);\n    }\n\n    _createClass(ArverniMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers, marchType) {\n            var skipCondition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n            if (state.frost()) {\n                return false;\n            }\n\n            if (marchType === 'threat') {\n                return this.threatMarch(state, modifiers);\n            } else if (marchType === 'spread') {\n                var arverni = state.arverni;\n                if (!skipCondition) {\n                    if (arverni.numAlliedTribesAndCitadelsPlaced() >= 9 || arverni.availableWarbands().length > 6) {\n                        return false;\n                    }\n                }\n                return this.spreadMarch(state, modifiers);\n            } else {\n                return this.massMarch(state, modifiers);\n            }\n        }\n    }, {\n        key: 'threatMarch',\n        value: function threatMarch(state, modifiers) {\n            var _this = this;\n\n            var effective = false;\n            var arverni = state.arverni;\n\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.ARVERNI });\n            var leaderMarch = this.getLeaderMarch(marchResults);\n            var remainingMarches = this.getRemainingMarches(state, marchResults, leaderMarch.targetDestination);\n\n            if (arverni.resources() < leaderMarch.march.cost && !modifiers.free) {\n                return false;\n            }\n\n            var marches = _lodash2.default.concat([leaderMarch], remainingMarches);\n            var canDoSpecial = modifiers.canDoSpecial() && !this.wasBritanniaMarch(marches);\n            var didSpecial = canDoSpecial && (_arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers));\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n            console.log('*** Arverni Marching to Escape Threat ***');\n            var alreadyMarched = {};\n            _lodash2.default.each(marches, function (march) {\n\n                if (!_this.payForMarchAndHide(state, modifiers, march.march, alreadyMarched)) {\n                    return false;\n                }\n\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: march.region.id,\n                    destRegionId: march.targetDestination.id,\n                    pieces: march.march.mobilePieces\n                });\n                effective = true;\n            });\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackCommand();\n                return false;\n            }\n            state.turnHistory.getCurrentTurn().commitCommand();\n\n            if (canDoSpecial && !didSpecial) {\n                didSpecial = _arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers);\n            }\n\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getLeaderMarch',\n        value: function getLeaderMarch(marchResults) {\n            var leaderMarch = (0, _lodash2.default)(marchResults).find(function (march) {\n                return march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            });\n            if (!leaderMarch) {\n                debugger;\n            }\n            var leaderAdjacentRegionIds = (0, _lodash2.default)(leaderMarch.region.adjacent).map('id').value();\n            var targetDestination = (0, _lodash2.default)(leaderMarch.destinations).filter(function (destination) {\n                return _lodash2.default.indexOf(leaderAdjacentRegionIds, destination.id) >= 0;\n            }).map(function (region) {\n                var pieces = region.getPiecesForFaction(_factionIds2.default.ARVERNI);\n                return {\n                    region: region,\n                    pieces: pieces,\n                    numPieces: pieces.length\n                };\n            }).sortBy('numPieces').groupBy('numPieces').map(_lodash2.default.shuffle).flatten().first();\n\n            return {\n                march: leaderMarch,\n                region: leaderMarch.region,\n                targetDestination: targetDestination.region\n            };\n        }\n    }, {\n        key: 'getRemainingMarches',\n        value: function getRemainingMarches(state, marchResults, leaderRegion) {\n            return (0, _lodash2.default)(marchResults).reject(function (march) {\n                return march.region.id === leaderRegion.id;\n            }).reject(function (march) {\n                return march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            }).map(function (march) {\n                if (march.mobilePieces.length < 2) {\n                    return;\n                }\n\n                var targetDestination = (0, _lodash2.default)(march.destinations).map(function (region) {\n                    return {\n                        region: region,\n                        distance: _map2.default.measureDistanceToRegion(state, region.id, leaderRegion.id)\n                    };\n                }).sortBy('distance').groupBy('distance').map(_lodash2.default.shuffle).flatten().first();\n\n                return {\n                    march: march,\n                    region: march.region,\n                    targetDestination: targetDestination.region\n                };\n            }).compact().value();\n        }\n    }, {\n        key: 'wasBritanniaMarch',\n        value: function wasBritanniaMarch(marches) {\n            return _lodash2.default.find(marches, function (march) {\n                return march.region.id === _regionIds2.default.BRITANNIA || march.targetDestination.id === _regionIds2.default.BRITANNIA;\n            });\n        }\n    }, {\n        key: 'spreadMarch',\n        value: function spreadMarch(state, modifiers) {\n            var effective = false;\n            var arverni = state.arverni;\n\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.ARVERNI });\n            var spreadMarches = this.getSpreadMarches(marchResults);\n            var leaderMarch = this.getSpreadLeaderMarch(state, marchResults, spreadMarches);\n            var marches = _lodash2.default.concat(spreadMarches, leaderMarch ? [leaderMarch] : []);\n\n            if (marches.length === 0 || !modifiers.free && arverni.resources() < _lodash2.default.minBy(_lodash2.default.map(marches, 'cost'))) {\n                return false;\n            }\n\n            var alreadyMarchedById = {};\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n            if (this.doSpreadMarches(state, modifiers, spreadMarches, alreadyMarchedById)) {\n                effective = true;\n            }\n\n            if (this.doControlMarch(state, modifiers, leaderMarch, alreadyMarchedById)) {\n                effective = true;\n            }\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackCommand();\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n\n            var canDoSpecial = modifiers.canDoSpecial() && !this.wasBritanniaSpreadMarch(marches) && !this.wasBritanniaControlMarch(leaderMarch);\n            var didSpecial = canDoSpecial && (_arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers));\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'wasBritanniaSpreadMarch',\n        value: function wasBritanniaSpreadMarch(marches) {\n            return _lodash2.default.find(marches, function (march) {\n                return march.region.id === _regionIds2.default.BRITANNIA || _lodash2.default.find(march.spreadDestinations, { id: _regionIds2.default.BRITANNIA });\n            });\n        }\n    }, {\n        key: 'wasBritanniaControlMarch',\n        value: function wasBritanniaControlMarch(march) {\n            return march && (march.region.id === _regionIds2.default.BRITANNIA || march.controlDestination.id === _regionIds2.default.BRITANNIA);\n        }\n    }, {\n        key: 'doSpreadMarches',\n        value: function doSpreadMarches(state, modifiers, marches, alreadyMarchedById) {\n            var _this2 = this;\n\n            var effective = false;\n            var arverni = state.arverni;\n            console.log('*** Arverni Marching to Spread ***');\n            _lodash2.default.each(marches, function (march) {\n                _this2.payForMarchAndHide(state, modifiers, march, alreadyMarchedById);\n\n                var warbands = march.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI);\n                _lodash2.default.each(march.spreadDestinations, function (id) {\n                    _movePieces2.default.execute(state, {\n                        sourceRegionId: march.region.id,\n                        destRegionId: id,\n                        pieces: [warbands.pop()]\n                    });\n\n                    if (warbands.length === 0) {\n                        return false;\n                    }\n                });\n                effective = true;\n            });\n            return effective;\n        }\n    }, {\n        key: 'doControlMarch',\n        value: function doControlMarch(state, modifiers, march, alreadyMarchedById) {\n            if (!march) {\n                return false;\n            }\n\n            var arverni = state.arverni;\n            console.log('*** Arverni Marching to Take Control ***');\n\n            this.payForMarchAndHide(state, modifiers, march, alreadyMarchedById);\n\n            var warbands = march.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI);\n            var leader = march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            if (march.harassmentLosses) {\n                _removePieces2.default.execute(state, {\n                    factionId: arverni.id,\n                    regionId: march.region.id,\n                    pieces: warbands.splice(0, march.harassmentLosses)\n                });\n            }\n            _movePieces2.default.execute(state, {\n                sourceRegionId: march.region.id,\n                destRegionId: march.controlDestination.id,\n                pieces: (0, _lodash2.default)(warbands).take(march.numControlWarbands - march.harassmentLosses).concat([leader]).value()\n            });\n            return true;\n        }\n    }, {\n        key: 'payForMarchAndHide',\n        value: function payForMarchAndHide(state, modifiers, march, alreadyMarchedById) {\n            var arverni = state.arverni;\n\n            if (!alreadyMarchedById[march.region.id]) {\n                alreadyMarchedById[march.region.id] = true;\n                if (arverni.resources() < march.cost && !modifiers.free) {\n                    return false;\n                }\n\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: march.cost });\n                }\n                _hidePieces2.default.execute(state, {\n                    factionId: arverni.id,\n                    regionId: march.region.id\n                });\n                return true;\n            }\n        }\n    }, {\n        key: 'getSpreadMarches',\n        value: function getSpreadMarches(marchResults) {\n            var visited = [];\n            return (0, _lodash2.default)(marchResults).map(function (march) {\n                var numWarbands = march.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length;\n                if (numWarbands === 0) {\n                    return;\n                }\n                var spreadDestinations = (0, _lodash2.default)(march.adjacentDestinations).filter(function (destination) {\n                    return destination.getHiddenWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length === 0;\n                }).map(function (destination) {\n                    var numOverlaps = _lodash2.default.reduce(marchResults, function (sum, otherMarch) {\n                        if (_lodash2.default.find(otherMarch.adjacentDestinations, function (otherDestination) {\n                            return destination.id === otherDestination.id;\n                        })) {\n                            return sum + 1;\n                        }\n                        return sum;\n                    }, 0);\n\n                    return {\n                        id: destination.id,\n                        numOverlaps: numOverlaps\n                    };\n                }).sortBy('numOverlaps').groupBy('numOverlaps').map(_lodash2.default.shuffle).flatten().take(numWarbands).map('id').value();\n\n                if (spreadDestinations.length === 0) {\n                    return;\n                }\n\n                march.numSpreadWarbands = Math.min(numWarbands, spreadDestinations.length);\n                march.spreadDestinations = spreadDestinations;\n\n                return march;\n            }).compact().sortBy('numSpreadWarbands').reverse().map(function (march) {\n                march.spreadDestinations = _lodash2.default.reject(march.spreadDestinations, function (id) {\n                    return _lodash2.default.indexOf(visited, id) >= 0;\n                });\n                visited.push.apply(visited, march.spreadDestinations);\n                march.numSpreadWarbands = Math.min(march.numSpreadWarbands, march.spreadDestinations.length);\n                return march.spreadDestinations.length > 0 ? march : null;\n            }).compact().value();\n        }\n    }, {\n        key: 'getSpreadLeaderMarch',\n        value: function getSpreadLeaderMarch(state, marchResults, spreadMarches) {\n            var leaderMarch = (0, _lodash2.default)(spreadMarches).find(function (march) {\n                return march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            }) || (0, _lodash2.default)(marchResults).find(function (march) {\n                return march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            });\n            if (!leaderMarch) {\n                return;\n            }\n\n            // Consider the results of the spreading marches\n            var spreadDestinationsById = (0, _lodash2.default)(spreadMarches).map('spreadDestinations').flatten().keyBy(_lodash2.default.identity).value();\n            var alreadyMarchedWarbands = leaderMarch.numSpreadWarbands || 0;\n            var leaderRegionControlMargin = leaderMarch.region.controllingMarginByFaction()[_factionIds2.default.ARVERNI] - alreadyMarchedWarbands;\n            var availableWarbands = leaderMarch.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length - (alreadyMarchedWarbands + 1); // Leave one behind\n            if (availableWarbands < 0) {\n                return;\n            }\n\n            if (leaderRegionControlMargin === 1) {\n                return;\n            }\n\n            // Figure out how many we can actually march considering control\n            var numWarbandsToMarch = leaderRegionControlMargin < 1 ? availableWarbands : leaderRegionControlMargin - 2;\n            var numMarching = numWarbandsToMarch + 1;\n            // Find best path to all destinations considering harassment\n            var destinationPathsById = _lodash2.default.keyBy(this.getDestinationPaths(state, numMarching, leaderMarch.region, leaderMarch.destinations), 'id');\n            var destinationToControl = (0, _lodash2.default)(leaderMarch.destinations).reject({ id: _regionIds2.default.AEDUI }).filter(function (destination) {\n                return destinationPathsById[destination.id];\n            }).filter(function (destination) {\n                // See if we can take control from Romans or Aedui even after harassment\n                var numAfterHarassment = numMarching - destinationPathsById[destination.id].bestPath.harassmentLosses;\n                var spreadWarbands = spreadDestinationsById[destination.id] ? 1 : 0;\n                var canTakeControl = destination.controllingMarginByFaction()[_factionIds2.default.ARVERNI] + spreadWarbands + numAfterHarassment > 0;\n                var isEnemyControlled = destination.controllingFactionId() === _factionIds2.default.AEDUI || destination.controllingFactionId() === _factionIds2.default.ROMANS;\n                return canTakeControl && isEnemyControlled;\n            }).map(function (destination) {\n                // Now figure out the priority based on harassment and adjacent regions with arverni present\n                var numAdjacentRegionsWithArverni = _lodash2.default.reduce(destination.adjacent, function (sum, adjacent) {\n                    if (adjacent.getPiecesForFaction(_factionIds2.default.ARVERNI).length > 0 || spreadDestinationsById[adjacent.id]) {\n                        return sum + 1;\n                    }\n                    return sum;\n                }, 0);\n                var numHarassmentLosses = destinationPathsById[destination.id].bestPath.harassmentLosses;\n                return {\n                    destination: destination,\n                    numHarassmentLosses: numHarassmentLosses,\n                    priority: 10 + numHarassmentLosses + '-' + (99 - numAdjacentRegionsWithArverni)\n                };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n\n            if (!destinationToControl) {\n                return;\n            }\n\n            leaderMarch.numControlWarbands = numWarbandsToMarch;\n            leaderMarch.controlDestination = destinationToControl.destination;\n            leaderMarch.harassmentLosses = destinationToControl.numHarassmentLosses;\n\n            return leaderMarch;\n        }\n    }, {\n        key: 'getDestinationPaths',\n        value: function getDestinationPaths(state, numMobile, startRegion, destinations) {\n            var _this3 = this;\n\n            return (0, _lodash2.default)(destinations).map(function (destination) {\n                var distance = _map2.default.measureDistanceToRegion(state, startRegion.id, destination.id);\n                if (distance < 2) {\n                    return {\n                        id: destination.id,\n                        destination: destination,\n                        bestPath: {\n                            path: [startRegion.id, destination.id],\n                            harassmentLosses: 0\n                        }\n                    };\n                }\n\n                var bestPath = (0, _lodash2.default)(_map2.default.findPathsToRegion(state, startRegion.id, destination.id, 2)).map(function (path) {\n                    var middleRegion = state.regionsById[path[1]];\n                    var harassmentLosses = _this3.harassmentLosses(state, _factionIds2.default.ROMANS, middleRegion) + _this3.harassmentLosses(state, _factionIds2.default.BELGAE, middleRegion) + _this3.harassmentLosses(state, _factionIds2.default.AEDUI, middleRegion) + _this3.harassmentLosses(state, _factionIds2.default.GERMANIC_TRIBES, middleRegion);\n\n                    if (harassmentLosses > 3 || harassmentLosses >= numMobile) {\n                        return;\n                    }\n\n                    return {\n                        path: path,\n                        harassmentLosses: harassmentLosses\n                    };\n                }).compact().sortBy('harassmentLosses').groupBy('harassmentLosses').map(_lodash2.default.shuffle).flatten().first();\n\n                if (!bestPath) {\n                    return;\n                }\n\n                return {\n                    id: destination.id,\n                    destination: destination,\n                    bestPath: bestPath\n                };\n            }).compact().value();\n        }\n    }, {\n        key: 'harassmentLosses',\n        value: function harassmentLosses(state, factionId, region) {\n            var losses = 0;\n            var numHiddenEnemies = region.getHiddenPiecesForFaction(factionId).length;\n            if (numHiddenEnemies >= 3) {\n                var player = state.playersByFaction[factionId];\n                if (player.willHarass(_factionIds2.default.ARVERNI)) {\n                    losses = Math.floor(numHiddenEnemies / 3);\n                }\n            }\n            return losses;\n        }\n    }, {\n        key: 'massMarch',\n        value: function massMarch(state, modifiers) {\n            var effective = false;\n\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.ARVERNI });\n            var leaderMarch = (0, _lodash2.default)(marchResults).find(function (march) {\n                return march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            });\n            if (!leaderMarch) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n            var legionControlMarch = this.getLegionControlMarch(state, modifiers, leaderMarch, marchResults);\n            if (legionControlMarch) {\n                effective = this.doControlMarch(state, modifiers, legionControlMarch, {});\n            } else {\n                var massMarches = this.getMassMarches(state, modifiers, leaderMarch, marchResults);\n                effective = this.doMassMarches(state, modifiers, massMarches);\n            }\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackCommand();\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n            var canDoSpecial = modifiers.canDoSpecial() && !this.wasBritanniaControlMarch(legionControlMarch);\n            var didSpecial = canDoSpecial && (_arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers));\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'doMassMarches',\n        value: function doMassMarches(state, modifiers, marches) {\n            var _this4 = this;\n\n            var effective = false;\n            _lodash2.default.each(marches, function (march, index) {\n                if (!_this4.payForMarchAndHide(state, modifiers, march, {})) {\n                    return false;\n                }\n                if (index === 0) {\n                    console.log('*** Arverni March to mass near legion');\n                }\n                var pieces = _lodash2.default.take(march.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI), march.numMassWarbands);\n                var leader = march.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n                if (leader) {\n                    pieces.unshift(leader);\n                }\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: march.region.id,\n                    destRegionId: march.massDestination.id,\n                    pieces: pieces\n                });\n                effective = true;\n            });\n            return effective;\n        }\n    }, {\n        key: 'getLegionControlMarch',\n        value: function getLegionControlMarch(state, modifiers, leaderMarch, marchResults) {\n\n            var availableWarbands = leaderMarch.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length;\n            var numMarching = availableWarbands + 1;\n\n            var destinationPathsById = _lodash2.default.keyBy(this.getDestinationPaths(state, numMarching, leaderMarch.region, leaderMarch.destinations), 'id');\n            var destinationToControl = (0, _lodash2.default)(leaderMarch.destinations).filter(function (destination) {\n                return destinationPathsById[destination.id];\n            }).filter(function (destination) {\n                // Can't already be controlled by Arverni\n                if (destination.controllingFactionId() === _factionIds2.default.ARVERNI) {\n                    return false;\n                }\n\n                // Has to have a legion\n                var romanMobilePieces = destination.getMobilePiecesForFaction(_factionIds2.default.ROMANS);\n                var hasLegion = _lodash2.default.find(romanMobilePieces, { type: 'legion' });\n                if (!hasLegion) {\n                    return false;\n                }\n\n                // We need more than 2x the number of roman mobile pieces\n                var numAfterHarassment = numMarching - destinationPathsById[destination.id].bestPath.harassmentLosses;\n                var numAfterMarch = destination.getMobilePiecesForFaction(_factionIds2.default.ARVERNI).length + numAfterHarassment;\n                var hasCaesar = _lodash2.default.find(romanMobilePieces, function (piece) {\n                    return piece.type === 'leader' && !piece.isSuccessor();\n                });\n                if (hasCaesar && numAfterMarch <= romanMobilePieces.length * 2) {\n                    return false;\n                }\n\n                // Finally we need to control\n                var canTakeControl = destination.controllingMarginByFaction()[_factionIds2.default.ARVERNI] + numAfterHarassment > 0;\n                return canTakeControl;\n            }).map(function (destination) {\n                // Now figure out the priority based on harassment\n                var numHarassmentLosses = destinationPathsById[destination.id].bestPath.harassmentLosses;\n                return {\n                    destination: destination,\n                    numHarassmentLosses: numHarassmentLosses\n                };\n            }).sortBy('numHarassmentLosses').groupBy('numHarassmentLosses').map(_lodash2.default.shuffle).flatten().first();\n\n            if (!destinationToControl) {\n                return;\n            }\n\n            leaderMarch.numControlWarbands = availableWarbands;\n            leaderMarch.controlDestination = destinationToControl.destination;\n            leaderMarch.harassmentLosses = destinationToControl.numHarassmentLosses;\n\n            return leaderMarch;\n        }\n    }, {\n        key: 'getMassMarches',\n        value: function getMassMarches(state, modifiers, leaderMarch, marchResults) {\n            var _this5 = this;\n\n            var availableWarbands = leaderMarch.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length;\n            if (availableWarbands.length < 1) {\n                return [];\n            }\n\n            var numMarching = availableWarbands; // + leader, - one left behind;\n\n            var marchResultsByRegionId = _lodash2.default.keyBy(marchResults, function (march) {\n                return march.region.id;\n            });\n            var destinationPathsById = _lodash2.default.keyBy(this.getDestinationPaths(state, numMarching, leaderMarch.region, leaderMarch.destinations), 'id');\n\n            // Find destinations that the leader can march to which are next to a legion\n            var destinationsNextToLegion = (0, _lodash2.default)(leaderMarch.destinations).filter(function (destination) {\n                return destinationPathsById[destination.id];\n            }).filter(function (destination) {\n                if (destination.getLegions().length > 0) {\n                    return false;\n                }\n                var numAfterHarassment = numMarching - destinationPathsById[destination.id].bestPath.harassmentLosses;\n                if (numAfterHarassment === 0) {\n                    return false;\n                }\n                return _lodash2.default.find(destination.adjacent, function (adjacent) {\n                    return adjacent.getLegions().length > 0;\n                });\n            }).value();\n\n            if (destinationsNextToLegion.length === 0) {\n                return [];\n            }\n\n            // Now pick the one which can be marched to by the most warbands (aside from the leader's march)\n            var chosenMassResults = (0, _lodash2.default)(destinationsNextToLegion).map(function (destination) {\n                var massResults = _this5.calculateMassResultsForDestination(state, leaderMarch, marchResultsByRegionId, destination);\n                return {\n                    destination: destination,\n                    numToMass: massResults.numToMass,\n                    massResults: massResults,\n                    priority: 99 - massResults.numToMass + '-' + 10 + massResults.marches.length\n                };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n\n            if (!chosenMassResults) {\n                return;\n            }\n\n            leaderMarch.numMassWarbands = availableWarbands - 1;\n            leaderMarch.massDestination = chosenMassResults.destination;\n            leaderMarch.harassmentLosses = destinationPathsById[chosenMassResults.destination.id].bestPath.harassmentLosses;\n\n            var leaderAlreadyAdjacentToLegion = _lodash2.default.find(leaderMarch.region.adjacent, function (adjacent) {\n                return adjacent.getLegions().length > 0;\n            });\n            var marchMassTotal = leaderMarch.numMassWarbands - leaderMarch.harassmentLosses + chosenMassResults.numToMass;\n            if (leaderAlreadyAdjacentToLegion && marchMassTotal <= leaderMarch.region.getPiecesForFaction(_factionIds2.default.ARVERNI)) {\n                return [];\n            }\n\n            var massMarches = chosenMassResults.massResults.marches;\n            _lodash2.default.each(massMarches, function (march) {\n                march.massDestination = chosenMassResults.destination;\n            });\n\n            massMarches.unshift(leaderMarch);\n            return massMarches;\n        }\n    }, {\n        key: 'calculateMassResultsForDestination',\n        value: function calculateMassResultsForDestination(state, leaderMarch, marchResultsByRegionId, destination) {\n            var arverni = state.arverni;\n            var arverniPiecesAtDestination = destination.getPiecesForFaction(_factionIds2.default.ARVERNI).length;\n            return (0, _lodash2.default)(destination.adjacent).reject(function (region) {\n                return region.id === leaderMarch.region.id;\n            }).map(function (region) {\n                return {\n                    region: region,\n                    numWarbands: region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ARVERNI).length\n                };\n            }).filter(function (regionData) {\n                return regionData.numWarbands > 1;\n            }).sortBy('numWarbands').reverse().reduce(function (accumulator, regionData) {\n                var cost = marchResultsByRegionId[regionData.region.id].cost;\n                if (cost < accumulator.resources) {\n                    var march = marchResultsByRegionId[regionData.region.id];\n                    march.numMassWarbands = regionData.numWarbands - 1;\n\n                    accumulator.resources -= cost;\n                    accumulator.numToMass += march.numMassWarbands;\n                    accumulator.marches.push(march);\n                }\n                return accumulator;\n            }, { resources: arverni.resources() - leaderMarch.cost, numToMass: arverniPiecesAtDestination, marches: [] });\n        }\n    }]);\n\n    return ArverniMarch;\n}();\n\nexports.default = ArverniMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlNYXJjaC5qcz82YzY1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi8uLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgTWFyY2ggZnJvbSAnLi4vLi4vY29tbWFuZHMvbWFyY2gnO1xuaW1wb3J0IEFydmVybmlEZXZhc3RhdGUgZnJvbSAnLi9hcnZlcm5pRGV2YXN0YXRlJztcbmltcG9ydCBBcnZlcm5pRW50cmVhdCBmcm9tICcuL2FydmVybmlFbnRyZWF0JztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEhpZGVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9oaWRlUGllY2VzJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICcuL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuaW1wb3J0IE1hcCBmcm9tICcuLi8uLi91dGlsL21hcCc7XG5cbmNsYXNzIEFydmVybmlNYXJjaCB7XG5cbiAgICBzdGF0aWMgbWFyY2goc3RhdGUsIG1vZGlmaWVycywgbWFyY2hUeXBlLCBza2lwQ29uZGl0aW9uID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHN0YXRlLmZyb3N0KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXJjaFR5cGUgPT09ICd0aHJlYXQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYXRNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtYXJjaFR5cGUgPT09ICdzcHJlYWQnKSB7XG4gICAgICAgICAgICBjb25zdCBhcnZlcm5pID0gc3RhdGUuYXJ2ZXJuaTtcbiAgICAgICAgICAgIGlmICghc2tpcENvbmRpdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChhcnZlcm5pLm51bUFsbGllZFRyaWJlc0FuZENpdGFkZWxzUGxhY2VkKCkgPj0gOSB8fCBhcnZlcm5pLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoID4gNikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3ByZWFkTWFyY2goc3RhdGUsIG1vZGlmaWVycylcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hc3NNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyB0aHJlYXRNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmFydmVybmk7XG5cbiAgICAgICAgY29uc3QgbWFyY2hSZXN1bHRzID0gTWFyY2gudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JfSk7XG4gICAgICAgIGNvbnN0IGxlYWRlck1hcmNoID0gdGhpcy5nZXRMZWFkZXJNYXJjaChtYXJjaFJlc3VsdHMpO1xuICAgICAgICBjb25zdCByZW1haW5pbmdNYXJjaGVzID0gdGhpcy5nZXRSZW1haW5pbmdNYXJjaGVzKHN0YXRlLCBtYXJjaFJlc3VsdHMsIGxlYWRlck1hcmNoLnRhcmdldERlc3RpbmF0aW9uKTtcblxuICAgICAgICBpZiAoYXJ2ZXJuaS5yZXNvdXJjZXMoKSA8IGxlYWRlck1hcmNoLm1hcmNoLmNvc3QgJiYgIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXJjaGVzID0gXy5jb25jYXQoW2xlYWRlck1hcmNoXSwgcmVtYWluaW5nTWFyY2hlcyk7XG4gICAgICAgIGxldCBjYW5Eb1NwZWNpYWwgPSBtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkgJiYgIXRoaXMud2FzQnJpdGFubmlhTWFyY2gobWFyY2hlcyk7XG4gICAgICAgIGxldCBkaWRTcGVjaWFsID0gY2FuRG9TcGVjaWFsICYmIChBcnZlcm5pRGV2YXN0YXRlLmRldmFzdGF0ZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBBcnZlcm5pRW50cmVhdC5lbnRyZWF0KHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnMpKTtcblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLk1BUkNIKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBBcnZlcm5pIE1hcmNoaW5nIHRvIEVzY2FwZSBUaHJlYXQgKioqJyk7XG4gICAgICAgIGNvbnN0IGFscmVhZHlNYXJjaGVkID0ge307XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIG1hcmNoZXMsIChtYXJjaCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBheUZvck1hcmNoQW5kSGlkZShzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaC5tYXJjaCwgYWxyZWFkeU1hcmNoZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBtYXJjaC50YXJnZXREZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogbWFyY2gubWFyY2gubW9iaWxlUGllY2VzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWVmZmVjdGl2ZSkge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5yb2xsYmFja0NvbW1hbmQoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcblxuICAgICAgICBpZiAoY2FuRG9TcGVjaWFsICYmICFkaWRTcGVjaWFsKSB7XG4gICAgICAgICAgICBkaWRTcGVjaWFsID0gQXJ2ZXJuaURldmFzdGF0ZS5kZXZhc3RhdGUoc3RhdGUsIG1vZGlmaWVycykgfHwgQXJ2ZXJuaUVudHJlYXQuZW50cmVhdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWRTcGVjaWFsID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldExlYWRlck1hcmNoKG1hcmNoUmVzdWx0cykge1xuICAgICAgICBjb25zdCBsZWFkZXJNYXJjaCA9IF8obWFyY2hSZXN1bHRzKS5maW5kKG1hcmNoID0+IG1hcmNoLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkpO1xuICAgICAgICBpZiAoIWxlYWRlck1hcmNoKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsZWFkZXJBZGphY2VudFJlZ2lvbklkcyA9IF8obGVhZGVyTWFyY2gucmVnaW9uLmFkamFjZW50KS5tYXAoJ2lkJykudmFsdWUoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0RGVzdGluYXRpb24gPSBfKGxlYWRlck1hcmNoLmRlc3RpbmF0aW9ucykuZmlsdGVyKFxuICAgICAgICAgICAgZGVzdGluYXRpb24gPT4gXy5pbmRleE9mKGxlYWRlckFkamFjZW50UmVnaW9uSWRzLCBkZXN0aW5hdGlvbi5pZCkgPj0gMCkubWFwKFxuICAgICAgICAgICAgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IHJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICBwaWVjZXMsXG4gICAgICAgICAgICAgICAgICAgIG51bVBpZWNlczogcGllY2VzLmxlbmd0aFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnNvcnRCeSgnbnVtUGllY2VzJykuZ3JvdXBCeSgnbnVtUGllY2VzJykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLmZpcnN0KCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1hcmNoOiBsZWFkZXJNYXJjaCxcbiAgICAgICAgICAgIHJlZ2lvbjogbGVhZGVyTWFyY2gucmVnaW9uLFxuICAgICAgICAgICAgdGFyZ2V0RGVzdGluYXRpb246IHRhcmdldERlc3RpbmF0aW9uLnJlZ2lvblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFJlbWFpbmluZ01hcmNoZXMoc3RhdGUsIG1hcmNoUmVzdWx0cywgbGVhZGVyUmVnaW9uKSB7XG4gICAgICAgIHJldHVybiBfKG1hcmNoUmVzdWx0cykucmVqZWN0KG1hcmNoID0+IG1hcmNoLnJlZ2lvbi5pZCA9PT0gbGVhZGVyUmVnaW9uLmlkKS5yZWplY3QoXG4gICAgICAgICAgICBtYXJjaCA9PiBtYXJjaC5yZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpKS5tYXAoXG4gICAgICAgICAgICAobWFyY2gpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobWFyY2gubW9iaWxlUGllY2VzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldERlc3RpbmF0aW9uID0gXyhtYXJjaC5kZXN0aW5hdGlvbnMpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IE1hcC5tZWFzdXJlRGlzdGFuY2VUb1JlZ2lvbihzdGF0ZSwgcmVnaW9uLmlkLCBsZWFkZXJSZWdpb24uaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLnNvcnRCeSgnZGlzdGFuY2UnKS5ncm91cEJ5KCdkaXN0YW5jZScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5maXJzdCgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbWFyY2gsXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogbWFyY2gucmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXREZXN0aW5hdGlvbjogdGFyZ2V0RGVzdGluYXRpb24ucmVnaW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHdhc0JyaXRhbm5pYU1hcmNoKG1hcmNoZXMpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChtYXJjaGVzLFxuICAgICAgICAgICAgICAgICAgICAgIG1hcmNoID0+IChtYXJjaC5yZWdpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEgfHwgbWFyY2gudGFyZ2V0RGVzdGluYXRpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEpKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgc3ByZWFkTWFyY2goc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGFydmVybmkgPSBzdGF0ZS5hcnZlcm5pO1xuXG4gICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0cyA9IE1hcmNoLnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQVJWRVJOSX0pO1xuICAgICAgICBjb25zdCBzcHJlYWRNYXJjaGVzID0gdGhpcy5nZXRTcHJlYWRNYXJjaGVzKG1hcmNoUmVzdWx0cyk7XG4gICAgICAgIGNvbnN0IGxlYWRlck1hcmNoID0gdGhpcy5nZXRTcHJlYWRMZWFkZXJNYXJjaChzdGF0ZSwgbWFyY2hSZXN1bHRzLCBzcHJlYWRNYXJjaGVzKTtcbiAgICAgICAgY29uc3QgbWFyY2hlcyA9IF8uY29uY2F0KHNwcmVhZE1hcmNoZXMsIGxlYWRlck1hcmNoID8gW2xlYWRlck1hcmNoXSA6IFtdKTtcblxuICAgICAgICBpZiAobWFyY2hlcy5sZW5ndGggPT09IDAgfHwgKCFtb2RpZmllcnMuZnJlZSAmJiBhcnZlcm5pLnJlc291cmNlcygpIDwgXy5taW5CeShfLm1hcChtYXJjaGVzLCAnY29zdCcpKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFscmVhZHlNYXJjaGVkQnlJZCA9IHt9O1xuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLk1BUkNIKTtcbiAgICAgICAgaWYgKHRoaXMuZG9TcHJlYWRNYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIHNwcmVhZE1hcmNoZXMsIGFscmVhZHlNYXJjaGVkQnlJZCkpIHtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kb0NvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBsZWFkZXJNYXJjaCwgYWxyZWFkeU1hcmNoZWRCeUlkKSkge1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZWZmZWN0aXZlKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrQ29tbWFuZCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRDb21tYW5kKCk7XG5cbiAgICAgICAgbGV0IGNhbkRvU3BlY2lhbCA9IG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiAhdGhpcy53YXNCcml0YW5uaWFTcHJlYWRNYXJjaChcbiAgICAgICAgICAgICAgICBtYXJjaGVzKSAmJiAhdGhpcy53YXNCcml0YW5uaWFDb250cm9sTWFyY2gobGVhZGVyTWFyY2gpO1xuICAgICAgICBjb25zdCBkaWRTcGVjaWFsID0gY2FuRG9TcGVjaWFsICYmIChBcnZlcm5pRGV2YXN0YXRlLmRldmFzdGF0ZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBBcnZlcm5pRW50cmVhdC5lbnRyZWF0KFxuICAgICAgICAgICAgICAgIHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIGRpZFNwZWNpYWwgPyBGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMIDogRmFjdGlvbkFjdGlvbnMuQ09NTUFORDtcbiAgICB9XG5cbiAgICBzdGF0aWMgd2FzQnJpdGFubmlhU3ByZWFkTWFyY2gobWFyY2hlcykge1xuICAgICAgICByZXR1cm4gXy5maW5kKG1hcmNoZXMsIG1hcmNoID0+IChtYXJjaC5yZWdpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEgfHwgXy5maW5kKG1hcmNoLnNwcmVhZERlc3RpbmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aWQ6IFJlZ2lvbklEcy5CUklUQU5OSUF9KSkpO1xuICAgIH1cblxuICAgIHN0YXRpYyB3YXNCcml0YW5uaWFDb250cm9sTWFyY2gobWFyY2gpIHtcbiAgICAgICAgcmV0dXJuIG1hcmNoICYmIChtYXJjaC5yZWdpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEgfHwgbWFyY2guY29udHJvbERlc3RpbmF0aW9uLmlkID09PSBSZWdpb25JRHMuQlJJVEFOTklBKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZG9TcHJlYWRNYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoZXMsIGFscmVhZHlNYXJjaGVkQnlJZCkge1xuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGFydmVybmkgPSBzdGF0ZS5hcnZlcm5pO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEFydmVybmkgTWFyY2hpbmcgdG8gU3ByZWFkICoqKicpO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBtYXJjaGVzLCAobWFyY2gpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBheUZvck1hcmNoQW5kSGlkZShzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaCwgYWxyZWFkeU1hcmNoZWRCeUlkKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHdhcmJhbmRzID0gbWFyY2gucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgbWFyY2guc3ByZWFkRGVzdGluYXRpb25zLCAoaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IFt3YXJiYW5kcy5wb3AoKV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhcmJhbmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZWZmZWN0aXZlO1xuICAgIH1cblxuICAgIHN0YXRpYyBkb0NvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaCwgYWxyZWFkeU1hcmNoZWRCeUlkKSB7XG4gICAgICAgIGlmICghbWFyY2gpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFydmVybmkgPSBzdGF0ZS5hcnZlcm5pO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEFydmVybmkgTWFyY2hpbmcgdG8gVGFrZSBDb250cm9sICoqKicpO1xuXG4gICAgICAgIHRoaXMucGF5Rm9yTWFyY2hBbmRIaWRlKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoLCBhbHJlYWR5TWFyY2hlZEJ5SWQpO1xuXG4gICAgICAgIGNvbnN0IHdhcmJhbmRzID0gbWFyY2gucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICBjb25zdCBsZWFkZXIgPSBtYXJjaC5yZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICBpZiAobWFyY2guaGFyYXNzbWVudExvc3Nlcykge1xuICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBhcnZlcm5pLmlkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogbWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHdhcmJhbmRzLnNwbGljZSgwLCBtYXJjaC5oYXJhc3NtZW50TG9zc2VzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IG1hcmNoLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQ6IG1hcmNoLmNvbnRyb2xEZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBwaWVjZXM6IF8od2FyYmFuZHMpLnRha2UobWFyY2gubnVtQ29udHJvbFdhcmJhbmRzIC0gbWFyY2guaGFyYXNzbWVudExvc3NlcykuY29uY2F0KFtsZWFkZXJdKS52YWx1ZSgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgcGF5Rm9yTWFyY2hBbmRIaWRlKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoLCBhbHJlYWR5TWFyY2hlZEJ5SWQpIHtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmFydmVybmk7XG5cbiAgICAgICAgaWYgKCFhbHJlYWR5TWFyY2hlZEJ5SWRbbWFyY2gucmVnaW9uLmlkXSkge1xuICAgICAgICAgICAgYWxyZWFkeU1hcmNoZWRCeUlkW21hcmNoLnJlZ2lvbi5pZF0gPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGFydmVybmkucmVzb3VyY2VzKCkgPCBtYXJjaC5jb3N0ICYmICFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkksIGNvdW50OiBtYXJjaC5jb3N0fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBIaWRlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBhcnZlcm5pLmlkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogbWFyY2gucmVnaW9uLmlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRTcHJlYWRNYXJjaGVzKG1hcmNoUmVzdWx0cykge1xuICAgICAgICBjb25zdCB2aXNpdGVkID0gW107XG4gICAgICAgIHJldHVybiBfKG1hcmNoUmVzdWx0cykubWFwKFxuICAgICAgICAgICAgKG1hcmNoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtV2FyYmFuZHMgPSBtYXJjaC5yZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChudW1XYXJiYW5kcyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHNwcmVhZERlc3RpbmF0aW9ucyA9IF8obWFyY2guYWRqYWNlbnREZXN0aW5hdGlvbnMpLmZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24gPT4gZGVzdGluYXRpb24uZ2V0SGlkZGVuV2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgRmFjdGlvbklEcy5BUlZFUk5JKS5sZW5ndGggPT09IDApLm1hcChcbiAgICAgICAgICAgICAgICAgICAgKGRlc3RpbmF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1PdmVybGFwcyA9IF8ucmVkdWNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmNoUmVzdWx0cywgKHN1bSwgb3RoZXJNYXJjaCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5maW5kKG90aGVyTWFyY2guYWRqYWNlbnREZXN0aW5hdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJEZXN0aW5hdGlvbiA9PiBkZXN0aW5hdGlvbi5pZCA9PT0gb3RoZXJEZXN0aW5hdGlvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRlc3RpbmF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU92ZXJsYXBzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLnNvcnRCeSgnbnVtT3ZlcmxhcHMnKS5ncm91cEJ5KCdudW1PdmVybGFwcycpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS50YWtlKG51bVdhcmJhbmRzKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgICdpZCcpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3ByZWFkRGVzdGluYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbWFyY2gubnVtU3ByZWFkV2FyYmFuZHMgPSBNYXRoLm1pbihudW1XYXJiYW5kcywgc3ByZWFkRGVzdGluYXRpb25zLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgbWFyY2guc3ByZWFkRGVzdGluYXRpb25zID0gc3ByZWFkRGVzdGluYXRpb25zO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcmNoO1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgnbnVtU3ByZWFkV2FyYmFuZHMnKS5yZXZlcnNlKCkubWFwKFxuICAgICAgICAgICAgKG1hcmNoKSA9PiB7XG4gICAgICAgICAgICAgICAgbWFyY2guc3ByZWFkRGVzdGluYXRpb25zID0gXy5yZWplY3QobWFyY2guc3ByZWFkRGVzdGluYXRpb25zLCBpZCA9PiBfLmluZGV4T2YodmlzaXRlZCwgaWQpID49IDApO1xuICAgICAgICAgICAgICAgIHZpc2l0ZWQucHVzaC5hcHBseSh2aXNpdGVkLCBtYXJjaC5zcHJlYWREZXN0aW5hdGlvbnMpO1xuICAgICAgICAgICAgICAgIG1hcmNoLm51bVNwcmVhZFdhcmJhbmRzID0gTWF0aC5taW4obWFyY2gubnVtU3ByZWFkV2FyYmFuZHMsIG1hcmNoLnNwcmVhZERlc3RpbmF0aW9ucy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXJjaC5zcHJlYWREZXN0aW5hdGlvbnMubGVuZ3RoID4gMCA/IG1hcmNoIDogbnVsbDtcbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRTcHJlYWRMZWFkZXJNYXJjaChzdGF0ZSwgbWFyY2hSZXN1bHRzLCBzcHJlYWRNYXJjaGVzKSB7XG4gICAgICAgIGNvbnN0IGxlYWRlck1hcmNoID0gXyhzcHJlYWRNYXJjaGVzKS5maW5kKG1hcmNoID0+IG1hcmNoLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkpIHx8IF8oXG4gICAgICAgICAgICAgICAgbWFyY2hSZXN1bHRzKS5maW5kKG1hcmNoID0+IG1hcmNoLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkpO1xuICAgICAgICBpZiAoIWxlYWRlck1hcmNoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb25zaWRlciB0aGUgcmVzdWx0cyBvZiB0aGUgc3ByZWFkaW5nIG1hcmNoZXNcbiAgICAgICAgY29uc3Qgc3ByZWFkRGVzdGluYXRpb25zQnlJZCA9IF8oc3ByZWFkTWFyY2hlcykubWFwKCdzcHJlYWREZXN0aW5hdGlvbnMnKS5mbGF0dGVuKCkua2V5QnkoXy5pZGVudGl0eSkudmFsdWUoKTtcbiAgICAgICAgY29uc3QgYWxyZWFkeU1hcmNoZWRXYXJiYW5kcyA9IChsZWFkZXJNYXJjaC5udW1TcHJlYWRXYXJiYW5kcyB8fCAwKTtcbiAgICAgICAgY29uc3QgbGVhZGVyUmVnaW9uQ29udHJvbE1hcmdpbiA9IGxlYWRlck1hcmNoLnJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQVJWRVJOSV0gLSBhbHJlYWR5TWFyY2hlZFdhcmJhbmRzO1xuICAgICAgICBjb25zdCBhdmFpbGFibGVXYXJiYW5kcyA9IGxlYWRlck1hcmNoLnJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgRmFjdGlvbklEcy5BUlZFUk5JKS5sZW5ndGggLSAoYWxyZWFkeU1hcmNoZWRXYXJiYW5kcyArIDEpOyAvLyBMZWF2ZSBvbmUgYmVoaW5kXG4gICAgICAgIGlmIChhdmFpbGFibGVXYXJiYW5kcyA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsZWFkZXJSZWdpb25Db250cm9sTWFyZ2luID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaWd1cmUgb3V0IGhvdyBtYW55IHdlIGNhbiBhY3R1YWxseSBtYXJjaCBjb25zaWRlcmluZyBjb250cm9sXG4gICAgICAgIGNvbnN0IG51bVdhcmJhbmRzVG9NYXJjaCA9IGxlYWRlclJlZ2lvbkNvbnRyb2xNYXJnaW4gPCAxID8gYXZhaWxhYmxlV2FyYmFuZHMgOiBsZWFkZXJSZWdpb25Db250cm9sTWFyZ2luIC0gMjtcbiAgICAgICAgY29uc3QgbnVtTWFyY2hpbmcgPSBudW1XYXJiYW5kc1RvTWFyY2ggKyAxO1xuICAgICAgICAvLyBGaW5kIGJlc3QgcGF0aCB0byBhbGwgZGVzdGluYXRpb25zIGNvbnNpZGVyaW5nIGhhcmFzc21lbnRcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25QYXRoc0J5SWQgPSBfLmtleUJ5KFxuICAgICAgICAgICAgdGhpcy5nZXREZXN0aW5hdGlvblBhdGhzKHN0YXRlLCBudW1NYXJjaGluZywgbGVhZGVyTWFyY2gucmVnaW9uLCBsZWFkZXJNYXJjaC5kZXN0aW5hdGlvbnMpLCAnaWQnKTtcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25Ub0NvbnRyb2wgPSBfKGxlYWRlck1hcmNoLmRlc3RpbmF0aW9ucykucmVqZWN0KHtpZDogUmVnaW9uSURzLkFFRFVJfSkuZmlsdGVyKFxuICAgICAgICAgICAgZGVzdGluYXRpb24gPT4gZGVzdGluYXRpb25QYXRoc0J5SWRbZGVzdGluYXRpb24uaWRdKS5maWx0ZXIoXG4gICAgICAgICAgICAoZGVzdGluYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAvLyBTZWUgaWYgd2UgY2FuIHRha2UgY29udHJvbCBmcm9tIFJvbWFucyBvciBBZWR1aSBldmVuIGFmdGVyIGhhcmFzc21lbnRcbiAgICAgICAgICAgICAgICBjb25zdCBudW1BZnRlckhhcmFzc21lbnQgPSBudW1NYXJjaGluZyAtIGRlc3RpbmF0aW9uUGF0aHNCeUlkW2Rlc3RpbmF0aW9uLmlkXS5iZXN0UGF0aC5oYXJhc3NtZW50TG9zc2VzO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwcmVhZFdhcmJhbmRzID0gc3ByZWFkRGVzdGluYXRpb25zQnlJZFtkZXN0aW5hdGlvbi5pZF0gPyAxIDogMDtcbiAgICAgICAgICAgICAgICBjb25zdCBjYW5UYWtlQ29udHJvbCA9IGRlc3RpbmF0aW9uLmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BUlZFUk5JXSArIHNwcmVhZFdhcmJhbmRzICsgbnVtQWZ0ZXJIYXJhc3NtZW50ID4gMDtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0VuZW15Q29udHJvbGxlZCA9IGRlc3RpbmF0aW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuQUVEVUkgfHwgZGVzdGluYXRpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5ST01BTlM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhblRha2VDb250cm9sICYmIGlzRW5lbXlDb250cm9sbGVkO1xuICAgICAgICAgICAgfSkubWFwKFxuICAgICAgICAgICAgKGRlc3RpbmF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gTm93IGZpZ3VyZSBvdXQgdGhlIHByaW9yaXR5IGJhc2VkIG9uIGhhcmFzc21lbnQgYW5kIGFkamFjZW50IHJlZ2lvbnMgd2l0aCBhcnZlcm5pIHByZXNlbnRcbiAgICAgICAgICAgICAgICBjb25zdCBudW1BZGphY2VudFJlZ2lvbnNXaXRoQXJ2ZXJuaSA9IF8ucmVkdWNlKFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbi5hZGphY2VudCwgKHN1bSwgYWRqYWNlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGphY2VudC5nZXRQaWVjZXNGb3JGYWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYWN0aW9uSURzLkFSVkVSTkkpLmxlbmd0aCA+IDAgfHwgc3ByZWFkRGVzdGluYXRpb25zQnlJZFthZGphY2VudC5pZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW07XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUhhcmFzc21lbnRMb3NzZXMgPSBkZXN0aW5hdGlvblBhdGhzQnlJZFtkZXN0aW5hdGlvbi5pZF0uYmVzdFBhdGguaGFyYXNzbWVudExvc3NlcztcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbnVtSGFyYXNzbWVudExvc3NlcyxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6ICgxMCArIG51bUhhcmFzc21lbnRMb3NzZXMpICsgJy0nICsgKDk5IC0gbnVtQWRqYWNlbnRSZWdpb25zV2l0aEFydmVybmkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLmZpcnN0KCk7XG5cbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvblRvQ29udHJvbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGVhZGVyTWFyY2gubnVtQ29udHJvbFdhcmJhbmRzID0gbnVtV2FyYmFuZHNUb01hcmNoO1xuICAgICAgICBsZWFkZXJNYXJjaC5jb250cm9sRGVzdGluYXRpb24gPSBkZXN0aW5hdGlvblRvQ29udHJvbC5kZXN0aW5hdGlvbjtcbiAgICAgICAgbGVhZGVyTWFyY2guaGFyYXNzbWVudExvc3NlcyA9IGRlc3RpbmF0aW9uVG9Db250cm9sLm51bUhhcmFzc21lbnRMb3NzZXM7XG5cbiAgICAgICAgcmV0dXJuIGxlYWRlck1hcmNoO1xuXG4gICAgfVxuXG4gICAgc3RhdGljIGdldERlc3RpbmF0aW9uUGF0aHMoc3RhdGUsIG51bU1vYmlsZSwgc3RhcnRSZWdpb24sIGRlc3RpbmF0aW9ucykge1xuICAgICAgICByZXR1cm4gXyhkZXN0aW5hdGlvbnMpLm1hcChcbiAgICAgICAgICAgIChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWFwLm1lYXN1cmVEaXN0YW5jZVRvUmVnaW9uKHN0YXRlLCBzdGFydFJlZ2lvbi5pZCwgZGVzdGluYXRpb24uaWQpO1xuICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmVzdFBhdGg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBbc3RhcnRSZWdpb24uaWQsIGRlc3RpbmF0aW9uLmlkXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXJhc3NtZW50TG9zc2VzOiAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgYmVzdFBhdGggPSBfKE1hcC5maW5kUGF0aHNUb1JlZ2lvbihzdGF0ZSwgc3RhcnRSZWdpb24uaWQsIGRlc3RpbmF0aW9uLmlkLCAyKSkubWFwKFxuICAgICAgICAgICAgICAgICAgICAocGF0aCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkZGxlUmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbcGF0aFsxXV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXJhc3NtZW50TG9zc2VzID0gdGhpcy5oYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBGYWN0aW9uSURzLlJPTUFOUywgbWlkZGxlUmVnaW9uKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBGYWN0aW9uSURzLkJFTEdBRSwgbWlkZGxlUmVnaW9uKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBGYWN0aW9uSURzLkFFRFVJLCBtaWRkbGVSZWdpb24pICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLCBtaWRkbGVSZWdpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFyYXNzbWVudExvc3NlcyA+IDMgfHwgaGFyYXNzbWVudExvc3NlcyA+PSBudW1Nb2JpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXJhc3NtZW50TG9zc2VzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ2hhcmFzc21lbnRMb3NzZXMnKS5ncm91cEJ5KCdoYXJhc3NtZW50TG9zc2VzJykubWFwKFxuICAgICAgICAgICAgICAgICAgICBfLnNodWZmbGUpLmZsYXR0ZW4oKS5maXJzdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFiZXN0UGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGRlc3RpbmF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgYmVzdFBhdGhcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBoYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBmYWN0aW9uSWQsIHJlZ2lvbikge1xuICAgICAgICBsZXQgbG9zc2VzID0gMDtcbiAgICAgICAgY29uc3QgbnVtSGlkZGVuRW5lbWllcyA9IHJlZ2lvbi5nZXRIaWRkZW5QaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICBpZiAobnVtSGlkZGVuRW5lbWllcyA+PSAzKSB7XG4gICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF07XG4gICAgICAgICAgICBpZiAocGxheWVyLndpbGxIYXJhc3MoRmFjdGlvbklEcy5BUlZFUk5JKSkge1xuICAgICAgICAgICAgICAgIGxvc3NlcyA9IE1hdGguZmxvb3IobnVtSGlkZGVuRW5lbWllcyAvIDMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb3NzZXM7XG4gICAgfVxuXG4gICAgc3RhdGljIG1hc3NNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBjb25zdCBtYXJjaFJlc3VsdHMgPSBNYXJjaC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkl9KTtcbiAgICAgICAgY29uc3QgbGVhZGVyTWFyY2ggPSBfKG1hcmNoUmVzdWx0cykuZmluZChtYXJjaCA9PiBtYXJjaC5yZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpKTtcbiAgICAgICAgaWYgKCFsZWFkZXJNYXJjaCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5NQVJDSCk7XG4gICAgICAgIGNvbnN0IGxlZ2lvbkNvbnRyb2xNYXJjaCA9IHRoaXMuZ2V0TGVnaW9uQ29udHJvbE1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIGxlYWRlck1hcmNoLCBtYXJjaFJlc3VsdHMpO1xuICAgICAgICBpZiAobGVnaW9uQ29udHJvbE1hcmNoKSB7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0aGlzLmRvQ29udHJvbE1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIGxlZ2lvbkNvbnRyb2xNYXJjaCwge30pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbWFzc01hcmNoZXMgPSB0aGlzLmdldE1hc3NNYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIGxlYWRlck1hcmNoLCBtYXJjaFJlc3VsdHMpO1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdGhpcy5kb01hc3NNYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIG1hc3NNYXJjaGVzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWVmZmVjdGl2ZSkge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5yb2xsYmFja0NvbW1hbmQoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0Q29tbWFuZCgpO1xuICAgICAgICBsZXQgY2FuRG9TcGVjaWFsID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmICF0aGlzLndhc0JyaXRhbm5pYUNvbnRyb2xNYXJjaChsZWdpb25Db250cm9sTWFyY2gpO1xuICAgICAgICBjb25zdCBkaWRTcGVjaWFsID0gY2FuRG9TcGVjaWFsICYmIChBcnZlcm5pRGV2YXN0YXRlLmRldmFzdGF0ZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBBcnZlcm5pRW50cmVhdC5lbnRyZWF0KFxuICAgICAgICAgICAgICAgIHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIGRpZFNwZWNpYWwgPyBGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMIDogRmFjdGlvbkFjdGlvbnMuQ09NTUFORDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZG9NYXNzTWFyY2hlcyhzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaGVzKSB7XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgbWFyY2hlcywgKG1hcmNoLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXlGb3JNYXJjaEFuZEhpZGUoc3RhdGUsIG1vZGlmaWVycywgbWFyY2gsIHt9KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEFydmVybmkgTWFyY2ggdG8gbWFzcyBuZWFyIGxlZ2lvbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXMgPSBfLnRha2UobWFyY2gucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJjaC5udW1NYXNzV2FyYmFuZHMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlYWRlciA9IG1hcmNoLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSk7XG4gICAgICAgICAgICAgICAgaWYgKGxlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBwaWVjZXMudW5zaGlmdChsZWFkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBtYXJjaC5tYXNzRGVzdGluYXRpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldExlZ2lvbkNvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBsZWFkZXJNYXJjaCwgbWFyY2hSZXN1bHRzKSB7XG5cbiAgICAgICAgY29uc3QgYXZhaWxhYmxlV2FyYmFuZHMgPSBsZWFkZXJNYXJjaC5yZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkubGVuZ3RoO1xuICAgICAgICBjb25zdCBudW1NYXJjaGluZyA9IGF2YWlsYWJsZVdhcmJhbmRzICsgMTtcblxuICAgICAgICBjb25zdCBkZXN0aW5hdGlvblBhdGhzQnlJZCA9IF8ua2V5QnkoXG4gICAgICAgICAgICB0aGlzLmdldERlc3RpbmF0aW9uUGF0aHMoc3RhdGUsIG51bU1hcmNoaW5nLCBsZWFkZXJNYXJjaC5yZWdpb24sIGxlYWRlck1hcmNoLmRlc3RpbmF0aW9ucyksICdpZCcpO1xuICAgICAgICBjb25zdCBkZXN0aW5hdGlvblRvQ29udHJvbCA9IF8obGVhZGVyTWFyY2guZGVzdGluYXRpb25zKS5maWx0ZXIoXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9PiBkZXN0aW5hdGlvblBhdGhzQnlJZFtkZXN0aW5hdGlvbi5pZF0pLmZpbHRlcihcbiAgICAgICAgICAgIChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIENhbid0IGFscmVhZHkgYmUgY29udHJvbGxlZCBieSBBcnZlcm5pXG4gICAgICAgICAgICAgICAgaWYgKGRlc3RpbmF0aW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuQVJWRVJOSSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSGFzIHRvIGhhdmUgYSBsZWdpb25cbiAgICAgICAgICAgICAgICBjb25zdCByb21hbk1vYmlsZVBpZWNlcyA9IGRlc3RpbmF0aW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0xlZ2lvbiA9IF8uZmluZChyb21hbk1vYmlsZVBpZWNlcywge3R5cGU6ICdsZWdpb24nfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFoYXNMZWdpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgbW9yZSB0aGFuIDJ4IHRoZSBudW1iZXIgb2Ygcm9tYW4gbW9iaWxlIHBpZWNlc1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUFmdGVySGFyYXNzbWVudCA9IG51bU1hcmNoaW5nIC0gZGVzdGluYXRpb25QYXRoc0J5SWRbZGVzdGluYXRpb24uaWRdLmJlc3RQYXRoLmhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtQWZ0ZXJNYXJjaCA9IGRlc3RpbmF0aW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICBGYWN0aW9uSURzLkFSVkVSTkkpLmxlbmd0aCArIG51bUFmdGVySGFyYXNzbWVudDtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNDYWVzYXIgPSBfLmZpbmQocm9tYW5Nb2JpbGVQaWVjZXMsIHBpZWNlID0+IHBpZWNlLnR5cGUgPT09ICdsZWFkZXInICYmICFwaWVjZS5pc1N1Y2Nlc3NvcigpKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzQ2Flc2FyICYmIChudW1BZnRlck1hcmNoIDw9IHJvbWFuTW9iaWxlUGllY2VzLmxlbmd0aCAqIDIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBGaW5hbGx5IHdlIG5lZWQgdG8gY29udHJvbFxuICAgICAgICAgICAgICAgIGNvbnN0IGNhblRha2VDb250cm9sID0gZGVzdGluYXRpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFSVkVSTkldICsgbnVtQWZ0ZXJIYXJhc3NtZW50ID4gMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FuVGFrZUNvbnRyb2w7XG4gICAgICAgICAgICB9KS5tYXAoXG4gICAgICAgICAgICAoZGVzdGluYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAvLyBOb3cgZmlndXJlIG91dCB0aGUgcHJpb3JpdHkgYmFzZWQgb24gaGFyYXNzbWVudFxuICAgICAgICAgICAgICAgIGNvbnN0IG51bUhhcmFzc21lbnRMb3NzZXMgPSBkZXN0aW5hdGlvblBhdGhzQnlJZFtkZXN0aW5hdGlvbi5pZF0uYmVzdFBhdGguaGFyYXNzbWVudExvc3NlcztcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbnVtSGFyYXNzbWVudExvc3Nlc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnNvcnRCeSgnbnVtSGFyYXNzbWVudExvc3NlcycpLmdyb3VwQnkoJ251bUhhcmFzc21lbnRMb3NzZXMnKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcblxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uVG9Db250cm9sKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuXG4gICAgICAgIGxlYWRlck1hcmNoLm51bUNvbnRyb2xXYXJiYW5kcyA9IGF2YWlsYWJsZVdhcmJhbmRzO1xuICAgICAgICBsZWFkZXJNYXJjaC5jb250cm9sRGVzdGluYXRpb24gPSBkZXN0aW5hdGlvblRvQ29udHJvbC5kZXN0aW5hdGlvbjtcbiAgICAgICAgbGVhZGVyTWFyY2guaGFyYXNzbWVudExvc3NlcyA9IGRlc3RpbmF0aW9uVG9Db250cm9sLm51bUhhcmFzc21lbnRMb3NzZXM7XG5cbiAgICAgICAgcmV0dXJuIGxlYWRlck1hcmNoO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRNYXNzTWFyY2hlcyhzdGF0ZSwgbW9kaWZpZXJzLCBsZWFkZXJNYXJjaCwgbWFyY2hSZXN1bHRzKSB7XG5cbiAgICAgICAgY29uc3QgYXZhaWxhYmxlV2FyYmFuZHMgPSBsZWFkZXJNYXJjaC5yZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkubGVuZ3RoO1xuICAgICAgICBpZiAoYXZhaWxhYmxlV2FyYmFuZHMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbnVtTWFyY2hpbmcgPSBhdmFpbGFibGVXYXJiYW5kczsgLy8gKyBsZWFkZXIsIC0gb25lIGxlZnQgYmVoaW5kO1xuXG4gICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0c0J5UmVnaW9uSWQgPSBfLmtleUJ5KG1hcmNoUmVzdWx0cywgbWFyY2ggPT4gbWFyY2gucmVnaW9uLmlkKTtcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25QYXRoc0J5SWQgPSBfLmtleUJ5KFxuICAgICAgICAgICAgdGhpcy5nZXREZXN0aW5hdGlvblBhdGhzKHN0YXRlLCBudW1NYXJjaGluZywgbGVhZGVyTWFyY2gucmVnaW9uLCBsZWFkZXJNYXJjaC5kZXN0aW5hdGlvbnMpLCAnaWQnKTtcblxuICAgICAgICAvLyBGaW5kIGRlc3RpbmF0aW9ucyB0aGF0IHRoZSBsZWFkZXIgY2FuIG1hcmNoIHRvIHdoaWNoIGFyZSBuZXh0IHRvIGEgbGVnaW9uXG4gICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uc05leHRUb0xlZ2lvbiA9IF8obGVhZGVyTWFyY2guZGVzdGluYXRpb25zKS5maWx0ZXIoXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9PiBkZXN0aW5hdGlvblBhdGhzQnlJZFtkZXN0aW5hdGlvbi5pZF0pLmZpbHRlcihcbiAgICAgICAgICAgIChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChkZXN0aW5hdGlvbi5nZXRMZWdpb25zKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IG51bUFmdGVySGFyYXNzbWVudCA9IG51bU1hcmNoaW5nIC0gZGVzdGluYXRpb25QYXRoc0J5SWRbZGVzdGluYXRpb24uaWRdLmJlc3RQYXRoLmhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgICAgICAgICAgaWYgKG51bUFmdGVySGFyYXNzbWVudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmQoZGVzdGluYXRpb24uYWRqYWNlbnQsIGFkamFjZW50ID0+IGFkamFjZW50LmdldExlZ2lvbnMoKS5sZW5ndGggPiAwKTtcbiAgICAgICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgaWYgKGRlc3RpbmF0aW9uc05leHRUb0xlZ2lvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdyBwaWNrIHRoZSBvbmUgd2hpY2ggY2FuIGJlIG1hcmNoZWQgdG8gYnkgdGhlIG1vc3Qgd2FyYmFuZHMgKGFzaWRlIGZyb20gdGhlIGxlYWRlcidzIG1hcmNoKVxuICAgICAgICBjb25zdCBjaG9zZW5NYXNzUmVzdWx0cyA9IF8oZGVzdGluYXRpb25zTmV4dFRvTGVnaW9uKS5tYXAoKGRlc3RpbmF0aW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXNzUmVzdWx0cyA9IHRoaXMuY2FsY3VsYXRlTWFzc1Jlc3VsdHNGb3JEZXN0aW5hdGlvbihzdGF0ZSwgbGVhZGVyTWFyY2gsIG1hcmNoUmVzdWx0c0J5UmVnaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgIG51bVRvTWFzczogbWFzc1Jlc3VsdHMubnVtVG9NYXNzLFxuICAgICAgICAgICAgICAgIG1hc3NSZXN1bHRzLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiA5OSAtIG1hc3NSZXN1bHRzLm51bVRvTWFzcyArICctJyArIDEwICsgbWFzc1Jlc3VsdHMubWFyY2hlcy5sZW5ndGhcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLmZpcnN0KCk7XG5cbiAgICAgICAgaWYgKCFjaG9zZW5NYXNzUmVzdWx0cykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGVhZGVyTWFyY2gubnVtTWFzc1dhcmJhbmRzID0gYXZhaWxhYmxlV2FyYmFuZHMgLSAxO1xuICAgICAgICBsZWFkZXJNYXJjaC5tYXNzRGVzdGluYXRpb24gPSBjaG9zZW5NYXNzUmVzdWx0cy5kZXN0aW5hdGlvbjtcbiAgICAgICAgbGVhZGVyTWFyY2guaGFyYXNzbWVudExvc3NlcyA9IGRlc3RpbmF0aW9uUGF0aHNCeUlkW2Nob3Nlbk1hc3NSZXN1bHRzLmRlc3RpbmF0aW9uLmlkXS5iZXN0UGF0aC5oYXJhc3NtZW50TG9zc2VzO1xuXG4gICAgICAgIGNvbnN0IGxlYWRlckFscmVhZHlBZGphY2VudFRvTGVnaW9uID0gXy5maW5kKGxlYWRlck1hcmNoLnJlZ2lvbi5hZGphY2VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRqYWNlbnQgPT4gYWRqYWNlbnQuZ2V0TGVnaW9ucygpLmxlbmd0aCA+IDApO1xuICAgICAgICBjb25zdCBtYXJjaE1hc3NUb3RhbCA9IChsZWFkZXJNYXJjaC5udW1NYXNzV2FyYmFuZHMgLSBsZWFkZXJNYXJjaC5oYXJhc3NtZW50TG9zc2VzKSArIGNob3Nlbk1hc3NSZXN1bHRzLm51bVRvTWFzcztcbiAgICAgICAgaWYgKGxlYWRlckFscmVhZHlBZGphY2VudFRvTGVnaW9uICYmIG1hcmNoTWFzc1RvdGFsIDw9IGxlYWRlck1hcmNoLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKFxuICAgICAgICAgICAgICAgIEZhY3Rpb25JRHMuQVJWRVJOSSkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1hc3NNYXJjaGVzID0gY2hvc2VuTWFzc1Jlc3VsdHMubWFzc1Jlc3VsdHMubWFyY2hlcztcbiAgICAgICAgXy5lYWNoKG1hc3NNYXJjaGVzLCAobWFyY2gpID0+IHtcbiAgICAgICAgICAgIG1hcmNoLm1hc3NEZXN0aW5hdGlvbiA9IGNob3Nlbk1hc3NSZXN1bHRzLmRlc3RpbmF0aW9uO1xuICAgICAgICB9KTtcblxuICAgICAgICBtYXNzTWFyY2hlcy51bnNoaWZ0KGxlYWRlck1hcmNoKTtcbiAgICAgICAgcmV0dXJuIG1hc3NNYXJjaGVzO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYWxjdWxhdGVNYXNzUmVzdWx0c0ZvckRlc3RpbmF0aW9uKHN0YXRlLCBsZWFkZXJNYXJjaCwgbWFyY2hSZXN1bHRzQnlSZWdpb25JZCwgZGVzdGluYXRpb24pIHtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmFydmVybmk7XG4gICAgICAgIGNvbnN0IGFydmVybmlQaWVjZXNBdERlc3RpbmF0aW9uID0gZGVzdGluYXRpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIF8oZGVzdGluYXRpb24uYWRqYWNlbnQpLnJlamVjdChyZWdpb24gPT4gcmVnaW9uLmlkID09PSBsZWFkZXJNYXJjaC5yZWdpb24uaWQpLm1hcCgocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICBudW1XYXJiYW5kczogcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpLmxlbmd0aFxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5maWx0ZXIocmVnaW9uRGF0YSA9PiByZWdpb25EYXRhLm51bVdhcmJhbmRzID4gMSkuc29ydEJ5KCdudW1XYXJiYW5kcycpLnJldmVyc2UoKS5yZWR1Y2UoXG4gICAgICAgICAgICAoYWNjdW11bGF0b3IsIHJlZ2lvbkRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gbWFyY2hSZXN1bHRzQnlSZWdpb25JZFtyZWdpb25EYXRhLnJlZ2lvbi5pZF0uY29zdDtcbiAgICAgICAgICAgICAgICBpZiAoY29zdCA8IGFjY3VtdWxhdG9yLnJlc291cmNlcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJjaCA9IG1hcmNoUmVzdWx0c0J5UmVnaW9uSWRbcmVnaW9uRGF0YS5yZWdpb24uaWRdO1xuICAgICAgICAgICAgICAgICAgICBtYXJjaC5udW1NYXNzV2FyYmFuZHMgPSByZWdpb25EYXRhLm51bVdhcmJhbmRzIC0gMTtcblxuICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5yZXNvdXJjZXMgLT0gY29zdDtcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IubnVtVG9NYXNzICs9IG1hcmNoLm51bU1hc3NXYXJiYW5kcztcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IubWFyY2hlcy5wdXNoKG1hcmNoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgICAgICAgICAgfSwge3Jlc291cmNlczogYXJ2ZXJuaS5yZXNvdXJjZXMoKSAtIGxlYWRlck1hcmNoLmNvc3QsIG51bVRvTWFzczogYXJ2ZXJuaVBpZWNlc0F0RGVzdGluYXRpb24sIG1hcmNoZXM6IFtdfSk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFydmVybmlNYXJjaFxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FydmVybmkvYXJ2ZXJuaU1hcmNoLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFIQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _rampage = __webpack_require__(56);\n\nvar _rampage2 = _interopRequireDefault(_rampage);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeRampage = function () {\n    function BelgaeRampage() {\n        _classCallCheck(this, BelgaeRampage);\n    }\n\n    _createClass(BelgaeRampage, null, [{\n        key: 'rampage',\n        value: function rampage(state, modifiers) {\n\n            var prioritizedRampages = this.getPrioritizedRampages(state, modifiers);\n            if (prioritizedRampages.length === 0) {\n                return false;\n            }\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.RAMPAGE);\n            _lodash2.default.each(prioritizedRampages, function (rampage) {\n                _rampage2.default.execute(state, { rampage: rampage });\n            });\n            state.turnHistory.getCurrentTurn().commitSpecialAbility();\n\n            return true;\n        }\n    }, {\n        key: 'getPrioritizedRampages',\n        value: function getPrioritizedRampages(state, modifiers) {\n            var _this = this;\n\n            var rampages = _lodash2.default.each(_rampage2.default.test(state), function (possibleRampage) {\n                var _$map$sortBy$first = (0, _lodash2.default)(possibleRampage.enemyFactions).map(function (factionId) {\n                    return [factionId, _this.getRampageFactionData(state, modifiers, possibleRampage.region, factionId)];\n                }).sortBy(function (pair) {\n                    return pair[1].priority;\n                }).first(),\n                    _$map$sortBy$first2 = _slicedToArray(_$map$sortBy$first, 2),\n                    chosenFaction = _$map$sortBy$first2[0],\n                    factionData = _$map$sortBy$first2[1];\n\n                possibleRampage.chosenFaction = chosenFaction;\n                possibleRampage.priority = factionData.priority;\n                possibleRampage.agreeingFactionId = factionData.agreeingFactionId;\n                possibleRampage.count = Math.min(possibleRampage.hiddenWarbands.length, factionData.mobileEnemyPieces.length - (factionData.isBattling ? 1 : 0));\n            });\n\n            return (0, _lodash2.default)(rampages).reject({ priority: 'z' }).sortBy('priority').value();\n        }\n    }, {\n        key: 'getRampageFactionData',\n        value: function getRampageFactionData(state, modifiers, region, factionId) {\n\n            var battles = modifiers.context.battles;\n            var isBattling = _lodash2.default.find(battles, function (battleResult) {\n                return battleResult.region.id === region.id && battleResult.defendingFaction.id === factionId;\n            });\n            var mobileEnemyPieces = region.getMobilePiecesForFaction(factionId);\n\n            var priority = 'z';\n            var agreeingFactionId = null;\n            if (!isBattling || mobileEnemyPieces.length >= 2) {\n\n                agreeingFactionId = this.factionCanRetreat(state, region, factionId);\n\n                if (!agreeingFactionId) {\n                    priority = 'a' + _enemyFactionPriority2.default[factionId];\n                } else if (this.rampageWillCauseBelgicControl(region, factionId, isBattling)) {\n                    priority = 'b' + _enemyFactionPriority2.default[factionId];\n                } else {\n                    priority = 'c' + _enemyFactionPriority2.default[factionId];\n                }\n            }\n\n            return { priority: priority, agreeingFactionId: agreeingFactionId, mobileEnemyPieces: mobileEnemyPieces, isBattling: isBattling };\n        }\n    }, {\n        key: 'rampageWillCauseBelgicControl',\n        value: function rampageWillCauseBelgicControl(region, factionId, isBattling) {\n            if (region.controllingFactionId() === _factionIds2.default.BELGAE) {\n                return false;\n            }\n\n            var hiddenWarbands = region.getHiddenPiecesForFaction(_factionIds2.default.BELGAE);\n            var mobileEnemyPieces = region.getMobilePiecesForFaction(factionId);\n            var margin = region.controllingMarginByFaction()[_factionIds2.default.BELGAE];\n            var numRemoved = Math.min(hiddenWarbands.length, mobileEnemyPieces.length - (isBattling ? 1 : 0));\n            return margin + numRemoved >= 1;\n        }\n    }, {\n        key: 'factionCanRetreat',\n        value: function factionCanRetreat(state, region, factionId) {\n            var canRetreatToSelf = _lodash2.default.find(region.adjacent, function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() && adjacentRegion.controllingFactionId() === factionId;\n            });\n\n            if (canRetreatToSelf) {\n                return factionId;\n            } else {\n                var player = state.playersByFaction[factionId];\n                return player.getRetreatAgreement(state, region);\n            }\n        }\n    }]);\n\n    return BelgaeRampage;\n}();\n\nexports.default = BelgaeRampage;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlUmFtcGFnZS5qcz9kM2VlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmFtcGFnZSBmcm9tICcuLi8uLi9jb21tYW5kcy9iZWxnYWUvcmFtcGFnZSc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5cbmNsYXNzIEJlbGdhZVJhbXBhZ2Uge1xuXG4gICAgc3RhdGljIHJhbXBhZ2Uoc3RhdGUsIG1vZGlmaWVycykge1xuXG4gICAgICAgIGNvbnN0IHByaW9yaXRpemVkUmFtcGFnZXMgPSB0aGlzLmdldFByaW9yaXRpemVkUmFtcGFnZXMoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIGlmKHByaW9yaXRpemVkUmFtcGFnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydFNwZWNpYWxBYmlsaXR5KFNwZWNpYWxBYmlsaXR5SURzLlJBTVBBR0UpO1xuICAgICAgICBfLmVhY2gocHJpb3JpdGl6ZWRSYW1wYWdlcywgZnVuY3Rpb24ocmFtcGFnZSkge1xuICAgICAgICAgICAgUmFtcGFnZS5leGVjdXRlKHN0YXRlLCB7IHJhbXBhZ2UgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdFNwZWNpYWxBYmlsaXR5KCk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFByaW9yaXRpemVkUmFtcGFnZXMoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCByYW1wYWdlcyA9IF8uZWFjaChcbiAgICAgICAgICAgIFJhbXBhZ2UudGVzdChzdGF0ZSksIChwb3NzaWJsZVJhbXBhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBbY2hvc2VuRmFjdGlvbiwgZmFjdGlvbkRhdGFdID0gXyhwb3NzaWJsZVJhbXBhZ2UuZW5lbXlGYWN0aW9ucykubWFwKFxuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQgPT4gW2ZhY3Rpb25JZCwgdGhpcy5nZXRSYW1wYWdlRmFjdGlvbkRhdGEoIHN0YXRlLCBtb2RpZmllcnMsIHBvc3NpYmxlUmFtcGFnZS5yZWdpb24sIGZhY3Rpb25JZCldKS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgICAgIHBhaXIgPT4gcGFpclsxXS5wcmlvcml0eSkuZmlyc3QoKTtcblxuICAgICAgICAgICAgICAgIHBvc3NpYmxlUmFtcGFnZS5jaG9zZW5GYWN0aW9uID0gY2hvc2VuRmFjdGlvbjtcbiAgICAgICAgICAgICAgICBwb3NzaWJsZVJhbXBhZ2UucHJpb3JpdHkgPSBmYWN0aW9uRGF0YS5wcmlvcml0eTtcbiAgICAgICAgICAgICAgICBwb3NzaWJsZVJhbXBhZ2UuYWdyZWVpbmdGYWN0aW9uSWQgPSBmYWN0aW9uRGF0YS5hZ3JlZWluZ0ZhY3Rpb25JZDtcbiAgICAgICAgICAgICAgICBwb3NzaWJsZVJhbXBhZ2UuY291bnQgPSBNYXRoLm1pbihwb3NzaWJsZVJhbXBhZ2UuaGlkZGVuV2FyYmFuZHMubGVuZ3RoLCAoZmFjdGlvbkRhdGEubW9iaWxlRW5lbXlQaWVjZXMubGVuZ3RoIC0gKGZhY3Rpb25EYXRhLmlzQmF0dGxpbmcgPyAxIDogMCkpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfKHJhbXBhZ2VzKS5yZWplY3Qoe3ByaW9yaXR5IDogJ3onfSkuc29ydEJ5KCdwcmlvcml0eScpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFJhbXBhZ2VGYWN0aW9uRGF0YShzdGF0ZSwgbW9kaWZpZXJzLCByZWdpb24sIGZhY3Rpb25JZCkge1xuXG4gICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzO1xuICAgICAgICBjb25zdCBpc0JhdHRsaW5nID0gXy5maW5kKGJhdHRsZXMsIGZ1bmN0aW9uKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICAgICAgcmV0dXJuIGJhdHRsZVJlc3VsdC5yZWdpb24uaWQgPT09IHJlZ2lvbi5pZCAmJiBiYXR0bGVSZXN1bHQuZGVmZW5kaW5nRmFjdGlvbi5pZCA9PT0gZmFjdGlvbklkO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbW9iaWxlRW5lbXlQaWVjZXMgPSByZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihmYWN0aW9uSWQpO1xuXG4gICAgICAgIGxldCBwcmlvcml0eSA9ICd6JztcbiAgICAgICAgbGV0IGFncmVlaW5nRmFjdGlvbklkID0gbnVsbDtcbiAgICAgICAgaWYoIWlzQmF0dGxpbmcgfHwgbW9iaWxlRW5lbXlQaWVjZXMubGVuZ3RoID49IDIpIHtcblxuICAgICAgICAgICAgYWdyZWVpbmdGYWN0aW9uSWQgPSB0aGlzLmZhY3Rpb25DYW5SZXRyZWF0KHN0YXRlLCByZWdpb24sIGZhY3Rpb25JZCk7XG5cbiAgICAgICAgICAgIGlmICghYWdyZWVpbmdGYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhJyArIEVuZW15RmFjdGlvblByaW9yaXR5W2ZhY3Rpb25JZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJhbXBhZ2VXaWxsQ2F1c2VCZWxnaWNDb250cm9sKHJlZ2lvbiwgZmFjdGlvbklkLCBpc0JhdHRsaW5nKSkge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2InICsgRW5lbXlGYWN0aW9uUHJpb3JpdHlbZmFjdGlvbklkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2MnICsgRW5lbXlGYWN0aW9uUHJpb3JpdHlbZmFjdGlvbklkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7cHJpb3JpdHksIGFncmVlaW5nRmFjdGlvbklkLCBtb2JpbGVFbmVteVBpZWNlcywgaXNCYXR0bGluZ31cbiAgICB9XG5cbiAgICBzdGF0aWMgcmFtcGFnZVdpbGxDYXVzZUJlbGdpY0NvbnRyb2wocmVnaW9uLCBmYWN0aW9uSWQsIGlzQmF0dGxpbmcpIHtcbiAgICAgICAgaWYgKHJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGlkZGVuV2FyYmFuZHMgPSByZWdpb24uZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkJFTEdBRSk7XG4gICAgICAgIGNvbnN0IG1vYmlsZUVuZW15UGllY2VzID0gcmVnaW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oZmFjdGlvbklkKTtcbiAgICAgICAgY29uc3QgbWFyZ2luID0gcmVnaW9uLmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdO1xuICAgICAgICBjb25zdCBudW1SZW1vdmVkID0gTWF0aC5taW4oaGlkZGVuV2FyYmFuZHMubGVuZ3RoLCBtb2JpbGVFbmVteVBpZWNlcy5sZW5ndGggLSAoaXNCYXR0bGluZyA/IDEgOiAwKSk7XG4gICAgICAgIHJldHVybiAobWFyZ2luICsgbnVtUmVtb3ZlZCA+PSAxICk7XG4gICAgfVxuXG4gICAgc3RhdGljIGZhY3Rpb25DYW5SZXRyZWF0KHN0YXRlLCByZWdpb24sIGZhY3Rpb25JZCkge1xuICAgICAgICBjb25zdCBjYW5SZXRyZWF0VG9TZWxmID0gXy5maW5kKFxuICAgICAgICAgICAgcmVnaW9uLmFkamFjZW50LCAoYWRqYWNlbnRSZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWRqYWNlbnRSZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSAmJiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBmYWN0aW9uSWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZihjYW5SZXRyZWF0VG9TZWxmKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFjdGlvbklkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdO1xuICAgICAgICAgICAgcmV0dXJuIHBsYXllci5nZXRSZXRyZWF0QWdyZWVtZW50KHN0YXRlLCByZWdpb24pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBCZWxnYWVSYW1wYWdlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9iZWxnYWVSYW1wYWdlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBSEE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _enemyFactionPriority = __webpack_require__(44);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _build = __webpack_require__(162);\n\nvar _build2 = _interopRequireDefault(_build);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _placeFort = __webpack_require__(47);\n\nvar _placeFort2 = _interopRequireDefault(_placeFort);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanBuild = function () {\n    function RomanBuild() {\n        _classCallCheck(this, RomanBuild);\n    }\n\n    _createClass(RomanBuild, null, [{\n        key: 'build',\n        value: function build(state, modifiers) {\n            if (state.romans.resources() < 6) {\n                return false;\n            }\n\n            var executableBuilds = this.getExecutableBuilds(state, modifiers);\n            if (executableBuilds.length === 0) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.BUILD);\n            _lodash2.default.each(executableBuilds, function (build) {\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.ROMANS, count: 2 });\n                }\n\n                if (build.willPlaceFort) {\n                    _placeFort2.default.execute(state, { factionId: _factionIds2.default.ROMANS, regionId: build.region.id });\n                } else if (build.willRemoveAlly) {\n                    var ally = _lodash2.default.find(build.region.getAlliesAndCitadels(), function (piece) {\n                        return piece.tribeId === build.tribeId;\n                    });\n                    _removePieces2.default.execute(state, { factionId: ally.factionId, regionId: build.region.id, pieces: [ally] });\n                } else if (build.willPlaceAlly) {\n                    var tribe = (0, _lodash2.default)(build.region.subduedTribesForFaction(_factionIds2.default.ROMANS)).sortBy(function (tribe) {\n                        return tribe.isCity;\n                    }).first();\n                    _placeAlliedTribe2.default.execute(state, { factionId: _factionIds2.default.ROMANS, regionId: build.region.id, tribeId: tribe.id });\n                }\n            });\n\n            state.turnHistory.getCurrentTurn().commitSpecialAbility();\n\n            return true;\n        }\n    }, {\n        key: 'getExecutableBuilds',\n        value: function getExecutableBuilds(state, modifiers) {\n            var seizeRegions = modifiers.context.seizeRegions || [];\n            var possibleBuilds = _lodash2.default.shuffle(_build2.default.test(state));\n            var fortPlacements = this.getFortPlacements(state, possibleBuilds);\n            var allyRemovals = this.getAllyRemovals(state, possibleBuilds, fortPlacements, seizeRegions);\n            var allyPlacements = this.getAllyPlacements(state, possibleBuilds, fortPlacements, seizeRegions);\n\n            var allBuilds = _lodash2.default.concat(fortPlacements, allyRemovals, allyPlacements);\n\n            return modifiers.free ? allBuilds : _lodash2.default.reduce(allBuilds, function (accumulator, build) {\n                if (accumulator.resourcesRemaining >= 6) {\n                    accumulator.resourcesRemaining -= 2;\n                    accumulator.builds.push(build);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.romans.resources(), builds: [] }).builds;\n        }\n    }, {\n        key: 'getFortPlacements',\n        value: function getFortPlacements(state, possibleBuilds) {\n            return (0, _lodash2.default)(possibleBuilds).map(function (build) {\n                if (!build.canPlaceFort) {\n                    return;\n                }\n\n                var hasEnemyWithEnoughWarbands = _lodash2.default.find(_factionIds2.default, function (factionId) {\n                    return factionId !== _factionIds2.default.ROMANS && build.region.getWarbandsOrAuxiliaForFaction(factionId).length > 3;\n                });\n                if (!hasEnemyWithEnoughWarbands) {\n                    return;\n                }\n\n                return {\n                    region: build.region,\n                    willPlaceFort: true\n                };\n            }).compact().take(state.romans.availableForts().length).value();\n        }\n    }, {\n        key: 'getAllyRemovals',\n        value: function getAllyRemovals(state, possibleBuilds, fortPlacements, seizeRegions) {\n            var enemyFactionPriority = this.getEnemyFactionPriority(state);\n            return (0, _lodash2.default)(possibleBuilds).map(function (build) {\n                if (!build.canRemoveAlly) {\n                    return;\n                }\n\n                if (_lodash2.default.indexOf(seizeRegions, build.region.id) >= 0) {\n                    return;\n                }\n\n                if (build.requiresFortForControl && !_lodash2.default.find(fortPlacements, function (placement) {\n                    return placement.region.id === build.region.id;\n                })) {\n                    return;\n                }\n\n                var tribe = (0, _lodash2.default)(build.region.tribes).reject(function (tribe) {\n                    return tribe.alliedFactionId() === _factionIds2.default.ROMANS;\n                }).sortBy(function (tribe) {\n                    return _lodash2.default.findIndex(enemyFactionPriority, tribe.alliedFactionId());\n                }).first();\n\n                return {\n                    region: build.region,\n                    willRemoveAlly: true,\n                    tribeId: tribe.id,\n                    priority: _lodash2.default.findIndex(enemyFactionPriority, tribe.alliedFactionId())\n                };\n            }).compact().sortBy('priority').value();\n        }\n    }, {\n        key: 'getAllyPlacements',\n        value: function getAllyPlacements(state, possibleBuilds, fortPlacements, seizeRegions) {\n            return (0, _lodash2.default)(possibleBuilds).map(function (build) {\n                if (!build.canPlaceAlly) {\n                    return;\n                }\n\n                if (_lodash2.default.indexOf(seizeRegions, build.region.id) >= 0) {\n                    return;\n                }\n\n                if (build.requiresFortForControl && !_lodash2.default.find(fortPlacements, function (placement) {\n                    return placement.region.id === build.region.id;\n                })) {\n                    return;\n                }\n\n                return {\n                    region: build.region,\n                    willPlaceAlly: true\n                };\n            }).compact().take(state.romans.availableAlliedTribes().length).value();\n        }\n    }, {\n        key: 'getEnemyFactionPriority',\n        value: function getEnemyFactionPriority(state) {\n            return _lodash2.default.sortBy(_factionIds2.default, function (factionId) {\n                return 50 - state.factionsById[factionId].victoryMargin(state) + '-' + (state.playersByFaction[factionId].isNonPlayer ? 'b' : 'a') + '-' + _enemyFactionPriority2.default[factionId];\n            });\n        }\n    }]);\n\n    return RomanBuild;\n}();\n\nexports.default = RomanBuild;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5CdWlsZC5qcz9kYTkzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICdmYWxsaW5nc2t5L2JvdHMvcm9tYW5zL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBCdWlsZCBmcm9tICcuLi8uLi9jb21tYW5kcy9yb21hbnMvYnVpbGQnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBQbGFjZUZvcnQgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlRm9ydCc7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VBbGxpZWRUcmliZSc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuXG5cbmNsYXNzIFJvbWFuQnVpbGQge1xuICAgIHN0YXRpYyBidWlsZChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGlmIChzdGF0ZS5yb21hbnMucmVzb3VyY2VzKCkgPCA2KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBleGVjdXRhYmxlQnVpbGRzID0gdGhpcy5nZXRFeGVjdXRhYmxlQnVpbGRzKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICBpZiAoZXhlY3V0YWJsZUJ1aWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuc3RhcnRTcGVjaWFsQWJpbGl0eShTcGVjaWFsQWJpbGl0eUlEcy5CVUlMRCk7XG4gICAgICAgIF8uZWFjaChleGVjdXRhYmxlQnVpbGRzLCAoYnVpbGQpID0+IHtcbiAgICAgICAgICAgIGlmKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUywgY291bnQ6IDJ9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoYnVpbGQud2lsbFBsYWNlRm9ydCkge1xuICAgICAgICAgICAgICAgIFBsYWNlRm9ydC5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsIHJlZ2lvbklkOiBidWlsZC5yZWdpb24uaWR9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoYnVpbGQud2lsbFJlbW92ZUFsbHkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGx5ID0gXy5maW5kKGJ1aWxkLnJlZ2lvbi5nZXRBbGxpZXNBbmRDaXRhZGVscygpLCBwaWVjZT0+cGllY2UudHJpYmVJZCA9PT0gYnVpbGQudHJpYmVJZCk7XG4gICAgICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IGFsbHkuZmFjdGlvbklkLCByZWdpb25JZDogYnVpbGQucmVnaW9uLmlkLCBwaWVjZXM6IFthbGx5XX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihidWlsZC53aWxsUGxhY2VBbGx5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJpYmUgPSBfKGJ1aWxkLnJlZ2lvbi5zdWJkdWVkVHJpYmVzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykpLnNvcnRCeSh0cmliZT0+dHJpYmUuaXNDaXR5KS5maXJzdCgpO1xuICAgICAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsIHJlZ2lvbklkOiBidWlsZC5yZWdpb24uaWQsIHRyaWJlSWQ6IHRyaWJlLmlkfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0U3BlY2lhbEFiaWxpdHkoKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RXhlY3V0YWJsZUJ1aWxkcyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHNlaXplUmVnaW9ucyA9IG1vZGlmaWVycy5jb250ZXh0LnNlaXplUmVnaW9ucyB8fCBbXTtcbiAgICAgICAgY29uc3QgcG9zc2libGVCdWlsZHMgPSBfLnNodWZmbGUoQnVpbGQudGVzdChzdGF0ZSkpO1xuICAgICAgICBjb25zdCBmb3J0UGxhY2VtZW50cyA9IHRoaXMuZ2V0Rm9ydFBsYWNlbWVudHMoc3RhdGUsIHBvc3NpYmxlQnVpbGRzKTtcbiAgICAgICAgY29uc3QgYWxseVJlbW92YWxzID0gdGhpcy5nZXRBbGx5UmVtb3ZhbHMoc3RhdGUsIHBvc3NpYmxlQnVpbGRzLCBmb3J0UGxhY2VtZW50cywgc2VpemVSZWdpb25zKTtcbiAgICAgICAgY29uc3QgYWxseVBsYWNlbWVudHMgPSB0aGlzLmdldEFsbHlQbGFjZW1lbnRzKHN0YXRlLCBwb3NzaWJsZUJ1aWxkcywgZm9ydFBsYWNlbWVudHMsIHNlaXplUmVnaW9ucyk7XG5cbiAgICAgICAgY29uc3QgYWxsQnVpbGRzID0gXy5jb25jYXQoZm9ydFBsYWNlbWVudHMsIGFsbHlSZW1vdmFscywgYWxseVBsYWNlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiBtb2RpZmllcnMuZnJlZSA/IGFsbEJ1aWxkcyA6IF8ucmVkdWNlKGFsbEJ1aWxkcywgKGFjY3VtdWxhdG9yLCBidWlsZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyA+PSA2KSB7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IucmVzb3VyY2VzUmVtYWluaW5nIC09IDI7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IuYnVpbGRzLnB1c2goYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yXG4gICAgICAgIH0sIHtyZXNvdXJjZXNSZW1haW5pbmc6IHN0YXRlLnJvbWFucy5yZXNvdXJjZXMoKSwgYnVpbGRzOiBbXX0pLmJ1aWxkcztcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0Rm9ydFBsYWNlbWVudHMoc3RhdGUsIHBvc3NpYmxlQnVpbGRzKSB7XG4gICAgICAgIHJldHVybiBfKHBvc3NpYmxlQnVpbGRzKS5tYXAoKGJ1aWxkKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWJ1aWxkLmNhblBsYWNlRm9ydCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaGFzRW5lbXlXaXRoRW5vdWdoV2FyYmFuZHMgPSBfLmZpbmQoRmFjdGlvbklEcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZCA9PiBmYWN0aW9uSWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TICYmIGJ1aWxkLnJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkKS5sZW5ndGggPiAzKTtcbiAgICAgICAgICAgIGlmICghaGFzRW5lbXlXaXRoRW5vdWdoV2FyYmFuZHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVnaW9uOiBidWlsZC5yZWdpb24sXG4gICAgICAgICAgICAgICAgd2lsbFBsYWNlRm9ydDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5jb21wYWN0KCkudGFrZShzdGF0ZS5yb21hbnMuYXZhaWxhYmxlRm9ydHMoKS5sZW5ndGgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEFsbHlSZW1vdmFscyhzdGF0ZSwgcG9zc2libGVCdWlsZHMsIGZvcnRQbGFjZW1lbnRzLCBzZWl6ZVJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uUHJpb3JpdHkgPSB0aGlzLmdldEVuZW15RmFjdGlvblByaW9yaXR5KHN0YXRlKTtcbiAgICAgICAgcmV0dXJuIF8ocG9zc2libGVCdWlsZHMpLm1hcCgoYnVpbGQpID0+IHtcbiAgICAgICAgICAgIGlmICghYnVpbGQuY2FuUmVtb3ZlQWxseSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihzZWl6ZVJlZ2lvbnMsIGJ1aWxkLnJlZ2lvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGJ1aWxkLnJlcXVpcmVzRm9ydEZvckNvbnRyb2wgJiYgIV8uZmluZChmb3J0UGxhY2VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0+IHBsYWNlbWVudC5yZWdpb24uaWQgPT09IGJ1aWxkLnJlZ2lvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHRyaWJlID0gXyhidWlsZC5yZWdpb24udHJpYmVzKS5yZWplY3QodHJpYmU9PnRyaWJlLmFsbGllZEZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLlJPTUFOUykuc29ydEJ5KFxuICAgICAgICAgICAgICAgIHRyaWJlID0+IF8uZmluZEluZGV4KGVuZW15RmFjdGlvblByaW9yaXR5LCB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSkpLmZpcnN0KCk7XG5cblxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlZ2lvbjogYnVpbGQucmVnaW9uLFxuICAgICAgICAgICAgICAgIHdpbGxSZW1vdmVBbGx5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRyaWJlSWQ6IHRyaWJlLmlkLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiBfLmZpbmRJbmRleChlbmVteUZhY3Rpb25Qcmlvcml0eSwgdHJpYmUuYWxsaWVkRmFjdGlvbklkKCkpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ3ByaW9yaXR5JykudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0QWxseVBsYWNlbWVudHMoc3RhdGUsIHBvc3NpYmxlQnVpbGRzLCBmb3J0UGxhY2VtZW50cywgc2VpemVSZWdpb25zKSB7XG4gICAgICAgIHJldHVybiBfKHBvc3NpYmxlQnVpbGRzKS5tYXAoKGJ1aWxkKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWJ1aWxkLmNhblBsYWNlQWxseSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihzZWl6ZVJlZ2lvbnMsIGJ1aWxkLnJlZ2lvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGJ1aWxkLnJlcXVpcmVzRm9ydEZvckNvbnRyb2wgJiYgIV8uZmluZChmb3J0UGxhY2VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0+IHBsYWNlbWVudC5yZWdpb24uaWQgPT09IGJ1aWxkLnJlZ2lvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVnaW9uOiBidWlsZC5yZWdpb24sXG4gICAgICAgICAgICAgICAgd2lsbFBsYWNlQWxseTogdHJ1ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY29tcGFjdCgpLnRha2Uoc3RhdGUucm9tYW5zLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RW5lbXlGYWN0aW9uUHJpb3JpdHkoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8uc29ydEJ5KEZhY3Rpb25JRHMsIGZhY3Rpb25JZCA9PiAoNTAgLSBzdGF0ZS5mYWN0aW9uc0J5SWRbZmFjdGlvbklkXS52aWN0b3J5TWFyZ2luKHN0YXRlKSkgKyAnLScgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXIgPyAnYicgOiAnYScpICsgJy0nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdKTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUm9tYW5CdWlsZFxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hbkJ1aWxkLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFFQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _enemyFactionPriority = __webpack_require__(44);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _scout = __webpack_require__(164);\n\nvar _scout2 = _interopRequireDefault(_scout);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _scoutPieces = __webpack_require__(94);\n\nvar _scoutPieces2 = _interopRequireDefault(_scoutPieces);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanScout = function () {\n    function RomanScout() {\n        _classCallCheck(this, RomanScout);\n    }\n\n    _createClass(RomanScout, null, [{\n        key: 'scout',\n        value: function scout(state, modifiers) {\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.SCOUT);\n            if (this.doScouts(state, modifiers)) {\n                state.turnHistory.getCurrentTurn().commitSpecialAbility();\n            } else {\n                state.turnHistory.getCurrentTurn().rollbackSpecialAbility();\n            }\n\n            return true;\n        }\n    }, {\n        key: 'doScouts',\n        value: function doScouts(state, modifiers) {\n            var scoutResults = _scout2.default.test(state);\n            var regionsWithSupply = this.regionsWithSupply(state);\n            var possibleScouts = this.getPossibleScouts(state, modifiers, regionsWithSupply, scoutResults);\n\n            var regionsAdjacentWithNumNeeded = (0, _lodash2.default)(possibleScouts).map(function (possibleScout) {\n                return possibleScout.scout.moveRegions;\n            }).flatten().uniqBy('id').map(function (region) {\n\n                if (region.controllingFactionId() === _factionIds2.default.ROMANS) {\n                    return;\n                }\n                var enemyControlMargin = region.getMaxEnemyControllingMargin(_factionIds2.default.ROMANS);\n                if (enemyControlMargin <= 0) {\n                    return;\n                }\n\n                return {\n                    region: region,\n                    numAuxiliaForSupply: enemyControlMargin\n                };\n            }).compact().filter(function (regionData) {\n                var numCanMoveHere = _lodash2.default.reduce(possibleScouts, function (sum, possibleScout) {\n                    if (_lodash2.default.find(possibleScout.scout.moveRegions, function (scoutMoveRegion) {\n                        return scoutMoveRegion.id === regionData.region.id;\n                    })) {\n                        return sum + possibleScout.numAuxiliaCanMoveForSupply;\n                    }\n                    return sum;\n                }, 0);\n\n                return numCanMoveHere >= regionData.numAuxiliaForSupply;\n            }).value();\n\n            var effective = false;\n            var scoutForSupplyMoves = this.getScoutForSupplyMoves(state, possibleScouts, regionsAdjacentWithNumNeeded, regionsWithSupply.length);\n\n            _lodash2.default.each(scoutForSupplyMoves, function (move) {\n                effective = true;\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: move.sourceRegionId,\n                    destRegionId: move.destRegionId,\n                    pieces: _lodash2.default.take(state.regionsById[move.sourceRegionId].getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), move.numMoved)\n                });\n            });\n\n            // We need to recalculate these now that we have done some moves.\n            var updatedRegionsWithSupply = this.regionsWithSupply(state);\n            var updatedPossibleScouts = this.getPossibleScouts(state, modifiers, updatedRegionsWithSupply, scoutResults);\n            var scoutToJoinLegionMoves = this.getScoutToJoinLegionMoves(state, updatedPossibleScouts);\n            _lodash2.default.each(scoutToJoinLegionMoves, function (move) {\n                effective = true;\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: move.sourceRegionId,\n                    destRegionId: move.destRegionId,\n                    pieces: _lodash2.default.take(state.regionsById[move.sourceRegionId].getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), move.numMoved)\n                });\n            });\n\n            var scoutsToReveal = this.getScoutsToReveal(state);\n            _lodash2.default.each(scoutsToReveal, function (scout) {\n                effective = true;\n                _revealPieces2.default.execute(state, { factionId: _factionIds2.default.ROMANS, regionId: scout.regionId, count: scout.hiddenCount });\n                _lodash2.default.each(scout.piecesToScout, function (piecesForFaction, factionId) {\n                    _scoutPieces2.default.execute(state, { factionId: factionId, regionId: scout.regionId, pieces: piecesForFaction });\n                });\n            });\n            return effective;\n        }\n    }, {\n        key: 'getPossibleScouts',\n        value: function getPossibleScouts(state, modifiers, regionsWithSupply, scoutResults) {\n            var _this = this;\n\n            return (0, _lodash2.default)(scoutResults).shuffle().map(function (scout) {\n                return {\n                    scout: scout,\n                    numAuxiliaCanMoveForSupply: _this.determineNumAuxiliaCanMove(state, scout.region, regionsWithSupply)\n                };\n            }).value();\n        }\n    }, {\n        key: 'permute',\n        value: function permute(permutation) {\n            var length = permutation.length;\n            var result = [permutation.slice()];\n            var c = new Array(length).fill(0);\n            var i = 1;\n            var k = void 0;\n            var p = void 0;\n\n            while (i < length) {\n                if (c[i] < i) {\n                    k = i % 2 && c[i];\n                    p = permutation[i];\n                    permutation[i] = permutation[k];\n                    permutation[k] = p;\n                    ++c[i];\n                    i = 1;\n                    result.push(permutation.slice());\n                } else {\n                    c[i] = 0;\n                    ++i;\n                }\n            }\n            return result;\n        }\n    }, {\n        key: 'cartesianProduct',\n        value: function cartesianProduct(arr) {\n            return arr.reduce(function (a, b) {\n                return a.map(function (x) {\n                    return b.map(function (y) {\n                        return x.concat(y);\n                    });\n                }).reduce(function (a, b) {\n                    return a.concat(b);\n                }, []);\n            }, [[]]);\n        }\n    }, {\n        key: 'getScoutForSupplyMoves',\n        value: function getScoutForSupplyMoves(state, possibleScouts, regionsAdjacentWithNumNeeded, numRegionsWithSupply) {\n            var _this2 = this;\n\n            // This may cap out at about 6 valid adjacent regions per origin due to the factorial growth of permutation,\n            // though in practice many are culled before and after permuting.\n            var allCombinations = (0, _lodash2.default)(possibleScouts).map(function (possibleScout) {\n                if (possibleScout.numAuxiliaCanMoveForSupply === 0) {\n                    return;\n                }\n\n                var validMoveRegions = (0, _lodash2.default)(possibleScout.scout.moveRegions).map(function (region) {\n                    return _lodash2.default.find(regionsAdjacentWithNumNeeded, function (adjacent) {\n                        return adjacent.region.id === region.id;\n                    });\n                }).compact().value();\n\n                if (validMoveRegions.length === 0) {\n                    return;\n                }\n\n                var permutations = _this2.permute(validMoveRegions);\n\n                // Fill every permutation starting from the first region and filling completely as many as possible\n                // Cull non-unique combinations\n                return (0, _lodash2.default)(permutations).map(function (entry) {\n                    var numRemaining = possibleScout.numAuxiliaCanMoveForSupply;\n                    return (0, _lodash2.default)(entry).map(function (moveRegion) {\n                        var numToMove = Math.min(moveRegion.numAuxiliaForSupply, numRemaining);\n                        if (numToMove === 0) {\n                            return;\n                        }\n                        numRemaining -= numToMove;\n                        return {\n                            sourceRegionId: possibleScout.scout.region.id,\n                            destRegionId: moveRegion.region.id,\n                            numNeeded: moveRegion.numAuxiliaForSupply,\n                            numMoved: numToMove\n                        };\n                    }).compact().sortBy('destRegionId').value();\n                }).uniqBy(function (entry) {\n                    return _lodash2.default.reduce(entry, function (key, data) {\n                        return key + data.destRegionId + data.numMoved;\n                    }, '');\n                }).value();\n            }).compact().value();\n\n            // Ok at this point we have every combination of filling adjacent regions for each possible starting scout region\n            // Now we have to find the cartesian product\n            var cartesianProduct = this.cartesianProduct(allCombinations);\n            var summedCombinations = (0, _lodash2.default)(cartesianProduct).map(function (entry) {\n                var margins = (0, _lodash2.default)(entry).groupBy('destRegionId').map(function (moves, regionId) {\n                    var sum = _lodash2.default.reduce(moves, function (sum, move) {\n                        return sum + move.numMoved;\n                    }, 0);\n\n                    var supplyMargin = sum - moves[0].numNeeded;\n                    return {\n                        regionId: regionId,\n                        supplyMargin: supplyMargin,\n                        supplied: supplyMargin >= 0\n                    };\n                }).filter({ supplied: true }).sortBy('regionId').value();\n\n                return {\n                    moves: entry,\n                    margins: margins,\n                    numSupplied: margins.length\n                };\n            }).value();\n\n            // Get the unique combinations of supplied, favoring ones that use the least extra pieces\n            var finalCandidates = (0, _lodash2.default)(summedCombinations).orderBy(function (group) {\n                return _lodash2.default.reduce(group.margins, function (sum, margin) {\n                    return margin.supplied ? sum + margin.supplyMargin : sum;\n                }, 0);\n            }).uniqBy(function (group) {\n                return _lodash2.default.reduce(group.margins, function (key, margin) {\n                    return key + margin.regionId + (margin.supplied ? '1' : '0');\n                });\n            }).value();\n\n            // Now, finally calculate the most supplied regions as a result\n            var solution = (0, _lodash2.default)(finalCandidates).shuffle().map(function (group) {\n                var numSuppliedAfter = _this2.regionsWithSupply(state, [], (0, _lodash2.default)(group.margins).filter('supplied').map('regionId').value()).length - numRegionsWithSupply;\n                return {\n                    group: group,\n                    numSuppliedAfter: numSuppliedAfter\n                };\n            }).sortBy('numSuppliedAfter').filter(function (entry) {\n                return entry.numSuppliedAfter > 0;\n            }).reverse().map('group').first();\n\n            if (!solution) {\n                return [];\n            }\n\n            var targetRegionIds = _lodash2.default.map(solution.margins, 'regionId');\n            return (0, _lodash2.default)(solution.moves).filter(function (move) {\n                return _lodash2.default.indexOf(targetRegionIds, move.destRegionId) >= 0;\n            }).groupBy('sourceRegionId').values().flatten().value();\n        }\n    }, {\n        key: 'getScoutToJoinLegionMoves',\n        value: function getScoutToJoinLegionMoves(state, scouts) {\n            return (0, _lodash2.default)(scouts).filter(function (scout) {\n                return scout.numAuxiliaCanMoveForSupply > 0;\n            }).map(function (scout) {\n\n                if (scout.scout.region.getLegions().length > 0) {\n                    return;\n                }\n\n                var targetRegionId = (0, _lodash2.default)(scout.scout.moveRegions).reduce(function (accumulator, region) {\n                    var numLegions = region.getLegions().length;\n                    if (numLegions > accumulator.numLegions) {\n                        accumulator.target = region.id;\n                        accumulator.numLegions = numLegions;\n                    }\n                    return accumulator;\n                }, { target: null, numLegions: 0 }).target;\n\n                if (!targetRegionId) {\n                    return;\n                }\n\n                return {\n                    sourceRegionId: scout.scout.region.id,\n                    destRegionId: targetRegionId,\n                    numMoved: scout.numAuxiliaCanMoveForSupply\n                };\n            }).compact().value();\n        }\n    }, {\n        key: 'getScoutsToReveal',\n        value: function getScoutsToReveal(state) {\n            return (0, _lodash2.default)(this.getScoutRegions(state)).map(function (region) {\n                var myHidden = region.getHiddenWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS);\n                if (myHidden.length === 0) {\n                    return;\n                }\n\n                var pieces = (0, _lodash2.default)(region.pieces()).filter(function (piece) {\n                    return piece.factionId !== _factionIds2.default.ROMANS && piece.type === 'warband' && !piece.scouted();\n                }).sortBy(function (piece) {\n                    return (state.frost() && piece.factionId === _factionIds2.default.GERMANIC_TRIBES ? 'a' : 'b') + (!piece.revealed() ? '1' : '2');\n                }).value();\n\n                if (pieces.length === 0) {\n                    return;\n                }\n\n                return {\n                    regionId: region.id,\n                    hiddenCount: Math.min(myHidden.length, pieces.length),\n                    piecesToScout: (0, _lodash2.default)(pieces).take(myHidden.length).groupBy('factionId').value()\n                };\n            }).compact().value();\n        }\n    }, {\n        key: 'regionsWithSupply',\n        value: function regionsWithSupply(state, invalidRegion, validRegions) {\n            var nonPlayerAedui = state.playersByFaction[_factionIds2.default.AEDUI].isNonPlayer;\n            return (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.getPiecesForFaction(_factionIds2.default.ROMANS).length > 0;\n            }).filter(function (region) {\n                return region.hasValidSupplyLine(_factionIds2.default.ROMANS, nonPlayerAedui ? [_factionIds2.default.AEDUI] : [], _lodash2.default.compact([invalidRegion]), validRegions);\n            }).value();\n        }\n    }, {\n        key: 'regionsWithoutSupply',\n        value: function regionsWithoutSupply(state) {\n            var nonPlayerAedui = state.playersByFaction[_factionIds2.default.AEDUI].isNonPlayer;\n            return (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.getPiecesForFaction(_factionIds2.default.ROMANS).length > 0;\n            }).reject(function (region) {\n                return region.hasValidSupplyLine(_factionIds2.default.ROMANS, nonPlayerAedui ? [_factionIds2.default.AEDUI] : []);\n            }).value();\n        }\n    }, {\n        key: 'determineNumAuxiliaCanMove',\n        value: function determineNumAuxiliaCanMove(state, region, suppliedRegions) {\n            var maxEnemyMargin = region.getMaxEnemyControllingMargin(_factionIds2.default.ROMANS);\n            var numAuxilia = region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length;\n            if (maxEnemyMargin === -99 || maxEnemyMargin > 0) {\n                return numAuxilia;\n            }\n            var numForEnemyControl = Math.abs(maxEnemyMargin) + 1;\n            if (numForEnemyControl <= numAuxilia) {\n                var numSuppliedAfterEnemyControl = this.regionsWithSupply(state, region.id).length;\n                if (numSuppliedAfterEnemyControl === suppliedRegions.length) {\n                    return numAuxilia;\n                }\n            }\n\n            return Math.min(numForEnemyControl - 1, numAuxilia);\n        }\n    }, {\n        key: 'getScoutRegions',\n        value: function getScoutRegions(state) {\n            var _this3 = this;\n\n            var leaderRegion = this.findLeaderRegion(state);\n            return (0, _lodash2.default)(state.regions).filter(function (region) {\n                return _this3.withinRangeOfLeader(region, leaderRegion);\n            }).value();\n        }\n    }, {\n        key: 'withinRangeOfLeader',\n        value: function withinRangeOfLeader(region, leaderRegion) {\n            if (!leaderRegion) {\n                return false;\n            }\n\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.ROMANS);\n\n            return region.id === leaderRegion.id || !leader.isSuccessor() && _lodash2.default.find(leaderRegion.adjacent, function (adjacent) {\n                return region.id === adjacent.id;\n            });\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_factionIds2.default.ROMANS], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return RomanScout;\n}();\n\nexports.default = RomanScout;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5TY291dC5qcz9hOTdiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICdmYWxsaW5nc2t5L2JvdHMvcm9tYW5zL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBTY291dCBmcm9tICcuLi8uLi9jb21tYW5kcy9yb21hbnMvc2NvdXQnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9tb3ZlUGllY2VzJztcbmltcG9ydCBSZXZlYWxQaWVjZXMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3JldmVhbFBpZWNlcyc7XG5pbXBvcnQgU2NvdXRQaWVjZXMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3Njb3V0UGllY2VzJztcblxuXG5jbGFzcyBSb21hblNjb3V0IHtcbiAgICBzdGF0aWMgc2NvdXQoc3RhdGUsIG1vZGlmaWVycykge1xuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuc3RhcnRTcGVjaWFsQWJpbGl0eShTcGVjaWFsQWJpbGl0eUlEcy5TQ09VVCk7XG4gICAgICAgIGlmICh0aGlzLmRvU2NvdXRzKHN0YXRlLCBtb2RpZmllcnMpKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdFNwZWNpYWxBYmlsaXR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrU3BlY2lhbEFiaWxpdHkoKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvU2NvdXRzKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3Qgc2NvdXRSZXN1bHRzID0gU2NvdXQudGVzdChzdGF0ZSk7XG4gICAgICAgIGNvbnN0IHJlZ2lvbnNXaXRoU3VwcGx5ID0gdGhpcy5yZWdpb25zV2l0aFN1cHBseShzdGF0ZSk7XG4gICAgICAgIGNvbnN0IHBvc3NpYmxlU2NvdXRzID0gdGhpcy5nZXRQb3NzaWJsZVNjb3V0cyhzdGF0ZSwgbW9kaWZpZXJzLCByZWdpb25zV2l0aFN1cHBseSwgc2NvdXRSZXN1bHRzKTtcblxuICAgICAgICBjb25zdCByZWdpb25zQWRqYWNlbnRXaXRoTnVtTmVlZGVkID0gXyhwb3NzaWJsZVNjb3V0cykubWFwKFxuICAgICAgICAgICAgKHBvc3NpYmxlU2NvdXQpID0+IHsgcmV0dXJuIHBvc3NpYmxlU2NvdXQuc2NvdXQubW92ZVJlZ2lvbnM7IH0pLmZsYXR0ZW4oKS51bmlxQnkoJ2lkJykubWFwKChyZWdpb24pID0+IHtcblxuICAgICAgICAgICAgaWYgKHJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVuZW15Q29udHJvbE1hcmdpbiA9IHJlZ2lvbi5nZXRNYXhFbmVteUNvbnRyb2xsaW5nTWFyZ2luKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICAgIGlmIChlbmVteUNvbnRyb2xNYXJnaW4gPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgbnVtQXV4aWxpYUZvclN1cHBseTogZW5lbXlDb250cm9sTWFyZ2luXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pLmNvbXBhY3QoKS5maWx0ZXIocmVnaW9uRGF0YSA9PiB7XG4gICAgICAgICAgICBjb25zdCBudW1DYW5Nb3ZlSGVyZSA9IF8ucmVkdWNlKHBvc3NpYmxlU2NvdXRzLCAoc3VtLCBwb3NzaWJsZVNjb3V0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKF8uZmluZChwb3NzaWJsZVNjb3V0LnNjb3V0Lm1vdmVSZWdpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvdXRNb3ZlUmVnaW9uID0+IHNjb3V0TW92ZVJlZ2lvbi5pZCA9PT0gcmVnaW9uRGF0YS5yZWdpb24uaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBwb3NzaWJsZVNjb3V0Lm51bUF1eGlsaWFDYW5Nb3ZlRm9yU3VwcGx5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgICAgIHJldHVybiBudW1DYW5Nb3ZlSGVyZSA+PSByZWdpb25EYXRhLm51bUF1eGlsaWFGb3JTdXBwbHk7XG4gICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBzY291dEZvclN1cHBseU1vdmVzID0gdGhpcy5nZXRTY291dEZvclN1cHBseU1vdmVzKHN0YXRlLCBwb3NzaWJsZVNjb3V0cywgcmVnaW9uc0FkamFjZW50V2l0aE51bU5lZWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zV2l0aFN1cHBseS5sZW5ndGgpO1xuXG4gICAgICAgIF8uZWFjaChzY291dEZvclN1cHBseU1vdmVzLCBtb3ZlID0+IHtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IG1vdmUuc291cmNlUmVnaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogbW92ZS5kZXN0UmVnaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlczogXy50YWtlKFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucmVnaW9uc0J5SWRbbW92ZS5zb3VyY2VSZWdpb25JZF0uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmUubnVtTW92ZWQpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdlIG5lZWQgdG8gcmVjYWxjdWxhdGUgdGhlc2Ugbm93IHRoYXQgd2UgaGF2ZSBkb25lIHNvbWUgbW92ZXMuXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRSZWdpb25zV2l0aFN1cHBseSA9IHRoaXMucmVnaW9uc1dpdGhTdXBwbHkoc3RhdGUpO1xuICAgICAgICBjb25zdCB1cGRhdGVkUG9zc2libGVTY291dHMgPSB0aGlzLmdldFBvc3NpYmxlU2NvdXRzKHN0YXRlLCBtb2RpZmllcnMsIHVwZGF0ZWRSZWdpb25zV2l0aFN1cHBseSwgc2NvdXRSZXN1bHRzKTtcbiAgICAgICAgY29uc3Qgc2NvdXRUb0pvaW5MZWdpb25Nb3ZlcyA9IHRoaXMuZ2V0U2NvdXRUb0pvaW5MZWdpb25Nb3ZlcyhzdGF0ZSwgdXBkYXRlZFBvc3NpYmxlU2NvdXRzKTtcbiAgICAgICAgXy5lYWNoKHNjb3V0VG9Kb2luTGVnaW9uTW92ZXMsIG1vdmUgPT4ge1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbW92ZS5zb3VyY2VSZWdpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBtb3ZlLmRlc3RSZWdpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBfLnRha2UoXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5yZWdpb25zQnlJZFttb3ZlLnNvdXJjZVJlZ2lvbklkXS5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbW92ZS5udW1Nb3ZlZClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc2NvdXRzVG9SZXZlYWwgPSB0aGlzLmdldFNjb3V0c1RvUmV2ZWFsKHN0YXRlKTtcbiAgICAgICAgXy5lYWNoKHNjb3V0c1RvUmV2ZWFsLCBzY291dCA9PiB7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgUmV2ZWFsUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUywgcmVnaW9uSWQ6IHNjb3V0LnJlZ2lvbklkLCBjb3VudDogc2NvdXQuaGlkZGVuQ291bnQgfSk7XG4gICAgICAgICAgICBfLmVhY2goc2NvdXQucGllY2VzVG9TY291dCwgKHBpZWNlc0ZvckZhY3Rpb24sIGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgICAgIFNjb3V0UGllY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBmYWN0aW9uSWQsIHJlZ2lvbklkOiBzY291dC5yZWdpb25JZCwgcGllY2VzOiBwaWVjZXNGb3JGYWN0aW9uIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZWZmZWN0aXZlO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQb3NzaWJsZVNjb3V0cyhzdGF0ZSwgbW9kaWZpZXJzLCByZWdpb25zV2l0aFN1cHBseSwgc2NvdXRSZXN1bHRzKSB7XG5cbiAgICAgICAgcmV0dXJuIF8oc2NvdXRSZXN1bHRzKS5zaHVmZmxlKCkubWFwKChzY291dCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzY291dCxcbiAgICAgICAgICAgICAgICBudW1BdXhpbGlhQ2FuTW92ZUZvclN1cHBseTogdGhpcy5kZXRlcm1pbmVOdW1BdXhpbGlhQ2FuTW92ZShzdGF0ZSwgc2NvdXQucmVnaW9uLCByZWdpb25zV2l0aFN1cHBseSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHBlcm11dGUocGVybXV0YXRpb24pIHtcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gcGVybXV0YXRpb24ubGVuZ3RoO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBbcGVybXV0YXRpb24uc2xpY2UoKV07XG4gICAgICAgIGxldCBjID0gbmV3IEFycmF5KGxlbmd0aCkuZmlsbCgwKTtcbiAgICAgICAgbGV0IGkgPSAxO1xuICAgICAgICBsZXQgaztcbiAgICAgICAgbGV0IHA7XG5cbiAgICAgICAgd2hpbGUgKGkgPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChjW2ldIDwgaSkge1xuICAgICAgICAgICAgICAgIGsgPSBpICUgMiAmJiBjW2ldO1xuICAgICAgICAgICAgICAgIHAgPSBwZXJtdXRhdGlvbltpXTtcbiAgICAgICAgICAgICAgICBwZXJtdXRhdGlvbltpXSA9IHBlcm11dGF0aW9uW2tdO1xuICAgICAgICAgICAgICAgIHBlcm11dGF0aW9uW2tdID0gcDtcbiAgICAgICAgICAgICAgICArK2NbaV07XG4gICAgICAgICAgICAgICAgaSA9IDE7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocGVybXV0YXRpb24uc2xpY2UoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjW2ldID0gMDtcbiAgICAgICAgICAgICAgICArK2k7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBzdGF0aWMgY2FydGVzaWFuUHJvZHVjdChhcnIpIHtcbiAgICAgICAgcmV0dXJuIGFyci5yZWR1Y2UoKGEsIGIpID0+IGEubWFwKHggPT4gYi5tYXAoeSA9PiB4LmNvbmNhdCh5KSkpLnJlZHVjZSgoYSwgYikgPT4gYS5jb25jYXQoYiksIFtdKSwgW1tdXSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNjb3V0Rm9yU3VwcGx5TW92ZXMoc3RhdGUsIHBvc3NpYmxlU2NvdXRzLCByZWdpb25zQWRqYWNlbnRXaXRoTnVtTmVlZGVkLCBudW1SZWdpb25zV2l0aFN1cHBseSkge1xuXG4gICAgICAgIC8vIFRoaXMgbWF5IGNhcCBvdXQgYXQgYWJvdXQgNiB2YWxpZCBhZGphY2VudCByZWdpb25zIHBlciBvcmlnaW4gZHVlIHRvIHRoZSBmYWN0b3JpYWwgZ3Jvd3RoIG9mIHBlcm11dGF0aW9uLFxuICAgICAgICAvLyB0aG91Z2ggaW4gcHJhY3RpY2UgbWFueSBhcmUgY3VsbGVkIGJlZm9yZSBhbmQgYWZ0ZXIgcGVybXV0aW5nLlxuICAgICAgICBjb25zdCBhbGxDb21iaW5hdGlvbnMgPSBfKHBvc3NpYmxlU2NvdXRzKS5tYXAocG9zc2libGVTY291dCA9PiB7XG4gICAgICAgICAgICBpZiAocG9zc2libGVTY291dC5udW1BdXhpbGlhQ2FuTW92ZUZvclN1cHBseSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdmFsaWRNb3ZlUmVnaW9ucyA9IF8ocG9zc2libGVTY291dC5zY291dC5tb3ZlUmVnaW9ucykubWFwKHJlZ2lvbiA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8uZmluZChyZWdpb25zQWRqYWNlbnRXaXRoTnVtTmVlZGVkLCBhZGphY2VudCA9PiBhZGphY2VudC5yZWdpb24uaWQgPT09IHJlZ2lvbi5pZCk7XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcblxuICAgICAgICAgICAgaWYgKHZhbGlkTW92ZVJlZ2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBwZXJtdXRhdGlvbnMgPSB0aGlzLnBlcm11dGUodmFsaWRNb3ZlUmVnaW9ucyk7XG5cbiAgICAgICAgICAgIC8vIEZpbGwgZXZlcnkgcGVybXV0YXRpb24gc3RhcnRpbmcgZnJvbSB0aGUgZmlyc3QgcmVnaW9uIGFuZCBmaWxsaW5nIGNvbXBsZXRlbHkgYXMgbWFueSBhcyBwb3NzaWJsZVxuICAgICAgICAgICAgLy8gQ3VsbCBub24tdW5pcXVlIGNvbWJpbmF0aW9uc1xuICAgICAgICAgICAgcmV0dXJuIF8ocGVybXV0YXRpb25zKS5tYXAoZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBudW1SZW1haW5pbmcgPSBwb3NzaWJsZVNjb3V0Lm51bUF1eGlsaWFDYW5Nb3ZlRm9yU3VwcGx5O1xuICAgICAgICAgICAgICAgIHJldHVybiBfKGVudHJ5KS5tYXAobW92ZVJlZ2lvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bVRvTW92ZSA9IE1hdGgubWluKG1vdmVSZWdpb24ubnVtQXV4aWxpYUZvclN1cHBseSwgbnVtUmVtYWluaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bVRvTW92ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG51bVJlbWFpbmluZyAtPSBudW1Ub01vdmU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogcG9zc2libGVTY291dC5zY291dC5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQ6IG1vdmVSZWdpb24ucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtTmVlZGVkOiBtb3ZlUmVnaW9uLm51bUF1eGlsaWFGb3JTdXBwbHksXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1Nb3ZlZDogbnVtVG9Nb3ZlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdkZXN0UmVnaW9uSWQnKS52YWx1ZSgpO1xuICAgICAgICAgICAgfSkudW5pcUJ5KGVudHJ5ID0+IF8ucmVkdWNlKGVudHJ5LCAoa2V5LCBkYXRhKSA9PiB7IHJldHVybiBrZXkgKyBkYXRhLmRlc3RSZWdpb25JZCArIGRhdGEubnVtTW92ZWQ7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJycpKS52YWx1ZSgpO1xuXG4gICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgIC8vIE9rIGF0IHRoaXMgcG9pbnQgd2UgaGF2ZSBldmVyeSBjb21iaW5hdGlvbiBvZiBmaWxsaW5nIGFkamFjZW50IHJlZ2lvbnMgZm9yIGVhY2ggcG9zc2libGUgc3RhcnRpbmcgc2NvdXQgcmVnaW9uXG4gICAgICAgIC8vIE5vdyB3ZSBoYXZlIHRvIGZpbmQgdGhlIGNhcnRlc2lhbiBwcm9kdWN0XG4gICAgICAgIGNvbnN0IGNhcnRlc2lhblByb2R1Y3QgPSB0aGlzLmNhcnRlc2lhblByb2R1Y3QoYWxsQ29tYmluYXRpb25zKTtcbiAgICAgICAgY29uc3Qgc3VtbWVkQ29tYmluYXRpb25zID0gXyhjYXJ0ZXNpYW5Qcm9kdWN0KS5tYXAoZW50cnkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFyZ2lucyA9IF8oZW50cnkpLmdyb3VwQnkoJ2Rlc3RSZWdpb25JZCcpLm1hcCgobW92ZXMsIHJlZ2lvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3VtID0gXy5yZWR1Y2UobW92ZXMsIChzdW0sIG1vdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIG1vdmUubnVtTW92ZWQ7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzdXBwbHlNYXJnaW4gPSBzdW0gLSBtb3Zlc1swXS5udW1OZWVkZWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHN1cHBseU1hcmdpbixcbiAgICAgICAgICAgICAgICAgICAgc3VwcGxpZWQ6IHN1cHBseU1hcmdpbiA+PSAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmlsdGVyKHtzdXBwbGllZDogdHJ1ZX0pLnNvcnRCeSgncmVnaW9uSWQnKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG1vdmVzOiBlbnRyeSxcbiAgICAgICAgICAgICAgICBtYXJnaW5zOiBtYXJnaW5zLFxuICAgICAgICAgICAgICAgIG51bVN1cHBsaWVkOiBtYXJnaW5zLmxlbmd0aFxuICAgICAgICAgICAgfVxuICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIC8vIEdldCB0aGUgdW5pcXVlIGNvbWJpbmF0aW9ucyBvZiBzdXBwbGllZCwgZmF2b3Jpbmcgb25lcyB0aGF0IHVzZSB0aGUgbGVhc3QgZXh0cmEgcGllY2VzXG4gICAgICAgIGNvbnN0IGZpbmFsQ2FuZGlkYXRlcyA9IF8oc3VtbWVkQ29tYmluYXRpb25zKS5vcmRlckJ5KGdyb3VwID0+IF8ucmVkdWNlKGdyb3VwLm1hcmdpbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdW0sIG1hcmdpbikgPT4geyByZXR1cm4gbWFyZ2luLnN1cHBsaWVkID8gc3VtICsgbWFyZ2luLnN1cHBseU1hcmdpbiA6IHN1bSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwKSkudW5pcUJ5KFxuICAgICAgICAgICAgZ3JvdXAgPT4gXy5yZWR1Y2UoZ3JvdXAubWFyZ2lucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChrZXksIG1hcmdpbikgPT4geyByZXR1cm4ga2V5ICsgbWFyZ2luLnJlZ2lvbklkICsgKG1hcmdpbi5zdXBwbGllZCA/ICcxJyA6ICcwJyk7IH0pKS52YWx1ZSgpO1xuXG4gICAgICAgIC8vIE5vdywgZmluYWxseSBjYWxjdWxhdGUgdGhlIG1vc3Qgc3VwcGxpZWQgcmVnaW9ucyBhcyBhIHJlc3VsdFxuICAgICAgICBjb25zdCBzb2x1dGlvbiA9IF8oZmluYWxDYW5kaWRhdGVzKS5zaHVmZmxlKCkubWFwKGdyb3VwID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG51bVN1cHBsaWVkQWZ0ZXIgPSB0aGlzLnJlZ2lvbnNXaXRoU3VwcGx5KHN0YXRlLCBbXSwgXyhncm91cC5tYXJnaW5zKS5maWx0ZXIoJ3N1cHBsaWVkJykubWFwKFxuICAgICAgICAgICAgICAgICAgICAncmVnaW9uSWQnKS52YWx1ZSgpKS5sZW5ndGggLSBudW1SZWdpb25zV2l0aFN1cHBseTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZ3JvdXAsXG4gICAgICAgICAgICAgICAgbnVtU3VwcGxpZWRBZnRlclxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5zb3J0QnkoJ251bVN1cHBsaWVkQWZ0ZXInKS5maWx0ZXIoZW50cnkgPT4gZW50cnkubnVtU3VwcGxpZWRBZnRlciA+IDApLnJldmVyc2UoKS5tYXAoJ2dyb3VwJykuZmlyc3QoKTtcblxuICAgICAgICBpZiAoIXNvbHV0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YXJnZXRSZWdpb25JZHMgPSBfLm1hcChzb2x1dGlvbi5tYXJnaW5zLCAncmVnaW9uSWQnKTtcbiAgICAgICAgcmV0dXJuIF8oc29sdXRpb24ubW92ZXMpLmZpbHRlcihtb3ZlID0+IF8uaW5kZXhPZih0YXJnZXRSZWdpb25JZHMsIG1vdmUuZGVzdFJlZ2lvbklkKSA+PSAwKS5ncm91cEJ5KFxuICAgICAgICAgICAgJ3NvdXJjZVJlZ2lvbklkJykudmFsdWVzKCkuZmxhdHRlbigpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNjb3V0VG9Kb2luTGVnaW9uTW92ZXMoc3RhdGUsIHNjb3V0cykge1xuICAgICAgICByZXR1cm4gXyhzY291dHMpLmZpbHRlcihzY291dCA9PiBzY291dC5udW1BdXhpbGlhQ2FuTW92ZUZvclN1cHBseSA+IDApLm1hcChzY291dCA9PiB7XG5cbiAgICAgICAgICAgIGlmIChzY291dC5zY291dC5yZWdpb24uZ2V0TGVnaW9ucygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFJlZ2lvbklkID0gXyhzY291dC5zY291dC5tb3ZlUmVnaW9ucykucmVkdWNlKChhY2N1bXVsYXRvciwgcmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtTGVnaW9ucyA9IHJlZ2lvbi5nZXRMZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChudW1MZWdpb25zID4gYWNjdW11bGF0b3IubnVtTGVnaW9ucykge1xuICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci50YXJnZXQgPSByZWdpb24uaWQ7XG4gICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLm51bUxlZ2lvbnMgPSBudW1MZWdpb25zO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICAgICAgICB9LCB7dGFyZ2V0OiBudWxsLCBudW1MZWdpb25zOiAwfSkudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAoIXRhcmdldFJlZ2lvbklkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBzY291dC5zY291dC5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiB0YXJnZXRSZWdpb25JZCxcbiAgICAgICAgICAgICAgICBudW1Nb3ZlZDogc2NvdXQubnVtQXV4aWxpYUNhbk1vdmVGb3JTdXBwbHlcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0U2NvdXRzVG9SZXZlYWwoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8odGhpcy5nZXRTY291dFJlZ2lvbnMoc3RhdGUpKS5tYXAocmVnaW9uID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG15SGlkZGVuID0gcmVnaW9uLmdldEhpZGRlbldhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyk7XG4gICAgICAgICAgICBpZihteUhpZGRlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgY29uc3QgcGllY2VzID0gXyhyZWdpb24ucGllY2VzKCkpLmZpbHRlcihcbiAgICAgICAgICAgICAgICBwaWVjZSA9PiBwaWVjZS5mYWN0aW9uSWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TICYmIHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyAmJiAhcGllY2Uuc2NvdXRlZCgpKS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgcGllY2UgPT4gKChzdGF0ZS5mcm9zdCgpICYmIHBpZWNlLmZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMpID8gJ2EnIDogJ2InKSArICghcGllY2UucmV2ZWFsZWQoKSA/ICcxJyA6ICcyJykpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgIGlmKHBpZWNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICBoaWRkZW5Db3VudDogTWF0aC5taW4obXlIaWRkZW4ubGVuZ3RoLCBwaWVjZXMubGVuZ3RoKSxcbiAgICAgICAgICAgICAgICBwaWVjZXNUb1Njb3V0OiBfKHBpZWNlcykudGFrZShteUhpZGRlbi5sZW5ndGgpLmdyb3VwQnkoJ2ZhY3Rpb25JZCcpLnZhbHVlKClcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgcmVnaW9uc1dpdGhTdXBwbHkoc3RhdGUsIGludmFsaWRSZWdpb24sIHZhbGlkUmVnaW9ucykge1xuICAgICAgICBjb25zdCBub25QbGF5ZXJBZWR1aSA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BRURVSV0uaXNOb25QbGF5ZXI7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgIHJlZ2lvbiA9PiByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoID4gMCkuZmlsdGVyKFxuICAgICAgICAgICAgcmVnaW9uID0+IHJlZ2lvbi5oYXNWYWxpZFN1cHBseUxpbmUoRmFjdGlvbklEcy5ST01BTlMsIChub25QbGF5ZXJBZWR1aSA/IFtGYWN0aW9uSURzLkFFRFVJXSA6IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uY29tcGFjdChbaW52YWxpZFJlZ2lvbl0pLCB2YWxpZFJlZ2lvbnMpKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyByZWdpb25zV2l0aG91dFN1cHBseShzdGF0ZSkge1xuICAgICAgICBjb25zdCBub25QbGF5ZXJBZWR1aSA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BRURVSV0uaXNOb25QbGF5ZXI7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgIHJlZ2lvbiA9PiByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoID4gMCkucmVqZWN0KFxuICAgICAgICAgICAgcmVnaW9uID0+IHJlZ2lvbi5oYXNWYWxpZFN1cHBseUxpbmUoRmFjdGlvbklEcy5ST01BTlMsIChub25QbGF5ZXJBZWR1aSA/IFtGYWN0aW9uSURzLkFFRFVJXSA6IFtdKSkpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRldGVybWluZU51bUF1eGlsaWFDYW5Nb3ZlKHN0YXRlLCByZWdpb24sIHN1cHBsaWVkUmVnaW9ucykge1xuICAgICAgICBjb25zdCBtYXhFbmVteU1hcmdpbiA9IHJlZ2lvbi5nZXRNYXhFbmVteUNvbnRyb2xsaW5nTWFyZ2luKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgY29uc3QgbnVtQXV4aWxpYSA9IHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpLmxlbmd0aDtcbiAgICAgICAgaWYgKG1heEVuZW15TWFyZ2luID09PSAtOTkgfHwgbWF4RW5lbXlNYXJnaW4gPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVtQXV4aWxpYTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBudW1Gb3JFbmVteUNvbnRyb2wgPSBNYXRoLmFicyhtYXhFbmVteU1hcmdpbikgKyAxO1xuICAgICAgICBpZiAobnVtRm9yRW5lbXlDb250cm9sIDw9IG51bUF1eGlsaWEpIHtcbiAgICAgICAgICAgIGNvbnN0IG51bVN1cHBsaWVkQWZ0ZXJFbmVteUNvbnRyb2wgPSB0aGlzLnJlZ2lvbnNXaXRoU3VwcGx5KHN0YXRlLCByZWdpb24uaWQpLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChudW1TdXBwbGllZEFmdGVyRW5lbXlDb250cm9sID09PSBzdXBwbGllZFJlZ2lvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bUF1eGlsaWE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gTWF0aC5taW4obnVtRm9yRW5lbXlDb250cm9sIC0gMSwgbnVtQXV4aWxpYSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNjb3V0UmVnaW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBsZWFkZXJSZWdpb24gPSB0aGlzLmZpbmRMZWFkZXJSZWdpb24oc3RhdGUpO1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5maWx0ZXIocmVnaW9uID0+IHRoaXMud2l0aGluUmFuZ2VPZkxlYWRlcihyZWdpb24sIGxlYWRlclJlZ2lvbikpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHdpdGhpblJhbmdlT2ZMZWFkZXIocmVnaW9uLCBsZWFkZXJSZWdpb24pIHtcbiAgICAgICAgaWYgKCFsZWFkZXJSZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxlYWRlciA9IGxlYWRlclJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKTtcblxuICAgICAgICByZXR1cm4gcmVnaW9uLmlkID09PSBsZWFkZXJSZWdpb24uaWQgfHwgKCFsZWFkZXIuaXNTdWNjZXNzb3IoKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZmluZChsZWFkZXJSZWdpb24uYWRqYWNlbnQsIGFkamFjZW50ID0+IHJlZ2lvbi5pZCA9PT0gYWRqYWNlbnQuaWQpKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZExlYWRlclJlZ2lvbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXy5maW5kKHN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBfLmZpbmQocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuUk9NQU5TXSwge3R5cGU6ICdsZWFkZXInfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUm9tYW5TY291dFxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hblNjb3V0LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFFQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBREE7QUFHQTtBQUNBO0FBQUE7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _enlistResults = __webpack_require__(155);\n\nvar _enlistResults2 = _interopRequireDefault(_enlistResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Enlist = function (_Command) {\n    _inherits(Enlist, _Command);\n\n    function Enlist() {\n        _classCallCheck(this, Enlist);\n\n        return _possibleConstructorReturn(this, (Enlist.__proto__ || Object.getPrototypeOf(Enlist)).apply(this, arguments));\n    }\n\n    _createClass(Enlist, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            var leaderRegion = this.findLeaderRegion(state);\n            if (!leaderRegion) {\n                return false;\n            }\n\n            var validGermanicRegionIds = this.findValidGermanicRegions(state);\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.BELGAE);\n            var isAmbiorix = leader && !leader.isSuccessor();\n            var validRegionIds = isAmbiorix ? (0, _lodash2.default)(leaderRegion.adjacent).concat([leaderRegion]).map('id').value() : [leaderRegion];\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var isValidRegion = _lodash2.default.indexOf(validRegionIds, region.id) >= 0;\n                if (!isValidRegion) {\n                    return;\n                }\n                var germanicPieces = region.piecesByFaction()[_factionIds2.default.GERMANIC_TRIBES];\n                if (!germanicPieces || _lodash2.default.indexOf(validGermanicRegionIds, region.id) < 0) {\n                    return;\n                }\n\n                var enemyFactions = (0, _lodash2.default)(_factionIds2.default).filter(function (factionId) {\n                    return _this2.isValidEnemyFaction(region, factionId);\n                }).value();\n                return new _enlistResults2.default({\n                    region: region,\n                    germanicPieces: germanicPieces,\n                    enemyFactions: enemyFactions\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            var enlist = args.enlist;\n            console.log('*** Belgae Enlisting Germans in ' + enlist.region.name);\n        }\n    }, {\n        key: 'isValidEnemyFaction',\n        value: function isValidEnemyFaction(region, factionId) {\n            if (factionId === _factionIds2.default.GERMANIC_TRIBES || factionId === _factionIds2.default.BELGAE) {\n                return false;\n            }\n\n            return (region.piecesByFaction()[factionId] || []).length > 0;\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_factionIds2.default.BELGAE], { type: 'leader' });\n            });\n        }\n    }, {\n        key: 'findValidGermanicRegions',\n        value: function findValidGermanicRegions(state) {\n            return (0, _lodash2.default)(state.regions).filter(function (region) {\n                if (region.group === _regionGroups2.default.GERMANIA) {\n                    return true;\n                }\n\n                var germaniaAdjacent = [_regionIds2.default.MENAPII, _regionIds2.default.NERVII, _regionIds2.default.TREVERI, _regionIds2.default.SEQUANI];\n                if (_lodash2.default.indexOf(germaniaAdjacent, region.id) >= 0) {\n                    return true;\n                }\n\n                return (region.piecesByFaction()[_factionIds2.default.GERMANIC_TRIBES] || []).length > 0;\n            }).map('id').value();\n        }\n    }]);\n\n    return Enlist;\n}(_command2.default);\n\nexports.default = Enlist;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYmVsZ2FlL2VubGlzdC5qcz8xNjI1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi8uLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBFbmxpc3RSZXN1bHRzIGZyb20gJy4vZW5saXN0UmVzdWx0cyc7XG5cbmNsYXNzIEVubGlzdCBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBsZWFkZXJSZWdpb24gPSB0aGlzLmZpbmRMZWFkZXJSZWdpb24oc3RhdGUpO1xuICAgICAgICBpZiAoIWxlYWRlclJlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdmFsaWRHZXJtYW5pY1JlZ2lvbklkcyA9IHRoaXMuZmluZFZhbGlkR2VybWFuaWNSZWdpb25zKHN0YXRlKTtcbiAgICAgICAgY29uc3QgbGVhZGVyID0gbGVhZGVyUmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5CRUxHQUUpO1xuICAgICAgICBjb25zdCBpc0FtYmlvcml4ID0gbGVhZGVyICYmICFsZWFkZXIuaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgY29uc3QgdmFsaWRSZWdpb25JZHMgPSBpc0FtYmlvcml4ID8gXyhsZWFkZXJSZWdpb24uYWRqYWNlbnQpLmNvbmNhdChbbGVhZGVyUmVnaW9uXSkubWFwKCdpZCcpLnZhbHVlKCkgOiBbbGVhZGVyUmVnaW9uXTtcblxuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNWYWxpZFJlZ2lvbiA9IF8uaW5kZXhPZih2YWxpZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA+PSAwO1xuICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZFJlZ2lvbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGdlcm1hbmljUGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXTtcbiAgICAgICAgICAgICAgICBpZighZ2VybWFuaWNQaWVjZXMgfHwgXy5pbmRleE9mKHZhbGlkR2VybWFuaWNSZWdpb25JZHMsIHJlZ2lvbi5pZCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBlbmVteUZhY3Rpb25zID0gXyhGYWN0aW9uSURzKS5maWx0ZXIoKGZhY3Rpb25JZCkgPT4gdGhpcy5pc1ZhbGlkRW5lbXlGYWN0aW9uKHJlZ2lvbiwgZmFjdGlvbklkKSkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVubGlzdFJlc3VsdHMoXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlcm1hbmljUGllY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlGYWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvRXhlY3V0ZShzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBlbmxpc3QgPSBhcmdzLmVubGlzdDtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBCZWxnYWUgRW5saXN0aW5nIEdlcm1hbnMgaW4gJyArIGVubGlzdC5yZWdpb24ubmFtZSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzVmFsaWRFbmVteUZhY3Rpb24ocmVnaW9uLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgaWYgKGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSB8fCBbXSkubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZExlYWRlclJlZ2lvbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXy5maW5kKFxuICAgICAgICAgICAgc3RhdGUucmVnaW9ucywgZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmQocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXSwge3R5cGU6ICdsZWFkZXInfSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZFZhbGlkR2VybWFuaWNSZWdpb25zKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAocmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuR0VSTUFOSUEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZ2VybWFuaWFBZGphY2VudCA9IFtSZWdpb25JRHMuTUVOQVBJSSwgUmVnaW9uSURzLk5FUlZJSSwgUmVnaW9uSURzLlRSRVZFUkksIFJlZ2lvbklEcy5TRVFVQU5JXTtcbiAgICAgICAgICAgICAgICBpZiAoXy5pbmRleE9mKGdlcm1hbmlhQWRqYWNlbnQsIHJlZ2lvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU10gfHwgW10pLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB9KS5tYXAoJ2lkJykudmFsdWUoKTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRW5saXN0O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9iZWxnYWUvZW5saXN0LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _rampageResults = __webpack_require__(156);\n\nvar _rampageResults2 = _interopRequireDefault(_rampageResults);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Rampage = function (_Command) {\n    _inherits(Rampage, _Command);\n\n    function Rampage() {\n        _classCallCheck(this, Rampage);\n\n        return _possibleConstructorReturn(this, (Rampage.__proto__ || Object.getPrototypeOf(Rampage)).apply(this, arguments));\n    }\n\n    _createClass(Rampage, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            var leaderRegion = this.findLeaderRegion(state);\n            if (!leaderRegion) {\n                return [];\n            }\n\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.BELGAE);\n            var isAmbiorix = leader && !leader.isSuccessor();\n            var validRegionIds = isAmbiorix ? (0, _lodash2.default)(leaderRegion.adjacent).concat([leaderRegion]).map('id').value() : [leaderRegion];\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var isValidRegion = _lodash2.default.indexOf(validRegionIds, region.id) >= 0;\n                var hiddenWarbands = region.getHiddenPiecesForFaction(_factionIds2.default.BELGAE);\n                if (hiddenWarbands.length === 0 || !isValidRegion) {\n                    return;\n                }\n\n                var enemyFactions = (0, _lodash2.default)(_factionIds2.default).filter(function (factionId) {\n                    return _this2.isValidEnemyFaction(region, factionId);\n                }).value();\n\n                if (enemyFactions.length > 0) {\n                    return new _rampageResults2.default({\n                        region: region,\n                        hiddenWarbands: hiddenWarbands,\n                        enemyFactions: enemyFactions\n                    });\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            var rampage = args.rampage;\n            var mobileEnemyPieces = rampage.region.getMobilePiecesForFaction(rampage.chosenFaction);\n            var enemyPlayer = state.playersByFaction[rampage.chosenFaction];\n            var piecesToRetreatOrRemove = _lodash2.default.take(_losses2.default.orderPiecesForRemoval(state, mobileEnemyPieces, false), rampage.count);\n\n            console.log('*** Belgae Rampaging in ' + rampage.region.name);\n\n            _revealPieces2.default.execute(state, { factionId: _factionIds2.default.BELGAE, regionId: rampage.region.id, count: rampage.count });\n            enemyPlayer.retreatPieces(state, rampage.region, piecesToRetreatOrRemove, rampage.agreeingFactionId);\n        }\n    }, {\n        key: 'isValidEnemyFaction',\n        value: function isValidEnemyFaction(region, factionId) {\n            if (factionId === _factionIds2.default.GERMANIC_TRIBES || factionId === _factionIds2.default.BELGAE) {\n                return false;\n            }\n\n            var groupedPieces = _lodash2.default.groupBy(region.piecesByFaction()[factionId], 'type');\n\n            if (!groupedPieces.warband && !groupedPieces.auxilia && !groupedPieces.legion) {\n                return false;\n            }\n\n            return !groupedPieces.leader && !groupedPieces.citadel && !groupedPieces.fort;\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_factionIds2.default.BELGAE], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return Rampage;\n}(_command2.default);\n\nexports.default = Rampage;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYmVsZ2FlL3JhbXBhZ2UuanM/ZWIwZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kIGZyb20gJy4uL2NvbW1hbmQnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJhbXBhZ2VSZXN1bHRzIGZyb20gJy4vcmFtcGFnZVJlc3VsdHMnO1xuaW1wb3J0IFJldmVhbFBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JldmVhbFBpZWNlcyc7XG5pbXBvcnQgTG9zc2VzIGZyb20gJ2ZhbGxpbmdza3kvdXRpbC9sb3NzZXMnO1xuXG5jbGFzcyBSYW1wYWdlIGV4dGVuZHMgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IGxlYWRlclJlZ2lvbiA9IHRoaXMuZmluZExlYWRlclJlZ2lvbihzdGF0ZSk7XG4gICAgICAgIGlmICghbGVhZGVyUmVnaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsZWFkZXIgPSBsZWFkZXJSZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLkJFTEdBRSk7XG4gICAgICAgIGNvbnN0IGlzQW1iaW9yaXggPSBsZWFkZXIgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICBjb25zdCB2YWxpZFJlZ2lvbklkcyA9IGlzQW1iaW9yaXggPyBfKGxlYWRlclJlZ2lvbi5hZGphY2VudCkuY29uY2F0KFtsZWFkZXJSZWdpb25dKS5tYXAoJ2lkJykudmFsdWUoKSA6IFtsZWFkZXJSZWdpb25dO1xuXG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkUmVnaW9uID0gXy5pbmRleE9mKHZhbGlkUmVnaW9uSWRzLCByZWdpb24uaWQpID49IDA7XG4gICAgICAgICAgICAgICAgY29uc3QgaGlkZGVuV2FyYmFuZHMgPSByZWdpb24uZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkJFTEdBRSk7XG4gICAgICAgICAgICAgICAgaWYoaGlkZGVuV2FyYmFuZHMubGVuZ3RoID09PSAwIHx8ICFpc1ZhbGlkUmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBlbmVteUZhY3Rpb25zID0gXyhGYWN0aW9uSURzKS5maWx0ZXIoKGZhY3Rpb25JZCkgPT4gdGhpcy5pc1ZhbGlkRW5lbXlGYWN0aW9uKHJlZ2lvbiwgZmFjdGlvbklkKSkudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgIGlmKGVuZW15RmFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJhbXBhZ2VSZXN1bHRzKFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW5XYXJiYW5kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteUZhY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZG9FeGVjdXRlKHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IHJhbXBhZ2UgPSBhcmdzLnJhbXBhZ2U7XG4gICAgICAgIGNvbnN0IG1vYmlsZUVuZW15UGllY2VzID0gcmFtcGFnZS5yZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihyYW1wYWdlLmNob3NlbkZhY3Rpb24pO1xuICAgICAgICBjb25zdCBlbmVteVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bcmFtcGFnZS5jaG9zZW5GYWN0aW9uXTtcbiAgICAgICAgY29uc3QgcGllY2VzVG9SZXRyZWF0T3JSZW1vdmUgPSBfLnRha2UoTG9zc2VzLm9yZGVyUGllY2VzRm9yUmVtb3ZhbChzdGF0ZSwgbW9iaWxlRW5lbXlQaWVjZXMsIGZhbHNlKSwgcmFtcGFnZS5jb3VudCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBCZWxnYWUgUmFtcGFnaW5nIGluICcgKyByYW1wYWdlLnJlZ2lvbi5uYW1lKTtcblxuICAgICAgICBSZXZlYWxQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5CRUxHQUUsIHJlZ2lvbklkOiByYW1wYWdlLnJlZ2lvbi5pZCwgY291bnQ6IHJhbXBhZ2UuY291bnR9KTtcbiAgICAgICAgZW5lbXlQbGF5ZXIucmV0cmVhdFBpZWNlcyhzdGF0ZSwgcmFtcGFnZS5yZWdpb24sIHBpZWNlc1RvUmV0cmVhdE9yUmVtb3ZlLCByYW1wYWdlLmFncmVlaW5nRmFjdGlvbklkKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNWYWxpZEVuZW15RmFjdGlvbihyZWdpb24sIGZhY3Rpb25JZCkge1xuICAgICAgICBpZihmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTIHx8IGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5CRUxHQUUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGdyb3VwZWRQaWVjZXMgPSBfLmdyb3VwQnkocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0sICd0eXBlJyk7XG5cbiAgICAgICAgaWYoIWdyb3VwZWRQaWVjZXMud2FyYmFuZCAmJiAhZ3JvdXBlZFBpZWNlcy5hdXhpbGlhICYmICFncm91cGVkUGllY2VzLmxlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICFncm91cGVkUGllY2VzLmxlYWRlciAmJiAhZ3JvdXBlZFBpZWNlcy5jaXRhZGVsICYmICFncm91cGVkUGllY2VzLmZvcnQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRMZWFkZXJSZWdpb24oc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChzdGF0ZS5yZWdpb25zLCBmdW5jdGlvbihyZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBfLmZpbmQocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXSwgeyB0eXBlIDogJ2xlYWRlcicgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBSYW1wYWdlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9iZWxnYWUvcmFtcGFnZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7Ozs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _tribe = __webpack_require__(96);\n\nvar _tribe2 = _interopRequireDefault(_tribe);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Definitions = {};\n\nDefinitions[_tribeIds2.default.AEDUI] = {\n    id: _tribeIds2.default.AEDUI,\n    regionId: _regionIds2.default.AEDUI,\n    name: 'Aedui',\n    isCity: true,\n    factionRestriction: 'Aedui'\n\n};\n\nDefinitions[_tribeIds2.default.ARVERNI] = {\n    id: _tribeIds2.default.ARVERNI,\n    regionId: _regionIds2.default.ARVERNI,\n    name: 'Arverni',\n    isCity: true,\n    factionRestriction: 'Arverni'\n};\n\nDefinitions[_tribeIds2.default.ATREBATES] = {\n    id: _tribeIds2.default.ATREBATES,\n    regionId: _regionIds2.default.ATREBATES,\n    name: 'Atrebates'\n};\n\nDefinitions[_tribeIds2.default.AULERCI] = {\n    id: _tribeIds2.default.AULERCI,\n    regionId: _regionIds2.default.CARNUTES,\n    name: 'Aulerci'\n};\n\nDefinitions[_tribeIds2.default.BELLOVACI] = {\n    id: _tribeIds2.default.BELLOVACI,\n    regionId: _regionIds2.default.ATREBATES,\n    name: 'Bellovaci'\n};\n\nDefinitions[_tribeIds2.default.BITURIGES] = {\n    id: _tribeIds2.default.BITURIGES,\n    regionId: _regionIds2.default.BITURIGES,\n    name: 'Bituriges',\n    isCity: true\n};\n\nDefinitions[_tribeIds2.default.CADURCI] = {\n    id: _tribeIds2.default.CADURCI,\n    regionId: _regionIds2.default.ARVERNI,\n    name: 'Cadurci'\n};\n\nDefinitions[_tribeIds2.default.CARNUTES] = {\n    id: _tribeIds2.default.CARNUTES,\n    regionId: _regionIds2.default.CARNUTES,\n    name: 'Carnutes',\n    isCity: true\n};\n\nDefinitions[_tribeIds2.default.CATUVELLAUNI] = {\n    id: _tribeIds2.default.CATUVELLAUNI,\n    regionId: _regionIds2.default.BRITANNIA,\n    name: 'Catuvellauni'\n};\n\nDefinitions[_tribeIds2.default.COLONY] = {\n    id: _tribeIds2.default.COLONY,\n    regionId: null,\n    name: 'Colony'\n};\n\nDefinitions[_tribeIds2.default.EBURONES] = {\n    id: _tribeIds2.default.EBURONES,\n    regionId: _regionIds2.default.NERVII,\n    name: 'Eburones'\n};\n\nDefinitions[_tribeIds2.default.HELVETII] = {\n    id: _tribeIds2.default.HELVETII,\n    regionId: _regionIds2.default.SEQUANI,\n    name: 'Helvetii'\n};\n\nDefinitions[_tribeIds2.default.HELVII] = {\n    id: _tribeIds2.default.HELVII,\n    regionId: _regionIds2.default.PROVINCIA,\n    name: 'Helvii'\n};\n\nDefinitions[_tribeIds2.default.LINGONES] = {\n    id: _tribeIds2.default.LINGONES,\n    regionId: _regionIds2.default.MANDUBII,\n    name: 'Lingones'\n};\n\nDefinitions[_tribeIds2.default.MANDUBII] = {\n    id: _tribeIds2.default.MANDUBII,\n    regionId: _regionIds2.default.MANDUBII,\n    name: 'Mandubii',\n    isCity: true\n};\n\nDefinitions[_tribeIds2.default.MENAPII] = {\n    id: _tribeIds2.default.MENAPII,\n    regionId: _regionIds2.default.MORINI,\n    name: 'Menapii'\n};\n\nDefinitions[_tribeIds2.default.MORINI] = {\n    id: _tribeIds2.default.MORINI,\n    regionId: _regionIds2.default.MORINI,\n    name: 'Morini'\n};\n\nDefinitions[_tribeIds2.default.NAMNETES] = {\n    id: _tribeIds2.default.NAMNETES,\n    regionId: _regionIds2.default.VENETI,\n    name: 'Namenetes'\n};\n\nDefinitions[_tribeIds2.default.NERVII] = {\n    id: _tribeIds2.default.NERVII,\n    regionId: _regionIds2.default.NERVII,\n    name: 'Nervii'\n};\n\nDefinitions[_tribeIds2.default.PICTONES] = {\n    id: _tribeIds2.default.PICTONES,\n    regionId: _regionIds2.default.PICTONES,\n    name: 'Pictones'\n};\n\nDefinitions[_tribeIds2.default.REMI] = {\n    id: _tribeIds2.default.REMI,\n    regionId: _regionIds2.default.ATREBATES,\n    name: 'Remi'\n};\n\nDefinitions[_tribeIds2.default.SANTONES] = {\n    id: _tribeIds2.default.SANTONES,\n    regionId: _regionIds2.default.PICTONES,\n    name: 'Santones'\n};\n\nDefinitions[_tribeIds2.default.SENONES] = {\n    id: _tribeIds2.default.SENONES,\n    regionId: _regionIds2.default.MANDUBII,\n    name: 'Senones'\n};\n\nDefinitions[_tribeIds2.default.SEQUANI] = {\n    id: _tribeIds2.default.SEQUANI,\n    regionId: _regionIds2.default.SEQUANI,\n    name: 'Sequani',\n    isCity: true\n};\n\nDefinitions[_tribeIds2.default.SUEBI_NORTH] = {\n    id: _tribeIds2.default.SUEBI_NORTH,\n    regionId: _regionIds2.default.SUGAMBRI,\n    name: 'Suebi (North)',\n    factionRestriction: 'Germanic'\n};\n\nDefinitions[_tribeIds2.default.SUEBI_SOUTH] = {\n    id: _tribeIds2.default.SUEBI_SOUTH,\n    regionId: _regionIds2.default.UBII,\n    name: 'Suebi (South)',\n    factionRestriction: 'Germanic'\n};\n\nDefinitions[_tribeIds2.default.SUGAMBRI] = {\n    id: _tribeIds2.default.SUGAMBRI,\n    regionId: _regionIds2.default.SUGAMBRI,\n    name: 'Sugambri'\n};\n\nDefinitions[_tribeIds2.default.TREVERI] = {\n    id: _tribeIds2.default.TREVERI,\n    regionId: _regionIds2.default.TREVERI,\n    name: 'Treveri'\n};\n\nDefinitions[_tribeIds2.default.UBII] = {\n    id: _tribeIds2.default.UBII,\n    regionId: _regionIds2.default.UBII,\n    name: 'Ubii'\n};\n\nDefinitions[_tribeIds2.default.VENETI] = {\n    id: _tribeIds2.default.VENETI,\n    regionId: _regionIds2.default.VENETI,\n    name: 'Veneti'\n};\n\nDefinitions[_tribeIds2.default.VOLCAE] = {\n    id: _tribeIds2.default.VOLCAE,\n    regionId: _regionIds2.default.ARVERNI,\n    name: 'Volcae'\n};\n\nvar Tribes = function () {\n    function Tribes() {\n        _classCallCheck(this, Tribes);\n    }\n\n    _createClass(Tribes, null, [{\n        key: 'generateTribes',\n        value: function generateTribes() {\n            return _.map(Definitions, function (definition) {\n                return new _tribe2.default(definition);\n            });\n        }\n    }]);\n\n    return Tribes;\n}();\n\nexports.default = Tribes;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL3RyaWJlcy5qcz9kYmI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUcmliZSBmcm9tICcuLi9ib2FyZC90cmliZSc7XG5pbXBvcnQgVHJpYmVJRHMgZnJvbSAnLi90cmliZUlkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4vcmVnaW9uSWRzJztcblxuY29uc3QgRGVmaW5pdGlvbnMgPSB7fTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuQUVEVUldID0ge1xuICAgIGlkOiBUcmliZUlEcy5BRURVSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkFFRFVJLFxuICAgIG5hbWU6ICdBZWR1aScsXG4gICAgaXNDaXR5OiB0cnVlLFxuICAgIGZhY3Rpb25SZXN0cmljdGlvbjogJ0FlZHVpJ1xuXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5BUlZFUk5JXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQVJWRVJOSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkFSVkVSTkksXG4gICAgbmFtZTogJ0FydmVybmknLFxuICAgIGlzQ2l0eTogdHJ1ZSxcbiAgICBmYWN0aW9uUmVzdHJpY3Rpb246ICdBcnZlcm5pJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuQVRSRUJBVEVTXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQVRSRUJBVEVTLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgIG5hbWU6ICdBdHJlYmF0ZXMnXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5BVUxFUkNJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQVVMRVJDSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkNBUk5VVEVTLFxuICAgIG5hbWU6ICdBdWxlcmNpJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuQkVMTE9WQUNJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQkVMTE9WQUNJLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgIG5hbWU6ICdCZWxsb3ZhY2knXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5CSVRVUklHRVNdID0ge1xuICAgIGlkOiBUcmliZUlEcy5CSVRVUklHRVMsXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5CSVRVUklHRVMsXG4gICAgbmFtZTogJ0JpdHVyaWdlcycsXG4gICAgaXNDaXR5OiB0cnVlXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5DQURVUkNJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQ0FEVVJDSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkFSVkVSTkksXG4gICAgbmFtZTogJ0NhZHVyY2knXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5DQVJOVVRFU10gPSB7XG4gICAgaWQ6IFRyaWJlSURzLkNBUk5VVEVTLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuQ0FSTlVURVMsXG4gICAgbmFtZTogJ0Nhcm51dGVzJyxcbiAgICBpc0NpdHk6IHRydWVcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLkNBVFVWRUxMQVVOSV0gPSB7XG4gICAgaWQ6IFRyaWJlSURzLkNBVFVWRUxMQVVOSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkJSSVRBTk5JQSxcbiAgICBuYW1lOiAnQ2F0dXZlbGxhdW5pJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuQ09MT05ZXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuQ09MT05ZLFxuICAgIHJlZ2lvbklkOiBudWxsLFxuICAgIG5hbWU6ICdDb2xvbnknXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5FQlVST05FU10gPSB7XG4gICAgaWQ6IFRyaWJlSURzLkVCVVJPTkVTLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuTkVSVklJLFxuICAgIG5hbWU6ICdFYnVyb25lcydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLkhFTFZFVElJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuSEVMVkVUSUksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5TRVFVQU5JLFxuICAgIG5hbWU6ICdIZWx2ZXRpaSdcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLkhFTFZJSV0gPSB7XG4gICAgaWQ6IFRyaWJlSURzLkhFTFZJSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlBST1ZJTkNJQSxcbiAgICBuYW1lOiAnSGVsdmlpJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuTElOR09ORVNdID0ge1xuICAgIGlkOiBUcmliZUlEcy5MSU5HT05FUyxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLk1BTkRVQklJLFxuICAgIG5hbWU6ICdMaW5nb25lcydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLk1BTkRVQklJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuTUFORFVCSUksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5NQU5EVUJJSSxcbiAgICBuYW1lOiAnTWFuZHViaWknLFxuICAgIGlzQ2l0eTogdHJ1ZVxufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuTUVOQVBJSV0gPSB7XG4gICAgaWQ6IFRyaWJlSURzLk1FTkFQSUksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5NT1JJTkksXG4gICAgbmFtZTogJ01lbmFwaWknXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5NT1JJTkldID0ge1xuICAgIGlkOiBUcmliZUlEcy5NT1JJTkksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5NT1JJTkksXG4gICAgbmFtZTogJ01vcmluaSdcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLk5BTU5FVEVTXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuTkFNTkVURVMsXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5WRU5FVEksXG4gICAgbmFtZTogJ05hbWVuZXRlcydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLk5FUlZJSV0gPSB7XG4gICAgaWQ6IFRyaWJlSURzLk5FUlZJSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLk5FUlZJSSxcbiAgICBuYW1lOiAnTmVydmlpJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuUElDVE9ORVNdID0ge1xuICAgIGlkOiBUcmliZUlEcy5QSUNUT05FUyxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlBJQ1RPTkVTLFxuICAgIG5hbWU6ICdQaWN0b25lcydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLlJFTUldID0ge1xuICAgIGlkOiBUcmliZUlEcy5SRU1JLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuQVRSRUJBVEVTLFxuICAgIG5hbWU6ICdSZW1pJ1xufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuU0FOVE9ORVNdID0ge1xuICAgIGlkOiBUcmliZUlEcy5TQU5UT05FUyxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlBJQ1RPTkVTLFxuICAgIG5hbWU6ICdTYW50b25lcydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLlNFTk9ORVNdID0ge1xuICAgIGlkOiBUcmliZUlEcy5TRU5PTkVTLFxuICAgIHJlZ2lvbklkOiBSZWdpb25JRHMuTUFORFVCSUksXG4gICAgbmFtZTogJ1Nlbm9uZXMnXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5TRVFVQU5JXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuU0VRVUFOSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlNFUVVBTkksXG4gICAgbmFtZTogJ1NlcXVhbmknLFxuICAgIGlzQ2l0eTogdHJ1ZVxufTtcblxuRGVmaW5pdGlvbnNbVHJpYmVJRHMuU1VFQklfTk9SVEhdID0ge1xuICAgIGlkOiBUcmliZUlEcy5TVUVCSV9OT1JUSCxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlNVR0FNQlJJLFxuICAgIG5hbWU6ICdTdWViaSAoTm9ydGgpJyxcbiAgICBmYWN0aW9uUmVzdHJpY3Rpb246ICdHZXJtYW5pYydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLlNVRUJJX1NPVVRIXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuU1VFQklfU09VVEgsXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5VQklJLFxuICAgIG5hbWU6ICdTdWViaSAoU291dGgpJyxcbiAgICBmYWN0aW9uUmVzdHJpY3Rpb246ICdHZXJtYW5pYydcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLlNVR0FNQlJJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuU1VHQU1CUkksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5TVUdBTUJSSSxcbiAgICBuYW1lOiAnU3VnYW1icmknXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5UUkVWRVJJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuVFJFVkVSSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlRSRVZFUkksXG4gICAgbmFtZTogJ1RyZXZlcmknXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5VQklJXSA9IHtcbiAgICBpZDogVHJpYmVJRHMuVUJJSSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLlVCSUksXG4gICAgbmFtZTogJ1ViaWknXG59O1xuXG5EZWZpbml0aW9uc1tUcmliZUlEcy5WRU5FVEldID0ge1xuICAgIGlkOiBUcmliZUlEcy5WRU5FVEksXG4gICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5WRU5FVEksXG4gICAgbmFtZTogJ1ZlbmV0aSdcbn07XG5cbkRlZmluaXRpb25zW1RyaWJlSURzLlZPTENBRV0gPSB7XG4gICAgaWQ6IFRyaWJlSURzLlZPTENBRSxcbiAgICByZWdpb25JZDogUmVnaW9uSURzLkFSVkVSTkksXG4gICAgbmFtZTogJ1ZvbGNhZSdcbn07XG5cbmNsYXNzIFRyaWJlcyB7XG4gICAgc3RhdGljIGdlbmVyYXRlVHJpYmVzKCkge1xuICAgICAgICByZXR1cm4gXy5tYXAoXG4gICAgICAgICAgICBEZWZpbml0aW9ucywgZnVuY3Rpb24gKGRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRyaWJlKGRlZmluaXRpb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUcmliZXM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbmZpZy90cmliZXMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7Ozs7Ozs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ActionHistory = function () {\n    function ActionHistory(state) {\n        _classCallCheck(this, ActionHistory);\n\n        this.state = state;\n        this.actions = [];\n    }\n\n    _createClass(ActionHistory, [{\n        key: 'addAction',\n        value: function addAction(action) {\n            this.actions.push(action);\n        }\n    }, {\n        key: 'undo',\n        value: function undo() {\n            var action = this.actions.pop();\n            action.doUndo(this.state);\n        }\n    }, {\n        key: 'currentIndex',\n        value: function currentIndex() {\n            return this.actions.length;\n        }\n    }, {\n        key: 'getActionRange',\n        value: function getActionRange(start, end) {\n            return _lodash2.default.slice(this.actions, start, end);\n        }\n    }, {\n        key: 'undoRange',\n        value: function undoRange(start, end) {\n            var _this = this;\n\n            var actualEnd = end || this.actions.length;\n\n            if (actualEnd <= start) {\n                return [];\n            }\n\n            _lodash2.default.each(_lodash2.default.range(start, actualEnd), function () {\n                _this.undo();\n            });\n        }\n    }]);\n\n    return ActionHistory;\n}();\n\nexports.default = ActionHistory;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9hY3Rpb25IaXN0b3J5LmpzPzZmYzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vbGliL2xvZGFzaCc7XG5jbGFzcyBBY3Rpb25IaXN0b3J5IHtcbiAgICBjb25zdHJ1Y3RvcihzdGF0ZSkge1xuICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGU7XG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IFtdO1xuICAgIH1cblxuICAgIGFkZEFjdGlvbihhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5hY3Rpb25zLnB1c2goYWN0aW9uKTtcbiAgICB9XG5cbiAgICB1bmRvKCkge1xuICAgICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmFjdGlvbnMucG9wKCk7XG4gICAgICAgIGFjdGlvbi5kb1VuZG8odGhpcy5zdGF0ZSk7XG4gICAgfVxuXG4gICAgY3VycmVudEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zLmxlbmd0aDtcbiAgICB9XG5cbiAgICBnZXRBY3Rpb25SYW5nZShzdGFydCwgZW5kKSB7XG4gICAgICAgIHJldHVybiBfLnNsaWNlKHRoaXMuYWN0aW9ucywgc3RhcnQsIGVuZCk7XG4gICAgfVxuXG4gICAgdW5kb1JhbmdlKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgY29uc3QgYWN0dWFsRW5kID0gZW5kIHx8IHRoaXMuYWN0aW9ucy5sZW5ndGg7XG5cbiAgICAgICAgaWYgKGFjdHVhbEVuZCA8PSBzdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKF8ucmFuZ2Uoc3RhcnQsYWN0dWFsRW5kKSwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51bmRvKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWN0aW9uSGlzdG9yeTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi9hY3Rpb25IaXN0b3J5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar GameState = function GameState() {\n    _classCallCheck(this, GameState);\n};\n\nexports.default = GameState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9nYW1lU3RhdGUuanM/MWM1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIEdhbWVTdGF0ZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG5cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVTdGF0ZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi9nYW1lU3RhdGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PlayerInteractionNeededError = function PlayerInteractionNeededError(message, interaction) {\n    _classCallCheck(this, PlayerInteractionNeededError);\n\n    this.name = 'PlayerInteractionNeededError';\n    this.message = message;\n    this.interaction = interaction;\n};\n\nexports.default = PlayerInteractionNeededError;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yLmpzP2U3NGMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUGxheWVySW50ZXJhY3Rpb25OZWVkZWRFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgaW50ZXJhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5uYW1lID0gJ1BsYXllckludGVyYWN0aW9uTmVlZGVkRXJyb3InO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICB0aGlzLmludGVyYWN0aW9uID0gaW50ZXJhY3Rpb247XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL3BsYXllckludGVyYWN0aW9uTmVlZGVkRXJyb3IuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _sequenceForCard = __webpack_require__(89);\n\nvar _sequenceForCard2 = _interopRequireDefault(_sequenceForCard);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SequenceOfPlay = function () {\n    function SequenceOfPlay(state, definition) {\n        var _this = this;\n\n        _classCallCheck(this, SequenceOfPlay);\n\n        var that = this;\n\n        this.history = _knockout2.default.observableArray([]);\n        this.eligibleFactions = _knockout2.default.observableArray(definition.factions);\n        this.ineligibleFactions = _knockout2.default.observableArray();\n        this.passedFactions = _knockout2.default.observableArray();\n        this.forcedEligibleFactionIds = _knockout2.default.observableArray();\n        this.currentSequenceForCard = _knockout2.default.observable(new _sequenceForCard2.default({ eligible: _lodash2.default.clone(this.eligibleFactions()) }));\n        this.state = state;\n\n        this.firstFaction = _knockout2.default.observable();\n        this.secondFaction = _knockout2.default.observable();\n\n        this.firstActionChosen = _knockout2.default.observable();\n        this.secondActionChosen = _knockout2.default.observable();\n\n        this.availableActions = _knockout2.default.pureComputed(function () {\n            var availableActions = [];\n            if (!_this.firstActionChosen()) {\n                availableActions.push.apply(availableActions, [_factionActions2.default.EVENT, _factionActions2.default.COMMAND, _factionActions2.default.COMMAND_AND_SPECIAL]);\n            } else if (_this.firstActionChosen() === _factionActions2.default.COMMAND_AND_SPECIAL) {\n                availableActions.push(_factionActions2.default.EVENT);\n                if (true) {\n                    // check player\n                    availableActions.push(_factionActions2.default.COMMAND_AND_SPECIAL);\n                } else {\n                    availableActions.push(_factionActions2.default.LIMITED_COMMAND);\n                }\n            } else if (_this.firstActionChosen() === _factionActions2.default.COMMAND) {\n                if (true) {\n                    // check player\n                    availableActions.push(_factionActions2.default.COMMAND_AND_SPECIAL);\n                } else {\n                    availableActions.push(_factionActions2.default.LIMITED_COMMAND);\n                }\n            } else if (_this.firstActionChosen() === _factionActions2.default.EVENT) {\n                availableActions.push(_factionActions2.default.COMMAND_AND_SPECIAL);\n            }\n            return availableActions;\n        });\n    }\n\n    _createClass(SequenceOfPlay, [{\n        key: 'updateEligibility',\n        value: function updateEligibility() {\n            var _this2 = this;\n\n            _lodash2.default.each(this.passedFactions(), function (factionId) {\n                _this2.eligibleFactions.push(factionId);\n            });\n            this.passedFactions([]);\n            _lodash2.default.each(this.ineligibleFactions(), function (factionId) {\n                _this2.eligibleFactions.push(factionId);\n            });\n\n            var newlyIneligible = [];\n            if (this.firstFaction()) {\n                if (_lodash2.default.indexOf(this.forcedEligibleFactionIds(), this.firstFaction().id) >= 0) {\n                    this.eligibleFactions.push(this.firstFaction());\n                } else {\n                    newlyIneligible.push(this.firstFaction());\n                }\n            }\n            if (this.secondFaction()) {\n                if (_lodash2.default.indexOf(this.forcedEligibleFactionIds(), this.secondFaction().id) >= 0) {\n                    this.eligibleFactions.push(this.secondFaction());\n                } else {\n                    newlyIneligible.push(this.secondFaction());\n                }\n            }\n            this.ineligibleFactions(newlyIneligible);\n            this.history.push(this.currentSequenceForCard());\n            this.currentSequenceForCard(new _sequenceForCard2.default({\n                eligible: _lodash2.default.clone(this.eligibleFactions()),\n                ineligible: _lodash2.default.clone(this.ineligibleFactions())\n            }));\n\n            this.firstFaction(null);\n            this.secondFaction(null);\n            this.firstActionChosen(null);\n            this.secondActionChosen(null);\n            this.forcedEligibleFactionIds([]);\n        }\n    }, {\n        key: 'resetEligibility',\n        value: function resetEligibility() {\n            this.eligibleFactions.push.apply(this.eligibleFactions, this.ineligibleFactions());\n            this.ineligibleFactions([]);\n            this.history.push(this.currentSequenceForCard());\n            this.currentSequenceForCard(new _sequenceForCard2.default({\n                eligible: _lodash2.default.clone(this.eligibleFactions()),\n                ineligible: _lodash2.default.clone(this.ineligibleFactions())\n            }));\n        }\n    }, {\n        key: 'recordFactionAction',\n        value: function recordFactionAction(factionId, action) {\n            console.log('Faction ' + factionId + ' did action ' + action);\n            this.eligibleFactions.remove(factionId);\n            if (action === _factionActions2.default.PASS) {\n                this.passedFactions.push(factionId);\n            } else if (this.firstFaction()) {\n                this.secondActionChosen(action);\n                this.secondFaction(factionId);\n            } else {\n                this.firstActionChosen(action);\n                this.firstFaction(factionId);\n            }\n            this.currentSequenceForCard().addAction(factionId, action);\n            this.state.turnHistory.commitTurn(action);\n        }\n    }, {\n        key: 'nextFaction',\n        value: function nextFaction(currentCard) {\n            var _this3 = this;\n\n            return _lodash2.default.find(currentCard.initiativeOrder, function (factionId) {\n                return _lodash2.default.indexOf(_this3.eligibleFactions(), factionId) >= 0;\n            });\n        }\n    }, {\n        key: 'remainEligible',\n        value: function remainEligible(factionId) {\n            this.forcedEligibleFactionIds.push(factionId);\n        }\n    }, {\n        key: 'canUndo',\n        value: function canUndo() {\n            return this.currentSequenceForCard().numActionsTaken() > 0 || this.history().length > 0;\n        }\n    }, {\n        key: 'isStartOfCard',\n        value: function isStartOfCard() {\n            return this.currentSequenceForCard().numActionsTaken() === 0;\n        }\n    }, {\n        key: 'undo',\n        value: function undo() {\n            var _this4 = this;\n\n            if (this.currentSequenceForCard().numActionsTaken() === 0) {\n                if (this.history().length > 0) {\n                    this.currentSequenceForCard(this.history.pop());\n                    this.eligibleFactions(_lodash2.default.clone(this.currentSequenceForCard().eligible));\n                    this.ineligibleFactions(_lodash2.default.clone(this.currentSequenceForCard().ineligible));\n                    _lodash2.default.each(this.currentSequenceForCard().actions(), function (actionData) {\n                        if (actionData.actionId === _factionActions2.default.PASS) {\n                            _this4.eligibleFactions.remove(actionData.factionId);\n                            _this4.passedFactions.push(actionData.factionId);\n                        } else if (!_this4.firstFaction()) {\n                            _this4.eligibleFactions.remove(actionData.factionId);\n                            _this4.firstFaction(actionData.factionId);\n                            _this4.firstActionChosen(actionData.actionId);\n                        } else {\n                            _this4.eligibleFactions.remove(actionData.factionId);\n                            _this4.secondFaction(actionData.factionId);\n                            _this4.secondActionChosen(actionData.actionId);\n                        }\n                    });\n                    return false;\n                } else {\n                    return false;\n                }\n            }\n\n            var lastAction = this.currentSequenceForCard().popAction();\n            if (lastAction.actionId === _factionActions2.default.PASS) {\n                this.passedFactions.remove(lastAction.factionId);\n                this.eligibleFactions.push(lastAction.factionId);\n            } else if (this.secondFaction() === lastAction.factionId) {\n                this.secondFaction(null);\n                this.secondActionChosen(null);\n                this.eligibleFactions.push(lastAction.factionId);\n            } else if (this.firstFaction() === lastAction.factionId) {\n                this.firstFaction(null);\n                this.firstActionChosen(null);\n                this.eligibleFactions.push(lastAction.factionId);\n            }\n            return true;\n        }\n    }, {\n        key: 'logState',\n        value: function logState() {\n            console.log('Eligible Factions: ' + _lodash2.default.join(this.eligibleFactions()));\n            console.log('Passed Factions: ' + _lodash2.default.join(this.passedFactions()));\n            console.log('Ineligible Factions: ' + _lodash2.default.join(this.ineligibleFactions()));\n            if (this.firstFaction()) {\n                console.log('First Faction:  ' + this.firstFaction() + ' (' + this.firstActionChosen() + ')');\n            }\n            if (this.secondFaction()) {\n                console.log('Second Faction:  ' + this.secondFaction() + ' (' + this.secondActionChosen() + ')');\n            }\n        }\n    }]);\n\n    return SequenceOfPlay;\n}();\n\nexports.default = SequenceOfPlay;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9zZXF1ZW5jZU9mUGxheS5qcz9kNmE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uL2xpYi9sb2Rhc2guanMnO1xuaW1wb3J0IGtvIGZyb20gJy4uL2xpYi9rbm9ja291dC5qcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgU2VxdWVuY2VGb3JDYXJkIGZyb20gJy4vc2VxdWVuY2VGb3JDYXJkJztcblxuY2xhc3MgU2VxdWVuY2VPZlBsYXkge1xuICAgIGNvbnN0cnVjdG9yKHN0YXRlLCBkZWZpbml0aW9uKSB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucyA9IGtvLm9ic2VydmFibGVBcnJheShkZWZpbml0aW9uLmZhY3Rpb25zKTtcbiAgICAgICAgdGhpcy5pbmVsaWdpYmxlRmFjdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgICAgICAgdGhpcy5wYXNzZWRGYWN0aW9ucyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmZvcmNlZEVsaWdpYmxlRmFjdGlvbklkcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTZXF1ZW5jZUZvckNhcmQgPSBrby5vYnNlcnZhYmxlKG5ldyBTZXF1ZW5jZUZvckNhcmQoeyBlbGlnaWJsZTogXy5jbG9uZSh0aGlzLmVsaWdpYmxlRmFjdGlvbnMoKSl9KSk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcblxuICAgICAgICB0aGlzLmZpcnN0RmFjdGlvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5zZWNvbmRGYWN0aW9uID0ga28ub2JzZXJ2YWJsZSgpO1xuXG4gICAgICAgIHRoaXMuZmlyc3RBY3Rpb25DaG9zZW4gPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgICAgIHRoaXMuc2Vjb25kQWN0aW9uQ2hvc2VuID0ga28ub2JzZXJ2YWJsZSgpO1xuXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlQWN0aW9ucyA9IGtvLnB1cmVDb21wdXRlZCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdmFpbGFibGVBY3Rpb25zID0gW107XG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlyc3RBY3Rpb25DaG9zZW4oKSkge1xuICAgICAgICAgICAgICAgIGF2YWlsYWJsZUFjdGlvbnMucHVzaC5hcHBseShhdmFpbGFibGVBY3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbRmFjdGlvbkFjdGlvbnMuRVZFTlQsIEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQsIEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUxdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmlyc3RBY3Rpb25DaG9zZW4oKSA9PT0gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCkge1xuICAgICAgICAgICAgICAgIGF2YWlsYWJsZUFjdGlvbnMucHVzaChGYWN0aW9uQWN0aW9ucy5FVkVOVCk7XG4gICAgICAgICAgICAgICAgaWYgKHRydWUpIHsgLy8gY2hlY2sgcGxheWVyXG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZUFjdGlvbnMucHVzaChGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZUFjdGlvbnMucHVzaChGYWN0aW9uQWN0aW9ucy5MSU1JVEVEX0NPTU1BTkQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmlyc3RBY3Rpb25DaG9zZW4oKSA9PT0gRmFjdGlvbkFjdGlvbnMuQ09NTUFORCkge1xuICAgICAgICAgICAgICAgIGlmICh0cnVlKSB7IC8vIGNoZWNrIHBsYXllclxuICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVBY3Rpb25zLnB1c2goRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVBY3Rpb25zLnB1c2goRmFjdGlvbkFjdGlvbnMuTElNSVRFRF9DT01NQU5EKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmZpcnN0QWN0aW9uQ2hvc2VuKCkgPT09IEZhY3Rpb25BY3Rpb25zLkVWRU5UKSB7XG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlQWN0aW9ucy5wdXNoKEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF2YWlsYWJsZUFjdGlvbnM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZUVsaWdpYmlsaXR5KCkge1xuXG4gICAgICAgIF8uZWFjaCh0aGlzLnBhc3NlZEZhY3Rpb25zKCksIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucy5wdXNoKGZhY3Rpb25JZCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBhc3NlZEZhY3Rpb25zKFtdKTtcbiAgICAgICAgXy5lYWNoKHRoaXMuaW5lbGlnaWJsZUZhY3Rpb25zKCksIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucy5wdXNoKGZhY3Rpb25JZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG5ld2x5SW5lbGlnaWJsZSA9IFtdO1xuICAgICAgICBpZiAodGhpcy5maXJzdEZhY3Rpb24oKSkge1xuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZih0aGlzLmZvcmNlZEVsaWdpYmxlRmFjdGlvbklkcygpLCB0aGlzLmZpcnN0RmFjdGlvbigpLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGlnaWJsZUZhY3Rpb25zLnB1c2godGhpcy5maXJzdEZhY3Rpb24oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdseUluZWxpZ2libGUucHVzaCh0aGlzLmZpcnN0RmFjdGlvbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWNvbmRGYWN0aW9uKCkpIHtcbiAgICAgICAgICAgIGlmIChfLmluZGV4T2YodGhpcy5mb3JjZWRFbGlnaWJsZUZhY3Rpb25JZHMoKSwgdGhpcy5zZWNvbmRGYWN0aW9uKCkuaWQpID49IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsaWdpYmxlRmFjdGlvbnMucHVzaCh0aGlzLnNlY29uZEZhY3Rpb24oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdseUluZWxpZ2libGUucHVzaCh0aGlzLnNlY29uZEZhY3Rpb24oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbmVsaWdpYmxlRmFjdGlvbnMobmV3bHlJbmVsaWdpYmxlKTtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTZXF1ZW5jZUZvckNhcmQobmV3IFNlcXVlbmNlRm9yQ2FyZCh7XG4gICAgICAgICAgICBlbGlnaWJsZTogXy5jbG9uZSh0aGlzLmVsaWdpYmxlRmFjdGlvbnMoKSksXG4gICAgICAgICAgICBpbmVsaWdpYmxlOiBfLmNsb25lKHRoaXMuaW5lbGlnaWJsZUZhY3Rpb25zKCkpXG4gICAgICAgIH0pKTtcblxuICAgICAgICB0aGlzLmZpcnN0RmFjdGlvbihudWxsKTtcbiAgICAgICAgdGhpcy5zZWNvbmRGYWN0aW9uKG51bGwpO1xuICAgICAgICB0aGlzLmZpcnN0QWN0aW9uQ2hvc2VuKG51bGwpO1xuICAgICAgICB0aGlzLnNlY29uZEFjdGlvbkNob3NlbihudWxsKTtcbiAgICAgICAgdGhpcy5mb3JjZWRFbGlnaWJsZUZhY3Rpb25JZHMoW10pO1xuICAgIH1cblxuICAgIHJlc2V0RWxpZ2liaWxpdHkoKSB7XG4gICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucy5wdXNoLmFwcGx5KHRoaXMuZWxpZ2libGVGYWN0aW9ucywgdGhpcy5pbmVsaWdpYmxlRmFjdGlvbnMoKSk7XG4gICAgICAgIHRoaXMuaW5lbGlnaWJsZUZhY3Rpb25zKFtdKTtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTZXF1ZW5jZUZvckNhcmQobmV3IFNlcXVlbmNlRm9yQ2FyZCh7XG4gICAgICAgICAgICBlbGlnaWJsZTogXy5jbG9uZSh0aGlzLmVsaWdpYmxlRmFjdGlvbnMoKSksXG4gICAgICAgICAgICBpbmVsaWdpYmxlOiBfLmNsb25lKHRoaXMuaW5lbGlnaWJsZUZhY3Rpb25zKCkpXG4gICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICByZWNvcmRGYWN0aW9uQWN0aW9uKGZhY3Rpb25JZCwgYWN0aW9uKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGYWN0aW9uICcgKyBmYWN0aW9uSWQgKyAnIGRpZCBhY3Rpb24gJyArIGFjdGlvbik7XG4gICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucy5yZW1vdmUoZmFjdGlvbklkKTtcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gRmFjdGlvbkFjdGlvbnMuUEFTUykge1xuICAgICAgICAgICAgdGhpcy5wYXNzZWRGYWN0aW9ucy5wdXNoKGZhY3Rpb25JZCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5maXJzdEZhY3Rpb24oKSkge1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRBY3Rpb25DaG9zZW4oYWN0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kRmFjdGlvbihmYWN0aW9uSWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5maXJzdEFjdGlvbkNob3NlbihhY3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5maXJzdEZhY3Rpb24oZmFjdGlvbklkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmN1cnJlbnRTZXF1ZW5jZUZvckNhcmQoKS5hZGRBY3Rpb24oZmFjdGlvbklkLCBhY3Rpb24pO1xuICAgICAgICB0aGlzLnN0YXRlLnR1cm5IaXN0b3J5LmNvbW1pdFR1cm4oYWN0aW9uKTtcbiAgICB9XG5cbiAgICBuZXh0RmFjdGlvbihjdXJyZW50Q2FyZCkge1xuICAgICAgICByZXR1cm4gXy5maW5kKFxuICAgICAgICAgICAgY3VycmVudENhcmQuaW5pdGlhdGl2ZU9yZGVyLCAoZmFjdGlvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8uaW5kZXhPZih0aGlzLmVsaWdpYmxlRmFjdGlvbnMoKSwgZmFjdGlvbklkKSA+PSAwO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVtYWluRWxpZ2libGUoZmFjdGlvbklkKSB7XG4gICAgICAgIHRoaXMuZm9yY2VkRWxpZ2libGVGYWN0aW9uSWRzLnB1c2goZmFjdGlvbklkKTtcbiAgICB9XG5cbiAgICBjYW5VbmRvKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkubnVtQWN0aW9uc1Rha2VuKCkgPiAwIHx8IHRoaXMuaGlzdG9yeSgpLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgaXNTdGFydE9mQ2FyZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFNlcXVlbmNlRm9yQ2FyZCgpLm51bUFjdGlvbnNUYWtlbigpID09PSAwO1xuICAgIH1cblxuICAgIHVuZG8oKSB7XG4gICAgICAgIGlmKHRoaXMuY3VycmVudFNlcXVlbmNlRm9yQ2FyZCgpLm51bUFjdGlvbnNUYWtlbigpID09PSAwKSB7XG4gICAgICAgICAgICBpZih0aGlzLmhpc3RvcnkoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKHRoaXMuaGlzdG9yeS5wb3AoKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGlnaWJsZUZhY3Rpb25zKF8uY2xvbmUodGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkuZWxpZ2libGUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmluZWxpZ2libGVGYWN0aW9ucyhfLmNsb25lKHRoaXMuY3VycmVudFNlcXVlbmNlRm9yQ2FyZCgpLmluZWxpZ2libGUpKTtcbiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkuYWN0aW9ucygpLCAoYWN0aW9uRGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZihhY3Rpb25EYXRhLmFjdGlvbklkID09PSBGYWN0aW9uQWN0aW9ucy5QQVNTKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsaWdpYmxlRmFjdGlvbnMucmVtb3ZlKGFjdGlvbkRhdGEuZmFjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFzc2VkRmFjdGlvbnMucHVzaChhY3Rpb25EYXRhLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZighdGhpcy5maXJzdEZhY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGlnaWJsZUZhY3Rpb25zLnJlbW92ZShhY3Rpb25EYXRhLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcnN0RmFjdGlvbihhY3Rpb25EYXRhLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcnN0QWN0aW9uQ2hvc2VuKGFjdGlvbkRhdGEuYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGlnaWJsZUZhY3Rpb25zLnJlbW92ZShhY3Rpb25EYXRhLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlY29uZEZhY3Rpb24oYWN0aW9uRGF0YS5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWNvbmRBY3Rpb25DaG9zZW4oYWN0aW9uRGF0YS5hY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsYXN0QWN0aW9uID0gdGhpcy5jdXJyZW50U2VxdWVuY2VGb3JDYXJkKCkucG9wQWN0aW9uKCk7XG4gICAgICAgIGlmKGxhc3RBY3Rpb24uYWN0aW9uSWQgPT09IEZhY3Rpb25BY3Rpb25zLlBBU1MpIHtcbiAgICAgICAgICAgIHRoaXMucGFzc2VkRmFjdGlvbnMucmVtb3ZlKGxhc3RBY3Rpb24uZmFjdGlvbklkKTtcbiAgICAgICAgICAgIHRoaXMuZWxpZ2libGVGYWN0aW9ucy5wdXNoKGxhc3RBY3Rpb24uZmFjdGlvbklkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKHRoaXMuc2Vjb25kRmFjdGlvbigpID09PSBsYXN0QWN0aW9uLmZhY3Rpb25JZCkge1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRGYWN0aW9uKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRBY3Rpb25DaG9zZW4obnVsbCk7XG4gICAgICAgICAgICB0aGlzLmVsaWdpYmxlRmFjdGlvbnMucHVzaChsYXN0QWN0aW9uLmZhY3Rpb25JZCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih0aGlzLmZpcnN0RmFjdGlvbigpID09PSBsYXN0QWN0aW9uLmZhY3Rpb25JZCkge1xuICAgICAgICAgICAgdGhpcy5maXJzdEZhY3Rpb24obnVsbCk7XG4gICAgICAgICAgICB0aGlzLmZpcnN0QWN0aW9uQ2hvc2VuKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5lbGlnaWJsZUZhY3Rpb25zLnB1c2gobGFzdEFjdGlvbi5mYWN0aW9uSWQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGxvZ1N0YXRlKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnRWxpZ2libGUgRmFjdGlvbnM6ICcgKyBfLmpvaW4odGhpcy5lbGlnaWJsZUZhY3Rpb25zKCkpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1Bhc3NlZCBGYWN0aW9uczogJyArIF8uam9pbih0aGlzLnBhc3NlZEZhY3Rpb25zKCkpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0luZWxpZ2libGUgRmFjdGlvbnM6ICcgKyBfLmpvaW4odGhpcy5pbmVsaWdpYmxlRmFjdGlvbnMoKSkpO1xuICAgICAgICBpZiAodGhpcy5maXJzdEZhY3Rpb24oKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpcnN0IEZhY3Rpb246ICAnICsgdGhpcy5maXJzdEZhY3Rpb24oKSArICcgKCcgKyB0aGlzLmZpcnN0QWN0aW9uQ2hvc2VuKCkgKyAnKScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlY29uZEZhY3Rpb24oKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlY29uZCBGYWN0aW9uOiAgJyArIHRoaXMuc2Vjb25kRmFjdGlvbigpICsgJyAoJyArIHRoaXMuc2Vjb25kQWN0aW9uQ2hvc2VuKCkgKyAnKScpO1xuICAgICAgICB9XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFNlcXVlbmNlT2ZQbGF5O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL3NlcXVlbmNlT2ZQbGF5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 62 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _turn = __webpack_require__(90);\n\nvar _turn2 = _interopRequireDefault(_turn);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TurnHistory = function () {\n    function TurnHistory(state) {\n        _classCallCheck(this, TurnHistory);\n\n        this.state = state;\n        this.turns = [];\n        this.currentTurn = null;\n    }\n\n    _createClass(TurnHistory, [{\n        key: 'startTurn',\n        value: function startTurn(factionId) {\n            this.currentTurn = new _turn2.default(this.state, {\n                number: this.nextTurnNumber(),\n                factionId: factionId,\n                actionStartIndex: this.state.actionHistory.currentIndex()\n            });\n            this.currentTurn.pushContext(new _turnContext2.default({ currentFactionId: factionId }));\n        }\n    }, {\n        key: 'rollbackTurn',\n        value: function rollbackTurn() {\n            if (this.currentTurn) {\n                this.currentTurn.undo();\n            }\n        }\n    }, {\n        key: 'rollbackCurrentAction',\n        value: function rollbackCurrentAction() {\n            this.currentTurn.rollbackActionGroup();\n        }\n    }, {\n        key: 'commitTurn',\n        value: function commitTurn(action) {\n            this.currentTurn.commandAction = action;\n            this.currentTurn.actionEndIndex = this.state.actionHistory.currentIndex();\n            this.currentTurn.clearCheckpoints();\n            this.turns.push(this.currentTurn);\n            this.currentTurn = null;\n        }\n    }, {\n        key: 'undoLastTurn',\n        value: function undoLastTurn() {\n            var turn = this.turns.pop();\n            turn.undo();\n        }\n    }, {\n        key: 'getCurrentTurn',\n        value: function getCurrentTurn() {\n            return this.currentTurn;\n        }\n    }, {\n        key: 'lastTurn',\n        value: function lastTurn() {\n            return _lodash2.default.last(this.turns);\n        }\n    }, {\n        key: 'nextTurnNumber',\n        value: function nextTurnNumber() {\n            return this.turns.length + 1;\n        }\n    }]);\n\n    return TurnHistory;\n}();\n\nexports.default = TurnHistory;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi90dXJuSGlzdG9yeS5qcz9mZDc2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IFR1cm4gZnJvbSAnLi90dXJuJztcbmltcG9ydCBUdXJuQ29udGV4dCBmcm9tICdjb21tb24vdHVybkNvbnRleHQnXG5cblxuY2xhc3MgVHVybkhpc3Rvcnkge1xuICAgIGNvbnN0cnVjdG9yKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgdGhpcy50dXJucyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRUdXJuID0gbnVsbDtcbiAgICB9XG5cbiAgICBzdGFydFR1cm4oZmFjdGlvbklkKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFR1cm4gPSBuZXcgVHVybih0aGlzLnN0YXRlLCB7XG4gICAgICAgICAgICBudW1iZXI6IHRoaXMubmV4dFR1cm5OdW1iZXIoKSxcbiAgICAgICAgICAgIGZhY3Rpb25JZDogZmFjdGlvbklkLFxuICAgICAgICAgICAgYWN0aW9uU3RhcnRJbmRleDogdGhpcy5zdGF0ZS5hY3Rpb25IaXN0b3J5LmN1cnJlbnRJbmRleCgpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRUdXJuLnB1c2hDb250ZXh0KG5ldyBUdXJuQ29udGV4dCh7IGN1cnJlbnRGYWN0aW9uSWQ6IGZhY3Rpb25JZCB9KSk7XG4gICAgfVxuXG4gICAgcm9sbGJhY2tUdXJuKCkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50VHVybikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50VHVybi51bmRvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByb2xsYmFja0N1cnJlbnRBY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFR1cm4ucm9sbGJhY2tBY3Rpb25Hcm91cCgpO1xuICAgIH1cblxuICAgIGNvbW1pdFR1cm4oYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFR1cm4uY29tbWFuZEFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgdGhpcy5jdXJyZW50VHVybi5hY3Rpb25FbmRJbmRleCA9IHRoaXMuc3RhdGUuYWN0aW9uSGlzdG9yeS5jdXJyZW50SW5kZXgoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50VHVybi5jbGVhckNoZWNrcG9pbnRzKCk7XG4gICAgICAgIHRoaXMudHVybnMucHVzaCh0aGlzLmN1cnJlbnRUdXJuKTtcbiAgICAgICAgdGhpcy5jdXJyZW50VHVybiA9IG51bGw7XG4gICAgfVxuXG4gICAgdW5kb0xhc3RUdXJuKCkge1xuICAgICAgICBjb25zdCB0dXJuID0gdGhpcy50dXJucy5wb3AoKTtcbiAgICAgICAgdHVybi51bmRvKCk7XG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudFR1cm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRUdXJuO1xuICAgIH1cblxuICAgIGxhc3RUdXJuKCkge1xuICAgICAgICByZXR1cm4gXy5sYXN0KHRoaXMudHVybnMpO1xuICAgIH1cblxuICAgIG5leHRUdXJuTnVtYmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50dXJucy5sZW5ndGggKyAxO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBUdXJuSGlzdG9yeTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi90dXJuSGlzdG9yeS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DisperseTribe = function (_Action) {\n    _inherits(DisperseTribe, _Action);\n\n    function DisperseTribe(args) {\n        _classCallCheck(this, DisperseTribe);\n\n        var _this = _possibleConstructorReturn(this, (DisperseTribe.__proto__ || Object.getPrototypeOf(DisperseTribe)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.tribeId = args.tribeId;\n        return _this;\n    }\n\n    _createClass(DisperseTribe, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var faction = state.factionsById[this.factionId];\n            var tribe = state.tribesById[this.tribeId];\n\n            if (faction.id !== _factionIds2.default.ROMANS || !faction.hasAvailableDispersalTokens() || !tribe.isSubdued()) {\n                throw 'Invalid DisperseTribe Action';\n            }\n\n            faction.removeDispersalToken();\n            tribe.disperse();\n\n            console.log('Dispersing ' + tribe.name + '');\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.factionsById[this.factionId];\n            var tribe = state.tribesById[this.tribeId];\n\n            console.log('Removing dispersal token from ' + tribe.name);\n            faction.returnDispersalToken();\n\n            tribe.undisperse(true);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var tribe = state.tribesById[this.tribeId];\n            return ['Place dispersed marker on ' + tribe.name];\n        }\n    }]);\n\n    return DisperseTribe;\n}(_action2.default);\n\nexports.default = DisperseTribe;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9kaXNwZXJzZVRyaWJlLmpzPzBjNmEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9mYWxsaW5nc2t5L2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgRGlzcGVyc2VUcmliZSBleHRlbmRzIEFjdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgICAgIHRoaXMuZmFjdGlvbklkID0gYXJncy5mYWN0aW9uSWQ7XG4gICAgICAgIHRoaXMudHJpYmVJZCA9IGFyZ3MudHJpYmVJZDtcbiAgICB9XG5cbiAgICBkb0V4ZWN1dGUoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFt0aGlzLnRyaWJlSWRdO1xuXG4gICAgICAgIGlmKGZhY3Rpb24uaWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TIHx8ICFmYWN0aW9uLmhhc0F2YWlsYWJsZURpc3BlcnNhbFRva2VucygpIHx8ICF0cmliZS5pc1N1YmR1ZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgRGlzcGVyc2VUcmliZSBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgZmFjdGlvbi5yZW1vdmVEaXNwZXJzYWxUb2tlbigpO1xuICAgICAgICB0cmliZS5kaXNwZXJzZSgpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdEaXNwZXJzaW5nICcgKyB0cmliZS5uYW1lICsgJycpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgdHJpYmUgPSBzdGF0ZS50cmliZXNCeUlkW3RoaXMudHJpYmVJZF07XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1JlbW92aW5nIGRpc3BlcnNhbCB0b2tlbiBmcm9tICcgKyB0cmliZS5uYW1lKTtcbiAgICAgICAgZmFjdGlvbi5yZXR1cm5EaXNwZXJzYWxUb2tlbigpO1xuXG4gICAgICAgIHRyaWJlLnVuZGlzcGVyc2UodHJ1ZSk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHRyaWJlID0gc3RhdGUudHJpYmVzQnlJZFt0aGlzLnRyaWJlSWRdO1xuICAgICAgICByZXR1cm4gWydQbGFjZSBkaXNwZXJzZWQgbWFya2VyIG9uICcgKyB0cmliZS5uYW1lXTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRGlzcGVyc2VUcmliZVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2FjdGlvbnMvZGlzcGVyc2VUcmliZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUpBO0FBS0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _aeduiTrade = __webpack_require__(39);\n\nvar _aeduiTrade2 = _interopRequireDefault(_aeduiTrade);\n\nvar _enemyFactionPriority = __webpack_require__(34);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    BATTLE_COMPLETE_CHECK: 'battle-complete',\n    SPECIAL_CHECK: 'special-check'\n};\n\nvar AeduiBattle = function () {\n    function AeduiBattle() {\n        _classCallCheck(this, AeduiBattle);\n    }\n\n    _createClass(AeduiBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers) {\n            var aeduiFaction = state.aedui;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (!turn.getCheckpoint(Checkpoints.BATTLE_COMPLETE_CHECK)) {\n\n                if (aeduiFaction.resources() === 0 && !modifiers.free) {\n                    return false;\n                }\n\n                var battles = modifiers.context.battles || this.getBattleList(state, modifiers);\n                if (battles.length === 0) {\n                    return false;\n                }\n\n                turn.startCommand(_commandIds2.default.BATTLE);\n                modifiers.context.battles = battles;\n\n                var ambushed = _lodash2.default.find(battles, { willAmbush: true });\n                if (!turn.getCheckpoint(Checkpoints.SPECIAL_CHECK) && ambushed) {\n                    turn.startSpecialAbility(_specialAbilityIds2.default.AMBUSH);\n                    turn.commitSpecialAbility();\n                    turn.markCheckpoint(Checkpoints.SPECIAL_CHECK);\n                }\n\n                _lodash2.default.each(battles, function (battle) {\n                    if (!battle.complete) {\n                        if (!battle.paid && !modifiers.free) {\n                            _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: battle.cost });\n                            battle.paid = true;\n                        }\n                        _battle2.default.execute(state, { battleResults: battle });\n                    }\n                });\n\n                turn.commitCommand();\n                turn.markCheckpoint(Checkpoints.BATTLE_COMPLETE_CHECK);\n                modifiers.context.battles = null;\n\n                if (ambushed) {\n                    return _factionActions2.default.COMMAND_AND_SPECIAL;\n                }\n            }\n\n            var usedSpecialAbility = modifiers.canDoSpecial() && _aeduiTrade2.default.trade(state, modifiers);\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getBattleList',\n        value: function getBattleList(state, modifiers) {\n            var _this = this;\n\n            var aedui = state.aedui;\n            console.log('*** Are there any effective Aedui Battles? ***');\n            var effectiveBattles = this.findEffectiveBattles(state, modifiers);\n            if (effectiveBattles.length === 0) {\n                return [];\n            }\n\n            var battles = modifiers.free ? effectiveBattles : _lodash2.default.reduce(effectiveBattles, function (accumulator, battle) {\n                if (accumulator.resourcesRemaining >= battle.cost) {\n                    accumulator.resourcesRemaining -= battle.cost;\n                    accumulator.battles.push(battle);\n                }\n                return accumulator;\n            }, { resourcesRemaining: aedui.resources(), battles: [] }).battles;\n\n            if (battles.length > 0) {\n\n                if (modifiers.limited) {\n                    battles = _lodash2.default.take(battles, 1);\n                }\n\n                _lodash2.default.each(battles, function (battle) {\n                    if (_this.shouldAmbush(battle) && modifiers.canDoSpecial()) {\n                        battle.willAmbush = true;\n                        return false;\n                    }\n                });\n            }\n\n            return battles;\n        }\n    }, {\n        key: 'findEffectiveBattles',\n        value: function findEffectiveBattles(state, modifiers) {\n            var _this2 = this;\n\n            var finalBattleList = [];\n\n            var orderedBattles = this.getOrderedBattlesForRegions(state, modifiers, state.regions, true);\n            var usedRegions = {};\n            var ambushed = false;\n            _lodash2.default.each(orderedBattles, function (battle) {\n                usedRegions[battle.region.id] = true;\n                finalBattleList.push(battle.battle);\n                if (_this2.shouldAmbush(battle.battle)) {\n                    ambushed = true;\n                    return false;\n                }\n            });\n\n            if (ambushed) {\n                var unusedRegions = _lodash2.default.reject(state.regions, function (region) {\n                    return usedRegions[region.id];\n                });\n                var noAmbushBattles = this.getOrderedBattlesForRegions(state, modifiers, unusedRegions, false);\n                finalBattleList.push.apply(finalBattleList, _lodash2.default.map(noAmbushBattles, 'battle'));\n            }\n\n            if (_lodash2.default.find(finalBattleList, function (battleResult) {\n                return _this2.isHighlyEffectiveBattle(battleResult);\n            })) {\n                return finalBattleList;\n            } else {\n                return [];\n            }\n        }\n    }, {\n        key: 'getOrderedBattlesForRegions',\n        value: function getOrderedBattlesForRegions(state, modifiers, regions, canAmbush) {\n            var _this3 = this;\n\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            return (0, _lodash2.default)(regions).filter(function (region) {\n                if (!modifiers.free && aeduiFaction.resources() < 2 && region.devastated()) {\n                    return false;\n                }\n\n                var aeduiPieces = region.piecesByFaction()[_factionIds2.default.AEDUI];\n                return _lodash2.default.find(aeduiPieces, { isMobile: true });\n            }).map(function (region) {\n                var battleData = _this3.findBestBattleForRegion(state, region, canAmbush);\n                if (battleData) {\n                    return {\n                        region: region,\n                        priority: battleData.priority,\n                        battle: battleData.battleResult\n                    };\n                }\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n        }\n    }, {\n        key: 'findBestBattleForRegion',\n        value: function findBestBattleForRegion(state, region, canAmbush) {\n            var _this4 = this;\n\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            return (0, _lodash2.default)(_enemyFactionPriority2.default).keys().map(function (factionId) {\n                if (factionId === _factionIds2.default.ROMANS && aeduiFaction.victoryMargin(state) <= 0) {\n                    return;\n                }\n\n                var enemyPieces = region.piecesByFaction()[factionId];\n                if (enemyPieces) {\n                    var battleResult = _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.AEDUI,\n                        defendingFactionId: factionId\n                    });\n\n                    if (!canAmbush) {\n                        battleResult.canAmbush = false;\n                    }\n\n                    if (_this4.isEffectiveBattle(battleResult)) {\n                        var priority = _this4.getBattlePriority(battleResult);\n                        return {\n                            priority: priority,\n                            battleResult: battleResult\n                        };\n                    }\n                }\n            }).compact().sortBy('priority').first();\n        }\n    }, {\n        key: 'isHighlyEffectiveBattle',\n        value: function isHighlyEffectiveBattle(battleResult) {\n            return battleResult.willCauseLeaderRemoval(battleResult.canAmbush) || battleResult.willCauseAllyRemoval(battleResult.canAmbush) || battleResult.willCauseCitadelRemoval(battleResult.canAmbush) || battleResult.willCauseLegionRemoval(battleResult.canAmbush);\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            if (this.isHighlyEffectiveBattle(battleResult)) {\n                return true;\n            }\n\n            return this.willCauseEnoughDefenderLosses(battleResult);\n        }\n    }, {\n        key: 'mostDefenderLosses',\n        value: function mostDefenderLosses(battleResult) {\n            return Math.max(battleResult.worstCaseDefenderLosses.normal, battleResult.canAmbush ? battleResult.worstCaseDefenderLosses.ambush : 0);\n        }\n    }, {\n        key: 'willCauseEnoughDefenderLosses',\n        value: function willCauseEnoughDefenderLosses(battleResult) {\n            if (battleResult.worstCaseDefenderLosses.normal > 0 && battleResult.worstCaseDefenderLosses.normal >= battleResult.worstCaseAttackerLosses.normal) {\n                return true;\n            }\n\n            return battleResult.canAmbush && battleResult.worstCaseDefenderLosses.ambush > 0 && battleResult.worstCaseDefenderLosses.ambush >= battleResult.worstCaseAttackerLosses.ambush;\n        }\n    }, {\n        key: 'getBattlePriority',\n        value: function getBattlePriority(battleResult) {\n            var enemyPriority = _enemyFactionPriority2.default[battleResult.defendingFaction.id];\n            if (battleResult.willCauseLeaderRemoval(battleResult.canAmbush)) {\n                return 'a' + enemyPriority;\n            } else if (battleResult.willCauseAllyRemoval(battleResult.canAmbush)) {\n                return 'b' + enemyPriority;\n            } else if (battleResult.willCauseCitadelRemoval(battleResult.canAmbush)) {\n                return 'c' + enemyPriority;\n            } else if (battleResult.willCauseLegionRemoval(battleResult.canAmbush)) {\n                return 'd';\n            } else if (this.willCauseEnoughDefenderLosses(battleResult)) {\n                return 'e' + (100 - this.mostDefenderLosses(battleResult)) + enemyPriority;\n            } else {\n                return 'f';\n            }\n        }\n    }, {\n        key: 'shouldAmbush',\n        value: function shouldAmbush(battleResult) {\n            if (!battleResult.canAmbush) {\n                return false;\n            }\n            if (!battleResult.willCauseLeaderRemoval() && battleResult.willCauseLeaderRemoval(true)) {\n                return true;\n            }\n            if (!battleResult.willCauseAllyRemoval() && battleResult.willCauseAllyRemoval(true)) {\n                return true;\n            }\n            if (!battleResult.willCauseCitadelRemoval() && battleResult.willCauseCitadelRemoval(true)) {\n                return true;\n            }\n            if (!battleResult.willCauseLegionRemoval() && battleResult.willCauseLegionRemoval(true)) {\n                return true;\n            }\n            if (battleResult.worstCaseDefenderLosses.normal < battleResult.worstCaseDefenderLosses.ambush) {\n                return true;\n            }\n            if (battleResult.worstCaseAttackerLosses.ambush < battleResult.worstCaseAttackerLosses.normal) {\n                return true;\n            }\n\n            return false;\n        }\n    }]);\n\n    return AeduiBattle;\n}();\n\nexports.default = AeduiBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aUJhdHRsZS5qcz9kNTUyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQmF0dGxlIGZyb20gJy4uLy4uL2NvbW1hbmRzL2JhdHRsZSc7XG5pbXBvcnQgQWVkdWlUcmFkZSBmcm9tICcuL2FlZHVpVHJhZGUnO1xuaW1wb3J0IEVuZW15RmFjdGlvblByaW9yaXR5IGZyb20gJy4vZW5lbXlGYWN0aW9uUHJpb3JpdHknO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgQkFUVExFX0NPTVBMRVRFX0NIRUNLOiAnYmF0dGxlLWNvbXBsZXRlJyxcbiAgICBTUEVDSUFMX0NIRUNLOiAnc3BlY2lhbC1jaGVjaydcbn07XG5cblxuY2xhc3MgQWVkdWlCYXR0bGUge1xuXG4gICAgc3RhdGljIGJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IHN0YXRlLmFlZHVpO1xuICAgICAgICBjb25zdCB0dXJuID0gc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ09NUExFVEVfQ0hFQ0spKSB7XG5cbiAgICAgICAgICAgIGlmIChhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPT09IDAgJiYgIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzIHx8IHRoaXMuZ2V0QmF0dGxlTGlzdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgICAgIGlmIChiYXR0bGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHVybi5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5CQVRUTEUpO1xuICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuYmF0dGxlcyA9IGJhdHRsZXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGFtYnVzaGVkID0gXy5maW5kKGJhdHRsZXMsIHt3aWxsQW1idXNoOiB0cnVlfSk7XG4gICAgICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5TUEVDSUFMX0NIRUNLKSAmJiBhbWJ1c2hlZCkge1xuICAgICAgICAgICAgICAgIHR1cm4uc3RhcnRTcGVjaWFsQWJpbGl0eShTcGVjaWFsQWJpbGl0eUlEcy5BTUJVU0gpO1xuICAgICAgICAgICAgICAgIHR1cm4uY29tbWl0U3BlY2lhbEFiaWxpdHkoKTtcbiAgICAgICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlNQRUNJQUxfQ0hFQ0spXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF8uZWFjaChiYXR0bGVzLCAoYmF0dGxlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoIWJhdHRsZS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZighYmF0dGxlLnBhaWQgJiYgIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IGJhdHRsZS5jb3N0fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGUucGFpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgQmF0dGxlLmV4ZWN1dGUoc3RhdGUsIHsgYmF0dGxlUmVzdWx0czogYmF0dGxlIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0dXJuLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuQkFUVExFX0NPTVBMRVRFX0NIRUNLKTtcbiAgICAgICAgICAgIG1vZGlmaWVycy5jb250ZXh0LmJhdHRsZXMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoYW1idXNoZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVzZWRTcGVjaWFsQWJpbGl0eSA9IG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiBBZWR1aVRyYWRlLnRyYWRlKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICByZXR1cm4gdXNlZFNwZWNpYWxBYmlsaXR5ID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEJhdHRsZUxpc3Qoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCBhZWR1aSA9IHN0YXRlLmFlZHVpO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEFyZSB0aGVyZSBhbnkgZWZmZWN0aXZlIEFlZHVpIEJhdHRsZXM/ICoqKicpO1xuICAgICAgICBjb25zdCBlZmZlY3RpdmVCYXR0bGVzID0gdGhpcy5maW5kRWZmZWN0aXZlQmF0dGxlcyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGVmZmVjdGl2ZUJhdHRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYmF0dGxlcyA9IG1vZGlmaWVycy5mcmVlID8gZWZmZWN0aXZlQmF0dGxlcyA6IF8ucmVkdWNlKGVmZmVjdGl2ZUJhdHRsZXMsIChhY2N1bXVsYXRvciwgYmF0dGxlKSA9PiB7XG4gICAgICAgICAgICBpZiAoYWNjdW11bGF0b3IucmVzb3VyY2VzUmVtYWluaW5nID49IGJhdHRsZS5jb3N0KSB7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IucmVzb3VyY2VzUmVtYWluaW5nIC09IGJhdHRsZS5jb3N0O1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLmJhdHRsZXMucHVzaChiYXR0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yXG4gICAgICAgIH0sIHtyZXNvdXJjZXNSZW1haW5pbmc6IGFlZHVpLnJlc291cmNlcygpLCBiYXR0bGVzOiBbXX0pLmJhdHRsZXM7XG5cbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzLmxpbWl0ZWQpIHtcbiAgICAgICAgICAgICAgICBiYXR0bGVzID0gXy50YWtlKGJhdHRsZXMsIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfLmVhY2goYmF0dGxlcywgYmF0dGxlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRBbWJ1c2goYmF0dGxlKSAmJiBtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlLndpbGxBbWJ1c2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmF0dGxlcztcblxuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kRWZmZWN0aXZlQmF0dGxlcyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGZpbmFsQmF0dGxlTGlzdCA9IFtdO1xuXG4gICAgICAgIGNvbnN0IG9yZGVyZWRCYXR0bGVzID0gdGhpcy5nZXRPcmRlcmVkQmF0dGxlc0ZvclJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgc3RhdGUucmVnaW9ucywgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IHVzZWRSZWdpb25zID0ge307XG4gICAgICAgIGxldCBhbWJ1c2hlZCA9IGZhbHNlO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBvcmRlcmVkQmF0dGxlcywgKGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgICAgIHVzZWRSZWdpb25zW2JhdHRsZS5yZWdpb24uaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBmaW5hbEJhdHRsZUxpc3QucHVzaChiYXR0bGUuYmF0dGxlKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRBbWJ1c2goYmF0dGxlLmJhdHRsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYW1idXNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGFtYnVzaGVkKSB7XG4gICAgICAgICAgICBjb25zdCB1bnVzZWRSZWdpb25zID0gXy5yZWplY3Qoc3RhdGUucmVnaW9ucywgZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiB1c2VkUmVnaW9uc1tyZWdpb24uaWRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBub0FtYnVzaEJhdHRsZXMgPSB0aGlzLmdldE9yZGVyZWRCYXR0bGVzRm9yUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzLCB1bnVzZWRSZWdpb25zLCBmYWxzZSk7XG4gICAgICAgICAgICBmaW5hbEJhdHRsZUxpc3QucHVzaC5hcHBseShmaW5hbEJhdHRsZUxpc3QsIF8ubWFwKG5vQW1idXNoQmF0dGxlcywgJ2JhdHRsZScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLmZpbmQoXG4gICAgICAgICAgICAgICAgZmluYWxCYXR0bGVMaXN0LCAoYmF0dGxlUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzSGlnaGx5RWZmZWN0aXZlQmF0dGxlKGJhdHRsZVJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmaW5hbEJhdHRsZUxpc3Q7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0T3JkZXJlZEJhdHRsZXNGb3JSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJlZ2lvbnMsIGNhbkFtYnVzaCkge1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIHJldHVybiBfKHJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmaWVycy5mcmVlICYmIChhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPCAyICYmIHJlZ2lvbi5kZXZhc3RhdGVkKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBhZWR1aVBpZWNlcyA9IHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5maW5kKGFlZHVpUGllY2VzLCB7aXNNb2JpbGU6IHRydWV9KTtcbiAgICAgICAgICAgIH0pLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiYXR0bGVEYXRhID0gdGhpcy5maW5kQmVzdEJhdHRsZUZvclJlZ2lvbihzdGF0ZSwgcmVnaW9uLCBjYW5BbWJ1c2gpO1xuICAgICAgICAgICAgICAgIGlmIChiYXR0bGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBiYXR0bGVEYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlOiBiYXR0bGVEYXRhLmJhdHRsZVJlc3VsdFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kQmVzdEJhdHRsZUZvclJlZ2lvbihzdGF0ZSwgcmVnaW9uLCBjYW5BbWJ1c2gpIHtcbiAgICAgICAgY29uc3QgYWVkdWlGYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICByZXR1cm4gXyhFbmVteUZhY3Rpb25Qcmlvcml0eSkua2V5cygpLm1hcChcbiAgICAgICAgICAgIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUyAmJiBhZWR1aUZhY3Rpb24udmljdG9yeU1hcmdpbihzdGF0ZSkgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZW5lbXlQaWVjZXMgPSByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXTtcbiAgICAgICAgICAgICAgICBpZiAoZW5lbXlQaWVjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0dGxlUmVzdWx0ID0gQmF0dGxlLnRlc3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlbmRpbmdGYWN0aW9uSWQ6IGZhY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYW5BbWJ1c2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2ggPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRWZmZWN0aXZlQmF0dGxlKGJhdHRsZVJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5ID0gdGhpcy5nZXRCYXR0bGVQcmlvcml0eShiYXR0bGVSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGVSZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ3ByaW9yaXR5JykuZmlyc3QoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNIaWdobHlFZmZlY3RpdmVCYXR0bGUoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQud2lsbENhdXNlTGVhZGVyUmVtb3ZhbChiYXR0bGVSZXN1bHQuY2FuQW1idXNoKSB8fFxuICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0LndpbGxDYXVzZUFsbHlSZW1vdmFsKGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2gpIHx8XG4gICAgICAgICAgICAgICBiYXR0bGVSZXN1bHQud2lsbENhdXNlQ2l0YWRlbFJlbW92YWwoYmF0dGxlUmVzdWx0LmNhbkFtYnVzaCkgfHxcbiAgICAgICAgICAgICAgIGJhdHRsZVJlc3VsdC53aWxsQ2F1c2VMZWdpb25SZW1vdmFsKGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2gpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0VmZmVjdGl2ZUJhdHRsZShiYXR0bGVSZXN1bHQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNIaWdobHlFZmZlY3RpdmVCYXR0bGUoYmF0dGxlUmVzdWx0KSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy53aWxsQ2F1c2VFbm91Z2hEZWZlbmRlckxvc3NlcyhiYXR0bGVSZXN1bHQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBtb3N0RGVmZW5kZXJMb3NzZXMoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChiYXR0bGVSZXN1bHQud29yc3RDYXNlRGVmZW5kZXJMb3NzZXMubm9ybWFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgKGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2ggPyBiYXR0bGVSZXN1bHQud29yc3RDYXNlRGVmZW5kZXJMb3NzZXMuYW1idXNoIDogMCkpXG4gICAgfVxuXG4gICAgc3RhdGljIHdpbGxDYXVzZUVub3VnaERlZmVuZGVyTG9zc2VzKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+IDAgJiYgYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+PSBiYXR0bGVSZXN1bHQud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQuY2FuQW1idXNoICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPiAwICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPj0gYmF0dGxlUmVzdWx0LndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLmFtYnVzaDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0QmF0dGxlUHJpb3JpdHkoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IGVuZW15UHJpb3JpdHkgPSBFbmVteUZhY3Rpb25Qcmlvcml0eVtiYXR0bGVSZXN1bHQuZGVmZW5kaW5nRmFjdGlvbi5pZF07XG4gICAgICAgIGlmIChiYXR0bGVSZXN1bHQud2lsbENhdXNlTGVhZGVyUmVtb3ZhbChiYXR0bGVSZXN1bHQuY2FuQW1idXNoKSkge1xuICAgICAgICAgICAgcmV0dXJuICdhJyArIGVuZW15UHJpb3JpdHk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYmF0dGxlUmVzdWx0LndpbGxDYXVzZUFsbHlSZW1vdmFsKGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2gpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2InICsgZW5lbXlQcmlvcml0eTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYXR0bGVSZXN1bHQud2lsbENhdXNlQ2l0YWRlbFJlbW92YWwoYmF0dGxlUmVzdWx0LmNhbkFtYnVzaCkpIHtcbiAgICAgICAgICAgIHJldHVybiAnYycgKyBlbmVteVByaW9yaXR5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJhdHRsZVJlc3VsdC53aWxsQ2F1c2VMZWdpb25SZW1vdmFsKGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2gpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2QnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2lsbENhdXNlRW5vdWdoRGVmZW5kZXJMb3NzZXMoYmF0dGxlUmVzdWx0KSkge1xuICAgICAgICAgICAgcmV0dXJuICdlJyArICgxMDAgLSB0aGlzLm1vc3REZWZlbmRlckxvc3NlcyhiYXR0bGVSZXN1bHQpKSArIGVuZW15UHJpb3JpdHk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ2YnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIHNob3VsZEFtYnVzaChiYXR0bGVSZXN1bHQpIHtcbiAgICAgICAgaWYgKCFiYXR0bGVSZXN1bHQuY2FuQW1idXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFiYXR0bGVSZXN1bHQud2lsbENhdXNlTGVhZGVyUmVtb3ZhbCgpICYmIGJhdHRsZVJlc3VsdC53aWxsQ2F1c2VMZWFkZXJSZW1vdmFsKHRydWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWJhdHRsZVJlc3VsdC53aWxsQ2F1c2VBbGx5UmVtb3ZhbCgpICYmIGJhdHRsZVJlc3VsdC53aWxsQ2F1c2VBbGx5UmVtb3ZhbCh0cnVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFiYXR0bGVSZXN1bHQud2lsbENhdXNlQ2l0YWRlbFJlbW92YWwoKSAmJiBiYXR0bGVSZXN1bHQud2lsbENhdXNlQ2l0YWRlbFJlbW92YWwodHJ1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYmF0dGxlUmVzdWx0LndpbGxDYXVzZUxlZ2lvblJlbW92YWwoKSAmJiBiYXR0bGVSZXN1bHQud2lsbENhdXNlTGVnaW9uUmVtb3ZhbCh0cnVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5ub3JtYWwgPCBiYXR0bGVSZXN1bHQud29yc3RDYXNlRGVmZW5kZXJMb3NzZXMuYW1idXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0LndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLmFtYnVzaCA8IGJhdHRsZVJlc3VsdC53b3JzdENhc2VBdHRhY2tlckxvc3Nlcy5ub3JtYWwpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWVkdWlCYXR0bGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvYWVkdWlCYXR0bGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFLQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUlBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _bot = __webpack_require__(35);\n\nvar _bot2 = _interopRequireDefault(_bot);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _aeduiRaid = __webpack_require__(99);\n\nvar _aeduiRaid2 = _interopRequireDefault(_aeduiRaid);\n\nvar _aeduiRally = __webpack_require__(100);\n\nvar _aeduiRally2 = _interopRequireDefault(_aeduiRally);\n\nvar _aeduiMarch = __webpack_require__(98);\n\nvar _aeduiMarch2 = _interopRequireDefault(_aeduiMarch);\n\nvar _aeduiBattle = __webpack_require__(64);\n\nvar _aeduiBattle2 = _interopRequireDefault(_aeduiBattle);\n\nvar _aeduiEvent = __webpack_require__(97);\n\nvar _aeduiEvent2 = _interopRequireDefault(_aeduiEvent);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _pass = __webpack_require__(45);\n\nvar _pass2 = _interopRequireDefault(_pass);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Checkpoints = {\n    PASS_CHECK: 1,\n    EVENT_CHECK: 2,\n    BATTLE_CHECK: 3,\n    RALLY_CHECK: 4,\n    FIRST_RAID_CHECK: 5,\n    MARCH_CHECK: 6,\n    SECOND_RAID_CHECK: 7\n};\n\nvar AeduiBot = function (_Bot) {\n    _inherits(AeduiBot, _Bot);\n\n    function AeduiBot() {\n        _classCallCheck(this, AeduiBot);\n\n        return _possibleConstructorReturn(this, (AeduiBot.__proto__ || Object.getPrototypeOf(AeduiBot)).call(this, { factionId: _factionIds2.default.AEDUI }));\n    }\n\n    _createClass(AeduiBot, [{\n        key: 'willHarass',\n        value: function willHarass(factionId) {\n            return factionId === _factionIds2.default.ARVERNI;\n        }\n    }, {\n        key: 'takeTurn',\n        value: function takeTurn(state) {\n            var action = null;\n            var turn = state.turnHistory.currentTurn;\n\n            if (!turn.getCheckpoint(Checkpoints.PASS_CHECK) && this.shouldPassForNextCard(state)) {\n                action = _factionActions2.default.PASS;\n            }\n            turn.markCheckpoint(Checkpoints.PASS_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.EVENT_CHECK) && !action && turn.getContext().isCommandAllowed(_commandIds2.default.EVENT) && this.canPlayEvent(state) && _aeduiEvent2.default.handleEvent(state)) {\n                action = _factionActions2.default.EVENT;\n            }\n            turn.markCheckpoint(Checkpoints.EVENT_CHECK);\n\n            if (!action) {\n                action = this.executeCommand(state, turn);\n            }\n\n            if (action === _factionActions2.default.PASS) {\n                _pass2.default.execute(state, { factionId: _factionIds2.default.AEDUI });\n            }\n\n            state.sequenceOfPlay.recordFactionAction(_factionIds2.default.AEDUI, action);\n            return action;\n        }\n    }, {\n        key: 'executeCommand',\n        value: function executeCommand(state, turn) {\n            var commandAction = null;\n            var modifiers = turn.getContext();\n\n            if (!turn.getCheckpoint(Checkpoints.BATTLE_CHECK) && modifiers.isCommandAllowed(_commandIds2.default.BATTLE)) {\n                commandAction = _aeduiBattle2.default.battle(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.BATTLE_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.RALLY_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RALLY)) {\n                commandAction = _aeduiRally2.default.rally(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.RALLY_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.FIRST_RAID_CHECK) && !commandAction && state.aedui.resources() < 4 && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _aeduiRaid2.default.raid(state, modifiers) || _factionActions2.default.PASS;\n            }\n            turn.markCheckpoint(Checkpoints.FIRST_RAID_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                commandAction = _aeduiMarch2.default.march(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.SECOND_RAID_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _aeduiRaid2.default.raid(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.SECOND_RAID_CHECK);\n\n            commandAction = commandAction || _factionActions2.default.PASS;\n\n            return commandAction;\n        }\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {\n            var _this2 = this;\n\n            (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.devastated();\n            }).map(function (region) {\n                var pieces = region.piecesByFaction()[_this2.factionId] || [];\n                var hasAllyOrCitadel = _lodash2.default.find(pieces, function (piece) {\n                    return piece.type === 'alliedtribe' || piece.type === 'citadel';\n                });\n                if (!hasAllyOrCitadel && pieces.length) {\n                    return { region: region, pieces: pieces };\n                }\n            }).compact().each(function (relocation) {\n                var adjacentLocations = (0, _lodash2.default)(relocation.region.adjacent).reject(function (adjacentRegion) {\n                    return !adjacentRegion.controllingFactionId() || adjacentRegion.controllingFactionId() === _factionIds2.default.GERMANIC_TRIBES;\n                }).sortBy(function (destinations, factionId) {\n                    if (factionId === _factionIds2.default.AEDUI) {\n                        return 'a';\n                    } else if (factionId === _factionIds2.default.ROMANS) {\n                        return 'b';\n                    } else {\n                        return 'd';\n                    }\n                }).groupBy(function (adjacentRegion) {\n                    return adjacentRegion.controllingFactionId();\n                }).map(function (destinations, factionId) {\n                    var destination = _lodash2.default.sample(destinations);\n                    return { factionId: factionId, destination: destination };\n                }).value();\n\n                var moved = false;\n                _lodash2.default.each(adjacentLocations, function (location) {\n                    if (location.factionId === _this2.factionId || state.playersByFaction[location.factionId].willAgreeToQuarters(state, _this2.factionId)) {\n                        _movePieces2.default.execute(state, {\n                            sourceRegionId: relocation.region.id,\n                            destRegionId: location.destination.id,\n                            pieces: relocation.pieces\n                        });\n                        moved = true;\n                        return false;\n                    }\n                });\n\n                if (!moved) {\n                    var piecesToRemove = _lodash2.default.filter(relocation.pieces, function (piece) {\n                        return piece.type === 'warband' && _lodash2.default.random(1, 6) < 4;\n                    });\n\n                    if (piecesToRemove.length > 0) {\n                        _removePieces2.default.execute(state, {\n                            factionId: _this2.factionId,\n                            regionId: relocation.region.id,\n                            pieces: piecesToRemove\n                        });\n                    }\n                }\n            });\n        }\n    }, {\n        key: 'shouldPassForNextCard',\n        value: function shouldPassForNextCard(currentState) {\n            console.log('*** Aedui should pass for next card? ***');\n            return currentState.upcomingCard() && currentState.upcomingCard().type !== 'winter' && currentState.upcomingCard().initiativeOrder[0] === _factionIds2.default.AEDUI && currentState.currentCard().initiativeOrder[0] !== _factionIds2.default.AEDUI && _lodash2.default.random(1, 6) < 5;\n        }\n    }, {\n        key: 'willAgreeRomans',\n        value: function willAgreeRomans(state) {\n            if (state.playersByFaction[_factionIds2.default.ROMANS].isNonPlayer) {\n                return true;\n            } else {\n                var score = state.romans.victoryScore(state);\n                if (score < 10) {\n                    return true;\n                } else if (score >= 10 && score <= 12 && _lodash2.default.random(1, 6) < 5) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    }, {\n        key: 'willAgreeToQuarters',\n        value: function willAgreeToQuarters(state, factionId) {\n            if (factionId === _factionIds2.default.ROMANS) {\n                return this.willAgreeRomans(state);\n            }\n            return false;\n        }\n    }, {\n        key: 'willAgreeToRetreat',\n        value: function willAgreeToRetreat(state, factionId) {\n            if (factionId === _factionIds2.default.ROMANS) {\n                return this.willAgreeRomans(state);\n            }\n        }\n    }, {\n        key: 'willAgreeToSupplyLine',\n        value: function willAgreeToSupplyLine(state, factionId) {\n            if (factionId === _factionIds2.default.ROMANS) {\n                return this.willAgreeRomans(state);\n            }\n            return false;\n        }\n    }]);\n\n    return AeduiBot;\n}(_bot2.default);\n\nexports.default = AeduiBot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aUJvdC5qcz8yOWM5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3QgZnJvbSAnLi4vYm90JztcbmltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IEFlZHVpUmFpZCBmcm9tICcuL2FlZHVpUmFpZCc7XG5pbXBvcnQgQWVkdWlSYWxseSBmcm9tICcuL2FlZHVpUmFsbHknO1xuaW1wb3J0IEFlZHVpTWFyY2ggZnJvbSAnLi9hZWR1aU1hcmNoJztcbmltcG9ydCBBZWR1aUJhdHRsZSBmcm9tICcuL2FlZHVpQmF0dGxlJztcbmltcG9ydCBBZWR1aUV2ZW50IGZyb20gJy4vYWVkdWlFdmVudCc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBQYXNzIGZyb20gJy4uLy4uL2NvbW1hbmRzL3Bhc3MnO1xuXG5jb25zdCBDaGVja3BvaW50cyA9IHtcbiAgICBQQVNTX0NIRUNLOiAxLFxuICAgIEVWRU5UX0NIRUNLOiAyLFxuICAgIEJBVFRMRV9DSEVDSzogMyxcbiAgICBSQUxMWV9DSEVDSzogNCxcbiAgICBGSVJTVF9SQUlEX0NIRUNLOiA1LFxuICAgIE1BUkNIX0NIRUNLOiA2LFxuICAgIFNFQ09ORF9SQUlEX0NIRUNLOiA3XG59O1xuXG5jbGFzcyBBZWR1aUJvdCBleHRlbmRzIEJvdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQUVEVUl9KTtcbiAgICB9XG5cbiAgICB3aWxsSGFyYXNzKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFSVkVSTkk7XG4gICAgfVxuXG4gICAgdGFrZVR1cm4oc3RhdGUpIHtcbiAgICAgICAgbGV0IGFjdGlvbiA9IG51bGw7XG4gICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5jdXJyZW50VHVybjtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5QQVNTX0NIRUNLKSAmJiB0aGlzLnNob3VsZFBhc3NGb3JOZXh0Q2FyZChzdGF0ZSkpIHtcbiAgICAgICAgICAgIGFjdGlvbiA9IEZhY3Rpb25BY3Rpb25zLlBBU1M7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5QQVNTX0NIRUNLKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5FVkVOVF9DSEVDSykgJiYgIWFjdGlvbiAmJiB0dXJuLmdldENvbnRleHQoKS5pc0NvbW1hbmRBbGxvd2VkKFxuICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuRVZFTlQpICYmIHRoaXMuY2FuUGxheUV2ZW50KHN0YXRlKSAmJiBBZWR1aUV2ZW50LmhhbmRsZUV2ZW50KHN0YXRlKSkge1xuICAgICAgICAgICAgYWN0aW9uID0gRmFjdGlvbkFjdGlvbnMuRVZFTlQ7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5FVkVOVF9DSEVDSyk7XG5cbiAgICAgICAgaWYgKCFhY3Rpb24pIHtcbiAgICAgICAgICAgIGFjdGlvbiA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoc3RhdGUsIHR1cm4pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gRmFjdGlvbkFjdGlvbnMuUEFTUykge1xuICAgICAgICAgICAgUGFzcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJfSk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS5zZXF1ZW5jZU9mUGxheS5yZWNvcmRGYWN0aW9uQWN0aW9uKEZhY3Rpb25JRHMuQUVEVUksIGFjdGlvbik7XG4gICAgICAgIHJldHVybiBhY3Rpb247XG4gICAgfVxuXG4gICAgZXhlY3V0ZUNvbW1hbmQoc3RhdGUsIHR1cm4pIHtcbiAgICAgICAgbGV0IGNvbW1hbmRBY3Rpb24gPSBudWxsO1xuICAgICAgICBjb25zdCBtb2RpZmllcnMgPSB0dXJuLmdldENvbnRleHQoKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ0hFQ0spICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKENvbW1hbmRJRHMuQkFUVExFKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEFlZHVpQmF0dGxlLmJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLkJBVFRMRV9DSEVDSyk7XG5cbiAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkFMTFlfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKFxuICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuUkFMTFkpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQWVkdWlSYWxseS5yYWxseShzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlJBTExZX0NIRUNLKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChcbiAgICAgICAgICAgICAgICBDaGVja3BvaW50cy5GSVJTVF9SQUlEX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBzdGF0ZS5hZWR1aS5yZXNvdXJjZXMoKSA8IDQgJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgQ29tbWFuZElEcy5SQUlEKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEFlZHVpUmFpZC5yYWlkKHN0YXRlLCBtb2RpZmllcnMpIHx8IEZhY3Rpb25BY3Rpb25zLlBBU1M7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5GSVJTVF9SQUlEX0NIRUNLKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5NQVJDSF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgQ29tbWFuZElEcy5NQVJDSCkpIHtcbiAgICAgICAgICAgIGNvbW1hbmRBY3Rpb24gPSBBZWR1aU1hcmNoLm1hcmNoKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuTUFSQ0hfQ0hFQ0spO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFQ09ORF9SQUlEX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBtb2RpZmllcnMuaXNDb21tYW5kQWxsb3dlZChcbiAgICAgICAgICAgICAgICBDb21tYW5kSURzLlJBSUQpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQWVkdWlSYWlkLnJhaWQoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5TRUNPTkRfUkFJRF9DSEVDSyk7XG5cbiAgICAgICAgY29tbWFuZEFjdGlvbiA9IGNvbW1hbmRBY3Rpb24gfHwgRmFjdGlvbkFjdGlvbnMuUEFTUztcblxuICAgICAgICByZXR1cm4gY29tbWFuZEFjdGlvblxuICAgIH1cblxuICAgIHF1YXJ0ZXJzKHN0YXRlKSB7XG4gICAgICAgIF8oc3RhdGUucmVnaW9ucykuZmlsdGVyKGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiByZWdpb24uZGV2YXN0YXRlZCgpO1xuICAgICAgICB9KS5tYXAoKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW3RoaXMuZmFjdGlvbklkXSB8fCBbXTtcbiAgICAgICAgICAgIGNvbnN0IGhhc0FsbHlPckNpdGFkZWwgPSBfLmZpbmQocGllY2VzLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ2FsbGllZHRyaWJlJyB8fCBwaWVjZS50eXBlID09PSAnY2l0YWRlbCc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghaGFzQWxseU9yQ2l0YWRlbCAmJiBwaWVjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtyZWdpb24sIHBpZWNlc307XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS5lYWNoKChyZWxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhZGphY2VudExvY2F0aW9ucyA9IF8ocmVsb2NhdGlvbi5yZWdpb24uYWRqYWNlbnQpLnJlamVjdChmdW5jdGlvbiAoYWRqYWNlbnRSZWdpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgfHwgYWRqYWNlbnRSZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVM7XG4gICAgICAgICAgICB9KS5zb3J0QnkoZnVuY3Rpb24gKGRlc3RpbmF0aW9ucywgZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5BRURVSSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2EnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2QnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmdyb3VwQnkoZnVuY3Rpb24gKGFkamFjZW50UmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCk7XG4gICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGRlc3RpbmF0aW9ucywgZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb24gPSBfLnNhbXBsZShkZXN0aW5hdGlvbnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7ZmFjdGlvbklkLCBkZXN0aW5hdGlvbn07XG4gICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgICAgICBsZXQgbW92ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIF8uZWFjaChhZGphY2VudExvY2F0aW9ucywgKGxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmZhY3Rpb25JZCA9PT0gdGhpcy5mYWN0aW9uSWQgfHwgc3RhdGUucGxheWVyc0J5RmFjdGlvbltsb2NhdGlvbi5mYWN0aW9uSWRdLndpbGxBZ3JlZVRvUXVhcnRlcnMoXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwgdGhpcy5mYWN0aW9uSWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IHJlbG9jYXRpb24ucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBsb2NhdGlvbi5kZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogcmVsb2NhdGlvbi5waWVjZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1vdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIW1vdmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2VzVG9SZW1vdmUgPSBfLmZpbHRlcihyZWxvY2F0aW9uLnBpZWNlcywgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgJiYgXy5yYW5kb20oMSwgNikgPCA0O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlc1RvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVsb2NhdGlvbi5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1RvUmVtb3ZlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2hvdWxkUGFzc0Zvck5leHRDYXJkKGN1cnJlbnRTdGF0ZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEFlZHVpIHNob3VsZCBwYXNzIGZvciBuZXh0IGNhcmQ/ICoqKicpO1xuICAgICAgICByZXR1cm4gY3VycmVudFN0YXRlLnVwY29taW5nQ2FyZCgpICYmIGN1cnJlbnRTdGF0ZS51cGNvbWluZ0NhcmQoKS50eXBlICE9PSAnd2ludGVyJyAmJiBjdXJyZW50U3RhdGUudXBjb21pbmdDYXJkKCkuaW5pdGlhdGl2ZU9yZGVyWzBdID09PSBGYWN0aW9uSURzLkFFRFVJICYmXG4gICAgICAgICAgICAgICBjdXJyZW50U3RhdGUuY3VycmVudENhcmQoKS5pbml0aWF0aXZlT3JkZXJbMF0gIT09IEZhY3Rpb25JRHMuQUVEVUkgJiZcbiAgICAgICAgICAgICAgIF8ucmFuZG9tKDEsIDYpIDwgNTtcbiAgICB9XG5cbiAgICB3aWxsQWdyZWVSb21hbnMoc3RhdGUpIHtcbiAgICAgICAgaWYgKHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5ST01BTlNdLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gc3RhdGUucm9tYW5zLnZpY3RvcnlTY29yZShzdGF0ZSk7XG4gICAgICAgICAgICBpZiAoc2NvcmUgPCAxMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2NvcmUgPj0gMTAgJiYgc2NvcmUgPD0gMTIgJiYgXy5yYW5kb20oMSwgNikgPCA1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHdpbGxBZ3JlZVRvUXVhcnRlcnMoc3RhdGUsIGZhY3Rpb25JZCkge1xuICAgICAgICBpZiAoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2lsbEFncmVlUm9tYW5zKHN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9SZXRyZWF0KHN0YXRlLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgaWYgKGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndpbGxBZ3JlZVJvbWFucyhzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB3aWxsQWdyZWVUb1N1cHBseUxpbmUoc3RhdGUsIGZhY3Rpb25JZCkge1xuICAgICAgICBpZiAoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2lsbEFncmVlUm9tYW5zKHN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBZWR1aUJvdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aUJvdC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQUNBO0FBU0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBRUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFHQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _bot = __webpack_require__(35);\n\nvar _bot2 = _interopRequireDefault(_bot);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _arverniEvent = __webpack_require__(127);\n\nvar _arverniEvent2 = _interopRequireDefault(_arverniEvent);\n\nvar _arverniBattle = __webpack_require__(126);\n\nvar _arverniBattle2 = _interopRequireDefault(_arverniBattle);\n\nvar _arverniRally = __webpack_require__(67);\n\nvar _arverniRally2 = _interopRequireDefault(_arverniRally);\n\nvar _arverniRaid = __webpack_require__(128);\n\nvar _arverniRaid2 = _interopRequireDefault(_arverniRaid);\n\nvar _arverniMarch = __webpack_require__(51);\n\nvar _arverniMarch2 = _interopRequireDefault(_arverniMarch);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _pass = __webpack_require__(45);\n\nvar _pass2 = _interopRequireDefault(_pass);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Checkpoints = {\n    BATTLE_CHECK: 'battle',\n    THREAT_MARCH_CHECK: 'threat-march',\n    EVENT_CHECK: 'event',\n    RALLY_CHECK: 'rally',\n    SPREAD_MARCH_CHECK: 'spread-march',\n    FIRST_RAID_CHECK: 'first-raid',\n    MASS_MARCH_CHECK: 'mass-march',\n    SECOND_RAID_CHECK: 'second-raid'\n\n};\n\nvar ArverniBot = function (_Bot) {\n    _inherits(ArverniBot, _Bot);\n\n    function ArverniBot() {\n        _classCallCheck(this, ArverniBot);\n\n        return _possibleConstructorReturn(this, (ArverniBot.__proto__ || Object.getPrototypeOf(ArverniBot)).call(this, { factionId: _factionIds2.default.ARVERNI }));\n    }\n\n    _createClass(ArverniBot, [{\n        key: 'takeTurn',\n        value: function takeTurn(state) {\n            var commandAction = null;\n            var turn = state.turnHistory.currentTurn;\n            var modifiers = turn.getContext();\n\n            if (!turn.getCheckpoint(Checkpoints.BATTLE_CHECK) && modifiers.isCommandAllowed(_commandIds2.default.BATTLE)) {\n                commandAction = _arverniBattle2.default.battle(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.BATTLE_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.THREAT_MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH) && modifiers.context.tryThreatMarch) {\n                commandAction = _arverniMarch2.default.march(state, modifiers, 'threat');\n            }\n            turn.markCheckpoint(Checkpoints.THREAT_MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.EVENT_CHECK) && !commandAction && this.canPlayEvent(state) && _arverniEvent2.default.handleEvent(state)) {\n                commandAction = _factionActions2.default.EVENT;\n            }\n            turn.markCheckpoint(Checkpoints.EVENT_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.RALLY_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RALLY)) {\n                commandAction = _arverniRally2.default.rally(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.RALLY_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.SPREAD_MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                commandAction = _arverniMarch2.default.march(state, modifiers, 'spread');\n            }\n            turn.markCheckpoint(Checkpoints.SPREAD_MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.FIRST_RAID_CHECK) && !commandAction && state.arverni.resources() < 4 && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _arverniRaid2.default.raid(state, modifiers) || _factionActions2.default.PASS;\n            }\n            turn.markCheckpoint(Checkpoints.FIRST_RAID_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.MASS_MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                commandAction = _arverniMarch2.default.march(state, modifiers, 'mass');\n            }\n            turn.markCheckpoint(Checkpoints.MASS_MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.SECOND_RAID_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _arverniRaid2.default.raid(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.SECOND_RAID_CHECK);\n\n            commandAction = commandAction || _factionActions2.default.PASS;\n\n            if (commandAction === _factionActions2.default.PASS) {\n                _pass2.default.execute(state, { factionId: _factionIds2.default.ARVERNI });\n            }\n\n            state.sequenceOfPlay.recordFactionAction(_factionIds2.default.ARVERNI, commandAction);\n            return commandAction;\n        }\n    }, {\n        key: 'willHarass',\n        value: function willHarass(factionId) {\n            return factionId === _factionIds2.default.ROMANS;\n        }\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {\n            var _this2 = this;\n\n            var devastatedMoveRegions = (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.devastated();\n            }).map(function (region) {\n                var alliesAndCitadel = region.getAlliesAndCitadelForFaction(_this2.factionId);\n                var warbands = region.getWarbandsOrAuxiliaForFaction(_this2.factionId);\n                var leader = region.getLeaderForFaction(_this2.factionId);\n\n                if (alliesAndCitadel.length > 0) {\n                    return;\n                }\n\n                if (warbands.length === 0 && !leader) {\n                    return;\n                }\n\n                var targets = _this2.getValidQuartersTargetsForRegion(state, region);\n\n                return {\n                    region: region,\n                    warbands: warbands,\n                    leader: leader,\n                    targets: targets\n                };\n            }).compact().value();\n\n            var leaderWillDoDevastationMove = _lodash2.default.find(devastatedMoveRegions, 'leader');\n            var leaderRegion = this.findLeaderRegion(state);\n\n            var massTarget = null;\n            if (leaderRegion) {\n                var massTargets = this.getValidQuartersTargetsForRegion(state, leaderRegion);\n                if (!leaderWillDoDevastationMove) {\n                    massTargets.push(leaderRegion);\n                }\n\n                massTarget = (0, _lodash2.default)(massTargets).map(function (region) {\n                    var numWarbands = _lodash2.default.reduce(devastatedMoveRegions, function (sum, sourceRegion) {\n                        if (_lodash2.default.find(_lodash2.default.map(sourceRegion.targets), function (target) {\n                            return target.id === region.id;\n                        })) {\n                            return sum + sourceRegion.region.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        } else {\n                            return sum;\n                        }\n                    }, region.getWarbandsOrAuxiliaForFaction(_this2.factionId).length);\n\n                    var nonDevastatedMove = null;\n                    if (region.id === leaderRegion.id) {\n                        nonDevastatedMove = (0, _lodash2.default)(leaderRegion.adjacent).reject(function (adjacent) {\n                            return adjacent.devastated() || adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length < 1;\n                        }).map(function (adjacent) {\n                            var numWarbands = adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                            var controlMargin = adjacent.controllingMarginByFaction()[_this2.factionId];\n                            var numToMove = controlMargin < 1 ? numWarbands - 1 : Math.min(numWarbands - 1, controlMargin - 1);\n\n                            if (numToMove <= 0) {\n                                return;\n                            }\n\n                            return {\n                                region: adjacent,\n                                numToMove: numToMove\n                            };\n                        }).compact().sortBy('numToMove').reverse().first();\n                    } else if (!leaderWillDoDevastationMove) {\n                        var numLeaderRegionWarbands = leaderRegion.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        var leaderRegionControlMargin = leaderRegion.controllingMarginByFaction()[_this2.factionId];\n                        var leaderRegionNumToMove = leaderRegionControlMargin < 1 ? numLeaderRegionWarbands - 1 : Math.min(numLeaderRegionWarbands - 1, leaderRegionControlMargin - 2);\n\n                        if (leaderRegionNumToMove > 0) {\n                            nonDevastatedMove = {\n                                region: leaderRegion,\n                                numToMove: leaderRegionNumToMove,\n                                leader: true\n                            };\n                        }\n                    }\n\n                    if (nonDevastatedMove) {\n                        numWarbands += nonDevastatedMove.numToMove;\n                    }\n\n                    var numAdjacentWarbands = (0, _lodash2.default)(region.adjacent).reject(function (adjacent) {\n                        return _lodash2.default.find(devastatedMoveRegions, { id: adjacent.id });\n                    }).reduce(function (sum, adjacent) {\n                        if (nonDevastatedMove && adjacent.id === nonDevastatedMove.id) {\n                            return sum + adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length - nonDevastatedMove.numToMove;\n                        } else {\n                            return sum + adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        }\n                    }, 0);\n\n                    var priority = 99 - numWarbands + '-' + (99 - numAdjacentWarbands);\n\n                    return {\n                        region: region,\n                        nonDevastatedMove: nonDevastatedMove,\n                        priority: priority\n                    };\n                }).sortBy('priority').first();\n            }\n\n            _lodash2.default.each(devastatedMoveRegions, function (moveRegion) {\n                var destRegionId = null;\n                if (massTarget && _lodash2.default.find(moveRegion.targets, function (target) {\n                    return target.id === massTarget.region.id;\n                })) {\n                    destRegionId = massTarget.region.id;\n                } else if (moveRegion.targets.length > 0) {\n                    if (massTarget) {\n                        destRegionId = (0, _lodash2.default)(moveRegion.targets).shuffle().sortBy(function (target) {\n                            return _map2.default.measureDistanceToRegion(state, moveRegion.region.id, target.id);\n                        }).first().id;\n                    } else {\n                        destRegionId = _lodash2.default.sample(moveRegion.targets).id;\n                    }\n                }\n\n                if (!destRegionId) {\n                    return;\n                }\n\n                var pieces = moveRegion.region.getMobilePiecesForFaction(_this2.factionId);\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: moveRegion.region.id,\n                    destRegionId: destRegionId,\n                    pieces: pieces\n                });\n            });\n\n            if (massTarget && massTarget.nonDevastatedMove) {\n                var warbands = massTarget.nonDevastatedMove.region.getWarbandsOrAuxiliaForFaction(this.factionId);\n                var leader = massTarget.nonDevastatedMove.region.getLeaderForFaction(this.factionId);\n                var pieces = leader ? _lodash2.default.concat(warbands, [leader]) : warbands;\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: massTarget.nonDevastatedMove.region.id,\n                    destRegionId: massTarget.region.id,\n                    pieces: pieces\n                });\n            }\n\n            _lodash2.default.each(state.region, function (region) {\n                if (!region.devastated()) {\n                    return;\n                }\n\n                var piecesToRemove = _lodash2.default.filter(region.getWarbandsOrAuxiliaForFaction(_this2.factionId), function (warband) {\n                    return _lodash2.default.random(1, 6) < 4;\n                });\n\n                if (piecesToRemove.length > 0) {\n                    _removePieces2.default.execute(state, {\n                        factionId: _this2.factionId,\n                        regionId: region.id,\n                        pieces: piecesToRemove\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'getValidQuartersTargetsForRegion',\n        value: function getValidQuartersTargetsForRegion(state, region) {\n            var _this3 = this;\n\n            return (0, _lodash2.default)(region.adjacent).reject(function (adjacentRegion) {\n                return adjacentRegion.devastated() || !adjacentRegion.controllingFactionId() || adjacentRegion.controllingFactionId() === _factionIds2.default.GERMANIC_TRIBES;\n            }).filter(function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() === _this3.factionId || state.playersByFaction[adjacentRegion.controllingFactionId()].willAgreeToQuarters(state, _this3.factionId);\n            }).value();\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            var _this4 = this;\n\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_this4.factionId], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return ArverniBot;\n}(_bot2.default);\n\nexports.default = ArverniBot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlCb3QuanM/NTRkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsaWIvbG9kYXNoJztcbmltcG9ydCBCb3QgZnJvbSAnLi4vYm90JztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBBcnZlcm5pRXZlbnQgZnJvbSAnLi9hcnZlcm5pRXZlbnQnO1xuaW1wb3J0IEFydmVybmlCYXR0bGUgZnJvbSAnLi9hcnZlcm5pQmF0dGxlJztcbmltcG9ydCBBcnZlcm5pUmFsbHkgZnJvbSAnLi9hcnZlcm5pUmFsbHknO1xuaW1wb3J0IEFydmVybmlSYWlkIGZyb20gJy4vYXJ2ZXJuaVJhaWQnO1xuaW1wb3J0IEFydmVybmlNYXJjaCBmcm9tICcuL2FydmVybmlNYXJjaCc7XG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBQYXNzIGZyb20gJy4uLy4uL2NvbW1hbmRzL3Bhc3MnO1xuaW1wb3J0IE1vdmVQaWVjZXMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL21vdmVQaWVjZXMnO1xuaW1wb3J0IFJlbW92ZVBpZWNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBNYXAgZnJvbSAnZmFsbGluZ3NreS91dGlsL21hcCc7XG5cbmNvbnN0IENoZWNrcG9pbnRzID0ge1xuICAgIEJBVFRMRV9DSEVDSzogJ2JhdHRsZScsXG4gICAgVEhSRUFUX01BUkNIX0NIRUNLOiAndGhyZWF0LW1hcmNoJyxcbiAgICBFVkVOVF9DSEVDSzogJ2V2ZW50JyxcbiAgICBSQUxMWV9DSEVDSzogJ3JhbGx5JyxcbiAgICBTUFJFQURfTUFSQ0hfQ0hFQ0s6ICdzcHJlYWQtbWFyY2gnLFxuICAgIEZJUlNUX1JBSURfQ0hFQ0s6ICdmaXJzdC1yYWlkJyxcbiAgICBNQVNTX01BUkNIX0NIRUNLOiAnbWFzcy1tYXJjaCcsXG4gICAgU0VDT05EX1JBSURfQ0hFQ0s6ICdzZWNvbmQtcmFpZCdcblxufTtcblxuY2xhc3MgQXJ2ZXJuaUJvdCBleHRlbmRzIEJvdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQVJWRVJOSX0pO1xuICAgIH1cblxuICAgIHRha2VUdXJuKHN0YXRlKSB7XG4gICAgICAgIGxldCBjb21tYW5kQWN0aW9uID0gbnVsbDtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmN1cnJlbnRUdXJuO1xuICAgICAgICBjb25zdCBtb2RpZmllcnMgPSB0dXJuLmdldENvbnRleHQoKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ0hFQ0spICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKENvbW1hbmRJRHMuQkFUVExFKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEFydmVybmlCYXR0bGUuYmF0dGxlKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuQkFUVExFX0NIRUNLKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5USFJFQVRfTUFSQ0hfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKFxuICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuTUFSQ0gpICYmIG1vZGlmaWVycy5jb250ZXh0LnRyeVRocmVhdE1hcmNoKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQXJ2ZXJuaU1hcmNoLm1hcmNoKHN0YXRlLCBtb2RpZmllcnMsICd0aHJlYXQnKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlRIUkVBVF9NQVJDSF9DSEVDSyk7XG5cbiAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuRVZFTlRfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIHRoaXMuY2FuUGxheUV2ZW50KFxuICAgICAgICAgICAgICAgIHN0YXRlKSAmJiBBcnZlcm5pRXZlbnQuaGFuZGxlRXZlbnQoc3RhdGUpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gRmFjdGlvbkFjdGlvbnMuRVZFTlQ7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5FVkVOVF9DSEVDSyk7XG5cbiAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkFMTFlfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKFxuICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuUkFMTFkpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQXJ2ZXJuaVJhbGx5LnJhbGx5KHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkFMTFlfQ0hFQ0spO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlNQUkVBRF9NQVJDSF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgQ29tbWFuZElEcy5NQVJDSCkpIHtcbiAgICAgICAgICAgIGNvbW1hbmRBY3Rpb24gPSBBcnZlcm5pTWFyY2gubWFyY2goc3RhdGUsIG1vZGlmaWVycywgJ3NwcmVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuU1BSRUFEX01BUkNIX0NIRUNLKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChcbiAgICAgICAgICAgICAgICBDaGVja3BvaW50cy5GSVJTVF9SQUlEX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBzdGF0ZS5hcnZlcm5pLnJlc291cmNlcygpIDwgNCAmJiBtb2RpZmllcnMuaXNDb21tYW5kQWxsb3dlZChcbiAgICAgICAgICAgICAgICBDb21tYW5kSURzLlJBSUQpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQXJ2ZXJuaVJhaWQucmFpZChzdGF0ZSwgbW9kaWZpZXJzKSB8fCBGYWN0aW9uQWN0aW9ucy5QQVNTO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuRklSU1RfUkFJRF9DSEVDSyk7XG5cbiAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuTUFTU19NQVJDSF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgQ29tbWFuZElEcy5NQVJDSCkpIHtcbiAgICAgICAgICAgIGNvbW1hbmRBY3Rpb24gPSBBcnZlcm5pTWFyY2gubWFyY2goc3RhdGUsIG1vZGlmaWVycywgJ21hc3MnKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLk1BU1NfTUFSQ0hfQ0hFQ0spO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFQ09ORF9SQUlEX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBtb2RpZmllcnMuaXNDb21tYW5kQWxsb3dlZChcbiAgICAgICAgICAgICAgICBDb21tYW5kSURzLlJBSUQpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gQXJ2ZXJuaVJhaWQucmFpZChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFQ09ORF9SQUlEX0NIRUNLKTtcblxuICAgICAgICBjb21tYW5kQWN0aW9uID0gY29tbWFuZEFjdGlvbiB8fCBGYWN0aW9uQWN0aW9ucy5QQVNTO1xuXG4gICAgICAgIGlmIChjb21tYW5kQWN0aW9uID09PSBGYWN0aW9uQWN0aW9ucy5QQVNTKSB7XG4gICAgICAgICAgICBQYXNzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQVJWRVJOSX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUuc2VxdWVuY2VPZlBsYXkucmVjb3JkRmFjdGlvbkFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkksIGNvbW1hbmRBY3Rpb24pO1xuICAgICAgICByZXR1cm4gY29tbWFuZEFjdGlvbjtcbiAgICB9XG5cbiAgICB3aWxsSGFyYXNzKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUztcbiAgICB9XG5cbiAgICBxdWFydGVycyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBkZXZhc3RhdGVkTW92ZVJlZ2lvbnMgPSBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcigocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVnaW9uLmRldmFzdGF0ZWQoKTtcbiAgICAgICAgfSkubWFwKChyZWdpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFsbGllc0FuZENpdGFkZWwgPSByZWdpb24uZ2V0QWxsaWVzQW5kQ2l0YWRlbEZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgY29uc3Qgd2FyYmFuZHMgPSByZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIGNvbnN0IGxlYWRlciA9IHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcblxuICAgICAgICAgICAgaWYgKGFsbGllc0FuZENpdGFkZWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHdhcmJhbmRzLmxlbmd0aCA9PT0gMCAmJiAhbGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB0YXJnZXRzID0gdGhpcy5nZXRWYWxpZFF1YXJ0ZXJzVGFyZ2V0c0ZvclJlZ2lvbihzdGF0ZSwgcmVnaW9uKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgd2FyYmFuZHMsXG4gICAgICAgICAgICAgICAgbGVhZGVyLFxuICAgICAgICAgICAgICAgIHRhcmdldHNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3QgbGVhZGVyV2lsbERvRGV2YXN0YXRpb25Nb3ZlID0gXy5maW5kKGRldmFzdGF0ZWRNb3ZlUmVnaW9ucywgJ2xlYWRlcicpO1xuICAgICAgICBjb25zdCBsZWFkZXJSZWdpb24gPSB0aGlzLmZpbmRMZWFkZXJSZWdpb24oc3RhdGUpO1xuXG4gICAgICAgIGxldCBtYXNzVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgaWYgKGxlYWRlclJlZ2lvbikge1xuICAgICAgICAgICAgY29uc3QgbWFzc1RhcmdldHMgPSB0aGlzLmdldFZhbGlkUXVhcnRlcnNUYXJnZXRzRm9yUmVnaW9uKHN0YXRlLCBsZWFkZXJSZWdpb24pO1xuICAgICAgICAgICAgaWYgKCFsZWFkZXJXaWxsRG9EZXZhc3RhdGlvbk1vdmUpIHtcbiAgICAgICAgICAgICAgICBtYXNzVGFyZ2V0cy5wdXNoKGxlYWRlclJlZ2lvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1hc3NUYXJnZXQgPSBfKG1hc3NUYXJnZXRzKS5tYXAocmVnaW9uID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbnVtV2FyYmFuZHMgPSBfLnJlZHVjZShkZXZhc3RhdGVkTW92ZVJlZ2lvbnMsIChzdW0sIHNvdXJjZVJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXy5maW5kKF8ubWFwKHNvdXJjZVJlZ2lvbi50YXJnZXRzKSwgdGFyZ2V0ID0+IHRhcmdldC5pZCA9PT0gcmVnaW9uLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHNvdXJjZVJlZ2lvbi5yZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCkubGVuZ3RoKTtcblxuICAgICAgICAgICAgICAgIGxldCBub25EZXZhc3RhdGVkTW92ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbi5pZCA9PT0gbGVhZGVyUmVnaW9uLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vbkRldmFzdGF0ZWRNb3ZlID0gXyhsZWFkZXJSZWdpb24uYWRqYWNlbnQpLnJlamVjdChhZGphY2VudCA9PiBhZGphY2VudC5kZXZhc3RhdGVkKCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkamFjZW50LmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhY3Rpb25JZCkubGVuZ3RoIDwgMSkubWFwKFxuICAgICAgICAgICAgICAgICAgICAgICAgYWRqYWNlbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bVdhcmJhbmRzID0gYWRqYWNlbnQuZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udHJvbE1hcmdpbiA9IGFkamFjZW50LmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bVRvTW92ZSA9IGNvbnRyb2xNYXJnaW4gPCAxID8gbnVtV2FyYmFuZHMgLSAxIDogTWF0aC5taW4obnVtV2FyYmFuZHMgLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbE1hcmdpbiAtIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobnVtVG9Nb3ZlIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogYWRqYWNlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVRvTW92ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdudW1Ub01vdmUnKS5yZXZlcnNlKCkuZmlyc3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIWxlYWRlcldpbGxEb0RldmFzdGF0aW9uTW92ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1MZWFkZXJSZWdpb25XYXJiYW5kcyA9IGxlYWRlclJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWFkZXJSZWdpb25Db250cm9sTWFyZ2luID0gbGVhZGVyUmVnaW9uLmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWFkZXJSZWdpb25OdW1Ub01vdmUgPSBsZWFkZXJSZWdpb25Db250cm9sTWFyZ2luIDwgMSA/IG51bUxlYWRlclJlZ2lvbldhcmJhbmRzIC0gMSA6IE1hdGgubWluKFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtTGVhZGVyUmVnaW9uV2FyYmFuZHMgLSAxLCBsZWFkZXJSZWdpb25Db250cm9sTWFyZ2luIC0gMik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYobGVhZGVyUmVnaW9uTnVtVG9Nb3ZlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9uRGV2YXN0YXRlZE1vdmUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBsZWFkZXJSZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtVG9Nb3ZlOiBsZWFkZXJSZWdpb25OdW1Ub01vdmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhZGVyOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobm9uRGV2YXN0YXRlZE1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtV2FyYmFuZHMgKz0gbm9uRGV2YXN0YXRlZE1vdmUubnVtVG9Nb3ZlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG51bUFkamFjZW50V2FyYmFuZHMgPSBfKHJlZ2lvbi5hZGphY2VudCkucmVqZWN0KFxuICAgICAgICAgICAgICAgICAgICBhZGphY2VudCA9PiBfLmZpbmQoZGV2YXN0YXRlZE1vdmVSZWdpb25zLCB7aWQ6IGFkamFjZW50LmlkfSkpLnJlZHVjZSgoc3VtLCBhZGphY2VudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9uRGV2YXN0YXRlZE1vdmUgJiYgYWRqYWNlbnQuaWQgPT09IG5vbkRldmFzdGF0ZWRNb3ZlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgYWRqYWNlbnQuZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhY3Rpb25JZCkubGVuZ3RoIC0gbm9uRGV2YXN0YXRlZE1vdmUubnVtVG9Nb3ZlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIGFkamFjZW50LmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwcmlvcml0eSA9ICg5OSAtIG51bVdhcmJhbmRzKSArICctJyArICg5OSAtIG51bUFkamFjZW50V2FyYmFuZHMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICBub25EZXZhc3RhdGVkTW92ZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZmlyc3QoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKGRldmFzdGF0ZWRNb3ZlUmVnaW9ucywgbW92ZVJlZ2lvbiA9PiB7XG4gICAgICAgICAgICBsZXQgZGVzdFJlZ2lvbklkID0gbnVsbDtcbiAgICAgICAgICAgIGlmKG1hc3NUYXJnZXQgJiYgXy5maW5kKG1vdmVSZWdpb24udGFyZ2V0cywgdGFyZ2V0PT4gdGFyZ2V0LmlkID09PSBtYXNzVGFyZ2V0LnJlZ2lvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQgPSBtYXNzVGFyZ2V0LnJlZ2lvbi5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYobW92ZVJlZ2lvbi50YXJnZXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZihtYXNzVGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZCA9IF8obW92ZVJlZ2lvbi50YXJnZXRzKS5zaHVmZmxlKCkuc29ydEJ5KHRhcmdldD0+IE1hcC5tZWFzdXJlRGlzdGFuY2VUb1JlZ2lvbihzdGF0ZSxtb3ZlUmVnaW9uLnJlZ2lvbi5pZCwgdGFyZ2V0LmlkKSkuZmlyc3QoKS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZCA9IF8uc2FtcGxlKG1vdmVSZWdpb24udGFyZ2V0cykuaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZighZGVzdFJlZ2lvbklkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBwaWVjZXMgPSBtb3ZlUmVnaW9uLnJlZ2lvbi5nZXRNb2JpbGVQaWVjZXNGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IG1vdmVSZWdpb24ucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBkZXN0UmVnaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYobWFzc1RhcmdldCAmJiBtYXNzVGFyZ2V0Lm5vbkRldmFzdGF0ZWRNb3ZlKSB7XG4gICAgICAgICAgICBjb25zdCB3YXJiYW5kcyA9IG1hc3NUYXJnZXQubm9uRGV2YXN0YXRlZE1vdmUucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICBjb25zdCBsZWFkZXIgPSBtYXNzVGFyZ2V0Lm5vbkRldmFzdGF0ZWRNb3ZlLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IGxlYWRlciA/IF8uY29uY2F0KHdhcmJhbmRzLCBbbGVhZGVyXSkgOiB3YXJiYW5kcztcbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IG1hc3NUYXJnZXQubm9uRGV2YXN0YXRlZE1vdmUucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBtYXNzVGFyZ2V0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogcGllY2VzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKHN0YXRlLnJlZ2lvbiwgcmVnaW9uPT4ge1xuICAgICAgICAgICAgaWYoIXJlZ2lvbi5kZXZhc3RhdGVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHBpZWNlc1RvUmVtb3ZlID0gXy5maWx0ZXIocmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCksIHdhcmJhbmQgPT4gXy5yYW5kb20oMSw2KSA8IDQpO1xuXG4gICAgICAgICAgICBpZiAocGllY2VzVG9SZW1vdmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1RvUmVtb3ZlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGdldFZhbGlkUXVhcnRlcnNUYXJnZXRzRm9yUmVnaW9uKHN0YXRlLCByZWdpb24pIHtcbiAgICAgICAgcmV0dXJuIF8ocmVnaW9uLmFkamFjZW50KS5yZWplY3QoKGFkamFjZW50UmVnaW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYWRqYWNlbnRSZWdpb24uZGV2YXN0YXRlZCgpIHx8ICFhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpIHx8IGFkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTO1xuICAgICAgICB9KS5maWx0ZXIoYWRqYWNlbnRSZWdpb249PiBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSB0aGlzLmZhY3Rpb25JZCB8fCBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2FkamFjZW50UmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCldLndpbGxBZ3JlZVRvUXVhcnRlcnMoc3RhdGUsdGhpcy5mYWN0aW9uSWQpKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIGZpbmRMZWFkZXJSZWdpb24oc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChzdGF0ZS5yZWdpb25zLCAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gXy5maW5kKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVt0aGlzLmZhY3Rpb25JZF0sIHt0eXBlOiAnbGVhZGVyJ30pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFydmVybmlCb3Q7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pQm90LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQUNBO0FBV0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBRUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7QUFFQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _arverniMarch = __webpack_require__(51);\n\nvar _arverniMarch2 = _interopRequireDefault(_arverniMarch);\n\nvar _arverniDevastate = __webpack_require__(40);\n\nvar _arverniDevastate2 = _interopRequireDefault(_arverniDevastate);\n\nvar _arverniEntreat = __webpack_require__(41);\n\nvar _arverniEntreat2 = _interopRequireDefault(_arverniEntreat);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ArverniRally = function () {\n    function ArverniRally() {\n        _classCallCheck(this, ArverniRally);\n    }\n\n    _createClass(ArverniRally, null, [{\n        key: 'rally',\n        value: function rally(state, modifiers) {\n            var arverni = state.arverni;\n\n            var needWarbands = arverni.availableWarbands().length > 26;\n            var executableRallyRegions = this.getExecutableRallyRegions(state, modifiers);\n            if (!this.isRallyEffective(state, executableRallyRegions)) {\n                if (needWarbands) {\n                    return _arverniMarch2.default.march(state, modifiers, 'spread', true);\n                }\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.RALLY);\n            _lodash2.default.each(executableRallyRegions, function (rallyRegion) {\n                if (!modifiers.free && rallyRegion.cost > 0) {\n                    _removeResources2.default.execute(state, { factionId: state.arverni.id, count: rallyRegion.cost });\n                }\n                _rally2.default.execute(state, { faction: state.arverni, regionResult: rallyRegion });\n            });\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getCitadelRegions',\n        value: function getCitadelRegions(state, modifiers) {\n            var rallyRegionResults = _rally2.default.test(state, { factionId: _factionIds2.default.ARVERNI });\n            var citadelRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddCitadel: true }).shuffle().value();\n            _lodash2.default.each(citadelRegions, function (regionResult) {\n                regionResult.addCitadel = true;\n                var leader = regionResult.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n                if (leader && !leader.isSuccessor()) {\n                    regionResult.addNumWarbands = regionResult.canAddNumWarbands;\n                }\n            });\n            return _lodash2.default.take(citadelRegions, state.arverni.availableCitadels().length);\n        }\n    }, {\n        key: 'getAllyRegions',\n        value: function getAllyRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.ARVERNI,\n                regions: regions\n            });\n            var allyRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddAlly: true }).shuffle().value();\n            _lodash2.default.each(allyRegions, function (regionResult) {\n                regionResult.addAlly = true;\n                var leader = regionResult.region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n                if (leader && !leader.isSuccessor()) {\n                    regionResult.addNumWarbands = regionResult.canAddNumWarbands;\n                }\n            });\n            return _lodash2.default.take(allyRegions, state.arverni.availableAlliedTribes().length);\n        }\n    }, {\n        key: 'getWarbandRegions',\n        value: function getWarbandRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _lodash2.default.shuffle(_rally2.default.test(state, {\n                factionId: _factionIds2.default.ARVERNI,\n                regions: regions\n            }));\n\n            var warbandsRemaining = state.arverni.availableWarbands().length;\n            _lodash2.default.each(rallyRegionResults, function (regionResult) {\n                regionResult.addNumWarbands = Math.min(regionResult.canAddNumWarbands, warbandsRemaining);\n                warbandsRemaining -= regionResult.addNumWarbands;\n                if (warbandsRemaining === 0) {\n                    return false;\n                }\n            });\n\n            return (0, _lodash2.default)(rallyRegionResults).filter(function (result) {\n                return result.addNumWarbands > 0;\n            }).shuffle().value();\n        }\n    }, {\n        key: 'isRallyEffective',\n        value: function isRallyEffective(state, executableRallyRegions) {\n            var arverni = state.arverni;\n            var citadelAdded = false;\n            var allyAdded = false;\n            var numPiecesAdded = 0;\n            var numWarbandsAdded = 0;\n            _lodash2.default.each(executableRallyRegions, function (regionResult) {\n                if (regionResult.addCitadel && arverni.availableCitadels().length > 0) {\n                    citadelAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                if (regionResult.addAlly && arverni.availableAlliedTribes().length > 0) {\n                    allyAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                numWarbandsAdded += regionResult.addNumWarbands;\n                if (numPiecesAdded >= 3) {\n                    return false;\n                }\n            });\n            var needWarbands = arverni.availableWarbands().length > 26;\n            numPiecesAdded += Math.min(numWarbandsAdded, arverni.availableWarbands().length);\n            return needWarbands && numPiecesAdded > 0 || citadelAdded || allyAdded || numPiecesAdded >= 3;\n        }\n    }, {\n        key: 'getExecutableRallyRegions',\n        value: function getExecutableRallyRegions(state, modifiers, faction) {\n            var ralliedRegions = [];\n            var citadelRegions = this.getCitadelRegions(state, modifiers);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(citadelRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var allyRegions = this.getAllyRegions(state, modifiers, ralliedRegions);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(allyRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var warbandRegions = this.getWarbandRegions(state, modifiers, ralliedRegions);\n\n            var allRegions = (0, _lodash2.default)(citadelRegions).concat(allyRegions).concat(warbandRegions).filter(function (rallyRegion) {\n                return _lodash2.default.indexOf(modifiers.allowedRegions, rallyRegion.region.id) >= 0;\n            }).value();\n            var affordableRegions = modifiers.free ? allRegions : _lodash2.default.reduce(allRegions, function (accumulator, rallyRegion) {\n                if (accumulator.resourcesRemaining >= rallyRegion.cost) {\n                    accumulator.resourcesRemaining -= rallyRegion.cost;\n                    accumulator.rallies.push(rallyRegion);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.arverni.resources(), rallies: [] }).rallies;\n\n            return modifiers.limited ? _lodash2.default.take(affordableRegions, 1) : affordableRegions;\n        }\n    }]);\n\n    return ArverniRally;\n}();\n\nexports.default = ArverniRally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlSYWxseS5qcz8yMmI1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFJhbGx5IGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhbGx5JztcbmltcG9ydCBBcnZlcm5pTWFyY2ggZnJvbSAnLi9hcnZlcm5pTWFyY2gnO1xuaW1wb3J0IEFydmVybmlEZXZhc3RhdGUgZnJvbSAnLi9hcnZlcm5pRGV2YXN0YXRlJztcbmltcG9ydCBBcnZlcm5pRW50cmVhdCBmcm9tICcuL2FydmVybmlFbnRyZWF0JztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3JlbW92ZVJlc291cmNlcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcblxuXG5jbGFzcyBBcnZlcm5pUmFsbHkge1xuICAgIHN0YXRpYyByYWxseShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGFydmVybmkgPSBzdGF0ZS5hcnZlcm5pO1xuXG4gICAgICAgIGNvbnN0IG5lZWRXYXJiYW5kcyA9IGFydmVybmkuYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGggPiAyNjtcbiAgICAgICAgY29uc3QgZXhlY3V0YWJsZVJhbGx5UmVnaW9ucyA9IHRoaXMuZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmFsbHlFZmZlY3RpdmUoc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpKSB7XG4gICAgICAgICAgICBpZiAobmVlZFdhcmJhbmRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEFydmVybmlNYXJjaC5tYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCAnc3ByZWFkJywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLlJBTExZKTtcbiAgICAgICAgXy5lYWNoKGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMsIChyYWxseVJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSAmJiByYWxseVJlZ2lvbi5jb3N0ID4gMCkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBzdGF0ZS5hcnZlcm5pLmlkLCBjb3VudDogcmFsbHlSZWdpb24uY29zdH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUmFsbHkuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb246IHN0YXRlLmFydmVybmksIHJlZ2lvblJlc3VsdDogcmFsbHlSZWdpb259KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIGNvbnN0IHVzZWRTcGVjaWFsQWJpbGl0eSA9IG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiAoQXJ2ZXJuaURldmFzdGF0ZS5kZXZhc3RhdGUoc3RhdGUsIG1vZGlmaWVycykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBcnZlcm5pRW50cmVhdC5lbnRyZWF0KHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRDaXRhZGVsUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGx5UmVnaW9uUmVzdWx0cyA9IFJhbGx5LnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQVJWRVJOSX0pO1xuICAgICAgICBjb25zdCBjaXRhZGVsUmVnaW9ucyA9IF8ocmFsbHlSZWdpb25SZXN1bHRzKS5maWx0ZXIoe2NhbkFkZENpdGFkZWw6IHRydWV9KS5zaHVmZmxlKCkudmFsdWUoKTtcbiAgICAgICAgXy5lYWNoKGNpdGFkZWxSZWdpb25zLCAocmVnaW9uUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICByZWdpb25SZXN1bHQuYWRkQ2l0YWRlbCA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCBsZWFkZXIgPSByZWdpb25SZXN1bHQucmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5BUlZFUk5JKTtcbiAgICAgICAgICAgIGlmIChsZWFkZXIgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpKSB7XG4gICAgICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZE51bVdhcmJhbmRzID0gcmVnaW9uUmVzdWx0LmNhbkFkZE51bVdhcmJhbmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShjaXRhZGVsUmVnaW9ucywgc3RhdGUuYXJ2ZXJuaS5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQVJWRVJOSSxcbiAgICAgICAgICAgIHJlZ2lvbnM6IHJlZ2lvbnNcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGFsbHlSZWdpb25zID0gXyhyYWxseVJlZ2lvblJlc3VsdHMpLmZpbHRlcih7Y2FuQWRkQWxseTogdHJ1ZX0pLnNodWZmbGUoKS52YWx1ZSgpO1xuICAgICAgICBfLmVhY2goYWxseVJlZ2lvbnMsIChyZWdpb25SZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHJlZ2lvblJlc3VsdC5hZGRBbGx5ID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlYWRlciA9IHJlZ2lvblJlc3VsdC5yZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICAgICAgaWYgKGxlYWRlciAmJiAhbGVhZGVyLmlzU3VjY2Vzc29yKCkpIHtcbiAgICAgICAgICAgICAgICByZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHMgPSByZWdpb25SZXN1bHQuY2FuQWRkTnVtV2FyYmFuZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gXy50YWtlKGFsbHlSZWdpb25zLCBzdGF0ZS5hcnZlcm5pLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFdhcmJhbmRSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBfLnNodWZmbGUoUmFsbHkudGVzdChzdGF0ZSwge1xuICAgICAgICAgICAgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkksXG4gICAgICAgICAgICByZWdpb25zOiByZWdpb25zXG4gICAgICAgIH0pKTtcblxuICAgICAgICBsZXQgd2FyYmFuZHNSZW1haW5pbmcgPSBzdGF0ZS5hcnZlcm5pLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoO1xuICAgICAgICBfLmVhY2gocmFsbHlSZWdpb25SZXN1bHRzLCAocmVnaW9uUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICByZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHMgPSBNYXRoLm1pbihyZWdpb25SZXN1bHQuY2FuQWRkTnVtV2FyYmFuZHMsIHdhcmJhbmRzUmVtYWluaW5nKTtcbiAgICAgICAgICAgIHdhcmJhbmRzUmVtYWluaW5nIC09IHJlZ2lvblJlc3VsdC5hZGROdW1XYXJiYW5kcztcbiAgICAgICAgICAgIGlmKHdhcmJhbmRzUmVtYWluaW5nID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gXyhyYWxseVJlZ2lvblJlc3VsdHMpLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LmFkZE51bVdhcmJhbmRzID4gMCkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzUmFsbHlFZmZlY3RpdmUoc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmFydmVybmk7XG4gICAgICAgIGxldCBjaXRhZGVsQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGFsbHlBZGRlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgbnVtUGllY2VzQWRkZWQgPSAwO1xuICAgICAgICBsZXQgbnVtV2FyYmFuZHNBZGRlZCA9IDA7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMsIChyZWdpb25SZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVnaW9uUmVzdWx0LmFkZENpdGFkZWwgJiYgYXJ2ZXJuaS5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2l0YWRlbEFkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgbnVtUGllY2VzQWRkZWQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZWdpb25SZXN1bHQuYWRkQWxseSAmJiBhcnZlcm5pLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYWxseUFkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgbnVtUGllY2VzQWRkZWQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzQWRkZWQgKz0gcmVnaW9uUmVzdWx0LmFkZE51bVdhcmJhbmRzO1xuICAgICAgICAgICAgICAgIGlmIChudW1QaWVjZXNBZGRlZCA+PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbmVlZFdhcmJhbmRzID0gYXJ2ZXJuaS5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aCA+IDI2O1xuICAgICAgICBudW1QaWVjZXNBZGRlZCArPSBNYXRoLm1pbihudW1XYXJiYW5kc0FkZGVkLCBhcnZlcm5pLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIChuZWVkV2FyYmFuZHMgJiYgbnVtUGllY2VzQWRkZWQgPiAwKSB8fCBjaXRhZGVsQWRkZWQgfHwgYWxseUFkZGVkIHx8IG51bVBpZWNlc0FkZGVkID49IDM7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEV4ZWN1dGFibGVSYWxseVJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgZmFjdGlvbikge1xuICAgICAgICBjb25zdCByYWxsaWVkUmVnaW9ucyA9IFtdO1xuICAgICAgICBjb25zdCBjaXRhZGVsUmVnaW9ucyA9IHRoaXMuZ2V0Q2l0YWRlbFJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIHJhbGxpZWRSZWdpb25zLnB1c2guYXBwbHkocmFsbGllZFJlZ2lvbnMsIF8ubWFwKGNpdGFkZWxSZWdpb25zLCByYWxseVJlZ2lvbiA9PiByYWxseVJlZ2lvbi5yZWdpb24uaWQpKTtcbiAgICAgICAgY29uc3QgYWxseVJlZ2lvbnMgPSB0aGlzLmdldEFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25zKTtcbiAgICAgICAgcmFsbGllZFJlZ2lvbnMucHVzaC5hcHBseShyYWxsaWVkUmVnaW9ucywgXy5tYXAoYWxseVJlZ2lvbnMsIHJhbGx5UmVnaW9uID0+IHJhbGx5UmVnaW9uLnJlZ2lvbi5pZCkpO1xuICAgICAgICBjb25zdCB3YXJiYW5kUmVnaW9ucyA9IHRoaXMuZ2V0V2FyYmFuZFJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgcmFsbGllZFJlZ2lvbnMpO1xuXG4gICAgICAgIGNvbnN0IGFsbFJlZ2lvbnMgPSBfKGNpdGFkZWxSZWdpb25zKS5jb25jYXQoYWxseVJlZ2lvbnMpLmNvbmNhdCh3YXJiYW5kUmVnaW9ucykuZmlsdGVyKHJhbGx5UmVnaW9uID0+IF8uaW5kZXhPZihtb2RpZmllcnMuYWxsb3dlZFJlZ2lvbnMsIHJhbGx5UmVnaW9uLnJlZ2lvbi5pZCkgPj0gMCkudmFsdWUoKTtcbiAgICAgICAgY29uc3QgYWZmb3JkYWJsZVJlZ2lvbnMgPSBtb2RpZmllcnMuZnJlZSA/IGFsbFJlZ2lvbnMgOiBfLnJlZHVjZShhbGxSZWdpb25zLCAoYWNjdW11bGF0b3IsIHJhbGx5UmVnaW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoYWNjdW11bGF0b3IucmVzb3VyY2VzUmVtYWluaW5nID49IHJhbGx5UmVnaW9uLmNvc3QpIHtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgLT0gcmFsbHlSZWdpb24uY29zdDtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5yYWxsaWVzLnB1c2gocmFsbHlSZWdpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yXG4gICAgICAgIH0sIHtyZXNvdXJjZXNSZW1haW5pbmc6IHN0YXRlLmFydmVybmkucmVzb3VyY2VzKCksIHJhbGxpZXM6IFtdfSkucmFsbGllcztcblxuICAgICAgICByZXR1cm4gbW9kaWZpZXJzLmxpbWl0ZWQgPyBfLnRha2UoYWZmb3JkYWJsZVJlZ2lvbnMsIDEpIDogYWZmb3JkYWJsZVJlZ2lvbnM7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFydmVybmlSYWxseVxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FydmVybmkvYXJ2ZXJuaVJhbGx5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFFQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _bot = __webpack_require__(35);\n\nvar _bot2 = _interopRequireDefault(_bot);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _belgaeEvent = __webpack_require__(130);\n\nvar _belgaeEvent2 = _interopRequireDefault(_belgaeEvent);\n\nvar _belgaeBattle = __webpack_require__(129);\n\nvar _belgaeBattle2 = _interopRequireDefault(_belgaeBattle);\n\nvar _belgaeRally = __webpack_require__(70);\n\nvar _belgaeRally2 = _interopRequireDefault(_belgaeRally);\n\nvar _belgaeRaid = __webpack_require__(135);\n\nvar _belgaeRaid2 = _interopRequireDefault(_belgaeRaid);\n\nvar _belgaeMarch = __webpack_require__(69);\n\nvar _belgaeMarch2 = _interopRequireDefault(_belgaeMarch);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _pass = __webpack_require__(45);\n\nvar _pass2 = _interopRequireDefault(_pass);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Checkpoints = {\n    BATTLE_CHECK: 'battle',\n    THREAT_MARCH_CHECK: 'threat-march',\n    PASS_CHECK: 'pass',\n    EVENT_CHECK: 'event',\n    RALLY_CHECK: 'rally',\n    CONTROL_MARCH_CHECK: 'control-march',\n    FIRST_RAID_CHECK: 'first-raid',\n    SECOND_RAID_CHECK: 'second-raid'\n};\n\nvar BelgaeBot = function (_Bot) {\n    _inherits(BelgaeBot, _Bot);\n\n    function BelgaeBot() {\n        _classCallCheck(this, BelgaeBot);\n\n        return _possibleConstructorReturn(this, (BelgaeBot.__proto__ || Object.getPrototypeOf(BelgaeBot)).call(this, { factionId: _factionIds2.default.BELGAE }));\n    }\n\n    _createClass(BelgaeBot, [{\n        key: 'takeTurn',\n        value: function takeTurn(state) {\n            var commandAction = null;\n            var turn = state.turnHistory.currentTurn;\n            var modifiers = turn.getContext();\n\n            if (!turn.getCheckpoint(Checkpoints.BATTLE_CHECK) && modifiers.isCommandAllowed(_commandIds2.default.BATTLE)) {\n                commandAction = _belgaeBattle2.default.battle(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.BATTLE_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.THREAT_MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH) && modifiers.context.tryThreatMarch) {\n                commandAction = _belgaeMarch2.default.march(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.THREAT_MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.PASS_CHECK) && !commandAction && this.shouldPassForNextCard(state)) {\n                commandAction = _factionActions2.default.PASS;\n            }\n            turn.markCheckpoint(Checkpoints.PASS_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.EVENT_CHECK) && !commandAction && this.canPlayEvent(state) && _belgaeEvent2.default.handleEvent(state)) {\n                commandAction = _factionActions2.default.EVENT;\n            }\n            turn.markCheckpoint(Checkpoints.EVENT_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.RALLY_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RALLY)) {\n                commandAction = _belgaeRally2.default.rally(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.RALLY_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.FIRST_RAID_CHECK) && !commandAction && state.belgae.resources() < 4 && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _belgaeRaid2.default.raid(state, modifiers) || _factionActions2.default.PASS;\n            }\n            turn.markCheckpoint(Checkpoints.FIRST_RAID_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.CONTROL_MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                commandAction = _belgaeMarch2.default.march(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.CONTROL_MARCH_CHECK);\n\n            if (!turn.getCheckpoint(Checkpoints.SECOND_RAID_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RAID)) {\n                commandAction = _belgaeRaid2.default.raid(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.SECOND_RAID_CHECK);\n\n            commandAction = commandAction || _factionActions2.default.PASS;\n\n            if (commandAction === _factionActions2.default.PASS) {\n                _pass2.default.execute(state, { factionId: _factionIds2.default.BELGAE });\n            }\n\n            state.sequenceOfPlay.recordFactionAction(_factionIds2.default.BELGAE, commandAction);\n            return commandAction;\n        }\n    }, {\n        key: 'shouldPassForNextCard',\n        value: function shouldPassForNextCard(state) {\n            return state.upcomingCard() && state.upcomingCard().type !== 'winter' && state.upcomingCard().initiativeOrder[0] === _factionIds2.default.BELGAE && state.currentCard().initiativeOrder[0] !== _factionIds2.default.BELGAE && _.random(1, 6) < 5;\n        }\n    }, {\n        key: 'willHarass',\n        value: function willHarass(factionId) {\n            return factionId === _factionIds2.default.ROMANS;\n        }\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {\n            var _this2 = this;\n\n            var devastatedMoveRegions = _(state.regions).filter(function (region) {\n                return region.devastated();\n            }).map(function (region) {\n                var alliesAndCitadel = region.getAlliesAndCitadelForFaction(_this2.factionId);\n                var warbands = region.getWarbandsOrAuxiliaForFaction(_this2.factionId);\n                var leader = region.getLeaderForFaction(_this2.factionId);\n\n                if (alliesAndCitadel.length > 0) {\n                    return;\n                }\n\n                if (warbands.length === 0 && !leader) {\n                    return;\n                }\n\n                var targets = _this2.getValidQuartersTargetsForRegion(state, region);\n\n                return {\n                    region: region,\n                    warbands: warbands,\n                    leader: leader,\n                    targets: targets\n                };\n            }).compact().value();\n\n            var leaderWillDoDevastationMove = _.find(devastatedMoveRegions, 'leader');\n            var leaderRegion = this.findLeaderRegion(state);\n\n            var massTarget = null;\n            if (leaderRegion) {\n                var massTargets = this.getValidQuartersTargetsForRegion(state, leaderRegion);\n                if (!leaderWillDoDevastationMove) {\n                    massTargets.push(leaderRegion);\n                }\n\n                massTarget = _(massTargets).map(function (region) {\n                    var numWarbands = _.reduce(devastatedMoveRegions, function (sum, sourceRegion) {\n                        if (_.find(_.map(sourceRegion.targets), function (target) {\n                            return target.id === region.id;\n                        })) {\n                            return sum + sourceRegion.region.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        } else {\n                            return sum;\n                        }\n                    }, region.getWarbandsOrAuxiliaForFaction(_this2.factionId).length);\n\n                    var nonDevastatedMove = null;\n                    if (region.id === leaderRegion.id) {\n                        nonDevastatedMove = _(leaderRegion.adjacent).reject(function (adjacent) {\n                            return adjacent.devastated() || adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length < 1;\n                        }).map(function (adjacent) {\n                            var numWarbands = adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                            var controlMargin = adjacent.controllingMarginByFaction()[_this2.factionId];\n                            var numToMove = controlMargin < 1 ? numWarbands - 1 : Math.min(numWarbands - 1, controlMargin - 1);\n\n                            if (numToMove <= 0) {\n                                return;\n                            }\n\n                            return {\n                                region: adjacent,\n                                numToMove: numToMove\n                            };\n                        }).compact().sortBy('numToMove').reverse().first();\n                    } else if (!leaderWillDoDevastationMove) {\n                        var numLeaderRegionWarbands = leaderRegion.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        var leaderRegionControlMargin = leaderRegion.controllingMarginByFaction()[_this2.factionId];\n                        var leaderRegionNumToMove = leaderRegionControlMargin < 1 ? numLeaderRegionWarbands - 1 : Math.min(numLeaderRegionWarbands - 1, leaderRegionControlMargin - 2);\n\n                        if (leaderRegionNumToMove > 0) {\n                            nonDevastatedMove = {\n                                region: leaderRegion,\n                                numToMove: leaderRegionNumToMove,\n                                leader: true\n                            };\n                        }\n                    }\n\n                    if (nonDevastatedMove) {\n                        numWarbands += nonDevastatedMove.numToMove;\n                    }\n\n                    var numAdjacentWarbands = _(region.adjacent).reject(function (adjacent) {\n                        return _.find(devastatedMoveRegions, { id: adjacent.id });\n                    }).reduce(function (sum, adjacent) {\n                        if (nonDevastatedMove && adjacent.id === nonDevastatedMove.id) {\n                            return sum + adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length - nonDevastatedMove.numToMove;\n                        } else {\n                            return sum + adjacent.getWarbandsOrAuxiliaForFaction(_this2.factionId).length;\n                        }\n                    }, 0);\n\n                    var priority = 99 - numWarbands + '-' + (99 - numAdjacentWarbands);\n\n                    return {\n                        region: region,\n                        nonDevastatedMove: nonDevastatedMove,\n                        priority: priority\n                    };\n                }).sortBy('priority').first();\n            }\n\n            _.each(devastatedMoveRegions, function (moveRegion) {\n                var destRegionId = null;\n                if (massTarget && _.find(moveRegion.targets, function (target) {\n                    return target.id === massTarget.region.id;\n                })) {\n                    destRegionId = massTarget.region.id;\n                } else if (moveRegion.targets.length > 0) {\n                    if (massTarget) {\n                        destRegionId = _(moveRegion.targets).shuffle().sortBy(function (target) {\n                            return _map2.default.measureDistanceToRegion(state, moveRegion.region.id, target.id);\n                        }).first().id;\n                    } else {\n                        destRegionId = _.sample(moveRegion.targets).id;\n                    }\n                }\n\n                if (!destRegionId) {\n                    return;\n                }\n\n                var pieces = moveRegion.region.getMobilePiecesForFaction(_this2.factionId);\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: moveRegion.region.id,\n                    destRegionId: destRegionId,\n                    pieces: pieces\n                });\n            });\n\n            if (massTarget && massTarget.nonDevastatedMove) {\n                var warbands = massTarget.nonDevastatedMove.region.getWarbandsOrAuxiliaForFaction(this.factionId);\n                var leader = massTarget.nonDevastatedMove.region.getLeaderForFaction(this.factionId);\n                var pieces = leader ? _.concat(warbands, [leader]) : warbands;\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: massTarget.nonDevastatedMove.region.id,\n                    destRegionId: massTarget.region.id,\n                    pieces: pieces\n                });\n            }\n\n            _.each(state.region, function (region) {\n                if (!region.devastated()) {\n                    return;\n                }\n\n                var piecesToRemove = _.filter(region.getWarbandsOrAuxiliaForFaction(_this2.factionId), function (warband) {\n                    return _.random(1, 6) < 4;\n                });\n\n                if (piecesToRemove.length > 0) {\n                    _removePieces2.default.execute(state, {\n                        factionId: _this2.factionId,\n                        regionId: region.id,\n                        pieces: piecesToRemove\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'getValidQuartersTargetsForRegion',\n        value: function getValidQuartersTargetsForRegion(state, region) {\n            var _this3 = this;\n\n            return _(region.adjacent).reject(function (adjacentRegion) {\n                return adjacentRegion.devastated() || !adjacentRegion.controllingFactionId() || adjacentRegion.controllingFactionId() === _factionIds2.default.GERMANIC_TRIBES;\n            }).filter(function (adjacentRegion) {\n                return adjacentRegion.controllingFactionId() === _this3.factionId || state.playersByFaction[adjacentRegion.controllingFactionId()].willAgreeToQuarters(state, _this3.factionId);\n            }).value();\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            var _this4 = this;\n\n            return _.find(state.regions, function (region) {\n                return _.find(region.piecesByFaction()[_this4.factionId], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return BelgaeBot;\n}(_bot2.default);\n\nexports.default = BelgaeBot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlQm90LmpzPzk2ZWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvdCBmcm9tICcuLi9ib3QnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IEJlbGdhZUV2ZW50IGZyb20gJy4vYmVsZ2FlRXZlbnQnO1xuaW1wb3J0IEJlbGdhZUJhdHRsZSBmcm9tICcuL2JlbGdhZUJhdHRsZSc7XG5pbXBvcnQgQmVsZ2FlUmFsbHkgZnJvbSAnLi9iZWxnYWVSYWxseSc7XG5pbXBvcnQgQmVsZ2FlUmFpZCBmcm9tICcuL2JlbGdhZVJhaWQnO1xuaW1wb3J0IEJlbGdhZU1hcmNoIGZyb20gJy4vYmVsZ2FlTWFyY2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgUGFzcyBmcm9tICcuLi8uLi9jb21tYW5kcy9wYXNzJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9tb3ZlUGllY2VzJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3JlbW92ZVBpZWNlcyc7XG5pbXBvcnQgTWFwIGZyb20gJ2ZhbGxpbmdza3kvdXRpbC9tYXAnO1xuXG5jb25zdCBDaGVja3BvaW50cyA9IHtcbiAgICBCQVRUTEVfQ0hFQ0sgOiAnYmF0dGxlJyxcbiAgICBUSFJFQVRfTUFSQ0hfQ0hFQ0sgOiAndGhyZWF0LW1hcmNoJyxcbiAgICBQQVNTX0NIRUNLOiAncGFzcycsXG4gICAgRVZFTlRfQ0hFQ0sgOiAnZXZlbnQnLFxuICAgIFJBTExZX0NIRUNLIDogJ3JhbGx5JyxcbiAgICBDT05UUk9MX01BUkNIX0NIRUNLIDogJ2NvbnRyb2wtbWFyY2gnLFxuICAgIEZJUlNUX1JBSURfQ0hFQ0sgOiAnZmlyc3QtcmFpZCcsXG4gICAgU0VDT05EX1JBSURfQ0hFQ0sgOiAnc2Vjb25kLXJhaWQnXG59O1xuXG5jbGFzcyBCZWxnYWVCb3QgZXh0ZW5kcyBCb3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRX0pO1xuICAgIH1cblxuICAgIHRha2VUdXJuKHN0YXRlKSB7XG4gICAgICAgIGxldCBjb21tYW5kQWN0aW9uID0gbnVsbDtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmN1cnJlbnRUdXJuO1xuICAgICAgICBjb25zdCBtb2RpZmllcnMgPSB0dXJuLmdldENvbnRleHQoKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ0hFQ0spICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKENvbW1hbmRJRHMuQkFUVExFKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEJlbGdhZUJhdHRsZS5iYXR0bGUoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ0hFQ0spO1xuXG4gICAgICAgIGlmKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuVEhSRUFUX01BUkNIX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBtb2RpZmllcnMuaXNDb21tYW5kQWxsb3dlZChDb21tYW5kSURzLk1BUkNIKSAmJiBtb2RpZmllcnMuY29udGV4dC50cnlUaHJlYXRNYXJjaCkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEJlbGdhZU1hcmNoLm1hcmNoKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuVEhSRUFUX01BUkNIX0NIRUNLKTtcblxuICAgICAgICBpZighdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlBBU1NfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIHRoaXMuc2hvdWxkUGFzc0Zvck5leHRDYXJkKHN0YXRlKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEZhY3Rpb25BY3Rpb25zLlBBU1M7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5QQVNTX0NIRUNLKTtcblxuICAgICAgICBpZighdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLkVWRU5UX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiB0aGlzLmNhblBsYXlFdmVudChzdGF0ZSkgJiYgQmVsZ2FlRXZlbnQuaGFuZGxlRXZlbnQoc3RhdGUpKSB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gRmFjdGlvbkFjdGlvbnMuRVZFTlQ7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5FVkVOVF9DSEVDSyk7XG5cbiAgICAgICAgaWYoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5SQUxMWV9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoQ29tbWFuZElEcy5SQUxMWSkpIHtcbiAgICAgICAgICAgIGNvbW1hbmRBY3Rpb24gPSBCZWxnYWVSYWxseS5yYWxseShzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlJBTExZX0NIRUNLKTtcblxuICAgICAgICBpZighdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLkZJUlNUX1JBSURfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmIHN0YXRlLmJlbGdhZS5yZXNvdXJjZXMoKSA8IDQgJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoQ29tbWFuZElEcy5SQUlEKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEJlbGdhZVJhaWQucmFpZChzdGF0ZSwgbW9kaWZpZXJzKSB8fCBGYWN0aW9uQWN0aW9ucy5QQVNTO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuRklSU1RfUkFJRF9DSEVDSyk7XG5cbiAgICAgICAgaWYoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5DT05UUk9MX01BUkNIX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiBtb2RpZmllcnMuaXNDb21tYW5kQWxsb3dlZChDb21tYW5kSURzLk1BUkNIKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEJlbGdhZU1hcmNoLm1hcmNoKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuQ09OVFJPTF9NQVJDSF9DSEVDSyk7XG5cbiAgICAgICAgaWYoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5TRUNPTkRfUkFJRF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoQ29tbWFuZElEcy5SQUlEKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEJlbGdhZVJhaWQucmFpZChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFQ09ORF9SQUlEX0NIRUNLKTtcblxuICAgICAgICBjb21tYW5kQWN0aW9uID0gY29tbWFuZEFjdGlvbiB8fCBGYWN0aW9uQWN0aW9ucy5QQVNTO1xuXG4gICAgICAgIGlmIChjb21tYW5kQWN0aW9uID09PSBGYWN0aW9uQWN0aW9ucy5QQVNTKSB7XG4gICAgICAgICAgICBQYXNzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFfSk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS5zZXF1ZW5jZU9mUGxheS5yZWNvcmRGYWN0aW9uQWN0aW9uKEZhY3Rpb25JRHMuQkVMR0FFLCBjb21tYW5kQWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIGNvbW1hbmRBY3Rpb247XG4gICAgfVxuXG4gICAgc2hvdWxkUGFzc0Zvck5leHRDYXJkKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS51cGNvbWluZ0NhcmQoKSAmJlxuICAgICAgICAgICAgICAgc3RhdGUudXBjb21pbmdDYXJkKCkudHlwZSAhPT0gJ3dpbnRlcicgJiZcbiAgICAgICAgICAgICAgIHN0YXRlLnVwY29taW5nQ2FyZCgpLmluaXRpYXRpdmVPcmRlclswXSA9PT0gRmFjdGlvbklEcy5CRUxHQUUgJiZcbiAgICAgICAgICAgICAgIHN0YXRlLmN1cnJlbnRDYXJkKCkuaW5pdGlhdGl2ZU9yZGVyWzBdICE9PSBGYWN0aW9uSURzLkJFTEdBRSAmJlxuICAgICAgICAgICAgICAgXy5yYW5kb20oMSwgNikgPCA1O1xuICAgIH1cblxuICAgIHdpbGxIYXJhc3MoZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TO1xuICAgIH1cblxuXG4gICAgcXVhcnRlcnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZGV2YXN0YXRlZE1vdmVSZWdpb25zID0gXyhzdGF0ZS5yZWdpb25zKS5maWx0ZXIoKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5kZXZhc3RhdGVkKCk7XG4gICAgICAgIH0pLm1hcCgocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhbGxpZXNBbmRDaXRhZGVsID0gcmVnaW9uLmdldEFsbGllc0FuZENpdGFkZWxGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIGNvbnN0IHdhcmJhbmRzID0gcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICBjb25zdCBsZWFkZXIgPSByZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG5cbiAgICAgICAgICAgIGlmIChhbGxpZXNBbmRDaXRhZGVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh3YXJiYW5kcy5sZW5ndGggPT09IDAgJiYgIWxlYWRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMuZ2V0VmFsaWRRdWFydGVyc1RhcmdldHNGb3JSZWdpb24oc3RhdGUsIHJlZ2lvbik7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgIHdhcmJhbmRzLFxuICAgICAgICAgICAgICAgIGxlYWRlcixcbiAgICAgICAgICAgICAgICB0YXJnZXRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IGxlYWRlcldpbGxEb0RldmFzdGF0aW9uTW92ZSA9IF8uZmluZChkZXZhc3RhdGVkTW92ZVJlZ2lvbnMsICdsZWFkZXInKTtcbiAgICAgICAgY29uc3QgbGVhZGVyUmVnaW9uID0gdGhpcy5maW5kTGVhZGVyUmVnaW9uKHN0YXRlKTtcblxuICAgICAgICBsZXQgbWFzc1RhcmdldCA9IG51bGw7XG4gICAgICAgIGlmIChsZWFkZXJSZWdpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IG1hc3NUYXJnZXRzID0gdGhpcy5nZXRWYWxpZFF1YXJ0ZXJzVGFyZ2V0c0ZvclJlZ2lvbihzdGF0ZSwgbGVhZGVyUmVnaW9uKTtcbiAgICAgICAgICAgIGlmICghbGVhZGVyV2lsbERvRGV2YXN0YXRpb25Nb3ZlKSB7XG4gICAgICAgICAgICAgICAgbWFzc1RhcmdldHMucHVzaChsZWFkZXJSZWdpb24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtYXNzVGFyZ2V0ID0gXyhtYXNzVGFyZ2V0cykubWFwKHJlZ2lvbiA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG51bVdhcmJhbmRzID0gXy5yZWR1Y2UoZGV2YXN0YXRlZE1vdmVSZWdpb25zLCAoc3VtLCBzb3VyY2VSZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uZmluZChfLm1hcChzb3VyY2VSZWdpb24udGFyZ2V0cyksIHRhcmdldCA9PiB0YXJnZXQuaWQgPT09IHJlZ2lvbi5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBzb3VyY2VSZWdpb24ucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgbm9uRGV2YXN0YXRlZE1vdmUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmIChyZWdpb24uaWQgPT09IGxlYWRlclJlZ2lvbi5pZCkge1xuICAgICAgICAgICAgICAgICAgICBub25EZXZhc3RhdGVkTW92ZSA9IF8obGVhZGVyUmVnaW9uLmFkamFjZW50KS5yZWplY3QoYWRqYWNlbnQgPT4gYWRqYWNlbnQuZGV2YXN0YXRlZCgpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGphY2VudC5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWN0aW9uSWQpLmxlbmd0aCA8IDEpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkamFjZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1XYXJiYW5kcyA9IGFkamFjZW50LmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xNYXJnaW4gPSBhZGphY2VudC5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1Ub01vdmUgPSBjb250cm9sTWFyZ2luIDwgMSA/IG51bVdhcmJhbmRzIC0gMSA6IE1hdGgubWluKG51bVdhcmJhbmRzIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xNYXJnaW4gLSAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG51bVRvTW92ZSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IGFkamFjZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1Ub01vdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgnbnVtVG9Nb3ZlJykucmV2ZXJzZSgpLmZpcnN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFsZWFkZXJXaWxsRG9EZXZhc3RhdGlvbk1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtTGVhZGVyUmVnaW9uV2FyYmFuZHMgPSBsZWFkZXJSZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWN0aW9uSWQpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhZGVyUmVnaW9uQ29udHJvbE1hcmdpbiA9IGxlYWRlclJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhZGVyUmVnaW9uTnVtVG9Nb3ZlID0gbGVhZGVyUmVnaW9uQ29udHJvbE1hcmdpbiA8IDEgPyBudW1MZWFkZXJSZWdpb25XYXJiYW5kcyAtIDEgOiBNYXRoLm1pbihcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bUxlYWRlclJlZ2lvbldhcmJhbmRzIC0gMSwgbGVhZGVyUmVnaW9uQ29udHJvbE1hcmdpbiAtIDIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGxlYWRlclJlZ2lvbk51bVRvTW92ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vbkRldmFzdGF0ZWRNb3ZlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogbGVhZGVyUmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVRvTW92ZTogbGVhZGVyUmVnaW9uTnVtVG9Nb3ZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYWRlcjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5vbkRldmFzdGF0ZWRNb3ZlKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzICs9IG5vbkRldmFzdGF0ZWRNb3ZlLm51bVRvTW92ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBudW1BZGphY2VudFdhcmJhbmRzID0gXyhyZWdpb24uYWRqYWNlbnQpLnJlamVjdChcbiAgICAgICAgICAgICAgICAgICAgYWRqYWNlbnQgPT4gXy5maW5kKGRldmFzdGF0ZWRNb3ZlUmVnaW9ucywge2lkOiBhZGphY2VudC5pZH0pKS5yZWR1Y2UoKHN1bSwgYWRqYWNlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vbkRldmFzdGF0ZWRNb3ZlICYmIGFkamFjZW50LmlkID09PSBub25EZXZhc3RhdGVkTW92ZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIGFkamFjZW50LmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWN0aW9uSWQpLmxlbmd0aCAtIG5vbkRldmFzdGF0ZWRNb3ZlLm51bVRvTW92ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBhZGphY2VudC5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdHkgPSAoOTkgLSBudW1XYXJiYW5kcykgKyAnLScgKyAoOTkgLSBudW1BZGphY2VudFdhcmJhbmRzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgbm9uRGV2YXN0YXRlZE1vdmUsXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc29ydEJ5KCdwcmlvcml0eScpLmZpcnN0KCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIF8uZWFjaChkZXZhc3RhdGVkTW92ZVJlZ2lvbnMsIG1vdmVSZWdpb24gPT4ge1xuICAgICAgICAgICAgbGV0IGRlc3RSZWdpb25JZCA9IG51bGw7XG4gICAgICAgICAgICBpZihtYXNzVGFyZ2V0ICYmIF8uZmluZChtb3ZlUmVnaW9uLnRhcmdldHMsIHRhcmdldD0+IHRhcmdldC5pZCA9PT0gbWFzc1RhcmdldC5yZWdpb24uaWQpKSB7XG4gICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkID0gbWFzc1RhcmdldC5yZWdpb24uaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKG1vdmVSZWdpb24udGFyZ2V0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYobWFzc1RhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQgPSBfKG1vdmVSZWdpb24udGFyZ2V0cykuc2h1ZmZsZSgpLnNvcnRCeSh0YXJnZXQ9PiBNYXAubWVhc3VyZURpc3RhbmNlVG9SZWdpb24oc3RhdGUsbW92ZVJlZ2lvbi5yZWdpb24uaWQsIHRhcmdldC5pZCkpLmZpcnN0KCkuaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQgPSBfLnNhbXBsZShtb3ZlUmVnaW9uLnRhcmdldHMpLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIWRlc3RSZWdpb25JZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcGllY2VzID0gbW92ZVJlZ2lvbi5yZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBtb3ZlUmVnaW9uLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogZGVzdFJlZ2lvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBwaWVjZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmKG1hc3NUYXJnZXQgJiYgbWFzc1RhcmdldC5ub25EZXZhc3RhdGVkTW92ZSkge1xuICAgICAgICAgICAgY29uc3Qgd2FyYmFuZHMgPSBtYXNzVGFyZ2V0Lm5vbkRldmFzdGF0ZWRNb3ZlLnJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgY29uc3QgbGVhZGVyID0gbWFzc1RhcmdldC5ub25EZXZhc3RhdGVkTW92ZS5yZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICBjb25zdCBwaWVjZXMgPSBsZWFkZXIgPyBfLmNvbmNhdCh3YXJiYW5kcywgW2xlYWRlcl0pIDogd2FyYmFuZHM7XG4gICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBtYXNzVGFyZ2V0Lm5vbkRldmFzdGF0ZWRNb3ZlLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogbWFzc1RhcmdldC5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uZWFjaChzdGF0ZS5yZWdpb24sIHJlZ2lvbj0+IHtcbiAgICAgICAgICAgIGlmKCFyZWdpb24uZGV2YXN0YXRlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBwaWVjZXNUb1JlbW92ZSA9IF8uZmlsdGVyKHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24odGhpcy5mYWN0aW9uSWQpLCB3YXJiYW5kID0+IF8ucmFuZG9tKDEsNikgPCA0KTtcblxuICAgICAgICAgICAgaWYgKHBpZWNlc1RvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBwaWVjZXNUb1JlbW92ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBnZXRWYWxpZFF1YXJ0ZXJzVGFyZ2V0c0ZvclJlZ2lvbihzdGF0ZSwgcmVnaW9uKSB7XG4gICAgICAgIHJldHVybiBfKHJlZ2lvbi5hZGphY2VudCkucmVqZWN0KChhZGphY2VudFJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGFkamFjZW50UmVnaW9uLmRldmFzdGF0ZWQoKSB8fCAhYWRqYWNlbnRSZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSB8fCBhZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUztcbiAgICAgICAgfSkuZmlsdGVyKGFkamFjZW50UmVnaW9uPT4gYWRqYWNlbnRSZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSA9PT0gdGhpcy5mYWN0aW9uSWQgfHwgc3RhdGUucGxheWVyc0J5RmFjdGlvblthZGphY2VudFJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpXS53aWxsQWdyZWVUb1F1YXJ0ZXJzKHN0YXRlLHRoaXMuZmFjdGlvbklkKSkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBmaW5kTGVhZGVyUmVnaW9uKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfLmZpbmQoc3RhdGUucmVnaW9ucywgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF8uZmluZChyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbdGhpcy5mYWN0aW9uSWRdLCB7dHlwZTogJ2xlYWRlcid9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBCZWxnYWVCb3Q7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUJvdC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTs7O0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFFQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFLQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUVBO0FBRUE7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _belgaeEnlist = __webpack_require__(43);\n\nvar _belgaeEnlist2 = _interopRequireDefault(_belgaeEnlist);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeMarch = function () {\n    function BelgaeMarch() {\n        _classCallCheck(this, BelgaeMarch);\n    }\n\n    _createClass(BelgaeMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers) {\n\n            if (state.frost()) {\n                return false;\n            }\n\n            if (modifiers.context.threatRegions) {\n                return this.threatMarch(state, modifiers);\n            } else {\n                return this.controlMarch(state, modifiers);\n            }\n        }\n    }, {\n        key: 'threatMarch',\n        value: function threatMarch(state, modifiers) {\n            var belgae = state.belgae;\n            var threatRegions = modifiers.context.threatRegions;\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.BELGAE });\n            var largestBelgaeGroup = _lodash2.default.reduce(state.regions, function (largest, region) {\n                var numBelgaeForRegion = (region.piecesByFaction()[_factionIds2.default.BELGAE] || []).length;\n                if (numBelgaeForRegion > largest.numBelgae) {\n                    largest.numBelgae = numBelgaeForRegion;\n                    largest.region = region;\n                }\n                return largest;\n            }, { region: null, numBelgae: 0 });\n\n            var necessaryMarches = (0, _lodash2.default)(marchResults).filter(function (marchResult) {\n                return belgae.resources() >= marchResult.cost || modifiers.free;\n            }).filter(function (marchResult) {\n                if (_lodash2.default.indexOf(threatRegions, marchResult.region.id) >= 0) {\n                    return true;\n                }\n                var leader = marchResult.region.getLeaderForFaction(_factionIds2.default.BELGAE);\n                var numBelgaeForRegion = (marchResult.region.piecesByFaction()[_factionIds2.default.BELGAE] || []).length;\n                return leader && numBelgaeForRegion < largestBelgaeGroup.numBelgae;\n            }).sortBy(function (marchResult) {\n                return marchResult.region.getLeaderForFaction(_factionIds2.default.BELGAE) ? 'a' : 'b';\n            }).value();\n\n            var marchFromRegions = (0, _lodash2.default)(necessaryMarches).map(function (march) {\n                return march.region;\n            }).value();\n            var solutions = _map2.default.findMinimumAdjacent(marchFromRegions);\n\n            var effective = false;\n            var wasBritannia = false;\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n            _lodash2.default.each(necessaryMarches, function (march) {\n                if (belgae.resources() < march.cost && !modifiers.free) {\n                    return false;\n                }\n\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: march.cost });\n                }\n                var destination = (0, _lodash2.default)(solutions).map(function (arr) {\n                    var adjacentRegionsById = _lodash2.default.keyBy(march.region.adjacent, 'id');\n                    var solutionDestination = _lodash2.default.find(arr, function (solution) {\n                        return adjacentRegionsById[solution.id];\n                    });\n                    var region = state.regionsById[solutionDestination.id];\n                    var numBelgaeForRegion = (region.piecesByFaction()[_factionIds2.default.BELGAE] || []).length;\n                    var numAdjacentWithBelgic = (0, _lodash2.default)(region.adjacent).reject(function (adjacentRegion) {\n                        return adjacentRegion.id === region.id;\n                    }).reduce(function (sum, adjacentRegion) {\n                        if (adjacentRegion.piecesByFaction()[_factionIds2.default.BELGAE]) {\n                            return sum + 1;\n                        }\n                        return sum;\n                    });\n\n                    var priority = 'a' + (99 - numBelgaeForRegion) + '-' + (99 - numAdjacentWithBelgic);\n                    return {\n                        region: region,\n                        numPieces: numBelgaeForRegion,\n                        numAdjacentWithBelgic: numAdjacentWithBelgic,\n                        priority: priority\n                    };\n                }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n\n                var piecesToMove = march.region.getMobilePiecesForFaction(_factionIds2.default.BELGAE);\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: march.region.id,\n                    destRegionId: destination.region.id,\n                    pieces: piecesToMove\n                });\n                if (destination.region.id === _regionIds2.default.BRITANNIA || march.region.id === _regionIds2.default.BRITANNIA) {\n                    wasBritannia = true;\n                }\n                effective = true;\n            });\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackCommand();\n                return false;\n            } else {\n                state.turnHistory.getCurrentTurn().commitCommand();\n            }\n            var usedSpecialAbility = modifiers.canDoSpecial() && !wasBritannia && _belgaeEnlist2.default.enlist(state, modifiers);\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'controlMarch',\n        value: function controlMarch(state, modifiers) {\n            var belgae = state.belgae;\n            var marchResults = _lodash2.default.filter(_march2.default.test(state, { factionId: _factionIds2.default.BELGAE }), function (marchResult) {\n                return belgae.resources() >= marchResult.cost || modifiers.free;\n            });\n            var firstControlMarch = this.getControlMarch(state, modifiers, marchResults);\n            var secondControlMarch = null;\n\n            var effective = false;\n            if (firstControlMarch) {\n                state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n                var marchedFromRegions = [firstControlMarch.region.id];\n                var marchedToRegions = [firstControlMarch.destination.id];\n\n                this.doMarch(state, firstControlMarch, modifiers);\n\n                var _secondControlMarch = this.getControlMarch(state, modifiers, _lodash2.default.reject(marchResults, function (march) {\n                    return march.region.id === firstControlMarch.region.id;\n                }));\n                if (_secondControlMarch) {\n                    marchedFromRegions.push(_secondControlMarch.region.id);\n                    marchedToRegions.push(_secondControlMarch.destination.id);\n                    this.doMarch(state, _secondControlMarch, modifiers);\n                }\n\n                this.doLeaderMarch(state, modifiers, marchedFromRegions, marchedToRegions);\n                state.turnHistory.getCurrentTurn().commitCommand();\n                effective = true;\n            }\n\n            if (!effective) {\n                return;\n            }\n\n            var wasBritanniaMarch = firstControlMarch && (firstControlMarch.region.id === _regionIds2.default.BRITANNIA || firstControlMarch.destination.id === _regionIds2.default.BRITANNIA) || secondControlMarch && (secondControlMarch.region.id === _regionIds2.default.BRITANNIA || secondControlMarch.destination.id === _regionIds2.default.BRITANNIA);\n\n            var usedSpecialAbility = modifiers.canDoSpecial() && !wasBritanniaMarch && _belgaeEnlist2.default.enlist(state, modifiers);\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'doMarch',\n        value: function doMarch(state, marchData, modifiers) {\n            console.log('*** Belgae march to control region ' + marchData.destination.name + ' ***');\n            var belgae = state.belgae;\n            if (!modifiers.free) {\n                _removeResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: marchData.cost });\n            }\n\n            var warbands = _lodash2.default.filter(marchData.region.getMobilePiecesForFaction(_factionIds2.default.BELGAE), { type: \"warband\" });\n\n            _hidePieces2.default.execute(state, {\n                factionId: belgae.id,\n                regionId: marchData.region.id\n            });\n\n            var numPiecesToMove = marchData.destination.group === _regionGroups2.default.BELGICA ? marchData.numMoveableWarbands : marchData.numNeededForControl;\n            var piecesToMove = _lodash2.default.take(warbands, numPiecesToMove);\n            _movePieces2.default.execute(state, {\n                sourceRegionId: marchData.region.id,\n                destRegionId: marchData.destination.id,\n                pieces: piecesToMove\n            });\n        }\n    }, {\n        key: 'getControlMarch',\n        value: function getControlMarch(state, modifiers, marchResults) {\n            return (0, _lodash2.default)(marchResults).map(function (march) {\n                var belgicWarbands = _lodash2.default.filter(march.mobilePieces, { type: 'warband' });\n\n                if (!modifiers.free && march.cost > state.belgae.resources()) {\n                    return;\n                }\n\n                // Leave one and keep control\n                var regionControlMargin = march.region.controllingMarginByFaction()[_factionIds2.default.BELGAE];\n                if (belgicWarbands.length <= 1 || regionControlMargin === 1) {\n                    return;\n                }\n\n                var numMoveableWarbands = belgicWarbands.length - 1;\n                if (regionControlMargin > 0) {\n                    numMoveableWarbands = Math.min(numMoveableWarbands, regionControlMargin - 1);\n                }\n\n                var destinationData = (0, _lodash2.default)(march.destinations).map(function (destination) {\n                    var numNeededForControl = 1 - destination.controllingMarginByFaction()[_factionIds2.default.BELGAE];\n                    if (numNeededForControl <= 0 || numNeededForControl > numMoveableWarbands) {\n                        return;\n                    }\n\n                    var priority = (destination.group === _regionGroups2.default.BELGICA ? 'a' : 'b') + (10 + numNeededForControl);\n                    return {\n                        destination: destination,\n                        numNeededForControl: numNeededForControl,\n                        priority: priority\n                    };\n                }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n\n                if (destinationData) {\n                    return {\n                        cost: march.cost,\n                        region: march.region,\n                        destination: destinationData.destination,\n                        numMoveableWarbands: numMoveableWarbands,\n                        numNeededForControl: destinationData.numNeededForControl,\n                        priority: destinationData.priority\n                    };\n                }\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n        }\n    }, {\n        key: 'doLeaderMarch',\n        value: function doLeaderMarch(state, modifiers, marchedFromRegions, marchedToRegions) {\n            var belgae = state.belgae;\n            var marchResults = _lodash2.default.filter(_march2.default.test(state, { factionId: _factionIds2.default.BELGAE }), function (marchResult) {\n                return belgae.resources() >= marchResult.cost || modifiers.free || _lodash2.default.indexOf(marchedFromRegions, marchResult.region.id) >= 0;\n            });\n\n            var leaderMarch = _lodash2.default.find(marchResults, function (result) {\n                return _lodash2.default.find(result.region.piecesByFaction()[_factionIds2.default.BELGAE], { type: 'leader' });\n            });\n            if (!leaderMarch) {\n                return;\n            }\n            var startBelgaePieces = leaderMarch.region.piecesByFaction()[_factionIds2.default.BELGAE];\n            var numBelgaePiecesInStartRegion = startBelgaePieces.length - 1;\n            var leader = _lodash2.default.find(startBelgaePieces, { type: 'leader' });\n\n            var destinationData = (0, _lodash2.default)(leaderMarch.destinations).map(function (destination) {\n                var destBelgaePieces = destination.piecesByFaction()[_factionIds2.default.BELGAE] || [];\n                var numBelgaePiecesInDestRegion = destBelgaePieces.length;\n\n                if (numBelgaePiecesInDestRegion <= numBelgaePiecesInStartRegion) {\n                    return;\n                }\n\n                var destWarbands = _lodash2.default.filter(destBelgaePieces, { type: 'warband' });\n\n                var priority = 'z';\n                if (_lodash2.default.indexOf(marchedToRegions, destination.id) >= 0) {\n                    priority = 'a' + 99 - numBelgaePiecesInDestRegion;\n                } else if (destWarbands.length > 3) {\n                    priority = 'b' + 99 - destWarbands;\n                } else {\n                    return;\n                }\n\n                return {\n                    destination: destination,\n                    priority: priority\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n\n            if (destinationData) {\n                console.log('*** Belgae leader marches to join pieces in region ' + destinationData.destination.name + ' ***');\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: leaderMarch.region.id,\n                    destRegionId: destinationData.destination.id,\n                    pieces: [leader]\n                });\n            }\n        }\n    }]);\n\n    return BelgaeMarch;\n}();\n\nexports.default = BelgaeMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlTWFyY2guanM/ZDZiNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25Hcm91cHMgZnJvbSAnLi4vLi4vY29uZmlnL3JlZ2lvbkdyb3Vwcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IE1hcmNoIGZyb20gJy4uLy4uL2NvbW1hbmRzL21hcmNoJztcbmltcG9ydCBCZWxnYWVFbmxpc3QgZnJvbSAnLi9iZWxnYWVFbmxpc3QnO1xuaW1wb3J0IE1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9tb3ZlUGllY2VzJztcbmltcG9ydCBIaWRlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvaGlkZVBpZWNlcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IE1hcCBmcm9tICcuLi8uLi91dGlsL21hcCc7XG5cbmNsYXNzIEJlbGdhZU1hcmNoIHtcblxuICAgIHN0YXRpYyBtYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG5cbiAgICAgICAgaWYgKHN0YXRlLmZyb3N0KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RpZmllcnMuY29udGV4dC50aHJlYXRSZWdpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYXRNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyB0aHJlYXRNYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGJlbGdhZSA9IHN0YXRlLmJlbGdhZTtcbiAgICAgICAgY29uc3QgdGhyZWF0UmVnaW9ucyA9IG1vZGlmaWVycy5jb250ZXh0LnRocmVhdFJlZ2lvbnM7XG4gICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0cyA9IE1hcmNoLnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFfSk7XG4gICAgICAgIGNvbnN0IGxhcmdlc3RCZWxnYWVHcm91cCA9IF8ucmVkdWNlKFxuICAgICAgICAgICAgc3RhdGUucmVnaW9ucywgKGxhcmdlc3QsIHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUJlbGdhZUZvclJlZ2lvbiA9IChyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdIHx8IFtdKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKG51bUJlbGdhZUZvclJlZ2lvbiA+IGxhcmdlc3QubnVtQmVsZ2FlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhcmdlc3QubnVtQmVsZ2FlID0gbnVtQmVsZ2FlRm9yUmVnaW9uO1xuICAgICAgICAgICAgICAgICAgICBsYXJnZXN0LnJlZ2lvbiA9IHJlZ2lvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxhcmdlc3Q7XG4gICAgICAgICAgICB9LCB7cmVnaW9uOiBudWxsLCBudW1CZWxnYWU6IDB9KTtcblxuICAgICAgICBjb25zdCBuZWNlc3NhcnlNYXJjaGVzID0gXyhtYXJjaFJlc3VsdHMpLmZpbHRlcihtYXJjaFJlc3VsdCA9PiAoYmVsZ2FlLnJlc291cmNlcygpID49IG1hcmNoUmVzdWx0LmNvc3QpIHx8IG1vZGlmaWVycy5mcmVlKS5maWx0ZXIoXG4gICAgICAgICAgICAobWFyY2hSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoXy5pbmRleE9mKHRocmVhdFJlZ2lvbnMsIG1hcmNoUmVzdWx0LnJlZ2lvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZGVyID0gbWFyY2hSZXN1bHQucmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5CRUxHQUUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUJlbGdhZUZvclJlZ2lvbiA9IChtYXJjaFJlc3VsdC5yZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdIHx8IFtdKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlYWRlciAmJiBudW1CZWxnYWVGb3JSZWdpb24gPCBsYXJnZXN0QmVsZ2FlR3JvdXAubnVtQmVsZ2FlO1xuICAgICAgICAgICAgfSkuc29ydEJ5KG1hcmNoUmVzdWx0ID0+IG1hcmNoUmVzdWx0LnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQkVMR0FFKSA/ICdhJyA6ICdiJykudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBtYXJjaEZyb21SZWdpb25zID0gXyhuZWNlc3NhcnlNYXJjaGVzKS5tYXAobWFyY2ggPT4gbWFyY2gucmVnaW9uKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCBzb2x1dGlvbnMgPSBNYXAuZmluZE1pbmltdW1BZGphY2VudChtYXJjaEZyb21SZWdpb25zKTtcblxuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGxldCB3YXNCcml0YW5uaWEgPSBmYWxzZTtcbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5NQVJDSCk7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIG5lY2Vzc2FyeU1hcmNoZXMsIChtYXJjaCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChiZWxnYWUucmVzb3VyY2VzKCkgPCBtYXJjaC5jb3N0ICYmICFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5CRUxHQUUsIGNvdW50OiBtYXJjaC5jb3N0fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gXyhzb2x1dGlvbnMpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgKGFycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWRqYWNlbnRSZWdpb25zQnlJZCA9IF8ua2V5QnkobWFyY2gucmVnaW9uLmFkamFjZW50LCAnaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbHV0aW9uRGVzdGluYXRpb24gPSBfLmZpbmQoYXJyLCBzb2x1dGlvbiA9PiBhZGphY2VudFJlZ2lvbnNCeUlkW3NvbHV0aW9uLmlkXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFtzb2x1dGlvbkRlc3RpbmF0aW9uLmlkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bUJlbGdhZUZvclJlZ2lvbiA9IChyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdIHx8IFtdKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1BZGphY2VudFdpdGhCZWxnaWMgPSBfKHJlZ2lvbi5hZGphY2VudCkucmVqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkamFjZW50UmVnaW9uID0+IGFkamFjZW50UmVnaW9uLmlkID09PSByZWdpb24uaWQpLnJlZHVjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3VtLCBhZGphY2VudFJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRqYWNlbnRSZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmlvcml0eSA9ICdhJyArICg5OS1udW1CZWxnYWVGb3JSZWdpb24pICsgJy0nICsgKDk5LW51bUFkamFjZW50V2l0aEJlbGdpYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1QaWVjZXM6IG51bUJlbGdhZUZvclJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1BZGphY2VudFdpdGhCZWxnaWM6IG51bUFkamFjZW50V2l0aEJlbGdpYyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlc1RvTW92ZSA9IG1hcmNoLnJlZ2lvbi5nZXRNb2JpbGVQaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQkVMR0FFKTtcbiAgICAgICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBkZXN0aW5hdGlvbi5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXM6IHBpZWNlc1RvTW92ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZihkZXN0aW5hdGlvbi5yZWdpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEgfHwgbWFyY2gucmVnaW9uLmlkID09PSBSZWdpb25JRHMuQlJJVEFOTklBKSB7XG4gICAgICAgICAgICAgICAgICAgIHdhc0JyaXRhbm5pYSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmKCFlZmZlY3RpdmUpIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkucm9sbGJhY2tDb21tYW5kKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1c2VkU3BlY2lhbEFiaWxpdHkgPSBtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkgJiYgIXdhc0JyaXRhbm5pYSAmJiAoQmVsZ2FlRW5saXN0LmVubGlzdChzdGF0ZSwgbW9kaWZpZXJzKSk7XG4gICAgICAgIHJldHVybiB1c2VkU3BlY2lhbEFiaWxpdHkgPyBGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMIDogRmFjdGlvbkFjdGlvbnMuQ09NTUFORDtcbiAgICB9XG5cbiAgICBzdGF0aWMgY29udHJvbE1hcmNoKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3QgYmVsZ2FlID0gc3RhdGUuYmVsZ2FlO1xuICAgICAgICBjb25zdCBtYXJjaFJlc3VsdHMgPSBfLmZpbHRlcihNYXJjaC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRX0pLCBtYXJjaFJlc3VsdCA9PiAoYmVsZ2FlLnJlc291cmNlcygpID49IG1hcmNoUmVzdWx0LmNvc3QpIHx8IG1vZGlmaWVycy5mcmVlKTtcbiAgICAgICAgY29uc3QgZmlyc3RDb250cm9sTWFyY2ggPSB0aGlzLmdldENvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaFJlc3VsdHMpO1xuICAgICAgICBsZXQgc2Vjb25kQ29udHJvbE1hcmNoID0gbnVsbDtcblxuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGlmIChmaXJzdENvbnRyb2xNYXJjaCkge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5NQVJDSCk7XG4gICAgICAgICAgICBsZXQgbWFyY2hlZEZyb21SZWdpb25zID0gW2ZpcnN0Q29udHJvbE1hcmNoLnJlZ2lvbi5pZF07XG4gICAgICAgICAgICBsZXQgbWFyY2hlZFRvUmVnaW9ucyA9IFtmaXJzdENvbnRyb2xNYXJjaC5kZXN0aW5hdGlvbi5pZF07XG5cbiAgICAgICAgICAgIHRoaXMuZG9NYXJjaChzdGF0ZSwgZmlyc3RDb250cm9sTWFyY2gsIG1vZGlmaWVycyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNlY29uZENvbnRyb2xNYXJjaCA9IHRoaXMuZ2V0Q29udHJvbE1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIF8ucmVqZWN0KG1hcmNoUmVzdWx0cywgbWFyY2ggPT4gbWFyY2gucmVnaW9uLmlkID09PSBmaXJzdENvbnRyb2xNYXJjaC5yZWdpb24uaWQpKTtcbiAgICAgICAgICAgIGlmIChzZWNvbmRDb250cm9sTWFyY2gpIHtcbiAgICAgICAgICAgICAgICBtYXJjaGVkRnJvbVJlZ2lvbnMucHVzaChzZWNvbmRDb250cm9sTWFyY2gucmVnaW9uLmlkKTtcbiAgICAgICAgICAgICAgICBtYXJjaGVkVG9SZWdpb25zLnB1c2goc2Vjb25kQ29udHJvbE1hcmNoLmRlc3RpbmF0aW9uLmlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvTWFyY2goc3RhdGUsIHNlY29uZENvbnRyb2xNYXJjaCwgbW9kaWZpZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5kb0xlYWRlck1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoZWRGcm9tUmVnaW9ucywgbWFyY2hlZFRvUmVnaW9ucyk7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWVmZmVjdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgd2FzQnJpdGFubmlhTWFyY2ggPSAoZmlyc3RDb250cm9sTWFyY2ggJiYgKGZpcnN0Q29udHJvbE1hcmNoLnJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLkJSSVRBTk5JQSB8fCBmaXJzdENvbnRyb2xNYXJjaC5kZXN0aW5hdGlvbi5pZCA9PT0gUmVnaW9uSURzLkJSSVRBTk5JQSkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNlY29uZENvbnRyb2xNYXJjaCAmJiAoc2Vjb25kQ29udHJvbE1hcmNoLnJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLkJSSVRBTk5JQSB8fCBzZWNvbmRDb250cm9sTWFyY2guZGVzdGluYXRpb24uaWQgPT09IFJlZ2lvbklEcy5CUklUQU5OSUEpKVxuXG4gICAgICAgIGNvbnN0IHVzZWRTcGVjaWFsQWJpbGl0eSA9IG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiAhd2FzQnJpdGFubmlhTWFyY2ggJiYgKEJlbGdhZUVubGlzdC5lbmxpc3Qoc3RhdGUsIG1vZGlmaWVycykpO1xuICAgICAgICByZXR1cm4gdXNlZFNwZWNpYWxBYmlsaXR5ID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvTWFyY2goc3RhdGUsIG1hcmNoRGF0YSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQmVsZ2FlIG1hcmNoIHRvIGNvbnRyb2wgcmVnaW9uICcgKyBtYXJjaERhdGEuZGVzdGluYXRpb24ubmFtZSArICcgKioqJyk7XG4gICAgICAgIGNvbnN0IGJlbGdhZSA9IHN0YXRlLmJlbGdhZTtcbiAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRSwgY291bnQ6IG1hcmNoRGF0YS5jb3N0fSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB3YXJiYW5kcyA9IF8uZmlsdGVyKG1hcmNoRGF0YS5yZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkJFTEdBRSksIHt0eXBlOiBcIndhcmJhbmRcIn0pO1xuXG4gICAgICAgIEhpZGVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgZmFjdGlvbklkOiBiZWxnYWUuaWQsXG4gICAgICAgICAgICAgICAgcmVnaW9uSWQ6IG1hcmNoRGF0YS5yZWdpb24uaWRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG51bVBpZWNlc1RvTW92ZSA9IG1hcmNoRGF0YS5kZXN0aW5hdGlvbi5ncm91cCA9PT0gUmVnaW9uR3JvdXBzLkJFTEdJQ0EgPyBtYXJjaERhdGEubnVtTW92ZWFibGVXYXJiYW5kcyA6IG1hcmNoRGF0YS5udW1OZWVkZWRGb3JDb250cm9sO1xuICAgICAgICBjb25zdCBwaWVjZXNUb01vdmUgPSBfLnRha2Uod2FyYmFuZHMsIG51bVBpZWNlc1RvTW92ZSk7XG4gICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IG1hcmNoRGF0YS5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBtYXJjaERhdGEuZGVzdGluYXRpb24uaWQsXG4gICAgICAgICAgICAgICAgcGllY2VzOiBwaWVjZXNUb01vdmVcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgc3RhdGljIGdldENvbnRyb2xNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaFJlc3VsdHMpIHtcbiAgICAgICAgcmV0dXJuIF8obWFyY2hSZXN1bHRzKS5tYXAoXG4gICAgICAgICAgICAobWFyY2gpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZWxnaWNXYXJiYW5kcyA9IF8uZmlsdGVyKG1hcmNoLm1vYmlsZVBpZWNlcywge3R5cGU6ICd3YXJiYW5kJ30pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSAmJiBtYXJjaC5jb3N0ID4gc3RhdGUuYmVsZ2FlLnJlc291cmNlcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBMZWF2ZSBvbmUgYW5kIGtlZXAgY29udHJvbFxuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2lvbkNvbnRyb2xNYXJnaW4gPSBtYXJjaC5yZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkJFTEdBRV07XG4gICAgICAgICAgICAgICAgaWYgKGJlbGdpY1dhcmJhbmRzLmxlbmd0aCA8PSAxIHx8IHJlZ2lvbkNvbnRyb2xNYXJnaW4gPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxldCBudW1Nb3ZlYWJsZVdhcmJhbmRzID0gYmVsZ2ljV2FyYmFuZHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICBpZiAocmVnaW9uQ29udHJvbE1hcmdpbiA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtTW92ZWFibGVXYXJiYW5kcyA9IE1hdGgubWluKG51bU1vdmVhYmxlV2FyYmFuZHMsIHJlZ2lvbkNvbnRyb2xNYXJnaW4gLSAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkRhdGEgPSBfKG1hcmNoLmRlc3RpbmF0aW9ucykubWFwKFxuICAgICAgICAgICAgICAgICAgICAoZGVzdGluYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bU5lZWRlZEZvckNvbnRyb2wgPSAxIC0gZGVzdGluYXRpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkJFTEdBRV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtTmVlZGVkRm9yQ29udHJvbCA8PSAwIHx8IG51bU5lZWRlZEZvckNvbnRyb2wgPiBudW1Nb3ZlYWJsZVdhcmJhbmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAoZGVzdGluYXRpb24uZ3JvdXAgPT09IFJlZ2lvbkdyb3Vwcy5CRUxHSUNBID8gJ2EnIDogJ2InKSArICgxMCArIG51bU5lZWRlZEZvckNvbnRyb2wpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1OZWVkZWRGb3JDb250cm9sOiBudW1OZWVkZWRGb3JDb250cm9sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLmZpcnN0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25EYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBtYXJjaC5jb3N0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBtYXJjaC5yZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb25EYXRhLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtTW92ZWFibGVXYXJiYW5kczogbnVtTW92ZWFibGVXYXJiYW5kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU5lZWRlZEZvckNvbnRyb2w6IGRlc3RpbmF0aW9uRGF0YS5udW1OZWVkZWRGb3JDb250cm9sLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGRlc3RpbmF0aW9uRGF0YS5wcmlvcml0eVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5maXJzdCgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBkb0xlYWRlck1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoZWRGcm9tUmVnaW9ucywgbWFyY2hlZFRvUmVnaW9ucykge1xuICAgICAgICBjb25zdCBiZWxnYWUgPSBzdGF0ZS5iZWxnYWU7XG4gICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0cyA9IF8uZmlsdGVyKFxuICAgICAgICAgICAgTWFyY2gudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5CRUxHQUV9KSxcbiAgICAgICAgICAgIG1hcmNoUmVzdWx0ID0+IChiZWxnYWUucmVzb3VyY2VzKCkgPj0gbWFyY2hSZXN1bHQuY29zdCkgfHwgbW9kaWZpZXJzLmZyZWUgfHwgXy5pbmRleE9mKG1hcmNoZWRGcm9tUmVnaW9ucywgbWFyY2hSZXN1bHQucmVnaW9uLmlkKSA+PSAwKTtcblxuICAgICAgICBjb25zdCBsZWFkZXJNYXJjaCA9IF8uZmluZChtYXJjaFJlc3VsdHMsIHJlc3VsdCA9PiBfLmZpbmQocmVzdWx0LnJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkJFTEdBRV0sIHt0eXBlOiAnbGVhZGVyJ30pKTtcbiAgICAgICAgaWYgKCFsZWFkZXJNYXJjaCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXJ0QmVsZ2FlUGllY2VzID0gbGVhZGVyTWFyY2gucmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXTtcbiAgICAgICAgY29uc3QgbnVtQmVsZ2FlUGllY2VzSW5TdGFydFJlZ2lvbiA9IHN0YXJ0QmVsZ2FlUGllY2VzLmxlbmd0aCAtIDE7XG4gICAgICAgIGNvbnN0IGxlYWRlciA9IF8uZmluZChzdGFydEJlbGdhZVBpZWNlcywge3R5cGU6ICdsZWFkZXInfSk7XG5cbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25EYXRhID0gXyhsZWFkZXJNYXJjaC5kZXN0aW5hdGlvbnMpLm1hcChcbiAgICAgICAgICAgIChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RCZWxnYWVQaWVjZXMgPSBkZXN0aW5hdGlvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkJFTEdBRV0gfHwgW107XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtQmVsZ2FlUGllY2VzSW5EZXN0UmVnaW9uID0gZGVzdEJlbGdhZVBpZWNlcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBpZiAobnVtQmVsZ2FlUGllY2VzSW5EZXN0UmVnaW9uIDw9IG51bUJlbGdhZVBpZWNlc0luU3RhcnRSZWdpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RXYXJiYW5kcyA9IF8uZmlsdGVyKGRlc3RCZWxnYWVQaWVjZXMsIHt0eXBlOiAnd2FyYmFuZCd9KTtcblxuICAgICAgICAgICAgICAgIGxldCBwcmlvcml0eSA9ICd6JztcbiAgICAgICAgICAgICAgICBpZiAoXy5pbmRleE9mKG1hcmNoZWRUb1JlZ2lvbnMsIGRlc3RpbmF0aW9uLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2EnICsgOTkgLSBudW1CZWxnYWVQaWVjZXNJbkRlc3RSZWdpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRlc3RXYXJiYW5kcy5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2InICsgOTkgLSBkZXN0V2FyYmFuZHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcblxuICAgICAgICBpZiAoZGVzdGluYXRpb25EYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEJlbGdhZSBsZWFkZXIgbWFyY2hlcyB0byBqb2luIHBpZWNlcyBpbiByZWdpb24gJyArIGRlc3RpbmF0aW9uRGF0YS5kZXN0aW5hdGlvbi5uYW1lICsgJyAqKionKTtcbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbGVhZGVyTWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQ6IGRlc3RpbmF0aW9uRGF0YS5kZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBbbGVhZGVyXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlTWFyY2g7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZU1hcmNoLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7OztBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTs7Ozs7O0FBS0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _belgaeRampage = __webpack_require__(52);\n\nvar _belgaeRampage2 = _interopRequireDefault(_belgaeRampage);\n\nvar _belgaeEnlist = __webpack_require__(43);\n\nvar _belgaeEnlist2 = _interopRequireDefault(_belgaeEnlist);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeRally = function () {\n    function BelgaeRally() {\n        _classCallCheck(this, BelgaeRally);\n    }\n\n    _createClass(BelgaeRally, null, [{\n        key: 'rally',\n        value: function rally(state, modifiers) {\n\n            var executableRallyRegions = this.getExecutableRallyRegions(state, modifiers);\n            if (!this.isRallyEffective(state, executableRallyRegions)) {\n                return false;\n            }\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.RALLY);\n            _lodash2.default.each(executableRallyRegions, function (rallyRegion) {\n                if (!modifiers.free && rallyRegion.cost > 0) {\n                    _removeResources2.default.execute(state, { factionId: state.belgae.id, count: rallyRegion.cost });\n                }\n                _rally2.default.execute(state, { faction: state.belgae, regionResult: rallyRegion });\n            });\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_belgaeRampage2.default.rampage(state, modifiers) || _belgaeEnlist2.default.enlist(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getCitadelRegions',\n        value: function getCitadelRegions(state, modifiers) {\n            var rallyRegionResults = _rally2.default.test(state, { factionId: _factionIds2.default.BELGAE });\n            var citadelRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddCitadel: true }).shuffle().value();\n            _lodash2.default.each(citadelRegions, function (regionResult) {\n                regionResult.addCitadel = true;\n            });\n            return _lodash2.default.take(citadelRegions, state.belgae.availableCitadels().length);\n        }\n    }, {\n        key: 'getAllyRegions',\n        value: function getAllyRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.BELGAE,\n                regions: regions\n            });\n            var allyRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddAlly: true }).shuffle().value();\n            _lodash2.default.each(allyRegions, function (regionResult) {\n                regionResult.addAlly = true;\n            });\n            return _lodash2.default.take(allyRegions, state.belgae.availableAlliedTribes().length);\n        }\n    }, {\n        key: 'getWarbandRegions',\n        value: function getWarbandRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.BELGAE,\n                regions: regions\n            });\n\n            var warbandRegions = (0, _lodash2.default)(rallyRegionResults).filter(function (result) {\n                return result.canAddNumWarbands > 0;\n            }).map(function (regionResult) {\n                var controlMargin = regionResult.region.controllingMarginByFaction()[_factionIds2.default.BELGAE];\n                var priority = null;\n                if (controlMargin <= 0 && controlMargin + regionResult.canAddNumWarbands > 0) {\n                    priority = 'c' + (99 - regionResult.canAddNumWarbands);\n                    regionResult.willAddControl = true;\n                } else {\n                    priority = 'd' + (99 - regionResult.canAddNumWarbands);\n                }\n                return { priority: priority, regionResult: regionResult };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('regionResult').value();\n\n            var warbandsRemaining = state.belgae.availableWarbands().length;\n            _lodash2.default.each(rallyRegionResults, function (regionResult) {\n                regionResult.addNumWarbands = Math.min(regionResult.canAddNumWarbands, warbandsRemaining);\n                warbandsRemaining -= regionResult.addNumWarbands;\n                if (warbandsRemaining === 0) {\n                    return false;\n                }\n            });\n\n            return (0, _lodash2.default)(rallyRegionResults).filter(function (result) {\n                return result.addNumWarbands > 0;\n            }).value();\n        }\n    }, {\n        key: 'isRallyEffective',\n        value: function isRallyEffective(state, executableRallyRegions) {\n            var belgae = state.belgae;\n            var citadelAdded = false;\n            var allyAdded = false;\n            var controlAdded = false;\n            var numPiecesAdded = 0;\n            var numWarbandsAdded = 0;\n            _lodash2.default.each(executableRallyRegions, function (regionResult) {\n                if (regionResult.addCitadel && belgae.availableCitadels().length > 0) {\n                    citadelAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                if (regionResult.addAlly && belgae.availableAlliedTribes().length > 0) {\n                    allyAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                if (regionResult.willAddControl) {\n                    controlAdded = true;\n                }\n\n                numWarbandsAdded += regionResult.addNumWarbands;\n                if (numPiecesAdded >= 3) {\n                    return false;\n                }\n            });\n\n            numPiecesAdded += Math.min(numWarbandsAdded, belgae.availableWarbands().length);\n            return citadelAdded || allyAdded || numPiecesAdded >= 3 || controlAdded;\n        }\n    }, {\n        key: 'getExecutableRallyRegions',\n        value: function getExecutableRallyRegions(state, modifiers) {\n            var ralliedRegions = [];\n            var citadelRegions = this.getCitadelRegions(state, modifiers);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(citadelRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var allyRegions = this.getAllyRegions(state, modifiers, ralliedRegions);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(allyRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var warbandRegions = this.getWarbandRegions(state, modifiers, ralliedRegions);\n\n            var allRegions = (0, _lodash2.default)(citadelRegions).concat(allyRegions).concat(warbandRegions).filter(function (rallyRegion) {\n                return _lodash2.default.indexOf(modifiers.allowedRegions, rallyRegion.region.id) >= 0;\n            }).value();\n            var affordableRegions = modifiers.free ? allRegions : _lodash2.default.reduce(allRegions, function (accumulator, rallyRegion) {\n                if (accumulator.resourcesRemaining >= rallyRegion.cost) {\n                    accumulator.resourcesRemaining -= rallyRegion.cost;\n                    accumulator.rallies.push(rallyRegion);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.belgae.resources(), rallies: [] }).rallies;\n\n            return modifiers.limited ? _lodash2.default.take(affordableRegions, 1) : affordableRegions;\n        }\n    }]);\n\n    return BelgaeRally;\n}();\n\nexports.default = BelgaeRally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlUmFsbHkuanM/YmM2OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSYWxseSBmcm9tICcuLi8uLi9jb21tYW5kcy9yYWxseSc7XG5pbXBvcnQgQmVsZ2FlUmFtcGFnZSBmcm9tICcuL2JlbGdhZVJhbXBhZ2UnO1xuaW1wb3J0IEJlbGdhZUVubGlzdCBmcm9tICcuL2JlbGdhZUVubGlzdCc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5cblxuY2xhc3MgQmVsZ2FlUmFsbHkge1xuICAgIHN0YXRpYyByYWxseShzdGF0ZSwgbW9kaWZpZXJzKSB7XG5cbiAgICAgICAgY29uc3QgZXhlY3V0YWJsZVJhbGx5UmVnaW9ucyA9IHRoaXMuZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmFsbHlFZmZlY3RpdmUoc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5SQUxMWSk7XG4gICAgICAgIF8uZWFjaChleGVjdXRhYmxlUmFsbHlSZWdpb25zLCAocmFsbHlSZWdpb24pID0+IHtcbiAgICAgICAgICAgIGlmICghbW9kaWZpZXJzLmZyZWUgJiYgcmFsbHlSZWdpb24uY29zdCA+IDApIHtcbiAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogc3RhdGUuYmVsZ2FlLmlkLCBjb3VudDogcmFsbHlSZWdpb24uY29zdH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUmFsbHkuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb246IHN0YXRlLmJlbGdhZSwgcmVnaW9uUmVzdWx0OiByYWxseVJlZ2lvbn0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgY29uc3QgdXNlZFNwZWNpYWxBYmlsaXR5ID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmIChCZWxnYWVSYW1wYWdlLnJhbXBhZ2Uoc3RhdGUsIG1vZGlmaWVycykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCZWxnYWVFbmxpc3QuZW5saXN0KHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRDaXRhZGVsUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGx5UmVnaW9uUmVzdWx0cyA9IFJhbGx5LnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFfSk7XG4gICAgICAgIGNvbnN0IGNpdGFkZWxSZWdpb25zID0gXyhyYWxseVJlZ2lvblJlc3VsdHMpLmZpbHRlcih7Y2FuQWRkQ2l0YWRlbDogdHJ1ZX0pLnNodWZmbGUoKS52YWx1ZSgpO1xuICAgICAgICBfLmVhY2goY2l0YWRlbFJlZ2lvbnMsIChyZWdpb25SZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHJlZ2lvblJlc3VsdC5hZGRDaXRhZGVsID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfLnRha2UoY2l0YWRlbFJlZ2lvbnMsIHN0YXRlLmJlbGdhZS5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFLFxuICAgICAgICAgICAgcmVnaW9uczogcmVnaW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWxseVJlZ2lvbnMgPSBfKHJhbGx5UmVnaW9uUmVzdWx0cykuZmlsdGVyKHtjYW5BZGRBbGx5OiB0cnVlfSkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgICAgIF8uZWFjaChhbGx5UmVnaW9ucywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZEFsbHkgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShhbGx5UmVnaW9ucywgc3RhdGUuYmVsZ2FlLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFdhcmJhbmRSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFLFxuICAgICAgICAgICAgcmVnaW9uczogcmVnaW9uc1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB3YXJiYW5kUmVnaW9ucyA9IF8ocmFsbHlSZWdpb25SZXN1bHRzKS5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5jYW5BZGROdW1XYXJiYW5kcyA+IDApLm1hcChcbiAgICAgICAgICAgIChyZWdpb25SZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sTWFyZ2luID0gcmVnaW9uUmVzdWx0LnJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXTtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sTWFyZ2luIDw9IDAgJiYgKGNvbnRyb2xNYXJnaW4gKyByZWdpb25SZXN1bHQuY2FuQWRkTnVtV2FyYmFuZHMpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdjJyArICg5OSAtIHJlZ2lvblJlc3VsdC5jYW5BZGROdW1XYXJiYW5kcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvblJlc3VsdC53aWxsQWRkQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdkJyArICg5OSAtIHJlZ2lvblJlc3VsdC5jYW5BZGROdW1XYXJiYW5kcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7cHJpb3JpdHksIHJlZ2lvblJlc3VsdH07XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkubWFwKCdyZWdpb25SZXN1bHQnKS52YWx1ZSgpO1xuXG4gICAgICAgIGxldCB3YXJiYW5kc1JlbWFpbmluZyA9IHN0YXRlLmJlbGdhZS5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aDtcbiAgICAgICAgXy5lYWNoKHJhbGx5UmVnaW9uUmVzdWx0cywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZE51bVdhcmJhbmRzID0gTWF0aC5taW4ocmVnaW9uUmVzdWx0LmNhbkFkZE51bVdhcmJhbmRzLCB3YXJiYW5kc1JlbWFpbmluZyk7XG4gICAgICAgICAgICB3YXJiYW5kc1JlbWFpbmluZyAtPSByZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHM7XG4gICAgICAgICAgICBpZiAod2FyYmFuZHNSZW1haW5pbmcgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfKHJhbGx5UmVnaW9uUmVzdWx0cykuZmlsdGVyKHJlc3VsdCA9PiByZXN1bHQuYWRkTnVtV2FyYmFuZHMgPiAwKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc1JhbGx5RWZmZWN0aXZlKHN0YXRlLCBleGVjdXRhYmxlUmFsbHlSZWdpb25zKSB7XG4gICAgICAgIGNvbnN0IGJlbGdhZSA9IHN0YXRlLmJlbGdhZTtcbiAgICAgICAgbGV0IGNpdGFkZWxBZGRlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgYWxseUFkZGVkID0gZmFsc2U7XG4gICAgICAgIGxldCBjb250cm9sQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IG51bVBpZWNlc0FkZGVkID0gMDtcbiAgICAgICAgbGV0IG51bVdhcmJhbmRzQWRkZWQgPSAwO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBleGVjdXRhYmxlUmFsbHlSZWdpb25zLCAocmVnaW9uUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvblJlc3VsdC5hZGRDaXRhZGVsICYmIGJlbGdhZS5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2l0YWRlbEFkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgbnVtUGllY2VzQWRkZWQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZWdpb25SZXN1bHQuYWRkQWxseSAmJiBiZWxnYWUuYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBhbGx5QWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBudW1QaWVjZXNBZGRlZCArPSAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvblJlc3VsdC53aWxsQWRkQ29udHJvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sQWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzQWRkZWQgKz0gcmVnaW9uUmVzdWx0LmFkZE51bVdhcmJhbmRzO1xuICAgICAgICAgICAgICAgIGlmIChudW1QaWVjZXNBZGRlZCA+PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBudW1QaWVjZXNBZGRlZCArPSBNYXRoLm1pbihudW1XYXJiYW5kc0FkZGVkLCBiZWxnYWUuYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gY2l0YWRlbEFkZGVkIHx8IGFsbHlBZGRlZCB8fCBudW1QaWVjZXNBZGRlZCA+PSAzIHx8IGNvbnRyb2xBZGRlZDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGxpZWRSZWdpb25zID0gW107XG4gICAgICAgIGNvbnN0IGNpdGFkZWxSZWdpb25zID0gdGhpcy5nZXRDaXRhZGVsUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgcmFsbGllZFJlZ2lvbnMucHVzaC5hcHBseShyYWxsaWVkUmVnaW9ucywgXy5tYXAoY2l0YWRlbFJlZ2lvbnMsIHJhbGx5UmVnaW9uID0+IHJhbGx5UmVnaW9uLnJlZ2lvbi5pZCkpO1xuICAgICAgICBjb25zdCBhbGx5UmVnaW9ucyA9IHRoaXMuZ2V0QWxseVJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgcmFsbGllZFJlZ2lvbnMpO1xuICAgICAgICByYWxsaWVkUmVnaW9ucy5wdXNoLmFwcGx5KHJhbGxpZWRSZWdpb25zLCBfLm1hcChhbGx5UmVnaW9ucywgcmFsbHlSZWdpb24gPT4gcmFsbHlSZWdpb24ucmVnaW9uLmlkKSk7XG4gICAgICAgIGNvbnN0IHdhcmJhbmRSZWdpb25zID0gdGhpcy5nZXRXYXJiYW5kUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzLCByYWxsaWVkUmVnaW9ucyk7XG5cbiAgICAgICAgY29uc3QgYWxsUmVnaW9ucyA9IF8oY2l0YWRlbFJlZ2lvbnMpLmNvbmNhdChhbGx5UmVnaW9ucykuY29uY2F0KHdhcmJhbmRSZWdpb25zKS5maWx0ZXIocmFsbHlSZWdpb24gPT4gXy5pbmRleE9mKG1vZGlmaWVycy5hbGxvd2VkUmVnaW9ucywgcmFsbHlSZWdpb24ucmVnaW9uLmlkKSA+PSAwKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCBhZmZvcmRhYmxlUmVnaW9ucyA9IG1vZGlmaWVycy5mcmVlID8gYWxsUmVnaW9ucyA6IF8ucmVkdWNlKGFsbFJlZ2lvbnMsIChhY2N1bXVsYXRvciwgcmFsbHlSZWdpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgPj0gcmFsbHlSZWdpb24uY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSByYWxseVJlZ2lvbi5jb3N0O1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJhbGxpZXMucHVzaChyYWxseVJlZ2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3JcbiAgICAgICAgfSwge3Jlc291cmNlc1JlbWFpbmluZzogc3RhdGUuYmVsZ2FlLnJlc291cmNlcygpLCByYWxsaWVzOiBbXX0pLnJhbGxpZXM7XG5cbiAgICAgICAgcmV0dXJuIG1vZGlmaWVycy5saW1pdGVkID8gXy50YWtlKGFmZm9yZGFibGVSZWdpb25zLCAxKSA6IGFmZm9yZGFibGVSZWdpb25zO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBCZWxnYWVSYWxseVxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9iZWxnYWVSYWxseS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBRUE7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _bot = __webpack_require__(35);\n\nvar _bot2 = _interopRequireDefault(_bot);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _germanicRally = __webpack_require__(139);\n\nvar _germanicRally2 = _interopRequireDefault(_germanicRally);\n\nvar _germanicMarch = __webpack_require__(137);\n\nvar _germanicMarch2 = _interopRequireDefault(_germanicMarch);\n\nvar _germanicRaid = __webpack_require__(138);\n\nvar _germanicRaid2 = _interopRequireDefault(_germanicRaid);\n\nvar _germanicBattle = __webpack_require__(136);\n\nvar _germanicBattle2 = _interopRequireDefault(_germanicBattle);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GermanicBot = function (_Bot) {\n    _inherits(GermanicBot, _Bot);\n\n    function GermanicBot() {\n        _classCallCheck(this, GermanicBot);\n\n        return _possibleConstructorReturn(this, (GermanicBot.__proto__ || Object.getPrototypeOf(GermanicBot)).call(this, { factionId: _factionIds2.default.GERMANIC_TRIBES }));\n    }\n\n    _createClass(GermanicBot, [{\n        key: 'takeTurn',\n        value: function takeTurn(state) {\n            _germanicRally2.default.rally(state, new _turnContext2.default({ winter: true }));\n            _germanicMarch2.default.march(state, new _turnContext2.default({ winter: true }));\n            _germanicRaid2.default.raid(state, new _turnContext2.default({ winter: true }));\n            _germanicBattle2.default.battle(state, new _turnContext2.default({ winter: true }));\n        }\n    }, {\n        key: 'willHarass',\n        value: function willHarass(factionId) {\n            return true;\n        }\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {\n            var _this2 = this;\n\n            (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.devastated();\n            }).map(function (region) {\n                var pieces = region.piecesByFaction()[_this2.factionId] || [];\n                if (pieces.length === 0) {\n                    return;\n                }\n                var hasAlly = _lodash2.default.find(pieces, { type: 'alliedtribe' });\n                if (!hasAlly) {\n                    return { region: region, pieces: pieces };\n                }\n            }).compact().each(function (relocation) {\n                var germaniaRegion = state.regionsById[_lodash2.default.sample([_regionIds2.default.SUGAMBRI, _regionIds2.default.UBII])];\n                _movePieces2.default.execute(state, { sourceRegionId: relocation.region.id, destRegionId: germaniaRegion.id, pieces: relocation.pieces });\n            });\n        }\n    }]);\n\n    return GermanicBot;\n}(_bot2.default);\n\nexports.default = GermanicBot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9nZXJtYW5pYy9nZXJtYW5pY0JvdC5qcz8zNzE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3QgZnJvbSAnLi4vYm90JztcbmltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJlZ2lvbklEcyBmcm9tICcuLi8uLi9jb25maWcvcmVnaW9uSWRzJztcbmltcG9ydCBHZXJtYW5pY1JhbGx5IGZyb20gJy4vZ2VybWFuaWNSYWxseSc7XG5pbXBvcnQgR2VybWFuaWNNYXJjaCBmcm9tICcuL2dlcm1hbmljTWFyY2gnO1xuaW1wb3J0IEdlcm1hbmljUmFpZCBmcm9tICcuL2dlcm1hbmljUmFpZCc7XG5pbXBvcnQgR2VybWFuaWNCYXR0bGUgZnJvbSAnLi9nZXJtYW5pY0JhdHRsZSc7XG5pbXBvcnQgVHVybkNvbnRleHQgZnJvbSAnY29tbW9uL3R1cm5Db250ZXh0J1xuaW1wb3J0IE1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9tb3ZlUGllY2VzJztcblxuY2xhc3MgR2VybWFuaWNCb3QgZXh0ZW5kcyBCb3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pO1xuICAgIH1cblxuICAgIHRha2VUdXJuKHN0YXRlKSB7XG4gICAgICAgIEdlcm1hbmljUmFsbHkucmFsbHkoc3RhdGUsIG5ldyBUdXJuQ29udGV4dCh7d2ludGVyOiB0cnVlfSkpO1xuICAgICAgICBHZXJtYW5pY01hcmNoLm1hcmNoKHN0YXRlLCBuZXcgVHVybkNvbnRleHQoe3dpbnRlcjogdHJ1ZX0pKTtcbiAgICAgICAgR2VybWFuaWNSYWlkLnJhaWQoc3RhdGUsIG5ldyBUdXJuQ29udGV4dCh7d2ludGVyOiB0cnVlfSkpO1xuICAgICAgICBHZXJtYW5pY0JhdHRsZS5iYXR0bGUoc3RhdGUsIG5ldyBUdXJuQ29udGV4dCh7d2ludGVyOiB0cnVlfSkpO1xuICAgIH1cblxuICAgIHdpbGxIYXJhc3MoZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHF1YXJ0ZXJzKHN0YXRlKSB7XG4gICAgICAgIF8oc3RhdGUucmVnaW9ucykuZmlsdGVyKGZ1bmN0aW9uKHJlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5kZXZhc3RhdGVkKCk7XG4gICAgICAgIH0pLm1hcCgocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwaWVjZXMgPSByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbdGhpcy5mYWN0aW9uSWRdIHx8IFtdO1xuICAgICAgICAgICAgaWYocGllY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGhhc0FsbHkgPSBfLmZpbmQocGllY2VzLCB7IHR5cGUgOiAnYWxsaWVkdHJpYmUnfSk7XG4gICAgICAgICAgICBpZighaGFzQWxseSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHJlZ2lvbiwgcGllY2VzIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS5lYWNoKGZ1bmN0aW9uKHJlbG9jYXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IGdlcm1hbmlhUmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbXy5zYW1wbGUoW1JlZ2lvbklEcy5TVUdBTUJSSSwgUmVnaW9uSURzLlVCSUldKV07XG4gICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtzb3VyY2VSZWdpb25JZDogcmVsb2NhdGlvbi5yZWdpb24uaWQsIGRlc3RSZWdpb25JZDogZ2VybWFuaWFSZWdpb24uaWQsIHBpZWNlczogcmVsb2NhdGlvbi5waWVjZXN9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBHZXJtYW5pY0JvdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9nZXJtYW5pYy9nZXJtYW5pY0JvdC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUVBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _bot = __webpack_require__(35);\n\nvar _bot2 = _interopRequireDefault(_bot);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _romanEvent = __webpack_require__(142);\n\nvar _romanEvent2 = _interopRequireDefault(_romanEvent);\n\nvar _romanBattle = __webpack_require__(140);\n\nvar _romanBattle2 = _interopRequireDefault(_romanBattle);\n\nvar _romanRecruit = __webpack_require__(144);\n\nvar _romanRecruit2 = _interopRequireDefault(_romanRecruit);\n\nvar _romanSeize = __webpack_require__(145);\n\nvar _romanSeize2 = _interopRequireDefault(_romanSeize);\n\nvar _romanMarch = __webpack_require__(143);\n\nvar _romanMarch2 = _interopRequireDefault(_romanMarch);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nvar _pass = __webpack_require__(45);\n\nvar _pass2 = _interopRequireDefault(_pass);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Checkpoints = {\n    BATTLE_CHECK: 'battle',\n    MARCH_CHECK: 'march',\n    RECRUIT_CHECK: 'recruit',\n    SEIZE_CHECK: 'seize',\n    EVENT_CHECK: 'event',\n    RALLY_CHECK: 'rally',\n    SPREAD_MARCH_CHECK: 'spread-march',\n    FIRST_RAID_CHECK: 'first-raid',\n    MASS_MARCH_CHECK: 'mass-march',\n    SECOND_RAID_CHECK: 'second-raid'\n\n};\n\nvar RomanBot = function (_Bot) {\n    _inherits(RomanBot, _Bot);\n\n    function RomanBot() {\n        _classCallCheck(this, RomanBot);\n\n        return _possibleConstructorReturn(this, (RomanBot.__proto__ || Object.getPrototypeOf(RomanBot)).call(this, { factionId: _factionIds2.default.ROMANS }));\n    }\n\n    _createClass(RomanBot, [{\n        key: 'takeTurn',\n        value: function takeTurn(state) {\n            var commandAction = null;\n            var turn = state.turnHistory.currentTurn;\n            var modifiers = turn.getContext();\n\n            if (!turn.getCheckpoint(Checkpoints.BATTLE_CHECK) && modifiers.isCommandAllowed(_commandIds2.default.BATTLE)) {\n                commandAction = _romanBattle2.default.battle(state, modifiers);\n            }\n            turn.markCheckpoint(Checkpoints.BATTLE_CHECK);\n\n            if (modifiers.context.tryThreatMarch) {\n                if (!turn.getCheckpoint(Checkpoints.MARCH_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                    commandAction = _romanMarch2.default.march(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.MARCH_CHECK);\n\n                if (!turn.getCheckpoint(Checkpoints.RECRUIT_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RECRUIT)) {\n                    commandAction = _romanRecruit2.default.recruit(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.RECRUIT_CHECK);\n\n                if (!turn.getCheckpoint(Checkpoints.SEIZE_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.SEIZE)) {\n                    commandAction = _romanSeize2.default.seize(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.SEIZE_CHECK);\n            } else {\n                if (!turn.getCheckpoint(Checkpoints.EVENT_CHECK) && !commandAction && this.canPlayEvent(state) && _romanEvent2.default.handleEvent(state)) {\n                    commandAction = _factionActions2.default.EVENT;\n                }\n                turn.markCheckpoint(Checkpoints.EVENT_CHECK);\n\n                if (!turn.getCheckpoint(Checkpoints.MARCH_CHECK) && !commandAction && state.romans.availableAuxilia().length <= 8 && modifiers.isCommandAllowed(_commandIds2.default.MARCH)) {\n                    commandAction = _romanMarch2.default.march(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.MARCH_CHECK);\n\n                if (!turn.getCheckpoint(Checkpoints.RECRUIT_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.RECRUIT)) {\n                    commandAction = _romanRecruit2.default.recruit(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.RECRUIT_CHECK);\n\n                if (!turn.getCheckpoint(Checkpoints.SEIZE_CHECK) && !commandAction && modifiers.isCommandAllowed(_commandIds2.default.SEIZE)) {\n                    commandAction = _romanSeize2.default.seize(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.SEIZE_CHECK);\n            }\n\n            commandAction = commandAction || _factionActions2.default.PASS;\n\n            if (commandAction === _factionActions2.default.PASS) {\n                _pass2.default.execute(state, { factionId: _factionIds2.default.ROMANS });\n            }\n\n            state.sequenceOfPlay.recordFactionAction(_factionIds2.default.ROMANS, commandAction);\n            return commandAction;\n        }\n    }, {\n        key: 'willHarass',\n        value: function willHarass(factionId) {\n            return factionId === _factionIds2.default.ARVERNI;\n        }\n    }, {\n        key: 'willAgreeToSupplyLine',\n        value: function willAgreeToSupplyLine(state, factionId) {\n            return factionId === _factionIds2.default.AEDUI && state.playersByFaction[factionId].isNonPlayer;\n        }\n    }, {\n        key: 'willAgreeToRetreat',\n        value: function willAgreeToRetreat(state, factionId) {\n            return factionId === _factionIds2.default.AEDUI && state.playersByFaction[factionId].isNonPlayer;\n        }\n    }, {\n        key: 'willAgreeToQuarters',\n        value: function willAgreeToQuarters(state, factionId) {\n            return factionId === _factionIds2.default.AEDUI && state.playersByFaction[factionId].isNonPlayer;\n        }\n    }, {\n        key: 'handleEvent',\n        value: function handleEvent(state, currentCard) {}\n    }, {\n        key: 'quarters',\n        value: function quarters(state) {\n            var _this2 = this;\n\n            var regionsWithSupply = (0, _lodash2.default)(state.regions).filter(function (region) {\n                return !region.devastated() && region.hasValidSupplyLine(_this2.factionId);\n            }).value();\n\n            var regionData = (0, _lodash2.default)(state.regions).map(function (region) {\n                var pieces = region.getPiecesForFaction(_this2.factionId);\n                var countByType = _lodash2.default.countBy(pieces, 'type');\n                var numFortAndAlly = countByType.fort || 0 + (countByType.alliedtribe || 0);\n                var numAuxilia = countByType.auxilia || 0;\n\n                var numAuxiliaToMove = Math.max(numAuxilia - numFortAndAlly, 0);\n                var numLegionsToMove = countByType.legion || 0;\n                if (numAuxiliaToMove + numLegionsToMove === 0) {\n                    return;\n                }\n\n                var hasSupply = region.hasValidSupplyLine(_this2.factionId);\n                var adjacentToSupply = _lodash2.default.intersectionBy(region.adjacent, regionsWithSupply, 'id').length > 0;\n\n                return {\n                    region: region,\n                    devastated: region.devastated(),\n                    hasAlly: (countByType.alliedtribe || 0) > 0,\n                    numAuxiliaToMove: numAuxiliaToMove,\n                    numLegionsToMove: numLegionsToMove,\n                    hasSupply: hasSupply,\n                    adjacentToSupply: adjacentToSupply\n                };\n            }).compact().value();\n\n            var regionsNeedingSupply = (0, _lodash2.default)(regionData).filter(function (data) {\n                return !data.hasSupply && !data.adjacentToSupply;\n            }).value();\n\n            if (regionsNeedingSupply.length > 0) {\n                var agreements = this.getSupplyLineAgreements(state, null, [_factionIds2.default.AEDUI, _factionIds2.default.ARVERNI, _factionIds2.default.BELGAE]);\n                var newRegionsWithSupply = (0, _lodash2.default)(state.regions).filter(function (region) {\n                    return !region.devastated() && region.hasValidSupplyLine(_this2.factionId, agreements);\n                }).value();\n                _lodash2.default.each(regionData, function (data) {\n                    data.hasSupply = data.region.hasValidSupplyLine(_this2.factionId, agreements);\n                    data.adjacentToSupply = _lodash2.default.intersectionBy(data.region.adjacent, regionsWithSupply, 'id').length > 0;\n                });\n            }\n\n            var regionsToMoveToProvincia = (0, _lodash2.default)(regionData).filter(function (data) {\n                return data.region.id !== _regionIds2.default.PROVINCIA && (data.hasSupply || data.adjacentToSupply);\n            }).value();\n\n            _lodash2.default.each(regionsToMoveToProvincia, function (data) {\n\n                var legions = data.region.getLegions();\n                var leader = data.region.getLeaderForFaction(_this2.factionId);\n                var auxilia = _lodash2.default.take(data.region.getWarbandsOrAuxiliaForFaction(_this2.factionId), data.numAuxiliaToMove);\n                var pieces = (0, _lodash2.default)([]).concat(legions, [leader], auxilia).compact().value();\n\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: data.region.id,\n                    destRegionId: _regionIds2.default.PROVINCIA,\n                    pieces: pieces\n                });\n            });\n\n            var leaderRegion = this.findLeaderRegion(state);\n            if (leaderRegion && leaderRegion.id !== _regionIds2.default.PROVINCIA) {\n\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: leaderRegion.id,\n                    destRegionId: _regionIds2.default.PROVINCIA,\n                    pieces: [leaderRegion.getLeaderForFaction(this.factionId)]\n                });\n            }\n\n            // Pay for those staying\n            var regionsToStay = (0, _lodash2.default)(regionData).filter(function (data) {\n                return data.region.id !== _regionIds2.default.PROVINCIA && !data.hasSupply && !data.adjacentToSupply;\n            }).sortBy(function (data) {\n                if (data.hasAlly) {\n                    return 'a';\n                } else if (!data.devastated) {\n                    return 'b';\n                } else {\n                    return 'c';\n                }\n            }).value();\n\n            _lodash2.default.each(regionsToStay, function (data) {\n                var resourcesAvailable = state.romans.resources();\n                var legions = data.region.getLegions();\n                var auxilia = _lodash2.default.take(data.region.getWarbandsOrAuxiliaForFaction(_this2.factionId), data.numAuxiliaToMove);\n                var pieces = (0, _lodash2.default)([]).concat(legions, auxilia).value();\n                var orderedPieces = _losses2.default.orderPiecesForRemoval(state, pieces).reverse();\n                var pieceCost = (data.hasAlly ? 1 : 2) * (data.devastated ? 1 : 2);\n                var numPiecesToPayFor = Math.min(Math.floor(resourcesAvailable / pieceCost), orderedPieces.length);\n\n                if (numPiecesToPayFor > 0) {\n                    _removeResources2.default.execute(state, {\n                        factionId: _this2.factionId,\n                        count: numPiecesToPayFor * pieceCost\n                    });\n                }\n\n                var piecesToRemove = (0, _lodash2.default)(orderedPieces).drop(numPiecesToPayFor).filter(function (piece) {\n                    return _lodash2.default.random(1, 6) < 4;\n                }).value();\n                if (piecesToRemove.length > 0) {\n                    _removePieces2.default.execute(state, {\n                        factionId: _this2.factionId,\n                        regionId: data.region.id,\n                        pieces: piecesToRemove\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            var _this3 = this;\n\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_this3.factionId], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return RomanBot;\n}(_bot2.default);\n\nexports.default = RomanBot;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5Cb3QuanM/YmUyOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsaWIvbG9kYXNoJztcbmltcG9ydCBCb3QgZnJvbSAnLi4vYm90JztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnZmFsbGluZ3NreS9jb25maWcvcmVnaW9uSWRzJztcbmltcG9ydCBSb21hbkV2ZW50IGZyb20gJy4vcm9tYW5FdmVudCc7XG5pbXBvcnQgUm9tYW5CYXR0bGUgZnJvbSAnLi9yb21hbkJhdHRsZSc7XG5pbXBvcnQgUm9tYW5SZWNydWl0IGZyb20gJy4vcm9tYW5SZWNydWl0JztcbmltcG9ydCBSb21hblNlaXplIGZyb20gJy4vcm9tYW5TZWl6ZSc7XG5pbXBvcnQgUm9tYW5NYXJjaCBmcm9tICcuL3JvbWFuTWFyY2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgTW92ZVBpZWNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBMb3NzZXMgZnJvbSAnZmFsbGluZ3NreS91dGlsL2xvc3Nlcyc7XG5pbXBvcnQgUGFzcyBmcm9tICcuLi8uLi9jb21tYW5kcy9wYXNzJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgQkFUVExFX0NIRUNLOiAnYmF0dGxlJyxcbiAgICBNQVJDSF9DSEVDSzogJ21hcmNoJyxcbiAgICBSRUNSVUlUX0NIRUNLOiAncmVjcnVpdCcsXG4gICAgU0VJWkVfQ0hFQ0s6ICdzZWl6ZScsXG4gICAgRVZFTlRfQ0hFQ0s6ICdldmVudCcsXG4gICAgUkFMTFlfQ0hFQ0s6ICdyYWxseScsXG4gICAgU1BSRUFEX01BUkNIX0NIRUNLOiAnc3ByZWFkLW1hcmNoJyxcbiAgICBGSVJTVF9SQUlEX0NIRUNLOiAnZmlyc3QtcmFpZCcsXG4gICAgTUFTU19NQVJDSF9DSEVDSzogJ21hc3MtbWFyY2gnLFxuICAgIFNFQ09ORF9SQUlEX0NIRUNLOiAnc2Vjb25kLXJhaWQnXG5cbn07XG5cblxuY2xhc3MgUm9tYW5Cb3QgZXh0ZW5kcyBCb3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOU30pO1xuICAgIH1cblxuICAgIHRha2VUdXJuKHN0YXRlKSB7XG4gICAgICAgIGxldCBjb21tYW5kQWN0aW9uID0gbnVsbDtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmN1cnJlbnRUdXJuO1xuICAgICAgICBjb25zdCBtb2RpZmllcnMgPSB0dXJuLmdldENvbnRleHQoKTtcblxuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5CQVRUTEVfQ0hFQ0spICYmIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKENvbW1hbmRJRHMuQkFUVExFKSkge1xuICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IFJvbWFuQmF0dGxlLmJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLkJBVFRMRV9DSEVDSyk7XG5cbiAgICAgICAgaWYgKG1vZGlmaWVycy5jb250ZXh0LnRyeVRocmVhdE1hcmNoKSB7XG4gICAgICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5NQVJDSF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuTUFSQ0gpKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IFJvbWFuTWFyY2gubWFyY2goc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLk1BUkNIX0NIRUNLKTtcblxuICAgICAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkVDUlVJVF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuUkVDUlVJVCkpIHtcbiAgICAgICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gUm9tYW5SZWNydWl0LnJlY3J1aXQoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlJFQ1JVSVRfQ0hFQ0spO1xuXG4gICAgICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5TRUlaRV9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuU0VJWkUpKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IFJvbWFuU2VpemUuc2VpemUoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFSVpFX0NIRUNLKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLkVWRU5UX0NIRUNLKSAmJiAhY29tbWFuZEFjdGlvbiAmJiB0aGlzLmNhblBsYXlFdmVudChcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUpICYmIFJvbWFuRXZlbnQuaGFuZGxlRXZlbnQoc3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IEZhY3Rpb25BY3Rpb25zLkVWRU5UO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5FVkVOVF9DSEVDSyk7XG5cblxuICAgICAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuTUFSQ0hfQ0hFQ0spICYmICFjb21tYW5kQWN0aW9uICYmXG4gICAgICAgICAgICAgICAgc3RhdGUucm9tYW5zLmF2YWlsYWJsZUF1eGlsaWEoKS5sZW5ndGggPD0gOCAmJlxuICAgICAgICAgICAgICAgIG1vZGlmaWVycy5pc0NvbW1hbmRBbGxvd2VkKENvbW1hbmRJRHMuTUFSQ0gpKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IFJvbWFuTWFyY2gubWFyY2goc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLk1BUkNIX0NIRUNLKTtcblxuICAgICAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkVDUlVJVF9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuUkVDUlVJVCkpIHtcbiAgICAgICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gUm9tYW5SZWNydWl0LnJlY3J1aXQoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlJFQ1JVSVRfQ0hFQ0spO1xuXG4gICAgICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5TRUlaRV9DSEVDSykgJiYgIWNvbW1hbmRBY3Rpb24gJiYgbW9kaWZpZXJzLmlzQ29tbWFuZEFsbG93ZWQoXG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRJRHMuU0VJWkUpKSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEFjdGlvbiA9IFJvbWFuU2VpemUuc2VpemUoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlNFSVpFX0NIRUNLKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbW1hbmRBY3Rpb24gPSBjb21tYW5kQWN0aW9uIHx8IEZhY3Rpb25BY3Rpb25zLlBBU1M7XG5cbiAgICAgICAgaWYgKGNvbW1hbmRBY3Rpb24gPT09IEZhY3Rpb25BY3Rpb25zLlBBU1MpIHtcbiAgICAgICAgICAgIFBhc3MuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlN9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXRlLnNlcXVlbmNlT2ZQbGF5LnJlY29yZEZhY3Rpb25BY3Rpb24oRmFjdGlvbklEcy5ST01BTlMsIGNvbW1hbmRBY3Rpb24pO1xuICAgICAgICByZXR1cm4gY29tbWFuZEFjdGlvbjtcbiAgICB9XG5cbiAgICB3aWxsSGFyYXNzKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFSVkVSTkk7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9TdXBwbHlMaW5lKHN0YXRlLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5BRURVSSAmJiBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXI7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9SZXRyZWF0KHN0YXRlLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5BRURVSSAmJiBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXI7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9RdWFydGVycyhzdGF0ZSwgZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuQUVEVUkgJiYgc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdLmlzTm9uUGxheWVyO1xuICAgIH1cblxuICAgIGhhbmRsZUV2ZW50KHN0YXRlLCBjdXJyZW50Q2FyZCkge1xuXG4gICAgfVxuXG4gICAgcXVhcnRlcnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgcmVnaW9uc1dpdGhTdXBwbHkgPSBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgIHJlZ2lvbiA9PiAhcmVnaW9uLmRldmFzdGF0ZWQoKSAmJiByZWdpb24uaGFzVmFsaWRTdXBwbHlMaW5lKHRoaXMuZmFjdGlvbklkKSkudmFsdWUoKTtcblxuICAgICAgICBjb25zdCByZWdpb25EYXRhID0gXyhzdGF0ZS5yZWdpb25zKS5tYXAocmVnaW9uID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IHJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50QnlUeXBlID0gXy5jb3VudEJ5KHBpZWNlcywgJ3R5cGUnKTtcbiAgICAgICAgICAgIGNvbnN0IG51bUZvcnRBbmRBbGx5ID0gKGNvdW50QnlUeXBlLmZvcnQpIHx8IDAgKyAoY291bnRCeVR5cGUuYWxsaWVkdHJpYmUgfHwgMCk7XG4gICAgICAgICAgICBjb25zdCBudW1BdXhpbGlhID0gY291bnRCeVR5cGUuYXV4aWxpYSB8fCAwO1xuXG4gICAgICAgICAgICBjb25zdCBudW1BdXhpbGlhVG9Nb3ZlID0gTWF0aC5tYXgobnVtQXV4aWxpYSAtIG51bUZvcnRBbmRBbGx5LCAwKTtcbiAgICAgICAgICAgIGNvbnN0IG51bUxlZ2lvbnNUb01vdmUgPSBjb3VudEJ5VHlwZS5sZWdpb24gfHwgMDtcbiAgICAgICAgICAgIGlmIChudW1BdXhpbGlhVG9Nb3ZlICsgbnVtTGVnaW9uc1RvTW92ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaGFzU3VwcGx5ID0gcmVnaW9uLmhhc1ZhbGlkU3VwcGx5TGluZSh0aGlzLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICBjb25zdCBhZGphY2VudFRvU3VwcGx5ID0gXy5pbnRlcnNlY3Rpb25CeShyZWdpb24uYWRqYWNlbnQsIHJlZ2lvbnNXaXRoU3VwcGx5LCAnaWQnKS5sZW5ndGggPiAwO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICBkZXZhc3RhdGVkOiByZWdpb24uZGV2YXN0YXRlZCgpLFxuICAgICAgICAgICAgICAgIGhhc0FsbHk6IChjb3VudEJ5VHlwZS5hbGxpZWR0cmliZSB8fCAwKSA+IDAsXG4gICAgICAgICAgICAgICAgbnVtQXV4aWxpYVRvTW92ZSxcbiAgICAgICAgICAgICAgICBudW1MZWdpb25zVG9Nb3ZlLFxuICAgICAgICAgICAgICAgIGhhc1N1cHBseSxcbiAgICAgICAgICAgICAgICBhZGphY2VudFRvU3VwcGx5XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IHJlZ2lvbnNOZWVkaW5nU3VwcGx5ID0gXyhyZWdpb25EYXRhKS5maWx0ZXIoZGF0YSA9PiAhZGF0YS5oYXNTdXBwbHkgJiYgIWRhdGEuYWRqYWNlbnRUb1N1cHBseSkudmFsdWUoKTtcblxuICAgICAgICBpZiAocmVnaW9uc05lZWRpbmdTdXBwbHkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgYWdyZWVtZW50cyA9IHRoaXMuZ2V0U3VwcGx5TGluZUFncmVlbWVudHMoc3RhdGUsIG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbRmFjdGlvbklEcy5BRURVSSwgRmFjdGlvbklEcy5BUlZFUk5JLCBGYWN0aW9uSURzLkJFTEdBRV0pO1xuICAgICAgICAgICAgY29uc3QgbmV3UmVnaW9uc1dpdGhTdXBwbHkgPSBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgICAgICByZWdpb24gPT4gIXJlZ2lvbi5kZXZhc3RhdGVkKCkgJiYgcmVnaW9uLmhhc1ZhbGlkU3VwcGx5TGluZSh0aGlzLmZhY3Rpb25JZCwgYWdyZWVtZW50cykpLnZhbHVlKCk7XG4gICAgICAgICAgICBfLmVhY2gocmVnaW9uRGF0YSwgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgZGF0YS5oYXNTdXBwbHkgPSBkYXRhLnJlZ2lvbi5oYXNWYWxpZFN1cHBseUxpbmUodGhpcy5mYWN0aW9uSWQsIGFncmVlbWVudHMpO1xuICAgICAgICAgICAgICAgIGRhdGEuYWRqYWNlbnRUb1N1cHBseSA9IF8uaW50ZXJzZWN0aW9uQnkoZGF0YS5yZWdpb24uYWRqYWNlbnQsIHJlZ2lvbnNXaXRoU3VwcGx5LCAnaWQnKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZWdpb25zVG9Nb3ZlVG9Qcm92aW5jaWEgPSBfKHJlZ2lvbkRhdGEpLmZpbHRlcihcbiAgICAgICAgICAgIGRhdGEgPT4gZGF0YS5yZWdpb24uaWQgIT09IFJlZ2lvbklEcy5QUk9WSU5DSUEgJiYgKGRhdGEuaGFzU3VwcGx5IHx8IGRhdGEuYWRqYWNlbnRUb1N1cHBseSkpLnZhbHVlKCk7XG5cbiAgICAgICAgXy5lYWNoKHJlZ2lvbnNUb01vdmVUb1Byb3ZpbmNpYSwgZGF0YSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IGxlZ2lvbnMgPSBkYXRhLnJlZ2lvbi5nZXRMZWdpb25zKCk7XG4gICAgICAgICAgICBjb25zdCBsZWFkZXIgPSBkYXRhLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKTtcbiAgICAgICAgICAgIGNvbnN0IGF1eGlsaWEgPSBfLnRha2UoZGF0YS5yZWdpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKSwgZGF0YS5udW1BdXhpbGlhVG9Nb3ZlKTtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IF8oW10pLmNvbmNhdChsZWdpb25zLCBbbGVhZGVyXSwgYXV4aWxpYSkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBkYXRhLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICBkZXN0UmVnaW9uSWQ6IFJlZ2lvbklEcy5QUk9WSU5DSUEsXG4gICAgICAgICAgICAgICAgcGllY2VzOiBwaWVjZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBsZWFkZXJSZWdpb24gPSB0aGlzLmZpbmRMZWFkZXJSZWdpb24oc3RhdGUpO1xuICAgICAgICBpZihsZWFkZXJSZWdpb24gJiYgbGVhZGVyUmVnaW9uLmlkICE9PSBSZWdpb25JRHMuUFJPVklOQ0lBKSB7XG5cbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBsZWFkZXJSZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBSZWdpb25JRHMuUFJPVklOQ0lBLFxuICAgICAgICAgICAgICAgIHBpZWNlczogW2xlYWRlclJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuZmFjdGlvbklkKV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGF5IGZvciB0aG9zZSBzdGF5aW5nXG4gICAgICAgIGNvbnN0IHJlZ2lvbnNUb1N0YXkgPSBfKHJlZ2lvbkRhdGEpLmZpbHRlcihcbiAgICAgICAgICAgIGRhdGEgPT4gZGF0YS5yZWdpb24uaWQgIT09IFJlZ2lvbklEcy5QUk9WSU5DSUEgJiYgIWRhdGEuaGFzU3VwcGx5ICYmICFkYXRhLmFkamFjZW50VG9TdXBwbHkpLnNvcnRCeShkYXRhPT4ge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmhhc0FsbHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdhJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZighZGF0YS5kZXZhc3RhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2MnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICBfLmVhY2gocmVnaW9uc1RvU3RheSwgZGF0YT0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlc0F2YWlsYWJsZSA9IHN0YXRlLnJvbWFucy5yZXNvdXJjZXMoKTtcbiAgICAgICAgICAgIGNvbnN0IGxlZ2lvbnMgPSBkYXRhLnJlZ2lvbi5nZXRMZWdpb25zKCk7XG4gICAgICAgICAgICBjb25zdCBhdXhpbGlhID0gXy50YWtlKGRhdGEucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbih0aGlzLmZhY3Rpb25JZCksIGRhdGEubnVtQXV4aWxpYVRvTW92ZSk7XG4gICAgICAgICAgICBjb25zdCBwaWVjZXMgPSBfKFtdKS5jb25jYXQobGVnaW9ucywgYXV4aWxpYSkudmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyZWRQaWVjZXMgPSBMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBwaWVjZXMpLnJldmVyc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlQ29zdCA9IChkYXRhLmhhc0FsbHkgPyAxIDogMikgKiAoZGF0YS5kZXZhc3RhdGVkID8gMSA6IDIpO1xuICAgICAgICAgICAgY29uc3QgbnVtUGllY2VzVG9QYXlGb3IgPSBNYXRoLm1pbihNYXRoLmZsb29yKHJlc291cmNlc0F2YWlsYWJsZSAvIHBpZWNlQ29zdCksIG9yZGVyZWRQaWVjZXMubGVuZ3RoKTtcblxuICAgICAgICAgICAgaWYobnVtUGllY2VzVG9QYXlGb3IgPiAwKSB7XG4gICAgICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IG51bVBpZWNlc1RvUGF5Rm9yICogcGllY2VDb3N0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHBpZWNlc1RvUmVtb3ZlID0gXyhvcmRlcmVkUGllY2VzKS5kcm9wKG51bVBpZWNlc1RvUGF5Rm9yKS5maWx0ZXIocGllY2U9PiBfLnJhbmRvbSgxLDYpIDwgNCkudmFsdWUoKTtcbiAgICAgICAgICAgIGlmKHBpZWNlc1RvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IHRoaXMuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogZGF0YS5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlczogcGllY2VzVG9SZW1vdmVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGZpbmRMZWFkZXJSZWdpb24oc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChzdGF0ZS5yZWdpb25zLCAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gXy5maW5kKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVt0aGlzLmZhY3Rpb25JZF0sIHt0eXBlOiAnbGVhZGVyJ30pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUm9tYW5Cb3Q7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5Cb3QuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQUNBO0FBY0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBRUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTs7O0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUVBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _enlist = __webpack_require__(55);\n\nvar _enlist2 = _interopRequireDefault(_enlist);\n\nvar _rampage = __webpack_require__(56);\n\nvar _rampage2 = _interopRequireDefault(_rampage);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanUtils = function () {\n    function RomanUtils() {\n        _classCallCheck(this, RomanUtils);\n    }\n\n    _createClass(RomanUtils, null, [{\n        key: 'getWorstLossesForAllEnemyInitiatedBattlesInRegion',\n        value: function getWorstLossesForAllEnemyInitiatedBattlesInRegion(state, region, defendingPieces) {\n            var _this = this;\n\n            return _lodash2.default.reduce(state.factionsById, function (losses, faction) {\n                var factionLosses = _this.getWorstLossesForEnemyInitiatedBattle(state, region, faction.id, defendingPieces);\n                return Math.max(factionLosses, losses);\n            }, 0);\n        }\n    }, {\n        key: 'getWorstLossesForEnemyInitiatedBattle',\n        value: function getWorstLossesForEnemyInitiatedBattle(state, region, factionId, defendingPieces) {\n            var canEnlist = false;\n            var rampageLosses = 0;\n\n            if (factionId === _factionIds2.default.BELGAE) {\n                var rampageResults = _rampage2.default.test(state);\n                var resultForRegion = _lodash2.default.find(rampageResults, function (result) {\n                    return result.region.id === region.id;\n                });\n                rampageLosses = resultForRegion ? resultForRegion.numWarbands : 0;\n                var enlistResults = _enlist2.default.test(state);\n                canEnlist = _lodash2.default.find(enlistResults, function (result) {\n                    return result.region.id === region.id;\n                });\n            }\n\n            var battleResult = _battle2.default.test(state, {\n                region: region,\n                attackingFactionId: factionId,\n                defendingFactionId: _factionIds2.default.ROMANS,\n                defendingPieces: defendingPieces\n            });\n\n            var worstLosses = rampageLosses + battleResult.mostDefenderLosses();\n            if (canEnlist) {\n                var enlistBattleResult = _battle2.default.test(state, {\n                    region: region,\n                    attackingFactionId: factionId,\n                    defendingFactionId: _factionIds2.default.ROMANS,\n                    defendingPieces: defendingPieces,\n                    enlistingGermans: true\n                });\n\n                worstLosses = Math.max(worstLosses, enlistBattleResult.mostDefenderLosses());\n            }\n\n            return worstLosses;\n        }\n    }, {\n        key: 'canEnemyTurnInflictCriticalLoss',\n        value: function canEnemyTurnInflictCriticalLoss(state, region, factionId) {\n\n            // First vanilla battle:\n            var battleResult = _battle2.default.test(state, {\n                region: region,\n                attackingFactionId: factionId,\n                defendingFactionId: _factionIds2.default.ROMANS\n            });\n\n            if (battleResult.willInflictLossAgainstLegion(battleResult.ambush) || battleResult.willInflictLossAgainstLeader(battleResult.ambush)) {\n                return true;\n            }\n\n            // Check rampage / enlist:\n            if (factionId === _factionIds2.default.BELGAE) {\n\n                // Rampage alone first\n                var rampageResults = _rampage2.default.test(state);\n                var resultForRegion = _lodash2.default.find(rampageResults, function (result) {\n                    return result.region.id === region.id;\n                });\n                var rampageLosses = resultForRegion ? resultForRegion.numWarbands : 0;\n                if (!battleResult.defenderCanGuaranteeSafeRetreat && region.getLegions().length > 0 && region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length < rampageLosses) {\n                    return true;\n                }\n\n                // Apply rampage results and re-test battle:\n                var groupedPieces = _lodash2.default.groupBy(region.getPiecesForFaction(_factionIds2.default.ROMANS), 'type');\n                groupedPieces.auxilia = _lodash2.default.drop(groupedPieces.auxilia, rampageLosses);\n                var defendingPieces = (0, _lodash2.default)(groupedPieces).values().flatten().value();\n\n                var postRampageBattleResult = _battle2.default.test(state, {\n                    region: region,\n                    attackingFactionId: factionId,\n                    defendingFactionId: _factionIds2.default.ROMANS,\n                    defendingPieces: defendingPieces\n                });\n\n                if (postRampageBattleResult.willInflictLossAgainstLegion(postRampageBattleResult.ambush) || postRampageBattleResult.willInflictLossAgainstLeader(postRampageBattleResult.ambush)) {\n                    return true;\n                }\n\n                // Check enlist:\n                var enlistResults = _enlist2.default.test(state);\n                var canEnlist = _lodash2.default.find(enlistResults, function (result) {\n                    return result.region.id === region.id;\n                });\n\n                if (canEnlist) {\n                    var enlistBattleResult = _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: factionId,\n                        defendingFactionId: _factionIds2.default.ROMANS,\n                        enlistingGermans: true\n                    });\n                    if (enlistBattleResult.willInflictLossAgainstLegion(enlistBattleResult.ambush) || enlistBattleResult.willInflictLossAgainstLeader(enlistBattleResult.ambush)) {\n                        return true;\n                    }\n                }\n            }\n\n            return false;\n        }\n    }, {\n        key: 'takeHarassmentLosses',\n        value: function takeHarassmentLosses(state, region, losses) {\n            var mobileOnly = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n            var pieces = _losses2.default.orderPiecesForRemoval(state, mobileOnly ? region.getMobilePiecesForFaction(_factionIds2.default.ROMANS) : region.getPiecesForFaction(_factionIds2.default.ROMANS));\n\n            var removed = [];\n            if (pieces.length > 0) {\n                _lodash2.default.each(_lodash2.default.range(0, losses), function (index) {\n                    var piece = _lodash2.default.first(pieces);\n                    var willRemove = true;\n                    var canRollForLoss = piece.type === 'leader' || piece.type === 'citadel' || piece.type === 'legion' || piece.type === 'fort';\n                    if (canRollForLoss) {\n                        var roll = _lodash2.default.random(1, 6);\n                        console.log('Rolling for loss of ' + piece.type + ', need 4-6 and got ' + roll);\n                        willRemove = roll < 4;\n                    }\n\n                    if (willRemove) {\n                        removed.push(pieces.shift());\n                    } else {\n                        console.log(piece.type + ' saved!');\n                    }\n\n                    if (pieces.length === 0) {\n                        return false;\n                    }\n                });\n            }\n\n            if (removed.length > 0) {\n                _removePieces2.default.execute(state, {\n                    regionId: region.id,\n                    factionId: _factionIds2.default.ROMANS,\n                    pieces: removed\n                });\n            }\n        }\n    }]);\n\n    return RomanUtils;\n}();\n\nexports.default = RomanUtils;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5VdGlscy5qcz9kNGQ0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEVubGlzdCBmcm9tICdmYWxsaW5nc2t5L2NvbW1hbmRzL2JlbGdhZS9lbmxpc3QnO1xuaW1wb3J0IFJhbXBhZ2UgZnJvbSAnZmFsbGluZ3NreS9jb21tYW5kcy9iZWxnYWUvcmFtcGFnZSc7XG5pbXBvcnQgQmF0dGxlIGZyb20gJ2ZhbGxpbmdza3kvY29tbWFuZHMvYmF0dGxlJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJlbW92ZVBpZWNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBMb3NzZXMgZnJvbSAnZmFsbGluZ3NreS91dGlsL2xvc3Nlcyc7XG5cbmNsYXNzIFJvbWFuVXRpbHMge1xuXG4gICAgc3RhdGljIGdldFdvcnN0TG9zc2VzRm9yQWxsRW5lbXlJbml0aWF0ZWRCYXR0bGVzSW5SZWdpb24oc3RhdGUsIHJlZ2lvbiwgZGVmZW5kaW5nUGllY2VzKSB7XG4gICAgICAgIHJldHVybiBfLnJlZHVjZShzdGF0ZS5mYWN0aW9uc0J5SWQsIChsb3NzZXMsIGZhY3Rpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZhY3Rpb25Mb3NzZXMgPSB0aGlzLmdldFdvcnN0TG9zc2VzRm9yRW5lbXlJbml0aWF0ZWRCYXR0bGUoc3RhdGUsIHJlZ2lvbiwgZmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nUGllY2VzKTtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChmYWN0aW9uTG9zc2VzLCBsb3NzZXMpO1xuICAgICAgICB9LCAwKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0V29yc3RMb3NzZXNGb3JFbmVteUluaXRpYXRlZEJhdHRsZShzdGF0ZSwgcmVnaW9uLCBmYWN0aW9uSWQsIGRlZmVuZGluZ1BpZWNlcykge1xuICAgICAgICBsZXQgY2FuRW5saXN0ID0gZmFsc2U7XG4gICAgICAgIGxldCByYW1wYWdlTG9zc2VzID0gMDtcblxuICAgICAgICBpZiAoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgY29uc3QgcmFtcGFnZVJlc3VsdHMgPSBSYW1wYWdlLnRlc3Qoc3RhdGUpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0Rm9yUmVnaW9uID0gXy5maW5kKHJhbXBhZ2VSZXN1bHRzLCByZXN1bHQgPT4gcmVzdWx0LnJlZ2lvbi5pZCA9PT0gcmVnaW9uLmlkKTtcbiAgICAgICAgICAgIHJhbXBhZ2VMb3NzZXMgPSByZXN1bHRGb3JSZWdpb24gPyByZXN1bHRGb3JSZWdpb24ubnVtV2FyYmFuZHMgOiAwO1xuICAgICAgICAgICAgY29uc3QgZW5saXN0UmVzdWx0cyA9IEVubGlzdC50ZXN0KHN0YXRlKTtcbiAgICAgICAgICAgIGNhbkVubGlzdCA9IF8uZmluZChlbmxpc3RSZXN1bHRzLCByZXN1bHQgPT4gcmVzdWx0LnJlZ2lvbi5pZCA9PT0gcmVnaW9uLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdHRsZVJlc3VsdCA9IEJhdHRsZS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb25JZDogZmFjdGlvbklkLFxuICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUyxcbiAgICAgICAgICAgIGRlZmVuZGluZ1BpZWNlczogZGVmZW5kaW5nUGllY2VzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCB3b3JzdExvc3NlcyA9IHJhbXBhZ2VMb3NzZXMgKyBiYXR0bGVSZXN1bHQubW9zdERlZmVuZGVyTG9zc2VzKCk7XG4gICAgICAgIGlmIChjYW5Fbmxpc3QpIHtcbiAgICAgICAgICAgIGNvbnN0IGVubGlzdEJhdHRsZVJlc3VsdCA9IEJhdHRsZS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUyxcbiAgICAgICAgICAgICAgICBkZWZlbmRpbmdQaWVjZXM6IGRlZmVuZGluZ1BpZWNlcyxcbiAgICAgICAgICAgICAgICBlbmxpc3RpbmdHZXJtYW5zOiB0cnVlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgd29yc3RMb3NzZXMgPSBNYXRoLm1heCh3b3JzdExvc3NlcywgZW5saXN0QmF0dGxlUmVzdWx0Lm1vc3REZWZlbmRlckxvc3NlcygpKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdvcnN0TG9zc2VzO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYW5FbmVteVR1cm5JbmZsaWN0Q3JpdGljYWxMb3NzKHN0YXRlLCByZWdpb24sIGZhY3Rpb25JZCkge1xuXG4gICAgICAgIC8vIEZpcnN0IHZhbmlsbGEgYmF0dGxlOlxuICAgICAgICBjb25zdCBiYXR0bGVSZXN1bHQgPSBCYXR0bGUudGVzdChzdGF0ZSwge1xuICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICBhdHRhY2tpbmdGYWN0aW9uSWQ6IGZhY3Rpb25JZCxcbiAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGJhdHRsZVJlc3VsdC53aWxsSW5mbGljdExvc3NBZ2FpbnN0TGVnaW9uKGJhdHRsZVJlc3VsdC5hbWJ1c2gpIHx8XG4gICAgICAgICAgICBiYXR0bGVSZXN1bHQud2lsbEluZmxpY3RMb3NzQWdhaW5zdExlYWRlcihiYXR0bGVSZXN1bHQuYW1idXNoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayByYW1wYWdlIC8gZW5saXN0OlxuICAgICAgICBpZiAoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuXG4gICAgICAgICAgICAvLyBSYW1wYWdlIGFsb25lIGZpcnN0XG4gICAgICAgICAgICBjb25zdCByYW1wYWdlUmVzdWx0cyA9IFJhbXBhZ2UudGVzdChzdGF0ZSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRGb3JSZWdpb24gPSBfLmZpbmQocmFtcGFnZVJlc3VsdHMsIHJlc3VsdCA9PiByZXN1bHQucmVnaW9uLmlkID09PSByZWdpb24uaWQpO1xuICAgICAgICAgICAgY29uc3QgcmFtcGFnZUxvc3NlcyA9IHJlc3VsdEZvclJlZ2lvbiA/IHJlc3VsdEZvclJlZ2lvbi5udW1XYXJiYW5kcyA6IDA7XG4gICAgICAgICAgICBpZiAoIWJhdHRsZVJlc3VsdC5kZWZlbmRlckNhbkd1YXJhbnRlZVNhZmVSZXRyZWF0ICYmIHJlZ2lvbi5nZXRMZWdpb25zKCkubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgICAgIHJlZ2lvbi5nZXRXYXJiYW5kc09yQXV4aWxpYUZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpLmxlbmd0aCA8IHJhbXBhZ2VMb3NzZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXBwbHkgcmFtcGFnZSByZXN1bHRzIGFuZCByZS10ZXN0IGJhdHRsZTpcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwZWRQaWVjZXMgPSBfLmdyb3VwQnkocmVnaW9uLmdldFBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpLCAndHlwZScpO1xuICAgICAgICAgICAgZ3JvdXBlZFBpZWNlcy5hdXhpbGlhID0gXy5kcm9wKGdyb3VwZWRQaWVjZXMuYXV4aWxpYSwgcmFtcGFnZUxvc3Nlcyk7XG4gICAgICAgICAgICBjb25zdCBkZWZlbmRpbmdQaWVjZXMgPSBfKGdyb3VwZWRQaWVjZXMpLnZhbHVlcygpLmZsYXR0ZW4oKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICBjb25zdCBwb3N0UmFtcGFnZUJhdHRsZVJlc3VsdCA9IEJhdHRsZS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUyxcbiAgICAgICAgICAgICAgICBkZWZlbmRpbmdQaWVjZXM6IGRlZmVuZGluZ1BpZWNlc1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChwb3N0UmFtcGFnZUJhdHRsZVJlc3VsdC53aWxsSW5mbGljdExvc3NBZ2FpbnN0TGVnaW9uKHBvc3RSYW1wYWdlQmF0dGxlUmVzdWx0LmFtYnVzaCkgfHxcbiAgICAgICAgICAgICAgICBwb3N0UmFtcGFnZUJhdHRsZVJlc3VsdC53aWxsSW5mbGljdExvc3NBZ2FpbnN0TGVhZGVyKHBvc3RSYW1wYWdlQmF0dGxlUmVzdWx0LmFtYnVzaCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgZW5saXN0OlxuICAgICAgICAgICAgY29uc3QgZW5saXN0UmVzdWx0cyA9IEVubGlzdC50ZXN0KHN0YXRlKTtcbiAgICAgICAgICAgIGNvbnN0IGNhbkVubGlzdCA9IF8uZmluZChlbmxpc3RSZXN1bHRzLCByZXN1bHQgPT4gcmVzdWx0LnJlZ2lvbi5pZCA9PT0gcmVnaW9uLmlkKTtcblxuICAgICAgICAgICAgaWYgKGNhbkVubGlzdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVubGlzdEJhdHRsZVJlc3VsdCA9IEJhdHRsZS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICBhdHRhY2tpbmdGYWN0aW9uSWQ6IGZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUyxcbiAgICAgICAgICAgICAgICAgICAgZW5saXN0aW5nR2VybWFuczogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChlbmxpc3RCYXR0bGVSZXN1bHQud2lsbEluZmxpY3RMb3NzQWdhaW5zdExlZ2lvbihlbmxpc3RCYXR0bGVSZXN1bHQuYW1idXNoKSB8fFxuICAgICAgICAgICAgICAgICAgICBlbmxpc3RCYXR0bGVSZXN1bHQud2lsbEluZmxpY3RMb3NzQWdhaW5zdExlYWRlcihlbmxpc3RCYXR0bGVSZXN1bHQuYW1idXNoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgdGFrZUhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIHJlZ2lvbiwgbG9zc2VzLCBtb2JpbGVPbmx5ID0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBwaWVjZXMgPSBMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBtb2JpbGVPbmx5ID8gcmVnaW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLmdldFBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpKTtcblxuICAgICAgICBjb25zdCByZW1vdmVkID0gW107XG4gICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgXy5lYWNoKF8ucmFuZ2UoMCwgbG9zc2VzKSwgKGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2UgPSBfLmZpcnN0KHBpZWNlcyk7XG4gICAgICAgICAgICAgICAgbGV0IHdpbGxSZW1vdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhblJvbGxGb3JMb3NzID0gcGllY2UudHlwZSA9PT0gJ2xlYWRlcicgfHwgcGllY2UudHlwZSA9PT0gJ2NpdGFkZWwnIHx8IHBpZWNlLnR5cGUgPT09ICdsZWdpb24nIHx8IHBpZWNlLnR5cGUgPT09ICdmb3J0JztcbiAgICAgICAgICAgICAgICBpZiAoY2FuUm9sbEZvckxvc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sbCA9IF8ucmFuZG9tKDEsIDYpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUm9sbGluZyBmb3IgbG9zcyBvZiAnICsgcGllY2UudHlwZSArICcsIG5lZWQgNC02IGFuZCBnb3QgJyArIHJvbGwpO1xuICAgICAgICAgICAgICAgICAgICB3aWxsUmVtb3ZlID0gcm9sbCA8IDQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHdpbGxSZW1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKHBpZWNlcy5zaGlmdCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBpZWNlLnR5cGUgKyAnIHNhdmVkIScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZW1vdmVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlczogcmVtb3ZlZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSb21hblV0aWxzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hblV0aWxzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _aedui = __webpack_require__(169);\n\nvar _aedui2 = _interopRequireDefault(_aedui);\n\nvar _arverni = __webpack_require__(170);\n\nvar _arverni2 = _interopRequireDefault(_arverni);\n\nvar _belgae = __webpack_require__(171);\n\nvar _belgae2 = _interopRequireDefault(_belgae);\n\nvar _romans = __webpack_require__(173);\n\nvar _romans2 = _interopRequireDefault(_romans);\n\nvar _germanicTribes = __webpack_require__(172);\n\nvar _germanicTribes2 = _interopRequireDefault(_germanicTribes);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Factions = function () {\n    function Factions() {\n        _classCallCheck(this, Factions);\n    }\n\n    _createClass(Factions, null, [{\n        key: 'generateFactions',\n        value: function generateFactions() {\n            return [new _aedui2.default(), new _arverni2.default(), new _belgae2.default(), new _romans2.default(), new _germanicTribes2.default()];\n        }\n    }]);\n\n    return Factions;\n}();\n\nexports.default = Factions;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25zLmpzPzY5MDkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFlZHVpIGZyb20gJy4uL2ZhY3Rpb25zL2FlZHVpJztcbmltcG9ydCBBcnZlcm5pIGZyb20gJy4uL2ZhY3Rpb25zL2FydmVybmknO1xuaW1wb3J0IEJlbGdhZSBmcm9tICcuLi9mYWN0aW9ucy9iZWxnYWUnO1xuaW1wb3J0IFJvbWFucyBmcm9tICcuLi9mYWN0aW9ucy9yb21hbnMnO1xuaW1wb3J0IEdlcm1hbmljVHJpYmVzIGZyb20gJy4uL2ZhY3Rpb25zL2dlcm1hbmljVHJpYmVzJztcblxuY2xhc3MgRmFjdGlvbnMge1xuICAgIHN0YXRpYyBnZW5lcmF0ZUZhY3Rpb25zKCkge1xuICAgICAgICByZXR1cm4gW25ldyBBZWR1aSgpLFxuICAgICAgICAgICAgICAgIG5ldyBBcnZlcm5pKCksXG4gICAgICAgICAgICAgICAgbmV3IEJlbGdhZSgpLFxuICAgICAgICAgICAgICAgIG5ldyBSb21hbnMoKSxcbiAgICAgICAgICAgICAgICBuZXcgR2VybWFuaWNUcmliZXMoKV07XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGYWN0aW9ucztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25zLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFLQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Harassment = function (_PlayerInteraction) {\n    _inherits(Harassment, _PlayerInteraction);\n\n    function Harassment(definition) {\n        _classCallCheck(this, Harassment);\n\n        definition.type = 'Harassment';\n        return _possibleConstructorReturn(this, (Harassment.__proto__ || Object.getPrototypeOf(Harassment)).call(this, definition));\n    }\n\n    return Harassment;\n}(_playerInteraction2.default);\n\nexports.default = Harassment;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL2hhcmFzc21lbnQuanM/MTNkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgSGFyYXNzbWVudCBleHRlbmRzIFBsYXllckludGVyYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdIYXJhc3NtZW50JztcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBIYXJhc3NtZW50O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvaGFyYXNzbWVudC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFEQTtBQUdBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar QuartersAgreement = function (_PlayerInteraction) {\n    _inherits(QuartersAgreement, _PlayerInteraction);\n\n    function QuartersAgreement(definition) {\n        _classCallCheck(this, QuartersAgreement);\n\n        definition.type = 'QuartersAgreement';\n        return _possibleConstructorReturn(this, (QuartersAgreement.__proto__ || Object.getPrototypeOf(QuartersAgreement)).call(this, definition));\n    }\n\n    return QuartersAgreement;\n}(_playerInteraction2.default);\n\nexports.default = QuartersAgreement;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3F1YXJ0ZXJzQWdyZWVtZW50LmpzPzNlMGEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsYXllckludGVyYWN0aW9uIGZyb20gJ2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbic7XG5cbmNsYXNzIFF1YXJ0ZXJzQWdyZWVtZW50IGV4dGVuZHMgUGxheWVySW50ZXJhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ1F1YXJ0ZXJzQWdyZWVtZW50JztcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBRdWFydGVyc0FncmVlbWVudDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3F1YXJ0ZXJzQWdyZWVtZW50LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQURBO0FBR0E7QUFDQTs7OztBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RetreatAgreement = function (_PlayerInteraction) {\n    _inherits(RetreatAgreement, _PlayerInteraction);\n\n    function RetreatAgreement(definition) {\n        _classCallCheck(this, RetreatAgreement);\n\n        definition.type = 'RetreatAgreement';\n        return _possibleConstructorReturn(this, (RetreatAgreement.__proto__ || Object.getPrototypeOf(RetreatAgreement)).call(this, definition));\n    }\n\n    return RetreatAgreement;\n}(_playerInteraction2.default);\n\nexports.default = RetreatAgreement;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3JldHJlYXRBZ3JlZW1lbnQuanM/ZjQ3NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgUmV0cmVhdEFncmVlbWVudCBleHRlbmRzIFBsYXllckludGVyYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdSZXRyZWF0QWdyZWVtZW50JztcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZXRyZWF0QWdyZWVtZW50O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvcmV0cmVhdEFncmVlbWVudC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFEQTtBQUdBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SupplyLineAgreement = function (_PlayerInteraction) {\n    _inherits(SupplyLineAgreement, _PlayerInteraction);\n\n    function SupplyLineAgreement(definition) {\n        _classCallCheck(this, SupplyLineAgreement);\n\n        definition.type = 'SupplyLineAgreement';\n        return _possibleConstructorReturn(this, (SupplyLineAgreement.__proto__ || Object.getPrototypeOf(SupplyLineAgreement)).call(this, definition));\n    }\n\n    return SupplyLineAgreement;\n}(_playerInteraction2.default);\n\nexports.default = SupplyLineAgreement;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3N1cHBseUxpbmVBZ3JlZW1lbnQuanM/Njk4NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgU3VwcGx5TGluZUFncmVlbWVudCBleHRlbmRzIFBsYXllckludGVyYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdTdXBwbHlMaW5lQWdyZWVtZW50JztcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTdXBwbHlMaW5lQWdyZWVtZW50O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvc3VwcGx5TGluZUFncmVlbWVudC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFEQTtBQUdBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _player = __webpack_require__(87);\n\nvar _player2 = _interopRequireDefault(_player);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar FallingSkyPlayer = function (_Player) {\n    _inherits(FallingSkyPlayer, _Player);\n\n    function FallingSkyPlayer(definition) {\n        _classCallCheck(this, FallingSkyPlayer);\n\n        return _possibleConstructorReturn(this, (FallingSkyPlayer.__proto__ || Object.getPrototypeOf(FallingSkyPlayer)).call(this, definition));\n    }\n\n    _createClass(FallingSkyPlayer, [{\n        key: 'willHarass',\n        value: function willHarass() {\n            return true;\n        }\n    }, {\n        key: 'willAgreeToQuarters',\n        value: function willAgreeToQuarters() {\n            return false;\n        }\n    }, {\n        key: 'willAgreeToRetreat',\n        value: function willAgreeToRetreat() {\n            return false;\n        }\n    }, {\n        key: 'willRetreat',\n        value: function willRetreat() {\n            return false;\n        }\n    }, {\n        key: 'willAgreeToSupplyLine',\n        value: function willAgreeToSupplyLine() {\n            return false;\n        }\n    }, {\n        key: 'willApplyBalearicSlingers',\n        value: function willApplyBalearicSlingers() {\n            return false;\n        }\n    }, {\n        key: 'willApplyGermanicHorse',\n        value: function willApplyGermanicHorse() {\n            return false;\n        }\n    }]);\n\n    return FallingSkyPlayer;\n}(_player2.default);\n\nexports.default = FallingSkyPlayer;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvcGxheWVyL2ZhbGxpbmdTa3lQbGF5ZXIuanM/NDhjMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVyIGZyb20gJ2NvbW1vbi9wbGF5ZXInO1xuXG5jbGFzcyBGYWxsaW5nU2t5UGxheWVyIGV4dGVuZHMgUGxheWVyIHtcblxuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxuXG4gICAgd2lsbEhhcmFzcygpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9RdWFydGVycygpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHdpbGxBZ3JlZVRvUmV0cmVhdCgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHdpbGxSZXRyZWF0KCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9TdXBwbHlMaW5lKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgd2lsbEFwcGx5QmFsZWFyaWNTbGluZ2VycygpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHdpbGxBcHBseUdlcm1hbmljSG9yc2UoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRmFsbGluZ1NreVBsYXllcjtcblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L3BsYXllci9mYWxsaW5nU2t5UGxheWVyLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQURBO0FBRUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _fallingSkyPlayer = __webpack_require__(79);\n\nvar _fallingSkyPlayer2 = _interopRequireDefault(_fallingSkyPlayer);\n\nvar _playerInteractionNeededError = __webpack_require__(60);\n\nvar _playerInteractionNeededError2 = _interopRequireDefault(_playerInteractionNeededError);\n\nvar _supplyLineAgreement = __webpack_require__(78);\n\nvar _supplyLineAgreement2 = _interopRequireDefault(_supplyLineAgreement);\n\nvar _quartersAgreement = __webpack_require__(76);\n\nvar _quartersAgreement2 = _interopRequireDefault(_quartersAgreement);\n\nvar _retreatAgreement = __webpack_require__(77);\n\nvar _retreatAgreement2 = _interopRequireDefault(_retreatAgreement);\n\nvar _retreatDeclaration = __webpack_require__(178);\n\nvar _retreatDeclaration2 = _interopRequireDefault(_retreatDeclaration);\n\nvar _balearicSlingersDeclaration = __webpack_require__(174);\n\nvar _balearicSlingersDeclaration2 = _interopRequireDefault(_balearicSlingersDeclaration);\n\nvar _germanicHorseDeclaration = __webpack_require__(175);\n\nvar _germanicHorseDeclaration2 = _interopRequireDefault(_germanicHorseDeclaration);\n\nvar _harassment = __webpack_require__(75);\n\nvar _harassment2 = _interopRequireDefault(_harassment);\n\nvar _losses = __webpack_require__(176);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nvar _retreat = __webpack_require__(177);\n\nvar _retreat2 = _interopRequireDefault(_retreat);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar HumanPlayer = function (_FallingSkyPlayer) {\n    _inherits(HumanPlayer, _FallingSkyPlayer);\n\n    function HumanPlayer(definition) {\n        _classCallCheck(this, HumanPlayer);\n\n        return _possibleConstructorReturn(this, (HumanPlayer.__proto__ || Object.getPrototypeOf(HumanPlayer)).call(this, definition));\n    }\n\n    _createClass(HumanPlayer, [{\n        key: 'willHarass',\n        value: function willHarass(factionId, context) {\n            throw new _playerInteractionNeededError2.default('Harassment possible for ' + factionId, new _harassment2.default({\n                requestingFactionId: factionId,\n                respondingFactionId: this.factionId\n            }));\n        }\n    }, {\n        key: 'willAgreeToQuarters',\n        value: function willAgreeToQuarters(state, factionId) {\n            throw new _playerInteractionNeededError2.default('Quarters requested by ' + factionId, new _quartersAgreement2.default({\n                requestingFactionId: factionId,\n                respondingFactionId: this.factionId\n            }));\n        }\n    }, {\n        key: 'willAgreeToRetreat',\n        value: function willAgreeToRetreat(state, factionId) {\n\n            throw new _playerInteractionNeededError2.default('Retreat requested by ' + factionId, new _retreatAgreement2.default({\n                requestingFactionId: factionId,\n                respondingFactionId: this.factionId\n            }));\n        }\n    }, {\n        key: 'willAgreeToSupplyLine',\n        value: function willAgreeToSupplyLine(state, factionId) {\n            throw new _playerInteractionNeededError2.default('Supply line requested by ' + factionId, new _supplyLineAgreement2.default({\n                requestingFactionId: factionId,\n                respondingFactionId: this.factionId\n            }));\n        }\n    }, {\n        key: 'willApplyGermanicHorse',\n        value: function willApplyGermanicHorse(state, region, attackingFaction, defendingFaction) {\n            throw new _playerInteractionNeededError2.default('Use Germanic Horse Capability?', new _germanicHorseDeclaration2.default({\n                requestingFactionId: attackingFaction.id,\n                respondingFactionId: this.factionId,\n                regionId: region.id\n            }));\n        }\n    }, {\n        key: 'willApplyBalearicSlingers',\n        value: function willApplyBalearicSlingers(state, region, attackingFaction, defendingFaction) {\n            throw new _playerInteractionNeededError2.default('Use Balearic Slingers Capability?', new _balearicSlingersDeclaration2.default({\n                requestingFactionId: attackingFaction.id,\n                respondingFactionId: this.factionId,\n                regionId: region.id,\n                defendingFactionId: defendingFaction.id\n            }));\n        }\n    }, {\n        key: 'willRetreat',\n        value: function willRetreat(state, region, attackingFaction, worstCaseAttackerLosses, noRetreatDefenderResults, retreatDefenderResults) {\n            throw new _playerInteractionNeededError2.default('Will retreat from battle with ' + attackingFaction.id, new _retreatDeclaration2.default({\n                requestingFactionId: attackingFaction.id,\n                respondingFactionId: this.factionId,\n                regionId: region.id\n            }));\n        }\n    }, {\n        key: 'retreatFromBattle',\n        value: function retreatFromBattle(state, battleResults, attackResults) {\n            throw new _playerInteractionNeededError2.default('Retreat from battle with ' + battleResults.attackingFaction.id, new _retreat2.default({\n                requestingFactionId: battleResults.attackingFaction.id,\n                respondingFactionId: this.factionId,\n                regionId: battleResults.region.id\n            }));\n        }\n    }, {\n        key: 'takeLosses',\n        value: function takeLosses(state, battleResults, attackResults, counterattack) {\n            throw new _playerInteractionNeededError2.default('Losses must be taken from battle with ' + battleResults.attackingFaction.id, new _losses2.default({\n                requestingFactionId: battleResults.attackingFaction.id,\n                respondingFactionId: this.factionId,\n                ambush: !counterattack && battleResults.willAmbush,\n                retreated: !counterattack && battleResults.willRetreat,\n                counterattack: counterattack,\n                regionId: battleResults.region.id,\n                losses: attackResults.losses\n            }));\n        }\n    }]);\n\n    return HumanPlayer;\n}(_fallingSkyPlayer2.default);\n\nexports.default = HumanPlayer;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvcGxheWVyL2h1bWFuUGxheWVyLmpzPzdjNWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZhbGxpbmdTa3lQbGF5ZXIgZnJvbSAnLi9mYWxsaW5nU2t5UGxheWVyJztcbmltcG9ydCBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yIGZyb20gJ2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yJztcbmltcG9ydCBTdXBwbHlMaW5lQWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3N1cHBseUxpbmVBZ3JlZW1lbnQnO1xuaW1wb3J0IFF1YXJ0ZXJzQWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3F1YXJ0ZXJzQWdyZWVtZW50JztcbmltcG9ydCBSZXRyZWF0QWdyZWVtZW50IGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3JldHJlYXRBZ3JlZW1lbnQnO1xuaW1wb3J0IFJldHJlYXREZWNsYXJhdGlvbiBmcm9tICdmYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9yZXRyZWF0RGVjbGFyYXRpb24nO1xuaW1wb3J0IEJhbGVhcmljU2xpbmdlcnNEZWNsYXJhdGlvbiBmcm9tICdmYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9iYWxlYXJpY1NsaW5nZXJzRGVjbGFyYXRpb24nO1xuaW1wb3J0IEdlcm1hbmljSG9yc2VEZWNsYXJhdGlvbiBmcm9tICdmYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9nZXJtYW5pY0hvcnNlRGVjbGFyYXRpb24nO1xuaW1wb3J0IEhhcmFzc21lbnQgZnJvbSAnZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvaGFyYXNzbWVudCc7XG5pbXBvcnQgTG9zc2VzIGZyb20gJ2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL2xvc3Nlcyc7XG5pbXBvcnQgUmV0cmVhdCBmcm9tICdmYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9yZXRyZWF0JztcbmltcG9ydCB7Q2FwYWJpbGl0eUlEc30gZnJvbSAnZmFsbGluZ3NreS9jb25maWcvY2FwYWJpbGl0aWVzJztcblxuY2xhc3MgSHVtYW5QbGF5ZXIgZXh0ZW5kcyBGYWxsaW5nU2t5UGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgIH1cblxuICAgIHdpbGxIYXJhc3MoZmFjdGlvbklkLCBjb250ZXh0KSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdIYXJhc3NtZW50IHBvc3NpYmxlIGZvciAnICsgZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSGFyYXNzbWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25kaW5nRmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9RdWFydGVycyhzdGF0ZSwgZmFjdGlvbklkKSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdRdWFydGVycyByZXF1ZXN0ZWQgYnkgJyArIGZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFF1YXJ0ZXJzQWdyZWVtZW50KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uZGluZ0ZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICB3aWxsQWdyZWVUb1JldHJlYXQoc3RhdGUsIGZhY3Rpb25JZCkge1xuXG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdSZXRyZWF0IHJlcXVlc3RlZCBieSAnICsgZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmV0cmVhdEFncmVlbWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25kaW5nRmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgd2lsbEFncmVlVG9TdXBwbHlMaW5lKHN0YXRlLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFBsYXllckludGVyYWN0aW9uTmVlZGVkRXJyb3IoJ1N1cHBseSBsaW5lIHJlcXVlc3RlZCBieSAnICsgZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgU3VwcGx5TGluZUFncmVlbWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nRmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25kaW5nRmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgd2lsbEFwcGx5R2VybWFuaWNIb3JzZShzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdVc2UgR2VybWFuaWMgSG9yc2UgQ2FwYWJpbGl0eT8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgR2VybWFuaWNIb3JzZURlY2xhcmF0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGluZ0ZhY3Rpb25JZDogYXR0YWNraW5nRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uZGluZ0ZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb24uaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgd2lsbEFwcGx5QmFsZWFyaWNTbGluZ2VycyhzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCBkZWZlbmRpbmdGYWN0aW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdVc2UgQmFsZWFyaWMgU2xpbmdlcnMgQ2FwYWJpbGl0eT8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgQmFsZWFyaWNTbGluZ2Vyc0RlY2xhcmF0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGluZ0ZhY3Rpb25JZDogYXR0YWNraW5nRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uZGluZ0ZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiByZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb25JZDogZGVmZW5kaW5nRmFjdGlvbi5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICB3aWxsUmV0cmVhdChzdGF0ZSwgcmVnaW9uLCBhdHRhY2tpbmdGYWN0aW9uLCB3b3JzdENhc2VBdHRhY2tlckxvc3Nlcywgbm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzLCByZXRyZWF0RGVmZW5kZXJSZXN1bHRzKSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdXaWxsIHJldHJlYXQgZnJvbSBiYXR0bGUgd2l0aCAnICsgYXR0YWNraW5nRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJldHJlYXREZWNsYXJhdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RpbmdGYWN0aW9uSWQ6IGF0dGFja2luZ0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbmRpbmdGYWN0aW9uSWQ6IHRoaXMuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVnaW9uLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJldHJlYXRGcm9tQmF0dGxlKHN0YXRlLCBiYXR0bGVSZXN1bHRzLCBhdHRhY2tSZXN1bHRzKSB7XG4gICAgICAgIHRocm93IG5ldyBQbGF5ZXJJbnRlcmFjdGlvbk5lZWRlZEVycm9yKCdSZXRyZWF0IGZyb20gYmF0dGxlIHdpdGggJyArIGJhdHRsZVJlc3VsdHMuYXR0YWNraW5nRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJldHJlYXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGluZ0ZhY3Rpb25JZDogYmF0dGxlUmVzdWx0cy5hdHRhY2tpbmdGYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uZGluZ0ZhY3Rpb25JZDogdGhpcy5mYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogYmF0dGxlUmVzdWx0cy5yZWdpb24uaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHRha2VMb3NzZXMoc3RhdGUsIGJhdHRsZVJlc3VsdHMsIGF0dGFja1Jlc3VsdHMsIGNvdW50ZXJhdHRhY2spIHtcbiAgICAgICAgdGhyb3cgbmV3IFBsYXllckludGVyYWN0aW9uTmVlZGVkRXJyb3IoXG4gICAgICAgICAgICAnTG9zc2VzIG11c3QgYmUgdGFrZW4gZnJvbSBiYXR0bGUgd2l0aCAnICsgYmF0dGxlUmVzdWx0cy5hdHRhY2tpbmdGYWN0aW9uLmlkLFxuICAgICAgICAgICAgbmV3IExvc3Nlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nRmFjdGlvbklkOiBiYXR0bGVSZXN1bHRzLmF0dGFja2luZ0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25kaW5nRmFjdGlvbklkOiB0aGlzLmZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtYnVzaDogIWNvdW50ZXJhdHRhY2sgJiYgYmF0dGxlUmVzdWx0cy53aWxsQW1idXNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmVhdGVkOiAhY291bnRlcmF0dGFjayAmJiBiYXR0bGVSZXN1bHRzLndpbGxSZXRyZWF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcmF0dGFjazogY291bnRlcmF0dGFjayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBiYXR0bGVSZXN1bHRzLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvc3NlczogYXR0YWNrUmVzdWx0cy5sb3NzZXNcbiAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSHVtYW5QbGF5ZXI7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L3BsYXllci9odW1hblBsYXllci5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFFQTtBQUNBOzs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBSUE7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTs7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBSUE7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTs7O0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 81 */
/***/ (function(module, exports) {

eval("/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */\r\nmodule.exports = __webpack_amd_options__;\r\n\n/* WEBPACK VAR INJECTION */}.call(exports, {}))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vYW1kLW9wdGlvbnMuanM/NWY3MSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWxzIF9fd2VicGFja19hbWRfb3B0aW9uc19fICovXHJcbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX2FtZF9vcHRpb25zX187XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL2FtZC1vcHRpb25zLmpzXG4vLyBtb2R1bGUgaWQgPSA4MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7O0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _fallingSkyVassalGameState = __webpack_require__(188);\n\nvar _fallingSkyVassalGameState2 = _interopRequireDefault(_fallingSkyVassalGameState);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _humanPlayer = __webpack_require__(80);\n\nvar _humanPlayer2 = _interopRequireDefault(_humanPlayer);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeFort = __webpack_require__(47);\n\nvar _placeFort2 = _interopRequireDefault(_placeFort);\n\nvar _placeLeader = __webpack_require__(48);\n\nvar _placeLeader2 = _interopRequireDefault(_placeLeader);\n\nvar _placeAuxilia = __webpack_require__(32);\n\nvar _placeAuxilia2 = _interopRequireDefault(_placeAuxilia);\n\nvar _placeLegions = __webpack_require__(49);\n\nvar _placeLegions2 = _interopRequireDefault(_placeLegions);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _aeduiBattle = __webpack_require__(64);\n\nvar _aeduiBattle2 = _interopRequireDefault(_aeduiBattle);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nvar _fs = __webpack_require__(190);\n\nvar fs = _interopRequireWildcard(_fs);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = {\n  start: function start(gameStateFile) {\n    console.log('Loading gamestate from: ' + gameStateFile);\n\n    fs.readFile(gameStateFile, function (err, data) {\n      if (err) {\n        throw err;\n      }\n\n      var json = JSON.parse(data.toString());\n      var game = new _fallingSkyVassalGameState2.default(json);\n      game.logState();\n    });\n  }\n};\n\nconsole.log('JS Bot Engine Script Loaded');\n\n//const game = new Game({scenario: TheGreatRevolt});\n//game.start();\n//game.state().logState();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2hlYWRsZXNzLmpzPzRhN2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFsbGluZ1NreVZhc3NhbEdhbWVTdGF0ZSBmcm9tICdmYWxsaW5nc2t5L3Zhc3NhbC9mYWxsaW5nU2t5VmFzc2FsR2FtZVN0YXRlJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnZmFsbGluZ3NreS9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBUcmliZUlEcyBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy90cmliZUlkcyc7XG5pbXBvcnQgSHVtYW5QbGF5ZXIgZnJvbSAnZmFsbGluZ3NreS9wbGF5ZXIvaHVtYW5QbGF5ZXInO1xuaW1wb3J0IFBsYWNlV2FyYmFuZHMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlV2FyYmFuZHMnO1xuaW1wb3J0IFBsYWNlQWxsaWVkVHJpYmUgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFBsYWNlRm9ydCBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VGb3J0JztcbmltcG9ydCBQbGFjZUxlYWRlciBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VMZWFkZXInO1xuaW1wb3J0IFBsYWNlQXV4aWxpYSBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VBdXhpbGlhJztcbmltcG9ydCBQbGFjZUxlZ2lvbnMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlTGVnaW9ucyc7XG5pbXBvcnQgUmV2ZWFsUGllY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZXZlYWxQaWVjZXMnO1xuaW1wb3J0IEFlZHVpQmF0dGxlIGZyb20gJ2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aUJhdHRsZSc7XG5pbXBvcnQgVHVybkNvbnRleHQgZnJvbSAnY29tbW9uL3R1cm5Db250ZXh0JztcblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgc3RhcnQ6IGZ1bmN0aW9uKGdhbWVTdGF0ZUZpbGUpIHtcbiAgICBjb25zb2xlLmxvZygnTG9hZGluZyBnYW1lc3RhdGUgZnJvbTogJyArIGdhbWVTdGF0ZUZpbGUpO1xuXG4gICAgZnMucmVhZEZpbGUoZ2FtZVN0YXRlRmlsZSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICB0aHJvdyBlcnI7IFxuICAgICAgfVxuXG4gICAgICB2YXIganNvbiA9IEpTT04ucGFyc2UoZGF0YS50b1N0cmluZygpKTtcbiAgICAgIGNvbnN0IGdhbWUgPSBuZXcgRmFsbGluZ1NreVZhc3NhbEdhbWVTdGF0ZShqc29uKTtcbiAgICAgIGdhbWUubG9nU3RhdGUoKTtcbiAgICB9KTtcbiAgfVxufTtcblxuY29uc29sZS5sb2coJ0pTIEJvdCBFbmdpbmUgU2NyaXB0IExvYWRlZCcpO1xuXG4vL2NvbnN0IGdhbWUgPSBuZXcgR2FtZSh7c2NlbmFyaW86IFRoZUdyZWF0UmV2b2x0fSk7XG4vL2dhbWUuc3RhcnQoKTtcbi8vZ2FtZS5zdGF0ZSgpLmxvZ1N0YXRlKCk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9oZWFkbGVzcy5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFDQTtBQUNBO0FBREE7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBYkE7QUFDQTtBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ActionGroup = function ActionGroup(definition) {\n    _classCallCheck(this, ActionGroup);\n\n    this.type = definition.type;\n    this.factionId = definition.factionId;\n    this.id = definition.id;\n    this.actionStartIndex = definition.actionStartIndex;\n    this.actionEndIndex = definition.actionEndIndex;\n    this.interactions = definition.interactions || [];\n};\n\nexports.default = ActionGroup;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9hY3Rpb25Hcm91cC5qcz9jNjRiIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEFjdGlvbkdyb3VwIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IGRlZmluaXRpb24udHlwZTtcbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBkZWZpbml0aW9uLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5pZCA9IGRlZmluaXRpb24uaWQ7XG4gICAgICAgIHRoaXMuYWN0aW9uU3RhcnRJbmRleCA9IGRlZmluaXRpb24uYWN0aW9uU3RhcnRJbmRleDtcbiAgICAgICAgdGhpcy5hY3Rpb25FbmRJbmRleCA9IGRlZmluaXRpb24uYWN0aW9uRW5kSW5kZXg7XG4gICAgICAgIHRoaXMuaW50ZXJhY3Rpb25zID0gZGVmaW5pdGlvbi5pbnRlcmFjdGlvbnMgfHwgW107XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBY3Rpb25Hcm91cDtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL2FjdGlvbkdyb3VwLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 84 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoint = function Checkpoint(definition) {\n    _classCallCheck(this, Checkpoint);\n\n    this.id = definition.id;\n};\n\nexports.default = Checkpoint;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9jaGVja3BvaW50LmpzP2FkZWIiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2hlY2twb2ludCB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLmlkID0gZGVmaW5pdGlvbi5pZDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENoZWNrcG9pbnQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb21tb24vY2hlY2twb2ludC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 85 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Faction = function Faction(definition) {\n    _classCallCheck(this, Faction);\n\n    this.id = definition.id;\n    this.name = definition.name;\n    this.passResources = 0;\n};\n\nexports.default = Faction;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9mYWN0aW9uLmpzPzcwM2EiXSwic291cmNlc0NvbnRlbnQiOlsiXG5jbGFzcyBGYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMuaWQgPSBkZWZpbml0aW9uLmlkO1xuICAgICAgICB0aGlzLm5hbWUgPSBkZWZpbml0aW9uLm5hbWU7XG4gICAgICAgIHRoaXMucGFzc1Jlc291cmNlcyA9IDA7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGYWN0aW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL2ZhY3Rpb24uanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 86 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Location = function Location(definition) {\n    _classCallCheck(this, Location);\n\n    this.id = definition.id;\n    this.name = definition.name;\n};\n\nexports.default = Location;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9sb2NhdGlvbi5qcz84MDc5Il0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgTG9jYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5pZCA9IGRlZmluaXRpb24uaWQ7XG4gICAgICAgIHRoaXMubmFtZSA9IGRlZmluaXRpb24ubmFtZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExvY2F0aW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL2xvY2F0aW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 87 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Player = function Player() {\n    var definition = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Player);\n\n    this.isNonPlayer = definition.isNonPlayer;\n    this.factionId = definition.factionId;\n};\n\nexports.default = Player;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9wbGF5ZXIuanM/NTY5YyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24gPSB7fSkge1xuICAgICAgICB0aGlzLmlzTm9uUGxheWVyID0gZGVmaW5pdGlvbi5pc05vblBsYXllcjtcbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBkZWZpbml0aW9uLmZhY3Rpb25JZDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvbW1vbi9wbGF5ZXIuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 88 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Region = function Region(definition) {\n    _classCallCheck(this, Region);\n\n    this.id = definition.id;\n    this.name = definition.name;\n    this.adjacent = definition.adjacent;\n};\n\nexports.default = Region;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9yZWdpb24uanM/ZTQzNCJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBSZWdpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5pZCA9IGRlZmluaXRpb24uaWQ7XG4gICAgICAgIHRoaXMubmFtZSA9IGRlZmluaXRpb24ubmFtZTtcbiAgICAgICAgdGhpcy5hZGphY2VudCA9IGRlZmluaXRpb24uYWRqYWNlbnQ7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZWdpb247XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb21tb24vcmVnaW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 89 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SequenceForCard = function () {\n    function SequenceForCard() {\n        var definition = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        _classCallCheck(this, SequenceForCard);\n\n        this.actions = _knockout2.default.observableArray(definition.actions || []);\n        this.eligible = definition.eligible || [];\n        this.ineligible = definition.ineligible || [];\n    }\n\n    _createClass(SequenceForCard, [{\n        key: 'addAction',\n        value: function addAction(factionId, actionId) {\n            this.actions.push({ factionId: factionId, actionId: actionId });\n        }\n    }, {\n        key: 'numActionsTaken',\n        value: function numActionsTaken() {\n            return this.actions().length;\n        }\n    }, {\n        key: 'popAction',\n        value: function popAction() {\n            return this.actions.pop();\n        }\n    }]);\n\n    return SequenceForCard;\n}();\n\nexports.default = SequenceForCard;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi9zZXF1ZW5jZUZvckNhcmQuanM/YjhlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQga28gZnJvbSAnLi4vbGliL2tub2Nrb3V0JztcblxuY2xhc3MgU2VxdWVuY2VGb3JDYXJkIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uID0ge30pIHtcbiAgICAgICAgdGhpcy5hY3Rpb25zID0ga28ub2JzZXJ2YWJsZUFycmF5KGRlZmluaXRpb24uYWN0aW9ucyB8fCBbXSk7XG4gICAgICAgIHRoaXMuZWxpZ2libGUgPSBkZWZpbml0aW9uLmVsaWdpYmxlIHx8IFtdO1xuICAgICAgICB0aGlzLmluZWxpZ2libGUgPSBkZWZpbml0aW9uLmluZWxpZ2libGUgfHwgW107XG4gICAgfVxuXG4gICAgYWRkQWN0aW9uKGZhY3Rpb25JZCwgYWN0aW9uSWQpIHtcbiAgICAgICAgdGhpcy5hY3Rpb25zLnB1c2goIHsgZmFjdGlvbklkLCBhY3Rpb25JZCB9KTtcbiAgICB9XG5cbiAgICBudW1BY3Rpb25zVGFrZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnMoKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgcG9wQWN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zLnBvcCgpO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBTZXF1ZW5jZUZvckNhcmQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb21tb24vc2VxdWVuY2VGb3JDYXJkLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 90 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _actionGroup = __webpack_require__(83);\n\nvar _actionGroup2 = _interopRequireDefault(_actionGroup);\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _checkpoint = __webpack_require__(84);\n\nvar _checkpoint2 = _interopRequireDefault(_checkpoint);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Turn = function (_ActionGroup) {\n    _inherits(Turn, _ActionGroup);\n\n    function Turn(state, definition) {\n        _classCallCheck(this, Turn);\n\n        definition.type = 'turn';\n\n        var _this = _possibleConstructorReturn(this, (Turn.__proto__ || Object.getPrototypeOf(Turn)).call(this, definition));\n\n        _this.state = state;\n        _this.number = definition.number;\n        _this.commandAction = definition.commandAction;\n        _this.actionGroups = [];\n        _this.inProgress = [];\n        _this.checkpoints = definition.checkpoints || [];\n        _this.contexts = definition.contexts || [];\n        _this.currentContext = null;\n        return _this;\n    }\n\n    _createClass(Turn, [{\n        key: 'undo',\n        value: function undo() {\n            this.state.actionHistory.undoRange(this.actionStartIndex, this.actionEndIndex);\n        }\n    }, {\n        key: 'resume',\n        value: function resume() {\n            this.currentContext = _lodash2.default.first(this.contexts);\n        }\n    }, {\n        key: 'getContext',\n        value: function getContext() {\n            return this.currentContext;\n        }\n    }, {\n        key: 'pushContext',\n        value: function pushContext(context) {\n            var existingContext = _lodash2.default.find(this.contexts, { id: context.id });\n            if (!existingContext) {\n                if (!context.currentFactionId) {\n                    context.currentFactionId = this.getContext().currentFactionId;\n                }\n                this.contexts.push(context);\n            }\n            this.currentContext = existingContext || context;\n        }\n    }, {\n        key: 'popContext',\n        value: function popContext() {\n            this.contexts.pop();\n            this.currentContext = _lodash2.default.last(this.contexts);\n        }\n    }, {\n        key: 'commitActionGroup',\n        value: function commitActionGroup(type) {\n            var last = _lodash2.default.last(this.inProgress);\n            if (!last || last.type !== type) {\n                throw Error('Tried to commit ' + type + ' that was not in progress');\n            }\n            console.log('Committing ' + type + ' ' + last.id);\n            var actionGroup = this.inProgress.pop();\n            actionGroup.actionEndIndex = this.state.actionHistory.currentIndex();\n            this.actionGroups.push(actionGroup);\n        }\n    }, {\n        key: 'rollbackPrior',\n        value: function rollbackPrior(type) {\n            var prior = this.actionGroups.pop();\n            if (!prior || prior.type !== type) {\n                throw Error('Tried to rollback prior ' + type + ', but none found');\n            }\n            console.log('Rolling back ' + prior.type + ' ' + prior.id);\n            this.state.actionHistory.undoRange(prior.actionStartIndex);\n        }\n    }, {\n        key: 'rollbackActionGroup',\n        value: function rollbackActionGroup(type) {\n            var last = _lodash2.default.last(this.inProgress);\n            if (!last || type && last.type !== type) {\n                throw Error('Tried to rollback ' + type + ' that was not in progress');\n            }\n            console.log('Rolling back ' + last.type + ' ' + last.id);\n            var actionGroup = this.inProgress.pop();\n            this.state.actionHistory.undoRange(actionGroup.actionStartIndex);\n        }\n    }, {\n        key: 'startActionGroup',\n        value: function startActionGroup(id, type) {\n            var current = _lodash2.default.last(this.inProgress);\n            if (current && current.id === id && current.type === type) {\n                return;\n            }\n            console.log('Starting ' + type + ' ' + id);\n            var actionGroup = new _actionGroup2.default({\n                type: type,\n                id: id,\n                factionId: this.getContext().currentFactionId,\n                actionStartIndex: this.state.actionHistory.currentIndex()\n            });\n            this.inProgress.push(actionGroup);\n        }\n    }, {\n        key: 'startPhase',\n        value: function startPhase(id) {\n            this.startActionGroup(id, 'phase');\n        }\n    }, {\n        key: 'commitPhase',\n        value: function commitPhase() {\n            this.commitActionGroup('phase');\n        }\n    }, {\n        key: 'rollbackPhase',\n        value: function rollbackPhase() {\n            this.rollbackActionGroup('phase');\n        }\n    }, {\n        key: 'startCommand',\n        value: function startCommand(id) {\n            this.startActionGroup(id, 'command');\n        }\n    }, {\n        key: 'commitCommand',\n        value: function commitCommand() {\n            this.commitActionGroup('command');\n        }\n    }, {\n        key: 'rollbackCommand',\n        value: function rollbackCommand() {\n            this.rollbackActionGroup('command');\n        }\n    }, {\n        key: 'startSpecialAbility',\n        value: function startSpecialAbility(id) {\n            this.startActionGroup(id, 'sa');\n        }\n    }, {\n        key: 'commitSpecialAbility',\n        value: function commitSpecialAbility() {\n            this.commitActionGroup('sa');\n        }\n    }, {\n        key: 'rollbackSpecialAbility',\n        value: function rollbackSpecialAbility() {\n            this.rollbackActionGroup('sa');\n        }\n    }, {\n        key: 'rollbackPriorSpecialAbility',\n        value: function rollbackPriorSpecialAbility() {\n            this.rollbackPrior('sa');\n        }\n    }, {\n        key: 'startEvent',\n        value: function startEvent(id) {\n            this.startActionGroup(id, 'event');\n        }\n    }, {\n        key: 'commitEvent',\n        value: function commitEvent() {\n            this.commitActionGroup('event');\n        }\n    }, {\n        key: 'rollbackEvent',\n        value: function rollbackEvent() {\n            this.rollbackActionGroup('event');\n        }\n    }, {\n        key: 'getFixedDecimalPlaces',\n        value: function getFixedDecimalPlaces(number, places) {\n            var re = new RegExp(\"(\\\\d+\\\\.\\\\d{\" + places + \"})(\\\\d)\"),\n                m = number.toString().match(re);\n            return m ? parseFloat(m[1]) : number.valueOf();\n        }\n    }, {\n        key: 'calculateCheckpointValue',\n        value: function calculateCheckpointValue(checkpoint) {\n            var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n            var actualLevel = this.inProgress.length + level;\n            var currentCheckpointBase = level > 0 ? this.getFixedDecimalPlaces(this.checkpoint, actualLevel - 1) : 0;\n            return currentCheckpointBase + checkpoint / 10 ** actualLevel;\n        }\n    }, {\n        key: 'markCheckpoint',\n        value: function markCheckpoint(id) {\n            var checkpoint = new _checkpoint2.default({ id: this.currentContext.id + '-' + id });\n            this.checkpoints.push(checkpoint);\n        }\n    }, {\n        key: 'getCheckpoint',\n        value: function getCheckpoint(id) {\n            var contextId = this.currentContext.id + '-' + id;\n            return _lodash2.default.find(this.checkpoints, function (checkpoint) {\n                return checkpoint.id === contextId;\n            });\n        }\n    }, {\n        key: 'clearCheckpoints',\n        value: function clearCheckpoints() {\n            this.checkpoints = [];\n        }\n    }, {\n        key: 'addInteraction',\n        value: function addInteraction(interaction) {\n            var actionGroup = _lodash2.default.last(this.inProgress);\n            if (actionGroup) {\n                actionGroup.interactions.push(interaction);\n            }\n        }\n    }, {\n        key: 'getCurrentInteractions',\n        value: function getCurrentInteractions() {\n            var actionGroup = _lodash2.default.last(this.inProgress);\n            return actionGroup ? actionGroup.interactions : [];\n        }\n    }, {\n        key: 'getInstructions',\n        value: function getInstructions(state) {\n            var _this2 = this;\n\n            if (this.actionEndIndex <= this.actionStartIndex) {\n                return [];\n            }\n\n            var actionInstructions = (0, _lodash2.default)(state.actionHistory.getActionRange(this.actionStartIndex, this.actionEndIndex)).invokeMap('instructions', state).map(function (instructions, index) {\n                return _lodash2.default.map(instructions, function (instruction) {\n                    return {\n                        index: _this2.actionStartIndex + index,\n                        type: 'action',\n                        instruction: instruction\n                    };\n                });\n            }).flatten().value();\n\n            var actionGroupsByType = _lodash2.default.groupBy(this.actionGroups, 'type');\n\n            _lodash2.default.each(actionGroupsByType.sa, function (sa) {\n                var insertIndex = _lodash2.default.findIndex(actionInstructions, function (actionInstruction) {\n                    return actionInstruction.index >= sa.actionStartIndex;\n                });\n                actionInstructions.splice(insertIndex, 0, {\n                    index: sa.actionStartIndex,\n                    type: 'sa',\n                    instruction: state.factionsById[sa.factionId].name + ' chose to ' + sa.id\n                });\n            });\n\n            _lodash2.default.each(actionGroupsByType.command, function (command) {\n                var insertIndex = _lodash2.default.findIndex(actionInstructions, function (actionInstruction) {\n                    return actionInstruction.index >= command.actionStartIndex;\n                });\n                actionInstructions.splice(insertIndex, 0, {\n                    index: command.actionStartIndex,\n                    type: 'command',\n                    instruction: state.factionsById[command.factionId].name + ' chose to ' + command.id\n                });\n            });\n\n            if (actionGroupsByType.event) {\n                var event = actionGroupsByType.event[0];\n                var insertIndex = _lodash2.default.findIndex(actionInstructions, function (actionInstruction) {\n                    return actionInstruction.index >= event.actionStartIndex;\n                });\n                actionInstructions.splice(insertIndex, 0, {\n                    index: event.actionStartIndex,\n                    type: 'event',\n                    instruction: state.factionsById[event.factionId].name + ' chose to play Event'\n                });\n            }\n\n            _lodash2.default.each(actionGroupsByType.phase, function (phase) {\n                if (phase.actionStartIndex === phase.actionEndIndex) {\n                    return;\n                }\n\n                var insertIndex = _lodash2.default.findIndex(actionInstructions, function (actionInstruction) {\n                    return actionInstruction.index >= phase.actionStartIndex;\n                });\n                actionInstructions.splice(insertIndex, 0, {\n                    index: phase.actionStartIndex,\n                    type: 'phase',\n                    instruction: phase.id + ' Phase'\n                });\n            });\n\n            return actionInstructions;\n        }\n    }]);\n\n    return Turn;\n}(_actionGroup2.default);\n\nexports.default = Turn;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2NvbW1vbi90dXJuLmpzPzU3YjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbkdyb3VwIGZyb20gJy4vYWN0aW9uR3JvdXAnO1xuaW1wb3J0IF8gZnJvbSAnLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ2hlY2twb2ludCBmcm9tICcuL2NoZWNrcG9pbnQnO1xuXG5jbGFzcyBUdXJuIGV4dGVuZHMgQWN0aW9uR3JvdXAge1xuXG4gICAgY29uc3RydWN0b3Ioc3RhdGUsIGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ3R1cm4nO1xuICAgICAgICBzdXBlcihkZWZpbml0aW9uKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgICAgICB0aGlzLm51bWJlciA9IGRlZmluaXRpb24ubnVtYmVyO1xuICAgICAgICB0aGlzLmNvbW1hbmRBY3Rpb24gPSBkZWZpbml0aW9uLmNvbW1hbmRBY3Rpb247XG4gICAgICAgIHRoaXMuYWN0aW9uR3JvdXBzID0gW107XG4gICAgICAgIHRoaXMuaW5Qcm9ncmVzcyA9IFtdO1xuICAgICAgICB0aGlzLmNoZWNrcG9pbnRzID0gZGVmaW5pdGlvbi5jaGVja3BvaW50cyB8fCBbXTtcbiAgICAgICAgdGhpcy5jb250ZXh0cyA9IGRlZmluaXRpb24uY29udGV4dHMgfHwgW107XG4gICAgICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBudWxsO1xuICAgIH1cblxuICAgIHVuZG8oKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aW9uSGlzdG9yeS51bmRvUmFuZ2UodGhpcy5hY3Rpb25TdGFydEluZGV4LCB0aGlzLmFjdGlvbkVuZEluZGV4KTtcbiAgICB9XG5cbiAgICByZXN1bWUoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBfLmZpcnN0KHRoaXMuY29udGV4dHMpO1xuICAgIH1cblxuICAgIGdldENvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb250ZXh0O1xuICAgIH1cblxuICAgIHB1c2hDb250ZXh0KGNvbnRleHQpIHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250ZXh0ID0gXy5maW5kKHRoaXMuY29udGV4dHMsIHtpZCA6IGNvbnRleHQuaWQgfSk7XG4gICAgICAgIGlmKCFleGlzdGluZ0NvbnRleHQpIHtcbiAgICAgICAgICAgIGlmKCFjb250ZXh0LmN1cnJlbnRGYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LmN1cnJlbnRGYWN0aW9uSWQgPSB0aGlzLmdldENvbnRleHQoKS5jdXJyZW50RmFjdGlvbklkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBleGlzdGluZ0NvbnRleHQgfHwgY29udGV4dDtcbiAgICB9XG5cbiAgICBwb3BDb250ZXh0KCkge1xuICAgICAgICB0aGlzLmNvbnRleHRzLnBvcCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRDb250ZXh0ID0gXy5sYXN0KHRoaXMuY29udGV4dHMpO1xuICAgIH1cblxuICAgIGNvbW1pdEFjdGlvbkdyb3VwKHR5cGUpIHtcbiAgICAgICAgY29uc3QgbGFzdCA9IF8ubGFzdCh0aGlzLmluUHJvZ3Jlc3MpO1xuICAgICAgICBpZiAoIWxhc3QgfHwgbGFzdC50eXBlICE9PSB0eXBlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignVHJpZWQgdG8gY29tbWl0ICcgKyB0eXBlICsgJyB0aGF0IHdhcyBub3QgaW4gcHJvZ3Jlc3MnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnQ29tbWl0dGluZyAnICsgdHlwZSArICcgJyArIGxhc3QuaWQpO1xuICAgICAgICBjb25zdCBhY3Rpb25Hcm91cCA9IHRoaXMuaW5Qcm9ncmVzcy5wb3AoKTtcbiAgICAgICAgYWN0aW9uR3JvdXAuYWN0aW9uRW5kSW5kZXggPSB0aGlzLnN0YXRlLmFjdGlvbkhpc3RvcnkuY3VycmVudEluZGV4KCk7XG4gICAgICAgIHRoaXMuYWN0aW9uR3JvdXBzLnB1c2goYWN0aW9uR3JvdXApO1xuICAgIH1cblxuICAgIHJvbGxiYWNrUHJpb3IodHlwZSkge1xuICAgICAgICBjb25zdCBwcmlvciA9IHRoaXMuYWN0aW9uR3JvdXBzLnBvcCgpO1xuICAgICAgICBpZiAoIXByaW9yIHx8IHByaW9yLnR5cGUgIT09IHR5cGUpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdUcmllZCB0byByb2xsYmFjayBwcmlvciAnICsgdHlwZSArICcsIGJ1dCBub25lIGZvdW5kJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ1JvbGxpbmcgYmFjayAnICsgcHJpb3IudHlwZSArICcgJyArIHByaW9yLmlkKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3Rpb25IaXN0b3J5LnVuZG9SYW5nZShwcmlvci5hY3Rpb25TdGFydEluZGV4KTtcbiAgICB9XG5cbiAgICByb2xsYmFja0FjdGlvbkdyb3VwKHR5cGUpIHtcbiAgICAgICAgY29uc3QgbGFzdCA9IF8ubGFzdCh0aGlzLmluUHJvZ3Jlc3MpO1xuICAgICAgICBpZiAoIWxhc3QgfHwgKHR5cGUgJiYgbGFzdC50eXBlICE9PSB0eXBlKSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1RyaWVkIHRvIHJvbGxiYWNrICcgKyB0eXBlICsgJyB0aGF0IHdhcyBub3QgaW4gcHJvZ3Jlc3MnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnUm9sbGluZyBiYWNrICcgKyBsYXN0LnR5cGUgKyAnICcgKyBsYXN0LmlkKTtcbiAgICAgICAgY29uc3QgYWN0aW9uR3JvdXAgPSB0aGlzLmluUHJvZ3Jlc3MucG9wKCk7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aW9uSGlzdG9yeS51bmRvUmFuZ2UoYWN0aW9uR3JvdXAuYWN0aW9uU3RhcnRJbmRleCk7XG4gICAgfVxuXG4gICAgc3RhcnRBY3Rpb25Hcm91cChpZCwgdHlwZSkge1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gXy5sYXN0KHRoaXMuaW5Qcm9ncmVzcyk7XG4gICAgICAgIGlmKGN1cnJlbnQgJiYgY3VycmVudC5pZCA9PT0gaWQgJiYgY3VycmVudC50eXBlID09PSB0eXBlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nICcgKyB0eXBlICsgJyAnICsgaWQpO1xuICAgICAgICBjb25zdCBhY3Rpb25Hcm91cCA9IG5ldyBBY3Rpb25Hcm91cCh7XG4gICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmdldENvbnRleHQoKS5jdXJyZW50RmFjdGlvbklkLFxuICAgICAgICAgICAgYWN0aW9uU3RhcnRJbmRleDogdGhpcy5zdGF0ZS5hY3Rpb25IaXN0b3J5LmN1cnJlbnRJbmRleCgpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmluUHJvZ3Jlc3MucHVzaChhY3Rpb25Hcm91cCk7XG4gICAgfVxuXG4gICAgc3RhcnRQaGFzZShpZCkge1xuICAgICAgICB0aGlzLnN0YXJ0QWN0aW9uR3JvdXAoaWQsICdwaGFzZScpO1xuICAgIH1cblxuICAgIGNvbW1pdFBoYXNlKCkge1xuICAgICAgICB0aGlzLmNvbW1pdEFjdGlvbkdyb3VwKCdwaGFzZScpO1xuICAgIH1cblxuICAgIHJvbGxiYWNrUGhhc2UoKSB7XG4gICAgICAgIHRoaXMucm9sbGJhY2tBY3Rpb25Hcm91cCgncGhhc2UnKTtcbiAgICB9XG5cbiAgICBzdGFydENvbW1hbmQoaWQpIHtcbiAgICAgICAgdGhpcy5zdGFydEFjdGlvbkdyb3VwKGlkLCAnY29tbWFuZCcpO1xuICAgIH1cblxuICAgIGNvbW1pdENvbW1hbmQoKSB7XG4gICAgICAgIHRoaXMuY29tbWl0QWN0aW9uR3JvdXAoJ2NvbW1hbmQnKTtcbiAgICB9XG5cbiAgICByb2xsYmFja0NvbW1hbmQoKSB7XG4gICAgICAgIHRoaXMucm9sbGJhY2tBY3Rpb25Hcm91cCgnY29tbWFuZCcpO1xuICAgIH1cblxuICAgIHN0YXJ0U3BlY2lhbEFiaWxpdHkoaWQpIHtcbiAgICAgICAgdGhpcy5zdGFydEFjdGlvbkdyb3VwKGlkLCAnc2EnKTtcbiAgICB9XG5cbiAgICBjb21taXRTcGVjaWFsQWJpbGl0eSgpIHtcbiAgICAgICAgdGhpcy5jb21taXRBY3Rpb25Hcm91cCgnc2EnKTtcbiAgICB9XG5cbiAgICByb2xsYmFja1NwZWNpYWxBYmlsaXR5KCkge1xuICAgICAgICB0aGlzLnJvbGxiYWNrQWN0aW9uR3JvdXAoJ3NhJyk7XG4gICAgfVxuXG4gICAgcm9sbGJhY2tQcmlvclNwZWNpYWxBYmlsaXR5KCkge1xuICAgICAgICB0aGlzLnJvbGxiYWNrUHJpb3IoJ3NhJyk7XG4gICAgfVxuXG4gICAgc3RhcnRFdmVudChpZCkge1xuICAgICAgICB0aGlzLnN0YXJ0QWN0aW9uR3JvdXAoaWQsICdldmVudCcpO1xuICAgIH1cblxuICAgIGNvbW1pdEV2ZW50KCkge1xuICAgICAgICB0aGlzLmNvbW1pdEFjdGlvbkdyb3VwKCdldmVudCcpO1xuICAgIH1cblxuICAgIHJvbGxiYWNrRXZlbnQoKSB7XG4gICAgICAgIHRoaXMucm9sbGJhY2tBY3Rpb25Hcm91cCgnZXZlbnQnKTtcbiAgICB9XG5cbiAgICBnZXRGaXhlZERlY2ltYWxQbGFjZXMobnVtYmVyLCBwbGFjZXMpIHtcbiAgICAgICAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKFwiKFxcXFxkK1xcXFwuXFxcXGR7XCIgKyBwbGFjZXMgKyBcIn0pKFxcXFxkKVwiKSxcbiAgICAgICAgICAgIG0gPSBudW1iZXIudG9TdHJpbmcoKS5tYXRjaChyZSk7XG4gICAgICAgIHJldHVybiBtID8gcGFyc2VGbG9hdChtWzFdKSA6IG51bWJlci52YWx1ZU9mKCk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlQ2hlY2twb2ludFZhbHVlKGNoZWNrcG9pbnQsIGxldmVsID0gMCkge1xuICAgICAgICBjb25zdCBhY3R1YWxMZXZlbCA9IHRoaXMuaW5Qcm9ncmVzcy5sZW5ndGggKyBsZXZlbDtcbiAgICAgICAgY29uc3QgY3VycmVudENoZWNrcG9pbnRCYXNlID0gbGV2ZWwgPiAwID8gdGhpcy5nZXRGaXhlZERlY2ltYWxQbGFjZXModGhpcy5jaGVja3BvaW50LCBhY3R1YWxMZXZlbC0xKTogMDtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRDaGVja3BvaW50QmFzZSArIChjaGVja3BvaW50IC8gKDEwICoqIGFjdHVhbExldmVsKSk7XG4gICAgfVxuXG4gICAgbWFya0NoZWNrcG9pbnQoaWQpIHtcbiAgICAgICAgY29uc3QgY2hlY2twb2ludCA9IG5ldyBDaGVja3BvaW50KHsgaWQ6IHRoaXMuY3VycmVudENvbnRleHQuaWQgKyAnLScgK2lkIH0pO1xuICAgICAgICB0aGlzLmNoZWNrcG9pbnRzLnB1c2goY2hlY2twb2ludCk7XG4gICAgfVxuXG4gICAgZ2V0Q2hlY2twb2ludChpZCkge1xuICAgICAgICBjb25zdCBjb250ZXh0SWQgPSB0aGlzLmN1cnJlbnRDb250ZXh0LmlkICsgJy0nICtpZDtcbiAgICAgICAgcmV0dXJuIF8uZmluZCh0aGlzLmNoZWNrcG9pbnRzLCBjaGVja3BvaW50ID0+IGNoZWNrcG9pbnQuaWQgPT09IGNvbnRleHRJZCk7XG4gICAgfVxuXG4gICAgY2xlYXJDaGVja3BvaW50cygpIHtcbiAgICAgICAgdGhpcy5jaGVja3BvaW50cyA9IFtdO1xuICAgIH1cblxuICAgIGFkZEludGVyYWN0aW9uKGludGVyYWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbkdyb3VwID0gXy5sYXN0KHRoaXMuaW5Qcm9ncmVzcyk7XG4gICAgICAgIGlmKGFjdGlvbkdyb3VwKSB7XG4gICAgICAgICAgICBhY3Rpb25Hcm91cC5pbnRlcmFjdGlvbnMucHVzaChpbnRlcmFjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDdXJyZW50SW50ZXJhY3Rpb25zKCkge1xuICAgICAgICBjb25zdCBhY3Rpb25Hcm91cCA9IF8ubGFzdCh0aGlzLmluUHJvZ3Jlc3MpO1xuICAgICAgICByZXR1cm4gYWN0aW9uR3JvdXAgPyBhY3Rpb25Hcm91cC5pbnRlcmFjdGlvbnMgOiBbXTtcbiAgICB9XG5cbiAgICBnZXRJbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uRW5kSW5kZXggPD0gdGhpcy5hY3Rpb25TdGFydEluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhY3Rpb25JbnN0cnVjdGlvbnMgPSBfKFxuICAgICAgICAgICAgc3RhdGUuYWN0aW9uSGlzdG9yeS5nZXRBY3Rpb25SYW5nZSh0aGlzLmFjdGlvblN0YXJ0SW5kZXgsIHRoaXMuYWN0aW9uRW5kSW5kZXgpKVxuICAgICAgICAgICAgLmludm9rZU1hcCgnaW5zdHJ1Y3Rpb25zJywgc3RhdGUpLm1hcChcbiAgICAgICAgICAgICAgICAoaW5zdHJ1Y3Rpb25zLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAoaW5zdHJ1Y3Rpb25zLCAoaW5zdHJ1Y3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuYWN0aW9uU3RhcnRJbmRleCArIGluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhY3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pLmZsYXR0ZW4oKS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IGFjdGlvbkdyb3Vwc0J5VHlwZSA9IF8uZ3JvdXBCeSh0aGlzLmFjdGlvbkdyb3VwcywgJ3R5cGUnKTtcblxuICAgICAgICBfLmVhY2goYWN0aW9uR3JvdXBzQnlUeXBlLnNhLCAoc2EpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydEluZGV4ID0gXy5maW5kSW5kZXgoYWN0aW9uSW5zdHJ1Y3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnN0cnVjdGlvbiA9PiBhY3Rpb25JbnN0cnVjdGlvbi5pbmRleCA+PSBzYS5hY3Rpb25TdGFydEluZGV4KTtcbiAgICAgICAgICAgIGFjdGlvbkluc3RydWN0aW9ucy5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBzYS5hY3Rpb25TdGFydEluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NhJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiBzdGF0ZS5mYWN0aW9uc0J5SWRbc2EuZmFjdGlvbklkXS5uYW1lICsgJyBjaG9zZSB0byAnICsgc2EuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF8uZWFjaChhY3Rpb25Hcm91cHNCeVR5cGUuY29tbWFuZCwgKGNvbW1hbmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydEluZGV4ID0gXy5maW5kSW5kZXgoYWN0aW9uSW5zdHJ1Y3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnN0cnVjdGlvbiA9PiBhY3Rpb25JbnN0cnVjdGlvbi5pbmRleCA+PSBjb21tYW5kLmFjdGlvblN0YXJ0SW5kZXgpO1xuICAgICAgICAgICAgYWN0aW9uSW5zdHJ1Y3Rpb25zLnNwbGljZShpbnNlcnRJbmRleCwgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGNvbW1hbmQuYWN0aW9uU3RhcnRJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjb21tYW5kJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiBzdGF0ZS5mYWN0aW9uc0J5SWRbY29tbWFuZC5mYWN0aW9uSWRdLm5hbWUgKyAnIGNob3NlIHRvICcgKyBjb21tYW5kLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoYWN0aW9uR3JvdXBzQnlUeXBlLmV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IGFjdGlvbkdyb3Vwc0J5VHlwZS5ldmVudFswXTtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydEluZGV4ID0gXy5maW5kSW5kZXgoYWN0aW9uSW5zdHJ1Y3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnN0cnVjdGlvbiA9PiBhY3Rpb25JbnN0cnVjdGlvbi5pbmRleCA+PSBldmVudC5hY3Rpb25TdGFydEluZGV4KTtcbiAgICAgICAgICAgIGFjdGlvbkluc3RydWN0aW9ucy5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBldmVudC5hY3Rpb25TdGFydEluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2V2ZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiBzdGF0ZS5mYWN0aW9uc0J5SWRbZXZlbnQuZmFjdGlvbklkXS5uYW1lICsgJyBjaG9zZSB0byBwbGF5IEV2ZW50J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uZWFjaChhY3Rpb25Hcm91cHNCeVR5cGUucGhhc2UsIChwaGFzZSkgPT4ge1xuICAgICAgICAgICAgaWYocGhhc2UuYWN0aW9uU3RhcnRJbmRleCA9PT0gcGhhc2UuYWN0aW9uRW5kSW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGluc2VydEluZGV4ID0gXy5maW5kSW5kZXgoYWN0aW9uSW5zdHJ1Y3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbnN0cnVjdGlvbiA9PiBhY3Rpb25JbnN0cnVjdGlvbi5pbmRleCA+PSBwaGFzZS5hY3Rpb25TdGFydEluZGV4KTtcbiAgICAgICAgICAgIGFjdGlvbkluc3RydWN0aW9ucy5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBwaGFzZS5hY3Rpb25TdGFydEluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BoYXNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiBwaGFzZS5pZCArICcgUGhhc2UnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gYWN0aW9uSW5zdHJ1Y3Rpb25zO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBUdXJuO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29tbW9uL3R1cm4uanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUZBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFXQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _senateApprovalStates = __webpack_require__(37);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ChangeSenateApproval = function (_Action) {\n    _inherits(ChangeSenateApproval, _Action);\n\n    function ChangeSenateApproval(args) {\n        _classCallCheck(this, ChangeSenateApproval);\n\n        var _this = _possibleConstructorReturn(this, (ChangeSenateApproval.__proto__ || Object.getPrototypeOf(ChangeSenateApproval)).call(this, args));\n\n        _this.approvalState = args.approvalState;\n        _this.isFirm = args.isFirm;\n        _this.oldApprovalState = args.oldApprovalState;\n        _this.wasFirm = args.wasFirm;\n        return _this;\n    }\n\n    _createClass(ChangeSenateApproval, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            this.oldApprovalState = state.romans.senateApprovalState();\n            this.wasFirm = state.romans.senateFirm();\n\n            state.romans.senateApprovalState(this.approvalState);\n            state.romans.senateFirm(this.isFirm);\n\n            console.log('Changing Senate Approval to ' + this.approvalState + (this.isFirm ? ' Firm' : ''));\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            state.romans.senateApprovalState(this.oldApprovalState);\n            state.romans.senateFirm(this.wasFirm);\n\n            console.log('Changing Senate Approval back to ' + this.approvalState + (this.isFirm ? ' Firm' : ''));\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var instructions = [];\n            if (this.approvalState !== this.oldApprovalState) {\n                instructions.push('Move Senate approval marker to ' + _senateApprovalStates.SenateApprovalStateNames[this.approvalState]);\n            }\n\n            if (this.isFirm && !this.wasFirm) {\n                instructions.push('Flip Senate approval marker to firm');\n            } else if (!this.isFirm && this.wasFirm) {\n                instructions.push('Flip Senate approval marker to normal from firm');\n            }\n            return instructions;\n        }\n    }]);\n\n    return ChangeSenateApproval;\n}(_action2.default);\n\nexports.default = ChangeSenateApproval;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9jaGFuZ2VTZW5hdGVBcHByb3ZhbC5qcz9iYTA3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5pbXBvcnQge1NlbmF0ZUFwcHJvdmFsU3RhdGVOYW1lc30gZnJvbSAnZmFsbGluZ3NreS9jb25maWcvc2VuYXRlQXBwcm92YWxTdGF0ZXMnO1xuXG5jbGFzcyBDaGFuZ2VTZW5hdGVBcHByb3ZhbCBleHRlbmRzIEFjdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgICAgIHRoaXMuYXBwcm92YWxTdGF0ZSA9IGFyZ3MuYXBwcm92YWxTdGF0ZTtcbiAgICAgICAgdGhpcy5pc0Zpcm0gPSBhcmdzLmlzRmlybTtcbiAgICAgICAgdGhpcy5vbGRBcHByb3ZhbFN0YXRlID0gYXJncy5vbGRBcHByb3ZhbFN0YXRlO1xuICAgICAgICB0aGlzLndhc0Zpcm0gPSBhcmdzLndhc0Zpcm07XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIHRoaXMub2xkQXBwcm92YWxTdGF0ZSA9IHN0YXRlLnJvbWFucy5zZW5hdGVBcHByb3ZhbFN0YXRlKCk7XG4gICAgICAgIHRoaXMud2FzRmlybSA9IHN0YXRlLnJvbWFucy5zZW5hdGVGaXJtKCk7XG5cbiAgICAgICAgc3RhdGUucm9tYW5zLnNlbmF0ZUFwcHJvdmFsU3RhdGUodGhpcy5hcHByb3ZhbFN0YXRlKTtcbiAgICAgICAgc3RhdGUucm9tYW5zLnNlbmF0ZUZpcm0odGhpcy5pc0Zpcm0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdDaGFuZ2luZyBTZW5hdGUgQXBwcm92YWwgdG8gJyArIHRoaXMuYXBwcm92YWxTdGF0ZSArICh0aGlzLmlzRmlybSA/ICcgRmlybScgOiAnJykpO1xuXG4gICAgfVxuXG4gICAgZG9VbmRvKHN0YXRlKSB7XG4gICAgICAgIHN0YXRlLnJvbWFucy5zZW5hdGVBcHByb3ZhbFN0YXRlKHRoaXMub2xkQXBwcm92YWxTdGF0ZSk7XG4gICAgICAgIHN0YXRlLnJvbWFucy5zZW5hdGVGaXJtKHRoaXMud2FzRmlybSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0NoYW5naW5nIFNlbmF0ZSBBcHByb3ZhbCBiYWNrIHRvICcgKyB0aGlzLmFwcHJvdmFsU3RhdGUgKyAodGhpcy5pc0Zpcm0gPyAnIEZpcm0nIDogJycpKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbnMoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gW107XG4gICAgICAgIGlmICh0aGlzLmFwcHJvdmFsU3RhdGUgIT09IHRoaXMub2xkQXBwcm92YWxTdGF0ZSkge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2goJ01vdmUgU2VuYXRlIGFwcHJvdmFsIG1hcmtlciB0byAnICsgU2VuYXRlQXBwcm92YWxTdGF0ZU5hbWVzW3RoaXMuYXBwcm92YWxTdGF0ZV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNGaXJtICYmICF0aGlzLndhc0Zpcm0pIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKCdGbGlwIFNlbmF0ZSBhcHByb3ZhbCBtYXJrZXIgdG8gZmlybScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYoIXRoaXMuaXNGaXJtICYmIHRoaXMud2FzRmlybSkge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2goJ0ZsaXAgU2VuYXRlIGFwcHJvdmFsIG1hcmtlciB0byBub3JtYWwgZnJvbSBmaXJtJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9ucztcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENoYW5nZVNlbmF0ZUFwcHJvdmFsO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL2NoYW5nZVNlbmF0ZUFwcHJvdmFsLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7OztBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQU9BO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 92 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DevastateRegion = function (_Action) {\n    _inherits(DevastateRegion, _Action);\n\n    function DevastateRegion(args) {\n        _classCallCheck(this, DevastateRegion);\n\n        var _this = _possibleConstructorReturn(this, (DevastateRegion.__proto__ || Object.getPrototypeOf(DevastateRegion)).call(this, args));\n\n        _this.regionId = args.regionId;\n        return _this;\n    }\n\n    _createClass(DevastateRegion, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var region = state.regionsById[this.regionId];\n\n            if (region.devastated()) {\n                throw 'Invalid Devastate Action';\n            }\n\n            region.devastated(true);\n\n            console.log('Devastating ' + region.name + '');\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var region = state.regionsById[this.regionId];\n\n            console.log('Removing devastation from ' + region.name);\n            region.devastated(false);\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var region = state.regionsById[this.regionId];\n            return ['Place devastated marker on ' + region.name];\n        }\n    }]);\n\n    return DevastateRegion;\n}(_action2.default);\n\nexports.default = DevastateRegion;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9kZXZhc3RhdGVSZWdpb24uanM/M2E4ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcblxuY2xhc3MgRGV2YXN0YXRlUmVnaW9uIGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5yZWdpb25JZCA9IGFyZ3MucmVnaW9uSWQ7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuXG4gICAgICAgIGlmKHJlZ2lvbi5kZXZhc3RhdGVkKCkpIHtcbiAgICAgICAgICAgIHRocm93ICdJbnZhbGlkIERldmFzdGF0ZSBBY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVnaW9uLmRldmFzdGF0ZWQodHJ1ZSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0RldmFzdGF0aW5nICcgKyByZWdpb24ubmFtZSArICcnKTtcbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1JlbW92aW5nIGRldmFzdGF0aW9uIGZyb20gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgcmVnaW9uLmRldmFzdGF0ZWQoZmFsc2UpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgcmV0dXJuIFsnUGxhY2UgZGV2YXN0YXRlZCBtYXJrZXIgb24gJyArIHJlZ2lvbi5uYW1lXTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRGV2YXN0YXRlUmVnaW9uXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9kZXZhc3RhdGVSZWdpb24uanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUVBO0FBSEE7QUFJQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 93 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nvar _senateApprovalStates = __webpack_require__(37);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ReturnFallenLegions = function (_Action) {\n    _inherits(ReturnFallenLegions, _Action);\n\n    function ReturnFallenLegions(args) {\n        _classCallCheck(this, ReturnFallenLegions);\n\n        var _this = _possibleConstructorReturn(this, (ReturnFallenLegions.__proto__ || Object.getPrototypeOf(ReturnFallenLegions)).call(this, args));\n\n        _this.count = args.count;\n        return _this;\n    }\n\n    _createClass(ReturnFallenLegions, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var count = this.count;\n            var legions = state.romans.getLegionsFromFallen(count);\n            state.romans.returnLegionsToTracks(legions);\n            console.log('Returning ' + count + 'x ' + state.romans.name + ' Legions from Fallen to Tracks');\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var faction = state.romans;\n            var count = this.count;\n\n            var legions = faction.removeLegions(count);\n            faction.returnLegions(legions);\n            console.log('Returning ' + count + 'x ' + state.romans.name + ' Legions from Tracks to Fallen');\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.romans;\n            var count = this.count;\n            return ['Return  ' + count + 'x ' + faction.name + ' Legions from Fallen to Tracks'];\n        }\n    }]);\n\n    return ReturnFallenLegions;\n}(_action2.default);\n\nexports.default = ReturnFallenLegions;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9yZXR1cm5GYWxsZW5MZWdpb25zLmpzP2I1MTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbGliL2xvZGFzaCc7XG5pbXBvcnQgQWN0aW9uIGZyb20gJy4vYWN0aW9uJztcbmltcG9ydCB7U2VuYXRlQXBwcm92YWxTdGF0ZU5hbWVzfSBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9zZW5hdGVBcHByb3ZhbFN0YXRlcyc7XG5cbmNsYXNzIFJldHVybkZhbGxlbkxlZ2lvbnMgZXh0ZW5kcyBBY3Rpb24ge1xuXG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcbiAgICAgICAgdGhpcy5jb3VudCA9IGFyZ3MuY291bnQ7XG4gICAgfVxuXG4gICAgZG9FeGVjdXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcbiAgICAgICAgY29uc3QgbGVnaW9ucyA9IHN0YXRlLnJvbWFucy5nZXRMZWdpb25zRnJvbUZhbGxlbihjb3VudCk7XG4gICAgICAgIHN0YXRlLnJvbWFucy5yZXR1cm5MZWdpb25zVG9UcmFja3MobGVnaW9ucyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZXR1cm5pbmcgJyArIGNvdW50ICsgJ3ggJyArIHN0YXRlLnJvbWFucy5uYW1lICsgJyBMZWdpb25zIGZyb20gRmFsbGVuIHRvIFRyYWNrcycpO1xuICAgIH1cblxuICAgIGRvVW5kbyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUucm9tYW5zO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQ7XG5cbiAgICAgICAgY29uc3QgbGVnaW9ucyA9IGZhY3Rpb24ucmVtb3ZlTGVnaW9ucyhjb3VudCk7XG4gICAgICAgIGZhY3Rpb24ucmV0dXJuTGVnaW9ucyhsZWdpb25zKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1JldHVybmluZyAnICsgY291bnQgKyAneCAnICsgc3RhdGUucm9tYW5zLm5hbWUgKyAnIExlZ2lvbnMgZnJvbSBUcmFja3MgdG8gRmFsbGVuJyk7XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5yb21hbnM7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDtcbiAgICAgICAgcmV0dXJuIFsnUmV0dXJuICAnICsgY291bnQgKyAneCAnICsgZmFjdGlvbi5uYW1lICsgJyBMZWdpb25zIGZyb20gRmFsbGVuIHRvIFRyYWNrcyddO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmV0dXJuRmFsbGVuTGVnaW9ucztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9yZXR1cm5GYWxsZW5MZWdpb25zLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7OztBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQ0E7QUFGQTtBQUdBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 94 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _action = __webpack_require__(7);\n\nvar _action2 = _interopRequireDefault(_action);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ScoutPieces = function (_Action) {\n    _inherits(ScoutPieces, _Action);\n\n    function ScoutPieces(args) {\n        _classCallCheck(this, ScoutPieces);\n\n        var _this = _possibleConstructorReturn(this, (ScoutPieces.__proto__ || Object.getPrototypeOf(ScoutPieces)).call(this, args));\n\n        _this.factionId = args.factionId;\n        _this.regionId = args.regionId;\n        _this.pieces = args.pieces;\n        _this.numScoutedFromHidden = args.numScoutedFromHidden || 0;\n        _this.numScoutedFromRevealed = args.numScoutedFromRevealed || 0;\n        return _this;\n    }\n\n    _createClass(ScoutPieces, [{\n        key: 'doExecute',\n        value: function doExecute(state) {\n            var _this2 = this;\n\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var pieces = this.pieces;\n\n            _lodash2.default.each(pieces, function (piece) {\n                if (!piece.revealed()) {\n                    piece.revealed(true);\n                    _this2.numScoutedFromHidden += 1;\n                } else {\n                    _this2.numScoutedFromRevealed += 1;\n                }\n                piece.scouted(true);\n            });\n\n            if (pieces.length > 0) {\n                console.log('Scouting ' + this.numScoutedFromHidden + 'x hidden and ' + this.numScoutedFromRevealed + 'x revealed ' + faction.name + ' warbands in ' + region.name);\n            }\n        }\n    }, {\n        key: 'doUndo',\n        value: function doUndo(state) {\n            var _this3 = this;\n\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n\n            var totalNumScouted = this.numScoutedFromHidden + this.numScoutedFromRevealed;\n            var scoutedPieces = _lodash2.default.take(region.getScoutedPiecesForFaction(faction.id), totalNumScouted);\n            _lodash2.default.each(scoutedPieces, function (piece) {\n                piece.scouted(false);\n                console.log('Removed scouted from  ' + totalNumScouted + 'x ' + faction.name + ' warbands in ' + region.name);\n            });\n\n            var piecesToHide = _lodash2.default.take(scoutedPieces, this.numScoutedFromHidden);\n            _lodash2.default.each(scoutedPieces, function (piece) {\n                piece.revealed(false);\n                console.log('Hiding (as part of scout undo)  ' + _this3.numScoutedFromHidden + 'x ' + faction.name + ' warbands in ' + region.name);\n            });\n        }\n    }, {\n        key: 'instructions',\n        value: function instructions(state) {\n            var faction = state.factionsById[this.factionId];\n            var region = state.regionsById[this.regionId];\n            var instructions = [];\n            if (this.numScoutedFromHidden > 0) {\n                instructions.push('Flip to revealed and place scouted marker on ' + this.numScoutedFromHidden + 'x ' + faction.name + ' warbands in ' + region.name);\n            }\n            if (this.numScoutedFromRevealed > 0) {\n                instructions.push('Place scouted marker on ' + this.numScoutedFromRevealed + 'x already revealed ' + faction.name + ' warbands in ' + region.name);\n            }\n            return instructions;\n        }\n    }]);\n\n    return ScoutPieces;\n}(_action2.default);\n\nexports.default = ScoutPieces;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYWN0aW9ucy9zY291dFBpZWNlcy5qcz9jNzhkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEFjdGlvbiBmcm9tICcuL2FjdGlvbic7XG5cbmNsYXNzIFNjb3V0UGllY2VzIGV4dGVuZHMgQWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9uSWQgPSBhcmdzLmZhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5yZWdpb25JZCA9IGFyZ3MucmVnaW9uSWQ7XG4gICAgICAgIHRoaXMucGllY2VzID0gYXJncy5waWVjZXM7XG4gICAgICAgIHRoaXMubnVtU2NvdXRlZEZyb21IaWRkZW4gPSBhcmdzLm51bVNjb3V0ZWRGcm9tSGlkZGVuIHx8IDA7XG4gICAgICAgIHRoaXMubnVtU2NvdXRlZEZyb21SZXZlYWxlZCA9IGFyZ3MubnVtU2NvdXRlZEZyb21SZXZlYWxlZCB8fCAwO1xuICAgIH1cblxuICAgIGRvRXhlY3V0ZShzdGF0ZSkge1xuICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW3RoaXMuZmFjdGlvbklkXTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbdGhpcy5yZWdpb25JZF07XG4gICAgICAgIGNvbnN0IHBpZWNlcyA9IHRoaXMucGllY2VzO1xuXG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHBpZWNlcywgKHBpZWNlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFwaWVjZS5yZXZlYWxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLnJldmVhbGVkKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm51bVNjb3V0ZWRGcm9tSGlkZGVuICs9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm51bVNjb3V0ZWRGcm9tUmV2ZWFsZWQgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGllY2Uuc2NvdXRlZCh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgICdTY291dGluZyAnICsgdGhpcy5udW1TY291dGVkRnJvbUhpZGRlbiArICd4IGhpZGRlbiBhbmQgJyArIHRoaXMubnVtU2NvdXRlZEZyb21SZXZlYWxlZCArICd4IHJldmVhbGVkICcgKyBmYWN0aW9uLm5hbWUgKyAnIHdhcmJhbmRzIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkb1VuZG8oc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFt0aGlzLmZhY3Rpb25JZF07XG4gICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3RoaXMucmVnaW9uSWRdO1xuXG4gICAgICAgIGNvbnN0IHRvdGFsTnVtU2NvdXRlZCA9IHRoaXMubnVtU2NvdXRlZEZyb21IaWRkZW4gKyB0aGlzLm51bVNjb3V0ZWRGcm9tUmV2ZWFsZWQ7XG4gICAgICAgIGNvbnN0IHNjb3V0ZWRQaWVjZXMgPSBfLnRha2UocmVnaW9uLmdldFNjb3V0ZWRQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb24uaWQpLHRvdGFsTnVtU2NvdXRlZCk7XG4gICAgICAgIF8uZWFjaChzY291dGVkUGllY2VzLCAocGllY2UpID0+IHtcbiAgICAgICAgICAgIHBpZWNlLnNjb3V0ZWQoZmFsc2UpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbW92ZWQgc2NvdXRlZCBmcm9tICAnICsgdG90YWxOdW1TY291dGVkICsgJ3ggJyArIGZhY3Rpb24ubmFtZSArICcgd2FyYmFuZHMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcGllY2VzVG9IaWRlID0gXy50YWtlKHNjb3V0ZWRQaWVjZXMsIHRoaXMubnVtU2NvdXRlZEZyb21IaWRkZW4pO1xuICAgICAgICBfLmVhY2goc2NvdXRlZFBpZWNlcywgKHBpZWNlKSA9PiB7XG4gICAgICAgICAgICBwaWVjZS5yZXZlYWxlZChmYWxzZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSGlkaW5nIChhcyBwYXJ0IG9mIHNjb3V0IHVuZG8pICAnICsgdGhpcy5udW1TY291dGVkRnJvbUhpZGRlbiArICd4ICcgKyBmYWN0aW9uLm5hbWUgKyAnIHdhcmJhbmRzIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbdGhpcy5mYWN0aW9uSWRdO1xuICAgICAgICBjb25zdCByZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFt0aGlzLnJlZ2lvbklkXTtcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gW107XG4gICAgICAgIGlmICh0aGlzLm51bVNjb3V0ZWRGcm9tSGlkZGVuID4gMCkge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgJ0ZsaXAgdG8gcmV2ZWFsZWQgYW5kIHBsYWNlIHNjb3V0ZWQgbWFya2VyIG9uICcgKyB0aGlzLm51bVNjb3V0ZWRGcm9tSGlkZGVuICsgJ3ggJyArIGZhY3Rpb24ubmFtZSArICcgd2FyYmFuZHMgaW4gJyArIHJlZ2lvbi5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5udW1TY291dGVkRnJvbVJldmVhbGVkID4gMCkge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgJ1BsYWNlIHNjb3V0ZWQgbWFya2VyIG9uICcgKyB0aGlzLm51bVNjb3V0ZWRGcm9tUmV2ZWFsZWQgKyAneCBhbHJlYWR5IHJldmVhbGVkICcgKyBmYWN0aW9uLm5hbWUgKyAnIHdhcmJhbmRzIGluICcgKyByZWdpb24ubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9ucztcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNjb3V0UGllY2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9hY3Rpb25zL3Njb3V0UGllY2VzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFRQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 95 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _region = __webpack_require__(88);\n\nvar _region2 = _interopRequireDefault(_region);\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar FallingSkyRegion = function (_Region) {\n    _inherits(FallingSkyRegion, _Region);\n\n    function FallingSkyRegion(definition, tribesById) {\n        _classCallCheck(this, FallingSkyRegion);\n\n        // Immutable\n        var _this = _possibleConstructorReturn(this, (FallingSkyRegion.__proto__ || Object.getPrototypeOf(FallingSkyRegion)).call(this, definition));\n\n        _this.group = definition.group;\n        _this.tribes = _lodash2.default.map(definition.tribes, function (tribeId) {\n            return tribesById[tribeId];\n        });\n        _this.controlValue = definition.controlValue;\n        _this.adjacent = definition.adjacent;\n        _this.supplyLines = [];\n\n        // Mutable\n        _this.inPlay = _knockout2.default.observable(_lodash2.default.isUndefined(definition.inPlay) ? true : definition.inPlay);\n        _this.pieces = _knockout2.default.observableArray();\n        _this.devastated = _knockout2.default.observable();\n\n        // Computed\n        _this.piecesByFaction = _knockout2.default.pureComputed(function () {\n            return _lodash2.default.groupBy(_this.pieces(), 'factionId');\n        });\n\n        _this.controllingFactionId = _knockout2.default.pureComputed(function () {\n            var controllingFactionId = null;\n            var countByFaction = _lodash2.default.countBy(_this.pieces(), 'factionId');\n            _lodash2.default.each(countByFaction, function (count, factionId) {\n                if (count > _this.pieces().length - count) {\n                    controllingFactionId = factionId;\n                }\n            });\n            return controllingFactionId;\n        });\n\n        _this.controllingMarginByFaction = _knockout2.default.pureComputed(function () {\n            var countByFaction = _lodash2.default.countBy(_this.pieces(), 'factionId');\n            var marginByFaction = {};\n            _lodash2.default.each(_factionIds2.default, function (factionId) {\n                var count = countByFaction[factionId] || 0;\n                marginByFaction[factionId] = count - (_this.pieces().length - count);\n            });\n            return marginByFaction;\n        });\n\n        _this.hasFort = _knockout2.default.pureComputed(function () {\n            return _lodash2.default.find(_this.pieces(), { type: 'fort' });\n        });\n        return _this;\n    }\n\n    _createClass(FallingSkyRegion, [{\n        key: 'isControlledByFaction',\n        value: function isControlledByFaction(factionId) {\n            return this.controllingFactionId() === factionId;\n        }\n    }, {\n        key: 'getMaxEnemyControllingMargin',\n        value: function getMaxEnemyControllingMargin(requestingFactionId) {\n            var margin = (0, _lodash2.default)(this.controllingMarginByFaction()).reject(function (margin, factionId) {\n                return factionId === requestingFactionId;\n            }).values().max();\n            return _lodash2.default.isUndefined(margin) ? -99 : margin;\n        }\n    }, {\n        key: 'addColony',\n        value: function addColony(colony) {\n            colony.regionId = this.id;\n            this.tribes.push(colony);\n            this.controlValue += 1;\n        }\n    }, {\n        key: 'addPiece',\n        value: function addPiece(piece) {\n            this.addPieces([piece]);\n        }\n    }, {\n        key: 'addPieces',\n        value: function addPieces(pieces) {\n            this.pieces.push.apply(this.pieces, pieces);\n        }\n    }, {\n        key: 'removeAlliedTribe',\n        value: function removeAlliedTribe(factionId, tribeId) {\n            var allyToRemove = _lodash2.default.find(this.piecesByFaction()[factionId], { tribeId: tribeId });\n            if (allyToRemove) {\n                this.pieces.remove(allyToRemove);\n            }\n            return allyToRemove;\n        }\n    }, {\n        key: 'removePieces',\n        value: function removePieces(pieces) {\n            if (!pieces || pieces.length === 0) {\n                throw 'Trying to remove nothing from region';\n            }\n            this.pieces.removeAll(pieces);\n        }\n    }, {\n        key: 'hasValidSupplyLine',\n        value: function hasValidSupplyLine(requestingFactionId, agreeingFactionIds) {\n            var _this2 = this;\n\n            var invalidRegions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n            var validRegions = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n\n            if (_lodash2.default.indexOf(invalidRegions, this.id) >= 0 || !this.isValidForSupplyLine(requestingFactionId, agreeingFactionIds) && _lodash2.default.indexOf(validRegions, this.id) < 0) {\n                return false;\n            }\n\n            if (_lodash2.default.indexOf(_lodash2.default.map(this.adjacent, 'id'), _regionIds2.default.CISALPINA) >= 0) {\n                return true;\n            }\n\n            return _lodash2.default.find(this.supplyLines, function (supplyLine) {\n                return _lodash2.default.every(supplyLine, function (region) {\n                    return _lodash2.default.indexOf(invalidRegions, _this2.id) < 0 && (region.isValidForSupplyLine(requestingFactionId, agreeingFactionIds) || _lodash2.default.indexOf(validRegions, _this2.id) >= 0);\n                });\n            });\n        }\n    }, {\n        key: 'isValidForSupplyLine',\n        value: function isValidForSupplyLine(requestingFactionId, agreeingFactionIds) {\n            var controllingFactionId = this.controllingFactionId();\n            return !controllingFactionId || controllingFactionId === requestingFactionId || _lodash2.default.indexOf(agreeingFactionIds, controllingFactionId) >= 0;\n        }\n    }, {\n        key: 'getAgreementsNeededForSupplyLine',\n        value: function getAgreementsNeededForSupplyLine(requestingFactionId) {\n            if (this.hasValidSupplyLine(requestingFactionId, [])) {\n                return [];\n            }\n\n            var agreementsNeeded = {};\n\n            var agreementForTargetRegion = null;\n            if (!this.isValidForSupplyLine(requestingFactionId, [])) {\n                agreementForTargetRegion = this.controllingFactionId();\n            }\n            _lodash2.default.each(this.supplyLines, function (supplyLine) {\n                var agreementsForSupplyLine = agreementForTargetRegion ? [agreementForTargetRegion] : [];\n                _lodash2.default.each(supplyLine, function (region) {\n                    if (!region.isValidForSupplyLine(requestingFactionId, agreementsForSupplyLine)) {\n                        agreementsForSupplyLine.push(region.controllingFactionId());\n                    }\n                });\n                var key = _lodash2.default.join(agreementsForSupplyLine.sort(), '|');\n                if (!agreementsNeeded[key]) {\n                    agreementsNeeded[key] = agreementsForSupplyLine;\n                }\n            });\n\n            return (0, _lodash2.default)(agreementsNeeded).values().sortBy('length').value();\n        }\n    }, {\n        key: 'subduedTribesForFaction',\n        value: function subduedTribesForFaction(factionId) {\n            return (0, _lodash2.default)(this.tribes).filter(function (tribe) {\n                return tribe.isSubdued() && (!tribe.factionRestriction || tribe.factionRestriction === factionId);\n            }).value();\n        }\n    }, {\n        key: 'getSubduedTribes',\n        value: function getSubduedTribes() {\n            return (0, _lodash2.default)(this.tribes).filter(function (tribe) {\n                return tribe.isSubdued();\n            }).value();\n        }\n    }, {\n        key: 'getAlliedCityForFaction',\n        value: function getAlliedCityForFaction(factionId) {\n            return (0, _lodash2.default)(this.tribes).find(function (tribe) {\n                return tribe.isAllied() && tribe.isCity && tribe.alliedFactionId() === factionId;\n            });\n        }\n    }, {\n        key: 'getAlliesAndCitadels',\n        value: function getAlliesAndCitadels() {\n            return (0, _lodash2.default)(this.pieces()).filter(function (piece) {\n                return piece.type === 'alliedtribe' || piece.type === 'citadel';\n            }).value();\n        }\n    }, {\n        key: 'numAlliesAndCitadelsForFaction',\n        value: function numAlliesAndCitadelsForFaction(factionId) {\n            return (0, _lodash2.default)(this.piecesByFaction()[factionId]).filter(function (piece) {\n                return piece.type === 'alliedtribe' || piece.type === 'citadel';\n            }).value().length;\n        }\n    }, {\n        key: 'getPiecesForFaction',\n        value: function getPiecesForFaction(factionId) {\n            return this.piecesByFaction()[factionId] || [];\n        }\n    }, {\n        key: 'getHiddenPiecesForFaction',\n        value: function getHiddenPiecesForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return (piece.type === 'warband' || piece.type === 'auxilia') && !piece.revealed();\n            });\n        }\n    }, {\n        key: 'getRevealedPiecesForFaction',\n        value: function getRevealedPiecesForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return (piece.type === 'warband' || piece.type === 'auxilia') && piece.revealed() && !piece.scouted();\n            });\n        }\n    }, {\n        key: 'getScoutedPiecesForFaction',\n        value: function getScoutedPiecesForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return piece.type === 'warband' && piece.scouted();\n            });\n        }\n    }, {\n        key: 'getMobilePiecesForFaction',\n        value: function getMobilePiecesForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], { isMobile: true });\n        }\n    }, {\n        key: 'getWarbandsOrAuxiliaForFaction',\n        value: function getWarbandsOrAuxiliaForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return piece.type === 'warband' || piece.type === 'auxilia';\n            });\n        }\n    }, {\n        key: 'getLegions',\n        value: function getLegions() {\n            return _lodash2.default.filter(this.piecesByFaction()[_factionIds2.default.ROMANS], function (piece) {\n                return piece.type === 'legion';\n            });\n        }\n    }, {\n        key: 'getFort',\n        value: function getFort() {\n            return _lodash2.default.find(this.piecesByFaction()[_factionIds2.default.ROMANS], function (piece) {\n                return piece.type === 'fort';\n            }) || null;\n        }\n    }, {\n        key: 'getAlliesForFaction',\n        value: function getAlliesForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], { type: 'alliedtribe' });\n        }\n    }, {\n        key: 'getCitadelForFaction',\n        value: function getCitadelForFaction(factionId) {\n            return _lodash2.default.find(this.piecesByFaction()[factionId], { type: 'citadel' }) || null;\n        }\n    }, {\n        key: 'getAlliesAndCitadelForFaction',\n        value: function getAlliesAndCitadelForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return piece.type === 'alliedtribe' || piece.type === 'citadel';\n            });\n        }\n    }, {\n        key: 'getHiddenWarbandsOrAuxiliaForFaction',\n        value: function getHiddenWarbandsOrAuxiliaForFaction(factionId) {\n            return _lodash2.default.filter(this.piecesByFaction()[factionId], function (piece) {\n                return (piece.type === 'warband' || piece.type === 'auxilia') && !piece.revealed();\n            });\n        }\n    }, {\n        key: 'getLeaderForFaction',\n        value: function getLeaderForFaction(factionId) {\n            return (0, _lodash2.default)(this.piecesByFaction()[factionId]).filter({ type: 'leader' }).first() || null;\n        }\n    }, {\n        key: 'logState',\n        value: function logState() {\n            console.log('*** ' + this.name + ' Region ***');\n            console.log('Controlling Faction: ' + (this.controllingFactionId() || 'No Control'));\n            console.log('Tribes: ');\n            _lodash2.default.each(this.tribes, function (tribe) {\n                console.log('    ' + tribe.toString());\n            });\n            _lodash2.default.each(this.piecesByFaction(), function (pieces, factionId) {\n                console.log(factionId + ' Faction Pieces:');\n                _logging2.default.logPieces(pieces);\n            });\n            console.log('');\n        }\n    }]);\n\n    return FallingSkyRegion;\n}(_region2.default);\n\nexports.default = FallingSkyRegion;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm9hcmQvZmFsbGluZ1NreVJlZ2lvbi5qcz8zZTc4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IGtvIGZyb20gJy4uLy4uL2xpYi9rbm9ja291dCc7XG5pbXBvcnQgUmVnaW9uIGZyb20gJy4uLy4uL2NvbW1vbi9yZWdpb24nO1xuaW1wb3J0IExvZ2dpbmcgZnJvbSAnLi4vdXRpbC9sb2dnaW5nJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnZmFsbGluZ3NreS9jb25maWcvcmVnaW9uSWRzJztcblxuY2xhc3MgRmFsbGluZ1NreVJlZ2lvbiBleHRlbmRzIFJlZ2lvbiB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbiwgdHJpYmVzQnlJZCkge1xuXG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuXG4gICAgICAgIC8vIEltbXV0YWJsZVxuICAgICAgICB0aGlzLmdyb3VwID0gZGVmaW5pdGlvbi5ncm91cDtcbiAgICAgICAgdGhpcy50cmliZXMgPSBfLm1hcChcbiAgICAgICAgICAgIGRlZmluaXRpb24udHJpYmVzLCBmdW5jdGlvbiAodHJpYmVJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cmliZXNCeUlkW3RyaWJlSWRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbFZhbHVlID0gZGVmaW5pdGlvbi5jb250cm9sVmFsdWU7XG4gICAgICAgIHRoaXMuYWRqYWNlbnQgPSBkZWZpbml0aW9uLmFkamFjZW50O1xuICAgICAgICB0aGlzLnN1cHBseUxpbmVzID0gW107XG5cbiAgICAgICAgLy8gTXV0YWJsZVxuICAgICAgICB0aGlzLmluUGxheSA9IGtvLm9ic2VydmFibGUoXy5pc1VuZGVmaW5lZChkZWZpbml0aW9uLmluUGxheSkgPyB0cnVlIDogZGVmaW5pdGlvbi5pblBsYXkpO1xuICAgICAgICB0aGlzLnBpZWNlcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmRldmFzdGF0ZWQgPSBrby5vYnNlcnZhYmxlKCk7XG5cbiAgICAgICAgLy8gQ29tcHV0ZWRcbiAgICAgICAgdGhpcy5waWVjZXNCeUZhY3Rpb24gPSBrby5wdXJlQ29tcHV0ZWQoXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8uZ3JvdXBCeSh0aGlzLnBpZWNlcygpLCAnZmFjdGlvbklkJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNvbnRyb2xsaW5nRmFjdGlvbklkID0ga28ucHVyZUNvbXB1dGVkKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBjb250cm9sbGluZ0ZhY3Rpb25JZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgY291bnRCeUZhY3Rpb24gPSBfLmNvdW50QnkodGhpcy5waWVjZXMoKSwgJ2ZhY3Rpb25JZCcpO1xuICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgY291bnRCeUZhY3Rpb24sIChjb3VudCwgZmFjdGlvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAodGhpcy5waWVjZXMoKS5sZW5ndGggLSBjb3VudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGluZ0ZhY3Rpb25JZCA9IGZhY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2xsaW5nRmFjdGlvbklkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbiA9IGtvLnB1cmVDb21wdXRlZChcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudEJ5RmFjdGlvbiA9IF8uY291bnRCeSh0aGlzLnBpZWNlcygpLCAnZmFjdGlvbklkJyk7XG4gICAgICAgICAgICAgICAgbGV0IG1hcmdpbkJ5RmFjdGlvbiA9IHt9O1xuICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgRmFjdGlvbklEcywgKGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBjb3VudEJ5RmFjdGlvbltmYWN0aW9uSWRdIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5CeUZhY3Rpb25bZmFjdGlvbklkXSA9IGNvdW50IC0gKHRoaXMucGllY2VzKCkubGVuZ3RoIC0gY291bnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFyZ2luQnlGYWN0aW9uO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5oYXNGb3J0ID0ga28ucHVyZUNvbXB1dGVkKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmQodGhpcy5waWVjZXMoKSwge3R5cGU6ICdmb3J0J30pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaXNDb250cm9sbGVkQnlGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9sbGluZ0ZhY3Rpb25JZCgpID09PSBmYWN0aW9uSWQ7XG4gICAgfVxuXG4gICAgZ2V0TWF4RW5lbXlDb250cm9sbGluZ01hcmdpbihyZXF1ZXN0aW5nRmFjdGlvbklkKSB7XG4gICAgICAgIGNvbnN0IG1hcmdpbiA9IF8odGhpcy5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpKS5yZWplY3QoIChtYXJnaW4sIGZhY3Rpb25JZCkgPT4gZmFjdGlvbklkID09PSByZXF1ZXN0aW5nRmFjdGlvbklkICkudmFsdWVzKCkubWF4KCk7XG4gICAgICAgIHJldHVybiBfLmlzVW5kZWZpbmVkKG1hcmdpbikgPyAtOTkgOiBtYXJnaW47XG4gICAgfVxuXG4gICAgYWRkQ29sb255KGNvbG9ueSkge1xuICAgICAgICBjb2xvbnkucmVnaW9uSWQgPSB0aGlzLmlkO1xuICAgICAgICB0aGlzLnRyaWJlcy5wdXNoKGNvbG9ueSk7XG4gICAgICAgIHRoaXMuY29udHJvbFZhbHVlICs9IDE7XG4gICAgfVxuXG4gICAgYWRkUGllY2UocGllY2UpIHtcbiAgICAgICAgdGhpcy5hZGRQaWVjZXMoW3BpZWNlXSk7XG4gICAgfVxuXG4gICAgYWRkUGllY2VzKHBpZWNlcykge1xuICAgICAgICB0aGlzLnBpZWNlcy5wdXNoLmFwcGx5KHRoaXMucGllY2VzLCBwaWVjZXMpO1xuICAgIH1cblxuICAgIHJlbW92ZUFsbGllZFRyaWJlKGZhY3Rpb25JZCwgdHJpYmVJZCkge1xuICAgICAgICBjb25zdCBhbGx5VG9SZW1vdmUgPSBfLmZpbmQodGhpcy5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uSWRdLCB7dHJpYmVJZDogdHJpYmVJZH0pO1xuICAgICAgICBpZiAoYWxseVRvUmVtb3ZlKSB7XG4gICAgICAgICAgICB0aGlzLnBpZWNlcy5yZW1vdmUoYWxseVRvUmVtb3ZlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWxseVRvUmVtb3ZlO1xuICAgIH1cblxuICAgIHJlbW92ZVBpZWNlcyhwaWVjZXMpIHtcbiAgICAgICAgaWYoIXBpZWNlcyB8fCBwaWVjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyAnVHJ5aW5nIHRvIHJlbW92ZSBub3RoaW5nIGZyb20gcmVnaW9uJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBpZWNlcy5yZW1vdmVBbGwocGllY2VzKTtcbiAgICB9XG5cbiAgICBoYXNWYWxpZFN1cHBseUxpbmUocmVxdWVzdGluZ0ZhY3Rpb25JZCwgYWdyZWVpbmdGYWN0aW9uSWRzLCBpbnZhbGlkUmVnaW9ucz1bXSwgdmFsaWRSZWdpb25zID0gW10pIHtcbiAgICAgICAgaWYgKF8uaW5kZXhPZihpbnZhbGlkUmVnaW9ucywgdGhpcy5pZCkgPj0gMCB8fCAoIXRoaXMuaXNWYWxpZEZvclN1cHBseUxpbmUocmVxdWVzdGluZ0ZhY3Rpb25JZCwgYWdyZWVpbmdGYWN0aW9uSWRzKSAmJiBfLmluZGV4T2YodmFsaWRSZWdpb25zLCB0aGlzLmlkKSA8IDApKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfLmluZGV4T2YoXy5tYXAodGhpcy5hZGphY2VudCwgJ2lkJyksIFJlZ2lvbklEcy5DSVNBTFBJTkEpID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF8uZmluZCh0aGlzLnN1cHBseUxpbmVzLCAoc3VwcGx5TGluZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmV2ZXJ5KFxuICAgICAgICAgICAgICAgICAgICBzdXBwbHlMaW5lLCAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5pbmRleE9mKGludmFsaWRSZWdpb25zLCB0aGlzLmlkKSA8IDAgJiYgKHJlZ2lvbi5pc1ZhbGlkRm9yU3VwcGx5TGluZShyZXF1ZXN0aW5nRmFjdGlvbklkLCBhZ3JlZWluZ0ZhY3Rpb25JZHMpIHx8IF8uaW5kZXhPZih2YWxpZFJlZ2lvbnMsIHRoaXMuaWQpID49IDApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlzVmFsaWRGb3JTdXBwbHlMaW5lKHJlcXVlc3RpbmdGYWN0aW9uSWQsIGFncmVlaW5nRmFjdGlvbklkcykge1xuICAgICAgICBjb25zdCBjb250cm9sbGluZ0ZhY3Rpb25JZCA9IHRoaXMuY29udHJvbGxpbmdGYWN0aW9uSWQoKTtcbiAgICAgICAgcmV0dXJuICFjb250cm9sbGluZ0ZhY3Rpb25JZCB8fFxuICAgICAgICAgICAgICAgY29udHJvbGxpbmdGYWN0aW9uSWQgPT09IHJlcXVlc3RpbmdGYWN0aW9uSWQgfHxcbiAgICAgICAgICAgICAgIF8uaW5kZXhPZihhZ3JlZWluZ0ZhY3Rpb25JZHMsIGNvbnRyb2xsaW5nRmFjdGlvbklkKSA+PSAwO1xuICAgIH1cblxuICAgIGdldEFncmVlbWVudHNOZWVkZWRGb3JTdXBwbHlMaW5lKHJlcXVlc3RpbmdGYWN0aW9uSWQpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzVmFsaWRTdXBwbHlMaW5lKHJlcXVlc3RpbmdGYWN0aW9uSWQsIFtdKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWdyZWVtZW50c05lZWRlZCA9IHt9O1xuXG4gICAgICAgIGxldCBhZ3JlZW1lbnRGb3JUYXJnZXRSZWdpb24gPSBudWxsO1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZEZvclN1cHBseUxpbmUocmVxdWVzdGluZ0ZhY3Rpb25JZCwgW10pKSB7XG4gICAgICAgICAgICBhZ3JlZW1lbnRGb3JUYXJnZXRSZWdpb24gPSB0aGlzLmNvbnRyb2xsaW5nRmFjdGlvbklkKCk7XG4gICAgICAgIH1cbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgdGhpcy5zdXBwbHlMaW5lcywgZnVuY3Rpb24gKHN1cHBseUxpbmUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZSA9IGFncmVlbWVudEZvclRhcmdldFJlZ2lvbiA/IFthZ3JlZW1lbnRGb3JUYXJnZXRSZWdpb25dIDogW107XG4gICAgICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgICAgICBzdXBwbHlMaW5lLCBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlZ2lvbi5pc1ZhbGlkRm9yU3VwcGx5TGluZShyZXF1ZXN0aW5nRmFjdGlvbklkLCBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZS5wdXNoKHJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gXy5qb2luKGFncmVlbWVudHNGb3JTdXBwbHlMaW5lLnNvcnQoKSwgJ3wnKTtcbiAgICAgICAgICAgICAgICBpZiAoIWFncmVlbWVudHNOZWVkZWRba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZ3JlZW1lbnRzTmVlZGVkW2tleV0gPSBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gXyhhZ3JlZW1lbnRzTmVlZGVkKS52YWx1ZXMoKS5zb3J0QnkoJ2xlbmd0aCcpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3ViZHVlZFRyaWJlc0ZvckZhY3Rpb24oZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBfKHRoaXMudHJpYmVzKS5maWx0ZXIoZnVuY3Rpb24odHJpYmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmliZS5pc1N1YmR1ZWQoKSAmJiAoIXRyaWJlLmZhY3Rpb25SZXN0cmljdGlvbiB8fCB0cmliZS5mYWN0aW9uUmVzdHJpY3Rpb24gPT09IGZhY3Rpb25JZCk7XG4gICAgICAgIH0pLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgZ2V0U3ViZHVlZFRyaWJlcygpIHtcbiAgICAgICAgcmV0dXJuIF8odGhpcy50cmliZXMpLmZpbHRlcih0cmliZSA9PiB0cmliZS5pc1N1YmR1ZWQoKSkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBnZXRBbGxpZWRDaXR5Rm9yRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF8odGhpcy50cmliZXMpLmZpbmQoZnVuY3Rpb24odHJpYmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmliZS5pc0FsbGllZCgpICYmIHRyaWJlLmlzQ2l0eSAmJiB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSA9PT0gZmFjdGlvbklkO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRBbGxpZXNBbmRDaXRhZGVscygpIHtcbiAgICAgICAgcmV0dXJuIF8odGhpcy5waWVjZXMoKSkuZmlsdGVyKHBpZWNlID0+IHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2NpdGFkZWwnKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIG51bUFsbGllc0FuZENpdGFkZWxzRm9yRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF8odGhpcy5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uSWRdKS5maWx0ZXIocGllY2UgPT4gcGllY2UudHlwZSA9PT0gJ2FsbGllZHRyaWJlJyB8fCBwaWVjZS50eXBlID09PSAnY2l0YWRlbCcpLnZhbHVlKCkubGVuZ3RoO1xuICAgIH1cblxuICAgIGdldFBpZWNlc0ZvckZhY3Rpb24oZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0gfHwgW107XG4gICAgfVxuXG4gICAgZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSwgcGllY2UgPT4gKHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyB8fCBwaWVjZS50eXBlID09PSAnYXV4aWxpYScpICYmICFwaWVjZS5yZXZlYWxlZCgpKTtcbiAgICB9XG5cbiAgICBnZXRSZXZlYWxlZFBpZWNlc0ZvckZhY3Rpb24oZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBfLmZpbHRlcih0aGlzLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0sIHBpZWNlID0+IChwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgfHwgcGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnKSAmJiBwaWVjZS5yZXZlYWxlZCgpICYmICFwaWVjZS5zY291dGVkKCkpO1xuICAgIH1cblxuICAgIGdldFNjb3V0ZWRQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uSWRdLCBwaWVjZSA9PiBwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgJiYgcGllY2Uuc2NvdXRlZCgpKTtcbiAgICB9XG5cbiAgICBnZXRNb2JpbGVQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uSWRdLCB7aXNNb2JpbGU6dHJ1ZX0pO1xuICAgIH1cblxuICAgIGdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSwgcGllY2UgPT4gKHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyB8fCBwaWVjZS50eXBlID09PSAnYXV4aWxpYScpKTtcbiAgICB9XG5cbiAgICBnZXRMZWdpb25zKCkge1xuICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLlJPTUFOU10sIHBpZWNlID0+IHBpZWNlLnR5cGUgPT09ICdsZWdpb24nICk7XG4gICAgfVxuXG4gICAgZ2V0Rm9ydCgpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZCh0aGlzLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuUk9NQU5TXSwgcGllY2UgPT4gcGllY2UudHlwZSA9PT0gJ2ZvcnQnICkgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBnZXRBbGxpZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5waWVjZXNCeUZhY3Rpb24oKVtmYWN0aW9uSWRdLCB7IHR5cGUgOiAnYWxsaWVkdHJpYmUnIH0pO1xuICAgIH1cblxuICAgIGdldENpdGFkZWxGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXy5maW5kKHRoaXMucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSwgeyB0eXBlIDogJ2NpdGFkZWwnIH0pIHx8IG51bGw7XG4gICAgfVxuXG4gICAgZ2V0QWxsaWVzQW5kQ2l0YWRlbEZvckZhY3Rpb24oZmFjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBfLmZpbHRlcih0aGlzLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0sIHBpZWNlPT4gcGllY2UudHlwZSA9PT0gJ2FsbGllZHRyaWJlJyB8fCBwaWVjZS50eXBlID09PSAnY2l0YWRlbCcpO1xuICAgIH1cblxuICAgIGdldEhpZGRlbldhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSwgcGllY2UgPT4gKHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyB8fCBwaWVjZS50eXBlID09PSAnYXV4aWxpYScpICYmICFwaWVjZS5yZXZlYWxlZCgpKTtcbiAgICB9XG5cbiAgICBnZXRMZWFkZXJGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXyh0aGlzLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0pLmZpbHRlcih7dHlwZSA6ICdsZWFkZXInfSkuZmlyc3QoKSB8fCBudWxsO1xuICAgIH1cblxuICAgIGxvZ1N0YXRlKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqICcgKyB0aGlzLm5hbWUgKyAnIFJlZ2lvbiAqKionKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0NvbnRyb2xsaW5nIEZhY3Rpb246ICcgKyAodGhpcy5jb250cm9sbGluZ0ZhY3Rpb25JZCgpIHx8ICdObyBDb250cm9sJykpO1xuICAgICAgICBjb25zb2xlLmxvZygnVHJpYmVzOiAnKTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgdGhpcy50cmliZXMsIGZ1bmN0aW9uICh0cmliZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgICAgJyArIHRyaWJlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHRoaXMucGllY2VzQnlGYWN0aW9uKCksIGZ1bmN0aW9uIChwaWVjZXMsIGZhY3Rpb25JZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZhY3Rpb25JZCArICcgRmFjdGlvbiBQaWVjZXM6Jyk7XG4gICAgICAgICAgICAgICAgTG9nZ2luZy5sb2dQaWVjZXMocGllY2VzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGYWxsaW5nU2t5UmVnaW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib2FyZC9mYWxsaW5nU2t5UmVnaW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUdBO0FBSkE7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQXJEQTtBQXNEQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQURBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUdBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 96 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _location = __webpack_require__(86);\n\nvar _location2 = _interopRequireDefault(_location);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TribeStates = {\n    ALLIED: 'allied',\n    CITADEL: 'citadel',\n    SUBDUED: 'subdued',\n    DISPERSED: 'dispersed',\n    DISPERSED_GATHERING: 'dispersedgathering',\n    RAZED: 'razed'\n};\n\nvar Tribe = function (_Location) {\n    _inherits(Tribe, _Location);\n\n    function Tribe(definition) {\n        _classCallCheck(this, Tribe);\n\n        // Immutable\n        var _this = _possibleConstructorReturn(this, (Tribe.__proto__ || Object.getPrototypeOf(Tribe)).call(this, definition));\n\n        _this.isCity = definition.isCity || false;\n        _this.factionRestriction = definition.factionRestriction || null;\n        _this.regionId = definition.regionId;\n\n        // Mutable\n        _this.state = _knockout2.default.observable(TribeStates.SUBDUED);\n        _this.alliedFactionId = _knockout2.default.observable();\n\n        // Computed\n        _this.isAllied = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.ALLIED;\n        });\n        _this.isCitadel = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.CITADEL;\n        });\n        _this.isSubdued = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.SUBDUED;\n        });\n        _this.isDispersed = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.DISPERSED;\n        });\n        _this.isDispersedGathering = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.DISPERSED_GATHERING;\n        });\n        _this.isRazed = _knockout2.default.pureComputed(function () {\n            return _this.state() === TribeStates.RAZED;\n        });\n        return _this;\n    }\n\n    _createClass(Tribe, [{\n        key: 'isAlliedToFaction',\n        value: function isAlliedToFaction(factionId) {\n            return this.isAllied() && this.alliedFactionId() === factionId;\n        }\n    }, {\n        key: 'disperse',\n        value: function disperse() {\n            this.state(TribeStates.DISPERSED);\n        }\n    }, {\n        key: 'disperseGathering',\n        value: function disperseGathering() {\n            this.state(TribeStates.DISPERSED_GATHERING);\n        }\n    }, {\n        key: 'makeAllied',\n        value: function makeAllied(alliedTribe) {\n            alliedTribe.tribeId = this.id;\n            this.alliedFactionId(alliedTribe.factionId);\n            this.state(TribeStates.ALLIED);\n        }\n    }, {\n        key: 'removeAlly',\n        value: function removeAlly(alliedTribe) {\n            alliedTribe.tribeId = null;\n            this.alliedFactionId(null);\n            this.state(TribeStates.SUBDUED);\n        }\n    }, {\n        key: 'buildCitadel',\n        value: function buildCitadel(citadel) {\n            citadel.tribeId = this.id;\n            this.alliedFactionId(citadel.factionId);\n            this.state(TribeStates.CITADEL);\n        }\n    }, {\n        key: 'undisperse',\n        value: function undisperse(fully) {\n            if (fully) {\n                this.state(TribeStates.SUBDUED);\n            }\n            if (this.isDispersed()) {\n                this.state(TribeStates.DISPERSED_GATHERING);\n            } else if (this.isDispersedGathering()) {\n                this.state(TribeStates.SUBDUED);\n            }\n        }\n    }, {\n        key: 'toString',\n        value: function toString() {\n            var value = this.name;\n            if (this.isSubdued()) {\n                value += ' - Subdued';\n            } else if (this.isDispersed()) {\n                value += ' - Dispersed';\n            } else if (this.isDispersedGathering()) {\n                value += ' - Dispersed / Gathering';\n            } else if (this.isRazed()) {\n                value += ' - Dispersed / Razed';\n            } else if (this.isAllied()) {\n                value += ' - ' + this.alliedFactionId() + ' Ally';\n            } else if (this.isCitadel()) {\n                value += ' - ' + this.alliedFactionId() + ' Citadel';\n            }\n\n            return value;\n        }\n    }]);\n\n    return Tribe;\n}(_location2.default);\n\nexports.default = Tribe;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm9hcmQvdHJpYmUuanM/MjRlZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQga28gZnJvbSAnLi4vLi4vbGliL2tub2Nrb3V0JztcbmltcG9ydCBMb2NhdGlvbiBmcm9tICcuLi8uLi9jb21tb24vbG9jYXRpb24nO1xuXG4gICAgY29uc3QgVHJpYmVTdGF0ZXMgPSB7XG4gICAgICAgIEFMTElFRCA6ICdhbGxpZWQnLFxuICAgICAgICBDSVRBREVMIDogJ2NpdGFkZWwnLFxuICAgICAgICBTVUJEVUVEIDogJ3N1YmR1ZWQnLFxuICAgICAgICBESVNQRVJTRUQgOiAnZGlzcGVyc2VkJyxcbiAgICAgICAgRElTUEVSU0VEX0dBVEhFUklORyA6ICdkaXNwZXJzZWRnYXRoZXJpbmcnLFxuICAgICAgICBSQVpFRDogJ3JhemVkJ1xuICAgIH07XG5cbiAgICBjbGFzcyBUcmliZSBleHRlbmRzIExvY2F0aW9uIHtcbiAgICAgICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG5cbiAgICAgICAgICAgIC8vIEltbXV0YWJsZVxuICAgICAgICAgICAgdGhpcy5pc0NpdHkgPSBkZWZpbml0aW9uLmlzQ2l0eSB8fCBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZmFjdGlvblJlc3RyaWN0aW9uID0gZGVmaW5pdGlvbi5mYWN0aW9uUmVzdHJpY3Rpb24gfHwgbnVsbDtcbiAgICAgICAgICAgIHRoaXMucmVnaW9uSWQgPSBkZWZpbml0aW9uLnJlZ2lvbklkO1xuXG4gICAgICAgICAgICAvLyBNdXRhYmxlXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0ga28ub2JzZXJ2YWJsZShUcmliZVN0YXRlcy5TVUJEVUVEKTtcbiAgICAgICAgICAgIHRoaXMuYWxsaWVkRmFjdGlvbklkID0ga28ub2JzZXJ2YWJsZSgpO1xuXG4gICAgICAgICAgICAvLyBDb21wdXRlZFxuICAgICAgICAgICAgdGhpcy5pc0FsbGllZCA9IGtvLnB1cmVDb21wdXRlZCggKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlKCkgPT09IFRyaWJlU3RhdGVzLkFMTElFRDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5pc0NpdGFkZWwgPSBrby5wdXJlQ29tcHV0ZWQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlKCkgPT09IFRyaWJlU3RhdGVzLkNJVEFERUw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuaXNTdWJkdWVkID0ga28ucHVyZUNvbXB1dGVkKCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUoKSA9PT0gVHJpYmVTdGF0ZXMuU1VCRFVFRDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5pc0Rpc3BlcnNlZCA9IGtvLnB1cmVDb21wdXRlZCggKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlKCkgPT09IFRyaWJlU3RhdGVzLkRJU1BFUlNFRDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5pc0Rpc3BlcnNlZEdhdGhlcmluZyA9IGtvLnB1cmVDb21wdXRlZCggKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlKCkgPT09IFRyaWJlU3RhdGVzLkRJU1BFUlNFRF9HQVRIRVJJTkc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuaXNSYXplZCA9IGtvLnB1cmVDb21wdXRlZCggKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlKCkgPT09IFRyaWJlU3RhdGVzLlJBWkVEO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpc0FsbGllZFRvRmFjdGlvbihmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQWxsaWVkKCkgJiYgdGhpcy5hbGxpZWRGYWN0aW9uSWQoKSA9PT0gZmFjdGlvbklkO1xuICAgICAgICB9XG5cbiAgICAgICAgZGlzcGVyc2UoKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlKFRyaWJlU3RhdGVzLkRJU1BFUlNFRCk7XG4gICAgICAgIH1cblxuICAgICAgICBkaXNwZXJzZUdhdGhlcmluZygpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUoVHJpYmVTdGF0ZXMuRElTUEVSU0VEX0dBVEhFUklORyk7XG4gICAgICAgIH1cblxuICAgICAgICBtYWtlQWxsaWVkKGFsbGllZFRyaWJlKSB7XG4gICAgICAgICAgICBhbGxpZWRUcmliZS50cmliZUlkID0gdGhpcy5pZDtcbiAgICAgICAgICAgIHRoaXMuYWxsaWVkRmFjdGlvbklkKGFsbGllZFRyaWJlLmZhY3Rpb25JZCk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlKFRyaWJlU3RhdGVzLkFMTElFRCk7XG4gICAgICAgIH1cblxuICAgICAgICByZW1vdmVBbGx5KGFsbGllZFRyaWJlKSB7XG4gICAgICAgICAgICBhbGxpZWRUcmliZS50cmliZUlkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYWxsaWVkRmFjdGlvbklkKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZShUcmliZVN0YXRlcy5TVUJEVUVEKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJ1aWxkQ2l0YWRlbChjaXRhZGVsKSB7XG4gICAgICAgICAgICBjaXRhZGVsLnRyaWJlSWQgPSB0aGlzLmlkO1xuICAgICAgICAgICAgdGhpcy5hbGxpZWRGYWN0aW9uSWQoY2l0YWRlbC5mYWN0aW9uSWQpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZShUcmliZVN0YXRlcy5DSVRBREVMKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVuZGlzcGVyc2UoZnVsbHkpIHtcbiAgICAgICAgICAgIGlmKGZ1bGx5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZShUcmliZVN0YXRlcy5TVUJEVUVEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzRGlzcGVyc2VkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlKFRyaWJlU3RhdGVzLkRJU1BFUlNFRF9HQVRIRVJJTkcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc0Rpc3BlcnNlZEdhdGhlcmluZygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZShUcmliZVN0YXRlcy5TVUJEVUVEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRvU3RyaW5nKCkge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5uYW1lO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTdWJkdWVkKCkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSAnIC0gU3ViZHVlZCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmlzRGlzcGVyc2VkKCkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSAnIC0gRGlzcGVyc2VkJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNEaXNwZXJzZWRHYXRoZXJpbmcoKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlICs9ICcgLSBEaXNwZXJzZWQgLyBHYXRoZXJpbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc1JhemVkKCkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSAnIC0gRGlzcGVyc2VkIC8gUmF6ZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc0FsbGllZCgpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgKz0gJyAtICcgKyB0aGlzLmFsbGllZEZhY3Rpb25JZCgpICsgJyBBbGx5JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNDaXRhZGVsKCkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSAnIC0gJyArIHRoaXMuYWxsaWVkRmFjdGlvbklkKCkgKyAnIENpdGFkZWwnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbmV4cG9ydCBkZWZhdWx0IFRyaWJlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib2FyZC90cmliZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFDQTtBQVFBOzs7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUhBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5QkE7QUErQkE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 97 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _event = __webpack_require__(124);\n\nvar _event2 = _interopRequireDefault(_event);\n\nvar _event3 = __webpack_require__(125);\n\nvar _event4 = _interopRequireDefault(_event3);\n\nvar _event5 = __webpack_require__(101);\n\nvar _event6 = _interopRequireDefault(_event5);\n\nvar _event7 = __webpack_require__(102);\n\nvar _event8 = _interopRequireDefault(_event7);\n\nvar _event9 = __webpack_require__(103);\n\nvar _event10 = _interopRequireDefault(_event9);\n\nvar _event11 = __webpack_require__(104);\n\nvar _event12 = _interopRequireDefault(_event11);\n\nvar _event13 = __webpack_require__(105);\n\nvar _event14 = _interopRequireDefault(_event13);\n\nvar _event15 = __webpack_require__(106);\n\nvar _event16 = _interopRequireDefault(_event15);\n\nvar _event17 = __webpack_require__(107);\n\nvar _event18 = _interopRequireDefault(_event17);\n\nvar _event19 = __webpack_require__(108);\n\nvar _event20 = _interopRequireDefault(_event19);\n\nvar _event21 = __webpack_require__(109);\n\nvar _event22 = _interopRequireDefault(_event21);\n\nvar _event23 = __webpack_require__(110);\n\nvar _event24 = _interopRequireDefault(_event23);\n\nvar _event25 = __webpack_require__(111);\n\nvar _event26 = _interopRequireDefault(_event25);\n\nvar _event27 = __webpack_require__(112);\n\nvar _event28 = _interopRequireDefault(_event27);\n\nvar _event29 = __webpack_require__(113);\n\nvar _event30 = _interopRequireDefault(_event29);\n\nvar _event31 = __webpack_require__(114);\n\nvar _event32 = _interopRequireDefault(_event31);\n\nvar _event33 = __webpack_require__(115);\n\nvar _event34 = _interopRequireDefault(_event33);\n\nvar _event35 = __webpack_require__(116);\n\nvar _event36 = _interopRequireDefault(_event35);\n\nvar _event37 = __webpack_require__(117);\n\nvar _event38 = _interopRequireDefault(_event37);\n\nvar _event39 = __webpack_require__(118);\n\nvar _event40 = _interopRequireDefault(_event39);\n\nvar _event41 = __webpack_require__(119);\n\nvar _event42 = _interopRequireDefault(_event41);\n\nvar _event43 = __webpack_require__(120);\n\nvar _event44 = _interopRequireDefault(_event43);\n\nvar _event45 = __webpack_require__(121);\n\nvar _event46 = _interopRequireDefault(_event45);\n\nvar _event47 = __webpack_require__(122);\n\nvar _event48 = _interopRequireDefault(_event47);\n\nvar _event49 = __webpack_require__(123);\n\nvar _event50 = _interopRequireDefault(_event49);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NoEvents = [58, 47, 1, 53, 32, 17, 72, 54, 20, 23, 69, 29];\nvar CapabilityEvents = [8, 10, 12, 13, 15, 25, 27, 30, 38, 39, 43, 55, 59, 63];\nvar PlayerOrWinningBotRomans = [7, 16, 13, 4, 14, 55, 31, 56, 5, 15, 2, 6, 11, 3, 21, 12];\nvar RomansHandleEvent = [2, 3, 4, 5, 6, 7, 14, 18, 21, 31, 33];\nvar EventHandlers = {\n    8: _event2.default,\n    9: _event4.default,\n    10: _event6.default,\n    12: _event8.default,\n    15: _event10.default,\n    22: _event12.default,\n    24: _event14.default,\n    25: _event16.default,\n    26: _event18.default,\n    27: _event20.default,\n    28: _event22.default,\n    35: _event24.default,\n    36: _event26.default,\n    40: _event28.default,\n    41: _event30.default,\n    42: _event32.default,\n    43: _event34.default,\n    45: _event36.default,\n    46: _event38.default,\n    48: _event40.default,\n    49: _event42.default,\n    50: _event44.default,\n    52: _event46.default,\n    55: _event48.default,\n    56: _event50.default\n};\n\nvar AeduiEvent = function () {\n    function AeduiEvent() {\n        _classCallCheck(this, AeduiEvent);\n    }\n\n    _createClass(AeduiEvent, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var currentCard = state.currentCard();\n            console.log('*** Is Aedui No Event? ***');\n            if (_lodash2.default.indexOf(NoEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Is Capability in final year? ***');\n            if (state.isLastYear() && _lodash2.default.indexOf(CapabilityEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Are Romans a player or winning by too much? ***');\n            if (_lodash2.default.indexOf(PlayerOrWinningBotRomans, currentCard.id) >= 0) {\n                var player = state.playersByFaction[_factionIds2.default.ROMANS];\n                var faction = state.factionsById[_factionIds2.default.ROMANS];\n                if (!player.isNonPlayer || faction.victoryMargin(state) > -3) {\n                    return false;\n                }\n            }\n\n            console.log('*** Should we ask Romans to handle this event? ***');\n            if (_lodash2.default.indexOf(RomansHandleEvent, currentCard.id) >= 0) {\n                var romanPlayer = state.playersByFaction[_factionIds2.default.ROMANS];\n                return romanPlayer.handleEvent(state, currentCard);\n            }\n\n            console.log('*** Is Event effective? ***');\n            var eventHandler = EventHandlers[currentCard.id];\n            if (!eventHandler) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startEvent(currentCard.id);\n            var handled = eventHandler.handleEvent(state);\n            if (!handled) {\n                state.turnHistory.getCurrentTurn().rollbackEvent();\n            } else {\n                state.turnHistory.getCurrentTurn().commitEvent();\n            }\n\n            return handled;\n        }\n    }]);\n\n    return AeduiEvent;\n}();\n\nexports.default = AeduiEvent;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aUV2ZW50LmpzP2E0NmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5cbmltcG9ydCBFdmVudDggZnJvbSAnLi9ldmVudHMvZXZlbnQ4JztcbmltcG9ydCBFdmVudDkgZnJvbSAnLi9ldmVudHMvZXZlbnQ5JztcbmltcG9ydCBFdmVudDEwIGZyb20gJy4vZXZlbnRzL2V2ZW50MTAnO1xuaW1wb3J0IEV2ZW50MTIgZnJvbSAnLi9ldmVudHMvZXZlbnQxMic7XG5pbXBvcnQgRXZlbnQxNSBmcm9tICcuL2V2ZW50cy9ldmVudDE1JztcbmltcG9ydCBFdmVudDIyIGZyb20gJy4vZXZlbnRzL2V2ZW50MjInO1xuaW1wb3J0IEV2ZW50MjQgZnJvbSAnLi9ldmVudHMvZXZlbnQyNCc7XG5pbXBvcnQgRXZlbnQyNSBmcm9tICcuL2V2ZW50cy9ldmVudDI1JztcbmltcG9ydCBFdmVudDI2IGZyb20gJy4vZXZlbnRzL2V2ZW50MjYnO1xuaW1wb3J0IEV2ZW50MjcgZnJvbSAnLi9ldmVudHMvZXZlbnQyNyc7XG5pbXBvcnQgRXZlbnQyOCBmcm9tICcuL2V2ZW50cy9ldmVudDI4JztcbmltcG9ydCBFdmVudDM1IGZyb20gJy4vZXZlbnRzL2V2ZW50MzUnO1xuaW1wb3J0IEV2ZW50MzYgZnJvbSAnLi9ldmVudHMvZXZlbnQzNic7XG5pbXBvcnQgRXZlbnQ0MCBmcm9tICcuL2V2ZW50cy9ldmVudDQwJztcbmltcG9ydCBFdmVudDQxIGZyb20gJy4vZXZlbnRzL2V2ZW50NDEnO1xuaW1wb3J0IEV2ZW50NDIgZnJvbSAnLi9ldmVudHMvZXZlbnQ0Mic7XG5pbXBvcnQgRXZlbnQ0MyBmcm9tICcuL2V2ZW50cy9ldmVudDQzJztcbmltcG9ydCBFdmVudDQ1IGZyb20gJy4vZXZlbnRzL2V2ZW50NDUnO1xuaW1wb3J0IEV2ZW50NDYgZnJvbSAnLi9ldmVudHMvZXZlbnQ0Nic7XG5pbXBvcnQgRXZlbnQ0OCBmcm9tICcuL2V2ZW50cy9ldmVudDQ4JztcbmltcG9ydCBFdmVudDQ5IGZyb20gJy4vZXZlbnRzL2V2ZW50NDknO1xuaW1wb3J0IEV2ZW50NTAgZnJvbSAnLi9ldmVudHMvZXZlbnQ1MCc7XG5pbXBvcnQgRXZlbnQ1MiBmcm9tICcuL2V2ZW50cy9ldmVudDUyJztcbmltcG9ydCBFdmVudDU1IGZyb20gJy4vZXZlbnRzL2V2ZW50NTUnO1xuaW1wb3J0IEV2ZW50NTYgZnJvbSAnLi9ldmVudHMvZXZlbnQ1Nic7XG5cbmNvbnN0IE5vRXZlbnRzID0gWzU4LCA0NywgMSwgNTMsIDMyLCAxNywgNzIsIDU0LCAyMCwgMjMsIDY5LCAyOV07XG5jb25zdCBDYXBhYmlsaXR5RXZlbnRzID0gWzgsMTAsMTIsMTMsMTUsMjUsMjcsMzAsMzgsMzksNDMsNTUsNTksNjNdO1xuY29uc3QgUGxheWVyT3JXaW5uaW5nQm90Um9tYW5zID0gWzcsIDE2LCAxMywgNCwgMTQsIDU1LCAzMSwgNTYsIDUsIDE1LCAyLCA2LCAxMSwgMywgMjEsIDEyXTtcbmNvbnN0IFJvbWFuc0hhbmRsZUV2ZW50ID0gWzIsIDMsIDQsIDUsIDYsIDcsIDE0LCAxOCwgMjEsIDMxLCAzM107XG5jb25zdCBFdmVudEhhbmRsZXJzID0ge1xuICAgIDg6IEV2ZW50OCxcbiAgICA5OiBFdmVudDksXG4gICAgMTA6IEV2ZW50MTAsXG4gICAgMTI6IEV2ZW50MTIsXG4gICAgMTU6IEV2ZW50MTUsXG4gICAgMjI6IEV2ZW50MjIsXG4gICAgMjQ6IEV2ZW50MjQsXG4gICAgMjU6IEV2ZW50MjUsXG4gICAgMjY6IEV2ZW50MjYsXG4gICAgMjc6IEV2ZW50MjcsXG4gICAgMjg6IEV2ZW50MjgsXG4gICAgMzU6IEV2ZW50MzUsXG4gICAgMzY6IEV2ZW50MzYsXG4gICAgNDA6IEV2ZW50NDAsXG4gICAgNDE6IEV2ZW50NDEsXG4gICAgNDI6IEV2ZW50NDIsXG4gICAgNDM6IEV2ZW50NDMsXG4gICAgNDU6IEV2ZW50NDUsXG4gICAgNDY6IEV2ZW50NDYsXG4gICAgNDg6IEV2ZW50NDgsXG4gICAgNDk6IEV2ZW50NDksXG4gICAgNTA6IEV2ZW50NTAsXG4gICAgNTI6IEV2ZW50NTIsXG4gICAgNTU6IEV2ZW50NTUsXG4gICAgNTY6IEV2ZW50NTZcbn07XG5cbmNsYXNzIEFlZHVpRXZlbnQge1xuXG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDYXJkID0gc3RhdGUuY3VycmVudENhcmQoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBJcyBBZWR1aSBObyBFdmVudD8gKioqJyk7XG4gICAgICAgIGlmIChfLmluZGV4T2YoTm9FdmVudHMsIGN1cnJlbnRDYXJkLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnKioqIElzIENhcGFiaWxpdHkgaW4gZmluYWwgeWVhcj8gKioqJyk7XG4gICAgICAgIGlmKHN0YXRlLmlzTGFzdFllYXIoKSAmJiBfLmluZGV4T2YoQ2FwYWJpbGl0eUV2ZW50cywgY3VycmVudENhcmQuaWQpID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQXJlIFJvbWFucyBhIHBsYXllciBvciB3aW5uaW5nIGJ5IHRvbyBtdWNoPyAqKionKTtcbiAgICAgICAgaWYgKF8uaW5kZXhPZihQbGF5ZXJPcldpbm5pbmdCb3RSb21hbnMsIGN1cnJlbnRDYXJkLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuUk9NQU5TXTtcbiAgICAgICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5ST01BTlNdO1xuICAgICAgICAgICAgaWYgKCFwbGF5ZXIuaXNOb25QbGF5ZXIgfHwgZmFjdGlvbi52aWN0b3J5TWFyZ2luKHN0YXRlKSA+IC0zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBTaG91bGQgd2UgYXNrIFJvbWFucyB0byBoYW5kbGUgdGhpcyBldmVudD8gKioqJyk7XG4gICAgICAgIGlmIChfLmluZGV4T2YoUm9tYW5zSGFuZGxlRXZlbnQsIGN1cnJlbnRDYXJkLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCByb21hblBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5ST01BTlNdO1xuICAgICAgICAgICAgcmV0dXJuIHJvbWFuUGxheWVyLmhhbmRsZUV2ZW50KHN0YXRlLCBjdXJyZW50Q2FyZCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnKioqIElzIEV2ZW50IGVmZmVjdGl2ZT8gKioqJyk7XG4gICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IEV2ZW50SGFuZGxlcnNbY3VycmVudENhcmQuaWRdO1xuICAgICAgICBpZiAoIWV2ZW50SGFuZGxlcikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydEV2ZW50KGN1cnJlbnRDYXJkLmlkKTtcbiAgICAgICAgY29uc3QgaGFuZGxlZCA9IGV2ZW50SGFuZGxlci5oYW5kbGVFdmVudChzdGF0ZSk7XG4gICAgICAgIGlmKCFoYW5kbGVkKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrRXZlbnQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0RXZlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBoYW5kbGVkO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBBZWR1aUV2ZW50O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2FlZHVpRXZlbnQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQ0E7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpCQTtBQUNBO0FBMkJBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 98 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _aeduiTrade = __webpack_require__(39);\n\nvar _aeduiTrade2 = _interopRequireDefault(_aeduiTrade);\n\nvar _aeduiSuborn = __webpack_require__(50);\n\nvar _aeduiSuborn2 = _interopRequireDefault(_aeduiSuborn);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _enemyFactionPriority = __webpack_require__(34);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    MARCH_COMPLETE_CHECK: 'mcc'\n};\n\nvar AeduiMarch = function () {\n    function AeduiMarch() {\n        _classCallCheck(this, AeduiMarch);\n    }\n\n    _createClass(AeduiMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers) {\n            var faction = state.aedui;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (!turn.getCheckpoint(Checkpoints.MARCH_COMPLETE_CHECK)) {\n                if (state.frost()) {\n                    return false;\n                }\n\n                var effectiveMarch = this.findEffectiveMarch(state, modifiers, faction);\n                if (!effectiveMarch) {\n                    return false;\n                }\n                turn.startCommand(_commandIds2.default.MARCH);\n                var regionsMarched = {};\n\n                if (effectiveMarch.expansionMarchRegions.length > 0) {\n                    console.log('*** Aedui march to expand ***');\n                    if (!modifiers.free) {\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: effectiveMarch.expansionMarchCost });\n                    }\n                    var expansionPieces = effectiveMarch.expansionMarchStartRegion.piecesByFaction()[_factionIds2.default.AEDUI];\n                    var expansionWarbands = _lodash2.default.filter(expansionPieces, { type: 'warband' });\n                    _hidePieces2.default.execute(state, {\n                        factionId: faction.id,\n                        regionId: effectiveMarch.expansionMarchStartRegion.id\n                    });\n\n                    _lodash2.default.each(effectiveMarch.expansionMarchRegions, function (destinationRegion) {\n                        var pieceToMove = expansionWarbands.shift();\n                        _movePieces2.default.execute(state, {\n                            sourceRegionId: effectiveMarch.expansionMarchStartRegion.id,\n                            destRegionId: destinationRegion.id,\n                            pieces: [pieceToMove]\n                        });\n                    });\n                    regionsMarched[effectiveMarch.expansionMarchStartRegion.id] = true;\n                }\n\n                if (effectiveMarch.controlMarchRegion) {\n                    console.log('*** Aedui march to control ***');\n                    if (!modifiers.free) {\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: effectiveMarch.controlMarchCost });\n                    }\n                    var controlPieces = effectiveMarch.controlMarchStart.piecesByFaction()[_factionIds2.default.AEDUI];\n                    var warbands = (0, _lodash2.default)(controlPieces).filter({ type: 'warband' }).value();\n                    var numWarbandsNeeded = Math.abs(effectiveMarch.controlMarchRegion.controllingMarginByFaction()[_factionIds2.default.AEDUI]) + 1;\n                    var controlWarbands = _lodash2.default.take(warbands, numWarbandsNeeded);\n                    if (!regionsMarched[effectiveMarch.controlMarchStart.id]) {\n                        _hidePieces2.default.execute(state, {\n                            factionId: faction.id,\n                            regionId: effectiveMarch.controlMarchStart.id\n                        });\n                    }\n\n                    _movePieces2.default.execute(state, {\n                        sourceRegionId: effectiveMarch.controlMarchStart.id,\n                        destRegionId: effectiveMarch.controlMarchRegion.id,\n                        pieces: controlWarbands\n                    });\n                }\n                turn.commitCommand();\n            }\n            turn.markCheckpoint(Checkpoints.MARCH_COMPLETE_CHECK);\n\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_aeduiTrade2.default.trade(state, modifiers) || _aeduiSuborn2.default.suborn(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'findEffectiveMarch',\n        value: function findEffectiveMarch(state, modifiers, faction) {\n            var _this = this;\n\n            var marchResults = _lodash2.default.filter(_march2.default.test(state, { factionId: _factionIds2.default.AEDUI }), function (marchResult) {\n                return faction.resources() >= marchResult.cost || modifiers.free;\n            });\n\n            var rankedEnemyFactions = (0, _lodash2.default)(state.factions).sortBy(function (faction) {\n                return 99 - faction.numAlliedTribesAndCitadelsPlaced() + _enemyFactionPriority2.default[faction.id];\n            }).reject({ id: _factionIds2.default.AEDUI }).value();\n\n            var enemyFactionRankById = {};\n            _lodash2.default.each(rankedEnemyFactions, function (faction, index) {\n                enemyFactionRankById[faction.id] = index + 1;\n            });\n\n            var groupedEffectiveMarchesByPriority = (0, _lodash2.default)(marchResults).map(function (marchResult) {\n                var priority = 'z';\n                var region = marchResult.region;\n                var pieces = region.piecesByFaction()[_factionIds2.default.AEDUI];\n                var mobilePieces = _lodash2.default.filter(pieces, { isMobile: true });\n                if (mobilePieces.length === 1 || region.controllingMarginByFaction()[_factionIds2.default.AEDUI] === 1) {\n                    return;\n                }\n\n                var numMoveablePieces = mobilePieces.length - 1;\n                if (region.controllingMarginByFaction()[_factionIds2.default.AEDUI] > 0) {\n                    numMoveablePieces = Math.min(numMoveablePieces, region.controllingMarginByFaction()[_factionIds2.default.AEDUI] - 1);\n                }\n                var validDestinations = _lodash2.default.filter(marchResult.destinations, function (destination) {\n                    var pieces = destination.piecesByFaction()[_factionIds2.default.AEDUI];\n                    var hiddenPieces = _lodash2.default.filter(pieces, function (piece) {\n                        if (piece.type === 'warband' && !piece.revealed()) {\n                            return true;\n                        }\n                    });\n                    return hiddenPieces.length === 0;\n                });\n\n                // rank destinations by most allied / citadels per enemy and control margin\n                var prioritizedDestinations = _this.prioritizeDestinationsByAlliesAndBasicControl(validDestinations, enemyFactionRankById);\n\n                var piecesLeftToUseForControl = numMoveablePieces - 3;\n\n                _this.updateDestinationPriorityForSelfAndNeighborControl(prioritizedDestinations, piecesLeftToUseForControl, region);\n\n                var groupedDestinationsByPriority = _lodash2.default.groupBy(prioritizedDestinations, 'priority');\n                var finalDestinationsAndPriorityValues = [];\n                var sortedPriorities = _lodash2.default.keys(groupedDestinationsByPriority).sort();\n                var numToTake = Math.min(3, numMoveablePieces);\n                while (numToTake > 0) {\n                    var nextPriority = sortedPriorities.shift();\n                    if (!nextPriority) {\n                        break;\n                    }\n                    var _priorityGroup = groupedDestinationsByPriority[nextPriority];\n                    var chosenEntries = _lodash2.default.sampleSize(_priorityGroup, numToTake);\n                    finalDestinationsAndPriorityValues.push.apply(finalDestinationsAndPriorityValues, chosenEntries);\n                    numToTake -= chosenEntries.length;\n                }\n\n                if (finalDestinationsAndPriorityValues.length > 0) {\n                    var topDestinationPriority = _lodash2.default.first(finalDestinationsAndPriorityValues).priority;\n                    priority = topDestinationPriority + (9 - _lodash2.default.countBy(finalDestinationsAndPriorityValues, 'priority')[topDestinationPriority]);\n                }\n\n                var chosenMarch = {};\n                chosenMarch.priority = priority;\n                chosenMarch.expansionMarchCost = finalDestinationsAndPriorityValues.length > 0 ? marchResult.cost : 0;\n                chosenMarch.expansionMarchStartRegion = marchResult.region;\n                chosenMarch.expansionMarchRegions = _lodash2.default.map(finalDestinationsAndPriorityValues, 'destination');\n                var controlMarch = _this.findControlMarch(modifiers, faction, marchResults, chosenMarch);\n                if (controlMarch) {\n                    chosenMarch.controlMarchCost = controlMarch.cost;\n                    chosenMarch.controlMarchRegion = controlMarch.destination;\n                    chosenMarch.controlMarchStart = controlMarch.startRegion;\n                }\n\n                return chosenMarch;\n            }).compact().reject({ priority: 'z' }).groupBy('priority').value();\n\n            if (groupedEffectiveMarchesByPriority.length === 0) {\n                return;\n            }\n\n            var sortedPriorities = _lodash2.default.keys(groupedEffectiveMarchesByPriority).sort();\n            var priorityGroup = groupedEffectiveMarchesByPriority[_lodash2.default.first(sortedPriorities)];\n            return _lodash2.default.sample(priorityGroup);\n        }\n    }, {\n        key: 'prioritizeDestinationsByAlliesAndBasicControl',\n        value: function prioritizeDestinationsByAlliesAndBasicControl(validDestinations, enemyFactionRankById) {\n            return (0, _lodash2.default)(validDestinations).map(function (destination) {\n                var destinationPriority = 'z';\n\n                // First by most winning enemy tribe\n                _lodash2.default.each(destination.tribes, function (tribe) {\n                    if (tribe.alliedFactionId() && tribe.alliedFactionId() !== _factionIds2.default.AEDUI) {\n                        var possiblePriority = 'a' + 10 + enemyFactionRankById[tribe.alliedFactionId()];\n                        if (possiblePriority < destinationPriority) {\n                            destinationPriority = possiblePriority;\n                        }\n                    }\n                });\n\n                // Order them by control margin\n                var controlMarginAfterPlacement = destination.controllingMarginByFaction()[_factionIds2.default.AEDUI] + 1;\n                if (controlMarginAfterPlacement <= 0) {\n                    var piecesNeeded = Math.abs(controlMarginAfterPlacement) + 1;\n                    var controlBasedPriority = 'd' + 10 + piecesNeeded;\n                    if (controlBasedPriority < destinationPriority) {\n                        destinationPriority = controlBasedPriority;\n                    }\n                }\n                return {\n                    destination: destination,\n                    priority: destinationPriority\n                };\n            }).sortBy('priority').value();\n        }\n    }, {\n        key: 'updateDestinationPriorityForSelfAndNeighborControl',\n        value: function updateDestinationPriorityForSelfAndNeighborControl(prioritizedDestinations, piecesLeftToTakeControl, startRegion) {\n            _lodash2.default.each(prioritizedDestinations, function (prioritizedDestination) {\n                var destination = prioritizedDestination.destination;\n                if (_lodash2.default.startsWith(prioritizedDestination.priority, 'a')) {\n                    return;\n                }\n\n                // Now consider how close we are to controlling the region by ourselves or a neighbor\n                var controlMarginAfterPlacement = destination.controllingMarginByFaction()[_factionIds2.default.AEDUI] + 1;\n                if (controlMarginAfterPlacement <= 0) {\n                    var piecesNeeded = Math.abs(controlMarginAfterPlacement) + 1;\n                    if (piecesNeeded <= piecesLeftToTakeControl) {\n                        prioritizedDestination.priority = 'b' + 10 + piecesNeeded;\n                        return;\n                    }\n\n                    var helpingNeighbor = _lodash2.default.find(destination.adjacent, function (neighborToDestination) {\n                        if (neighborToDestination.id === startRegion.id) {\n                            return false;\n                        }\n                        var neighborPieces = neighborToDestination.piecesByFaction()[_factionIds2.default.AEDUI];\n                        var neighborMobilePieces = _lodash2.default.filter(neighborPieces, { isMobile: true });\n                        var numNeighborMoveablePieces = Math.min(neighborMobilePieces.length - 1, neighborToDestination.controllingMarginByFaction()[_factionIds2.default.AEDUI] - 1);\n                        if (numNeighborMoveablePieces < 1) {\n                            return false;\n                        }\n                        return piecesNeeded - numNeighborMoveablePieces <= 0;\n                    });\n\n                    if (helpingNeighbor) {\n                        var neighborBasedPriority = 'c' + 10 + piecesNeeded;\n                        if (neighborBasedPriority < prioritizedDestination.priority) {\n                            prioritizedDestination.priority = neighborBasedPriority;\n                        }\n                    }\n                }\n            });\n        }\n    }, {\n        key: 'findControlMarch',\n        value: function findControlMarch(modifiers, faction, marchResults, chosenMarch) {\n            var availableResources = faction.resources() - chosenMarch.expansionMarchCost;\n\n            var groupedMarchesByDestinationPriority = (0, _lodash2.default)(marchResults).map(function (march) {\n                var region = march.region;\n\n                if (modifiers.limited && region.id !== chosenMarch.expansionMarchStartRegion.id) {\n                    return;\n                }\n\n                var controlMarchCost = region.id !== chosenMarch.expansionMarchStartRegion.id ? march.cost : 0;\n                if (!modifiers.free && controlMarchCost > availableResources) {\n                    return;\n                }\n\n                var pieces = region.piecesByFaction()[_factionIds2.default.AEDUI];\n                var mobilePieces = _lodash2.default.filter(pieces, { isMobile: true });\n                if (mobilePieces.length === 1 || region.controllingMarginByFaction()[_factionIds2.default.AEDUI] === 1) {\n                    return;\n                }\n\n                var numPiecesUsedForExpansion = region.id === chosenMarch.expansionMarchStartRegion.id ? chosenMarch.expansionMarchRegions.length : 0;\n                var numMoveablePieces = mobilePieces.length - 1;\n                if (region.controllingMarginByFaction()[_factionIds2.default.AEDUI] > 0) {\n                    numMoveablePieces = Math.min(numMoveablePieces, region.controllingMarginByFaction()[_factionIds2.default.AEDUI] - 1);\n                }\n                numMoveablePieces -= numPiecesUsedForExpansion;\n\n                if (numMoveablePieces <= 0) {\n                    return;\n                }\n\n                var expansionRegionIds = _lodash2.default.map(chosenMarch.expansionMarchRegions, 'id');\n                var groupedDestinationsByPriority = (0, _lodash2.default)(march.destinations).map(function (destination) {\n                    var destinationPriority = 'z';\n                    var controlMarginAfterPlacement = destination.controllingMarginByFaction()[_factionIds2.default.AEDUI] + (_lodash2.default.indexOf(expansionRegionIds, destination.id) ? 1 : 0);\n\n                    if (controlMarginAfterPlacement <= 0) {\n                        var piecesNeeded = Math.abs(controlMarginAfterPlacement) + 1;\n                        if (numMoveablePieces < piecesNeeded) {\n                            return;\n                        }\n                        destinationPriority = 'a' + 10 + piecesNeeded + '-' + controlMarchCost;\n                    }\n                    return {\n                        destination: destination,\n                        priority: destinationPriority\n                    };\n                }).compact().reject({ priority: 'z' }).groupBy('priority').value();\n\n                if (groupedDestinationsByPriority.length === 0) {\n                    return;\n                }\n                var sortedPriorities = _lodash2.default.keys(groupedDestinationsByPriority).sort();\n                var priorityGroup = groupedDestinationsByPriority[_lodash2.default.first(sortedPriorities)];\n                var chosenDestination = _lodash2.default.sample(priorityGroup);\n\n                if (chosenDestination) {\n                    return {\n                        cost: controlMarchCost,\n                        destination: chosenDestination.destination,\n                        priority: chosenDestination.priority,\n                        startRegion: march.region\n                    };\n                }\n            }).compact().groupBy('priority').value();\n\n            if (groupedMarchesByDestinationPriority.length === 0) {\n                return;\n            }\n\n            var sortedPriorities = _lodash2.default.keys(groupedMarchesByDestinationPriority).sort();\n            var priorityGroup = groupedMarchesByDestinationPriority[_lodash2.default.first(sortedPriorities)];\n            return _lodash2.default.sample(priorityGroup);\n        }\n    }]);\n\n    return AeduiMarch;\n}();\n\nexports.default = AeduiMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aU1hcmNoLmpzP2ZkMTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgTWFyY2ggZnJvbSAnLi4vLi4vY29tbWFuZHMvbWFyY2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEFlZHVpVHJhZGUgZnJvbSAnLi9hZWR1aVRyYWRlJztcbmltcG9ydCBBZWR1aVN1Ym9ybiBmcm9tICcuL2FlZHVpU3Vib3JuJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgSGlkZVBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL2hpZGVQaWVjZXMnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JlbW92ZVJlc291cmNlcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgTUFSQ0hfQ09NUExFVEVfQ0hFQ0sgOiAnbWNjJ1xufTtcblxuXG5jbGFzcyBBZWR1aU1hcmNoIHtcblxuICAgIHN0YXRpYyBtYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGZhY3Rpb24gPSBzdGF0ZS5hZWR1aTtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG5cbiAgICAgICAgaWYoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5NQVJDSF9DT01QTEVURV9DSEVDSykpIHtcbiAgICAgICAgICAgIGlmIChzdGF0ZS5mcm9zdCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBlZmZlY3RpdmVNYXJjaCA9IHRoaXMuZmluZEVmZmVjdGl2ZU1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIGZhY3Rpb24pO1xuICAgICAgICAgICAgaWYgKCFlZmZlY3RpdmVNYXJjaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHR1cm4uc3RhcnRDb21tYW5kKENvbW1hbmRJRHMuTUFSQ0gpO1xuICAgICAgICAgICAgY29uc3QgcmVnaW9uc01hcmNoZWQgPSB7fTtcblxuICAgICAgICAgICAgaWYgKGVmZmVjdGl2ZU1hcmNoLmV4cGFuc2lvbk1hcmNoUmVnaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKiBBZWR1aSBtYXJjaCB0byBleHBhbmQgKioqJyk7XG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IGVmZmVjdGl2ZU1hcmNoLmV4cGFuc2lvbk1hcmNoQ29zdH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBleHBhbnNpb25QaWVjZXMgPSBlZmZlY3RpdmVNYXJjaC5leHBhbnNpb25NYXJjaFN0YXJ0UmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4cGFuc2lvbldhcmJhbmRzID0gXy5maWx0ZXIoZXhwYW5zaW9uUGllY2VzLCB7dHlwZTogJ3dhcmJhbmQnfSk7XG4gICAgICAgICAgICAgICAgSGlkZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBmYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IGVmZmVjdGl2ZU1hcmNoLmV4cGFuc2lvbk1hcmNoU3RhcnRSZWdpb24uaWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICAgIGVmZmVjdGl2ZU1hcmNoLmV4cGFuc2lvbk1hcmNoUmVnaW9ucywgZnVuY3Rpb24gKGRlc3RpbmF0aW9uUmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZVRvTW92ZSA9IGV4cGFuc2lvbldhcmJhbmRzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmVnaW9uSWQ6IGVmZmVjdGl2ZU1hcmNoLmV4cGFuc2lvbk1hcmNoU3RhcnRSZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogZGVzdGluYXRpb25SZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogW3BpZWNlVG9Nb3ZlXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZWdpb25zTWFyY2hlZFtlZmZlY3RpdmVNYXJjaC5leHBhbnNpb25NYXJjaFN0YXJ0UmVnaW9uLmlkXSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlZmZlY3RpdmVNYXJjaC5jb250cm9sTWFyY2hSZWdpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEFlZHVpIG1hcmNoIHRvIGNvbnRyb2wgKioqJyk7XG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IGVmZmVjdGl2ZU1hcmNoLmNvbnRyb2xNYXJjaENvc3R9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgY29udHJvbFBpZWNlcyA9IGVmZmVjdGl2ZU1hcmNoLmNvbnRyb2xNYXJjaFN0YXJ0LnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdhcmJhbmRzID0gXyhjb250cm9sUGllY2VzKS5maWx0ZXIoe3R5cGU6ICd3YXJiYW5kJ30pLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtV2FyYmFuZHNOZWVkZWQgPSBNYXRoLmFicyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGVmZmVjdGl2ZU1hcmNoLmNvbnRyb2xNYXJjaFJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldKSArIDE7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udHJvbFdhcmJhbmRzID0gXy50YWtlKHdhcmJhbmRzLCBudW1XYXJiYW5kc05lZWRlZCk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZWdpb25zTWFyY2hlZFtlZmZlY3RpdmVNYXJjaC5jb250cm9sTWFyY2hTdGFydC5pZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgSGlkZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IGVmZmVjdGl2ZU1hcmNoLmNvbnRyb2xNYXJjaFN0YXJ0LmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBlZmZlY3RpdmVNYXJjaC5jb250cm9sTWFyY2hTdGFydC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogZWZmZWN0aXZlTWFyY2guY29udHJvbE1hcmNoUmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBjb250cm9sV2FyYmFuZHNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHR1cm4uY29tbWl0Q29tbWFuZCgpO1xuICAgICAgICB9XG4gICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuTUFSQ0hfQ09NUExFVEVfQ0hFQ0spO1xuXG4gICAgICAgIGNvbnN0IHVzZWRTcGVjaWFsQWJpbGl0eSA9IG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiAoQWVkdWlUcmFkZS50cmFkZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBBZWR1aVN1Ym9ybi5zdWJvcm4oc3RhdGUsIG1vZGlmaWVycykpO1xuICAgICAgICByZXR1cm4gdXNlZFNwZWNpYWxBYmlsaXR5ID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRFZmZlY3RpdmVNYXJjaChzdGF0ZSwgbW9kaWZpZXJzLCBmYWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0cyA9IF8uZmlsdGVyKFxuICAgICAgICAgICAgTWFyY2gudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSX0pLCBmdW5jdGlvbiAobWFyY2hSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdGlvbi5yZXNvdXJjZXMoKSA+PSBtYXJjaFJlc3VsdC5jb3N0IHx8IG1vZGlmaWVycy5mcmVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmFua2VkRW5lbXlGYWN0aW9ucyA9IF8oc3RhdGUuZmFjdGlvbnMpLnNvcnRCeShcbiAgICAgICAgICAgIGZ1bmN0aW9uIChmYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICg5OSAtIGZhY3Rpb24ubnVtQWxsaWVkVHJpYmVzQW5kQ2l0YWRlbHNQbGFjZWQoKSkgKyAoRW5lbXlGYWN0aW9uUHJpb3JpdHlbZmFjdGlvbi5pZF0pO1xuICAgICAgICAgICAgfSkucmVqZWN0KHtpZDogRmFjdGlvbklEcy5BRURVSX0pLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uUmFua0J5SWQgPSB7fTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgcmFua2VkRW5lbXlGYWN0aW9ucywgZnVuY3Rpb24gKGZhY3Rpb24sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgZW5lbXlGYWN0aW9uUmFua0J5SWRbZmFjdGlvbi5pZF0gPSBpbmRleCArIDE7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBncm91cGVkRWZmZWN0aXZlTWFyY2hlc0J5UHJpb3JpdHkgPSBfKG1hcmNoUmVzdWx0cykubWFwKFxuICAgICAgICAgICAgKG1hcmNoUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHByaW9yaXR5ID0gJ3onO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2lvbiA9IG1hcmNoUmVzdWx0LnJlZ2lvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXMgPSByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgICAgICAgICAgY29uc3QgbW9iaWxlUGllY2VzID0gXy5maWx0ZXIocGllY2VzLCB7aXNNb2JpbGU6IHRydWV9KTtcbiAgICAgICAgICAgICAgICBpZiAobW9iaWxlUGllY2VzLmxlbmd0aCA9PT0gMSB8fCByZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IG51bU1vdmVhYmxlUGllY2VzID0gbW9iaWxlUGllY2VzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBudW1Nb3ZlYWJsZVBpZWNlcyA9IE1hdGgubWluKG51bU1vdmVhYmxlUGllY2VzLCByZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZERlc3RpbmF0aW9ucyA9IF8uZmlsdGVyKFxuICAgICAgICAgICAgICAgICAgICBtYXJjaFJlc3VsdC5kZXN0aW5hdGlvbnMsIGZ1bmN0aW9uIChkZXN0aW5hdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGllY2VzID0gZGVzdGluYXRpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoaWRkZW5QaWVjZXMgPSBfLmZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWVjZXMsIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ3dhcmJhbmQnICYmICFwaWVjZS5yZXZlYWxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhpZGRlblBpZWNlcy5sZW5ndGggPT09IDA7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gcmFuayBkZXN0aW5hdGlvbnMgYnkgbW9zdCBhbGxpZWQgLyBjaXRhZGVscyBwZXIgZW5lbXkgYW5kIGNvbnRyb2wgbWFyZ2luXG4gICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMgPSB0aGlzLnByaW9yaXRpemVEZXN0aW5hdGlvbnNCeUFsbGllc0FuZEJhc2ljQ29udHJvbCh2YWxpZERlc3RpbmF0aW9ucywgZW5lbXlGYWN0aW9uUmFua0J5SWQpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2VzTGVmdFRvVXNlRm9yQ29udHJvbCA9IG51bU1vdmVhYmxlUGllY2VzIC0gMztcblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb25Qcmlvcml0eUZvclNlbGZBbmROZWlnaGJvckNvbnRyb2wocHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMsIHBpZWNlc0xlZnRUb1VzZUZvckNvbnRyb2wsIHJlZ2lvbik7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBncm91cGVkRGVzdGluYXRpb25zQnlQcmlvcml0eSA9IF8uZ3JvdXBCeShwcmlvcml0aXplZERlc3RpbmF0aW9ucywgJ3ByaW9yaXR5Jyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmluYWxEZXN0aW5hdGlvbnNBbmRQcmlvcml0eVZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZFByaW9yaXRpZXMgPSBfLmtleXMoZ3JvdXBlZERlc3RpbmF0aW9uc0J5UHJpb3JpdHkpLnNvcnQoKTtcbiAgICAgICAgICAgICAgICBsZXQgbnVtVG9UYWtlID0gTWF0aC5taW4oMywgbnVtTW92ZWFibGVQaWVjZXMpO1xuICAgICAgICAgICAgICAgIHdoaWxlIChudW1Ub1Rha2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQcmlvcml0eSA9IHNvcnRlZFByaW9yaXRpZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0UHJpb3JpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5R3JvdXAgPSBncm91cGVkRGVzdGluYXRpb25zQnlQcmlvcml0eVtuZXh0UHJpb3JpdHldO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaG9zZW5FbnRyaWVzID0gXy5zYW1wbGVTaXplKHByaW9yaXR5R3JvdXAsIG51bVRvVGFrZSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbmFsRGVzdGluYXRpb25zQW5kUHJpb3JpdHlWYWx1ZXMucHVzaC5hcHBseShmaW5hbERlc3RpbmF0aW9uc0FuZFByaW9yaXR5VmFsdWVzLCBjaG9zZW5FbnRyaWVzKTtcbiAgICAgICAgICAgICAgICAgICAgbnVtVG9UYWtlIC09IGNob3NlbkVudHJpZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmaW5hbERlc3RpbmF0aW9uc0FuZFByaW9yaXR5VmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9wRGVzdGluYXRpb25Qcmlvcml0eSA9IF8uZmlyc3QoZmluYWxEZXN0aW5hdGlvbnNBbmRQcmlvcml0eVZhbHVlcykucHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gdG9wRGVzdGluYXRpb25Qcmlvcml0eSArICg5IC0gXy5jb3VudEJ5KGZpbmFsRGVzdGluYXRpb25zQW5kUHJpb3JpdHlWYWx1ZXMsICdwcmlvcml0eScpW3RvcERlc3RpbmF0aW9uUHJpb3JpdHldKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjaG9zZW5NYXJjaCA9IHt9O1xuICAgICAgICAgICAgICAgIGNob3Nlbk1hcmNoLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgY2hvc2VuTWFyY2guZXhwYW5zaW9uTWFyY2hDb3N0ID0gZmluYWxEZXN0aW5hdGlvbnNBbmRQcmlvcml0eVZhbHVlcy5sZW5ndGggPiAwID8gbWFyY2hSZXN1bHQuY29zdCA6IDA7XG4gICAgICAgICAgICAgICAgY2hvc2VuTWFyY2guZXhwYW5zaW9uTWFyY2hTdGFydFJlZ2lvbiA9IG1hcmNoUmVzdWx0LnJlZ2lvbjtcbiAgICAgICAgICAgICAgICBjaG9zZW5NYXJjaC5leHBhbnNpb25NYXJjaFJlZ2lvbnMgPSBfLm1hcChmaW5hbERlc3RpbmF0aW9uc0FuZFByaW9yaXR5VmFsdWVzLCAnZGVzdGluYXRpb24nKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sTWFyY2ggPSB0aGlzLmZpbmRDb250cm9sTWFyY2gobW9kaWZpZXJzLCBmYWN0aW9uLCBtYXJjaFJlc3VsdHMsIGNob3Nlbk1hcmNoKTtcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbE1hcmNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNob3Nlbk1hcmNoLmNvbnRyb2xNYXJjaENvc3QgPSBjb250cm9sTWFyY2guY29zdDtcbiAgICAgICAgICAgICAgICAgICAgY2hvc2VuTWFyY2guY29udHJvbE1hcmNoUmVnaW9uID0gY29udHJvbE1hcmNoLmRlc3RpbmF0aW9uO1xuICAgICAgICAgICAgICAgICAgICBjaG9zZW5NYXJjaC5jb250cm9sTWFyY2hTdGFydCA9IGNvbnRyb2xNYXJjaC5zdGFydFJlZ2lvbjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gY2hvc2VuTWFyY2g7XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkucmVqZWN0KHtwcmlvcml0eTogJ3onfSkuZ3JvdXBCeSgncHJpb3JpdHknKS52YWx1ZSgpO1xuXG4gICAgICAgIGlmIChncm91cGVkRWZmZWN0aXZlTWFyY2hlc0J5UHJpb3JpdHkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzb3J0ZWRQcmlvcml0aWVzID0gXy5rZXlzKGdyb3VwZWRFZmZlY3RpdmVNYXJjaGVzQnlQcmlvcml0eSkuc29ydCgpO1xuICAgICAgICBjb25zdCBwcmlvcml0eUdyb3VwID0gZ3JvdXBlZEVmZmVjdGl2ZU1hcmNoZXNCeVByaW9yaXR5W18uZmlyc3Qoc29ydGVkUHJpb3JpdGllcyldO1xuICAgICAgICByZXR1cm4gXy5zYW1wbGUocHJpb3JpdHlHcm91cCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHByaW9yaXRpemVEZXN0aW5hdGlvbnNCeUFsbGllc0FuZEJhc2ljQ29udHJvbCh2YWxpZERlc3RpbmF0aW9ucywgZW5lbXlGYWN0aW9uUmFua0J5SWQpIHtcbiAgICAgICAgcmV0dXJuIF8odmFsaWREZXN0aW5hdGlvbnMpLm1hcChcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkZXN0aW5hdGlvbikge1xuICAgICAgICAgICAgICAgIGxldCBkZXN0aW5hdGlvblByaW9yaXR5ID0gJ3onO1xuXG4gICAgICAgICAgICAgICAgLy8gRmlyc3QgYnkgbW9zdCB3aW5uaW5nIGVuZW15IHRyaWJlXG4gICAgICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbi50cmliZXMsIGZ1bmN0aW9uICh0cmliZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyaWJlLmFsbGllZEZhY3Rpb25JZCgpICYmIHRyaWJlLmFsbGllZEZhY3Rpb25JZCgpICE9PSBGYWN0aW9uSURzLkFFRFVJKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zc2libGVQcmlvcml0eSA9ICdhJyArIDEwICsgZW5lbXlGYWN0aW9uUmFua0J5SWRbdHJpYmUuYWxsaWVkRmFjdGlvbklkKCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NzaWJsZVByaW9yaXR5IDwgZGVzdGluYXRpb25Qcmlvcml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblByaW9yaXR5ID0gcG9zc2libGVQcmlvcml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gT3JkZXIgdGhlbSBieSBjb250cm9sIG1hcmdpblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xNYXJnaW5BZnRlclBsYWNlbWVudCA9IGRlc3RpbmF0aW9uLmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BRURVSV0gKyAxO1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNOZWVkZWQgPSBNYXRoLmFicyhjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udHJvbEJhc2VkUHJpb3JpdHkgPSAnZCcgKyAxMCArIHBpZWNlc05lZWRlZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xCYXNlZFByaW9yaXR5IDwgZGVzdGluYXRpb25Qcmlvcml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25Qcmlvcml0eSA9IGNvbnRyb2xCYXNlZFByaW9yaXR5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGRlc3RpbmF0aW9uUHJpb3JpdHlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkuc29ydEJ5KCdwcmlvcml0eScpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHVwZGF0ZURlc3RpbmF0aW9uUHJpb3JpdHlGb3JTZWxmQW5kTmVpZ2hib3JDb250cm9sKHByaW9yaXRpemVkRGVzdGluYXRpb25zLCBwaWVjZXNMZWZ0VG9UYWtlQ29udHJvbCwgc3RhcnRSZWdpb24pIHtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgcHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMsIGZ1bmN0aW9uIChwcmlvcml0aXplZERlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb24gPSBwcmlvcml0aXplZERlc3RpbmF0aW9uLmRlc3RpbmF0aW9uO1xuICAgICAgICAgICAgICAgIGlmIChfLnN0YXJ0c1dpdGgocHJpb3JpdGl6ZWREZXN0aW5hdGlvbi5wcmlvcml0eSwgJ2EnKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTm93IGNvbnNpZGVyIGhvdyBjbG9zZSB3ZSBhcmUgdG8gY29udHJvbGxpbmcgdGhlIHJlZ2lvbiBieSBvdXJzZWx2ZXMgb3IgYSBuZWlnaGJvclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xNYXJnaW5BZnRlclBsYWNlbWVudCA9IGRlc3RpbmF0aW9uLmNvbnRyb2xsaW5nTWFyZ2luQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BRURVSV0gKyAxO1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNOZWVkZWQgPSBNYXRoLmFicyhjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpZWNlc05lZWRlZCA8PSBwaWVjZXNMZWZ0VG9UYWtlQ29udHJvbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdGl6ZWREZXN0aW5hdGlvbi5wcmlvcml0eSA9ICdiJyArIDEwICsgcGllY2VzTmVlZGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVscGluZ05laWdoYm9yID0gXy5maW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24uYWRqYWNlbnQsIGZ1bmN0aW9uIChuZWlnaGJvclRvRGVzdGluYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVpZ2hib3JUb0Rlc3RpbmF0aW9uLmlkID09PSBzdGFydFJlZ2lvbi5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5laWdoYm9yUGllY2VzID0gbmVpZ2hib3JUb0Rlc3RpbmF0aW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5laWdoYm9yTW9iaWxlUGllY2VzID0gXy5maWx0ZXIobmVpZ2hib3JQaWVjZXMsIHtpc01vYmlsZTogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bU5laWdoYm9yTW92ZWFibGVQaWVjZXMgPSBNYXRoLm1pbihuZWlnaGJvck1vYmlsZVBpZWNlcy5sZW5ndGggLSAxLCBuZWlnaGJvclRvRGVzdGluYXRpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSAtIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1OZWlnaGJvck1vdmVhYmxlUGllY2VzIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZXNOZWVkZWQgLSBudW1OZWlnaGJvck1vdmVhYmxlUGllY2VzIDw9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaGVscGluZ05laWdoYm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvckJhc2VkUHJpb3JpdHkgPSAnYycgKyAxMCArIHBpZWNlc05lZWRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWlnaGJvckJhc2VkUHJpb3JpdHkgPCBwcmlvcml0aXplZERlc3RpbmF0aW9uLnByaW9yaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdGl6ZWREZXN0aW5hdGlvbi5wcmlvcml0eSA9IG5laWdoYm9yQmFzZWRQcmlvcml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kQ29udHJvbE1hcmNoKG1vZGlmaWVycywgZmFjdGlvbiwgbWFyY2hSZXN1bHRzLCBjaG9zZW5NYXJjaCkge1xuICAgICAgICBjb25zdCBhdmFpbGFibGVSZXNvdXJjZXMgPSBmYWN0aW9uLnJlc291cmNlcygpIC0gY2hvc2VuTWFyY2guZXhwYW5zaW9uTWFyY2hDb3N0O1xuXG4gICAgICAgIGNvbnN0IGdyb3VwZWRNYXJjaGVzQnlEZXN0aW5hdGlvblByaW9yaXR5ID0gXyhtYXJjaFJlc3VsdHMpLm1hcChcbiAgICAgICAgICAgIGZ1bmN0aW9uIChtYXJjaCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2lvbiA9IG1hcmNoLnJlZ2lvbjtcblxuICAgICAgICAgICAgICAgIGlmIChtb2RpZmllcnMubGltaXRlZCAmJiByZWdpb24uaWQgIT09IGNob3Nlbk1hcmNoLmV4cGFuc2lvbk1hcmNoU3RhcnRSZWdpb24uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xNYXJjaENvc3QgPSByZWdpb24uaWQgIT09IGNob3Nlbk1hcmNoLmV4cGFuc2lvbk1hcmNoU3RhcnRSZWdpb24uaWQgPyBtYXJjaC5jb3N0IDogMDtcbiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmaWVycy5mcmVlICYmIGNvbnRyb2xNYXJjaENvc3QgPiBhdmFpbGFibGVSZXNvdXJjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2JpbGVQaWVjZXMgPSBfLmZpbHRlcihwaWVjZXMsIHtpc01vYmlsZTogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIGlmIChtb2JpbGVQaWVjZXMubGVuZ3RoID09PSAxIHx8IHJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBudW1QaWVjZXNVc2VkRm9yRXhwYW5zaW9uID0gcmVnaW9uLmlkID09PSBjaG9zZW5NYXJjaC5leHBhbnNpb25NYXJjaFN0YXJ0UmVnaW9uLmlkID8gY2hvc2VuTWFyY2guZXhwYW5zaW9uTWFyY2hSZWdpb25zLmxlbmd0aCA6IDA7XG4gICAgICAgICAgICAgICAgbGV0IG51bU1vdmVhYmxlUGllY2VzID0gbW9iaWxlUGllY2VzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBudW1Nb3ZlYWJsZVBpZWNlcyA9IE1hdGgubWluKG51bU1vdmVhYmxlUGllY2VzLCByZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBudW1Nb3ZlYWJsZVBpZWNlcyAtPSBudW1QaWVjZXNVc2VkRm9yRXhwYW5zaW9uO1xuXG4gICAgICAgICAgICAgICAgaWYgKG51bU1vdmVhYmxlUGllY2VzIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGV4cGFuc2lvblJlZ2lvbklkcyA9IF8ubWFwKGNob3Nlbk1hcmNoLmV4cGFuc2lvbk1hcmNoUmVnaW9ucywgJ2lkJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBlZERlc3RpbmF0aW9uc0J5UHJpb3JpdHkgPSBfKG1hcmNoLmRlc3RpbmF0aW9ucykubWFwKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGVzdGluYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXN0aW5hdGlvblByaW9yaXR5ID0gJ3onO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udHJvbE1hcmdpbkFmdGVyUGxhY2VtZW50ID0gZGVzdGluYXRpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoXy5pbmRleE9mKGV4cGFuc2lvblJlZ2lvbklkcywgZGVzdGluYXRpb24uaWQpID8gMSA6IDApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udHJvbE1hcmdpbkFmdGVyUGxhY2VtZW50IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNOZWVkZWQgPSBNYXRoLmFicyhjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtTW92ZWFibGVQaWVjZXMgPCBwaWVjZXNOZWVkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblByaW9yaXR5ID0gJ2EnICsgMTAgKyBwaWVjZXNOZWVkZWQgKyAnLScgKyBjb250cm9sTWFyY2hDb3N0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGRlc3RpbmF0aW9uUHJpb3JpdHlcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5yZWplY3Qoe3ByaW9yaXR5OiAneid9KS5ncm91cEJ5KCdwcmlvcml0eScpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBlZERlc3RpbmF0aW9uc0J5UHJpb3JpdHkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydGVkUHJpb3JpdGllcyA9IF8ua2V5cyhncm91cGVkRGVzdGluYXRpb25zQnlQcmlvcml0eSkuc29ydCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5R3JvdXAgPSBncm91cGVkRGVzdGluYXRpb25zQnlQcmlvcml0eVtfLmZpcnN0KHNvcnRlZFByaW9yaXRpZXMpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBjaG9zZW5EZXN0aW5hdGlvbiA9IF8uc2FtcGxlKHByaW9yaXR5R3JvdXApO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNob3NlbkRlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBjb250cm9sTWFyY2hDb3N0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGNob3NlbkRlc3RpbmF0aW9uLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGNob3NlbkRlc3RpbmF0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSZWdpb246IG1hcmNoLnJlZ2lvblxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5ncm91cEJ5KCdwcmlvcml0eScpLnZhbHVlKCk7XG5cbiAgICAgICAgaWYgKGdyb3VwZWRNYXJjaGVzQnlEZXN0aW5hdGlvblByaW9yaXR5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc29ydGVkUHJpb3JpdGllcyA9IF8ua2V5cyhncm91cGVkTWFyY2hlc0J5RGVzdGluYXRpb25Qcmlvcml0eSkuc29ydCgpO1xuICAgICAgICBjb25zdCBwcmlvcml0eUdyb3VwID0gZ3JvdXBlZE1hcmNoZXNCeURlc3RpbmF0aW9uUHJpb3JpdHlbXy5maXJzdChzb3J0ZWRQcmlvcml0aWVzKV07XG4gICAgICAgIHJldHVybiBfLnNhbXBsZShwcmlvcml0eUdyb3VwKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFlZHVpTWFyY2g7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvYWVkdWlNYXJjaC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFJQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 99 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nvar _raid = __webpack_require__(36);\n\nvar _raid2 = _interopRequireDefault(_raid);\n\nvar _aeduiTrade = __webpack_require__(39);\n\nvar _aeduiTrade2 = _interopRequireDefault(_aeduiTrade);\n\nvar _aeduiSuborn = __webpack_require__(50);\n\nvar _aeduiSuborn2 = _interopRequireDefault(_aeduiSuborn);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    RAID_COMPLETE_CHECK: 'racc'\n};\n\nvar AeduiRaid = function () {\n    function AeduiRaid() {\n        _classCallCheck(this, AeduiRaid);\n    }\n\n    _createClass(AeduiRaid, null, [{\n        key: 'raid',\n        value: function raid(state, modifiers) {\n            var aedui = state.aedui;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (!turn.getCheckpoint(Checkpoints.RAID_COMPLETE_CHECK)) {\n\n                console.log('*** Are there any effective Aedui Raids? ***');\n                var effectiveRaidRegions = this.getEffectiveRaidRegions(state, modifiers);\n                if (effectiveRaidRegions.length === 0) {\n                    return;\n                }\n\n                turn.startCommand(_commandIds2.default.RAID);\n                _lodash2.default.each(effectiveRaidRegions, function (raidResult) {\n                    console.log('*** ' + aedui.name + ' Raiding in region ' + raidResult.region.name);\n\n                    _revealPieces2.default.execute(state, {\n                        factionId: aedui.id,\n                        regionId: raidResult.region.id,\n                        count: raidResult.resourcesGained\n                    });\n\n                    var numResourcesToSteal = raidResult.resourcesGained;\n                    if (_lodash2.default.indexOf(raidResult.raidableFactions, _factionIds2.default.ARVERNI) >= 0) {\n                        var arverni = state.factionsById[_factionIds2.default.ARVERNI];\n                        var stolenFromArverni = Math.min(numResourcesToSteal, arverni.resources());\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: stolenFromArverni });\n                        numResourcesToSteal -= stolenFromArverni;\n                    } else if (_lodash2.default.indexOf(raidResult.raidableFactions, _factionIds2.default.BELGAE) >= 0) {\n                        var belgae = state.factionsById[_factionIds2.default.BELGAE];\n                        var stolenFromBelgae = Math.min(numResourcesToSteal, belgae.resources());\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: stolenFromBelgae });\n                    }\n                    _addResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: raidResult.resourcesGained });\n                });\n                turn.commitCommand();\n            }\n            turn.markCheckpoint(Checkpoints.RAID_COMPLETE_CHECK);\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_aeduiTrade2.default.trade(state, modifiers) || _aeduiSuborn2.default.suborn(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getEffectiveRaidRegions',\n        value: function getEffectiveRaidRegions(state, modifiers) {\n            var raidResults = _raid2.default.test(state, { factionId: _factionIds2.default.AEDUI });\n            var hasBaggageTrain = state.hasShadedCapability(_capabilities.CapabilityIDs.BAGGAGE_TRAINS, _factionIds2.default.AEDUI);\n\n            _lodash2.default.each(raidResults, function (result) {\n                var numHiddenWarbands = _lodash2.default.filter(result.region.piecesByFaction()[_factionIds2.default.AEDUI], function (piece) {\n                    return piece.type === 'warband' && !piece.revealed();\n                }).length;\n\n                if (numHiddenWarbands <= 1) {\n                    result.resourcesGained = 0;\n                    return;\n                }\n\n                var numRaidingWarbands = Math.min(numHiddenWarbands - 1, hasBaggageTrain ? 3 : 2);\n\n                if (!result.region.devastated()) {\n                    result.resourcesGained = numRaidingWarbands;\n                } else {\n                    var stealableResources = _lodash2.default.reduce(result.raidableFactions, function (sum, factionId) {\n                        if (factionId === _factionIds2.default.ARVERNI || factionId === _factionIds2.default.BELGAE) {\n                            var faction = state.factionsById[factionId];\n                            return sum + faction.resources();\n                        } else {\n                            return sum;\n                        }\n                    }, 0);\n                    result.resourcesGained = Math.min(numRaidingWarbands, stealableResources);\n                }\n            });\n\n            var executable = (0, _lodash2.default)(raidResults).filter(function (result) {\n                return result.resourcesGained > 0;\n            }).sortBy('resourcesGained').value();\n\n            if (modifiers.limited) {\n                executable = _lodash2.default.take(executable, 1);\n            }\n\n            var numResourcesGained = _lodash2.default.reduce(executable, function (sum, result) {\n                return sum + result.resourcesGained;\n            }, 0);\n\n            if (numResourcesGained > 2) {\n                return executable;\n            } else {\n                return [];\n            }\n        }\n    }]);\n\n    return AeduiRaid;\n}();\n\nexports.default = AeduiRaid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9hZWR1aVJhaWQuanM/Mzk5NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZXZlYWxQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZXZlYWxQaWVjZXMnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JlbW92ZVJlc291cmNlcyc7XG5pbXBvcnQgQWRkUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcbmltcG9ydCBSYWlkIGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhaWQnO1xuaW1wb3J0IEFlZHVpVHJhZGUgZnJvbSAnLi9hZWR1aVRyYWRlJztcbmltcG9ydCBBZWR1aVN1Ym9ybiBmcm9tICcuL2FlZHVpU3Vib3JuJztcbmltcG9ydCB7Q2FwYWJpbGl0eUlEc30gZnJvbSAnLi4vLi4vY29uZmlnL2NhcGFiaWxpdGllcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgUkFJRF9DT01QTEVURV9DSEVDSyA6ICdyYWNjJ1xufTtcblxuXG5jbGFzcyBBZWR1aVJhaWQge1xuICAgIHN0YXRpYyByYWlkKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3QgYWVkdWkgPSBzdGF0ZS5hZWR1aTtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG5cbiAgICAgICAgaWYoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5SQUlEX0NPTVBMRVRFX0NIRUNLKSkge1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEFyZSB0aGVyZSBhbnkgZWZmZWN0aXZlIEFlZHVpIFJhaWRzPyAqKionKTtcbiAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZVJhaWRSZWdpb25zID0gdGhpcy5nZXRFZmZlY3RpdmVSYWlkUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgICAgIGlmIChlZmZlY3RpdmVSYWlkUmVnaW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHR1cm4uc3RhcnRDb21tYW5kKENvbW1hbmRJRHMuUkFJRCk7XG4gICAgICAgICAgICBfLmVhY2goZWZmZWN0aXZlUmFpZFJlZ2lvbnMsIGZ1bmN0aW9uIChyYWlkUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKiAnICsgYWVkdWkubmFtZSArICcgUmFpZGluZyBpbiByZWdpb24gJyArIHJhaWRSZXN1bHQucmVnaW9uLm5hbWUpO1xuXG4gICAgICAgICAgICAgICAgUmV2ZWFsUGllY2VzLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBhZWR1aS5pZCxcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJhaWRSZXN1bHQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogcmFpZFJlc3VsdC5yZXNvdXJjZXNHYWluZWRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGxldCBudW1SZXNvdXJjZXNUb1N0ZWFsID0gcmFpZFJlc3VsdC5yZXNvdXJjZXNHYWluZWQ7XG4gICAgICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihyYWlkUmVzdWx0LnJhaWRhYmxlRmFjdGlvbnMsIEZhY3Rpb25JRHMuQVJWRVJOSSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnZlcm5pID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQVJWRVJOSV07XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdG9sZW5Gcm9tQXJ2ZXJuaSA9IE1hdGgubWluKG51bVJlc291cmNlc1RvU3RlYWwsIGFydmVybmkucmVzb3VyY2VzKCkpO1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLCBjb3VudDogc3RvbGVuRnJvbUFydmVybml9KTtcbiAgICAgICAgICAgICAgICAgICAgbnVtUmVzb3VyY2VzVG9TdGVhbCAtPSBzdG9sZW5Gcm9tQXJ2ZXJuaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoXy5pbmRleE9mKHJhaWRSZXN1bHQucmFpZGFibGVGYWN0aW9ucywgRmFjdGlvbklEcy5CRUxHQUUpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVsZ2FlID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQkVMR0FFXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0b2xlbkZyb21CZWxnYWUgPSBNYXRoLm1pbihudW1SZXNvdXJjZXNUb1N0ZWFsLCBiZWxnYWUucmVzb3VyY2VzKCkpO1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5CRUxHQUUsIGNvdW50OiBzdG9sZW5Gcm9tQmVsZ2FlfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEFkZFJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogcmFpZFJlc3VsdC5yZXNvdXJjZXNHYWluZWR9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdHVybi5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5SQUlEX0NPTVBMRVRFX0NIRUNLKTtcbiAgICAgICAgY29uc3QgdXNlZFNwZWNpYWxBYmlsaXR5ID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmIChBZWR1aVRyYWRlLnRyYWRlKHN0YXRlLCBtb2RpZmllcnMpIHx8IEFlZHVpU3Vib3JuLnN1Ym9ybihzdGF0ZSwgbW9kaWZpZXJzKSk7XG4gICAgICAgIHJldHVybiB1c2VkU3BlY2lhbEFiaWxpdHkgPyBGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMIDogRmFjdGlvbkFjdGlvbnMuQ09NTUFORDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RWZmZWN0aXZlUmFpZFJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCByYWlkUmVzdWx0cyA9IFJhaWQudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSX0pO1xuICAgICAgICBjb25zdCBoYXNCYWdnYWdlVHJhaW4gPSBzdGF0ZS5oYXNTaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFHR0FHRV9UUkFJTlMsIEZhY3Rpb25JRHMuQUVEVUkpO1xuXG4gICAgICAgIF8uZWFjaChyYWlkUmVzdWx0cywgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgY29uc3QgbnVtSGlkZGVuV2FyYmFuZHMgPSBfLmZpbHRlcihyZXN1bHQucmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ3dhcmJhbmQnICYmICFwaWVjZS5yZXZlYWxlZCgpO1xuICAgICAgICAgICAgfSkubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZihudW1IaWRkZW5XYXJiYW5kcyA8PSAxKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlc291cmNlc0dhaW5lZCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBudW1SYWlkaW5nV2FyYmFuZHMgPSBNYXRoLm1pbihudW1IaWRkZW5XYXJiYW5kcy0xLCBoYXNCYWdnYWdlVHJhaW4gPyAzIDogMik7XG5cbiAgICAgICAgICAgIGlmKCFyZXN1bHQucmVnaW9uLmRldmFzdGF0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5yZXNvdXJjZXNHYWluZWQgPSBudW1SYWlkaW5nV2FyYmFuZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGVhbGFibGVSZXNvdXJjZXMgPSBfLnJlZHVjZShyZXN1bHQucmFpZGFibGVGYWN0aW9ucywgZnVuY3Rpb24oc3VtLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFSVkVSTkkgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtmYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIGZhY3Rpb24ucmVzb3VyY2VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlc291cmNlc0dhaW5lZCA9IE1hdGgubWluKG51bVJhaWRpbmdXYXJiYW5kcywgc3RlYWxhYmxlUmVzb3VyY2VzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGV4ZWN1dGFibGUgPSBfKHJhaWRSZXN1bHRzKS5maWx0ZXIoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQucmVzb3VyY2VzR2FpbmVkID4gMDtcbiAgICAgICAgICAgIH0pLnNvcnRCeSgncmVzb3VyY2VzR2FpbmVkJykudmFsdWUoKTtcblxuICAgICAgICBpZihtb2RpZmllcnMubGltaXRlZCkge1xuICAgICAgICAgICAgZXhlY3V0YWJsZSA9IF8udGFrZShleGVjdXRhYmxlLCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG51bVJlc291cmNlc0dhaW5lZCA9IF8ucmVkdWNlKFxuICAgICAgICAgICAgZXhlY3V0YWJsZSwgZnVuY3Rpb24gKHN1bSwgcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHJlc3VsdC5yZXNvdXJjZXNHYWluZWQ7XG4gICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICBpZiAobnVtUmVzb3VyY2VzR2FpbmVkID4gMikge1xuICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGFibGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWVkdWlSYWlkO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2FlZHVpUmFpZC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBSUE7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 100 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _aeduiTrade = __webpack_require__(39);\n\nvar _aeduiTrade2 = _interopRequireDefault(_aeduiTrade);\n\nvar _aeduiSuborn = __webpack_require__(50);\n\nvar _aeduiSuborn2 = _interopRequireDefault(_aeduiSuborn);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    RALLY_COMPLETE_CHECK: 'rcc'\n};\n\nvar AeduiRally = function () {\n    function AeduiRally() {\n        _classCallCheck(this, AeduiRally);\n    }\n\n    _createClass(AeduiRally, null, [{\n        key: 'rally',\n        value: function rally(state, modifiers) {\n            var aeduiFaction = state.aedui;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (!turn.getCheckpoint(Checkpoints.RALLY_COMPLETE_CHECK)) {\n                console.log('*** Are there any effective Aedui Rallies? ***');\n                var executableRallyRegions = AeduiRally.getExecutableRallyRegions(state, modifiers, aeduiFaction);\n                if ((aeduiFaction.availableWarbands() <= 10 || executableRallyRegions.length === 0) && !this.isRallyEffective(state, executableRallyRegions)) {\n                    return false;\n                }\n                turn.startCommand(_commandIds2.default.RALLY);\n                _lodash2.default.each(executableRallyRegions, function (rallyRegion) {\n                    if (!modifiers.free && rallyRegion.cost > 0) {\n                        _removeResources2.default.execute(state, { factionId: aeduiFaction.id, count: rallyRegion.cost });\n                    }\n                    _rally2.default.execute(state, { faction: aeduiFaction, regionResult: rallyRegion });\n                });\n\n                turn.commitCommand();\n            }\n\n            turn.markCheckpoint(Checkpoints.RALLY_COMPLETE_CHECK);\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_aeduiTrade2.default.trade(state, modifiers) || _aeduiSuborn2.default.suborn(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getCitadelRegions',\n        value: function getCitadelRegions(state, modifiers) {\n            var rallyRegionResults = _rally2.default.test(state, { factionId: _factionIds2.default.AEDUI });\n            var citadelRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddCitadel: true }).shuffle().value();\n            _lodash2.default.each(citadelRegions, function (regionResult) {\n                regionResult.addCitadel = true;\n            });\n            return _lodash2.default.take(citadelRegions, state.aedui.availableCitadels().length);\n        }\n    }, {\n        key: 'getAllyRegions',\n        value: function getAllyRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.AEDUI,\n                regions: regions\n            });\n            var allyRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddAlly: true }).shuffle().value();\n            _lodash2.default.each(allyRegions, function (regionResult) {\n                regionResult.addAlly = true;\n            });\n            return _lodash2.default.take(allyRegions, state.aedui.availableAlliedTribes().length);\n        }\n    }, {\n        key: 'getWarbandRegions',\n        value: function getWarbandRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _lodash2.default.shuffle(_rally2.default.test(state, {\n                factionId: _factionIds2.default.AEDUI,\n                regions: regions\n            }));\n\n            var warbandsRemaining = state.aedui.availableWarbands().length;\n            _lodash2.default.each(rallyRegionResults, function (regionResult) {\n                regionResult.addNumWarbands = Math.min(regionResult.canAddNumWarbands, warbandsRemaining);\n                warbandsRemaining -= regionResult.addNumWarbands;\n                if (warbandsRemaining === 0) {\n                    return false;\n                }\n            });\n\n            return (0, _lodash2.default)(rallyRegionResults).filter(function (result) {\n                return result.addNumWarbands > 0;\n            }).shuffle().value();\n        }\n    }, {\n        key: 'isRallyEffective',\n        value: function isRallyEffective(state, executableRallyRegions) {\n            var aedui = state.aedui;\n            var citadelAdded = false;\n            var allyAdded = false;\n            var numPiecesAdded = 0;\n            var numWarbandsAdded = 0;\n            _lodash2.default.each(executableRallyRegions, function (regionResult) {\n                if (regionResult.addCitadel && aedui.availableCitadels().length > 0) {\n                    citadelAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                if (regionResult.addAlly && aedui.availableAlliedTribes().length > 0) {\n                    allyAdded = true;\n                    numPiecesAdded += 1;\n                    return false;\n                }\n\n                numWarbandsAdded += regionResult.addNumWarbands;\n                if (numPiecesAdded >= 3) {\n                    return false;\n                }\n            });\n\n            numPiecesAdded += Math.min(numWarbandsAdded, aedui.availableWarbands().length);\n            return citadelAdded || allyAdded || numPiecesAdded >= 3;\n        }\n    }, {\n        key: 'getExecutableRallyRegions',\n        value: function getExecutableRallyRegions(state, modifiers) {\n            var ralliedRegions = [];\n            var citadelRegions = this.getCitadelRegions(state, modifiers);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(citadelRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var allyRegions = this.getAllyRegions(state, modifiers, ralliedRegions);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(allyRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var warbandRegions = this.getWarbandRegions(state, modifiers, ralliedRegions);\n\n            var allRegions = (0, _lodash2.default)(citadelRegions).concat(allyRegions).concat(warbandRegions).value();\n            var affordableRegions = modifiers.free ? allRegions : _lodash2.default.reduce(allRegions, function (accumulator, rallyRegion) {\n                if (accumulator.resourcesRemaining >= rallyRegion.cost) {\n                    accumulator.resourcesRemaining -= rallyRegion.cost;\n                    accumulator.rallies.push(rallyRegion);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.aedui.resources(), rallies: [] }).rallies;\n\n            return modifiers.limited ? _lodash2.default.take(affordableRegions, 1) : affordableRegions;\n        }\n    }]);\n\n    return AeduiRally;\n}();\n\nexports.default = AeduiRally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvYWVkdWlSYWxseS5qcz81ZGNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJhbGx5IGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhbGx5JztcbmltcG9ydCBBZWR1aVRyYWRlIGZyb20gJy4vYWVkdWlUcmFkZSc7XG5pbXBvcnQgQWVkdWlTdWJvcm4gZnJvbSAnLi9hZWR1aVN1Ym9ybic7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnXG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgUkFMTFlfQ09NUExFVEVfQ0hFQ0s6ICdyY2MnXG59O1xuXG5jbGFzcyBBZWR1aVJhbGx5IHtcbiAgICBzdGF0aWMgcmFsbHkoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5hZWR1aTtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG5cbiAgICAgICAgaWYgKCF0dXJuLmdldENoZWNrcG9pbnQoQ2hlY2twb2ludHMuUkFMTFlfQ09NUExFVEVfQ0hFQ0spKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEFyZSB0aGVyZSBhbnkgZWZmZWN0aXZlIEFlZHVpIFJhbGxpZXM/ICoqKicpO1xuICAgICAgICAgICAgY29uc3QgZXhlY3V0YWJsZVJhbGx5UmVnaW9ucyA9IEFlZHVpUmFsbHkuZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzLCBhZWR1aUZhY3Rpb24pO1xuICAgICAgICAgICAgaWYgKChhZWR1aUZhY3Rpb24uYXZhaWxhYmxlV2FyYmFuZHMoKSA8PSAxMCB8fCBleGVjdXRhYmxlUmFsbHlSZWdpb25zLmxlbmd0aCA9PT0gMCkgJiYgIXRoaXMuaXNSYWxseUVmZmVjdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHVybi5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5SQUxMWSk7XG4gICAgICAgICAgICBfLmVhY2goZXhlY3V0YWJsZVJhbGx5UmVnaW9ucywgKHJhbGx5UmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSAmJiByYWxseVJlZ2lvbi5jb3N0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogYWVkdWlGYWN0aW9uLmlkLCBjb3VudDogcmFsbHlSZWdpb24uY29zdH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBSYWxseS5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbjogYWVkdWlGYWN0aW9uLCByZWdpb25SZXN1bHQ6IHJhbGx5UmVnaW9ufSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdHVybi5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlJBTExZX0NPTVBMRVRFX0NIRUNLKTtcbiAgICAgICAgY29uc3QgdXNlZFNwZWNpYWxBYmlsaXR5ID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmIChBZWR1aVRyYWRlLnRyYWRlKHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJzKSB8fCBBZWR1aVN1Ym9ybi5zdWJvcm4oc3RhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRDaXRhZGVsUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGx5UmVnaW9uUmVzdWx0cyA9IFJhbGx5LnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQUVEVUl9KTtcbiAgICAgICAgY29uc3QgY2l0YWRlbFJlZ2lvbnMgPSBfKHJhbGx5UmVnaW9uUmVzdWx0cykuZmlsdGVyKHtjYW5BZGRDaXRhZGVsOiB0cnVlfSkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgICAgIF8uZWFjaChjaXRhZGVsUmVnaW9ucywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZENpdGFkZWwgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShjaXRhZGVsUmVnaW9ucywgc3RhdGUuYWVkdWkuYXZhaWxhYmxlQ2l0YWRlbHMoKS5sZW5ndGgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRBbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzLCByYWxsaWVkUmVnaW9uSWRzKSB7XG4gICAgICAgIGNvbnN0IHJlZ2lvbnMgPSBfLmZpbHRlcihzdGF0ZS5yZWdpb25zLCByZWdpb24gPT4gXy5pbmRleE9mKHJhbGxpZWRSZWdpb25JZHMsIHJlZ2lvbi5pZCkgPCAwKTtcbiAgICAgICAgY29uc3QgcmFsbHlSZWdpb25SZXN1bHRzID0gUmFsbHkudGVzdChzdGF0ZSwge1xuICAgICAgICAgICAgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLFxuICAgICAgICAgICAgcmVnaW9uczogcmVnaW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWxseVJlZ2lvbnMgPSBfKHJhbGx5UmVnaW9uUmVzdWx0cykuZmlsdGVyKHtjYW5BZGRBbGx5OiB0cnVlfSkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgICAgIF8uZWFjaChhbGx5UmVnaW9ucywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZEFsbHkgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShhbGx5UmVnaW9ucywgc3RhdGUuYWVkdWkuYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0V2FyYmFuZFJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgcmFsbGllZFJlZ2lvbklkcykge1xuICAgICAgICBjb25zdCByZWdpb25zID0gXy5maWx0ZXIoc3RhdGUucmVnaW9ucywgcmVnaW9uID0+IF8uaW5kZXhPZihyYWxsaWVkUmVnaW9uSWRzLCByZWdpb24uaWQpIDwgMCk7XG4gICAgICAgIGNvbnN0IHJhbGx5UmVnaW9uUmVzdWx0cyA9IF8uc2h1ZmZsZShSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQUVEVUksXG4gICAgICAgICAgICByZWdpb25zOiByZWdpb25zXG4gICAgICAgIH0pKTtcblxuICAgICAgICBsZXQgd2FyYmFuZHNSZW1haW5pbmcgPSBzdGF0ZS5hZWR1aS5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aDtcbiAgICAgICAgXy5lYWNoKHJhbGx5UmVnaW9uUmVzdWx0cywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZE51bVdhcmJhbmRzID0gTWF0aC5taW4ocmVnaW9uUmVzdWx0LmNhbkFkZE51bVdhcmJhbmRzLCB3YXJiYW5kc1JlbWFpbmluZyk7XG4gICAgICAgICAgICB3YXJiYW5kc1JlbWFpbmluZyAtPSByZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHM7XG4gICAgICAgICAgICBpZih3YXJiYW5kc1JlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIF8ocmFsbHlSZWdpb25SZXN1bHRzKS5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5hZGROdW1XYXJiYW5kcyA+IDApLnNodWZmbGUoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc1JhbGx5RWZmZWN0aXZlKHN0YXRlLCBleGVjdXRhYmxlUmFsbHlSZWdpb25zKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpID0gc3RhdGUuYWVkdWk7XG4gICAgICAgIGxldCBjaXRhZGVsQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGFsbHlBZGRlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgbnVtUGllY2VzQWRkZWQgPSAwO1xuICAgICAgICBsZXQgbnVtV2FyYmFuZHNBZGRlZCA9IDA7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb25SZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVnaW9uUmVzdWx0LmFkZENpdGFkZWwgJiYgYWVkdWkuYXZhaWxhYmxlQ2l0YWRlbHMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNpdGFkZWxBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIG51bVBpZWNlc0FkZGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocmVnaW9uUmVzdWx0LmFkZEFsbHkgJiYgYWVkdWkuYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBhbGx5QWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBudW1QaWVjZXNBZGRlZCArPSAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbnVtV2FyYmFuZHNBZGRlZCArPSByZWdpb25SZXN1bHQuYWRkTnVtV2FyYmFuZHM7XG4gICAgICAgICAgICAgICAgaWYgKG51bVBpZWNlc0FkZGVkID49IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG51bVBpZWNlc0FkZGVkICs9IE1hdGgubWluKG51bVdhcmJhbmRzQWRkZWQsIGFlZHVpLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIGNpdGFkZWxBZGRlZCB8fCBhbGx5QWRkZWQgfHwgbnVtUGllY2VzQWRkZWQgPj0gMztcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGxpZWRSZWdpb25zID0gW107XG4gICAgICAgIGNvbnN0IGNpdGFkZWxSZWdpb25zID0gdGhpcy5nZXRDaXRhZGVsUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgcmFsbGllZFJlZ2lvbnMucHVzaC5hcHBseShyYWxsaWVkUmVnaW9ucywgXy5tYXAoY2l0YWRlbFJlZ2lvbnMsIHJhbGx5UmVnaW9uID0+IHJhbGx5UmVnaW9uLnJlZ2lvbi5pZCkpO1xuICAgICAgICBjb25zdCBhbGx5UmVnaW9ucyA9IHRoaXMuZ2V0QWxseVJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgcmFsbGllZFJlZ2lvbnMpO1xuICAgICAgICByYWxsaWVkUmVnaW9ucy5wdXNoLmFwcGx5KHJhbGxpZWRSZWdpb25zLCBfLm1hcChhbGx5UmVnaW9ucywgcmFsbHlSZWdpb24gPT4gcmFsbHlSZWdpb24ucmVnaW9uLmlkKSk7XG4gICAgICAgIGNvbnN0IHdhcmJhbmRSZWdpb25zID0gdGhpcy5nZXRXYXJiYW5kUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzLCByYWxsaWVkUmVnaW9ucyk7XG5cbiAgICAgICAgY29uc3QgYWxsUmVnaW9ucyA9IF8oY2l0YWRlbFJlZ2lvbnMpLmNvbmNhdChhbGx5UmVnaW9ucykuY29uY2F0KHdhcmJhbmRSZWdpb25zKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCBhZmZvcmRhYmxlUmVnaW9ucyA9IG1vZGlmaWVycy5mcmVlID8gYWxsUmVnaW9ucyA6IF8ucmVkdWNlKGFsbFJlZ2lvbnMsIChhY2N1bXVsYXRvciwgcmFsbHlSZWdpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgPj0gcmFsbHlSZWdpb24uY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSByYWxseVJlZ2lvbi5jb3N0O1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJhbGxpZXMucHVzaChyYWxseVJlZ2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3JcbiAgICAgICAgfSwge3Jlc291cmNlc1JlbWFpbmluZzogc3RhdGUuYWVkdWkucmVzb3VyY2VzKCksIHJhbGxpZXM6IFtdfSkucmFsbGllcztcblxuICAgICAgICByZXR1cm4gbW9kaWZpZXJzLmxpbWl0ZWQgPyBfLnRha2UoYWZmb3JkYWJsZVJlZ2lvbnMsIDEpIDogYWZmb3JkYWJsZVJlZ2lvbnM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBZWR1aVJhbGx5XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvYWVkdWlSYWxseS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFHQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 101 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event10 = function () {\n    function Event10() {\n        _classCallCheck(this, Event10);\n    }\n\n    _createClass(Event10, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.BALLISTAE,\n                state: _capabilities.CapabilityStates.SHADED,\n                factionId: _factionIds2.default.AEDUI\n            });\n            return true;\n        }\n    }]);\n\n    return Event10;\n}();\n\nexports.default = Event10;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MTAuanM/YWMxYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQxMCB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5CQUxMSVNUQUUsXG4gICAgICAgICAgICAgICAgc3RhdGU6IENhcGFiaWxpdHlTdGF0ZXMuU0hBREVELFxuICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQxMFxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MTAuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTtBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 102 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event12 = function () {\n    function Event12() {\n        _classCallCheck(this, Event12);\n    }\n\n    _createClass(Event12, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.TITUS_LABIENUS,\n                state: _capabilities.CapabilityStates.UNSHADED\n            });\n            return true;\n        }\n    }]);\n\n    return Event12;\n}();\n\nexports.default = Event12;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MTIuanM/ZDI3NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQxMiB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG5cbiAgICAgICAgQWRkQ2FwYWJpbGl0eS5leGVjdXRlKHN0YXRlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBDYXBhYmlsaXR5SURzLlRJVFVTX0xBQklFTlVTLFxuICAgICAgICAgICAgICAgIHN0YXRlOiBDYXBhYmlsaXR5U3RhdGVzLlVOU0hBREVEXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDEyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQxMi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBSUE7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 103 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event15 = function () {\n    function Event15() {\n        _classCallCheck(this, Event15);\n    }\n\n    _createClass(Event15, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.LEGIO_X,\n                state: _capabilities.CapabilityStates.UNSHADED\n            });\n            return true;\n        }\n    }]);\n\n    return Event15;\n}();\n\nexports.default = Event15;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MTUuanM/NjEzMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQxNSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5MRUdJT19YLFxuICAgICAgICAgICAgICAgIHN0YXRlOiBDYXBhYmlsaXR5U3RhdGVzLlVOU0hBREVEXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDE1XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MTUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTtBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 104 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _enemyFactionPriority = __webpack_require__(34);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event22 = function () {\n    function Event22() {\n        _classCallCheck(this, Event22);\n    }\n\n    _createClass(Event22, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var groupedRegions = (0, _lodash2.default)(state.regions).filter(function (region) {\n                if (region.controllingFactionId() !== _factionIds2.default.AEDUI) {\n                    return false;\n                }\n            }).map(function (region) {\n                var priority = 'z';\n                var factionId = '';\n                var pieces = null;\n                _lodash2.default.each(_enemyFactionPriority2.default, function (enemyPriority, enemyFactionId) {\n                    var warbandsOrAuxilia = _lodash2.default.filter(region.piecesByFaction()[enemyFactionId], function (piece) {\n                        return piece.type === 'warband' || piece.type === 'auxilia';\n                    });\n\n                    if (warbandsOrAuxilia.length === 0) {\n                        return;\n                    }\n                    var numToRemoveOrReplace = Math.min(warbandsOrAuxilia.length, 4);\n                    var factionPriority = 'a' + enemyPriority + '-' + (99 - numToRemoveOrReplace);\n                    if (factionPriority < priority) {\n                        priority = factionPriority;\n                        pieces = _lodash2.default.take(warbandsOrAuxilia, numToRemoveOrReplace);\n                        factionId = enemyFactionId;\n                    }\n                });\n                return {\n                    region: region,\n                    pieces: pieces,\n                    factionId: factionId,\n                    priority: priority\n                };\n            }).compact().reject({ priority: 'z' }).groupBy('priority').value();\n\n            var sortedPriorities = _lodash2.default.keys(groupedRegions).sort();\n            if (sortedPriorities.length === 0) {\n                return false;\n            }\n\n            var priorityGroup = groupedRegions[_lodash2.default.first(sortedPriorities)];\n            var chosen = _lodash2.default.sample(priorityGroup);\n\n            _removePieces2.default.execute(state, {\n                regionId: chosen.region.id,\n                factionId: chosen.faction.id,\n                pieces: chosen.pieces\n            });\n\n            var aedui = state.factionsById[_factionIds2.default.AEDUI];\n            var numWarbandsToPlace = Math.min(aedui.availableWarbands(), chosen.pieces.length);\n            if (numWarbandsToPlace) {\n                (0, _placeWarbands2.default)(state, {\n                    region: chosen.region,\n                    faction: aedui,\n                    count: numWarbandsToPlace\n                });\n            }\n\n            return true;\n        }\n    }]);\n\n    return Event22;\n}();\n\nexports.default = Event22;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjIuanM/ZTZiOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICcuLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBQbGFjZVdhcmJhbmRzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcGxhY2VXYXJiYW5kcyc7XG5cbmNsYXNzIEV2ZW50MjIge1xuXG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGdyb3VwZWRSZWdpb25zID0gXyhzdGF0ZS5yZWdpb25zKS5maWx0ZXIoXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpICE9PSBGYWN0aW9uSURzLkFFRFVJKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5tYXAoXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgbGV0IHByaW9yaXR5ID0gJ3onO1xuICAgICAgICAgICAgICAgIGxldCBmYWN0aW9uSWQgPSAnJztcbiAgICAgICAgICAgICAgICBsZXQgcGllY2VzID0gbnVsbDtcbiAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICAgIEVuZW15RmFjdGlvblByaW9yaXR5LCBmdW5jdGlvbiAoZW5lbXlQcmlvcml0eSwgZW5lbXlGYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhcmJhbmRzT3JBdXhpbGlhID0gXy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2VuZW15RmFjdGlvbklkXSwgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgfHwgcGllY2UudHlwZSA9PT0gJ2F1eGlsaWEnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2FyYmFuZHNPckF1eGlsaWEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtVG9SZW1vdmVPclJlcGxhY2UgPSBNYXRoLm1pbih3YXJiYW5kc09yQXV4aWxpYS5sZW5ndGgsIDQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvblByaW9yaXR5ID0gJ2EnICsgZW5lbXlQcmlvcml0eSArICctJyArICg5OSAtIG51bVRvUmVtb3ZlT3JSZXBsYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uUHJpb3JpdHkgPCBwcmlvcml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gZmFjdGlvblByaW9yaXR5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlcyA9IF8udGFrZSh3YXJiYW5kc09yQXV4aWxpYSwgbnVtVG9SZW1vdmVPclJlcGxhY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZCA9IGVuZW15RmFjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBwaWVjZXMsXG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogcHJpb3JpdHlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnJlamVjdCh7cHJpb3JpdHk6ICd6J30pLmdyb3VwQnkoJ3ByaW9yaXR5JykudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBzb3J0ZWRQcmlvcml0aWVzID0gXy5rZXlzKGdyb3VwZWRSZWdpb25zKS5zb3J0KCk7XG4gICAgICAgIGlmIChzb3J0ZWRQcmlvcml0aWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJpb3JpdHlHcm91cCA9IGdyb3VwZWRSZWdpb25zW18uZmlyc3Qoc29ydGVkUHJpb3JpdGllcyldO1xuICAgICAgICBjb25zdCBjaG9zZW4gPSBfLnNhbXBsZShwcmlvcml0eUdyb3VwKTtcblxuICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgcmVnaW9uSWQ6IGNob3Nlbi5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkOiBjaG9zZW4uZmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBwaWVjZXM6IGNob3Nlbi5waWVjZXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGFlZHVpID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICBjb25zdCBudW1XYXJiYW5kc1RvUGxhY2UgPSBNYXRoLm1pbihhZWR1aS5hdmFpbGFibGVXYXJiYW5kcygpLCBjaG9zZW4ucGllY2VzLmxlbmd0aCk7XG4gICAgICAgIGlmIChudW1XYXJiYW5kc1RvUGxhY2UpIHtcbiAgICAgICAgICAgIFBsYWNlV2FyYmFuZHMoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBjaG9zZW4ucmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uOiBhZWR1aSxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IG51bVdhcmJhbmRzVG9QbGFjZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDIyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjIuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 105 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event24 = function () {\n    function Event24() {\n        _classCallCheck(this, Event24);\n    }\n\n    _createClass(Event24, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var arverniPlayer = state.playersByFaction[_factionIds2.default.ARVERNI];\n            var arverni = state.factionsById[_factionIds2.default.ARVERNI];\n            if (!arverniPlayer.isNonPlayer && arverni.hasPlacedCitadel() && arverni.resources() > 0) {\n                _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: 10 });\n                return true;\n            }\n            var belgaePlayer = state.playersByFaction[_factionIds2.default.BELGAE];\n            var belgae = state.factionsById[_factionIds2.default.ARVERNI];\n            if (!belgaePlayer.isNonPlayer && belgae.hasPlacedCitadel() && v.resources() > 0) {\n                _removeResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: 10 });\n                return true;\n            }\n\n            return false;\n        }\n    }]);\n\n    return Event24;\n}();\n\nexports.default = Event24;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjQuanM/ZGRlYSJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuXG5jbGFzcyBFdmVudDI0IHtcbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkFSVkVSTkldO1xuICAgICAgICBpZiAoIWFydmVybmlQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYXJ2ZXJuaS5oYXNQbGFjZWRDaXRhZGVsKCkgJiYgYXJ2ZXJuaS5yZXNvdXJjZXMoKSA+IDApIHtcbiAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLCBjb3VudDogMTB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJlbGdhZVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5CRUxHQUVdO1xuICAgICAgICBjb25zdCBiZWxnYWUgPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgaWYgKCFiZWxnYWVQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYmVsZ2FlLmhhc1BsYWNlZENpdGFkZWwoKSAmJiB2LnJlc291cmNlcygpID4gMCkge1xuICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRSwgY291bnQ6IDEwfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50MjQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQyNC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 106 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event25 = function () {\n    function Event25() {\n        _classCallCheck(this, Event25);\n    }\n\n    _createClass(Event25, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.AQUITANI,\n                state: _capabilities.CapabilityStates.SHADED,\n                factionId: _factionIds2.default.AEDUI\n            });\n            return true;\n        }\n    }]);\n\n    return Event25;\n}();\n\nexports.default = Event25;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjUuanM/OGY2MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQyNSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5BUVVJVEFOSSxcbiAgICAgICAgICAgICAgICBzdGF0ZTogQ2FwYWJpbGl0eVN0YXRlcy5TSEFERUQsXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDI1XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQyNS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 107 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _placeCitadel = __webpack_require__(33);\n\nvar _placeCitadel2 = _interopRequireDefault(_placeCitadel);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event26 = function () {\n    function Event26() {\n        _classCallCheck(this, Event26);\n    }\n\n    _createClass(Event26, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var gergovia = state.tribesById[_tribeIds2.default.ARVERNI];\n            var arverniRegion = state.regionsById[_regionIds2.default.ARVERNI];\n            var aedui = state.factionsById[_factionIds2.default.AEDUI];\n\n            var enemyAllyOrCitadel = gergovia.alliedFactionId() && gergovia.alliedFactionId() !== _factionIds2.default.AEDUI;\n            var canPlaceAllyOrCitadel = aedui.hasAvailableCitadel() || aedui.hasAvailableAlliedTribe();\n\n            if (enemyAllyOrCitadel || canPlaceAllyOrCitadel) {\n                console.log('*** Playing Gobannitio ***');\n                var enemyPiece = _lodash2.default.find(arverniRegion.pieces(), function (piece) {\n                    return (piece.type === 'alliedtribe' || piece.type === 'citadel') && piece.tribeId === _tribeIds2.default.ARVERNI;\n                });\n\n                if (enemyPiece) {\n                    _removePieces2.default.execute(state, {\n                        factionId: enemyPiece.factionId,\n                        regionId: arverniRegion.id,\n                        pieces: [enemyPiece]\n                    });\n                }\n\n                if (aedui.hasAvailableCitadel()) {\n                    _placeCitadel2.default.execute(state, { factionId: aedui.id, regionId: arverniRegion.id, tribeId: gergovia.id }, true);\n                } else if (aedui.hasAvailableAlliedTribe()) {\n                    _placeAlliedTribe2.default.execute(state, { factionId: aedui.id, regionId: arverniRegion.id, tribeId: gergovia.id }, true);\n                }\n                return true;\n            }\n            return false;\n        }\n    }]);\n\n    return Event26;\n}();\n\nexports.default = Event26;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjYuanM/NzRmZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vLi4vLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgVHJpYmVJRHMgZnJvbSAnLi4vLi4vLi4vY29uZmlnL3RyaWJlSWRzJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuaW1wb3J0IFBsYWNlQ2l0YWRlbCBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3BsYWNlQ2l0YWRlbCc7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuXG5cbmNsYXNzIEV2ZW50MjYge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBjb25zdCBnZXJnb3ZpYSA9IHN0YXRlLnRyaWJlc0J5SWRbVHJpYmVJRHMuQVJWRVJOSV07XG4gICAgICAgIGNvbnN0IGFydmVybmlSZWdpb24gPSBzdGF0ZS5yZWdpb25zQnlJZFtSZWdpb25JRHMuQVJWRVJOSV07XG4gICAgICAgIGNvbnN0IGFlZHVpID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQUVEVUldO1xuXG4gICAgICAgIGNvbnN0IGVuZW15QWxseU9yQ2l0YWRlbCA9IGdlcmdvdmlhLmFsbGllZEZhY3Rpb25JZCgpICYmIGdlcmdvdmlhLmFsbGllZEZhY3Rpb25JZCgpICE9PSBGYWN0aW9uSURzLkFFRFVJO1xuICAgICAgICBjb25zdCBjYW5QbGFjZUFsbHlPckNpdGFkZWwgPSBhZWR1aS5oYXNBdmFpbGFibGVDaXRhZGVsKCkgfHwgYWVkdWkuaGFzQXZhaWxhYmxlQWxsaWVkVHJpYmUoKTtcblxuICAgICAgICBpZiAoZW5lbXlBbGx5T3JDaXRhZGVsIHx8IGNhblBsYWNlQWxseU9yQ2l0YWRlbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKiBQbGF5aW5nIEdvYmFubml0aW8gKioqJyk7XG4gICAgICAgICAgICBjb25zdCBlbmVteVBpZWNlID0gXy5maW5kKFxuICAgICAgICAgICAgICAgIGFydmVybmlSZWdpb24ucGllY2VzKCksIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2NpdGFkZWwnKSAmJiBwaWVjZS50cmliZUlkID09PSBUcmliZUlEcy5BUlZFUk5JO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoZW5lbXlQaWVjZSkge1xuICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBlbmVteVBpZWNlLmZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBhcnZlcm5pUmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBbZW5lbXlQaWVjZV1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhZWR1aS5oYXNBdmFpbGFibGVDaXRhZGVsKCkpIHtcbiAgICAgICAgICAgICAgICBQbGFjZUNpdGFkZWwuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogYWVkdWkuaWQsIHJlZ2lvbklkOiBhcnZlcm5pUmVnaW9uLmlkLCB0cmliZUlkOiBnZXJnb3ZpYS5pZH0sIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWVkdWkuaGFzQXZhaWxhYmxlQWxsaWVkVHJpYmUoKSkge1xuICAgICAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogYWVkdWkuaWQsIHJlZ2lvbklkOiBhcnZlcm5pUmVnaW9uLmlkLCB0cmliZUlkOiBnZXJnb3ZpYS5pZH0sIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQyNjtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2V2ZW50cy9ldmVudDI2LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFFQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 108 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event27 = function () {\n    function Event27() {\n        _classCallCheck(this, Event27);\n    }\n\n    _createClass(Event27, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.MASSED_GALLIC_ARCHERS,\n                state: _capabilities.CapabilityStates.UNSHADED\n            });\n            return true;\n        }\n    }]);\n\n    return Event27;\n}();\n\nexports.default = Event27;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjcuanM/NjZkNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQyNyB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5NQVNTRURfR0FMTElDX0FSQ0hFUlMsXG4gICAgICAgICAgICAgICAgc3RhdGU6IENhcGFiaWxpdHlTdGF0ZXMuVU5TSEFERURcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50MjdcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2V2ZW50cy9ldmVudDI3LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBSUE7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 109 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _placeCitadel = __webpack_require__(33);\n\nvar _placeCitadel2 = _interopRequireDefault(_placeCitadel);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event28 = function () {\n    function Event28() {\n        _classCallCheck(this, Event28);\n    }\n\n    _createClass(Event28, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aedui = state.factionsById[_factionIds2.default.AEDUI];\n            var canPlaceAllyOrCitadel = aedui.hasAvailableCitadel() || aedui.hasAvailableAlliedTribe();\n            if (!canPlaceAllyOrCitadel) {\n                return false;\n            }\n\n            var effective = false;\n            if (aedui.hasAvailableAlliedTribe()) {\n                var subduedCitiesNotRomanControlled = (0, _lodash2.default)(state.regions).filter(function (region) {\n                    return region.controllingFactionId() !== _factionIds2.default.ROMANS;\n                }).map(function (region) {\n                    return _lodash2.default.find(region.tribes, function (tribe) {\n                        return tribe.isSubdued() && tribe.isCity;\n                    });\n                }).compact().sampleSize(aedui.availableAlliedTribes().length).value();\n\n                _lodash2.default.each(subduedCitiesNotRomanControlled, function (city) {\n                    _placeAlliedTribe2.default.execute(state, { factionId: aedui.id, regionId: city.regionId, tribeId: city.id });\n                });\n                effective = true;\n            }\n\n            if (aedui.hasAvailableCitadel()) {\n                var aeduiAlliedCities = (0, _lodash2.default)(state.tribes).filter(function (tribe) {\n                    return tribe.isCity && tribe.isAllied() && tribe.alliedFactionId() === _factionIds2.default.AEDUI;\n                }).sampleSize(aedui.availableCitadels().length).value();\n\n                _lodash2.default.each(aeduiAlliedCities, function (city) {\n                    _placeCitadel2.default.execute(state, { factionId: aedui.id, regionId: city.regionId, tribeId: city.id });\n                });\n                effective = true;\n            }\n\n            return effective;\n        }\n    }]);\n\n    return Event28;\n}();\n\nexports.default = Event28;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjguanM/Yzc0NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBQbGFjZUNpdGFkZWwgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9wbGFjZUNpdGFkZWwnO1xuaW1wb3J0IFBsYWNlQWxsaWVkVHJpYmUgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9wbGFjZUFsbGllZFRyaWJlJztcblxuXG5jbGFzcyBFdmVudDI4IHtcbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgYWVkdWkgPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IGNhblBsYWNlQWxseU9yQ2l0YWRlbCA9IGFlZHVpLmhhc0F2YWlsYWJsZUNpdGFkZWwoKSB8fCBhZWR1aS5oYXNBdmFpbGFibGVBbGxpZWRUcmliZSgpO1xuICAgICAgICBpZighY2FuUGxhY2VBbGx5T3JDaXRhZGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGlmKGFlZHVpLmhhc0F2YWlsYWJsZUFsbGllZFRyaWJlKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YmR1ZWRDaXRpZXNOb3RSb21hbkNvbnRyb2xsZWQgPSBfKHN0YXRlLnJlZ2lvbnMpLmZpbHRlcihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSAhPT0gRmFjdGlvbklEcy5ST01BTlM7XG4gICAgICAgICAgICAgICAgfSkubWFwKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uZmluZChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbi50cmliZXMsIGZ1bmN0aW9uICh0cmliZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmliZS5pc1N1YmR1ZWQoKSAmJiB0cmliZS5pc0NpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkuc2FtcGxlU2l6ZShhZWR1aS5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGgpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgIF8uZWFjaChzdWJkdWVkQ2l0aWVzTm90Um9tYW5Db250cm9sbGVkLCBmdW5jdGlvbihjaXR5KSB7XG4gICAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogYWVkdWkuaWQsIHJlZ2lvbklkOiBjaXR5LnJlZ2lvbklkLCB0cmliZUlkOiBjaXR5LmlkfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZihhZWR1aS5oYXNBdmFpbGFibGVDaXRhZGVsKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFlZHVpQWxsaWVkQ2l0aWVzID0gXyhzdGF0ZS50cmliZXMpLmZpbHRlcihmdW5jdGlvbih0cmliZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyaWJlLmlzQ2l0eSAmJiB0cmliZS5pc0FsbGllZCgpICYmIHRyaWJlLmFsbGllZEZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLkFFRFVJO1xuICAgICAgICAgICAgfSkuc2FtcGxlU2l6ZShhZWR1aS5hdmFpbGFibGVDaXRhZGVscygpLmxlbmd0aCkudmFsdWUoKTtcblxuICAgICAgICAgICAgXy5lYWNoKGFlZHVpQWxsaWVkQ2l0aWVzLCBmdW5jdGlvbihjaXR5KSB7XG4gICAgICAgICAgICAgICAgUGxhY2VDaXRhZGVsLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBhZWR1aS5pZCwgcmVnaW9uSWQ6IGNpdHkucmVnaW9uSWQsIHRyaWJlSWQ6IGNpdHkuaWR9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDI4O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MjguanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUVBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 110 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event35 = function () {\n    function Event35() {\n        _classCallCheck(this, Event35);\n    }\n\n    _createClass(Event35, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiBot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var turn = state.turnHistory.currentTurn;\n            turn.pushContext(new _turnContext2.default({ free: true, noBattle: true }));\n            var commandAction = aeduiBot.executeCommand(state, turn);\n            turn.popContext();\n            if (commandAction) {\n                turn.pushContext(new _turnContext2.default({\n                    id: 'e35',\n                    limited: true,\n                    free: true,\n                    restrictedCommands: [_commandIds2.default.BATTLE]\n                }));\n                aeduiBot.executeCommand(state, turn);\n                turn.popContext();\n            }\n            return commandAction && commandAction !== _factionActions2.default.PASS;\n        }\n    }]);\n\n    return Event35;\n}();\n\nexports.default = Event35;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MzUuanM/Yjk0NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBUdXJuQ29udGV4dCBmcm9tICdjb21tb24vdHVybkNvbnRleHQnXG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5cblxuY2xhc3MgRXZlbnQzNSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpQm90ID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmN1cnJlbnRUdXJuO1xuICAgICAgICB0dXJuLnB1c2hDb250ZXh0KG5ldyBUdXJuQ29udGV4dCh7ZnJlZTogdHJ1ZSwgbm9CYXR0bGU6IHRydWV9KSk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRBY3Rpb24gPSBhZWR1aUJvdC5leGVjdXRlQ29tbWFuZChzdGF0ZSwgdHVybik7XG4gICAgICAgIHR1cm4ucG9wQ29udGV4dCgpO1xuICAgICAgICBpZiAoY29tbWFuZEFjdGlvbikge1xuICAgICAgICAgICAgdHVybi5wdXNoQ29udGV4dChuZXcgVHVybkNvbnRleHQoe1xuICAgICAgICAgICAgICAgIGlkOiAnZTM1JyxcbiAgICAgICAgICAgICAgICBsaW1pdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZyZWU6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVzdHJpY3RlZENvbW1hbmRzOiBbQ29tbWFuZElEcy5CQVRUTEVdXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBhZWR1aUJvdC5leGVjdXRlQ29tbWFuZChzdGF0ZSwgdHVybik7XG4gICAgICAgICAgICB0dXJuLnBvcENvbnRleHQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tbWFuZEFjdGlvbiAmJiBjb21tYW5kQWN0aW9uICE9PSBGYWN0aW9uQWN0aW9ucy5QQVNTO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQzNTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQzNS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBRUE7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 111 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event36 = function () {\n    function Event36() {\n        _classCallCheck(this, Event36);\n    }\n\n    _createClass(Event36, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiBot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var arverniPlayer = state.playersByFaction[_factionIds2.default.ARVERNI];\n            var belgaePlayer = state.playersByFaction[_factionIds2.default.BELGAE];\n\n            if (arverniPlayer.isNonPlayer && belgaePlayer.isNonPlayer) {\n                return false;\n            }\n\n            throw 'Not yet implemented';\n            var battleAction = aeduiBot.executeCommand(state, new _turnContext2.default({\n                id: 'e36',\n                free: true,\n                limited: true,\n                allowedCommands: [_commandIds2.default.BATTLE],\n                context: {\n                    noRetreat: true,\n                    noCounterattack: true,\n                    noCitadelEffect: true,\n                    noRevealAttackers: true\n                }\n            }));\n            return battleAction && battleAction !== _factionActions2.default.PASS;\n        }\n    }]);\n\n    return Event36;\n}();\n\nexports.default = Event36;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTExLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50MzYuanM/Mzk2YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBUdXJuQ29udGV4dCBmcm9tICdjb21tb24vdHVybkNvbnRleHQnXG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5cblxuY2xhc3MgRXZlbnQzNiB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpQm90ID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgY29uc3QgYmVsZ2FlUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkJFTEdBRV07XG5cbiAgICAgICAgaWYgKGFydmVybmlQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYmVsZ2FlUGxheWVyLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyAnTm90IHlldCBpbXBsZW1lbnRlZCc7XG4gICAgICAgIGNvbnN0IGJhdHRsZUFjdGlvbiA9IGFlZHVpQm90LmV4ZWN1dGVDb21tYW5kKHN0YXRlLCBuZXcgVHVybkNvbnRleHQoe1xuICAgICAgICAgICAgaWQ6ICdlMzYnLFxuICAgICAgICAgICAgZnJlZTogdHJ1ZSxcbiAgICAgICAgICAgIGxpbWl0ZWQ6IHRydWUsXG4gICAgICAgICAgICBhbGxvd2VkQ29tbWFuZHM6IFtDb21tYW5kSURzLkJBVFRMRV0sXG4gICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgbm9SZXRyZWF0OiB0cnVlLFxuICAgICAgICAgICAgICAgIG5vQ291bnRlcmF0dGFjazogdHJ1ZSxcbiAgICAgICAgICAgICAgICBub0NpdGFkZWxFZmZlY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgbm9SZXZlYWxBdHRhY2tlcnM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gYmF0dGxlQWN0aW9uICYmIGJhdHRsZUFjdGlvbiAhPT0gRmFjdGlvbkFjdGlvbnMuUEFTUztcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50MzY7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQzNi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBRUE7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFMQTtBQVlBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 112 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _placeAuxilia = __webpack_require__(32);\n\nvar _placeAuxilia2 = _interopRequireDefault(_placeAuxilia);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event40 = function () {\n    function Event40() {\n        _classCallCheck(this, Event40);\n    }\n\n    _createClass(Event40, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var romanFaction = state.factionsById[_factionIds2.default.ROMANS];\n\n            var effective = false;\n\n            var cisalpinaAdjacentById = _lodash2.default.keyBy(state.regionsById[_regionIds2.default.CISALPINA].adjacent, 'id');\n\n            var regionsCanPlaceAlly = _lodash2.default.filter(cisalpinaAdjacentById, function (region) {\n                return region.subduedTribesForFaction(_factionIds2.default.AEDUI).length > 0;\n            });\n\n            var numAlliesToPlace = Math.min(aeduiFaction.availableAlliedTribes().length, regionsCanPlaceAlly.length);\n            _lodash2.default.each(_lodash2.default.sampleSize(regionsCanPlaceAlly, numAlliesToPlace), function (region) {\n                var subduedTribes = region.subduedTribesForFaction(_factionIds2.default.AEDUI);\n                _placeAlliedTribe2.default.execute(state, { factionId: aeduiFaction.id, regionId: region.id, tribeId: _lodash2.default.sample(subduedTribes).id });\n                delete cisalpinaAdjacentById[region.id];\n                effective = true;\n            });\n\n            var warbandsRemaining = aeduiFaction.availableWarbands().length;\n            var numRegionsForWarbands = Math.ceil(warbandsRemaining.length / 3);\n            _lodash2.default.each(_lodash2.default.sampleSize(cisalpinaAdjacentById, numRegionsForWarbands), function (region) {\n                var numWarbandsToPlace = Math.min(warbandsRemaining, 3);\n                _placeWarbands2.default.execute(state, { factionId: aeduiFaction.id, regionId: region.id, count: numWarbandsToPlace });\n                delete cisalpinaAdjacentById[region.id];\n                warbandsRemaining -= numWarbandsToPlace;\n                effective = true;\n\n                if (warbandsRemaining < 1) {\n                    return false;\n                }\n            });\n\n            var auxiliaRemaining = romanFaction.availableAuxilia().length;\n            var numRegionsForAuxilia = Math.ceil(auxiliaRemaining.length / 3);\n            _lodash2.default.each(_lodash2.default.sampleSize(cisalpinaAdjacentById, numRegionsForAuxilia), function (region) {\n                var numAuxiliaToPlace = Math.min(auxiliaRemaining, 3);\n                _placeAuxilia2.default.execute(state, { factionId: romanFaction.id, regionId: region.id, count: numAuxiliaToPlace });\n                delete cisalpinaAdjacentById[region.id];\n                auxiliaRemaining -= numAuxiliaToPlace;\n                effective = true;\n\n                if (auxiliaRemaining < 1) {\n                    return false;\n                }\n            });\n\n            if (aeduiFaction.resources() < 45) {\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: 4 });\n                effective = true;\n            }\n\n            return effective;\n        }\n    }]);\n\n    return Event40;\n}();\n\nexports.default = Event40;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDAuanM/ZTZmNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vLi4vLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFBsYWNlV2FyYmFuZHMgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9wbGFjZVdhcmJhbmRzJztcbmltcG9ydCBQbGFjZUF1eGlsaWEgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9wbGFjZUF1eGlsaWEnO1xuaW1wb3J0IEFkZFJlc291cmNlcyBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL2FkZFJlc291cmNlcyc7XG5cbmNsYXNzIEV2ZW50NDAge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IHJvbWFuRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLlJPTUFOU107XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IGNpc2FscGluYUFkamFjZW50QnlJZCA9IF8ua2V5Qnkoc3RhdGUucmVnaW9uc0J5SWRbUmVnaW9uSURzLkNJU0FMUElOQV0uYWRqYWNlbnQsICdpZCcpO1xuXG4gICAgICAgIGNvbnN0IHJlZ2lvbnNDYW5QbGFjZUFsbHkgPSBfLmZpbHRlcihjaXNhbHBpbmFBZGphY2VudEJ5SWQsIGZ1bmN0aW9uKHJlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5zdWJkdWVkVHJpYmVzRm9yRmFjdGlvbihGYWN0aW9uSURzLkFFRFVJKS5sZW5ndGggPiAwO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBudW1BbGxpZXNUb1BsYWNlID0gTWF0aC5taW4oYWVkdWlGYWN0aW9uLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCwgcmVnaW9uc0NhblBsYWNlQWxseS5sZW5ndGgpO1xuICAgICAgICBfLmVhY2goXy5zYW1wbGVTaXplKHJlZ2lvbnNDYW5QbGFjZUFsbHksIG51bUFsbGllc1RvUGxhY2UpLCBmdW5jdGlvbihyZWdpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YmR1ZWRUcmliZXMgPSByZWdpb24uc3ViZHVlZFRyaWJlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5BRURVSSk7XG4gICAgICAgICAgICBQbGFjZUFsbGllZFRyaWJlLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IGFlZHVpRmFjdGlvbi5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgdHJpYmVJZDogXy5zYW1wbGUoc3ViZHVlZFRyaWJlcykuaWR9KTtcbiAgICAgICAgICAgIGRlbGV0ZSBjaXNhbHBpbmFBZGphY2VudEJ5SWRbcmVnaW9uLmlkXTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCB3YXJiYW5kc1JlbWFpbmluZyA9IGFlZHVpRmFjdGlvbi5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgbnVtUmVnaW9uc0ZvcldhcmJhbmRzID0gTWF0aC5jZWlsKHdhcmJhbmRzUmVtYWluaW5nLmxlbmd0aCAvIDMpO1xuICAgICAgICBfLmVhY2goXy5zYW1wbGVTaXplKGNpc2FscGluYUFkamFjZW50QnlJZCwgbnVtUmVnaW9uc0ZvcldhcmJhbmRzKSwgZnVuY3Rpb24ocmVnaW9uKSB7XG4gICAgICAgICAgICBjb25zdCBudW1XYXJiYW5kc1RvUGxhY2UgPSBNYXRoLm1pbih3YXJiYW5kc1JlbWFpbmluZywgMyk7XG4gICAgICAgICAgICBQbGFjZVdhcmJhbmRzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IGFlZHVpRmFjdGlvbi5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgY291bnQ6IG51bVdhcmJhbmRzVG9QbGFjZX0pO1xuICAgICAgICAgICAgZGVsZXRlIGNpc2FscGluYUFkamFjZW50QnlJZFtyZWdpb24uaWRdO1xuICAgICAgICAgICAgd2FyYmFuZHNSZW1haW5pbmcgLT0gbnVtV2FyYmFuZHNUb1BsYWNlO1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcblxuICAgICAgICAgICAgaWYod2FyYmFuZHNSZW1haW5pbmcgPCAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgYXV4aWxpYVJlbWFpbmluZyA9IHJvbWFuRmFjdGlvbi5hdmFpbGFibGVBdXhpbGlhKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCBudW1SZWdpb25zRm9yQXV4aWxpYSA9IE1hdGguY2VpbChhdXhpbGlhUmVtYWluaW5nLmxlbmd0aCAvIDMpO1xuICAgICAgICBfLmVhY2goXy5zYW1wbGVTaXplKGNpc2FscGluYUFkamFjZW50QnlJZCwgbnVtUmVnaW9uc0ZvckF1eGlsaWEpLCBmdW5jdGlvbihyZWdpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IG51bUF1eGlsaWFUb1BsYWNlID0gTWF0aC5taW4oYXV4aWxpYVJlbWFpbmluZywgMyk7XG4gICAgICAgICAgICBQbGFjZUF1eGlsaWEuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogcm9tYW5GYWN0aW9uLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCBjb3VudDogbnVtQXV4aWxpYVRvUGxhY2V9KTtcbiAgICAgICAgICAgIGRlbGV0ZSBjaXNhbHBpbmFBZGphY2VudEJ5SWRbcmVnaW9uLmlkXTtcbiAgICAgICAgICAgIGF1eGlsaWFSZW1haW5pbmcgLT0gbnVtQXV4aWxpYVRvUGxhY2U7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZihhdXhpbGlhUmVtYWluaW5nIDwgMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYoYWVkdWlGYWN0aW9uLnJlc291cmNlcygpIDwgNDUpIHtcbiAgICAgICAgICAgIEFkZFJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSSwgY291bnQ6IDR9KTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWZmZWN0aXZlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQ0MDtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2V2ZW50cy9ldmVudDQwLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 113 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeCitadel = __webpack_require__(33);\n\nvar _placeCitadel2 = _interopRequireDefault(_placeCitadel);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event41 = function () {\n    function Event41() {\n        _classCallCheck(this, Event41);\n    }\n\n    _createClass(Event41, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n\n            var effective = false;\n\n            var bituriges = state.regionsById[_regionIds2.default.BITURIGES];\n            var avericumAdjacentById = _lodash2.default.keyBy(bituriges.adjacent, 'id');\n            avericumAdjacentById[bituriges.id] = bituriges;\n\n            var tribesToPlaceAlly = (0, _lodash2.default)(avericumAdjacentById).map(function (region) {\n                return region.subduedTribesForFaction(_factionIds2.default.AEDUI);\n            }).flatten().compact().value();\n\n            var numAlliesToPlace = _lodash2.default.min([aeduiFaction.availableAlliedTribes().length, tribesToPlaceAlly.length, 2]);\n            if (numAlliesToPlace > 0) {\n                var groupedTribes = _lodash2.default.groupBy(tribesToPlaceAlly, function (tribe) {\n                    return tribe.isCity ? 'city' : 'notcity';\n                });\n\n                _lodash2.default.each(_lodash2.default.sampleSize(groupedTribes.city || [], numAlliesToPlace), function (tribe) {\n                    _placeAlliedTribe2.default.execute(state, { factionId: aeduiFaction.id, regionId: tribe.regionId, tribeId: tribe.id });\n                    numAlliesToPlace -= 1;\n\n                    if (numAlliesToPlace < 1) {\n                        return false;\n                    }\n                });\n\n                _lodash2.default.each(_lodash2.default.sampleSize(groupedTribes.notcity || [], numAlliesToPlace), function (tribe) {\n                    _placeAlliedTribe2.default.execute(state, { factionId: aeduiFaction.id, regionId: tribe.regionId, tribeId: tribe.id });\n                    numAlliesToPlace -= 1;\n\n                    if (numAlliesToPlace < 1) {\n                        return false;\n                    }\n                });\n\n                effective = true;\n            }\n\n            if (aeduiFaction.availableCitadels().length > 0) {\n                var alliesToUpgrade = (0, _lodash2.default)(avericumAdjacentById).map(function (region) {\n                    return region.getAlliedCityForFaction(_factionIds2.default.AEDUI);\n                }).flatten().compact().value();\n\n                if (alliesToUpgrade.length > 0) {\n                    var tribe = _lodash2.default.sample(alliesToUpgrade);\n                    _placeCitadel2.default.execute(state, { factionId: aeduiFaction.id, regionId: tribe.regionId, tribeId: tribe.id });\n                    effective = true;\n                }\n            }\n\n            var numResourcesToGain = _lodash2.default.reduce(avericumAdjacentById, function (sum, region) {\n                return sum + region.numAlliesAndCitadelsForFaction(_factionIds2.default.AEDUI);\n            }, 0);\n\n            if (numResourcesToGain > 0 && aeduiFaction.resources() < 45) {\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: numResourcesToGain });\n                effective = true;\n            }\n\n            return effective;\n        }\n    }]);\n\n    return Event41;\n}();\n\nexports.default = Event41;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDEuanM/Mzg4NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vLi4vLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFBsYWNlQ2l0YWRlbCBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3BsYWNlQ2l0YWRlbCc7XG5pbXBvcnQgQWRkUmVzb3VyY2VzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcblxuY2xhc3MgRXZlbnQ0MSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkFFRFVJXTtcblxuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgYml0dXJpZ2VzID0gc3RhdGUucmVnaW9uc0J5SWRbUmVnaW9uSURzLkJJVFVSSUdFU107XG4gICAgICAgIGNvbnN0IGF2ZXJpY3VtQWRqYWNlbnRCeUlkID0gXy5rZXlCeShiaXR1cmlnZXMuYWRqYWNlbnQsICdpZCcpO1xuICAgICAgICBhdmVyaWN1bUFkamFjZW50QnlJZFtiaXR1cmlnZXMuaWRdID0gYml0dXJpZ2VzO1xuXG4gICAgICAgIGNvbnN0IHRyaWJlc1RvUGxhY2VBbGx5ID0gXyhhdmVyaWN1bUFkamFjZW50QnlJZCkubWFwKGZ1bmN0aW9uKHJlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5zdWJkdWVkVHJpYmVzRm9yRmFjdGlvbihGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgfSkuZmxhdHRlbigpLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgIGxldCBudW1BbGxpZXNUb1BsYWNlID0gXy5taW4oW2FlZHVpRmFjdGlvbi5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGgsIHRyaWJlc1RvUGxhY2VBbGx5Lmxlbmd0aCwgMl0pO1xuICAgICAgICBpZihudW1BbGxpZXNUb1BsYWNlID4gMCkge1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBlZFRyaWJlcyA9IF8uZ3JvdXBCeShcbiAgICAgICAgICAgICAgICB0cmliZXNUb1BsYWNlQWxseSwgZnVuY3Rpb24gKHRyaWJlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmliZS5pc0NpdHkgPyAnY2l0eScgOiAnbm90Y2l0eSc7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIF8uZWFjaChfLnNhbXBsZVNpemUoZ3JvdXBlZFRyaWJlcy5jaXR5IHx8IFtdLCBudW1BbGxpZXNUb1BsYWNlKSwgZnVuY3Rpb24odHJpYmUpIHtcbiAgICAgICAgICAgICAgICBQbGFjZUFsbGllZFRyaWJlLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IGFlZHVpRmFjdGlvbi5pZCwgcmVnaW9uSWQ6IHRyaWJlLnJlZ2lvbklkLCB0cmliZUlkOiB0cmliZS5pZH0pO1xuICAgICAgICAgICAgICAgIG51bUFsbGllc1RvUGxhY2UgLT0gMTtcblxuICAgICAgICAgICAgICAgIGlmKG51bUFsbGllc1RvUGxhY2UgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgXy5lYWNoKF8uc2FtcGxlU2l6ZShncm91cGVkVHJpYmVzLm5vdGNpdHkgfHwgW10sIG51bUFsbGllc1RvUGxhY2UpLCBmdW5jdGlvbih0cmliZSkge1xuICAgICAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogYWVkdWlGYWN0aW9uLmlkLCByZWdpb25JZDogdHJpYmUucmVnaW9uSWQsIHRyaWJlSWQ6IHRyaWJlLmlkfSk7XG4gICAgICAgICAgICAgICAgbnVtQWxsaWVzVG9QbGFjZSAtPSAxO1xuXG4gICAgICAgICAgICAgICAgaWYobnVtQWxsaWVzVG9QbGFjZSA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoYWVkdWlGYWN0aW9uLmF2YWlsYWJsZUNpdGFkZWxzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgYWxsaWVzVG9VcGdyYWRlID0gXyhhdmVyaWN1bUFkamFjZW50QnlJZCkubWFwKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5nZXRBbGxpZWRDaXR5Rm9yRmFjdGlvbihGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgICAgICAgICB9KS5mbGF0dGVuKCkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgIGlmKGFsbGllc1RvVXBncmFkZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJpYmUgPSBfLnNhbXBsZShhbGxpZXNUb1VwZ3JhZGUpO1xuICAgICAgICAgICAgICAgIFBsYWNlQ2l0YWRlbC5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBhZWR1aUZhY3Rpb24uaWQsIHJlZ2lvbklkOiB0cmliZS5yZWdpb25JZCwgdHJpYmVJZDogdHJpYmUuaWR9KTtcbiAgICAgICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbnVtUmVzb3VyY2VzVG9HYWluID0gXy5yZWR1Y2UoYXZlcmljdW1BZGphY2VudEJ5SWQsIGZ1bmN0aW9uKHN1bSwgcmVnaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VtICsgcmVnaW9uLm51bUFsbGllc0FuZENpdGFkZWxzRm9yRmFjdGlvbihGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYobnVtUmVzb3VyY2VzVG9HYWluID4gMCAmJiBhZWR1aUZhY3Rpb24ucmVzb3VyY2VzKCkgPCA0NSkge1xuICAgICAgICAgICAgQWRkUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogbnVtUmVzb3VyY2VzVG9HYWlufSk7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50NDE7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ0MS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 114 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event42 = function () {\n    function Event42() {\n        _classCallCheck(this, Event42);\n    }\n\n    _createClass(Event42, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var arverniPlayer = state.playersByFaction[_factionIds2.default.ARVERNI];\n            var belgaePlayer = state.playersByFaction[_factionIds2.default.BELGAE];\n\n            var effective = false;\n\n            if (arverniPlayer.isNonPlayer && belgaePlayer.isNonPlayer) {\n                return false;\n            }\n\n            var romanControlledRegions = state.getControlledRegionsForFaction(_factionIds2.default.ROMANS);\n            var adjacentRegions = (0, _lodash2.default)(romanControlledRegions).map('adjacent').flatten().uniqBy('id').differenceBy(romanControlledRegions, 'id').values();\n\n            var arverniAndBelgaeAlliesUnderRomanControl = (0, _lodash2.default)(romanControlledRegions).map('tribes').flatten().filter(function (tribe) {\n                return tribe.isAllied() && (tribe.alliedFactionId() === _factionIds2.default.ARVERNI || tribe.alliedFactionId() === _factionIds2.default.BELGAE);\n            }).value();\n\n            var arverniAndBelgaeAlliesAdjacentToRomanControl = (0, _lodash2.default)(adjacentRegions).map('tribes').flatten().filter(function (tribe) {\n                return tribe.isAllied() && (tribe.alliedFactionId() === _factionIds2.default.ARVERNI || tribe.alliedFactionId() === _factionIds2.default.BELGAE);\n            }).value();\n\n            throw 'Not yet implemented';\n            return effective;\n        }\n    }]);\n\n    return Event42;\n}();\n\nexports.default = Event42;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDIuanM/NzI2ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgRXZlbnQ0MiB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgY29uc3QgYmVsZ2FlUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkJFTEdBRV07XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmKGFydmVybmlQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYmVsZ2FlUGxheWVyLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByb21hbkNvbnRyb2xsZWRSZWdpb25zID0gc3RhdGUuZ2V0Q29udHJvbGxlZFJlZ2lvbnNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgY29uc3QgYWRqYWNlbnRSZWdpb25zID0gXyhyb21hbkNvbnRyb2xsZWRSZWdpb25zKS5tYXAoJ2FkamFjZW50JykuZmxhdHRlbigpLnVuaXFCeSgnaWQnKS5kaWZmZXJlbmNlQnkocm9tYW5Db250cm9sbGVkUmVnaW9ucywgJ2lkJykudmFsdWVzKCk7XG5cbiAgICAgICAgY29uc3QgYXJ2ZXJuaUFuZEJlbGdhZUFsbGllc1VuZGVyUm9tYW5Db250cm9sID0gXyhyb21hbkNvbnRyb2xsZWRSZWdpb25zKS5tYXAoJ3RyaWJlcycpLmZsYXR0ZW4oKS5maWx0ZXIoZnVuY3Rpb24odHJpYmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmliZS5pc0FsbGllZCgpICYmICh0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5BUlZFUk5JIHx8IHRyaWJlLmFsbGllZEZhY3Rpb25JZCgpID09PSBGYWN0aW9uSURzLkJFTEdBRSk7XG4gICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3QgYXJ2ZXJuaUFuZEJlbGdhZUFsbGllc0FkamFjZW50VG9Sb21hbkNvbnRyb2wgPSBfKGFkamFjZW50UmVnaW9ucykubWFwKCd0cmliZXMnKS5mbGF0dGVuKCkuZmlsdGVyKGZ1bmN0aW9uKHRyaWJlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpYmUuaXNBbGxpZWQoKSAmJiAodHJpYmUuYWxsaWVkRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuQVJWRVJOSSB8fCB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5CRUxHQUUpO1xuICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIHRocm93ICdOb3QgeWV0IGltcGxlbWVudGVkJztcbiAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50NDI7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ0Mi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 115 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event43 = function () {\n    function Event43() {\n        _classCallCheck(this, Event43);\n    }\n\n    _createClass(Event43, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.CONVICTOLITAVIS,\n                state: _capabilities.CapabilityStates.UNSHADED,\n                factionId: _factionIds2.default.AEDUI\n            });\n            return true;\n        }\n    }]);\n\n    return Event43;\n}();\n\nexports.default = Event43;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDMuanM/ZDljZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQ0MyB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5DT05WSUNUT0xJVEFWSVMsXG4gICAgICAgICAgICAgICAgc3RhdGU6IENhcGFiaWxpdHlTdGF0ZXMuVU5TSEFERUQsXG4gICAgICAgICAgICAgICAgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDQzXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ0My5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 116 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event45 = function () {\n    function Event45() {\n        _classCallCheck(this, Event45);\n    }\n\n    _createClass(Event45, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var arverniFaction = state.factionsById[_factionIds2.default.ARVERNI];\n            var effective = false;\n\n            var regionsWithArverniWarbands = (0, _lodash2.default)(state.regions).map(function (region) {\n                var arverniWarbands = (0, _lodash2.default)(region.piecesByFaction()[_factionIds2.default.ARVERNI]).filter({ type: 'warband' }).sortBy(function (piece) {\n                    if (!piece.revealed()) {\n                        return 'a';\n                    }\n                    if (!piece.scouted()) {\n                        return 'b';\n                    }\n                    return 'c';\n                }).value();\n                return {\n                    region: region,\n                    warbands: arverniWarbands,\n                    numWarbands: arverniWarbands.length\n                };\n            }).reject({ numWarbands: 0 }).groupBy('numWarbands').value();\n\n            var sortedKeys = (0, _lodash2.default)(regionsWithArverniWarbands).keys().sort().reverse().value();\n\n            var numRegionsRemaining = 2;\n            while (numRegionsRemaining > 0 && sortedKeys.length > 0) {\n                var nextGroup = regionsWithArverniWarbands[sortedKeys.shift()];\n                var regionEntries = (0, _lodash2.default)(nextGroup).sampleSize(Math.min(nextGroup.length, numRegionsRemaining)).value();\n                _lodash2.default.each(regionEntries, function (regionEntry) {\n                    var piecesToRemove = _lodash2.default.take(regionEntry.warbands, 2);\n                    _removePieces2.default.execute(state, { factionId: arverniFaction.id, regionId: regionEntry.region.id, pieces: piecesToRemove });\n                    var numWarbandsToPlace = Math.min(aeduiFaction.availableWarbands().length, piecesToRemove.length);\n                    if (numWarbandsToPlace > 0) {\n                        _placeWarbands2.default.execute(state, { factionId: aeduiFaction.id, regionId: regionEntry.region.id, count: numWarbandsToPlace });\n                    }\n                    effective = true;\n                });\n                numRegionsRemaining -= regionEntries.length;\n            }\n\n            if (arverniFaction.resources() > 0) {\n                var numToTransfer = Math.min(arverniFaction.resources(), 4);\n                _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: numToTransfer });\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.AEDUI, count: numToTransfer });\n                effective = true;\n            }\n            return effective;\n        }\n    }]);\n\n    return Event45;\n}();\n\nexports.default = Event45;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDUuanM/YjYyOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuaW1wb3J0IEFkZFJlc291cmNlcyBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL2FkZFJlc291cmNlcyc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBQbGFjZVdhcmJhbmRzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcGxhY2VXYXJiYW5kcyc7XG5cbmNsYXNzIEV2ZW50NDUge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IGFydmVybmlGYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQVJWRVJOSV07XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBjb25zdCByZWdpb25zV2l0aEFydmVybmlXYXJiYW5kcyA9IF8oc3RhdGUucmVnaW9ucykubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFydmVybmlXYXJiYW5kcyA9IF8ocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQVJWRVJOSV0pLmZpbHRlcih7dHlwZTogJ3dhcmJhbmQnfSkuc29ydEJ5KFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGllY2UucmV2ZWFsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBpZWNlLnNjb3V0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYidcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnYyc7XG4gICAgICAgICAgICAgICAgICAgIH0pLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgIHdhcmJhbmRzOiBhcnZlcm5pV2FyYmFuZHMsXG4gICAgICAgICAgICAgICAgICAgIG51bVdhcmJhbmRzOiBhcnZlcm5pV2FyYmFuZHMubGVuZ3RoXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucmVqZWN0KHtudW1XYXJiYW5kczogMH0pLmdyb3VwQnkoJ251bVdhcmJhbmRzJykudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBzb3J0ZWRLZXlzID0gXyhyZWdpb25zV2l0aEFydmVybmlXYXJiYW5kcykua2V5cygpLnNvcnQoKS5yZXZlcnNlKCkudmFsdWUoKTtcblxuICAgICAgICBsZXQgbnVtUmVnaW9uc1JlbWFpbmluZyA9IDI7XG4gICAgICAgIHdoaWxlIChudW1SZWdpb25zUmVtYWluaW5nID4gMCAmJiBzb3J0ZWRLZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5leHRHcm91cCA9IHJlZ2lvbnNXaXRoQXJ2ZXJuaVdhcmJhbmRzW3NvcnRlZEtleXMuc2hpZnQoKV07XG4gICAgICAgICAgICBjb25zdCByZWdpb25FbnRyaWVzID0gXyhuZXh0R3JvdXApLnNhbXBsZVNpemUoTWF0aC5taW4obmV4dEdyb3VwLmxlbmd0aCwgbnVtUmVnaW9uc1JlbWFpbmluZykpLnZhbHVlKCk7XG4gICAgICAgICAgICBfLmVhY2gocmVnaW9uRW50cmllcywgZnVuY3Rpb24gKHJlZ2lvbkVudHJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2VzVG9SZW1vdmUgPSBfLnRha2UocmVnaW9uRW50cnkud2FyYmFuZHMsIDIpO1xuICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogYXJ2ZXJuaUZhY3Rpb24uaWQsIHJlZ2lvbklkOiByZWdpb25FbnRyeS5yZWdpb24uaWQsIHBpZWNlczogcGllY2VzVG9SZW1vdmUgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtV2FyYmFuZHNUb1BsYWNlID0gTWF0aC5taW4oYWVkdWlGYWN0aW9uLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoLCBwaWVjZXNUb1JlbW92ZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGlmKG51bVdhcmJhbmRzVG9QbGFjZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogYWVkdWlGYWN0aW9uLmlkLCByZWdpb25JZDogcmVnaW9uRW50cnkucmVnaW9uLmlkLCBjb3VudDogbnVtV2FyYmFuZHNUb1BsYWNlIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBudW1SZWdpb25zUmVtYWluaW5nIC09IHJlZ2lvbkVudHJpZXMubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFydmVybmlGYWN0aW9uLnJlc291cmNlcygpID4gMCkge1xuICAgICAgICAgICAgY29uc3QgbnVtVG9UcmFuc2ZlciA9IE1hdGgubWluKGFydmVybmlGYWN0aW9uLnJlc291cmNlcygpLCA0KTtcbiAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLCBjb3VudDogbnVtVG9UcmFuc2Zlcn0pO1xuICAgICAgICAgICAgQWRkUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJLCBjb3VudDogbnVtVG9UcmFuc2Zlcn0pO1xuICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWZmZWN0aXZlO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDQ1O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 117 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event46 = function () {\n    function Event46() {\n        _classCallCheck(this, Event46);\n    }\n\n    _createClass(Event46, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiBot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var turn = state.turnHistory.currentTurn;\n            turn.pushContext(new _turnContext2.default({ id: 'e46', free: true, noSpecial: true }));\n            var commandAction = aeduiBot.executeCommand(state, turn);\n            turn.popContext();\n            if (commandAction && commandAction !== _factionActions2.default.PASS) {\n                state.sequenceOfPlay.remainEligible(_factionIds2.default.AEDUI);\n                return true;\n            }\n            return false;\n        }\n    }]);\n\n    return Event46;\n}();\n\nexports.default = Event46;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDYuanM/OGNmYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBUdXJuQ29udGV4dCBmcm9tICdjb21tb24vdHVybkNvbnRleHQnXG5cbmNsYXNzIEV2ZW50NDYge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBjb25zdCBhZWR1aUJvdCA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5jdXJyZW50VHVybjtcbiAgICAgICAgdHVybi5wdXNoQ29udGV4dChuZXcgVHVybkNvbnRleHQoe2lkOiAnZTQ2JywgZnJlZTogdHJ1ZSwgbm9TcGVjaWFsOiB0cnVlfSkpO1xuICAgICAgICBjb25zdCBjb21tYW5kQWN0aW9uID0gYWVkdWlCb3QuZXhlY3V0ZUNvbW1hbmQoc3RhdGUsIHR1cm4pO1xuICAgICAgICB0dXJuLnBvcENvbnRleHQoKTtcbiAgICAgICAgaWYgKGNvbW1hbmRBY3Rpb24gJiYgY29tbWFuZEFjdGlvbiAhPT0gRmFjdGlvbkFjdGlvbnMuUEFTUykge1xuICAgICAgICAgICAgc3RhdGUuc2VxdWVuY2VPZlBsYXkucmVtYWluRWxpZ2libGUoRmFjdGlvbklEcy5BRURVSSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDQ2O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2V2ZW50cy9ldmVudDQ2LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 118 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event48 = function () {\n    function Event48() {\n        _classCallCheck(this, Event48);\n    }\n\n    _createClass(Event48, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiBot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var turn = state.turnHistory.currentTurn;\n            turn.pushContext(new _turnContext2.default({\n                id: 'e47',\n                free: true,\n                limited: true,\n                allowLimitedSpecial: true\n            }));\n            var commandAction = aeduiBot.executeCommand(state, turn);\n            turn.popContext();\n            if (commandAction && commandAction !== _factionActions2.default.PASS) {\n                state.sequenceOfPlay.remainEligible(_factionIds2.default.AEDUI);\n                return true;\n            }\n            return false;\n        }\n    }]);\n\n    return Event48;\n}();\n\nexports.default = Event48;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDguanM/YWM3OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgRmFjdGlvbkFjdGlvbnMgZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL2ZhY3Rpb25BY3Rpb25zJztcbmltcG9ydCBUdXJuQ29udGV4dCBmcm9tICdjb21tb24vdHVybkNvbnRleHQnXG5cbmNsYXNzIEV2ZW50NDgge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBjb25zdCBhZWR1aUJvdCA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5jdXJyZW50VHVybjtcbiAgICAgICAgdHVybi5wdXNoQ29udGV4dChuZXcgVHVybkNvbnRleHQoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2U0NycsXG4gICAgICAgICAgICAgICAgICAgIGZyZWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGFsbG93TGltaXRlZFNwZWNpYWw6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRBY3Rpb24gPSBhZWR1aUJvdC5leGVjdXRlQ29tbWFuZChzdGF0ZSwgdHVybik7XG4gICAgICAgIHR1cm4ucG9wQ29udGV4dCgpO1xuICAgICAgICBpZiAoY29tbWFuZEFjdGlvbiAmJiBjb21tYW5kQWN0aW9uICE9PSBGYWN0aW9uQWN0aW9ucy5QQVNTKSB7XG4gICAgICAgICAgICBzdGF0ZS5zZXF1ZW5jZU9mUGxheS5yZW1haW5FbGlnaWJsZShGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50NDg7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDguanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 119 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event49 = function () {\n    function Event49() {\n        _classCallCheck(this, Event49);\n    }\n\n    _createClass(Event49, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var arverniPlayer = state.playersByFaction[_factionIds2.default.ARVERNI];\n            var belgaePlayer = state.playersByFaction[_factionIds2.default.BELGAE];\n\n            var effective = false;\n\n            if (arverniPlayer.isNonPlayer && belgaePlayer.isNonPlayer) {\n                return false;\n            }\n\n            throw 'Not yet implemented';\n            return effective;\n        }\n    }]);\n\n    return Event49;\n}();\n\nexports.default = Event49;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDkuanM/OGE0MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgRXZlbnQ0OSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgY29uc3QgYmVsZ2FlUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkJFTEdBRV07XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmKGFydmVybmlQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYmVsZ2FlUGxheWVyLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyAnTm90IHlldCBpbXBsZW1lbnRlZCc7XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDQ5O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NDkuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 120 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _enemyFactionPriority = __webpack_require__(34);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event50 = function () {\n    function Event50() {\n        _classCallCheck(this, Event50);\n    }\n\n    _createClass(Event50, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiBot = state.playersByFaction[_factionIds2.default.AEDUI];\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var effective = false;\n\n            var treveri = state.regionsById[_regionIds2.default.TREVERI];\n            var regionsWithNonAeduiWarbands = (0, _lodash2.default)(treveri.adjacent).concat([treveri]).map(function (region) {\n                var warbands = (0, _lodash2.default)(region.pieces).filter({ type: 'warband' }).sortBy(function (piece) {\n                    var sortValue = _enemyFactionPriority2.default[piece.factionId];\n                    if (!piece.revealed()) {\n                        sortValue += 'a';\n                    }\n                    if (!piece.scouted()) {\n                        sortValue += 'b';\n                    } else {\n                        sortValue += 'c';\n                    }\n                    return sortValue;\n                }).value();\n                return {\n                    region: region,\n                    warbands: warbands,\n                    numWarbands: warbands.length\n                };\n            }).reject({ numWarbands: 0 }).groupBy('numWarbands').value();\n\n            var sortedKeys = (0, _lodash2.default)(regionsWithNonAeduiWarbands).keys().sort().reverse().value();\n            if (sortedKeys.length > 0) {\n                var regionGroup = regionsWithNonAeduiWarbands[sortedKeys.shift()];\n                var regionEntry = _lodash2.default.sample(regionGroup);\n                var piecesToRemove = _lodash2.default.take(regionEntry.warbands, 4);\n                var groupedPiecesByFaction = _lodash2.default.groupBy(piecesToRemove, 'factionId');\n                _lodash2.default.each(groupedPiecesByFaction, function (pieces, factionId) {\n                    _removePieces2.default.execute(state, { factionId: factionId, regionId: regionEntry.region.id, pieces: pieces });\n                });\n                var numWarbandsToPlace = Math.min(aeduiFaction.availableWarbands().length, piecesToRemove.length);\n                if (numWarbandsToPlace > 0) {\n                    _placeWarbands2.default.execute(state, {\n                        factionId: aeduiFaction.id,\n                        regionId: regionEntry.region.id,\n                        count: numWarbandsToPlace\n                    });\n                }\n                effective = true;\n            }\n            var turn = state.turnHistory.currentTurn;\n            turn.pushContext(new _turnContext2.default({ id: 'e50', free: true }));\n            var commandAction = aeduiBot.executeCommand(state, turn);\n            turn.popContext();\n\n            return effective || commandAction && commandAction !== _factionActions2.default.PASS;\n        }\n    }]);\n\n    return Event50;\n}();\n\nexports.default = Event50;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTAuanM/MmFmZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vLi4vLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBQbGFjZVdhcmJhbmRzIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvcGxhY2VXYXJiYW5kcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi4vZW5lbXlGYWN0aW9uUHJpb3JpdHknO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgVHVybkNvbnRleHQgZnJvbSAnY29tbW9uL3R1cm5Db250ZXh0J1xuXG5jbGFzcyBFdmVudDUwIHtcbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgYWVkdWlCb3QgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuQUVEVUldO1xuICAgICAgICBjb25zdCBhZWR1aUZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBjb25zdCB0cmV2ZXJpID0gc3RhdGUucmVnaW9uc0J5SWRbUmVnaW9uSURzLlRSRVZFUkldO1xuICAgICAgICBjb25zdCByZWdpb25zV2l0aE5vbkFlZHVpV2FyYmFuZHMgPSBfKHRyZXZlcmkuYWRqYWNlbnQpLmNvbmNhdChbdHJldmVyaV0pLm1hcChcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXJiYW5kcyA9IF8ocmVnaW9uLnBpZWNlcykuZmlsdGVyKHt0eXBlOiAnd2FyYmFuZCd9KS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNvcnRWYWx1ZSA9IEVuZW15RmFjdGlvblByaW9yaXR5W3BpZWNlLmZhY3Rpb25JZF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBpZWNlLnJldmVhbGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0VmFsdWUgKz0gJ2EnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwaWVjZS5zY291dGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0VmFsdWUgKz0gJ2InO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydFZhbHVlICs9ICdjJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0pLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgIHdhcmJhbmRzOiB3YXJiYW5kcyxcbiAgICAgICAgICAgICAgICAgICAgbnVtV2FyYmFuZHM6IHdhcmJhbmRzLmxlbmd0aFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnJlamVjdCh7bnVtV2FyYmFuZHM6IDB9KS5ncm91cEJ5KCdudW1XYXJiYW5kcycpLnZhbHVlKCk7XG5cbiAgICAgICAgY29uc3Qgc29ydGVkS2V5cyA9IF8ocmVnaW9uc1dpdGhOb25BZWR1aVdhcmJhbmRzKS5rZXlzKCkuc29ydCgpLnJldmVyc2UoKS52YWx1ZSgpO1xuICAgICAgICBpZiAoc29ydGVkS2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCByZWdpb25Hcm91cCA9IHJlZ2lvbnNXaXRoTm9uQWVkdWlXYXJiYW5kc1tzb3J0ZWRLZXlzLnNoaWZ0KCldO1xuICAgICAgICAgICAgY29uc3QgcmVnaW9uRW50cnkgPSBfLnNhbXBsZShyZWdpb25Hcm91cCk7XG4gICAgICAgICAgICBjb25zdCBwaWVjZXNUb1JlbW92ZSA9IF8udGFrZShyZWdpb25FbnRyeS53YXJiYW5kcywgNCk7XG4gICAgICAgICAgICBjb25zdCBncm91cGVkUGllY2VzQnlGYWN0aW9uID0gXy5ncm91cEJ5KHBpZWNlc1RvUmVtb3ZlLCAnZmFjdGlvbklkJyk7XG4gICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgZ3JvdXBlZFBpZWNlc0J5RmFjdGlvbiwgZnVuY3Rpb24gKHBpZWNlcywgZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBmYWN0aW9uSWQsIHJlZ2lvbklkOiByZWdpb25FbnRyeS5yZWdpb24uaWQsIHBpZWNlczogcGllY2VzfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBudW1XYXJiYW5kc1RvUGxhY2UgPSBNYXRoLm1pbihhZWR1aUZhY3Rpb24uYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGgsIHBpZWNlc1RvUmVtb3ZlLmxlbmd0aCk7XG4gICAgICAgICAgICBpZiAobnVtV2FyYmFuZHNUb1BsYWNlID4gMCkge1xuICAgICAgICAgICAgICAgIFBsYWNlV2FyYmFuZHMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogYWVkdWlGYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJlZ2lvbkVudHJ5LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBudW1XYXJiYW5kc1RvUGxhY2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5jdXJyZW50VHVybjtcbiAgICAgICAgdHVybi5wdXNoQ29udGV4dChuZXcgVHVybkNvbnRleHQoeyBpZDogJ2U1MCcsIGZyZWU6IHRydWV9KSk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRBY3Rpb24gPSBhZWR1aUJvdC5leGVjdXRlQ29tbWFuZChzdGF0ZSwgdHVybik7XG4gICAgICAgIHR1cm4ucG9wQ29udGV4dCgpO1xuXG4gICAgICAgIHJldHVybiBlZmZlY3RpdmUgfHwgKGNvbW1hbmRBY3Rpb24gJiYgY29tbWFuZEFjdGlvbiAhPT0gRmFjdGlvbkFjdGlvbnMuUEFTUyk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50NTA7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ1MC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 121 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event52 = function () {\n    function Event52() {\n        _classCallCheck(this, Event52);\n    }\n\n    _createClass(Event52, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var aeduiFaction = state.factionsById[_factionIds2.default.AEDUI];\n            var arverniPlayer = state.playersByFaction[_factionIds2.default.ARVERNI];\n            var belgaePlayer = state.playersByFaction[_factionIds2.default.BELGAE];\n\n            var effective = false;\n\n            if (arverniPlayer.isNonPlayer && belgaePlayer.isNonPlayer) {\n                return false;\n            }\n\n            throw 'Not yet implemented';\n            return effective;\n        }\n    }]);\n\n    return Event52;\n}();\n\nexports.default = Event52;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTIuanM/ZDQzNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgRXZlbnQ1MiB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGFlZHVpRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkFFRFVJXTtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaVBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bRmFjdGlvbklEcy5BUlZFUk5JXTtcbiAgICAgICAgY29uc3QgYmVsZ2FlUGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkJFTEdBRV07XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmKGFydmVybmlQbGF5ZXIuaXNOb25QbGF5ZXIgJiYgYmVsZ2FlUGxheWVyLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyAnTm90IHlldCBpbXBsZW1lbnRlZCc7XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDUyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTIuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 122 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event55 = function () {\n    function Event55() {\n        _classCallCheck(this, Event55);\n    }\n\n    _createClass(Event55, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.COMMIUS,\n                state: _capabilities.CapabilityStates.UNSHADED,\n                factionId: _factionIds2.default.ROMANS\n            });\n            return true;\n        }\n    }]);\n\n    return Event55;\n}();\n\nexports.default = Event55;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTUuanM/Y2JlYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi8uLi9jb21tb24vY2FwYWJpbGl0eSc7XG5pbXBvcnQge0NhcGFiaWxpdHlJRHMsIENhcGFiaWxpdHlTdGF0ZXN9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IEFkZENhcGFiaWxpdHkgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9hZGRDYXBhYmlsaXR5JztcblxuY2xhc3MgRXZlbnQ1NSB7XG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIEFkZENhcGFiaWxpdHkuZXhlY3V0ZShzdGF0ZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogQ2FwYWJpbGl0eUlEcy5DT01NSVVTLFxuICAgICAgICAgICAgICAgIHN0YXRlOiBDYXBhYmlsaXR5U3RhdGVzLlVOU0hBREVELFxuICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50NTVcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FlZHVpL2V2ZW50cy9ldmVudDU1LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 123 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event56 = function () {\n    function Event56() {\n        _classCallCheck(this, Event56);\n    }\n\n    _createClass(Event56, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var belgaeFaction = state.factionsById[_factionIds2.default.BELGAE];\n\n            var romanRegions = state.getControlledRegionsForFaction(_factionIds2.default.ROMANS);\n            var ambiorixEntry = (0, _lodash2.default)(belgaeFaction.victoryMargin(state) < -5 ? state.regions : romanRegions).map(function (region) {\n                var ambiorix = _lodash2.default.find(region.piecesByFaction()[_factionIds2.default.BELGAE], function (piece) {\n                    return piece.type === 'leader' && !piece.isSuccessor();\n                });\n\n                if (ambiorix) {\n                    return {\n                        ambiorix: ambiorix,\n                        region: region\n                    };\n                }\n                return null;\n            }).compact().first();\n\n            if (ambiorixEntry) {\n                _removePieces2.default.execute(state, { factionId: _factionIds2.default.BELGAE, regionId: ambiorixEntry.region.id, pieces: [ambiorixEntry.ambiorix] });\n                return true;\n            }\n\n            return false;\n        }\n    }]);\n\n    return Event56;\n}();\n\nexports.default = Event56;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTYuanM/ZmMwYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vLi4vYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuXG5jbGFzcyBFdmVudDU2IHtcbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgYmVsZ2FlRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkJFTEdBRV07XG5cbiAgICAgICAgY29uc3Qgcm9tYW5SZWdpb25zID0gc3RhdGUuZ2V0Q29udHJvbGxlZFJlZ2lvbnNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgY29uc3QgYW1iaW9yaXhFbnRyeSA9IF8oXG4gICAgICAgICAgICBiZWxnYWVGYWN0aW9uLnZpY3RvcnlNYXJnaW4oc3RhdGUpIDwgLTUgPyBzdGF0ZS5yZWdpb25zIDogcm9tYW5SZWdpb25zKS5tYXAoZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFtYmlvcml4ID0gXy5maW5kKFxuICAgICAgICAgICAgICAgICAgICByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5CRUxHQUVdLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnbGVhZGVyJyAmJiAhcGllY2UuaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYW1iaW9yaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFtYmlvcml4LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5maXJzdCgpO1xuXG4gICAgICAgIGlmIChhbWJpb3JpeEVudHJ5KSB7XG4gICAgICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5CRUxHQUUsIHJlZ2lvbklkOiBhbWJpb3JpeEVudHJ5LnJlZ2lvbi5pZCwgcGllY2VzOiBbYW1iaW9yaXhFbnRyeS5hbWJpb3JpeF19KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBFdmVudDU2O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50NTYuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 124 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _capability = __webpack_require__(17);\n\nvar _capability2 = _interopRequireDefault(_capability);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _addCapability = __webpack_require__(22);\n\nvar _addCapability2 = _interopRequireDefault(_addCapability);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event8 = function () {\n    function Event8() {\n        _classCallCheck(this, Event8);\n    }\n\n    _createClass(Event8, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            _addCapability2.default.execute(state, {\n                id: _capabilities.CapabilityIDs.BAGGAGE_TRAINS,\n                state: _capabilities.CapabilityStates.SHADED,\n                factionId: _factionIds2.default.AEDUI\n            });\n            return true;\n        }\n    }]);\n\n    return Event8;\n}();\n\nexports.default = Event8;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50OC5qcz83NWMyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBDYXBhYmlsaXR5IGZyb20gJy4uLy4uLy4uLy4uL2NvbW1vbi9jYXBhYmlsaXR5JztcbmltcG9ydCB7Q2FwYWJpbGl0eUlEcywgQ2FwYWJpbGl0eVN0YXRlc30gZnJvbSAnLi4vLi4vLi4vY29uZmlnL2NhcGFiaWxpdGllcyc7XG5pbXBvcnQgQWRkQ2FwYWJpbGl0eSBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL2FkZENhcGFiaWxpdHknO1xuXG5jbGFzcyBFdmVudDgge1xuICAgIHN0YXRpYyBoYW5kbGVFdmVudChzdGF0ZSkge1xuICAgICAgICBBZGRDYXBhYmlsaXR5LmV4ZWN1dGUoc3RhdGUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IENhcGFiaWxpdHlJRHMuQkFHR0FHRV9UUkFJTlMsXG4gICAgICAgICAgICAgICAgc3RhdGU6IENhcGFiaWxpdHlTdGF0ZXMuU0hBREVELFxuICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5BRURVSVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQ4XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ4LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 125 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Event9 = function () {\n    function Event9() {\n        _classCallCheck(this, Event9);\n    }\n\n    _createClass(Event9, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            return false;\n        }\n    }]);\n\n    return Event9;\n}();\n\nexports.default = Event9;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYWVkdWkvZXZlbnRzL2V2ZW50OS5qcz9lZmM2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgRXZlbnQ5IHtcbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnQ5XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hZWR1aS9ldmVudHMvZXZlbnQ5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 126 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _enemyFactionPriority = __webpack_require__(42);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _arverniDevastate = __webpack_require__(40);\n\nvar _arverniDevastate2 = _interopRequireDefault(_arverniDevastate);\n\nvar _arverniEntreat = __webpack_require__(41);\n\nvar _arverniEntreat2 = _interopRequireDefault(_arverniEntreat);\n\nvar _arverniMarch = __webpack_require__(51);\n\nvar _arverniMarch2 = _interopRequireDefault(_arverniMarch);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    PRE_BATTLE_SPECIAL_CHECK: 'pre-battle-special'\n};\n\nvar ArverniBattle = function () {\n    function ArverniBattle() {\n        _classCallCheck(this, ArverniBattle);\n    }\n\n    _createClass(ArverniBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers) {\n            var arverni = state.arverni;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (arverni.resources() === 0 && !modifiers.free) {\n                return false;\n            }\n\n            var battles = modifiers.context.battles || this.getBattleList(state, modifiers);\n            if (battles.length === 0) {\n                return false;\n            }\n\n            turn.startCommand(_commandIds2.default.BATTLE);\n            modifiers.context.battles = battles;\n\n            if (!turn.getCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK)) {\n                var ambushed = _lodash2.default.find(battles, { willAmbush: true });\n                if (ambushed) {\n                    turn.startSpecialAbility(_specialAbilityIds2.default.AMBUSH);\n                    turn.commitSpecialAbility();\n                    modifiers.context.didPreBattleSpecial = true;\n                } else if (!ambushed && modifiers.canDoSpecial()) {\n                    modifiers.context.didPreBattleSpecial = _arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK);\n            }\n\n            _lodash2.default.each(battles, function (battle) {\n                if (!battle.complete) {\n                    if (!battle.paid && !modifiers.free) {\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: battle.cost });\n                        battle.paid = true;\n                    }\n                    _battle2.default.execute(state, { battleResults: battle });\n                }\n            });\n\n            turn.commitCommand();\n            modifiers.context.battles = null;\n\n            return modifiers.context.didPreBattleSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getBattleList',\n        value: function getBattleList(state, modifiers) {\n            var arverni = state.arverni;\n            console.log('*** Are there any effective Arverni Battles? ***');\n\n            var importantBattleRegions = this.findImportantBattleRegions(state, modifiers);\n            if (importantBattleRegions.length === 0) {\n                return [];\n            }\n\n            var battlegrounds = this.findBattlegrounds(state, modifiers, importantBattleRegions);\n            var prioritizedBattles = this.prioritizeBattles(state, battlegrounds);\n\n            if (prioritizedBattles.length === 0 || this.isVercingetorixInDangerWithoutBattle(state, importantBattleRegions, battlegrounds)) {\n                if (!arverni.hasAvailableLeader()) {\n                    modifiers.context.tryThreatMarch = true;\n                }\n                return [];\n            }\n\n            var battles = modifiers.free ? prioritizedBattles : _lodash2.default.reduce(prioritizedBattles, function (accumulator, battle) {\n                if (accumulator.resourcesRemaining >= battle.cost) {\n                    accumulator.resourcesRemaining -= battle.cost;\n                    accumulator.battles.push(battle);\n                }\n                return accumulator;\n            }, { resourcesRemaining: arverni.resources(), battles: [] }).battles;\n\n            if (battles.length > 0) {\n                if (modifiers.limited) {\n                    battles = _lodash2.default.take(battles, 1);\n                }\n\n                if (modifiers.canDoSpecial() && this.needAmbush(battles[0])) {\n                    _lodash2.default.each(battles, function (battle) {\n                        battle.willAmbush = true;\n                    });\n                }\n            }\n\n            return battles;\n        }\n    }, {\n        key: 'findImportantBattleRegions',\n        value: function findImportantBattleRegions(state, modifiers) {\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var piecesByType = _lodash2.default.groupBy(region.piecesByFaction()[_factionIds2.default.ARVERNI], 'type');\n                var hasVercingetorix = piecesByType.leader && !piecesByType.leader[0].isSuccessor();\n                var numWarbands = (piecesByType.warband || []).length;\n                if (!hasVercingetorix && numWarbands <= 7) {\n                    return;\n                }\n\n                var importantEnemies = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().filter(function (factionId) {\n                    var enemyPieces = region.piecesByFaction()[factionId] || [];\n                    var enemyPiecesByType = _lodash2.default.groupBy(enemyPieces, 'type');\n\n                    return factionId !== _factionIds2.default.GERMANIC_TRIBES && factionId !== _factionIds2.default.BELGAE && (enemyPieces.length > 3 || enemyPiecesByType.alliedtribe || enemyPiecesByType.citadel || enemyPiecesByType.legion);\n                }).value();\n\n                if (importantEnemies.length) {\n                    return {\n                        region: region,\n                        hasVercingetorix: hasVercingetorix,\n                        importantEnemies: importantEnemies\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'findBattlegrounds',\n        value: function findBattlegrounds(state, modifiers, importantRegions) {\n            var _this = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var piecesByType = _lodash2.default.groupBy(region.piecesByFaction()[_factionIds2.default.ARVERNI], 'type');\n                var hasVercingetorix = piecesByType.leader && !piecesByType.leader[0].isSuccessor();\n                var warbands = piecesByType.warband || [];\n                if (!piecesByType.leader && warbands.length <= 7) {\n                    return;\n                }\n\n                var potentialBattles = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().map(function (factionId) {\n                    if (factionId === _factionIds2.default.GERMANIC_TRIBES || factionId === _factionIds2.default.BELGAE) {\n                        return;\n                    }\n                    var enemyPieces = region.piecesByFaction()[factionId] || [];\n                    if (enemyPieces.length === 0) {\n                        return;\n                    }\n                    var battleResult = _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.ARVERNI,\n                        defendingFactionId: factionId\n                    });\n\n                    if (!_this.isEffectiveBattle(battleResult)) {\n                        return;\n                    }\n\n                    return battleResult;\n                }).compact().value();\n\n                var importantRegionData = _lodash2.default.find(importantRegions, function (regionData) {\n                    return regionData.region.id === region.id;\n                });\n                var importantEnemies = importantRegionData ? importantRegionData.importantEnemies : null;\n\n                if (potentialBattles.length) {\n                    return {\n                        region: region,\n                        warbands: warbands,\n                        hasVercingetorix: hasVercingetorix,\n                        potentialBattles: potentialBattles,\n                        importantEnemies: importantEnemies\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            return this.isLossInflictedOnLegion(battleResult) || this.willCauseEnoughDefenderLosses(battleResult);\n        }\n    }, {\n        key: 'isLossInflictedOnLegion',\n        value: function isLossInflictedOnLegion(battleResult) {\n            return battleResult.willInflictLossAgainstLegion(battleResult.canAmbush);\n        }\n    }, {\n        key: 'willCauseEnoughDefenderLosses',\n        value: function willCauseEnoughDefenderLosses(battleResult) {\n            if (battleResult.worstCaseDefenderLosses.normal > 0 && battleResult.worstCaseDefenderLosses.normal >= battleResult.worstCaseAttackerLosses.normal) {\n                return true;\n            }\n\n            return battleResult.canAmbush && battleResult.worstCaseDefenderLosses.ambush > 0 && battleResult.worstCaseDefenderLosses.ambush >= battleResult.worstCaseAttackerLosses.ambush;\n        }\n    }, {\n        key: 'isVercingetorixInDangerWithoutBattle',\n        value: function isVercingetorixInDangerWithoutBattle(state, importantBattleRegions, battlegrounds) {\n            var vercingetorixInDanger = _lodash2.default.find(importantBattleRegions, { hasVercingetorix: true });\n            if (!vercingetorixInDanger) {\n                return false;\n            }\n\n            var vercingetorixBattleground = _lodash2.default.find(battlegrounds, { hasVercingetorix: true });\n            if (!vercingetorixBattleground) {\n                return true;\n            }\n\n            var willBattleRomans = this.getVercingetorixBattleWithRomans(vercingetorixBattleground);\n            var willBattleAedui = this.willVercingetorixBattleAedui(state, vercingetorixBattleground);\n            var canAfford = state.arverni.resources() >= (vercingetorixBattleground.region.devastated() ? 2 : 1);\n\n            return !canAfford || !willBattleRomans && !willBattleAedui;\n        }\n    }, {\n        key: 'prioritizeBattles',\n        value: function prioritizeBattles(state, battlegrounds) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(battlegrounds).map(function (battleground) {\n                var priority = 'c';\n\n                var bestBattle = _this2.getBestBattleForBattleground(state, battleground);\n\n                if (battleground.hasVercingetorix) {\n                    priority = 'a';\n                } else if (_lodash2.default.indexOf(battleground.importantEnemies, bestBattle.defendingFaction.id) >= 0) {\n                    priority = 'b';\n                }\n\n                if (bestBattle) {\n                    return {\n                        priority: priority,\n                        bestBattle: bestBattle\n                    };\n                }\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('bestBattle').value();\n        }\n    }, {\n        key: 'getBestBattleForBattleground',\n        value: function getBestBattleForBattleground(state, battleground) {\n\n            var bestBattle = null;\n            if (battleground.hasAmbiorix) {\n                bestBattle = this.getVercingetorixBattleWithRomans(battleground);\n                if (!bestBattle) {\n                    // Should find the one that meets condition?\n                    bestBattle = _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                        return potentialBattle.defendingFaction.id === _factionIds2.default.AEDUI;\n                    });\n                }\n            } else {\n                bestBattle = (0, _lodash2.default)(battleground.potentialBattles).sortBy(function (potentialBattle) {\n                    return (_lodash2.default.indexOf(battleground.importantEnemies, potentialBattle.defendingFaction.id) >= 0 ? 'a' : 'b') + _enemyFactionPriority2.default[potentialBattle.defendingFaction.id];\n                }).first();\n            }\n\n            return bestBattle;\n        }\n    }, {\n        key: 'getVercingetorixBattleWithRomans',\n        value: function getVercingetorixBattleWithRomans(battleground) {\n            return _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                if (potentialBattle.defendingFaction.id !== _factionIds2.default.ROMANS) {\n                    return false;\n                }\n\n                var leader = battleground.region.getLeaderForFaction(_factionIds2.default.ROMANS);\n                var caesar = leader && !leader.isSuccessor();\n                var numRomanMobile = battleground.region.getMobilePiecesForFaction(_factionIds2.default.ROMANS).length;\n                return !caesar || numRomanMobile * 2 < battleground.warbands.length + 1;\n            });\n        }\n    }, {\n        key: 'willVercingetorixBattleAedui',\n        value: function willVercingetorixBattleAedui(state, battleground) {\n            var romansPresent = battleground.region.piecesByFaction()[_factionIds2.default.ROMANS];\n            var aeduiBattle = _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                return potentialBattle.defendingFaction.id === _factionIds2.default.AEDUI;\n            });\n            return !romansPresent && aeduiBattle;\n        }\n    }, {\n        key: 'needAmbush',\n        value: function needAmbush(battle) {\n            return battle.canAmbush && battle.worstCaseAttackerLosses.normal > 0 || battle.worstCaseDefenderLosses.ambush > battle.worstCaseDefenderLosses.normal;\n        }\n    }]);\n\n    return ArverniBattle;\n}();\n\nexports.default = ArverniBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pQmF0dGxlLmpzPzc4ZDkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5pbXBvcnQgU3BlY2lhbEFiaWxpdHlJRHMgZnJvbSAnLi4vLi4vY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBCYXR0bGUgZnJvbSAnLi4vLi4vY29tbWFuZHMvYmF0dGxlJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICcuL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBBcnZlcm5pRGV2YXN0YXRlIGZyb20gJy4vYXJ2ZXJuaURldmFzdGF0ZSc7XG5pbXBvcnQgQXJ2ZXJuaUVudHJlYXQgZnJvbSAnLi9hcnZlcm5pRW50cmVhdCc7XG5pbXBvcnQgQXJ2ZXJuaU1hcmNoIGZyb20gJy4vYXJ2ZXJuaU1hcmNoJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5cbmNvbnN0IENoZWNrcG9pbnRzID0ge1xuICAgIFBSRV9CQVRUTEVfU1BFQ0lBTF9DSEVDSzogJ3ByZS1iYXR0bGUtc3BlY2lhbCdcbn07XG5cbmNsYXNzIEFydmVybmlCYXR0bGUge1xuXG4gICAgc3RhdGljIGJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGFydmVybmkgPSBzdGF0ZS5hcnZlcm5pO1xuICAgICAgICBjb25zdCB0dXJuID0gc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKTtcblxuICAgICAgICBpZiAoYXJ2ZXJuaS5yZXNvdXJjZXMoKSA9PT0gMCAmJiAhbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzIHx8IHRoaXMuZ2V0QmF0dGxlTGlzdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0dXJuLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLkJBVFRMRSk7XG4gICAgICAgIG1vZGlmaWVycy5jb250ZXh0LmJhdHRsZXMgPSBiYXR0bGVzO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlBSRV9CQVRUTEVfU1BFQ0lBTF9DSEVDSykpIHtcbiAgICAgICAgICAgIGNvbnN0IGFtYnVzaGVkID0gXy5maW5kKGJhdHRsZXMsIHt3aWxsQW1idXNoOiB0cnVlfSk7XG4gICAgICAgICAgICBpZiAoYW1idXNoZWQpIHtcbiAgICAgICAgICAgICAgICB0dXJuLnN0YXJ0U3BlY2lhbEFiaWxpdHkoU3BlY2lhbEFiaWxpdHlJRHMuQU1CVVNIKTtcbiAgICAgICAgICAgICAgICB0dXJuLmNvbW1pdFNwZWNpYWxBYmlsaXR5KCk7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlQmF0dGxlU3BlY2lhbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghYW1idXNoZWQgJiYgbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpKSB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlQmF0dGxlU3BlY2lhbCA9IEFydmVybmlEZXZhc3RhdGUuZGV2YXN0YXRlKHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnMpIHx8IEFydmVybmlFbnRyZWF0LmVudHJlYXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHR1cm4ubWFya0NoZWNrcG9pbnQoQ2hlY2twb2ludHMuUFJFX0JBVFRMRV9TUEVDSUFMX0NIRUNLKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uZWFjaChiYXR0bGVzLCAoYmF0dGxlKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWJhdHRsZS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIGlmICghYmF0dGxlLnBhaWQgJiYgIW1vZGlmaWVycy5mcmVlKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkksIGNvdW50OiBiYXR0bGUuY29zdH0pO1xuICAgICAgICAgICAgICAgICAgICBiYXR0bGUucGFpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEJhdHRsZS5leGVjdXRlKHN0YXRlLCB7YmF0dGxlUmVzdWx0czogYmF0dGxlfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHR1cm4uY29tbWl0Q29tbWFuZCgpO1xuICAgICAgICBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzID0gbnVsbDtcblxuICAgICAgICByZXR1cm4gbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlQmF0dGxlU3BlY2lhbCA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCYXR0bGVMaXN0KHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3QgYXJ2ZXJuaSA9IHN0YXRlLmFydmVybmk7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQXJlIHRoZXJlIGFueSBlZmZlY3RpdmUgQXJ2ZXJuaSBCYXR0bGVzPyAqKionKTtcblxuICAgICAgICBjb25zdCBpbXBvcnRhbnRCYXR0bGVSZWdpb25zID0gdGhpcy5maW5kSW1wb3J0YW50QmF0dGxlUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGltcG9ydGFudEJhdHRsZVJlZ2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBiYXR0bGVncm91bmRzID0gdGhpcy5maW5kQmF0dGxlZ3JvdW5kcyhzdGF0ZSwgbW9kaWZpZXJzLCBpbXBvcnRhbnRCYXR0bGVSZWdpb25zKTtcbiAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWRCYXR0bGVzID0gdGhpcy5wcmlvcml0aXplQmF0dGxlcyhzdGF0ZSwgYmF0dGxlZ3JvdW5kcyk7XG5cbiAgICAgICAgaWYgKHByaW9yaXRpemVkQmF0dGxlcy5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICAgIHRoaXMuaXNWZXJjaW5nZXRvcml4SW5EYW5nZXJXaXRob3V0QmF0dGxlKHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0YW50QmF0dGxlUmVnaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZWdyb3VuZHMpKSB7XG4gICAgICAgICAgICBpZiAoIWFydmVybmkuaGFzQXZhaWxhYmxlTGVhZGVyKCkpIHtcbiAgICAgICAgICAgICAgICBtb2RpZmllcnMuY29udGV4dC50cnlUaHJlYXRNYXJjaCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYmF0dGxlcyA9IG1vZGlmaWVycy5mcmVlID8gcHJpb3JpdGl6ZWRCYXR0bGVzIDogXy5yZWR1Y2UocHJpb3JpdGl6ZWRCYXR0bGVzLCAoYWNjdW11bGF0b3IsIGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyA+PSBiYXR0bGUuY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSBiYXR0bGUuY29zdDtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5iYXR0bGVzLnB1c2goYmF0dGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvclxuICAgICAgICB9LCB7cmVzb3VyY2VzUmVtYWluaW5nOiBhcnZlcm5pLnJlc291cmNlcygpLCBiYXR0bGVzOiBbXX0pLmJhdHRsZXM7XG5cbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5saW1pdGVkKSB7XG4gICAgICAgICAgICAgICAgYmF0dGxlcyA9IF8udGFrZShiYXR0bGVzLCAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiB0aGlzLm5lZWRBbWJ1c2goYmF0dGxlc1swXSkpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2goYmF0dGxlcywgKGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBiYXR0bGUud2lsbEFtYnVzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmF0dGxlcztcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZEltcG9ydGFudEJhdHRsZVJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2VzQnlUeXBlID0gXy5ncm91cEJ5KHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFSVkVSTkldLCAndHlwZScpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc1ZlcmNpbmdldG9yaXggPSBwaWVjZXNCeVR5cGUubGVhZGVyICYmICFwaWVjZXNCeVR5cGUubGVhZGVyWzBdLmlzU3VjY2Vzc29yKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtV2FyYmFuZHMgPSAocGllY2VzQnlUeXBlLndhcmJhbmQgfHwgW10pLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoIWhhc1ZlcmNpbmdldG9yaXggJiYgbnVtV2FyYmFuZHMgPD0gNykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0YW50RW5lbWllcyA9IF8oRW5lbXlGYWN0aW9uUHJpb3JpdHkpLmtleXMoKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZW15UGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmVteVBpZWNlc0J5VHlwZSA9IF8uZ3JvdXBCeShlbmVteVBpZWNlcywgJ3R5cGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rpb25JZCAhPT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgJiYgZmFjdGlvbklkICE9PSBGYWN0aW9uSURzLkJFTEdBRSAmJiAoZW5lbXlQaWVjZXMubGVuZ3RoID4gMyB8fCBlbmVteVBpZWNlc0J5VHlwZS5hbGxpZWR0cmliZSB8fCBlbmVteVBpZWNlc0J5VHlwZS5jaXRhZGVsIHx8IGVuZW15UGllY2VzQnlUeXBlLmxlZ2lvbik7XG4gICAgICAgICAgICAgICAgICAgIH0pLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaW1wb3J0YW50RW5lbWllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1ZlcmNpbmdldG9yaXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRhbnRFbmVtaWVzXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRCYXR0bGVncm91bmRzKHN0YXRlLCBtb2RpZmllcnMsIGltcG9ydGFudFJlZ2lvbnMpIHtcbiAgICAgICAgcmV0dXJuIF8oc3RhdGUucmVnaW9ucykubWFwKFxuICAgICAgICAgICAgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlc0J5VHlwZSA9IF8uZ3JvdXBCeShyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5BUlZFUk5JXSwgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNWZXJjaW5nZXRvcml4ID0gcGllY2VzQnlUeXBlLmxlYWRlciAmJiAhcGllY2VzQnlUeXBlLmxlYWRlclswXS5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdhcmJhbmRzID0gcGllY2VzQnlUeXBlLndhcmJhbmQgfHwgW107XG4gICAgICAgICAgICAgICAgaWYgKCFwaWVjZXNCeVR5cGUubGVhZGVyICYmIHdhcmJhbmRzLmxlbmd0aCA8PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwb3RlbnRpYWxCYXR0bGVzID0gXyhFbmVteUZhY3Rpb25Qcmlvcml0eSkua2V5cygpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgKGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZW15UGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5lbXlQaWVjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0dGxlUmVzdWx0ID0gQmF0dGxlLnRlc3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlbmRpbmdGYWN0aW9uSWQ6IGZhY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNFZmZlY3RpdmVCYXR0bGUoYmF0dGxlUmVzdWx0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJhdHRsZVJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBpbXBvcnRhbnRSZWdpb25EYXRhID0gXy5maW5kKGltcG9ydGFudFJlZ2lvbnMsIHJlZ2lvbkRhdGEgPT4gcmVnaW9uRGF0YS5yZWdpb24uaWQgPT09IHJlZ2lvbi5pZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0YW50RW5lbWllcyA9IGltcG9ydGFudFJlZ2lvbkRhdGEgPyBpbXBvcnRhbnRSZWdpb25EYXRhLmltcG9ydGFudEVuZW1pZXMgOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBvdGVudGlhbEJhdHRsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJiYW5kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1ZlcmNpbmdldG9yaXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxCYXR0bGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0YW50RW5lbWllc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0VmZmVjdGl2ZUJhdHRsZShiYXR0bGVSZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNMb3NzSW5mbGljdGVkT25MZWdpb24oYmF0dGxlUmVzdWx0KSB8fCB0aGlzLndpbGxDYXVzZUVub3VnaERlZmVuZGVyTG9zc2VzKGJhdHRsZVJlc3VsdCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzTG9zc0luZmxpY3RlZE9uTGVnaW9uKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICByZXR1cm4gYmF0dGxlUmVzdWx0LndpbGxJbmZsaWN0TG9zc0FnYWluc3RMZWdpb24oYmF0dGxlUmVzdWx0LmNhbkFtYnVzaCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHdpbGxDYXVzZUVub3VnaERlZmVuZGVyTG9zc2VzKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+IDAgJiYgYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+PSBiYXR0bGVSZXN1bHQud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQuY2FuQW1idXNoICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPiAwICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPj0gYmF0dGxlUmVzdWx0LndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLmFtYnVzaDtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNWZXJjaW5nZXRvcml4SW5EYW5nZXJXaXRob3V0QmF0dGxlKHN0YXRlLCBpbXBvcnRhbnRCYXR0bGVSZWdpb25zLCBiYXR0bGVncm91bmRzKSB7XG4gICAgICAgIGNvbnN0IHZlcmNpbmdldG9yaXhJbkRhbmdlciA9IF8uZmluZChpbXBvcnRhbnRCYXR0bGVSZWdpb25zLCB7aGFzVmVyY2luZ2V0b3JpeDogdHJ1ZX0pO1xuICAgICAgICBpZiAoIXZlcmNpbmdldG9yaXhJbkRhbmdlcikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdmVyY2luZ2V0b3JpeEJhdHRsZWdyb3VuZCA9IF8uZmluZChiYXR0bGVncm91bmRzLCB7aGFzVmVyY2luZ2V0b3JpeDogdHJ1ZX0pO1xuICAgICAgICBpZiAoIXZlcmNpbmdldG9yaXhCYXR0bGVncm91bmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgd2lsbEJhdHRsZVJvbWFucyA9IHRoaXMuZ2V0VmVyY2luZ2V0b3JpeEJhdHRsZVdpdGhSb21hbnModmVyY2luZ2V0b3JpeEJhdHRsZWdyb3VuZCk7XG4gICAgICAgIGNvbnN0IHdpbGxCYXR0bGVBZWR1aSA9IHRoaXMud2lsbFZlcmNpbmdldG9yaXhCYXR0bGVBZWR1aShzdGF0ZSwgdmVyY2luZ2V0b3JpeEJhdHRsZWdyb3VuZCk7XG4gICAgICAgIGNvbnN0IGNhbkFmZm9yZCA9IHN0YXRlLmFydmVybmkucmVzb3VyY2VzKCkgPj0gKHZlcmNpbmdldG9yaXhCYXR0bGVncm91bmQucmVnaW9uLmRldmFzdGF0ZWQoKSA/IDIgOiAxKTtcblxuICAgICAgICByZXR1cm4gIWNhbkFmZm9yZCB8fCAoIXdpbGxCYXR0bGVSb21hbnMgJiYgIXdpbGxCYXR0bGVBZWR1aSk7XG4gICAgfVxuXG4gICAgc3RhdGljIHByaW9yaXRpemVCYXR0bGVzKHN0YXRlLCBiYXR0bGVncm91bmRzKSB7XG4gICAgICAgIHJldHVybiBfKGJhdHRsZWdyb3VuZHMpLm1hcChcbiAgICAgICAgICAgIChiYXR0bGVncm91bmQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAnYyc7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0QmF0dGxlID0gdGhpcy5nZXRCZXN0QmF0dGxlRm9yQmF0dGxlZ3JvdW5kKHN0YXRlLCBiYXR0bGVncm91bmQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGJhdHRsZWdyb3VuZC5oYXNWZXJjaW5nZXRvcml4KSB7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ2EnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChfLmluZGV4T2YoYmF0dGxlZ3JvdW5kLmltcG9ydGFudEVuZW1pZXMsIGJlc3RCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdiJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYmVzdEJhdHRsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBiZXN0QmF0dGxlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5tYXAoJ2Jlc3RCYXR0bGUnKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCZXN0QmF0dGxlRm9yQmF0dGxlZ3JvdW5kKHN0YXRlLCBiYXR0bGVncm91bmQpIHtcblxuICAgICAgICBsZXQgYmVzdEJhdHRsZSA9IG51bGw7XG4gICAgICAgIGlmIChiYXR0bGVncm91bmQuaGFzQW1iaW9yaXgpIHtcbiAgICAgICAgICAgIGJlc3RCYXR0bGUgPSB0aGlzLmdldFZlcmNpbmdldG9yaXhCYXR0bGVXaXRoUm9tYW5zKGJhdHRsZWdyb3VuZCk7XG4gICAgICAgICAgICBpZiAoIWJlc3RCYXR0bGUpIHtcbiAgICAgICAgICAgICAgICAvLyBTaG91bGQgZmluZCB0aGUgb25lIHRoYXQgbWVldHMgY29uZGl0aW9uP1xuICAgICAgICAgICAgICAgIGJlc3RCYXR0bGUgPSBfLmZpbmQoYmF0dGxlZ3JvdW5kLnBvdGVudGlhbEJhdHRsZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxCYXR0bGUgPT4gcG90ZW50aWFsQmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQUVEVUkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYmVzdEJhdHRsZSA9IF8oYmF0dGxlZ3JvdW5kLnBvdGVudGlhbEJhdHRsZXMpLnNvcnRCeShcbiAgICAgICAgICAgICAgICBwb3RlbnRpYWxCYXR0bGUgPT4gKF8uaW5kZXhPZihcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlZ3JvdW5kLmltcG9ydGFudEVuZW1pZXMsIHBvdGVudGlhbEJhdHRsZS5kZWZlbmRpbmdGYWN0aW9uLmlkKSA+PSAwID8gJ2EnIDogJ2InKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuZW15RmFjdGlvblByaW9yaXR5W3BvdGVudGlhbEJhdHRsZS5kZWZlbmRpbmdGYWN0aW9uLmlkXSkuZmlyc3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiZXN0QmF0dGxlO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRWZXJjaW5nZXRvcml4QmF0dGxlV2l0aFJvbWFucyhiYXR0bGVncm91bmQpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChcbiAgICAgICAgICAgIGJhdHRsZWdyb3VuZC5wb3RlbnRpYWxCYXR0bGVzLCBmdW5jdGlvbiAocG90ZW50aWFsQmF0dGxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBvdGVudGlhbEJhdHRsZS5kZWZlbmRpbmdGYWN0aW9uLmlkICE9PSBGYWN0aW9uSURzLlJPTUFOUykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZGVyID0gYmF0dGxlZ3JvdW5kLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWVzYXIgPSBsZWFkZXIgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bVJvbWFuTW9iaWxlID0gYmF0dGxlZ3JvdW5kLnJlZ2lvbi5nZXRNb2JpbGVQaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFjYWVzYXIgfHwgKChudW1Sb21hbk1vYmlsZSAqIDIpIDwgYmF0dGxlZ3JvdW5kLndhcmJhbmRzLmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIHdpbGxWZXJjaW5nZXRvcml4QmF0dGxlQWVkdWkoc3RhdGUsIGJhdHRsZWdyb3VuZCkge1xuICAgICAgICBjb25zdCByb21hbnNQcmVzZW50ID0gYmF0dGxlZ3JvdW5kLnJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLlJPTUFOU107XG4gICAgICAgIGNvbnN0IGFlZHVpQmF0dGxlID0gXy5maW5kKGJhdHRsZWdyb3VuZC5wb3RlbnRpYWxCYXR0bGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxCYXR0bGUgPT4gcG90ZW50aWFsQmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuQUVEVUkpO1xuICAgICAgICByZXR1cm4gIXJvbWFuc1ByZXNlbnQgJiYgYWVkdWlCYXR0bGU7XG4gICAgfVxuXG4gICAgc3RhdGljIG5lZWRBbWJ1c2goYmF0dGxlKSB7XG4gICAgICAgIHJldHVybiBiYXR0bGUuY2FuQW1idXNoICYmXG4gICAgICAgICAgICAgICBiYXR0bGUud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsID4gMCB8fFxuICAgICAgICAgICAgICAgYmF0dGxlLndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLmFtYnVzaCA+IGJhdHRsZS53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5ub3JtYWw7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcnZlcm5pQmF0dGxlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2FydmVybmkvYXJ2ZXJuaUJhdHRsZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFHQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUdBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 127 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NoEvents = [];\nvar CapabilityEvents = [8, 10, 12, 13, 15, 25, 27, 30, 38, 39, 43, 55, 59, 63];\nvar Auto1to4 = [];\nvar EventHandlers = {};\n\nvar ArverniEvent = function () {\n    function ArverniEvent() {\n        _classCallCheck(this, ArverniEvent);\n    }\n\n    _createClass(ArverniEvent, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var currentCard = state.currentCard();\n            console.log('*** Is Arverni No Event? ***');\n            if (_lodash2.default.indexOf(NoEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Is Capability in final year? ***');\n            if (state.isLastYear() && _lodash2.default.indexOf(CapabilityEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            if (_lodash2.default.indexOf(Auto1to4, currentCard.id) < 0 && _lodash2.default.random(1, 6) > 4) {\n                return false;\n            }\n\n            var eventHandler = EventHandlers[currentCard.id];\n            if (!eventHandler) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startEvent(currentCard.id);\n            var handled = eventHandler.handleEvent(state);\n            if (!handled) {\n                state.turnHistory.getCurrentTurn().rollbackEvent();\n            } else {\n                state.turnHistory.getCurrentTurn().commitEvent();\n            }\n\n            return handled;\n        }\n    }]);\n\n    return ArverniEvent;\n}();\n\nexports.default = ArverniEvent;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pRXZlbnQuanM/YTZhZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuXG5jb25zdCBOb0V2ZW50cyA9IFtdO1xuY29uc3QgQ2FwYWJpbGl0eUV2ZW50cyA9IFs4LDEwLDEyLDEzLDE1LDI1LDI3LDMwLDM4LDM5LDQzLDU1LDU5LDYzXTtcbmNvbnN0IEF1dG8xdG80ID0gW107XG5jb25zdCBFdmVudEhhbmRsZXJzID0ge1xuXG59O1xuXG5jbGFzcyBBcnZlcm5pRXZlbnQge1xuXG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDYXJkID0gc3RhdGUuY3VycmVudENhcmQoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBJcyBBcnZlcm5pIE5vIEV2ZW50PyAqKionKTtcbiAgICAgICAgaWYgKF8uaW5kZXhPZihOb0V2ZW50cywgY3VycmVudENhcmQuaWQpID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogSXMgQ2FwYWJpbGl0eSBpbiBmaW5hbCB5ZWFyPyAqKionKTtcbiAgICAgICAgaWYoc3RhdGUuaXNMYXN0WWVhcigpICYmIF8uaW5kZXhPZihDYXBhYmlsaXR5RXZlbnRzLCBjdXJyZW50Q2FyZC5pZCkgPj0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8uaW5kZXhPZihBdXRvMXRvNCwgY3VycmVudENhcmQuaWQpIDwgMCAmJiBfLnJhbmRvbSgxLDYpID4gNCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZXZlbnRIYW5kbGVyID0gRXZlbnRIYW5kbGVyc1tjdXJyZW50Q2FyZC5pZF07XG4gICAgICAgIGlmICghZXZlbnRIYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0RXZlbnQoY3VycmVudENhcmQuaWQpO1xuICAgICAgICBjb25zdCBoYW5kbGVkID0gZXZlbnRIYW5kbGVyLmhhbmRsZUV2ZW50KHN0YXRlKTtcbiAgICAgICAgaWYoIWhhbmRsZWQpIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkucm9sbGJhY2tFdmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRFdmVudCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGhhbmRsZWQ7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFydmVybmlFdmVudDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9hcnZlcm5pL2FydmVybmlFdmVudC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 128 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nvar _raid = __webpack_require__(36);\n\nvar _raid2 = _interopRequireDefault(_raid);\n\nvar _arverniDevastate = __webpack_require__(40);\n\nvar _arverniDevastate2 = _interopRequireDefault(_arverniDevastate);\n\nvar _arverniEntreat = __webpack_require__(41);\n\nvar _arverniEntreat2 = _interopRequireDefault(_arverniEntreat);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _enemyFactionPriority = __webpack_require__(42);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ArverniRaid = function () {\n    function ArverniRaid() {\n        _classCallCheck(this, ArverniRaid);\n    }\n\n    _createClass(ArverniRaid, null, [{\n        key: 'raid',\n        value: function raid(state, modifiers) {\n\n            var effectiveRaidRegions = this.getEffectiveRaidRegions(state, modifiers);\n            if (effectiveRaidRegions.length === 0) {\n                return;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.RAID);\n            _lodash2.default.each(effectiveRaidRegions, function (raidResult) {\n                console.log('*** ' + state.arverni.name + ' Raiding in region ' + raidResult.region.name);\n\n                _revealPieces2.default.execute(state, {\n                    factionId: state.arverni.id,\n                    regionId: raidResult.region.id,\n                    count: raidResult.resourcesGained\n                });\n\n                var numResourcesToSteal = raidResult.resourcesGained;\n                (0, _lodash2.default)(raidResult.raidableFactions).sortBy(function (factionId) {\n                    return _enemyFactionPriority2.default[factionId];\n                }).each(function (factionId) {\n                    var faction = state.factionsById[factionId];\n                    var stolen = Math.min(numResourcesToSteal, faction.resources());\n                    _removeResources2.default.execute(state, { factionId: faction.id, count: stolen });\n                    numResourcesToSteal -= stolen;\n\n                    if (numResourcesToSteal === 0) {\n                        return false;\n                    }\n                });\n\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.ARVERNI, count: raidResult.resourcesGained });\n            });\n            state.turnHistory.getCurrentTurn().commitCommand();\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_arverniDevastate2.default.devastate(state, modifiers) || _arverniEntreat2.default.entreat(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getEffectiveRaidRegions',\n        value: function getEffectiveRaidRegions(state, modifiers) {\n            var raidResults = _raid2.default.test(state, { factionId: _factionIds2.default.ARVERNI });\n            var hasBaggageTrain = state.hasShadedCapability(_capabilities.CapabilityIDs.BAGGAGE_TRAINS, _factionIds2.default.ARVERNI);\n\n            _lodash2.default.each(raidResults, function (result) {\n                var numHiddenWarbands = result.region.getHiddenPiecesForFaction(_factionIds2.default.ARVERNI).length;\n\n                if (numHiddenWarbands <= 1) {\n                    result.resourcesGained = 0;\n                    return;\n                }\n\n                var numRaidingWarbands = Math.min(numHiddenWarbands - 1, hasBaggageTrain ? 3 : 2);\n\n                if (!result.region.devastated()) {\n                    result.resourcesGained = numRaidingWarbands;\n                } else {\n                    var stealableResources = _lodash2.default.reduce(result.raidableFactions, function (sum, factionId) {\n                        if (factionId === _factionIds2.default.ROMANS || factionId === _factionIds2.default.AEDUI || factionId === _factionIds2.default.BELGAE) {\n                            var faction = state.factionsById[factionId];\n                            return sum + faction.resources();\n                        } else {\n                            return sum;\n                        }\n                    }, 0);\n                    result.resourcesGained = Math.min(numRaidingWarbands, stealableResources);\n                }\n            });\n\n            var executable = (0, _lodash2.default)(raidResults).filter(function (result) {\n                return result.resourcesGained > 0;\n            }).sortBy(function (result) {\n                var priority = 'z';\n                _lodash2.default.each(result.raidableFactions, function (factionId) {\n                    if (!state.playersByFaction[factionId].isNonPlayer) {\n                        var factionPriority = 'a' + _enemyFactionPriority2.default[factionId];\n                        if (factionPriority < priority) {\n                            priority = factionPriority;\n                        }\n                    }\n                });\n                priority += '-' + result.resourcesGained;\n                return {\n                    priority: priority,\n                    result: result\n                };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n\n            if (modifiers.limited) {\n                executable = _lodash2.default.take(executable, 1);\n            }\n\n            var numResourcesGained = _lodash2.default.reduce(executable, function (sum, result) {\n                return sum + result.resourcesGained;\n            }, 0);\n\n            if (numResourcesGained > 2) {\n                return executable;\n            } else {\n                return [];\n            }\n        }\n    }]);\n\n    return ArverniRaid;\n}();\n\nexports.default = ArverniRaid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pUmFpZC5qcz81ODY0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFJldmVhbFBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JldmVhbFBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBBZGRSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9hZGRSZXNvdXJjZXMnO1xuaW1wb3J0IFJhaWQgZnJvbSAnLi4vLi4vY29tbWFuZHMvcmFpZCc7XG5pbXBvcnQgQXJ2ZXJuaURldmFzdGF0ZSBmcm9tICcuL2FydmVybmlEZXZhc3RhdGUnO1xuaW1wb3J0IEFydmVybmlFbnRyZWF0IGZyb20gJy4vYXJ2ZXJuaUVudHJlYXQnO1xuaW1wb3J0IHtDYXBhYmlsaXR5SURzfSBmcm9tICcuLi8uLi9jb25maWcvY2FwYWJpbGl0aWVzJztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuaW1wb3J0IEVuZW15RmFjdGlvblByaW9yaXR5IGZyb20gJy4vZW5lbXlGYWN0aW9uUHJpb3JpdHknO1xuXG5jbGFzcyBBcnZlcm5pUmFpZCB7XG4gICAgc3RhdGljIHJhaWQoc3RhdGUsIG1vZGlmaWVycykge1xuXG4gICAgICAgIGNvbnN0IGVmZmVjdGl2ZVJhaWRSZWdpb25zID0gdGhpcy5nZXRFZmZlY3RpdmVSYWlkUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYoZWZmZWN0aXZlUmFpZFJlZ2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLlJBSUQpO1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBlZmZlY3RpdmVSYWlkUmVnaW9ucywgZnVuY3Rpb24gKHJhaWRSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnKioqICcgKyBzdGF0ZS5hcnZlcm5pLm5hbWUgKyAnIFJhaWRpbmcgaW4gcmVnaW9uICcgKyByYWlkUmVzdWx0LnJlZ2lvbi5uYW1lKTtcblxuICAgICAgICAgICAgICAgIFJldmVhbFBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBzdGF0ZS5hcnZlcm5pLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJhaWRSZXN1bHQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHJhaWRSZXN1bHQucmVzb3VyY2VzR2FpbmVkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGV0IG51bVJlc291cmNlc1RvU3RlYWwgPSByYWlkUmVzdWx0LnJlc291cmNlc0dhaW5lZDtcbiAgICAgICAgICAgICAgICBfKHJhaWRSZXN1bHQucmFpZGFibGVGYWN0aW9ucykuc29ydEJ5KGZhY3Rpb25JZCA9PiBFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdKS5lYWNoKFxuICAgICAgICAgICAgICAgICAgICAoZmFjdGlvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW2ZhY3Rpb25JZF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9sZW4gPSBNYXRoLm1pbihudW1SZXNvdXJjZXNUb1N0ZWFsLCBmYWN0aW9uLnJlc291cmNlcygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZVJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogZmFjdGlvbi5pZCwgY291bnQ6IHN0b2xlbn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtUmVzb3VyY2VzVG9TdGVhbCAtPSBzdG9sZW47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1SZXNvdXJjZXNUb1N0ZWFsID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIEFkZFJlc291cmNlcy5leGVjdXRlKHN0YXRlLCB7IGZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JLCBjb3VudDogcmFpZFJlc3VsdC5yZXNvdXJjZXNHYWluZWR9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgY29uc3QgdXNlZFNwZWNpYWxBYmlsaXR5ID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmIChBcnZlcm5pRGV2YXN0YXRlLmRldmFzdGF0ZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBBcnZlcm5pRW50cmVhdC5lbnRyZWF0KHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRFZmZlY3RpdmVSYWlkUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhaWRSZXN1bHRzID0gUmFpZC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkl9KTtcbiAgICAgICAgY29uc3QgaGFzQmFnZ2FnZVRyYWluID0gc3RhdGUuaGFzU2hhZGVkQ2FwYWJpbGl0eShDYXBhYmlsaXR5SURzLkJBR0dBR0VfVFJBSU5TLCBGYWN0aW9uSURzLkFSVkVSTkkpO1xuXG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHJhaWRSZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtSGlkZGVuV2FyYmFuZHMgPSByZXN1bHQucmVnaW9uLmdldEhpZGRlblBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5BUlZFUk5JKS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBpZiAobnVtSGlkZGVuV2FyYmFuZHMgPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVzb3VyY2VzR2FpbmVkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG51bVJhaWRpbmdXYXJiYW5kcyA9IE1hdGgubWluKG51bUhpZGRlbldhcmJhbmRzIC0gMSwgaGFzQmFnZ2FnZVRyYWluID8gMyA6IDIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQucmVnaW9uLmRldmFzdGF0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVzb3VyY2VzR2FpbmVkID0gbnVtUmFpZGluZ1dhcmJhbmRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RlYWxhYmxlUmVzb3VyY2VzID0gXy5yZWR1Y2UoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmFpZGFibGVGYWN0aW9ucywgZnVuY3Rpb24gKHN1bSwgZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUyB8fCBmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuQUVEVUkgfHwgZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW2ZhY3Rpb25JZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBmYWN0aW9uLnJlc291cmNlcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlc291cmNlc0dhaW5lZCA9IE1hdGgubWluKG51bVJhaWRpbmdXYXJiYW5kcywgc3RlYWxhYmxlUmVzb3VyY2VzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZXhlY3V0YWJsZSA9IF8ocmFpZFJlc3VsdHMpLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LnJlc291cmNlc0dhaW5lZCA+IDApLnNvcnRCeShcbiAgICAgICAgICAgIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAneic7XG4gICAgICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmFpZGFibGVGYWN0aW9ucywgKGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWN0aW9uUHJpb3JpdHkgPSAnYScgKyBFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uUHJpb3JpdHkgPCBwcmlvcml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9IGZhY3Rpb25Qcmlvcml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHByaW9yaXR5ICs9ICctJyArIHJlc3VsdC5yZXNvdXJjZXNHYWluZWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS52YWx1ZSgpO1xuXG4gICAgICAgIGlmIChtb2RpZmllcnMubGltaXRlZCkge1xuICAgICAgICAgICAgZXhlY3V0YWJsZSA9IF8udGFrZShleGVjdXRhYmxlLCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG51bVJlc291cmNlc0dhaW5lZCA9IF8ucmVkdWNlKFxuICAgICAgICAgICAgZXhlY3V0YWJsZSwgZnVuY3Rpb24gKHN1bSwgcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHJlc3VsdC5yZXNvdXJjZXNHYWluZWQ7XG4gICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICBpZiAobnVtUmVzb3VyY2VzR2FpbmVkID4gMikge1xuICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGFibGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXJ2ZXJuaVJhaWQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYXJ2ZXJuaS9hcnZlcm5pUmFpZC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 129 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _belgaeRampage = __webpack_require__(52);\n\nvar _belgaeRampage2 = _interopRequireDefault(_belgaeRampage);\n\nvar _belgaeEnlist = __webpack_require__(43);\n\nvar _belgaeEnlist2 = _interopRequireDefault(_belgaeEnlist);\n\nvar _belgaeMarch = __webpack_require__(69);\n\nvar _belgaeMarch2 = _interopRequireDefault(_belgaeMarch);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    PRE_BATTLE_SPECIAL_CHECK: 'pre-battle-special'\n};\n\nvar BelgaeBattle = function () {\n    function BelgaeBattle() {\n        _classCallCheck(this, BelgaeBattle);\n    }\n\n    _createClass(BelgaeBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers) {\n            var belgae = state.belgae;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (belgae.resources() === 0 && !modifiers.free) {\n                return false;\n            }\n\n            var battles = modifiers.context.battles || this.getBattleList(state, modifiers);\n            if (battles.length === 0) {\n                return false;\n            }\n\n            turn.startCommand(_commandIds2.default.BATTLE);\n            modifiers.context.battles = battles;\n\n            if (!turn.getCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK)) {\n                var ambushed = _lodash2.default.find(battles, { willAmbush: true });\n                if (ambushed) {\n                    turn.startSpecialAbility(_specialAbilityIds2.default.AMBUSH);\n                    turn.commitSpecialAbility();\n                    modifiers.context.didPreBattleSpecial = true;\n                } else if (!ambushed && modifiers.canDoSpecial()) {\n                    modifiers.context.didPreBattleSpecial = _belgaeRampage2.default.rampage(state, modifiers) || _belgaeEnlist2.default.enlist(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK);\n            }\n\n            _lodash2.default.each(battles, function (battle) {\n                if (!battle.complete) {\n                    if (!battle.paid && !modifiers.free) {\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: battle.cost });\n                        battle.paid = true;\n                    }\n                    _battle2.default.execute(state, { battleResults: battle });\n                }\n            });\n\n            turn.commitCommand();\n            modifiers.context.battles = null;\n\n            var didSpecial = modifiers.context.didPreBattleSpecial;\n            if (modifiers.canDoSpecial() && !didSpecial) {\n                didSpecial = _belgaeEnlist2.default.enlist(state, modifiers);\n            }\n\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getBattleList',\n        value: function getBattleList(state, modifiers) {\n            var belgae = state.belgae;\n            console.log('*** Are there any effective Belgae Battles? ***');\n\n            var importantBattleRegions = this.findImportantBattleRegions(state, modifiers);\n            if (importantBattleRegions.length === 0) {\n                return [];\n            }\n\n            var battlegrounds = this.findBattlegrounds(state, modifiers, importantBattleRegions);\n            var prioritizedBattles = this.prioritizeBattles(state, battlegrounds);\n\n            if (prioritizedBattles.length === 0 || this.isAmbiorixInDangerWithoutBattle(state, importantBattleRegions, battlegrounds)) {\n                modifiers.context.threatRegions = _lodash2.default.map(importantBattleRegions, function (importantRegion) {\n                    return importantRegion.region.id;\n                });\n                modifiers.context.tryThreatMarch = true;\n                return [];\n            }\n\n            var battles = modifiers.free ? prioritizedBattles : _lodash2.default.reduce(prioritizedBattles, function (accumulator, battle) {\n                if (accumulator.resourcesRemaining >= battle.cost) {\n                    accumulator.resourcesRemaining -= battle.cost;\n                    accumulator.battles.push(battle);\n                }\n                return accumulator;\n            }, { resourcesRemaining: belgae.resources(), battles: [] }).battles;\n\n            if (battles.length > 0) {\n                if (modifiers.limited) {\n                    battles = _lodash2.default.take(battles, 1);\n                }\n\n                if (modifiers.canDoSpecial() && this.needAmbush(battles[0])) {\n                    _lodash2.default.each(battles, function (battle) {\n                        battle.willAmbush = true;\n                    });\n                }\n            }\n\n            return battles;\n        }\n    }, {\n        key: 'findImportantBattleRegions',\n        value: function findImportantBattleRegions(state, modifiers) {\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var piecesByType = _lodash2.default.groupBy(region.piecesByFaction()[_factionIds2.default.BELGAE], 'type');\n                var hasAmbiorix = piecesByType.leader && !piecesByType.leader[0].isSuccessor();\n                var numWarbands = (piecesByType.warband || []).length;\n                if (!hasAmbiorix && numWarbands <= 3) {\n                    return;\n                }\n\n                var importantEnemies = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().filter(function (factionId) {\n                    var enemyPieces = region.piecesByFaction()[factionId] || [];\n                    var enemyPiecesByType = _lodash2.default.groupBy(enemyPieces, 'type');\n\n                    return factionId !== _factionIds2.default.GERMANIC_TRIBES && (enemyPieces.length > 3 || enemyPiecesByType.alliedtribe || enemyPiecesByType.citadel || enemyPiecesByType.legion);\n                }).value();\n\n                if (importantEnemies.length) {\n                    return {\n                        region: region,\n                        hasAmbiorix: hasAmbiorix,\n                        importantEnemies: importantEnemies\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'findBattlegrounds',\n        value: function findBattlegrounds(state, modifiers, importantRegions) {\n            var _this = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var piecesByType = _lodash2.default.groupBy(region.piecesByFaction()[_factionIds2.default.BELGAE], 'type');\n                var hasAmbiorix = piecesByType.leader && !piecesByType.leader[0].isSuccessor();\n                var warbands = piecesByType.warband || [];\n                if (!piecesByType.leader && warbands.length <= 3) {\n                    return;\n                }\n\n                var potentialBattles = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().map(function (factionId) {\n                    if (factionId === _factionIds2.default.GERMANIC_TRIBES) {\n                        return;\n                    }\n                    var enemyPieces = region.piecesByFaction()[factionId] || [];\n                    if (enemyPieces.length === 0) {\n                        return;\n                    }\n                    var battleResult = _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.BELGAE,\n                        defendingFactionId: factionId\n                    });\n\n                    if (!_this.isEffectiveBattle(battleResult)) {\n                        return;\n                    }\n\n                    return battleResult;\n                }).compact().value();\n\n                var importantRegionData = _lodash2.default.find(importantRegions, function (regionData) {\n                    return regionData.region.id === region.id;\n                });\n                var importantEnemies = importantRegionData ? importantRegionData.importantEnemies : null;\n\n                if (potentialBattles.length) {\n                    return {\n                        region: region,\n                        warbands: warbands,\n                        hasAmbiorix: hasAmbiorix,\n                        potentialBattles: potentialBattles,\n                        importantEnemies: importantEnemies\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            return this.willCauseEnoughDefenderLosses(battleResult);\n        }\n    }, {\n        key: 'willCauseEnoughDefenderLosses',\n        value: function willCauseEnoughDefenderLosses(battleResult) {\n            if (battleResult.worstCaseDefenderLosses.normal > 0 && battleResult.worstCaseDefenderLosses.normal >= battleResult.worstCaseAttackerLosses.normal) {\n                return true;\n            }\n\n            return battleResult.canAmbush && battleResult.worstCaseDefenderLosses.ambush > 0 && battleResult.worstCaseDefenderLosses.ambush >= battleResult.worstCaseAttackerLosses.ambush;\n        }\n    }, {\n        key: 'isAmbiorixInDangerWithoutBattle',\n        value: function isAmbiorixInDangerWithoutBattle(state, importantBattleRegions, battlegrounds) {\n            var ambiorixInDanger = _lodash2.default.find(importantBattleRegions, { hasAmbiorix: true });\n            if (!ambiorixInDanger) {\n                return false;\n            }\n\n            var ambiorixBattleground = _lodash2.default.find(battlegrounds, { hasAmbiorix: true });\n\n            if (!ambiorixBattleground) {\n                return true;\n            }\n\n            var willBattleRomans = this.getAmbiorixBattleWithRomans(ambiorixBattleground);\n            var willBattleGauls = this.willAmbiorixBattleGallicFaction(state, ambiorixBattleground);\n            var canAfford = state.belgae.resources() >= (ambiorixBattleground.region.devastated() ? 2 : 1);\n\n            return !canAfford || !willBattleRomans && !willBattleGauls;\n        }\n    }, {\n        key: 'prioritizeBattles',\n        value: function prioritizeBattles(state, battlegrounds) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(battlegrounds).map(function (battleground) {\n                var priority = 'c';\n\n                var bestBattle = _this2.getBestBattleForBattleground(state, battleground);\n\n                if (battleground.hasAmbiorix) {\n                    priority = 'a';\n                } else if (_lodash2.default.indexOf(battleground.importantEnemies, bestBattle.defendingFaction.id) >= 0) {\n                    priority = 'b';\n                }\n\n                if (bestBattle) {\n                    return {\n                        priority: priority,\n                        bestBattle: bestBattle\n                    };\n                }\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('bestBattle').value();\n        }\n    }, {\n        key: 'getBestBattleForBattleground',\n        value: function getBestBattleForBattleground(state, battleground) {\n\n            var bestBattle = null;\n            if (battleground.hasAmbiorix) {\n                bestBattle = this.getAmbiorixBattleWithRomans(battleground);\n                if (!bestBattle) {\n                    // Should find the one that meets condition?\n                    bestBattle = _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                        return potentialBattle.defendingFaction.id !== _factionIds2.default.ROMANS;\n                    });\n                }\n            } else {\n                bestBattle = (0, _lodash2.default)(battleground.potentialBattles).sortBy(function (potentialBattle) {\n                    return (_lodash2.default.indexOf(battleground.importantEnemies, potentialBattle.defendingFaction.id) >= 0 ? 'a' : 'b') + _enemyFactionPriority2.default[potentialBattle.defendingFaction.id];\n                }).first();\n            }\n\n            return bestBattle;\n        }\n    }, {\n        key: 'getAmbiorixBattleWithRomans',\n        value: function getAmbiorixBattleWithRomans(battleground) {\n            return _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                if (potentialBattle.defendingFaction.id !== _factionIds2.default.ROMANS) {\n                    return false;\n                }\n                var numRomanMobile = battleground.region.getMobilePiecesForFaction(_factionIds2.default.ROMANS).length;\n                return numRomanMobile < battleground.warbands.length + 1;\n            });\n        }\n    }, {\n        key: 'willAmbiorixBattleGallicFaction',\n        value: function willAmbiorixBattleGallicFaction(state, battleground) {\n            var romansPresent = battleground.region.piecesByFaction()[_factionIds2.default.ROMANS];\n            var gallicBattle = _lodash2.default.find(battleground.potentialBattles, function (potentialBattle) {\n                return potentialBattle.defendingFaction.id !== _factionIds2.default.ROMANS;\n            });\n            return !romansPresent && gallicBattle;\n        }\n    }, {\n        key: 'needAmbush',\n        value: function needAmbush(battle) {\n            return battle.canAmbush && battle.worstCaseAttackerLosses.normal > 0 || battle.worstCaseDefenderLosses.ambush > battle.worstCaseDefenderLosses.normal;\n        }\n    }]);\n\n    return BelgaeBattle;\n}();\n\nexports.default = BelgaeBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUJhdHRsZS5qcz9kMmExIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQmF0dGxlIGZyb20gJy4uLy4uL2NvbW1hbmRzL2JhdHRsZSc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5pbXBvcnQgQmVsZ2FlUmFtcGFnZSBmcm9tICcuL2JlbGdhZVJhbXBhZ2UnO1xuaW1wb3J0IEJlbGdhZUVubGlzdCBmcm9tICcuL2JlbGdhZUVubGlzdCc7XG5pbXBvcnQgQmVsZ2FlTWFyY2ggZnJvbSAnLi9iZWxnYWVNYXJjaCc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuXG5jb25zdCBDaGVja3BvaW50cyA9IHtcbiAgICBQUkVfQkFUVExFX1NQRUNJQUxfQ0hFQ0s6ICdwcmUtYmF0dGxlLXNwZWNpYWwnXG59O1xuXG5jbGFzcyBCZWxnYWVCYXR0bGUge1xuXG4gICAgc3RhdGljIGJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGJlbGdhZSA9IHN0YXRlLmJlbGdhZTtcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG5cbiAgICAgICAgaWYgKGJlbGdhZS5yZXNvdXJjZXMoKSA9PT0gMCAmJiAhbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzIHx8IHRoaXMuZ2V0QmF0dGxlTGlzdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0dXJuLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLkJBVFRMRSk7XG4gICAgICAgIG1vZGlmaWVycy5jb250ZXh0LmJhdHRsZXMgPSBiYXR0bGVzO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlBSRV9CQVRUTEVfU1BFQ0lBTF9DSEVDSykpIHtcbiAgICAgICAgICAgIGNvbnN0IGFtYnVzaGVkID0gXy5maW5kKGJhdHRsZXMsIHt3aWxsQW1idXNoOiB0cnVlfSk7XG4gICAgICAgICAgICBpZiAoYW1idXNoZWQpIHtcbiAgICAgICAgICAgICAgICB0dXJuLnN0YXJ0U3BlY2lhbEFiaWxpdHkoU3BlY2lhbEFiaWxpdHlJRHMuQU1CVVNIKTtcbiAgICAgICAgICAgICAgICB0dXJuLmNvbW1pdFNwZWNpYWxBYmlsaXR5KCk7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlQmF0dGxlU3BlY2lhbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghYW1idXNoZWQgJiYgbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpKSB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlQmF0dGxlU3BlY2lhbCA9IEJlbGdhZVJhbXBhZ2UucmFtcGFnZShzdGF0ZSwgbW9kaWZpZXJzKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCZWxnYWVFbmxpc3QuZW5saXN0KHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5QUkVfQkFUVExFX1NQRUNJQUxfQ0hFQ0spO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5lYWNoKGJhdHRsZXMsIChiYXR0bGUpID0+IHtcbiAgICAgICAgICAgIGlmICghYmF0dGxlLmNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFiYXR0bGUucGFpZCAmJiAhbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFLCBjb3VudDogYmF0dGxlLmNvc3R9KTtcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlLnBhaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBCYXR0bGUuZXhlY3V0ZShzdGF0ZSwge2JhdHRsZVJlc3VsdHM6IGJhdHRsZX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0dXJuLmNvbW1pdENvbW1hbmQoKTtcbiAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuYmF0dGxlcyA9IG51bGw7XG5cbiAgICAgICAgbGV0IGRpZFNwZWNpYWwgPSBtb2RpZmllcnMuY29udGV4dC5kaWRQcmVCYXR0bGVTcGVjaWFsO1xuICAgICAgICBpZiAobW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmICFkaWRTcGVjaWFsKSB7XG4gICAgICAgICAgICBkaWRTcGVjaWFsID0gQmVsZ2FlRW5saXN0LmVubGlzdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWRTcGVjaWFsID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEJhdHRsZUxpc3Qoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCBiZWxnYWUgPSBzdGF0ZS5iZWxnYWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQXJlIHRoZXJlIGFueSBlZmZlY3RpdmUgQmVsZ2FlIEJhdHRsZXM/ICoqKicpO1xuXG4gICAgICAgIGNvbnN0IGltcG9ydGFudEJhdHRsZVJlZ2lvbnMgPSB0aGlzLmZpbmRJbXBvcnRhbnRCYXR0bGVSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICBpZiAoaW1wb3J0YW50QmF0dGxlUmVnaW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdHRsZWdyb3VuZHMgPSB0aGlzLmZpbmRCYXR0bGVncm91bmRzKHN0YXRlLCBtb2RpZmllcnMsIGltcG9ydGFudEJhdHRsZVJlZ2lvbnMpO1xuICAgICAgICBjb25zdCBwcmlvcml0aXplZEJhdHRsZXMgPSB0aGlzLnByaW9yaXRpemVCYXR0bGVzKHN0YXRlLCBiYXR0bGVncm91bmRzKTtcblxuICAgICAgICBpZiAocHJpb3JpdGl6ZWRCYXR0bGVzLmxlbmd0aCA9PT0gMCB8fCB0aGlzLmlzQW1iaW9yaXhJbkRhbmdlcldpdGhvdXRCYXR0bGUoc3RhdGUsIGltcG9ydGFudEJhdHRsZVJlZ2lvbnMsIGJhdHRsZWdyb3VuZHMpKSB7XG4gICAgICAgICAgICBtb2RpZmllcnMuY29udGV4dC50aHJlYXRSZWdpb25zID0gXy5tYXAoaW1wb3J0YW50QmF0dGxlUmVnaW9ucywgaW1wb3J0YW50UmVnaW9uID0+IGltcG9ydGFudFJlZ2lvbi5yZWdpb24uaWQpO1xuICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQudHJ5VGhyZWF0TWFyY2ggPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGJhdHRsZXMgPSBtb2RpZmllcnMuZnJlZSA/IHByaW9yaXRpemVkQmF0dGxlcyA6IF8ucmVkdWNlKHByaW9yaXRpemVkQmF0dGxlcywgKGFjY3VtdWxhdG9yLCBiYXR0bGUpID0+IHtcbiAgICAgICAgICAgIGlmIChhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgPj0gYmF0dGxlLmNvc3QpIHtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgLT0gYmF0dGxlLmNvc3Q7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IuYmF0dGxlcy5wdXNoKGJhdHRsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3JcbiAgICAgICAgfSwge3Jlc291cmNlc1JlbWFpbmluZzogYmVsZ2FlLnJlc291cmNlcygpLCBiYXR0bGVzOiBbXX0pLmJhdHRsZXM7XG5cbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5saW1pdGVkKSB7XG4gICAgICAgICAgICAgICAgYmF0dGxlcyA9IF8udGFrZShiYXR0bGVzLCAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5jYW5Eb1NwZWNpYWwoKSAmJiB0aGlzLm5lZWRBbWJ1c2goYmF0dGxlc1swXSkpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2goYmF0dGxlcywgKGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBiYXR0bGUud2lsbEFtYnVzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiYXR0bGVzO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kSW1wb3J0YW50QmF0dGxlUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNCeVR5cGUgPSBfLmdyb3VwQnkocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXSwgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbWJpb3JpeCA9IHBpZWNlc0J5VHlwZS5sZWFkZXIgJiYgIXBpZWNlc0J5VHlwZS5sZWFkZXJbMF0uaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBudW1XYXJiYW5kcyA9IChwaWVjZXNCeVR5cGUud2FyYmFuZCB8fCBbXSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICghaGFzQW1iaW9yaXggJiYgbnVtV2FyYmFuZHMgPD0gMykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0YW50RW5lbWllcyA9IF8oRW5lbXlGYWN0aW9uUHJpb3JpdHkpLmtleXMoKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZW15UGllY2VzID0gcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW2ZhY3Rpb25JZF0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmVteVBpZWNlc0J5VHlwZSA9IF8uZ3JvdXBCeShlbmVteVBpZWNlcywgJ3R5cGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rpb25JZCAhPT0gRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMgJiYgKGVuZW15UGllY2VzLmxlbmd0aCA+IDMgfHwgZW5lbXlQaWVjZXNCeVR5cGUuYWxsaWVkdHJpYmUgfHwgZW5lbXlQaWVjZXNCeVR5cGUuY2l0YWRlbCB8fCBlbmVteVBpZWNlc0J5VHlwZS5sZWdpb24pO1xuICAgICAgICAgICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGltcG9ydGFudEVuZW1pZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNBbWJpb3JpeCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGFudEVuZW1pZXNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kQmF0dGxlZ3JvdW5kcyhzdGF0ZSwgbW9kaWZpZXJzLCBpbXBvcnRhbnRSZWdpb25zKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNCeVR5cGUgPSBfLmdyb3VwQnkocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQkVMR0FFXSwgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbWJpb3JpeCA9IHBpZWNlc0J5VHlwZS5sZWFkZXIgJiYgIXBpZWNlc0J5VHlwZS5sZWFkZXJbMF0uaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXJiYW5kcyA9IHBpZWNlc0J5VHlwZS53YXJiYW5kIHx8IFtdO1xuICAgICAgICAgICAgICAgIGlmICghcGllY2VzQnlUeXBlLmxlYWRlciAmJiB3YXJiYW5kcy5sZW5ndGggPD0gMykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgcG90ZW50aWFsQmF0dGxlcyA9IF8oRW5lbXlGYWN0aW9uUHJpb3JpdHkpLmtleXMoKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5lbXlQaWVjZXMgPSByZWdpb24ucGllY2VzQnlGYWN0aW9uKClbZmFjdGlvbklkXSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmVteVBpZWNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXR0bGVSZXN1bHQgPSBCYXR0bGUudGVzdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBmYWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRWZmZWN0aXZlQmF0dGxlKGJhdHRsZVJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0YW50UmVnaW9uRGF0YSA9IF8uZmluZChpbXBvcnRhbnRSZWdpb25zLCByZWdpb25EYXRhID0+IHJlZ2lvbkRhdGEucmVnaW9uLmlkID09PSByZWdpb24uaWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGltcG9ydGFudEVuZW1pZXMgPSBpbXBvcnRhbnRSZWdpb25EYXRhID8gaW1wb3J0YW50UmVnaW9uRGF0YS5pbXBvcnRhbnRFbmVtaWVzIDogbnVsbDtcblxuICAgICAgICAgICAgICAgIGlmIChwb3RlbnRpYWxCYXR0bGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2FyYmFuZHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNBbWJpb3JpeCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvdGVudGlhbEJhdHRsZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRhbnRFbmVtaWVzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNFZmZlY3RpdmVCYXR0bGUoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLndpbGxDYXVzZUVub3VnaERlZmVuZGVyTG9zc2VzKGJhdHRsZVJlc3VsdCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHdpbGxDYXVzZUVub3VnaERlZmVuZGVyTG9zc2VzKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICBpZiAoYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+IDAgJiYgYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLm5vcm1hbCA+PSBiYXR0bGVSZXN1bHQud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQuY2FuQW1idXNoICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPiAwICYmIGJhdHRsZVJlc3VsdC53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPj0gYmF0dGxlUmVzdWx0LndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLmFtYnVzaDtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNBbWJpb3JpeEluRGFuZ2VyV2l0aG91dEJhdHRsZShzdGF0ZSwgaW1wb3J0YW50QmF0dGxlUmVnaW9ucywgYmF0dGxlZ3JvdW5kcykge1xuICAgICAgICBjb25zdCBhbWJpb3JpeEluRGFuZ2VyID0gXy5maW5kKGltcG9ydGFudEJhdHRsZVJlZ2lvbnMsIHtoYXNBbWJpb3JpeDogdHJ1ZX0pO1xuICAgICAgICBpZiAoIWFtYmlvcml4SW5EYW5nZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFtYmlvcml4QmF0dGxlZ3JvdW5kID0gXy5maW5kKGJhdHRsZWdyb3VuZHMsIHtoYXNBbWJpb3JpeDogdHJ1ZX0pO1xuXG4gICAgICAgIGlmICghYW1iaW9yaXhCYXR0bGVncm91bmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgd2lsbEJhdHRsZVJvbWFucyA9IHRoaXMuZ2V0QW1iaW9yaXhCYXR0bGVXaXRoUm9tYW5zKGFtYmlvcml4QmF0dGxlZ3JvdW5kKTtcbiAgICAgICAgY29uc3Qgd2lsbEJhdHRsZUdhdWxzID0gdGhpcy53aWxsQW1iaW9yaXhCYXR0bGVHYWxsaWNGYWN0aW9uKHN0YXRlLCBhbWJpb3JpeEJhdHRsZWdyb3VuZCk7XG4gICAgICAgIGNvbnN0IGNhbkFmZm9yZCA9IHN0YXRlLmJlbGdhZS5yZXNvdXJjZXMoKSA+PSAoYW1iaW9yaXhCYXR0bGVncm91bmQucmVnaW9uLmRldmFzdGF0ZWQoKSA/IDIgOiAxKTtcblxuICAgICAgICByZXR1cm4gIWNhbkFmZm9yZCB8fCAoIXdpbGxCYXR0bGVSb21hbnMgJiYgIXdpbGxCYXR0bGVHYXVscyk7XG4gICAgfVxuXG4gICAgc3RhdGljIHByaW9yaXRpemVCYXR0bGVzKHN0YXRlLCBiYXR0bGVncm91bmRzKSB7XG4gICAgICAgIHJldHVybiBfKGJhdHRsZWdyb3VuZHMpLm1hcChcbiAgICAgICAgICAgIChiYXR0bGVncm91bmQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAnYyc7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0QmF0dGxlID0gdGhpcy5nZXRCZXN0QmF0dGxlRm9yQmF0dGxlZ3JvdW5kKHN0YXRlLCBiYXR0bGVncm91bmQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGJhdHRsZWdyb3VuZC5oYXNBbWJpb3JpeCkge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoXy5pbmRleE9mKGJhdHRsZWdyb3VuZC5pbXBvcnRhbnRFbmVtaWVzLCBiZXN0QmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24uaWQpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYic7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGJlc3RCYXR0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYmVzdEJhdHRsZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5tYXAoJ2Jlc3RCYXR0bGUnKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCZXN0QmF0dGxlRm9yQmF0dGxlZ3JvdW5kKHN0YXRlLCBiYXR0bGVncm91bmQpIHtcblxuICAgICAgICBsZXQgYmVzdEJhdHRsZSA9IG51bGw7XG4gICAgICAgIGlmIChiYXR0bGVncm91bmQuaGFzQW1iaW9yaXgpIHtcbiAgICAgICAgICAgIGJlc3RCYXR0bGUgPSB0aGlzLmdldEFtYmlvcml4QmF0dGxlV2l0aFJvbWFucyhiYXR0bGVncm91bmQpO1xuICAgICAgICAgICAgaWYgKCFiZXN0QmF0dGxlKSB7XG4gICAgICAgICAgICAgICAgLy8gU2hvdWxkIGZpbmQgdGhlIG9uZSB0aGF0IG1lZXRzIGNvbmRpdGlvbj9cbiAgICAgICAgICAgICAgICBiZXN0QmF0dGxlID0gXy5maW5kKGJhdHRsZWdyb3VuZC5wb3RlbnRpYWxCYXR0bGVzLCBwb3RlbnRpYWxCYXR0bGUgPT4gcG90ZW50aWFsQmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24uaWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJlc3RCYXR0bGUgPSBfKGJhdHRsZWdyb3VuZC5wb3RlbnRpYWxCYXR0bGVzKS5zb3J0QnkoXG4gICAgICAgICAgICAgICAgcG90ZW50aWFsQmF0dGxlID0+IChfLmluZGV4T2YoXG4gICAgICAgICAgICAgICAgICAgIGJhdHRsZWdyb3VuZC5pbXBvcnRhbnRFbmVtaWVzLCBwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZCkgPj0gMCA/ICdhJyA6ICdiJykgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmVteUZhY3Rpb25Qcmlvcml0eVtwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZF0pLmZpcnN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmVzdEJhdHRsZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0QW1iaW9yaXhCYXR0bGVXaXRoUm9tYW5zKGJhdHRsZWdyb3VuZCkge1xuICAgICAgICByZXR1cm4gXy5maW5kKFxuICAgICAgICAgICAgYmF0dGxlZ3JvdW5kLnBvdGVudGlhbEJhdHRsZXMsIGZ1bmN0aW9uIChwb3RlbnRpYWxCYXR0bGUpIHtcbiAgICAgICAgICAgICAgICBpZiAocG90ZW50aWFsQmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24uaWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtUm9tYW5Nb2JpbGUgPSBiYXR0bGVncm91bmQucmVnaW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtUm9tYW5Nb2JpbGUgPCBiYXR0bGVncm91bmQud2FyYmFuZHMubGVuZ3RoICsgMTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyB3aWxsQW1iaW9yaXhCYXR0bGVHYWxsaWNGYWN0aW9uKHN0YXRlLCBiYXR0bGVncm91bmQpIHtcbiAgICAgICAgY29uc3Qgcm9tYW5zUHJlc2VudCA9IGJhdHRsZWdyb3VuZC5yZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5ST01BTlNdO1xuICAgICAgICBjb25zdCBnYWxsaWNCYXR0bGUgPSBfLmZpbmQoYmF0dGxlZ3JvdW5kLnBvdGVudGlhbEJhdHRsZXMsIHBvdGVudGlhbEJhdHRsZSA9PiBwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZCAhPT0gRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICByZXR1cm4gIXJvbWFuc1ByZXNlbnQgJiYgZ2FsbGljQmF0dGxlO1xuICAgIH1cblxuICAgIHN0YXRpYyBuZWVkQW1idXNoKGJhdHRsZSkge1xuICAgICAgICByZXR1cm4gYmF0dGxlLmNhbkFtYnVzaCAmJlxuICAgICAgICAgICAgICAgYmF0dGxlLndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLm5vcm1hbCA+IDAgfHxcbiAgICAgICAgICAgICAgIGJhdHRsZS53b3JzdENhc2VEZWZlbmRlckxvc3Nlcy5hbWJ1c2ggPiBiYXR0bGUud29yc3RDYXNlRGVmZW5kZXJMb3NzZXMubm9ybWFsO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlQmF0dGxlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9iZWxnYWVCYXR0bGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFHQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 130 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NoEvents = [];\nvar CapabilityEvents = [8, 10, 12, 13, 15, 25, 27, 30, 38, 39, 43, 55, 59, 63];\nvar EventHandlers = {};\n\nvar BelgaeEvent = function () {\n    function BelgaeEvent() {\n        _classCallCheck(this, BelgaeEvent);\n    }\n\n    _createClass(BelgaeEvent, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var currentCard = state.currentCard();\n            console.log('*** Is Belgae No Event? ***');\n            if (_lodash2.default.indexOf(NoEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Is Capability in final year? ***');\n            if (state.isLastYear() && _lodash2.default.indexOf(CapabilityEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            var eventHandler = EventHandlers[currentCard.id];\n            if (!eventHandler) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startEvent(currentCard.id);\n            var handled = eventHandler.handleEvent(state);\n            if (!handled) {\n                state.turnHistory.getCurrentTurn().rollbackEvent();\n            } else {\n                state.turnHistory.getCurrentTurn().commitEvent();\n            }\n\n            return handled;\n        }\n    }]);\n\n    return BelgaeEvent;\n}();\n\nexports.default = BelgaeEvent;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUV2ZW50LmpzPzVjN2MiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5cblxuY29uc3QgTm9FdmVudHMgPSBbXTtcbmNvbnN0IENhcGFiaWxpdHlFdmVudHMgPSBbOCwxMCwxMiwxMywxNSwyNSwyNywzMCwzOCwzOSw0Myw1NSw1OSw2M107XG5jb25zdCBFdmVudEhhbmRsZXJzID0ge1xuXG59O1xuXG5jbGFzcyBCZWxnYWVFdmVudCB7XG5cbiAgICBzdGF0aWMgaGFuZGxlRXZlbnQoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgY3VycmVudENhcmQgPSBzdGF0ZS5jdXJyZW50Q2FyZCgpO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIElzIEJlbGdhZSBObyBFdmVudD8gKioqJyk7XG4gICAgICAgIGlmIChfLmluZGV4T2YoTm9FdmVudHMsIGN1cnJlbnRDYXJkLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnKioqIElzIENhcGFiaWxpdHkgaW4gZmluYWwgeWVhcj8gKioqJyk7XG4gICAgICAgIGlmKHN0YXRlLmlzTGFzdFllYXIoKSAmJiBfLmluZGV4T2YoQ2FwYWJpbGl0eUV2ZW50cywgY3VycmVudENhcmQuaWQpID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IEV2ZW50SGFuZGxlcnNbY3VycmVudENhcmQuaWRdO1xuICAgICAgICBpZiAoIWV2ZW50SGFuZGxlcikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydEV2ZW50KGN1cnJlbnRDYXJkLmlkKTtcbiAgICAgICAgY29uc3QgaGFuZGxlZCA9IGV2ZW50SGFuZGxlci5oYW5kbGVFdmVudChzdGF0ZSk7XG4gICAgICAgIGlmKCFoYW5kbGVkKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrRXZlbnQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0RXZlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBoYW5kbGVkO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBCZWxnYWVFdmVudDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlRXZlbnQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 131 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeGermanicBattle = function () {\n    function BelgaeGermanicBattle() {\n        _classCallCheck(this, BelgaeGermanicBattle);\n    }\n\n    _createClass(BelgaeGermanicBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers, enlistResults) {\n\n            var effective = false;\n            var validRegions = _lodash2.default.map(enlistResults, function (result) {\n                return result.region.id;\n            });\n            var effectiveBattle = this.findEffectiveBattle(state, validRegions);\n            if (effectiveBattle) {\n                console.log('*** Belgae Enlisted Germanic Battle ***');\n                _battle2.default.execute(state, {\n                    region: effectiveBattle.region,\n                    attackingFaction: effectiveBattle.attackingFaction,\n                    defendingFaction: effectiveBattle.defendingFaction,\n                    ambush: true\n                });\n                effective = true;\n            }\n            return effective;\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            return (0, _lodash2.default)(state.factions).reject({ id: _factionIds2.default.GERMANIC_TRIBES }).reject(function (faction) {\n                return faction.id === _factionIds2.default.BELGAE;\n            }).partition('isNonPlayer').map(_lodash2.default.shuffle).flatten().sortBy('isNonPlayer').value();\n        }\n    }, {\n        key: 'findEffectiveBattle',\n        value: function findEffectiveBattle(state, validRegions) {\n            var _this = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                if (_lodash2.default.indexOf(validRegions, region.id) < 0) {\n                    return;\n                }\n                var enemyFactionOrder = _this.getEnemyFactionOrder(state);\n                return (0, _lodash2.default)(enemyFactionOrder).map(function (faction) {\n                    return _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.GERMANIC_TRIBES,\n                        defendingFactionId: faction.id\n                    });\n                }).filter(_this.isEffectiveBattle).first();\n            }).compact().first();\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            return battleResult.canAmbush && battleResult.worstCaseDefenderLosses.ambush > 0;\n        }\n    }]);\n\n    return BelgaeGermanicBattle;\n}();\n\nexports.default = BelgaeGermanicBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUdlcm1hbmljQmF0dGxlLmpzPzg2NTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQmF0dGxlIGZyb20gJy4uLy4uL2NvbW1hbmRzL2JhdHRsZSc7XG5cbmNsYXNzIEJlbGdhZUdlcm1hbmljQmF0dGxlIHtcblxuICAgIHN0YXRpYyBiYXR0bGUoc3RhdGUsIG1vZGlmaWVycywgZW5saXN0UmVzdWx0cykge1xuXG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgdmFsaWRSZWdpb25zID0gXy5tYXAoZW5saXN0UmVzdWx0cywgcmVzdWx0ID0+IHJlc3VsdC5yZWdpb24uaWQpO1xuICAgICAgICBjb25zdCBlZmZlY3RpdmVCYXR0bGUgPSB0aGlzLmZpbmRFZmZlY3RpdmVCYXR0bGUoc3RhdGUsIHZhbGlkUmVnaW9ucyk7XG4gICAgICAgIGlmIChlZmZlY3RpdmVCYXR0bGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcqKiogQmVsZ2FlIEVubGlzdGVkIEdlcm1hbmljIEJhdHRsZSAqKionKTtcbiAgICAgICAgICAgIEJhdHRsZS5leGVjdXRlKFxuICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogZWZmZWN0aXZlQmF0dGxlLnJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbjogZWZmZWN0aXZlQmF0dGxlLmF0dGFja2luZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb246IGVmZmVjdGl2ZUJhdHRsZS5kZWZlbmRpbmdGYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBhbWJ1c2g6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RW5lbXlGYWN0aW9uT3JkZXIoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8oc3RhdGUuZmFjdGlvbnMpLnJlamVjdCh7aWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTfSkucmVqZWN0KGZhY3Rpb24gPT4gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5CRUxHQUUpLnBhcnRpdGlvbignaXNOb25QbGF5ZXInKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuc29ydEJ5KCdpc05vblBsYXllcicpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRFZmZlY3RpdmVCYXR0bGUoc3RhdGUsIHZhbGlkUmVnaW9ucykge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoXy5pbmRleE9mKHZhbGlkUmVnaW9ucywgcmVnaW9uLmlkKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBlbmVteUZhY3Rpb25PcmRlciA9IHRoaXMuZ2V0RW5lbXlGYWN0aW9uT3JkZXIoc3RhdGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfKGVuZW15RmFjdGlvbk9yZGVyKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChmYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQmF0dGxlLnRlc3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb25JZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb25JZDogZmFjdGlvbi5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KS5maWx0ZXIodGhpcy5pc0VmZmVjdGl2ZUJhdHRsZSkuZmlyc3QoKTtcbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5maXJzdCgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0VmZmVjdGl2ZUJhdHRsZShiYXR0bGVSZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIGJhdHRsZVJlc3VsdC5jYW5BbWJ1c2ggJiYgYmF0dGxlUmVzdWx0LndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzLmFtYnVzaCA+IDA7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBCZWxnYWVHZXJtYW5pY0JhdHRsZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlR2VybWFuaWNCYXR0bGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 132 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeGermanicMarch = function () {\n    function BelgaeGermanicMarch() {\n        _classCallCheck(this, BelgaeGermanicMarch);\n    }\n\n    _createClass(BelgaeGermanicMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers, enlistResults) {\n\n            var effective = false;\n            var validRegions = (0, _lodash2.default)(enlistResults).filter(function (result) {\n                return result.region.group === _regionGroups2.default.BELGICA || result.region.group === _regionGroups2.default.GERMANIA;\n            }).map(function (result) {\n                return result.region.id;\n            }).value();\n\n            var effectiveMarch = this.findEffectiveMarch(state, modifiers, validRegions);\n\n            if (effectiveMarch) {\n                console.log('*** Belgae Enlisted Germanic March ***');\n                _hidePieces2.default.execute(state, {\n                    factionId: _factionIds2.default.GERMANIC_TRIBES,\n                    regionId: effectiveMarch.region.id\n                });\n\n                var marchingWarbands = this.getMarchingWarbands(effectiveMarch.region);\n                var destination = effectiveMarch.destination;\n                if (destination) {\n                    _movePieces2.default.execute(state, {\n                        sourceRegionId: effectiveMarch.region.id,\n                        destRegionId: destination.id,\n                        pieces: marchingWarbands\n                    });\n                }\n                effective = true;\n            }\n            return effective;\n        }\n    }, {\n        key: 'findEffectiveMarch',\n        value: function findEffectiveMarch(state, modifiers, validRegions) {\n            var _this = this;\n\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            return (0, _lodash2.default)(marchResults).reject(function (marchResult) {\n                if (_this.getMarchingWarbands(marchResult.region).length < 4) {\n                    return true;\n                }\n                if (_lodash2.default.indexOf(validRegions, marchResult.region.id) < 0) {\n                    return true;\n                }\n            }).map(function (marchResult) {\n                var destinationData = _this.findEffectiveDestination(state, marchResult.destinations);\n                if (!destinationData && !_lodash2.default.find(marchResult.region.getMobilePiecesForFaction(_factionIds2.default.GERMANIC_TRIBES), function (piece) {\n                    return piece.revealed();\n                })) {\n                    return;\n                }\n                return {\n                    region: marchResult.region,\n                    destination: destinationData ? destinationData.destination : null,\n                    priority: destinationData ? destinationData.priority : 5\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n        }\n    }, {\n        key: 'hideAllWarbands',\n        value: function hideAllWarbands(state, faction) {\n            _lodash2.default.each(state.regions, function (region) {\n                var mobilePieces = region.getMobilePiecesForFaction(_factionIds2.default.GERMANIC_TRIBES);\n                if (mobilePieces.length) {\n                    _hidePieces2.default.execute(state, {\n                        factionId: faction.id,\n                        regionId: region.id\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'getMarchingWarbands',\n        value: function getMarchingWarbands(region) {\n            var mobilePieces = (0, _lodash2.default)(region.piecesByFaction()[_factionIds2.default.GERMANIC_TRIBES]).filter({ isMobile: true }).sortBy(function (piece) {\n                if (piece.scouted()) {\n                    return 'a';\n                } else if (piece.revealed()) {\n                    return 'b';\n                } else {\n                    return 'c';\n                }\n            }).value();\n            var numMarching = mobilePieces.length;\n            return _lodash2.default.take(mobilePieces, numMarching);\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            var factionOrder = (0, _lodash2.default)(_enemyFactionPriority2.default).map(function (priority, factionId) {\n                return { priority: priority, factionId: factionId, player: state.playersByFaction[factionId] };\n            }).reject({ factionId: _factionIds2.default.GERMANIC_TRIBES }).reject({ factionId: _factionIds2.default.BELGAE }).partition('isNonPlayer').flatten().sortBy('isNonPlayer').value();\n            var factionOrderById = {};\n            _lodash2.default.each(factionOrder, function (faction, index) {\n                factionOrderById[faction.id] = index + 1;\n            });\n            return factionOrderById;\n        }\n    }, {\n        key: 'findEffectiveDestination',\n        value: function findEffectiveDestination(state, destinations) {\n            //const enemyFactionOrder = this.getEnemyFactionOrder(state);\n            return (0, _lodash2.default)(destinations).filter(function (destination) {\n                return destination.controllingFactionId();\n            }).map(function (destination) {\n                return {\n                    destination: destination,\n                    priority: _enemyFactionPriority2.default[destination.controllingFactionId()]\n                };\n            }).reject(function (destinationData) {\n                return !destinationData.priority;\n            }).sortBy('priority').first();\n        }\n    }]);\n\n    return BelgaeGermanicMarch;\n}();\n\nexports.default = BelgaeGermanicMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUdlcm1hbmljTWFyY2guanM/MGZkNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25Hcm91cHMgZnJvbSAnLi4vLi4vY29uZmlnL3JlZ2lvbkdyb3Vwcyc7XG5pbXBvcnQgTWFyY2ggZnJvbSAnLi4vLi4vY29tbWFuZHMvbWFyY2gnO1xuaW1wb3J0IE1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9tb3ZlUGllY2VzJztcbmltcG9ydCBIaWRlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvaGlkZVBpZWNlcyc7XG5pbXBvcnQgRW5lbXlGYWN0aW9uUHJpb3JpdHkgZnJvbSAnLi9lbmVteUZhY3Rpb25Qcmlvcml0eSc7XG5cbmNsYXNzIEJlbGdhZUdlcm1hbmljTWFyY2gge1xuXG4gICAgc3RhdGljIG1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHtcblxuICAgICAgICBsZXQgZWZmZWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHZhbGlkUmVnaW9ucyA9IF8oZW5saXN0UmVzdWx0cykuZmlsdGVyKFxuICAgICAgICAgICAgcmVzdWx0ID0+IChyZXN1bHQucmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuQkVMR0lDQSB8fCByZXN1bHQucmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuR0VSTUFOSUEpKS5tYXAoXG4gICAgICAgICAgICByZXN1bHQgPT4gcmVzdWx0LnJlZ2lvbi5pZCkudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBlZmZlY3RpdmVNYXJjaCA9IHRoaXMuZmluZEVmZmVjdGl2ZU1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIHZhbGlkUmVnaW9ucyk7XG5cbiAgICAgICAgaWYgKGVmZmVjdGl2ZU1hcmNoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEJlbGdhZSBFbmxpc3RlZCBHZXJtYW5pYyBNYXJjaCAqKionKTtcbiAgICAgICAgICAgIEhpZGVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogZWZmZWN0aXZlTWFyY2gucmVnaW9uLmlkXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1hcmNoaW5nV2FyYmFuZHMgPSB0aGlzLmdldE1hcmNoaW5nV2FyYmFuZHMoZWZmZWN0aXZlTWFyY2gucmVnaW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gZWZmZWN0aXZlTWFyY2guZGVzdGluYXRpb247XG4gICAgICAgICAgICBpZiAoZGVzdGluYXRpb24pIHtcbiAgICAgICAgICAgICAgICBNb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogZWZmZWN0aXZlTWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBkZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogbWFyY2hpbmdXYXJiYW5kc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVmZmVjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZEVmZmVjdGl2ZU1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIHZhbGlkUmVnaW9ucykge1xuICAgICAgICBjb25zdCBtYXJjaFJlc3VsdHMgPSBNYXJjaC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pO1xuICAgICAgICByZXR1cm4gXyhtYXJjaFJlc3VsdHMpLnJlamVjdChcbiAgICAgICAgICAgIChtYXJjaFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldE1hcmNoaW5nV2FyYmFuZHMobWFyY2hSZXN1bHQucmVnaW9uKS5sZW5ndGggPCA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoXy5pbmRleE9mKHZhbGlkUmVnaW9ucywgbWFyY2hSZXN1bHQucmVnaW9uLmlkKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkubWFwKFxuICAgICAgICAgICAgKG1hcmNoUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25EYXRhID0gdGhpcy5maW5kRWZmZWN0aXZlRGVzdGluYXRpb24oc3RhdGUsIG1hcmNoUmVzdWx0LmRlc3RpbmF0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKCFkZXN0aW5hdGlvbkRhdGEgJiYgIV8uZmluZChtYXJjaFJlc3VsdC5yZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUyksIHBpZWNlID0+IHBpZWNlLnJldmVhbGVkKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBtYXJjaFJlc3VsdC5yZWdpb24sXG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbkRhdGEgPyBkZXN0aW5hdGlvbkRhdGEuZGVzdGluYXRpb24gOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogZGVzdGluYXRpb25EYXRhID8gZGVzdGluYXRpb25EYXRhLnByaW9yaXR5IDogNVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaGlkZUFsbFdhcmJhbmRzKHN0YXRlLCBmYWN0aW9uKSB7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2JpbGVQaWVjZXMgPSByZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUyk7XG4gICAgICAgICAgICAgICAgaWYgKG1vYmlsZVBpZWNlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgSGlkZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJlZ2lvbi5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0TWFyY2hpbmdXYXJiYW5kcyhyZWdpb24pIHtcbiAgICAgICAgY29uc3QgbW9iaWxlUGllY2VzID0gXyhyZWdpb24ucGllY2VzQnlGYWN0aW9uKClbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdKS5maWx0ZXIoe2lzTW9iaWxlOiB0cnVlfSkuc29ydEJ5KFxuICAgICAgICAgICAgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnNjb3V0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2EnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS5yZXZlYWxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2MnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnZhbHVlKCk7XG4gICAgICAgIGNvbnN0IG51bU1hcmNoaW5nID0gbW9iaWxlUGllY2VzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIF8udGFrZShtb2JpbGVQaWVjZXMsIG51bU1hcmNoaW5nKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RW5lbXlGYWN0aW9uT3JkZXIoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbk9yZGVyID0gXyhFbmVteUZhY3Rpb25Qcmlvcml0eSkubWFwKFxuICAgICAgICAgICAgKHByaW9yaXR5LCBmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge3ByaW9yaXR5LCBmYWN0aW9uSWQsIHBsYXllcjogc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdfVxuICAgICAgICAgICAgfSkucmVqZWN0KHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTfSkucmVqZWN0KHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFfSkucGFydGl0aW9uKCdpc05vblBsYXllcicpLmZsYXR0ZW4oKS5zb3J0QnkoJ2lzTm9uUGxheWVyJykudmFsdWUoKTtcbiAgICAgICAgY29uc3QgZmFjdGlvbk9yZGVyQnlJZCA9IHt9O1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBmYWN0aW9uT3JkZXIsIGZ1bmN0aW9uIChmYWN0aW9uLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGZhY3Rpb25PcmRlckJ5SWRbZmFjdGlvbi5pZF0gPSBpbmRleCArIDE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZhY3Rpb25PcmRlckJ5SWQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRFZmZlY3RpdmVEZXN0aW5hdGlvbihzdGF0ZSwgZGVzdGluYXRpb25zKSB7XG4gICAgICAgIC8vY29uc3QgZW5lbXlGYWN0aW9uT3JkZXIgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcbiAgICAgICAgcmV0dXJuIF8oZGVzdGluYXRpb25zKS5maWx0ZXIoZGVzdGluYXRpb24gPT4gZGVzdGluYXRpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSkubWFwKFxuICAgICAgICAgICAgKGRlc3RpbmF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBFbmVteUZhY3Rpb25Qcmlvcml0eVtkZXN0aW5hdGlvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKS5yZWplY3QoZGVzdGluYXRpb25EYXRhID0+ICFkZXN0aW5hdGlvbkRhdGEucHJpb3JpdHkpLnNvcnRCeSgncHJpb3JpdHknKS5maXJzdCgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlR2VybWFuaWNNYXJjaDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9iZWxnYWUvYmVsZ2FlR2VybWFuaWNNYXJjaC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUFBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 133 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _raid = __webpack_require__(36);\n\nvar _raid2 = _interopRequireDefault(_raid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeGermanicRaid = function () {\n    function BelgaeGermanicRaid() {\n        _classCallCheck(this, BelgaeGermanicRaid);\n    }\n\n    _createClass(BelgaeGermanicRaid, null, [{\n        key: 'raid',\n        value: function raid(state, modifiers, enlistResults) {\n            var effective = false;\n\n            var validRegions = _lodash2.default.map(enlistResults, function (result) {\n                return result.region.id;\n            });\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n            var effectiveRaid = this.findEffectiveRaid(state, modifiers, validRegions);\n\n            if (effectiveRaid) {\n                console.log('*** Belgae Enlisted Germanic Raid ***');\n                var enemyFactionOrder = this.getEnemyFactionOrder(state);\n                _revealPieces2.default.execute(state, { factionId: germanicFaction.id, regionId: effectiveRaid.region.id, count: effectiveRaid.resourcesGained });\n\n                var numResourcesToSteal = effectiveRaid.resourcesGained;\n                _lodash2.default.each(enemyFactionOrder, function (faction) {\n                    var stolen = Math.min(numResourcesToSteal, faction.resources());\n                    _removeResources2.default.execute(state, { factionId: faction.id, count: stolen });\n\n                    numResourcesToSteal -= stolen;\n\n                    if (numResourcesToSteal <= 0) {\n                        return false;\n                    }\n                });\n                effective = true;\n            }\n\n            return effective;\n        }\n    }, {\n        key: 'findEffectiveRaid',\n        value: function findEffectiveRaid(state, modifiers, validRegions) {\n            var _this = this;\n\n            var raidResults = _raid2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            return (0, _lodash2.default)(raidResults).map(function (raidResult) {\n                if (_lodash2.default.indexOf(validRegions, raidResult.region.id) < 0) {\n                    return;\n                }\n\n                var enemyFactionOrder = _this.getEnemyFactionOrder(state);\n                var numHiddenWarbands = raidResult.region.getHiddenPiecesForFaction(_factionIds2.default.GERMANIC_TRIBES).length;\n                var stealableResources = _lodash2.default.reduce(enemyFactionOrder, function (sum, faction) {\n                    return sum + faction.resources();\n                }, 0);\n\n                var resourcesGained = _lodash2.default.min([1, numHiddenWarbands, stealableResources]);\n                if (resourcesGained < 1) {\n                    return;\n                }\n\n                raidResult.resourcesGained = resourcesGained;\n                return raidResult;\n            }).compact().shuffle().first();\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            return (0, _lodash2.default)(state.factions).reject({ id: _factionIds2.default.GERMANIC_TRIBES }).reject(function (faction) {\n                return faction.id === _factionIds2.default.BELGAE;\n            }).reject('isNonPlayer').shuffle().value();\n        }\n    }]);\n\n    return BelgaeGermanicRaid;\n}();\n\nexports.default = BelgaeGermanicRaid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUdlcm1hbmljUmFpZC5qcz9mNmI3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IFJldmVhbFBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JldmVhbFBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUmVzb3VyY2VzJztcbmltcG9ydCBSYWlkIGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhaWQnO1xuXG5jbGFzcyBCZWxnYWVHZXJtYW5pY1JhaWQge1xuICAgIHN0YXRpYyByYWlkKHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHtcbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IHZhbGlkUmVnaW9ucyA9IF8ubWFwKGVubGlzdFJlc3VsdHMsIHJlc3VsdCA9PiByZXN1bHQucmVnaW9uLmlkKTtcbiAgICAgICAgY29uc3QgZ2VybWFuaWNGYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXTtcbiAgICAgICAgY29uc3QgZWZmZWN0aXZlUmFpZCA9IHRoaXMuZmluZEVmZmVjdGl2ZVJhaWQoc3RhdGUsIG1vZGlmaWVycywgdmFsaWRSZWdpb25zKTtcblxuICAgICAgICBpZihlZmZlY3RpdmVSYWlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEJlbGdhZSBFbmxpc3RlZCBHZXJtYW5pYyBSYWlkICoqKicpO1xuICAgICAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uT3JkZXIgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcbiAgICAgICAgICAgIFJldmVhbFBpZWNlcy5leGVjdXRlKHN0YXRlLCB7ZmFjdGlvbklkOiBnZXJtYW5pY0ZhY3Rpb24uaWQsIHJlZ2lvbklkOiBlZmZlY3RpdmVSYWlkLnJlZ2lvbi5pZCwgY291bnQ6IGVmZmVjdGl2ZVJhaWQucmVzb3VyY2VzR2FpbmVkfSk7XG5cbiAgICAgICAgICAgIGxldCBudW1SZXNvdXJjZXNUb1N0ZWFsID0gZWZmZWN0aXZlUmFpZC5yZXNvdXJjZXNHYWluZWQ7XG4gICAgICAgICAgICBfLmVhY2goZW5lbXlGYWN0aW9uT3JkZXIsIGZ1bmN0aW9uKGZhY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9sZW4gPSBNYXRoLm1pbihudW1SZXNvdXJjZXNUb1N0ZWFsLCBmYWN0aW9uLnJlc291cmNlcygpKTtcbiAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwgeyBmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsIGNvdW50OiBzdG9sZW59KTtcblxuICAgICAgICAgICAgICAgIG51bVJlc291cmNlc1RvU3RlYWwgLT0gc3RvbGVuO1xuXG4gICAgICAgICAgICAgICAgaWYgKG51bVJlc291cmNlc1RvU3RlYWwgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZEVmZmVjdGl2ZVJhaWQoc3RhdGUsIG1vZGlmaWVycywgdmFsaWRSZWdpb25zKSB7XG4gICAgICAgIGNvbnN0IHJhaWRSZXN1bHRzID0gUmFpZC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pO1xuICAgICAgICByZXR1cm4gXyhyYWlkUmVzdWx0cykubWFwKCAocmFpZFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZih2YWxpZFJlZ2lvbnMsIHJhaWRSZXN1bHQucmVnaW9uLmlkKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uT3JkZXIgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcbiAgICAgICAgICAgIGNvbnN0IG51bUhpZGRlbldhcmJhbmRzID0gcmFpZFJlc3VsdC5yZWdpb24uZ2V0SGlkZGVuUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUykubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3Qgc3RlYWxhYmxlUmVzb3VyY2VzID0gXy5yZWR1Y2UoZW5lbXlGYWN0aW9uT3JkZXIsIGZ1bmN0aW9uKHN1bSwgZmFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgZmFjdGlvbi5yZXNvdXJjZXMoKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VzR2FpbmVkID0gXy5taW4oWzEsIG51bUhpZGRlbldhcmJhbmRzLCBzdGVhbGFibGVSZXNvdXJjZXNdKTtcbiAgICAgICAgICAgIGlmKHJlc291cmNlc0dhaW5lZCA8IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJhaWRSZXN1bHQucmVzb3VyY2VzR2FpbmVkID0gcmVzb3VyY2VzR2FpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIHJhaWRSZXN1bHQ7XG4gICAgICAgIH0pLmNvbXBhY3QoKS5zaHVmZmxlKCkuZmlyc3QoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RW5lbXlGYWN0aW9uT3JkZXIoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8oc3RhdGUuZmFjdGlvbnMpLnJlamVjdCh7aWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTfSkucmVqZWN0KGZhY3Rpb24gPT4gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5CRUxHQUUpLnJlamVjdCgnaXNOb25QbGF5ZXInKS5zaHVmZmxlKCkudmFsdWUoKTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlR2VybWFuaWNSYWlkO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9iZWxnYWVHZXJtYW5pY1JhaWQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 134 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeGermanicRally = function () {\n    function BelgaeGermanicRally() {\n        _classCallCheck(this, BelgaeGermanicRally);\n    }\n\n    _createClass(BelgaeGermanicRally, null, [{\n        key: 'rally',\n        value: function rally(state, modifiers, enlistResults) {\n            var effective = false;\n            var validRegions = _lodash2.default.map(enlistResults, function (result) {\n                return result.region.id;\n            });\n            var effectiveRally = this.findEffectiveRally(state, modifiers, validRegions);\n            if (effectiveRally) {\n                console.log('*** Belgae Enlisted Germanic Rally ***');\n                var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n                if (effectiveRally.allyAdded) {\n                    _placeAlliedTribe2.default.execute(state, {\n                        factionId: germanicFaction.id,\n                        regionId: effectiveRally.region.id,\n                        tribeId: this.getAllyDestinationTribe(effectiveRally.region).id\n                    });\n                }\n                if (effectiveRally.numWarbandsAdded > 0) {\n                    _placeWarbands2.default.execute(state, {\n                        factionId: germanicFaction.id,\n                        regionId: effectiveRally.region.id,\n                        count: Math.min(effectiveRally.numWarbandsAdded, germanicFaction.availableWarbands().length)\n                    });\n                }\n                effective = true;\n            }\n            return effective;\n        }\n    }, {\n        key: 'findEffectiveRally',\n        value: function findEffectiveRally(state, modifiers, validRegions) {\n            var rallyResults = _rally2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            return (0, _lodash2.default)(rallyResults).filter({ allyAdded: true }).map(function (rallyResult) {\n                if (_lodash2.default.indexOf(validRegions, rallyResult.region.id) < 0) {\n                    return;\n                }\n\n                var priority = 'c';\n                if (rallyResult.allyAdded) {\n                    priority = 'a';\n                } else {\n                    priority = 'b' + 99 - rallyResult.numWarbandsAdded;\n                }\n                return { rallyResult: rallyResult, priority: priority };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('rallyResult').first();\n        }\n    }, {\n        key: 'getAllyDestinationTribe',\n        value: function getAllyDestinationTribe(region) {\n            var subdued = (0, _lodash2.default)(region.tribes).filter(function (tribe) {\n                return tribe.isSubdued();\n            }).value();\n            return _lodash2.default.sample(subdued);\n        }\n    }, {\n        key: 'placeWarbands',\n        value: function placeWarbands(state, modifiers) {\n            var rallyResults = _rally2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            var warbandResults = (0, _lodash2.default)(rallyResults).filter('numWarbandsAdded').sampleSize(rallyResults.length).value();\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n            _lodash2.default.each(warbandResults, function (result) {\n                _placeWarbands2.default.execute(state, {\n                    factionId: germanicFaction.id,\n                    regionId: result.region.id,\n                    count: Math.min(result.numWarbandsAdded, germanicFaction.availableWarbands().length)\n                });\n\n                if (germanicFaction.availableWarbands().length === 0) {\n                    return false;\n                }\n            });\n        }\n    }]);\n\n    return BelgaeGermanicRally;\n}();\n\nexports.default = BelgaeGermanicRally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZUdlcm1hbmljUmFsbHkuanM/MzJmNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSYWxseSBmcm9tICcuLi8uLi9jb21tYW5kcy9yYWxseSc7XG5pbXBvcnQgUGxhY2VBbGxpZWRUcmliZSBmcm9tICcuLi8uLi9hY3Rpb25zL3BsYWNlQWxsaWVkVHJpYmUnO1xuaW1wb3J0IFBsYWNlV2FyYmFuZHMgZnJvbSAnLi4vLi4vYWN0aW9ucy9wbGFjZVdhcmJhbmRzJztcblxuY2xhc3MgQmVsZ2FlR2VybWFuaWNSYWxseSB7XG4gICAgc3RhdGljIHJhbGx5KHN0YXRlLCBtb2RpZmllcnMsIGVubGlzdFJlc3VsdHMpIHtcbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCB2YWxpZFJlZ2lvbnMgPSBfLm1hcChlbmxpc3RSZXN1bHRzLCByZXN1bHQgPT4gcmVzdWx0LnJlZ2lvbi5pZCk7XG4gICAgICAgIGNvbnN0IGVmZmVjdGl2ZVJhbGx5ID0gdGhpcy5maW5kRWZmZWN0aXZlUmFsbHkoc3RhdGUsIG1vZGlmaWVycywgdmFsaWRSZWdpb25zKTtcbiAgICAgICAgaWYgKGVmZmVjdGl2ZVJhbGx5KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnKioqIEJlbGdhZSBFbmxpc3RlZCBHZXJtYW5pYyBSYWxseSAqKionKTtcbiAgICAgICAgICAgIGNvbnN0IGdlcm1hbmljRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU107XG4gICAgICAgICAgICBpZiAoZWZmZWN0aXZlUmFsbHkuYWxseUFkZGVkKSB7XG4gICAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBnZXJtYW5pY0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogZWZmZWN0aXZlUmFsbHkucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpYmVJZDogdGhpcy5nZXRBbGx5RGVzdGluYXRpb25UcmliZShlZmZlY3RpdmVSYWxseS5yZWdpb24pLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVmZmVjdGl2ZVJhbGx5Lm51bVdhcmJhbmRzQWRkZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgUGxhY2VXYXJiYW5kcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBnZXJtYW5pY0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogZWZmZWN0aXZlUmFsbHkucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IE1hdGgubWluKGVmZmVjdGl2ZVJhbGx5Lm51bVdhcmJhbmRzQWRkZWQsIGdlcm1hbmljRmFjdGlvbi5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRFZmZlY3RpdmVSYWxseShzdGF0ZSwgbW9kaWZpZXJzLCB2YWxpZFJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3QgcmFsbHlSZXN1bHRzID0gUmFsbHkudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVN9KTtcbiAgICAgICAgcmV0dXJuIF8ocmFsbHlSZXN1bHRzKS5maWx0ZXIoe2FsbHlBZGRlZDogdHJ1ZX0pLm1hcChcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyYWxseVJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmluZGV4T2YodmFsaWRSZWdpb25zLCByYWxseVJlc3VsdC5yZWdpb24uaWQpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IHByaW9yaXR5ID0gJ2MnO1xuICAgICAgICAgICAgICAgIGlmIChyYWxseVJlc3VsdC5hbGx5QWRkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdiJyArIDk5IC0gcmFsbHlSZXN1bHQubnVtV2FyYmFuZHNBZGRlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtyYWxseVJlc3VsdCwgcHJpb3JpdHl9O1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5tYXAoJ3JhbGx5UmVzdWx0JykuZmlyc3QoKTtcblxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRBbGx5RGVzdGluYXRpb25UcmliZShyZWdpb24pIHtcbiAgICAgICAgY29uc3Qgc3ViZHVlZCA9IF8ocmVnaW9uLnRyaWJlcykuZmlsdGVyKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHRyaWJlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyaWJlLmlzU3ViZHVlZCgpO1xuICAgICAgICAgICAgfSkudmFsdWUoKTtcbiAgICAgICAgcmV0dXJuIF8uc2FtcGxlKHN1YmR1ZWQpXG4gICAgfVxuXG4gICAgc3RhdGljIHBsYWNlV2FyYmFuZHMoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCByYWxseVJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pO1xuICAgICAgICBjb25zdCB3YXJiYW5kUmVzdWx0cyA9IF8ocmFsbHlSZXN1bHRzKS5maWx0ZXIoJ251bVdhcmJhbmRzQWRkZWQnKS5zYW1wbGVTaXplKHJhbGx5UmVzdWx0cy5sZW5ndGgpLnZhbHVlKCk7XG4gICAgICAgIGNvbnN0IGdlcm1hbmljRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU107XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHdhcmJhbmRSZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgUGxhY2VXYXJiYW5kcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBnZXJtYW5pY0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVzdWx0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBNYXRoLm1pbihyZXN1bHQubnVtV2FyYmFuZHNBZGRlZCwgZ2VybWFuaWNGYWN0aW9uLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChnZXJtYW5pY0ZhY3Rpb24uYXZhaWxhYmxlV2FyYmFuZHMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlR2VybWFuaWNSYWxseVxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL2JlbGdhZS9iZWxnYWVHZXJtYW5pY1JhbGx5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 135 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nvar _raid = __webpack_require__(36);\n\nvar _raid2 = _interopRequireDefault(_raid);\n\nvar _belgaeRampage = __webpack_require__(52);\n\nvar _belgaeRampage2 = _interopRequireDefault(_belgaeRampage);\n\nvar _belgaeEnlist = __webpack_require__(43);\n\nvar _belgaeEnlist2 = _interopRequireDefault(_belgaeEnlist);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _enemyFactionPriority = __webpack_require__(27);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BelgaeRaid = function () {\n    function BelgaeRaid() {\n        _classCallCheck(this, BelgaeRaid);\n    }\n\n    _createClass(BelgaeRaid, null, [{\n        key: 'raid',\n        value: function raid(state, modifiers) {\n\n            var effectiveRaidRegions = this.getEffectiveRaidRegions(state, modifiers);\n            if (effectiveRaidRegions.length === 0) {\n                return;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.RAID);\n            _lodash2.default.each(effectiveRaidRegions, function (raidResult) {\n                console.log('*** ' + state.belgae.name + ' Raiding in region ' + raidResult.region.name);\n\n                _revealPieces2.default.execute(state, {\n                    factionId: state.belgae.id,\n                    regionId: raidResult.region.id,\n                    count: raidResult.resourcesGained\n                });\n\n                var numResourcesToSteal = raidResult.resourcesGained;\n                (0, _lodash2.default)(raidResult.raidableFactions).sortBy(function (factionId) {\n                    return _enemyFactionPriority2.default[factionId];\n                }).each(function (factionId) {\n                    if (state.playersByFaction[factionId].isNonPlayer) {\n                        return;\n                    }\n                    var faction = state.factionsById[factionId];\n                    var stolen = Math.min(numResourcesToSteal, faction.resources());\n                    _removeResources2.default.execute(state, { factionId: faction.id, count: stolen });\n                    numResourcesToSteal -= stolen;\n\n                    if (numResourcesToSteal === 0) {\n                        return false;\n                    }\n                });\n\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.BELGAE, count: raidResult.resourcesGained });\n            });\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n            var usedSpecialAbility = modifiers.canDoSpecial() && (_belgaeRampage2.default.rampage(state, modifiers) || _belgaeEnlist2.default.enlist(state, modifiers));\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getEffectiveRaidRegions',\n        value: function getEffectiveRaidRegions(state, modifiers) {\n            var raidResults = _raid2.default.test(state, { factionId: _factionIds2.default.BELGAE });\n            var hasBaggageTrain = state.hasShadedCapability(_capabilities.CapabilityIDs.BAGGAGE_TRAINS, _factionIds2.default.BELGAE);\n\n            _lodash2.default.each(raidResults, function (result) {\n                var numHiddenWarbands = result.region.getHiddenPiecesForFaction(_factionIds2.default.BELGAE).length;\n\n                if (numHiddenWarbands <= 1) {\n                    result.resourcesGained = 0;\n                    return;\n                }\n\n                var numRaidingWarbands = Math.min(numHiddenWarbands - 1, hasBaggageTrain ? 3 : 2);\n\n                if (!result.region.devastated()) {\n                    result.resourcesGained = numRaidingWarbands;\n                } else {\n                    var stealableResources = _lodash2.default.reduce(result.raidableFactions, function (sum, factionId) {\n                        if (!state.playersByFaction[factionId].isNonPlayer) {\n                            var faction = state.factionsById[factionId];\n                            return sum + faction.resources();\n                        } else {\n                            return sum;\n                        }\n                    }, 0);\n                    result.resourcesGained = Math.min(numRaidingWarbands, stealableResources);\n                }\n            });\n\n            var executable = (0, _lodash2.default)(raidResults).filter(function (result) {\n                return result.resourcesGained > 0;\n            }).sortBy(function (result) {\n                var priority = 'z';\n                _lodash2.default.each(result.raidableFactions, function (factionId) {\n                    if (!state.playersByFaction[factionId].isNonPlayer) {\n                        var factionPriority = 'a' + _enemyFactionPriority2.default[factionId];\n                        if (factionPriority < priority) {\n                            priority = factionPriority;\n                        }\n                    }\n                });\n                priority += '-' + result.resourcesGained;\n                return {\n                    priority: priority,\n                    result: result\n                };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n\n            if (modifiers.limited) {\n                executable = _lodash2.default.take(executable, 1);\n            }\n\n            var numResourcesGained = _lodash2.default.reduce(executable, function (sum, result) {\n                return sum + result.resourcesGained;\n            }, 0);\n\n            if (numResourcesGained > 2) {\n                return executable;\n            } else {\n                return [];\n            }\n        }\n    }]);\n\n    return BelgaeRaid;\n}();\n\nexports.default = BelgaeRaid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZVJhaWQuanM/MmM2YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZXZlYWxQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZXZlYWxQaWVjZXMnO1xuaW1wb3J0IFJlbW92ZVJlc291cmNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL3JlbW92ZVJlc291cmNlcyc7XG5pbXBvcnQgQWRkUmVzb3VyY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcbmltcG9ydCBSYWlkIGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhaWQnO1xuaW1wb3J0IEJlbGdhZVJhbXBhZ2UgZnJvbSAnLi9iZWxnYWVSYW1wYWdlJztcbmltcG9ydCBCZWxnYWVFbmxpc3QgZnJvbSAnLi9iZWxnYWVFbmxpc3QnO1xuaW1wb3J0IHtDYXBhYmlsaXR5SURzfSBmcm9tICcuLi8uLi9jb25maWcvY2FwYWJpbGl0aWVzJztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuaW1wb3J0IEVuZW15RmFjdGlvblByaW9yaXR5IGZyb20gJy4vZW5lbXlGYWN0aW9uUHJpb3JpdHknO1xuXG5jbGFzcyBCZWxnYWVSYWlkIHtcbiAgICBzdGF0aWMgcmFpZChzdGF0ZSwgbW9kaWZpZXJzKSB7XG5cbiAgICAgICAgY29uc3QgZWZmZWN0aXZlUmFpZFJlZ2lvbnMgPSB0aGlzLmdldEVmZmVjdGl2ZVJhaWRSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICBpZihlZmZlY3RpdmVSYWlkUmVnaW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuc3RhcnRDb21tYW5kKENvbW1hbmRJRHMuUkFJRCk7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIGVmZmVjdGl2ZVJhaWRSZWdpb25zLCBmdW5jdGlvbiAocmFpZFJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcqKiogJyArIHN0YXRlLmJlbGdhZS5uYW1lICsgJyBSYWlkaW5nIGluIHJlZ2lvbiAnICsgcmFpZFJlc3VsdC5yZWdpb24ubmFtZSk7XG5cbiAgICAgICAgICAgICAgICBSZXZlYWxQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogc3RhdGUuYmVsZ2FlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJhaWRSZXN1bHQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHJhaWRSZXN1bHQucmVzb3VyY2VzR2FpbmVkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGV0IG51bVJlc291cmNlc1RvU3RlYWwgPSByYWlkUmVzdWx0LnJlc291cmNlc0dhaW5lZDtcbiAgICAgICAgICAgICAgICBfKHJhaWRSZXN1bHQucmFpZGFibGVGYWN0aW9ucykuc29ydEJ5KGZhY3Rpb25JZCA9PiBFbmVteUZhY3Rpb25Qcmlvcml0eVtmYWN0aW9uSWRdKS5lYWNoKFxuICAgICAgICAgICAgICAgICAgICAoZmFjdGlvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtmYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvbGVuID0gTWF0aC5taW4obnVtUmVzb3VyY2VzVG9TdGVhbCwgZmFjdGlvbi5yZXNvdXJjZXMoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwgeyBmYWN0aW9uSWQ6IGZhY3Rpb24uaWQsIGNvdW50OiBzdG9sZW59KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bVJlc291cmNlc1RvU3RlYWwgLT0gc3RvbGVuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtUmVzb3VyY2VzVG9TdGVhbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBBZGRSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwgeyBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFLCBjb3VudDogcmFpZFJlc3VsdC5yZXNvdXJjZXNHYWluZWR9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0Q29tbWFuZCgpO1xuICAgICAgICBjb25zdCB1c2VkU3BlY2lhbEFiaWxpdHkgPSBtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkgJiYgKEJlbGdhZVJhbXBhZ2UucmFtcGFnZShzdGF0ZSwgbW9kaWZpZXJzKSB8fCBCZWxnYWVFbmxpc3QuZW5saXN0KHN0YXRlLCBtb2RpZmllcnMpKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRFZmZlY3RpdmVSYWlkUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhaWRSZXN1bHRzID0gUmFpZC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRX0pO1xuICAgICAgICBjb25zdCBoYXNCYWdnYWdlVHJhaW4gPSBzdGF0ZS5oYXNTaGFkZWRDYXBhYmlsaXR5KENhcGFiaWxpdHlJRHMuQkFHR0FHRV9UUkFJTlMsIEZhY3Rpb25JRHMuQkVMR0FFKTtcblxuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICByYWlkUmVzdWx0cywgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUhpZGRlbldhcmJhbmRzID0gcmVzdWx0LnJlZ2lvbi5nZXRIaWRkZW5QaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQkVMR0FFKS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBpZiAobnVtSGlkZGVuV2FyYmFuZHMgPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVzb3VyY2VzR2FpbmVkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG51bVJhaWRpbmdXYXJiYW5kcyA9IE1hdGgubWluKG51bUhpZGRlbldhcmJhbmRzIC0gMSwgaGFzQmFnZ2FnZVRyYWluID8gMyA6IDIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQucmVnaW9uLmRldmFzdGF0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVzb3VyY2VzR2FpbmVkID0gbnVtUmFpZGluZ1dhcmJhbmRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RlYWxhYmxlUmVzb3VyY2VzID0gXy5yZWR1Y2UoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmFpZGFibGVGYWN0aW9ucywgZnVuY3Rpb24gKHN1bSwgZmFjdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtmYWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgZmFjdGlvbi5yZXNvdXJjZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZXNvdXJjZXNHYWluZWQgPSBNYXRoLm1pbihudW1SYWlkaW5nV2FyYmFuZHMsIHN0ZWFsYWJsZVJlc291cmNlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGV4ZWN1dGFibGUgPSBfKHJhaWRSZXN1bHRzKS5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5yZXNvdXJjZXNHYWluZWQgPiAwKS5zb3J0QnkoXG4gICAgICAgICAgICAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHByaW9yaXR5ID0gJ3onO1xuICAgICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJhaWRhYmxlRmFjdGlvbnMsIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdLmlzTm9uUGxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvblByaW9yaXR5ID0gJ2EnICsgRW5lbXlGYWN0aW9uUHJpb3JpdHlbZmFjdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFjdGlvblByaW9yaXR5IDwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHkgPSBmYWN0aW9uUHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwcmlvcml0eSArPSAnLScgKyByZXN1bHQucmVzb3VyY2VzR2FpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkudmFsdWUoKTtcblxuICAgICAgICBpZiAobW9kaWZpZXJzLmxpbWl0ZWQpIHtcbiAgICAgICAgICAgIGV4ZWN1dGFibGUgPSBfLnRha2UoZXhlY3V0YWJsZSwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBudW1SZXNvdXJjZXNHYWluZWQgPSBfLnJlZHVjZShcbiAgICAgICAgICAgIGV4ZWN1dGFibGUsIGZ1bmN0aW9uIChzdW0sIHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyByZXN1bHQucmVzb3VyY2VzR2FpbmVkO1xuICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYgKG51bVJlc291cmNlc0dhaW5lZCA+IDIpIHtcbiAgICAgICAgICAgIHJldHVybiBleGVjdXRhYmxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEJlbGdhZVJhaWQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZVJhaWQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTtBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 136 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar GermanicBattle = function () {\n    function GermanicBattle() {\n        _classCallCheck(this, GermanicBattle);\n    }\n\n    _createClass(GermanicBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers) {\n            console.log('*** Germanic Battle ***');\n            var effectiveBattles = this.findEffectiveBattles(state);\n            if (effectiveBattles.length === 0) {\n                return false;\n            }\n            var turn = state.turnHistory.getCurrentTurn();\n            turn.startCommand(_commandIds2.default.BATTLE);\n            _lodash2.default.each(effectiveBattles, function (battle) {\n                _battle2.default.execute(state, {\n                    region: battle.region,\n                    attackingFaction: battle.attackingFaction,\n                    defendingFaction: battle.defendingFaction,\n                    ambush: true\n                });\n            });\n            turn.commitCommand();\n            return true;\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            return (0, _lodash2.default)(state.factions).reject({ id: _factionIds2.default.GERMANIC_TRIBES }).partition('isNonPlayer').map(_lodash2.default.shuffle).flatten().sortBy('isNonPlayer').value();\n        }\n    }, {\n        key: 'findEffectiveBattles',\n        value: function findEffectiveBattles(state) {\n            var _this = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var enemyFactionOrder = _this.getEnemyFactionOrder(state);\n                return (0, _lodash2.default)(enemyFactionOrder).map(function (faction) {\n                    return _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.GERMANIC_TRIBES,\n                        defendingFactionId: faction.id\n                    });\n                }).filter(_this.isEffectiveBattle).first();\n            }).compact().value();\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            return battleResult.canAmbush && battleResult.bestDefenderLosses > 0;\n        }\n    }]);\n\n    return GermanicBattle;\n}();\n\nexports.default = GermanicBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNCYXR0bGUuanM/ZGMyNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBCYXR0bGUgZnJvbSAnLi4vLi4vY29tbWFuZHMvYmF0dGxlJztcblxuY2xhc3MgR2VybWFuaWNCYXR0bGUge1xuXG4gICAgc3RhdGljIGJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogR2VybWFuaWMgQmF0dGxlICoqKicpO1xuICAgICAgICBjb25zdCBlZmZlY3RpdmVCYXR0bGVzID0gdGhpcy5maW5kRWZmZWN0aXZlQmF0dGxlcyhzdGF0ZSk7XG4gICAgICAgIGlmKGVmZmVjdGl2ZUJhdHRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG4gICAgICAgIHR1cm4uc3RhcnRDb21tYW5kKENvbW1hbmRJRHMuQkFUVExFKTtcbiAgICAgICAgXy5lYWNoKGVmZmVjdGl2ZUJhdHRsZXMsIChiYXR0bGUpID0+IHtcbiAgICAgICAgICAgICAgICBCYXR0bGUuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogYmF0dGxlLnJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja2luZ0ZhY3Rpb246IGJhdHRsZS5hdHRhY2tpbmdGYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbjogYmF0dGxlLmRlZmVuZGluZ0ZhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbWJ1c2g6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdHVybi5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRFbmVteUZhY3Rpb25PcmRlcihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5mYWN0aW9ucykucmVqZWN0KHtpZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVN9KS5wYXJ0aXRpb24oJ2lzTm9uUGxheWVyJykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLnNvcnRCeSgnaXNOb25QbGF5ZXInKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kRWZmZWN0aXZlQmF0dGxlcyhzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoXG4gICAgICAgICAgICAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uT3JkZXIgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gXyhlbmVteUZhY3Rpb25PcmRlcikubWFwKGZ1bmN0aW9uKGZhY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJhdHRsZS50ZXN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2tpbmdGYWN0aW9uSWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVuZGluZ0ZhY3Rpb25JZDogZmFjdGlvbi5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuZmlsdGVyKHRoaXMuaXNFZmZlY3RpdmVCYXR0bGUpLmZpcnN0KCk7XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNFZmZlY3RpdmVCYXR0bGUoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQuY2FuQW1idXNoICYmIGJhdHRsZVJlc3VsdC5iZXN0RGVmZW5kZXJMb3NzZXMgPiAwO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgR2VybWFuaWNCYXR0bGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNCYXR0bGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 137 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar GermanicMarch = function () {\n    function GermanicMarch() {\n        _classCallCheck(this, GermanicMarch);\n    }\n\n    _createClass(GermanicMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers) {\n            var _this = this;\n\n            console.log('*** Germanic March ***');\n            var effective = false;\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n\n            var validMarches = (0, _lodash2.default)(marchResults).filter(function (marchResult) {\n                return _this.getMarchingWarbands(marchResult.region).length > 0;\n            }).value();\n\n            var factionOrderById = this.getEnemyFactionOrder(state);\n\n            var turn = state.turnHistory.getCurrentTurn();\n            turn.startCommand(_commandIds2.default.MARCH);\n\n            while (validMarches.length > 0) {\n                validMarches = (0, _lodash2.default)(validMarches).sortBy(function (marchResult) {\n                    return 99 - _this.getMarchingWarbands(marchResult.region).length;\n                }).value();\n\n                var nextMarch = validMarches.shift();\n\n                var marchingWarbands = this.getMarchingWarbands(nextMarch.region);\n                var destination = this.findHighestPriorityDestination(nextMarch.destinations, factionOrderById, marchingWarbands.length);\n                if (!modifiers.winter) {\n                    _hidePieces2.default.execute(state, {\n                        factionId: germanicFaction.id,\n                        regionId: nextMarch.region.id\n                    });\n                }\n                _movePieces2.default.execute(state, {\n                    sourceRegionId: nextMarch.region.id,\n                    destRegionId: destination.id,\n                    pieces: marchingWarbands\n                });\n                effective = true;\n            }\n\n            if (modifiers.winter) {\n                this.hideAllWarbands(state, germanicFaction);\n            }\n            turn.commitCommand();\n            return effective;\n        }\n    }, {\n        key: 'hideAllWarbands',\n        value: function hideAllWarbands(state, faction) {\n            _lodash2.default.each(state.regions, function (region) {\n                var mobilePieces = region.getMobilePiecesForFaction(_factionIds2.default.GERMANIC_TRIBES);\n                if (mobilePieces.length) {\n                    _hidePieces2.default.execute(state, {\n                        factionId: faction.id,\n                        regionId: region.id\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'getMarchingWarbands',\n        value: function getMarchingWarbands(region) {\n            var mobilePieces = (0, _lodash2.default)(region.getMobilePiecesForFaction(_factionIds2.default.GERMANIC_TRIBES)).sortBy(function (piece) {\n                if (piece.scouted()) {\n                    return 'a';\n                } else if (piece.revealed()) {\n                    return 'b';\n                } else {\n                    return 'c';\n                }\n            }).value();\n            var numMarching = Math.min(mobilePieces.length, region.controllingMarginByFaction()[_factionIds2.default.GERMANIC_TRIBES] - 1);\n            return _lodash2.default.take(mobilePieces, numMarching);\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            var factionOrder = (0, _lodash2.default)(state.factions).reject({ id: _factionIds2.default.GERMANIC_TRIBES }).partition('isNonPlayer').map(_lodash2.default.shuffle).flatten().sortBy('isNonPlayer').value();\n            var factionOrderById = {};\n            _lodash2.default.each(factionOrder, function (faction, index) {\n                factionOrderById[faction.id] = index + 1;\n            });\n            return factionOrderById;\n        }\n    }, {\n        key: 'findHighestPriorityDestination',\n        value: function findHighestPriorityDestination(destinations, factionOrderById, numMarchablePieces) {\n            return (0, _lodash2.default)(destinations).map(function (destination) {\n                var destinationPriority = 'c';\n\n                var controlMarginAfterPlacement = destination.controllingMarginByFaction()[_factionIds2.default.GERMANIC_TRIBES] + numMarchablePieces;\n                if (controlMarginAfterPlacement <= 0) {\n                    destinationPriority += 'a' + (factionOrderById[destination.controllingFactionId()] || 9);\n                } else {\n                    destinationPriority += 'b' + (factionOrderById[destination.controllingFactionId()] || 9);\n                }\n\n                return {\n                    destination: destination,\n                    priority: destinationPriority\n                };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first().destination;\n        }\n    }]);\n\n    return GermanicMarch;\n}();\n\nexports.default = GermanicMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNNYXJjaC5qcz83YTY0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IE1hcmNoIGZyb20gJy4uLy4uL2NvbW1hbmRzL21hcmNoJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgSGlkZVBpZWNlcyBmcm9tICcuLi8uLi9hY3Rpb25zL2hpZGVQaWVjZXMnO1xuXG5jbGFzcyBHZXJtYW5pY01hcmNoIHtcblxuICAgIHN0YXRpYyBtYXJjaChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogR2VybWFuaWMgTWFyY2ggKioqJyk7XG4gICAgICAgIGxldCBlZmZlY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgZ2VybWFuaWNGYWN0aW9uID0gc3RhdGUuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXTtcbiAgICAgICAgY29uc3QgbWFyY2hSZXN1bHRzID0gTWFyY2gudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVN9KTtcblxuICAgICAgICBsZXQgdmFsaWRNYXJjaGVzID0gXyhtYXJjaFJlc3VsdHMpLmZpbHRlcigobWFyY2hSZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldE1hcmNoaW5nV2FyYmFuZHMobWFyY2hSZXN1bHQucmVnaW9uKS5sZW5ndGggPiAwO1xuICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IGZhY3Rpb25PcmRlckJ5SWQgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcblxuICAgICAgICBjb25zdCB0dXJuID0gc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKTtcbiAgICAgICAgdHVybi5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5NQVJDSCk7XG5cbiAgICAgICAgd2hpbGUodmFsaWRNYXJjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhbGlkTWFyY2hlcyA9IF8odmFsaWRNYXJjaGVzKS5zb3J0QnkoKG1hcmNoUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDk5IC0gdGhpcy5nZXRNYXJjaGluZ1dhcmJhbmRzKG1hcmNoUmVzdWx0LnJlZ2lvbikubGVuZ3RoO1xuICAgICAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICAgICAgY29uc3QgbmV4dE1hcmNoID0gdmFsaWRNYXJjaGVzLnNoaWZ0KCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1hcmNoaW5nV2FyYmFuZHMgPSB0aGlzLmdldE1hcmNoaW5nV2FyYmFuZHMobmV4dE1hcmNoLnJlZ2lvbik7XG4gICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IHRoaXMuZmluZEhpZ2hlc3RQcmlvcml0eURlc3RpbmF0aW9uKG5leHRNYXJjaC5kZXN0aW5hdGlvbnMsIGZhY3Rpb25PcmRlckJ5SWQsICBtYXJjaGluZ1dhcmJhbmRzLmxlbmd0aCk7XG4gICAgICAgICAgICBpZiAoIW1vZGlmaWVycy53aW50ZXIpIHtcbiAgICAgICAgICAgICAgICBIaWRlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGdlcm1hbmljRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBuZXh0TWFyY2gucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VSZWdpb25JZDogbmV4dE1hcmNoLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGVzdFJlZ2lvbklkOiBkZXN0aW5hdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBtYXJjaGluZ1dhcmJhbmRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlZmZlY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYobW9kaWZpZXJzLndpbnRlcikge1xuICAgICAgICAgICAgdGhpcy5oaWRlQWxsV2FyYmFuZHMoc3RhdGUsIGdlcm1hbmljRmFjdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdHVybi5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIHJldHVybiBlZmZlY3RpdmU7XG4gICAgfVxuXG4gICAgc3RhdGljIGhpZGVBbGxXYXJiYW5kcyhzdGF0ZSwgZmFjdGlvbikge1xuICAgICAgICBfLmVhY2goc3RhdGUucmVnaW9ucywgZnVuY3Rpb24ocmVnaW9uKSB7XG4gICAgICAgICAgICBjb25zdCBtb2JpbGVQaWVjZXMgPSByZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUyk7XG4gICAgICAgICAgICBpZihtb2JpbGVQaWVjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgSGlkZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBmYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHJlZ2lvbi5pZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0TWFyY2hpbmdXYXJiYW5kcyhyZWdpb24pIHtcbiAgICAgICAgY29uc3QgbW9iaWxlUGllY2VzID0gXyhyZWdpb24uZ2V0TW9iaWxlUGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFUykpLnNvcnRCeShmdW5jdGlvbihwaWVjZSkge1xuICAgICAgICAgICAgaWYgKHBpZWNlLnNjb3V0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnYSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHBpZWNlLnJldmVhbGVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2InO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdjJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudmFsdWUoKTtcbiAgICAgICAgY29uc3QgbnVtTWFyY2hpbmcgPSBNYXRoLm1pbihtb2JpbGVQaWVjZXMubGVuZ3RoLCByZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU10gLSAxKTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShtb2JpbGVQaWVjZXMsIG51bU1hcmNoaW5nKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RW5lbXlGYWN0aW9uT3JkZXIoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgZmFjdGlvbk9yZGVyID0gXyhzdGF0ZS5mYWN0aW9ucykucmVqZWN0KHtpZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVN9KS5wYXJ0aXRpb24oJ2lzTm9uUGxheWVyJykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLnNvcnRCeSgnaXNOb25QbGF5ZXInKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCBmYWN0aW9uT3JkZXJCeUlkID0ge307XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIGZhY3Rpb25PcmRlciwgZnVuY3Rpb24gKGZhY3Rpb24sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgZmFjdGlvbk9yZGVyQnlJZFtmYWN0aW9uLmlkXSA9IGluZGV4ICsgMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFjdGlvbk9yZGVyQnlJZDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZEhpZ2hlc3RQcmlvcml0eURlc3RpbmF0aW9uKGRlc3RpbmF0aW9ucywgZmFjdGlvbk9yZGVyQnlJZCwgbnVtTWFyY2hhYmxlUGllY2VzKSB7XG4gICAgICAgIHJldHVybiBfKGRlc3RpbmF0aW9ucykubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKGRlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRlc3RpbmF0aW9uUHJpb3JpdHkgPSAnYyc7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sTWFyZ2luQWZ0ZXJQbGFjZW1lbnQgPSBkZXN0aW5hdGlvbi5jb250cm9sbGluZ01hcmdpbkJ5RmFjdGlvbigpW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXSArIG51bU1hcmNoYWJsZVBpZWNlcztcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbE1hcmdpbkFmdGVyUGxhY2VtZW50IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25Qcmlvcml0eSArPSAnYScgKyAoZmFjdGlvbk9yZGVyQnlJZFtkZXN0aW5hdGlvbi5jb250cm9sbGluZ0ZhY3Rpb25JZCgpXSB8fCA5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uUHJpb3JpdHkgKz0gJ2InICsgKGZhY3Rpb25PcmRlckJ5SWRbZGVzdGluYXRpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKV0gfHwgOSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogZGVzdGluYXRpb25Qcmlvcml0eVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuZmlyc3QoKS5kZXN0aW5hdGlvbjtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdlcm1hbmljTWFyY2g7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNNYXJjaC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 138 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _raid = __webpack_require__(36);\n\nvar _raid2 = _interopRequireDefault(_raid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar GermanicRaid = function () {\n    function GermanicRaid() {\n        _classCallCheck(this, GermanicRaid);\n    }\n\n    _createClass(GermanicRaid, null, [{\n        key: 'raid',\n        value: function raid(state, modifiers) {\n            var _this = this;\n\n            console.log('*** Germanic Raid ***');\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n            var raidResults = _raid2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n\n            if (raidResults.length === 0) {\n                return false;\n            }\n\n            var turn = state.turnHistory.getCurrentTurn();\n            turn.startCommand(_commandIds2.default.RAID);\n\n            _lodash2.default.each(raidResults, function (raidResult) {\n                var enemyFactionOrder = _this.getEnemyFactionOrder(state);\n\n                var numHiddenWarbands = _lodash2.default.filter(raidResult.region.piecesByFaction()[_factionIds2.default.GERMANIC_TRIBES], function (piece) {\n                    return piece.type === 'warband' && !piece.revealed();\n                }).length;\n\n                var stealableResources = _lodash2.default.reduce(enemyFactionOrder, function (sum, faction) {\n                    return sum + faction.resources();\n                }, 0);\n\n                var resourcesGained = _lodash2.default.min([2, numHiddenWarbands, stealableResources]);\n                _revealPieces2.default.execute(state, { factionId: germanicFaction.id, regionId: raidResult.region.id, count: resourcesGained });\n\n                var numResourcesToSteal = resourcesGained;\n\n                _lodash2.default.each(enemyFactionOrder, function (faction) {\n                    var stolen = Math.min(numResourcesToSteal, faction.resources());\n                    _removeResources2.default.execute(state, { factionId: faction.id, count: stolen });\n                    numResourcesToSteal -= stolen;\n\n                    if (numResourcesToSteal <= 0) {\n                        return false;\n                    }\n                });\n            });\n            turn.commitCommand();\n\n            return true;\n        }\n    }, {\n        key: 'getEnemyFactionOrder',\n        value: function getEnemyFactionOrder(state) {\n            return (0, _lodash2.default)(state.factions).reject({ id: _factionIds2.default.GERMANIC_TRIBES }).partition('isNonPlayer').map(_lodash2.default.shuffle).flatten().sortBy('isNonPlayer').value();\n        }\n    }]);\n\n    return GermanicRaid;\n}();\n\nexports.default = GermanicRaid;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNSYWlkLmpzP2MwZmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5pbXBvcnQgUmV2ZWFsUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmV2ZWFsUGllY2VzJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IFJhaWQgZnJvbSAnLi4vLi4vY29tbWFuZHMvcmFpZCc7XG5cbmNsYXNzIEdlcm1hbmljUmFpZCB7XG4gICAgc3RhdGljIHJhaWQoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEdlcm1hbmljIFJhaWQgKioqJyk7XG4gICAgICAgIGNvbnN0IGdlcm1hbmljRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU107XG4gICAgICAgIGNvbnN0IHJhaWRSZXN1bHRzID0gUmFpZC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pO1xuXG4gICAgICAgIGlmKHJhaWRSZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG4gICAgICAgIHR1cm4uc3RhcnRDb21tYW5kKENvbW1hbmRJRHMuUkFJRCk7XG5cbiAgICAgICAgXy5lYWNoKHJhaWRSZXN1bHRzLCAocmFpZFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW5lbXlGYWN0aW9uT3JkZXIgPSB0aGlzLmdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKTtcblxuICAgICAgICAgICAgY29uc3QgbnVtSGlkZGVuV2FyYmFuZHMgPSBfLmZpbHRlcihyYWlkUmVzdWx0LnJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU10sIGZ1bmN0aW9uIChwaWVjZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnd2FyYmFuZCcgJiYgIXBpZWNlLnJldmVhbGVkKCk7XG4gICAgICAgICAgICB9KS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0ZWFsYWJsZVJlc291cmNlcyA9IF8ucmVkdWNlKGVuZW15RmFjdGlvbk9yZGVyLCBmdW5jdGlvbihzdW0sIGZhY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIGZhY3Rpb24ucmVzb3VyY2VzKCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlc0dhaW5lZCA9IF8ubWluKFsyLCBudW1IaWRkZW5XYXJiYW5kcywgc3RlYWxhYmxlUmVzb3VyY2VzXSk7XG4gICAgICAgICAgICBSZXZlYWxQaWVjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogZ2VybWFuaWNGYWN0aW9uLmlkLCByZWdpb25JZDogcmFpZFJlc3VsdC5yZWdpb24uaWQsIGNvdW50OiByZXNvdXJjZXNHYWluZWR9KTtcblxuICAgICAgICAgICAgbGV0IG51bVJlc291cmNlc1RvU3RlYWwgPSByZXNvdXJjZXNHYWluZWQ7XG5cblxuICAgICAgICAgICAgXy5lYWNoKGVuZW15RmFjdGlvbk9yZGVyLCBmdW5jdGlvbihmYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvbGVuID0gTWF0aC5taW4obnVtUmVzb3VyY2VzVG9TdGVhbCwgZmFjdGlvbi5yZXNvdXJjZXMoKSk7XG4gICAgICAgICAgICAgICAgUmVtb3ZlUmVzb3VyY2VzLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBmYWN0aW9uLmlkLCBjb3VudDogc3RvbGVufSk7XG4gICAgICAgICAgICAgICAgbnVtUmVzb3VyY2VzVG9TdGVhbCAtPSBzdG9sZW47XG5cbiAgICAgICAgICAgICAgICBpZiAobnVtUmVzb3VyY2VzVG9TdGVhbCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHR1cm4uY29tbWl0Q29tbWFuZCgpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgfVxuXG4gICAgc3RhdGljIGdldEVuZW15RmFjdGlvbk9yZGVyKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLmZhY3Rpb25zKS5yZWplY3Qoe2lkOiBGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU30pLnBhcnRpdGlvbignaXNOb25QbGF5ZXInKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkuc29ydEJ5KCdpc05vblBsYXllcicpLnZhbHVlKCk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEdlcm1hbmljUmFpZDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9nZXJtYW5pYy9nZXJtYW5pY1JhaWQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 139 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar GermanicRally = function () {\n    function GermanicRally() {\n        _classCallCheck(this, GermanicRally);\n    }\n\n    _createClass(GermanicRally, null, [{\n        key: 'rally',\n        value: function rally(state, modifiers) {\n            console.log('*** Germanic Rally ***');\n            var turn = state.turnHistory.getCurrentTurn();\n            turn.startCommand(_commandIds2.default.RALLY);\n            this.placeAllies(state, modifiers);\n            this.placeWarbands(state, modifiers);\n            turn.commitCommand();\n        }\n    }, {\n        key: 'placeAllies',\n        value: function placeAllies(state, modifiers) {\n            var rallyResults = _rally2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            var allyRallies = (0, _lodash2.default)(rallyResults).filter({ canAddAlly: true }).map(function (rallyResult) {\n                var priority = 'c';\n                var subduedSuebi = _lodash2.default.find(rallyResult.region.tribes, function (tribe) {\n                    return tribe.isSubdued() && tribe.id === _tribeIds2.default.SUEBI_NORTH || tribe.id === _tribeIds2.default.SUEBI_SOUTH;\n                });\n                if (subduedSuebi) {\n                    priority = 'a';\n                } else if (rallyResult.region.group === _regionGroups2.default.GERMANIA) {\n                    priority = 'b';\n                }\n                return { rallyResult: rallyResult, priority: priority };\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('rallyResult').value();\n\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n\n            while (germanicFaction.availableAlliedTribes() && allyRallies.length > 0) {\n                var nextRally = allyRallies.shift();\n                _placeAlliedTribe2.default.execute(state, {\n                    factionId: germanicFaction.id,\n                    regionId: nextRally.region.id,\n                    tribeId: this.getAllyDestinationTribe(nextRally.region).id\n                });\n            }\n        }\n    }, {\n        key: 'getAllyDestinationTribe',\n        value: function getAllyDestinationTribe(region) {\n            var subdued = (0, _lodash2.default)(region.tribes).filter(function (tribe) {\n                return tribe.isSubdued();\n            }).value();\n\n            var suebi = _lodash2.default.find(subdued, function (tribe) {\n                return tribe.id === _tribeIds2.default.SUEBI_NORTH || tribe.id === _tribeIds2.default.SUEBI_SOUTH;\n            });\n\n            return suebi || _lodash2.default.sample(subdued);\n        }\n    }, {\n        key: 'placeWarbands',\n        value: function placeWarbands(state, modifiers) {\n            var rallyResults = _rally2.default.test(state, { factionId: _factionIds2.default.GERMANIC_TRIBES });\n            var warbandResults = (0, _lodash2.default)(rallyResults).filter(function (result) {\n                return result.canAddNumWarbands > 0;\n            }).shuffle().value();\n            var germanicFaction = state.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n            _lodash2.default.each(warbandResults, function (result) {\n                _placeWarbands2.default.execute(state, {\n                    factionId: germanicFaction.id,\n                    regionId: result.region.id,\n                    count: Math.min(result.canAddNumWarbands, germanicFaction.availableWarbands().length)\n                });\n\n                if (germanicFaction.availableWarbands().length === 0) {\n                    return false;\n                }\n            });\n        }\n    }]);\n\n    return GermanicRally;\n}();\n\nexports.default = GermanicRally;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNSYWxseS5qcz81NWU3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi8uLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBUcmliZUlEcyBmcm9tICcuLi8uLi9jb25maWcvdHJpYmVJZHMnO1xuaW1wb3J0IFJhbGx5IGZyb20gJy4uLy4uL2NvbW1hbmRzL3JhbGx5JztcbmltcG9ydCBQbGFjZUFsbGllZFRyaWJlIGZyb20gJy4uLy4uL2FjdGlvbnMvcGxhY2VBbGxpZWRUcmliZSc7XG5pbXBvcnQgUGxhY2VXYXJiYW5kcyBmcm9tICcuLi8uLi9hY3Rpb25zL3BsYWNlV2FyYmFuZHMnO1xuXG5jbGFzcyBHZXJtYW5pY1JhbGx5IHtcbiAgICBzdGF0aWMgcmFsbHkoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqIEdlcm1hbmljIFJhbGx5ICoqKicpO1xuICAgICAgICBjb25zdCB0dXJuID0gc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKTtcbiAgICAgICAgdHVybi5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5SQUxMWSk7XG4gICAgICAgIHRoaXMucGxhY2VBbGxpZXMoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgIHRoaXMucGxhY2VXYXJiYW5kcyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgdHVybi5jb21taXRDb21tYW5kKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHBsYWNlQWxsaWVzKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3QgcmFsbHlSZXN1bHRzID0gUmFsbHkudGVzdChzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVN9KTtcbiAgICAgICAgY29uc3QgYWxseVJhbGxpZXMgPSBfKHJhbGx5UmVzdWx0cykuZmlsdGVyKHtjYW5BZGRBbGx5OiB0cnVlfSkubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJhbGx5UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgbGV0IHByaW9yaXR5ID0gJ2MnO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YmR1ZWRTdWViaSA9IF8uZmluZChcbiAgICAgICAgICAgICAgICAgICAgcmFsbHlSZXN1bHQucmVnaW9uLnRyaWJlcywgZnVuY3Rpb24gKHRyaWJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpYmUuaXNTdWJkdWVkKCkgJiYgdHJpYmUuaWQgPT09IFRyaWJlSURzLlNVRUJJX05PUlRIIHx8IHRyaWJlLmlkID09PSBUcmliZUlEcy5TVUVCSV9TT1VUSDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHN1YmR1ZWRTdWViaSkge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmFsbHlSZXN1bHQucmVnaW9uLmdyb3VwID09PSBSZWdpb25Hcm91cHMuR0VSTUFOSUEpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7cmFsbHlSZXN1bHQsIHByaW9yaXR5fTtcbiAgICAgICAgICAgIH0pLnNvcnRCeSgncHJpb3JpdHknKS5ncm91cEJ5KCdwcmlvcml0eScpLm1hcChfLnNodWZmbGUpLmZsYXR0ZW4oKS5tYXAoJ3JhbGx5UmVzdWx0JykudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBnZXJtYW5pY0ZhY3Rpb24gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdO1xuXG4gICAgICAgIHdoaWxlIChnZXJtYW5pY0ZhY3Rpb24uYXZhaWxhYmxlQWxsaWVkVHJpYmVzKCkgJiYgYWxseVJhbGxpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgbmV4dFJhbGx5ID0gYWxseVJhbGxpZXMuc2hpZnQoKTtcbiAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQ6IGdlcm1hbmljRmFjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IG5leHRSYWxseS5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgIHRyaWJlSWQ6IHRoaXMuZ2V0QWxseURlc3RpbmF0aW9uVHJpYmUobmV4dFJhbGx5LnJlZ2lvbikuaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRBbGx5RGVzdGluYXRpb25UcmliZSggcmVnaW9uICkge1xuICAgICAgICBjb25zdCBzdWJkdWVkID0gXyhyZWdpb24udHJpYmVzKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHRyaWJlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmliZS5pc1N1YmR1ZWQoKTtcbiAgICAgICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIGNvbnN0IHN1ZWJpID0gXy5maW5kKFxuICAgICAgICAgICAgICAgIHN1YmR1ZWQsIGZ1bmN0aW9uICh0cmliZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpYmUuaWQgPT09IFRyaWJlSURzLlNVRUJJX05PUlRIIHx8IHRyaWJlLmlkID09PSBUcmliZUlEcy5TVUVCSV9TT1VUSDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gc3VlYmkgfHwgXy5zYW1wbGUoc3ViZHVlZClcbiAgICB9XG5cbiAgICBzdGF0aWMgcGxhY2VXYXJiYW5kcyhzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJhbGx5UmVzdWx0cyA9IFJhbGx5LnRlc3Qoc3RhdGUsIHtmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTfSk7XG4gICAgICAgIGNvbnN0IHdhcmJhbmRSZXN1bHRzID0gXyhyYWxseVJlc3VsdHMpLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LmNhbkFkZE51bVdhcmJhbmRzID4gMCkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgICAgIGNvbnN0IGdlcm1hbmljRmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLkdFUk1BTklDX1RSSUJFU107XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHdhcmJhbmRSZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgUGxhY2VXYXJiYW5kcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBnZXJtYW5pY0ZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcmVzdWx0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBNYXRoLm1pbihyZXN1bHQuY2FuQWRkTnVtV2FyYmFuZHMsIGdlcm1hbmljRmFjdGlvbi5hdmFpbGFibGVXYXJiYW5kcygpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZ2VybWFuaWNGYWN0aW9uLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdlcm1hbmljUmFsbHlcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9nZXJtYW5pYy9nZXJtYW5pY1JhbGx5LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 140 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _battle = __webpack_require__(21);\n\nvar _battle2 = _interopRequireDefault(_battle);\n\nvar _enemyFactionPriority = __webpack_require__(44);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _romanBesiege = __webpack_require__(141);\n\nvar _romanBesiege2 = _interopRequireDefault(_romanBesiege);\n\nvar _enlist = __webpack_require__(55);\n\nvar _enlist2 = _interopRequireDefault(_enlist);\n\nvar _rampage = __webpack_require__(56);\n\nvar _rampage2 = _interopRequireDefault(_rampage);\n\nvar _romanUtils = __webpack_require__(73);\n\nvar _romanUtils2 = _interopRequireDefault(_romanUtils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    PRE_BATTLE_SPECIAL_CHECK: 'pre-battle-special'\n};\n\nvar RomanBattle = function () {\n    function RomanBattle() {\n        _classCallCheck(this, RomanBattle);\n    }\n\n    _createClass(RomanBattle, null, [{\n        key: 'battle',\n        value: function battle(state, modifiers) {\n            var romans = state.romans;\n            var turn = state.turnHistory.getCurrentTurn();\n\n            if (romans.resources() === 0 && !modifiers.free) {\n                return false;\n            }\n\n            var battles = modifiers.context.battles || this.getBattleList(state, modifiers);\n            if (battles.length === 0) {\n                return false;\n            }\n\n            turn.startCommand(_commandIds2.default.BATTLE);\n            modifiers.context.battles = battles;\n\n            if (!turn.getCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK) && modifiers.canDoSpecial()) {\n                modifiers.context.didPreBattleSpecial = _romanBesiege2.default.besiege(state, modifiers);\n                turn.markCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK);\n            }\n\n            _lodash2.default.each(battles, function (battle) {\n                if (!battle.complete) {\n                    if (!battle.paid && !modifiers.free) {\n                        _removeResources2.default.execute(state, { factionId: _factionIds2.default.ROMANS, count: battle.cost });\n                        battle.paid = true;\n                    }\n                    _battle2.default.execute(state, { battleResults: battle });\n                }\n            });\n\n            turn.commitCommand();\n            modifiers.context.battles = null;\n\n            var didSpecial = modifiers.context.didPreBattleSpecial;\n            if (modifiers.canDoSpecial() && !didSpecial) {\n                // didSpecial = RomanScout.scout(state, modifiers);\n            }\n\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getBattleList',\n        value: function getBattleList(state, modifiers) {\n            var romans = state.romans;\n            console.log('*** Are there any effective Roman Battles? ***');\n\n            var importantBattleRegions = this.findImportantBattleRegions(state, modifiers);\n            if (importantBattleRegions.length === 0) {\n                return [];\n            }\n\n            var battlegrounds = this.findBattlegrounds(state, modifiers, importantBattleRegions);\n            var prioritizedBattles = this.prioritizeBattles(state, battlegrounds);\n\n            if (prioritizedBattles.length === 0) {\n                modifiers.context.threatRegions = _lodash2.default.map(importantBattleRegions, function (importantRegion) {\n                    return importantRegion.region.id;\n                });\n                modifiers.context.tryThreatMarch = true;\n                return [];\n            }\n\n            var battles = modifiers.free ? prioritizedBattles : _lodash2.default.reduce(prioritizedBattles, function (accumulator, battle) {\n                if (accumulator.resourcesRemaining >= battle.cost) {\n                    accumulator.resourcesRemaining -= battle.cost;\n                    accumulator.battles.push(battle);\n                }\n                return accumulator;\n            }, { resourcesRemaining: romans.resources(), battles: [] }).battles;\n\n            if (battles.length > 0 && modifiers.limited) {\n                battles = _lodash2.default.take(battles, 1);\n            }\n\n            return battles;\n        }\n    }, {\n        key: 'findImportantBattleRegions',\n        value: function findImportantBattleRegions(state, modifiers) {\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var leader = region.getLeaderForFaction(_factionIds2.default.ROMANS);\n                var hasCaesar = leader && !leader.isSuccessor();\n                var numLegions = region.getLegions().length;\n\n                if (!hasCaesar && numLegions === 0) {\n                    return;\n                }\n\n                var importantEnemyData = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().map(function (factionId) {\n                    var hasLeader = region.getLeaderForFaction(factionId);\n                    var numAlliesAndCitadels = region.numAlliesAndCitadelsForFaction(factionId);\n                    var hasControl = region.controllingFactionId() === factionId;\n\n                    var willInflictCriticalLoss = _romanUtils2.default.canEnemyTurnInflictCriticalLoss(state, region, factionId);\n                    if (!hasLeader && numAlliesAndCitadels === 0 && !hasControl && !willInflictCriticalLoss) {\n                        return;\n                    }\n\n                    return {\n                        factionId: factionId,\n                        hasLeader: hasLeader,\n                        numAlliesAndCitadels: numAlliesAndCitadels,\n                        hasControl: hasControl,\n                        willInflictCriticalLoss: willInflictCriticalLoss\n                    };\n                }).compact().value();\n\n                if (importantEnemyData.length > 0) {\n                    return {\n                        region: region,\n                        hasCaesar: hasCaesar,\n                        numLegions: numLegions,\n                        importantEnemyData: importantEnemyData\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'findBattlegrounds',\n        value: function findBattlegrounds(state, modifiers, importantRegions) {\n            var _this = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var importantRegionData = _lodash2.default.find(importantRegions, function (regionData) {\n                    return regionData.region.id === region.id;\n                });\n                var importantEnemyData = importantRegionData ? _lodash2.default.keyBy(importantRegionData.importantEnemyData, 'factionId') : {};\n\n                if (!importantEnemyData) {\n                    return;\n                }\n\n                var numCriticalEnemies = _lodash2.default.reduce(importantEnemyData, function (sum, enemyData, factionId) {\n                    return enemyData.willInflictCriticalLoss ? sum + 1 : sum;\n                }, 0);\n\n                if (numCriticalEnemies > 1) {\n                    // Too many threats... run away! (Not necessarily part of rules)\n                    return;\n                }\n\n                var potentialBattles = (0, _lodash2.default)(_enemyFactionPriority2.default).keys().map(function (factionId) {\n\n                    var enemyPieces = region.getPiecesForFaction(factionId);\n                    if (enemyPieces.length === 0) {\n                        return;\n                    }\n\n                    if (!importantEnemyData[factionId]) {\n                        return;\n                    }\n\n                    var battleResult = _battle2.default.test(state, {\n                        region: region,\n                        attackingFactionId: _factionIds2.default.ROMANS,\n                        defendingFactionId: factionId\n                    });\n\n                    if (!_this.isEffectiveBattle(battleResult)) {\n                        return;\n                    }\n\n                    return battleResult;\n                }).compact().value();\n\n                if (potentialBattles.length) {\n                    return {\n                        region: region,\n                        potentialBattles: potentialBattles,\n                        importantEnemyData: importantEnemyData\n                    };\n                }\n            }).compact().value();\n        }\n    }, {\n        key: 'isEffectiveBattle',\n        value: function isEffectiveBattle(battleResult) {\n            return !this.isCounterattackLossInflictedOnLegion(battleResult) && this.willCauseEnoughDefenderLosses(battleResult);\n        }\n    }, {\n        key: 'isCounterattackLossInflictedOnLegion',\n        value: function isCounterattackLossInflictedOnLegion(battleResult) {\n            return battleResult.willInflictCounterattackLossAgainstLegion();\n        }\n    }, {\n        key: 'willCauseEnoughDefenderLosses',\n        value: function willCauseEnoughDefenderLosses(battleResult) {\n            // 8.8.1 They do so only in Regions where the Defender would inflict less than half the Losses (as distinct from removals) on the Romans\n            // as the Romans would inflict\n            return battleResult.defenderLosses.normal > 0 && battleResult.worstCaseAttackerLosses.normal < battleResult.defenderLosses.normal / 2;\n        }\n    }, {\n        key: 'prioritizeBattles',\n        value: function prioritizeBattles(state, battlegrounds) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(battlegrounds).map(function (battleground) {\n                return _this2.getBestBattleForBattleground(state, battleground);\n            }).sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('battle').value();\n        }\n    }, {\n        key: 'getBestBattleForBattleground',\n        value: function getBestBattleForBattleground(state, battleground) {\n            return (0, _lodash2.default)(battleground.potentialBattles).map(function (potentialBattle) {\n                var priority = void 0;\n                var enemyData = battleground.importantEnemyData[potentialBattle.defendingFaction.id];\n\n                if (enemyData.hasLeader) {\n                    priority = 'a-';\n                }\n\n                if (enemyData.numAlliesAndCitadels > 0) {\n                    priority += 'b' + (99 - enemyData.numAlliesAndCitadels) + '-';\n                }\n\n                priority += 'c' + (99 - potentialBattle.region.getWarbandsOrAuxiliaForFaction(potentialBattle.defendingFaction.id).length);\n\n                var faction = state.factionsById[potentialBattle.defendingFaction.id];\n                var player = state.playersByFaction[potentialBattle.defendingFaction.id];\n                priority += '-' + (50 - faction.victoryMargin(state)) + '-' + (player.isNonPlayer ? 'b' : 'a');\n                return {\n                    battle: potentialBattle,\n                    priority: priority\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().first();\n        }\n    }]);\n\n    return RomanBattle;\n}();\n\nexports.default = RomanBattle;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuQmF0dGxlLmpzPzE3YzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZElEcyBmcm9tICcuLi8uLi9jb25maWcvY29tbWFuZElkcyc7XG5pbXBvcnQgU3BlY2lhbEFiaWxpdHlJRHMgZnJvbSAnLi4vLi4vY29uZmlnL3NwZWNpYWxBYmlsaXR5SWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBCYXR0bGUgZnJvbSAnLi4vLi4vY29tbWFuZHMvYmF0dGxlJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICcuL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgUm9tYW5CZXNpZWdlIGZyb20gJ2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5CZXNpZWdlJztcbmltcG9ydCBFbmxpc3QgZnJvbSAnZmFsbGluZ3NreS9jb21tYW5kcy9iZWxnYWUvZW5saXN0JztcbmltcG9ydCBSYW1wYWdlIGZyb20gJ2ZhbGxpbmdza3kvY29tbWFuZHMvYmVsZ2FlL3JhbXBhZ2UnO1xuaW1wb3J0IFJvbWFuVXRpbHMgZnJvbSAnZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hblV0aWxzJztcblxuY29uc3QgQ2hlY2twb2ludHMgPSB7XG4gICAgUFJFX0JBVFRMRV9TUEVDSUFMX0NIRUNLOiAncHJlLWJhdHRsZS1zcGVjaWFsJ1xufTtcblxuY2xhc3MgUm9tYW5CYXR0bGUge1xuXG4gICAgc3RhdGljIGJhdHRsZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJvbWFucyA9IHN0YXRlLnJvbWFucztcbiAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCk7XG5cbiAgICAgICAgaWYgKHJvbWFucy5yZXNvdXJjZXMoKSA9PT0gMCAmJiAhbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzIHx8IHRoaXMuZ2V0QmF0dGxlTGlzdChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGJhdHRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0dXJuLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLkJBVFRMRSk7XG4gICAgICAgIG1vZGlmaWVycy5jb250ZXh0LmJhdHRsZXMgPSBiYXR0bGVzO1xuXG4gICAgICAgIGlmICghdHVybi5nZXRDaGVja3BvaW50KENoZWNrcG9pbnRzLlBSRV9CQVRUTEVfU1BFQ0lBTF9DSEVDSykgJiYgbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpKSB7XG4gICAgICAgICAgICBtb2RpZmllcnMuY29udGV4dC5kaWRQcmVCYXR0bGVTcGVjaWFsID0gUm9tYW5CZXNpZWdlLmJlc2llZ2Uoc3RhdGUsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICB0dXJuLm1hcmtDaGVja3BvaW50KENoZWNrcG9pbnRzLlBSRV9CQVRUTEVfU1BFQ0lBTF9DSEVDSyk7XG4gICAgICAgIH1cblxuICAgICAgICBfLmVhY2goYmF0dGxlcywgKGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFiYXR0bGUuY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWJhdHRsZS5wYWlkICYmICFtb2RpZmllcnMuZnJlZSkge1xuICAgICAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsIGNvdW50OiBiYXR0bGUuY29zdH0pO1xuICAgICAgICAgICAgICAgICAgICBiYXR0bGUucGFpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEJhdHRsZS5leGVjdXRlKHN0YXRlLCB7YmF0dGxlUmVzdWx0czogYmF0dGxlfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHR1cm4uY29tbWl0Q29tbWFuZCgpO1xuICAgICAgICBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzID0gbnVsbDtcblxuICAgICAgICBsZXQgZGlkU3BlY2lhbCA9IG1vZGlmaWVycy5jb250ZXh0LmRpZFByZUJhdHRsZVNwZWNpYWw7XG4gICAgICAgIGlmIChtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkgJiYgIWRpZFNwZWNpYWwpIHtcbiAgICAgICAgICAgIC8vIGRpZFNwZWNpYWwgPSBSb21hblNjb3V0LnNjb3V0KHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRpZFNwZWNpYWwgPyBGYWN0aW9uQWN0aW9ucy5DT01NQU5EX0FORF9TUEVDSUFMIDogRmFjdGlvbkFjdGlvbnMuQ09NTUFORDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0QmF0dGxlTGlzdChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHJvbWFucyA9IHN0YXRlLnJvbWFucztcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBBcmUgdGhlcmUgYW55IGVmZmVjdGl2ZSBSb21hbiBCYXR0bGVzPyAqKionKTtcblxuICAgICAgICBjb25zdCBpbXBvcnRhbnRCYXR0bGVSZWdpb25zID0gdGhpcy5maW5kSW1wb3J0YW50QmF0dGxlUmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKGltcG9ydGFudEJhdHRsZVJlZ2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBiYXR0bGVncm91bmRzID0gdGhpcy5maW5kQmF0dGxlZ3JvdW5kcyhzdGF0ZSwgbW9kaWZpZXJzLCBpbXBvcnRhbnRCYXR0bGVSZWdpb25zKTtcbiAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWRCYXR0bGVzID0gdGhpcy5wcmlvcml0aXplQmF0dGxlcyhzdGF0ZSwgYmF0dGxlZ3JvdW5kcyk7XG5cbiAgICAgICAgaWYgKHByaW9yaXRpemVkQmF0dGxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIG1vZGlmaWVycy5jb250ZXh0LnRocmVhdFJlZ2lvbnMgPSBfLm1hcChpbXBvcnRhbnRCYXR0bGVSZWdpb25zLCBpbXBvcnRhbnRSZWdpb24gPT4gaW1wb3J0YW50UmVnaW9uLnJlZ2lvbi5pZCk7XG4gICAgICAgICAgICBtb2RpZmllcnMuY29udGV4dC50cnlUaHJlYXRNYXJjaCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYmF0dGxlcyA9IG1vZGlmaWVycy5mcmVlID8gcHJpb3JpdGl6ZWRCYXR0bGVzIDogXy5yZWR1Y2UocHJpb3JpdGl6ZWRCYXR0bGVzLCAoYWNjdW11bGF0b3IsIGJhdHRsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyA+PSBiYXR0bGUuY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSBiYXR0bGUuY29zdDtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5iYXR0bGVzLnB1c2goYmF0dGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvclxuICAgICAgICB9LCB7cmVzb3VyY2VzUmVtYWluaW5nOiByb21hbnMucmVzb3VyY2VzKCksIGJhdHRsZXM6IFtdfSkuYmF0dGxlcztcblxuICAgICAgICBpZiAoYmF0dGxlcy5sZW5ndGggPiAwICYmIG1vZGlmaWVycy5saW1pdGVkKSB7XG4gICAgICAgICAgICBiYXR0bGVzID0gXy50YWtlKGJhdHRsZXMsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJhdHRsZXM7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRJbXBvcnRhbnRCYXR0bGVSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgcmV0dXJuIF8oc3RhdGUucmVnaW9ucykubWFwKFxuICAgICAgICAgICAgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlYWRlciA9IHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNDYWVzYXIgPSBsZWFkZXIgJiYgIWxlYWRlci5pc1N1Y2Nlc3NvcigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUxlZ2lvbnMgPSByZWdpb24uZ2V0TGVnaW9ucygpLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIGlmICghaGFzQ2Flc2FyICYmIG51bUxlZ2lvbnMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGltcG9ydGFudEVuZW15RGF0YSA9IF8oRW5lbXlGYWN0aW9uUHJpb3JpdHkpLmtleXMoKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0xlYWRlciA9IHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKGZhY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1BbGxpZXNBbmRDaXRhZGVscyA9IHJlZ2lvbi5udW1BbGxpZXNBbmRDaXRhZGVsc0ZvckZhY3Rpb24oZmFjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0NvbnRyb2wgPSByZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSA9PT0gZmFjdGlvbklkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3aWxsSW5mbGljdENyaXRpY2FsTG9zcyA9IFJvbWFuVXRpbHMuY2FuRW5lbXlUdXJuSW5mbGljdENyaXRpY2FsTG9zcyhzdGF0ZSwgcmVnaW9uLCBmYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNMZWFkZXIgJiYgbnVtQWxsaWVzQW5kQ2l0YWRlbHMgPT09IDAgJiYgIWhhc0NvbnRyb2wgJiYgIXdpbGxJbmZsaWN0Q3JpdGljYWxMb3NzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNMZWFkZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtQWxsaWVzQW5kQ2l0YWRlbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ29udHJvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsSW5mbGljdENyaXRpY2FsTG9zc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgIGlmIChpbXBvcnRhbnRFbmVteURhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ2Flc2FyLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtTGVnaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGFudEVuZW15RGF0YVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kQmF0dGxlZ3JvdW5kcyhzdGF0ZSwgbW9kaWZpZXJzLCBpbXBvcnRhbnRSZWdpb25zKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbXBvcnRhbnRSZWdpb25EYXRhID0gXy5maW5kKGltcG9ydGFudFJlZ2lvbnMsIHJlZ2lvbkRhdGEgPT4gcmVnaW9uRGF0YS5yZWdpb24uaWQgPT09IHJlZ2lvbi5pZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0YW50RW5lbXlEYXRhID0gaW1wb3J0YW50UmVnaW9uRGF0YSA/IF8ua2V5QnkoaW1wb3J0YW50UmVnaW9uRGF0YS5pbXBvcnRhbnRFbmVteURhdGEsICdmYWN0aW9uSWQnKSA6IHt9O1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpbXBvcnRhbnRFbmVteURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG51bUNyaXRpY2FsRW5lbWllcyA9IF8ucmVkdWNlKGltcG9ydGFudEVuZW15RGF0YSwgKHN1bSwgZW5lbXlEYXRhLCBmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVuZW15RGF0YS53aWxsSW5mbGljdENyaXRpY2FsTG9zcyA/IHN1bSArIDEgOiBzdW07XG4gICAgICAgICAgICAgICAgICAgIH0sIDAgKTtcblxuICAgICAgICAgICAgICAgIGlmKG51bUNyaXRpY2FsRW5lbWllcyA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVG9vIG1hbnkgdGhyZWF0cy4uLiBydW4gYXdheSEgKE5vdCBuZWNlc3NhcmlseSBwYXJ0IG9mIHJ1bGVzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgcG90ZW50aWFsQmF0dGxlcyA9IF8oRW5lbXlGYWN0aW9uUHJpb3JpdHkpLmtleXMoKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgIChmYWN0aW9uSWQpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5lbXlQaWVjZXMgPSByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihmYWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZW15UGllY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWltcG9ydGFudEVuZW15RGF0YVtmYWN0aW9uSWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXR0bGVSZXN1bHQgPSBCYXR0bGUudGVzdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNraW5nRmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nRmFjdGlvbklkOiBmYWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRWZmZWN0aXZlQmF0dGxlKGJhdHRsZVJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBvdGVudGlhbEJhdHRsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxCYXR0bGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0YW50RW5lbXlEYXRhXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzRWZmZWN0aXZlQmF0dGxlKGJhdHRsZVJlc3VsdCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuaXNDb3VudGVyYXR0YWNrTG9zc0luZmxpY3RlZE9uTGVnaW9uKGJhdHRsZVJlc3VsdCkgJiYgdGhpcy53aWxsQ2F1c2VFbm91Z2hEZWZlbmRlckxvc3NlcyhcbiAgICAgICAgICAgICAgICBiYXR0bGVSZXN1bHQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0NvdW50ZXJhdHRhY2tMb3NzSW5mbGljdGVkT25MZWdpb24oYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQud2lsbEluZmxpY3RDb3VudGVyYXR0YWNrTG9zc0FnYWluc3RMZWdpb24oKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgd2lsbENhdXNlRW5vdWdoRGVmZW5kZXJMb3NzZXMoYmF0dGxlUmVzdWx0KSB7XG4gICAgICAgIC8vIDguOC4xIFRoZXkgZG8gc28gb25seSBpbiBSZWdpb25zIHdoZXJlIHRoZSBEZWZlbmRlciB3b3VsZCBpbmZsaWN0IGxlc3MgdGhhbiBoYWxmIHRoZSBMb3NzZXMgKGFzIGRpc3RpbmN0IGZyb20gcmVtb3ZhbHMpIG9uIHRoZSBSb21hbnNcbiAgICAgICAgLy8gYXMgdGhlIFJvbWFucyB3b3VsZCBpbmZsaWN0XG4gICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQuZGVmZW5kZXJMb3NzZXMubm9ybWFsID4gMCAmJiBiYXR0bGVSZXN1bHQud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsIDwgKGJhdHRsZVJlc3VsdC5kZWZlbmRlckxvc3Nlcy5ub3JtYWwgLyAyKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgcHJpb3JpdGl6ZUJhdHRsZXMoc3RhdGUsIGJhdHRsZWdyb3VuZHMpIHtcbiAgICAgICAgcmV0dXJuIF8oYmF0dGxlZ3JvdW5kcykubWFwKFxuICAgICAgICAgICAgKGJhdHRsZWdyb3VuZCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJlc3RCYXR0bGVGb3JCYXR0bGVncm91bmQoc3RhdGUsIGJhdHRsZWdyb3VuZCk7XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkubWFwKCdiYXR0bGUnKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCZXN0QmF0dGxlRm9yQmF0dGxlZ3JvdW5kKHN0YXRlLCBiYXR0bGVncm91bmQpIHtcbiAgICAgICAgcmV0dXJuIF8oYmF0dGxlZ3JvdW5kLnBvdGVudGlhbEJhdHRsZXMpLm1hcChcbiAgICAgICAgICAgIChwb3RlbnRpYWxCYXR0bGUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5lbXlEYXRhID0gYmF0dGxlZ3JvdW5kLmltcG9ydGFudEVuZW15RGF0YVtwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZF07XG5cbiAgICAgICAgICAgICAgICBpZiAoZW5lbXlEYXRhLmhhc0xlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdhLSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVuZW15RGF0YS5udW1BbGxpZXNBbmRDaXRhZGVscyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHkgKz0gJ2InICsgKDk5IC0gZW5lbXlEYXRhLm51bUFsbGllc0FuZENpdGFkZWxzKSArICctJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwcmlvcml0eSArPSAnYycgKyAoOTkgLSBwb3RlbnRpYWxCYXR0bGUucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvdGVudGlhbEJhdHRsZS5kZWZlbmRpbmdGYWN0aW9uLmlkKS5sZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbiA9IHN0YXRlLmZhY3Rpb25zQnlJZFtwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZF07XG4gICAgICAgICAgICAgICAgY29uc3QgcGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltwb3RlbnRpYWxCYXR0bGUuZGVmZW5kaW5nRmFjdGlvbi5pZF07XG4gICAgICAgICAgICAgICAgcHJpb3JpdHkgKz0gJy0nICsgKDUwIC0gZmFjdGlvbi52aWN0b3J5TWFyZ2luKHN0YXRlKSkgKyAnLScgKyAocGxheWVyLmlzTm9uUGxheWVyID8gJ2InIDogJ2EnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBiYXR0bGU6IHBvdGVudGlhbEJhdHRsZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLmZpcnN0KCk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFJvbWFuQmF0dGxlO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuQmF0dGxlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUdBOzs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFFQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 141 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _besiege = __webpack_require__(160);\n\nvar _besiege2 = _interopRequireDefault(_besiege);\n\nvar _specialAbilityIds = __webpack_require__(11);\n\nvar _specialAbilityIds2 = _interopRequireDefault(_specialAbilityIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanBesiege = function () {\n    function RomanBesiege() {\n        _classCallCheck(this, RomanBesiege);\n    }\n\n    _createClass(RomanBesiege, null, [{\n        key: 'besiege',\n        value: function besiege(state, modifiers) {\n            var battles = modifiers.context.battles;\n\n            var effectiveBesieges = (0, _lodash2.default)(_besiege2.default.test(state, {\n                battles: battles\n            })).filter(function (result) {\n                return result.willRemoveExtraAlly || result.willRemoveExtraCitadel;\n            }).value();\n\n            if (effectiveBesieges.length === 0) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startSpecialAbility(_specialAbilityIds2.default.BESIEGE);\n            _lodash2.default.each(battles, function (battle) {\n                battle.willBesiege = true;\n            });\n            state.turnHistory.getCurrentTurn().commitSpecialAbility();\n\n            return true;\n        }\n    }]);\n\n    return RomanBesiege;\n}();\n\nexports.default = RomanBesiege;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuQmVzaWVnZS5qcz8wYTA0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEJlc2llZ2UgZnJvbSAnLi4vLi4vY29tbWFuZHMvcm9tYW5zL2Jlc2llZ2UnO1xuaW1wb3J0IFNwZWNpYWxBYmlsaXR5SURzIGZyb20gJy4uLy4uL2NvbmZpZy9zcGVjaWFsQWJpbGl0eUlkcyc7XG5cbmNsYXNzIFJvbWFuQmVzaWVnZSB7XG5cbiAgICBzdGF0aWMgYmVzaWVnZShzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IGJhdHRsZXMgPSBtb2RpZmllcnMuY29udGV4dC5iYXR0bGVzO1xuXG4gICAgICAgIGNvbnN0IGVmZmVjdGl2ZUJlc2llZ2VzID0gXyhCZXNpZWdlLnRlc3Qoc3RhdGUsIHtcbiAgICAgICAgICAgIGJhdHRsZXM6IGJhdHRsZXNcbiAgICAgICAgfSkpLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LndpbGxSZW1vdmVFeHRyYUFsbHkgfHwgcmVzdWx0LndpbGxSZW1vdmVFeHRyYUNpdGFkZWwpLnZhbHVlKCk7XG5cbiAgICAgICAgaWYoZWZmZWN0aXZlQmVzaWVnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0U3BlY2lhbEFiaWxpdHkoU3BlY2lhbEFiaWxpdHlJRHMuQkVTSUVHRSk7XG4gICAgICAgIF8uZWFjaChiYXR0bGVzLCAoYmF0dGxlKSA9PiB7XG4gICAgICAgICAgICBiYXR0bGUud2lsbEJlc2llZ2UgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRTcGVjaWFsQWJpbGl0eSgpO1xuXG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSb21hbkJlc2llZ2U7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuQmVzaWVnZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 142 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NoEvents = [];\nvar CapabilityEvents = [8, 10, 12, 13, 15, 25, 27, 30, 38, 39, 43, 55, 59, 63];\nvar EventHandlers = {};\n\nvar RomanEvent = function () {\n    function RomanEvent() {\n        _classCallCheck(this, RomanEvent);\n    }\n\n    _createClass(RomanEvent, null, [{\n        key: 'handleEvent',\n        value: function handleEvent(state) {\n            var currentCard = state.currentCard();\n            console.log('*** Is Roman No Event? ***');\n            if (_lodash2.default.indexOf(NoEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Is Capability in final year? ***');\n            if (state.isLastYear() && _lodash2.default.indexOf(CapabilityEvents, currentCard.id) >= 0) {\n                return false;\n            }\n\n            console.log('*** Is Event effective? ***');\n            var eventHandler = EventHandlers[currentCard.id];\n            if (!eventHandler) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startEvent(currentCard.id);\n            var handled = eventHandler.handleEvent(state);\n            if (!handled) {\n                state.turnHistory.getCurrentTurn().rollbackEvent();\n            } else {\n                state.turnHistory.getCurrentTurn().commitEvent();\n            }\n\n            return handled;\n        }\n    }]);\n\n    return RomanEvent;\n}();\n\nexports.default = RomanEvent;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuRXZlbnQuanM/NWU1NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY29uc3QgTm9FdmVudHMgPSBbXTtcbmNvbnN0IENhcGFiaWxpdHlFdmVudHMgPSBbOCwxMCwxMiwxMywxNSwyNSwyNywzMCwzOCwzOSw0Myw1NSw1OSw2M107XG5jb25zdCBFdmVudEhhbmRsZXJzID0ge307XG5cbmNsYXNzIFJvbWFuRXZlbnQge1xuXG4gICAgc3RhdGljIGhhbmRsZUV2ZW50KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDYXJkID0gc3RhdGUuY3VycmVudENhcmQoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBJcyBSb21hbiBObyBFdmVudD8gKioqJyk7XG4gICAgICAgIGlmIChfLmluZGV4T2YoTm9FdmVudHMsIGN1cnJlbnRDYXJkLmlkKSA+PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnKioqIElzIENhcGFiaWxpdHkgaW4gZmluYWwgeWVhcj8gKioqJyk7XG4gICAgICAgIGlmKHN0YXRlLmlzTGFzdFllYXIoKSAmJiBfLmluZGV4T2YoQ2FwYWJpbGl0eUV2ZW50cywgY3VycmVudENhcmQuaWQpID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogSXMgRXZlbnQgZWZmZWN0aXZlPyAqKionKTtcbiAgICAgICAgY29uc3QgZXZlbnRIYW5kbGVyID0gRXZlbnRIYW5kbGVyc1tjdXJyZW50Q2FyZC5pZF07XG4gICAgICAgIGlmICghZXZlbnRIYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0RXZlbnQoY3VycmVudENhcmQuaWQpO1xuICAgICAgICBjb25zdCBoYW5kbGVkID0gZXZlbnRIYW5kbGVyLmhhbmRsZUV2ZW50KHN0YXRlKTtcbiAgICAgICAgaWYoIWhhbmRsZWQpIHtcbiAgICAgICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkucm9sbGJhY2tFdmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRFdmVudCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGhhbmRsZWQ7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFJvbWFuRXZlbnQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuRXZlbnQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 143 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _march = __webpack_require__(28);\n\nvar _march2 = _interopRequireDefault(_march);\n\nvar _movePieces = __webpack_require__(10);\n\nvar _movePieces2 = _interopRequireDefault(_movePieces);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _hidePieces = __webpack_require__(26);\n\nvar _hidePieces2 = _interopRequireDefault(_hidePieces);\n\nvar _enemyFactionPriority = __webpack_require__(44);\n\nvar _enemyFactionPriority2 = _interopRequireDefault(_enemyFactionPriority);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _map = __webpack_require__(31);\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _romanUtils = __webpack_require__(73);\n\nvar _romanUtils2 = _interopRequireDefault(_romanUtils);\n\nvar _romanBuild = __webpack_require__(53);\n\nvar _romanBuild2 = _interopRequireDefault(_romanBuild);\n\nvar _romanScout = __webpack_require__(54);\n\nvar _romanScout2 = _interopRequireDefault(_romanScout);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanMarch = function () {\n    function RomanMarch() {\n        _classCallCheck(this, RomanMarch);\n    }\n\n    _createClass(RomanMarch, null, [{\n        key: 'march',\n        value: function march(state, modifiers) {\n            var _this = this;\n\n            var skipCondition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n            if (state.frost()) {\n                return false;\n            }\n\n            var effective = false;\n            var marchResults = _march2.default.test(state, { factionId: _factionIds2.default.ROMANS });\n\n            var marches = this.getMarches(state, modifiers, marchResults);\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.MARCH);\n            console.log('*** Romans Marching ***');\n            _lodash2.default.each(marches, function (march) {\n                if (!_this.payForMarchAndHide(state, modifiers, march)) {\n                    return false;\n                }\n\n                if (march.groups) {\n                    _lodash2.default.each(march.groups, function (group) {\n                        _movePieces2.default.execute(state, {\n                            sourceRegionId: march.region.id,\n                            destRegionId: group.targetDestination.id,\n                            pieces: _this.getPiecesToMoveForRegion(march.region, group.pieceData)\n                        });\n                        if (group.pieceData.harassedAuxilia > 0) {\n                            var harassedPieces = _lodash2.default.take(march.region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), group.pieceData.harassedAuxilia);\n                            _removePieces2.default.execute(state, {\n                                factionId: _factionIds2.default.ROMANS,\n                                regionId: march.region.id,\n                                pieces: harassedPieces\n                            });\n                        }\n                    });\n                }\n                effective = true;\n            });\n\n            if (!effective) {\n                state.turnHistory.getCurrentTurn().rollbackCommand();\n                return false;\n            }\n            state.turnHistory.getCurrentTurn().commitCommand();\n\n            var didSpecial = false;\n            if (modifiers.canDoSpecial()) {\n                // && !this.wasBritanniaMarch(marches)) {\n                didSpecial = _romanBuild2.default.build(state, modifiers) || _romanScout2.default.scout(state, modifiers);\n            }\n\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getMarches',\n        value: function getMarches(state, modifiers, marchResults) {\n            var _this2 = this;\n\n            var threatRegionIds = modifiers.context.threatRegions || [];\n            var otherMarchRegionIds = (0, _lodash2.default)(state.regionsById).filter(function (region, id) {\n                var threatRegion = _lodash2.default.indexOf(threatRegionIds, id) >= 0;\n                var noEnemyAlliesOrCitadels = !_lodash2.default.find(region.pieces(), function (piece) {\n                    return (piece.type === 'alliedtribe' || piece.type === 'citadel') && piece.factionId !== _factionIds2.default.ROMANS;\n                });\n                var hasMobileRomans = _this2.getMarchingPieces(region);\n\n                return !threatRegion && region.inPlay() && noEnemyAlliesOrCitadels && hasMobileRomans;\n            }).map(function (region, id) {\n                return region.id;\n            }).value();\n\n            var prioritizedFactions = this.getEnemyFactionPriority(state);\n\n            var threatMarches = _lodash2.default.filter(marchResults, function (result) {\n                return _lodash2.default.indexOf(threatRegionIds, result.region.id) >= 0;\n            });\n            var otherMarches = (0, _lodash2.default)(marchResults).filter(function (result) {\n                return _lodash2.default.indexOf(otherMarchRegionIds, result.region.id) >= 0;\n            }).sortBy('cost').value();\n            var allMarches = _lodash2.default.concat(threatMarches, otherMarches);\n            var affordableMarches = this.getAffordableMarches(state, modifiers, allMarches);\n            var marchData = this.prioritizeMarchDestinations(state, affordableMarches, prioritizedFactions, threatRegionIds);\n\n            if (state.romans.offMapLegions() > 5) {\n                var marchToOneMarches = this.getMarchToOneMarches(state, modifiers, marchData);\n                if (marchToOneMarches) {\n                    return marchToOneMarches;\n                }\n            }\n\n            return this.getMarchToTwoMarches(state, modifiers, marchData);\n        }\n    }, {\n        key: 'getAffordableMarches',\n        value: function getAffordableMarches(state, modifiers, allMarches) {\n            return modifiers.free ? allMarches : _lodash2.default.reduce(allMarches, function (accumulator, march) {\n                if (accumulator.resourcesRemaining >= march.cost) {\n                    accumulator.resourcesRemaining -= march.cost;\n                    accumulator.marches.push(march);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.romans.resources(), marches: [] }).marches;\n        }\n    }, {\n        key: 'getDestinationPairs',\n        value: function getDestinationPairs(state, modifiers, marchData) {\n            var allDestinations = (0, _lodash2.default)(marchData).map('prioritizedDestinations').flatten().uniqBy(function (destinationData) {\n                return destinationData.destination.id;\n            }).value();\n\n            // Assign bitvalue to each destination, equal to the sum of each valid march where the value for each is (2^marchindex)\n            _lodash2.default.each(allDestinations, function (destination) {\n                destination.bitvalue = _lodash2.default.reduce(marchData, function (bitvalue, data, index) {\n                    if (_lodash2.default.find(data.prioritizedDestinations, function (destinationData) {\n                        return destinationData.destination.id === destination.destination.id;\n                    })) {\n                        return bitvalue += 2 ** index;\n                    }\n                    return bitvalue;\n                }, 0);\n            });\n\n            // Find all pairs of regions\n            var allPairs = this.getDestinationCombinations(allDestinations);\n\n            // Keep all that == 2^marchlen -1\n            var allMarchedMask = 2 ** marchData.length - 1;\n            var allMarchedPairs = _lodash2.default.filter(allPairs, function (pair) {\n                return (pair[0].bitvalue | pair[1].bitvalue) === allMarchedMask;\n            });\n\n            // Find best priority in all pairs\n            var bestPriority = (0, _lodash2.default)(allMarchedPairs).flatten().map('priority').uniq().sort().first();\n\n            // Reject any that do not have that max priority\n            var allMarchedWithBestPriority = _lodash2.default.filter(allMarchedPairs, function (pair) {\n                return pair[0].priority === bestPriority || pair[1].priority === bestPriority;\n            });\n\n            // Group them by priority and take best group\n            var groupedPairsByPriority = _lodash2.default.groupBy(allMarchedWithBestPriority, function (pair) {\n                return pair[0].priority + pair[1].priority;\n            });\n            return groupedPairsByPriority[(0, _lodash2.default)(groupedPairsByPriority).keys().sort().first()];\n        }\n    }, {\n        key: 'getDestinationCombinations',\n        value: function getDestinationCombinations(destinations) {\n            if (destinations.length < 2) {\n                return [];\n            }\n\n            var combinations = [];\n            _lodash2.default.each(_lodash2.default.range(0, destinations.length - 1), function (index) {\n                var head = _lodash2.default.nth(destinations, index);\n                var tail = _lodash2.default.drop(destinations, index + 1);\n                combinations.push.apply(combinations, _lodash2.default.map(tail, function (destination) {\n                    return [head, destination];\n                }));\n            });\n            return combinations;\n        }\n    }, {\n        key: 'calculatePiecesToPairs',\n        value: function calculatePiecesToPairs(state, modifiers, marchData, pairs) {\n\n            var numLegionsMarching = _lodash2.default.reduce(marchData, function (sum, data) {\n                return sum + data.numLegions;\n            }, 0);\n\n            return _lodash2.default.map(pairs, function (pair) {\n                var first = {\n                    destination: pair[0].destination,\n                    priority: pair[0].priority,\n                    numLegions: pair[0].destination.getLegions().length,\n                    numAuxilia: pair[0].destination.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length,\n                    leader: pair[0].destination.getLeaderForFaction(_factionIds2.default.ROMANS),\n                    piecesFromRegion: {}\n                };\n\n                var second = {\n                    destination: pair[1].destination,\n                    priority: pair[1].priority,\n                    numLegions: pair[1].destination.getLegions().length,\n                    numAuxilia: pair[1].destination.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length,\n                    leader: pair[1].destination.getLeaderForFaction(_factionIds2.default.ROMANS),\n                    piecesFromRegion: {}\n                };\n\n                _lodash2.default.each(marchData, function (data) {\n                    first.piecesFromRegion[data.march.region.id] = {\n                        regionId: data.march.region.id,\n                        numLegions: 0,\n                        numAuxilia: 0,\n                        harassedAuxilia: 0,\n                        leader: false\n                    };\n                    second.piecesFromRegion[data.march.region.id] = {\n                        regionId: data.march.region.id,\n                        numLegions: 0,\n                        numAuxilia: 0,\n                        harassedAuxilia: 0,\n                        leader: false\n                    };\n                });\n\n                var numLegionsAtTargets = first.numLegions + second.numLegions;\n                var totalLegions = numLegionsMarching + numLegionsAtTargets;\n                var idealFirstLegionGroup = Math.floor(totalLegions / 2);\n                var idealSecondLegionGroup = totalLegions - idealFirstLegionGroup;\n\n                var groupedByChoice = (0, _lodash2.default)(marchData).map(function (data) {\n                    var firstDest = _lodash2.default.find(data.prioritizedDestinations, function (marchDest) {\n                        return marchDest.destination.id === pair[0].destination.id;\n                    });\n                    var secondDest = _lodash2.default.find(data.prioritizedDestinations, function (marchDest) {\n                        return marchDest.destination.id === pair[1].destination.id;\n                    });\n\n                    var bothTooFarToSplit = firstDest && secondDest && firstDest.distance === 3 && secondDest.distance === 3;\n                    var tooManyLossesToSplit = firstDest && secondDest && firstDest.harassmentLosses + secondDest.harassmentLosses > data.numAuxilia;\n\n                    return {\n                        data: data,\n                        firstDest: firstDest,\n                        secondDest: secondDest,\n                        canSplit: !bothTooFarToSplit && !tooManyLossesToSplit\n                    };\n                }).groupBy(function (dataWithDests) {\n                    if (dataWithDests.firstDest && !dataWithDests.secondDest || dataWithDests.secondDest && !dataWithDests.firstDest) {\n                        return 'one';\n                    }\n                    return 'both';\n                }).value();\n\n                // Only one place to go, so go\n                _lodash2.default.each(groupedByChoice.one, function (choiceData) {\n                    var target = choiceData.firstDest ? first : second;\n                    var targetDest = choiceData.firstDest || choiceData.secondDest;\n                    target.numLegions += choiceData.data.numLegions;\n                    var numArrivingAuxilia = choiceData.data.numAuxilia - targetDest.harassmentLosses;\n                    target.numAuxilia += numArrivingAuxilia;\n                    target.leader = choiceData.data.leader;\n                    var regionData = target.piecesFromRegion[choiceData.data.march.region.id];\n                    regionData.numLegions = choiceData.data.numLegions;\n                    regionData.numAuxilia = numArrivingAuxilia;\n                    regionData.harassedAuxilia += targetDest.harassmentLosses;\n                    regionData.leader = choiceData.data.leader;\n                });\n\n                // Partition greedily, legions, bringing auxilia to die if needed\n                _lodash2.default.each((0, _lodash2.default)(groupedByChoice.both).sortBy(function (choiceData) {\n                    return choiceData.data.numLegions;\n                }).reverse().value(), function (choiceData) {\n                    // Legions\n                    var ordered = (0, _lodash2.default)([first, second]).sortBy('numLegions').value();\n                    var target = _lodash2.default.first(ordered);\n                    var otherTarget = _lodash2.default.last(ordered);\n                    var targetDest = first.destination.id === choiceData.firstDest.destination.id ? choiceData.firstDest : choiceData.secondDest;\n                    var otherDest = first.destination.id === choiceData.firstDest.destination.id ? choiceData.secondDest : choiceData.firstDest;\n\n                    if (!choiceData.canSplit) {\n                        target.numLegions += choiceData.data.numLegions;\n                        var numArrivingAuxilia = choiceData.data.numAuxilia - targetDest.harassmentLosses;\n                        target.numAuxilia += numArrivingAuxilia;\n                        target.leader = choiceData.data.leader;\n                        var regionData = target.piecesFromRegion[choiceData.data.march.region.id];\n                        regionData.numLegions += choiceData.data.numLegions;\n                        regionData.numAuxilia += numArrivingAuxilia;\n                        regionData.harassedAuxilia += targetDest.harassmentLosses;\n                        regionData.leader = choiceData.data.leader;\n                        choiceData.placed = true;\n                        return;\n                    }\n\n                    var numToFirst = otherTarget.numLegions === idealSecondLegionGroup ? choiceData.data.numLegions : Math.min(idealFirstLegionGroup - target.numLegions, choiceData.data.numLegions);\n                    var remaining = choiceData.data.numLegions - numToFirst;\n                    target.numLegions += numToFirst;\n                    target.piecesFromRegion[choiceData.data.march.region.id].numLegions = numToFirst;\n                    if (targetDest.harassmentLosses > 0) {\n                        target.piecesFromRegion[choiceData.data.march.region.id].harassedAuxilia = targetDest.harassmentLosses;\n                    }\n\n                    if (remaining) {\n                        otherTarget.numLegions += remaining;\n                        otherTarget.piecesFromRegion[choiceData.data.march.region.id].numLegions = remaining;\n                        if (otherDest.harassmentLosses > 0) {\n                            otherTarget.piecesFromRegion[choiceData.data.march.region.id].harassedAuxilia = otherDest.harassmentLosses;\n                        }\n                    }\n                });\n\n                // Partition greedily Auxilia, and place Leader\n                _lodash2.default.each((0, _lodash2.default)(groupedByChoice.both).sortBy(function (choiceData) {\n                    return choiceData.data.numAuxilia;\n                }).reverse().value(), function (choiceData) {\n                    if (!choiceData.canSplit && choiceData.placed) {\n                        return;\n                    }\n                    // Legions we know exactly how many so we can just do them.\n                    var ordered = (0, _lodash2.default)([first, second]).sortBy('numAuxilia').value();\n                    var target = _lodash2.default.first(ordered);\n                    var targetDest = first.destination.id === choiceData.firstDest.destination.id ? choiceData.firstDest : choiceData.secondDest;\n                    var otherTarget = _lodash2.default.last(ordered);\n\n                    // We've placed legions to the best of our ability so we go ahead and place the leader if he hasn't already gone\n                    if (!first.leader && !second.leader && choiceData.data.leader) {\n                        var leaderTarget = void 0;\n                        if (first.numLegions === second.numLegions) {\n                            leaderTarget = choiceData.firstDest.distance > choiceData.secondDest.distance ? first : second;\n                        } else {\n                            leaderTarget = first.numLegions > second.numLegions ? first : second;\n                        }\n                        leaderTarget.leader = choiceData.data.leader;\n                        leaderTarget.piecesFromRegion[choiceData.data.march.region.id].leader = true;\n                        if (targetDest.harassmentLosses > 0 && leaderTarget.piecesFromRegion[choiceData.data.march.region.id].numAuxilia === 0) {\n                            leaderTarget.piecesFromRegion[choiceData.data.march.region.id].harassedAuxilia = targetDest.harassmentLosses;\n                        }\n                    }\n\n                    var numArrivingAuxilia = choiceData.data.numAuxilia - (targetDest.harassmentLosses + otherTarget.piecesFromRegion[choiceData.data.march.region.id].harassedAuxilia);\n                    target.numAuxilia += numArrivingAuxilia;\n                    target.piecesFromRegion[choiceData.data.march.region.id].numAuxilia += numArrivingAuxilia;\n                });\n\n                // Fix the auxilia as best we can to an even partition\n                var imbalance = Math.abs(first.numAuxilia - second.numAuxilia);\n                if (imbalance > 1) {\n                    var bigger = (0, _lodash2.default)([first, second]).sortBy('numAuxilia').last();\n                    var orderedRegionPieces = (0, _lodash2.default)(bigger.piecesFromRegion).reject({ numAuxilia: 0 }).sortBy('numAuxilia').reverse().value();\n                    var splittable = (0, _lodash2.default)(orderedRegionPieces).filter(function (regionPieces) {\n                        return _lodash2.default.find(groupedByChoice.both, function (choiceData) {\n                            return choiceData.data.march.region.id === regionPieces.regionId && choiceData.canSplit;\n                        });\n                    }).value();\n                    _lodash2.default.each(splittable, function (regionPieces) {\n                        var choiceData = _lodash2.default.find(groupedByChoice.both, function (choiceData) {\n                            return choiceData.data.march.region.id === regionPieces.regionId;\n                        });\n                        var smaller = first.destination.id === bigger.destination.id ? second : first;\n\n                        var otherDest = first.destination.id === bigger.destination.id ? choiceData.secondDest : choiceData.firstDest;\n                        var harassmentLosses = smaller.piecesFromRegion[regionPieces.regionId].harassedAuxilia ? 0 : otherDest.harassmentLosses;\n                        var piecesToMove = Math.floor(Math.min(imbalance, regionPieces.numAuxilia - harassmentLosses) / 2);\n\n                        if (piecesToMove > 0) {\n                            bigger.numAuxilia -= piecesToMove + harassmentLosses;\n                            regionPieces.numAuxilia -= piecesToMove + harassmentLosses;\n                            smaller.numAuxilia += piecesToMove;\n                            smaller.piecesFromRegion[regionPieces.regionId].numAuxilia += piecesToMove;\n                            if (harassmentLosses) {\n                                smaller.piecesFromRegion[regionPieces.regionId].harassedAuxilia += harassmentLosses;\n                            }\n\n                            imbalance = Math.abs(first.numAuxilia - second.numAuxilia);\n                            if (imbalance <= 1) {\n                                return false;\n                            }\n                        }\n                    });\n                }\n                return [first, second];\n            });\n        }\n    }, {\n        key: 'determineBattleLosses',\n        value: function determineBattleLosses(state, modifiers, marchData, populatedPairs) {\n            var _this3 = this;\n\n            _lodash2.default.each(populatedPairs, function (pair) {\n                _this3.determineBattleLossesForTarget(state, modifiers, marchData, pair[0]);\n                _this3.determineBattleLossesForTarget(state, modifiers, marchData, pair[1]);\n            });\n        }\n    }, {\n        key: 'determineBattleLossesForTargets',\n        value: function determineBattleLossesForTargets(state, modifiers, marchData, targets) {\n            var _this4 = this;\n\n            _lodash2.default.each(targets, function (target) {\n                _this4.determineBattleLossesForTarget(state, modifiers, marchData, target);\n            });\n        }\n    }, {\n        key: 'determineBattleLossesForTarget',\n        value: function determineBattleLossesForTarget(state, modifiers, marchData, target) {\n            var defendingPieces = this.getSimulationDefenderPieces(state, target);\n            target.losses = _romanUtils2.default.getWorstLossesForAllEnemyInitiatedBattlesInRegion(state, target.destination, defendingPieces);\n        }\n    }, {\n        key: 'getSimulationDefenderPieces',\n        value: function getSimulationDefenderPieces(state, destData) {\n            var _this5 = this;\n\n            return (0, _lodash2.default)(destData.piecesFromRegion).map(function (regionData) {\n                var region = state.regionsById[regionData.regionId];\n                return _this5.getPiecesToMoveForRegion(region, regionData);\n            }).flatten().concat(state.regionsById[destData.destination.id].getPiecesForFaction(_factionIds2.default.ROMANS)).value();\n        }\n    }, {\n        key: 'getPiecesToMoveForRegion',\n        value: function getPiecesToMoveForRegion(region, regionData) {\n            var auxilia = _lodash2.default.take(region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS), regionData.numAuxilia);\n            var legions = _lodash2.default.take(region.getLegions(), regionData.numLegions);\n            var leader = regionData.leader ? [region.getLeaderForFaction(_factionIds2.default.ROMANS)] : [];\n            return _lodash2.default.concat(auxilia, legions, leader);\n        }\n    }, {\n        key: 'getMarchToTwoMarches',\n        value: function getMarchToTwoMarches(state, modifiers, marchData) {\n            var _this6 = this;\n\n            var pairs = this.getDestinationPairs(state, modifiers, marchData);\n            var populatedPairs = this.calculatePiecesToPairs(state, modifiers, marchData, pairs);\n            this.determineBattleLosses(state, modifiers, marchData, populatedPairs);\n            var finalDestinationPair = (0, _lodash2.default)(populatedPairs).sortBy(function (pair) {\n                return pair[0].losses + pair[1].losses;\n            }).first();\n            if (!finalDestinationPair) {\n                return [];\n            }\n\n            var marches = (0, _lodash2.default)(finalDestinationPair).map(function (destData) {\n                return (0, _lodash2.default)(destData.piecesFromRegion).map(function (regionData) {\n                    var region = state.regionsById[regionData.regionId];\n                    var pieces = _this6.getPiecesToMoveForRegion(region, regionData);\n                    if (pieces.length > 0) {\n                        return {\n                            region: region,\n                            group: {\n                                targetDestination: destData.destination,\n                                pieceData: regionData\n                            }\n                        };\n                    }\n                }).compact().value();\n            }).flatten().groupBy(function (groupData) {\n                return groupData.region.id;\n            }).map(function (regionData, regionId) {\n                return {\n                    region: state.regionsById[regionId],\n                    groups: _lodash2.default.map(regionData, 'group')\n                };\n            }).value();\n\n            _lodash2.default.each(marches, function (march) {\n                var marchResult = _lodash2.default.find(marchData, function (entry) {\n                    return entry.march.region.id === march.region.id;\n                });\n                march.cost = marchResult.march.cost;\n            });\n\n            return marches;\n        }\n    }, {\n        key: 'canGoToDestination',\n        value: function canGoToDestination(destination, marchData) {\n            return _lodash2.default.find(destination.possibleMarches, function (possibleMarch) {\n                return possibleMarch.marchData.march.region.id === marchData.march.region.id;\n            });\n        }\n    }, {\n        key: 'getMarchToOneMarches',\n        value: function getMarchToOneMarches(state, modifiers, marchData) {\n            var _this7 = this;\n\n            var allLegionsAndLeaderInMarchRegions = _lodash2.default.reduce(marchData, function (sum, data) {\n                return sum + (data.numLegions + (data.leader ? 1 : 0));\n            }, 0) === 12 - state.romans.offMapLegions() + (state.romans.availableLeader() ? 0 : 1);\n\n            if (!allLegionsAndLeaderInMarchRegions) {\n                return [];\n            }\n\n            var requiredMarches = _lodash2.default.filter(marchData, function (data) {\n                return data.numLegions > 0 || data.leader;\n            });\n\n            if (modifiers.limited && requiredMarches.length > 1) {\n                return [];\n            }\n\n            var cost = _lodash2.default.reduce(requiredMarches, function (sum, data) {\n                return sum + data.march.cost;\n            }, 0);\n\n            if (!modifiers.free && state.romans.resources() < cost) {\n                return [];\n            }\n\n            var possibleDestinations = (0, _lodash2.default)(requiredMarches).reduce(function (destinations, data) {\n                var marchDestinations = data.prioritizedDestinations;\n                return destinations.length === 0 ? marchDestinations : _lodash2.default.intersectionBy(destinations, marchDestinations, function (destData) {\n                    return destData.destination.id;\n                });\n            }, []);\n\n            if (possibleDestinations.length === 0) {\n                return [];\n            }\n\n            var populatedDestinations = this.calculatePiecesToDestinations(state, modifiers, marchData, possibleDestinations);\n            this.determineBattleLossesForTargets(state, modifiers, marchData, populatedDestinations);\n            var actualDestination = (0, _lodash2.default)(populatedDestinations).sortBy('losses').first();\n            if (!actualDestination) {\n                return [];\n            }\n\n            var marches = (0, _lodash2.default)(actualDestination.piecesFromRegion).map(function (regionData) {\n                var region = state.regionsById[regionData.regionId];\n                var pieces = _this7.getPiecesToMoveForRegion(region, regionData);\n                if (pieces.length > 0) {\n                    return {\n                        region: region,\n                        groups: [{\n                            targetDestination: actualDestination.destination,\n                            pieceData: regionData\n                        }]\n                    };\n                }\n            }).compact().value();\n\n            _lodash2.default.each(marches, function (march) {\n                var marchResult = _lodash2.default.find(marchData, function (entry) {\n                    return entry.march.region.id === march.region.id;\n                });\n                march.cost = marchResult.march.cost;\n            });\n\n            return modifiers.free ? marches : _lodash2.default.reduce(marches, function (accumulator, march) {\n                if (accumulator.resourcesRemaining >= march.cost) {\n                    accumulator.resourcesRemaining -= march.cost;\n                    accumulator.marches.push(march);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.romans.resources(), marches: [] }).marches;\n        }\n    }, {\n        key: 'calculatePiecesToDestinations',\n        value: function calculatePiecesToDestinations(state, modifiers, marchData, destinations) {\n\n            return (0, _lodash2.default)(destinations).map(function (destData) {\n                var target = {\n                    destination: destData.destination,\n                    priority: destData.priority,\n                    numLegions: destData.destination.getLegions().length,\n                    numAuxilia: destData.destination.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length,\n                    leader: destData.destination.getLeaderForFaction(_factionIds2.default.ROMANS),\n                    piecesFromRegion: {}\n                };\n\n                _lodash2.default.each(marchData, function (data) {\n                    var targetDestData = _lodash2.default.find(data.prioritizedDestinations, function (marchDest) {\n                        return marchDest.destination.id === target.destination.id;\n                    });\n                    if (!targetDestData) {\n                        return;\n                    }\n                    target.numLegions += data.numLegions;\n                    target.numAuxilia += data.numAuxilia - targetDestData.harassmentLosses;\n                    target.leader = data.leader;\n\n                    target.piecesFromRegion[data.march.region.id] = {\n                        regionId: data.march.region.id,\n                        numLegions: data.numLegions,\n                        numAuxilia: data.numAuxilia - targetDestData.harassmentLosses,\n                        harassedAuxilia: targetDestData.harassmentLosses,\n                        leader: data.leader\n                    };\n                });\n\n                return target;\n            }).value();\n        }\n    }, {\n        key: 'getMarchingPieces',\n        value: function getMarchingPieces(region) {\n            var legions = region.getLegions();\n            var leader = region.getLeaderForFaction(_factionIds2.default.ROMANS);\n            var auxilia = region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS);\n\n            var numAuxiliaToMarch = 0;\n            if (auxilia.length > 0) {\n                var numInitialMarchedPieces = legions.length + (leader ? 1 : 0) + 1;\n                var maxEnemyMarginAfterMarch = region.getMaxEnemyControllingMargin(_factionIds2.default.ROMANS) + numInitialMarchedPieces;\n                if (maxEnemyMarginAfterMarch > 0) {\n                    numAuxiliaToMarch = auxilia.length;\n                } else {\n                    numAuxiliaToMarch = Math.min(Math.abs(maxEnemyMarginAfterMarch - 1), auxilia.length);\n                }\n            }\n\n            return (0, _lodash2.default)(legions).concat([leader], _lodash2.default.take(auxilia, numAuxiliaToMarch)).compact().value();\n        }\n    }, {\n        key: 'prioritizeMarchDestinations',\n        value: function prioritizeMarchDestinations(state, marches, prioritizedFactions, threatRegionIds) {\n            var _this8 = this;\n\n            var marchRegionIds = _lodash2.default.map(marches, function (march) {\n                return march.region.id;\n            });\n\n            return (0, _lodash2.default)(marches).map(function (march) {\n                var marchingPieces = _this8.getMarchingPieces(march.region);\n                var prioritizedDestinations = (0, _lodash2.default)(march.destinations).map(function (destination) {\n\n                    if (_lodash2.default.indexOf(marchRegionIds, destination) >= 0) {\n                        return;\n                    }\n\n                    var pathData = _this8.getBestDestinationPath(state, marchingPieces, march.region, destination);\n                    if (!pathData) {\n                        return;\n                    }\n\n                    var priority = _lodash2.default.reduce(_factionIds2.default, function (priority, factionId) {\n                        if (destination.numAlliesAndCitadelsForFaction(factionId) <= 0) {\n                            return priority;\n                        }\n\n                        var priorityIndex = _this8.getPriorityIndex(prioritizedFactions, factionId);\n                        if (priorityIndex < 0) {\n                            return priority;\n                        }\n\n                        var newPriority = 10 + priorityIndex;\n                        return Math.min(newPriority, priority);\n                    }, 99);\n\n                    if (priority === 99) {\n                        return;\n                    }\n\n                    return {\n                        destination: destination,\n                        path: pathData.path,\n                        distance: pathData.distance,\n                        harassmentLosses: pathData.harassmentLosses,\n                        priority: priority\n                    };\n                }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n\n                return {\n                    march: march,\n                    numLegions: march.region.getLegions().length,\n                    numAuxilia: _lodash2.default.filter(marchingPieces, { type: 'auxilia' }).length,\n                    leader: march.region.getLeaderForFaction(_factionIds2.default.ROMANS),\n                    threat: _lodash2.default.indexOf(threatRegionIds, march.region.id) >= 0,\n                    prioritizedDestinations: prioritizedDestinations\n                };\n            }).value();\n        }\n    }, {\n        key: 'getPriorityIndex',\n        value: function getPriorityIndex(prioritizedFactions, factionId) {\n            return _lodash2.default.findIndex(_lodash2.default.values(prioritizedFactions), function (factions) {\n                return _lodash2.default.find(factions, { id: factionId });\n            });\n        }\n    }, {\n        key: 'getEnemyFactionPriority',\n        value: function getEnemyFactionPriority(state) {\n            var targetGermans = state.factionsById[_factionIds2.default.GERMANIC_TRIBES].numAlliedTribesAndCitadelsPlaced() >= 2;\n            var priorityFactions = (0, _lodash2.default)([_factionIds2.default.ARVERNI, _factionIds2.default.BELGAE, _factionIds2.default.AEDUI]).map(function (id) {\n                return state.factionsById[id];\n            }).map(function (faction) {\n                var victoryMargin = faction.victoryMargin(state);\n                if (victoryMargin < 0) {\n                    return;\n                }\n                var player = state.playersByFaction[faction.id];\n                var priority = 'a' + (99 - victoryMargin) + '-' + (player.isNonPlayer ? 'b' : 'a');\n\n                return {\n                    id: faction.id,\n                    priority: priority\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().value();\n\n            if (targetGermans) {\n                priorityFactions.push({ id: _factionIds2.default.GERMANIC_TRIBES, priority: 'b' });\n            }\n\n            var roll = _lodash2.default.random(1, 6);\n            if (roll < 5) {\n                priorityFactions.push.apply(priorityFactions, (0, _lodash2.default)(state.factions).reject(function (faction) {\n                    return faction.id === _factionIds2.default.ROMANS;\n                }).map(function (faction) {\n                    var priority = 'c' + (99 - faction.numAlliedTribesAndCitadelsPlaced());\n                    return {\n                        id: faction.id,\n                        priority: priority\n                    };\n                }).sortBy('priority').value());\n            } else {\n                priorityFactions.push.apply(priorityFactions, (0, _lodash2.default)(state.factions).reject(function (faction) {\n                    return faction.id === _factionIds2.default.ROMANS;\n                }).map(function (faction) {\n                    var player = state.playersByFaction[faction.id];\n                    var priority = player.isNonPlayer ? 'd' : 'c';\n                    return {\n                        id: faction.id,\n                        priority: priority\n                    };\n                }).sortBy('priority').value());\n            }\n\n            return _lodash2.default.groupBy(_lodash2.default.uniqBy(priorityFactions, 'id'), 'priority');\n        }\n    }, {\n        key: 'wasBritanniaMarch',\n        value: function wasBritanniaMarch(marches) {\n            return _lodash2.default.find(marches, function (march) {\n                return march.region.id === _regionIds2.default.BRITANNIA || march.targetDestination.id === _regionIds2.default.BRITANNIA;\n            });\n        }\n    }, {\n        key: 'payForMarchAndHide',\n        value: function payForMarchAndHide(state, modifiers, march) {\n            var alreadyMarchedById = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n            var romans = state.romans;\n\n            if (!alreadyMarchedById[march.region.id]) {\n                alreadyMarchedById[march.region.id] = true;\n                if (romans.resources() < march.cost && !modifiers.free) {\n                    return false;\n                }\n\n                if (!modifiers.free) {\n                    _removeResources2.default.execute(state, { factionId: _factionIds2.default.ROMANS, count: march.cost });\n                }\n                _hidePieces2.default.execute(state, {\n                    factionId: romans.id,\n                    regionId: march.region.id\n                });\n                return true;\n            }\n        }\n    }, {\n        key: 'getBestDestinationPaths',\n        value: function getBestDestinationPaths(state, marchingPieces, startRegion, destinations) {\n            var _this9 = this;\n\n            return (0, _lodash2.default)(destinations).map(function (destination) {\n                return _this9.getBestDestinationPath(state, marchingPieces, startRegion, destination);\n            }).compact().value();\n        }\n    }, {\n        key: 'getBestDestinationPath',\n        value: function getBestDestinationPath(state, marchingPieces, startRegion, destination) {\n            var _this10 = this;\n\n            var distance = _map2.default.measureDistanceToRegion(state, startRegion.id, destination.id);\n            if (distance < 2) {\n                return {\n                    destination: destination,\n                    path: [startRegion.id, destination.id],\n                    harassmentLosses: 0\n                };\n            }\n\n            var bestPath = (0, _lodash2.default)(_map2.default.findPathsToRegion(state, startRegion.id, destination.id, 3)).reject(function (path) {\n                return _march2.default.isInvalidMarchPath(state, path);\n            }).map(function (path) {\n\n                var harassmentLosses = (0, _lodash2.default)(path).slice(1, path.length - 1).map(function (regionId) {\n                    return state.regionsById[regionId];\n                }).reduce(function (sum, region) {\n                    var regionLosses = _this10.harassmentLosses(state, _factionIds2.default.ARVERNI, region) + _this10.harassmentLosses(state, _factionIds2.default.BELGAE, region) + _this10.harassmentLosses(state, _factionIds2.default.AEDUI, region) + _this10.harassmentLosses(state, _factionIds2.default.GERMANIC_TRIBES, region);\n                    return sum + regionLosses;\n                }, 0);\n\n                if (harassmentLosses > path.length - 2) {\n                    return;\n                }\n\n                var numAuxilia = _lodash2.default.countBy(marchingPieces, 'type').auxilia || 0;\n\n                if (harassmentLosses && numAuxilia < harassmentLosses) {\n                    return;\n                }\n\n                return {\n                    path: path,\n                    distance: path.length - 1,\n                    harassmentLosses: harassmentLosses\n                };\n            }).compact().orderBy(['harassmentLosses', 'distance']).first();\n\n            if (!bestPath) {\n                return;\n            }\n\n            return {\n                destination: destination,\n                path: bestPath.path,\n                distance: bestPath.distance,\n                harassmentLosses: bestPath.harassmentLosses\n            };\n        }\n    }, {\n        key: 'harassmentLosses',\n        value: function harassmentLosses(state, factionId, region) {\n            var losses = 0;\n            var numHiddenEnemies = region.getHiddenPiecesForFaction(factionId).length;\n            if (numHiddenEnemies >= 3) {\n                var player = state.playersByFaction[factionId];\n                if (player.willHarass(_factionIds2.default.ROMANS)) {\n                    losses = Math.floor(numHiddenEnemies / 3);\n                }\n            }\n            return losses;\n        }\n    }]);\n\n    return RomanMarch;\n}();\n\nexports.default = RomanMarch;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuTWFyY2guanM/ODMwYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZWdpb25Hcm91cHMgZnJvbSAnLi4vLi4vY29uZmlnL3JlZ2lvbkdyb3Vwcyc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IE1hcmNoIGZyb20gJy4uLy4uL2NvbW1hbmRzL21hcmNoJztcbmltcG9ydCBNb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvbW92ZVBpZWNlcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBSZW1vdmVSZXNvdXJjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEhpZGVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9oaWRlUGllY2VzJztcbmltcG9ydCBFbmVteUZhY3Rpb25Qcmlvcml0eSBmcm9tICcuL2VuZW15RmFjdGlvblByaW9yaXR5JztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuaW1wb3J0IE1hcCBmcm9tICcuLi8uLi91dGlsL21hcCc7XG5pbXBvcnQgUm9tYW5VdGlscyBmcm9tICdmYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuVXRpbHMnO1xuaW1wb3J0IFJvbWFuQnVpbGQgZnJvbSAnZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hbkJ1aWxkJztcbmltcG9ydCBSb21hblNjb3V0IGZyb20gJ2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5TY291dCc7XG5cbmNsYXNzIFJvbWFuTWFyY2gge1xuXG4gICAgc3RhdGljIG1hcmNoKHN0YXRlLCBtb2RpZmllcnMsIHNraXBDb25kaXRpb24gPSBmYWxzZSkge1xuICAgICAgICBpZiAoc3RhdGUuZnJvc3QoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGVmZmVjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBtYXJjaFJlc3VsdHMgPSBNYXJjaC50ZXN0KHN0YXRlLCB7ZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOU30pO1xuXG4gICAgICAgIGNvbnN0IG1hcmNoZXMgPSB0aGlzLmdldE1hcmNoZXMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hSZXN1bHRzKTtcblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLk1BUkNIKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBSb21hbnMgTWFyY2hpbmcgKioqJyk7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIG1hcmNoZXMsIChtYXJjaCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXlGb3JNYXJjaEFuZEhpZGUoc3RhdGUsIG1vZGlmaWVycywgbWFyY2gpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobWFyY2guZ3JvdXBzKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaChtYXJjaC5ncm91cHMsIChncm91cCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgTW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJlZ2lvbklkOiBtYXJjaC5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RSZWdpb25JZDogZ3JvdXAudGFyZ2V0RGVzdGluYXRpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogdGhpcy5nZXRQaWVjZXNUb01vdmVGb3JSZWdpb24obWFyY2gucmVnaW9uLCBncm91cC5waWVjZURhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXAucGllY2VEYXRhLmhhcmFzc2VkQXV4aWxpYSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXJhc3NlZFBpZWNlcyA9IF8udGFrZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyY2gucmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLnBpZWNlRGF0YS5oYXJhc3NlZEF1eGlsaWEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBtYXJjaC5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogaGFyYXNzZWRQaWVjZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWZmZWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghZWZmZWN0aXZlKSB7XG4gICAgICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnJvbGxiYWNrQ29tbWFuZCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlLnR1cm5IaXN0b3J5LmdldEN1cnJlbnRUdXJuKCkuY29tbWl0Q29tbWFuZCgpO1xuXG4gICAgICAgIGxldCBkaWRTcGVjaWFsID0gZmFsc2U7XG4gICAgICAgIGlmIChtb2RpZmllcnMuY2FuRG9TcGVjaWFsKCkpIHsvLyAmJiAhdGhpcy53YXNCcml0YW5uaWFNYXJjaChtYXJjaGVzKSkge1xuICAgICAgICAgICAgZGlkU3BlY2lhbCA9IFJvbWFuQnVpbGQuYnVpbGQoc3RhdGUsIG1vZGlmaWVycykgfHwgUm9tYW5TY291dC5zY291dChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWRTcGVjaWFsID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldE1hcmNoZXMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hSZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IHRocmVhdFJlZ2lvbklkcyA9IG1vZGlmaWVycy5jb250ZXh0LnRocmVhdFJlZ2lvbnMgfHwgW107XG4gICAgICAgIGNvbnN0IG90aGVyTWFyY2hSZWdpb25JZHMgPSBfKHN0YXRlLnJlZ2lvbnNCeUlkKS5maWx0ZXIoKHJlZ2lvbiwgaWQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRocmVhdFJlZ2lvbiA9IF8uaW5kZXhPZih0aHJlYXRSZWdpb25JZHMsIGlkKSA+PSAwO1xuICAgICAgICAgICAgY29uc3Qgbm9FbmVteUFsbGllc09yQ2l0YWRlbHMgPSAhXy5maW5kKHJlZ2lvbi5waWVjZXMoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWVjZSA9PiAocGllY2UudHlwZSA9PT0gJ2FsbGllZHRyaWJlJyB8fCBwaWVjZS50eXBlID09PSAnY2l0YWRlbCcpICYmIHBpZWNlLmZhY3Rpb25JZCAhPT0gRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICAgICAgY29uc3QgaGFzTW9iaWxlUm9tYW5zID0gdGhpcy5nZXRNYXJjaGluZ1BpZWNlcyhyZWdpb24pO1xuXG4gICAgICAgICAgICByZXR1cm4gIXRocmVhdFJlZ2lvbiAmJiByZWdpb24uaW5QbGF5KCkgJiYgbm9FbmVteUFsbGllc09yQ2l0YWRlbHMgJiYgaGFzTW9iaWxlUm9tYW5zO1xuICAgICAgICB9KS5tYXAoKHJlZ2lvbiwgaWQpID0+IHJlZ2lvbi5pZCkudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBwcmlvcml0aXplZEZhY3Rpb25zID0gdGhpcy5nZXRFbmVteUZhY3Rpb25Qcmlvcml0eShzdGF0ZSk7XG5cbiAgICAgICAgY29uc3QgdGhyZWF0TWFyY2hlcyA9IF8uZmlsdGVyKG1hcmNoUmVzdWx0cywgcmVzdWx0ID0+IF8uaW5kZXhPZih0aHJlYXRSZWdpb25JZHMsIHJlc3VsdC5yZWdpb24uaWQpID49IDApO1xuICAgICAgICBjb25zdCBvdGhlck1hcmNoZXMgPSBfKG1hcmNoUmVzdWx0cykuZmlsdGVyKFxuICAgICAgICAgICAgcmVzdWx0ID0+IF8uaW5kZXhPZihvdGhlck1hcmNoUmVnaW9uSWRzLCByZXN1bHQucmVnaW9uLmlkKSA+PSAwKS5zb3J0QnkoJ2Nvc3QnKS52YWx1ZSgpO1xuICAgICAgICBjb25zdCBhbGxNYXJjaGVzID0gXy5jb25jYXQodGhyZWF0TWFyY2hlcywgb3RoZXJNYXJjaGVzKTtcbiAgICAgICAgY29uc3QgYWZmb3JkYWJsZU1hcmNoZXMgPSB0aGlzLmdldEFmZm9yZGFibGVNYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIGFsbE1hcmNoZXMpO1xuICAgICAgICBjb25zdCBtYXJjaERhdGEgPSB0aGlzLnByaW9yaXRpemVNYXJjaERlc3RpbmF0aW9ucyhzdGF0ZSwgYWZmb3JkYWJsZU1hcmNoZXMsIHByaW9yaXRpemVkRmFjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhdFJlZ2lvbklkcyk7XG5cbiAgICAgICAgaWYgKHN0YXRlLnJvbWFucy5vZmZNYXBMZWdpb25zKCkgPiA1KSB7XG4gICAgICAgICAgICBjb25zdCBtYXJjaFRvT25lTWFyY2hlcyA9IHRoaXMuZ2V0TWFyY2hUb09uZU1hcmNoZXMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhKTtcbiAgICAgICAgICAgIGlmIChtYXJjaFRvT25lTWFyY2hlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXJjaFRvT25lTWFyY2hlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldE1hcmNoVG9Ud29NYXJjaGVzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSk7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0QWZmb3JkYWJsZU1hcmNoZXMoc3RhdGUsIG1vZGlmaWVycywgYWxsTWFyY2hlcykge1xuICAgICAgICByZXR1cm4gbW9kaWZpZXJzLmZyZWUgPyBhbGxNYXJjaGVzIDogXy5yZWR1Y2UoYWxsTWFyY2hlcywgKGFjY3VtdWxhdG9yLCBtYXJjaCkgPT4ge1xuICAgICAgICAgICAgaWYgKGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyA+PSBtYXJjaC5jb3N0KSB7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IucmVzb3VyY2VzUmVtYWluaW5nIC09IG1hcmNoLmNvc3Q7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IubWFyY2hlcy5wdXNoKG1hcmNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvclxuICAgICAgICB9LCB7cmVzb3VyY2VzUmVtYWluaW5nOiBzdGF0ZS5yb21hbnMucmVzb3VyY2VzKCksIG1hcmNoZXM6IFtdfSkubWFyY2hlcztcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0RGVzdGluYXRpb25QYWlycyhzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaERhdGEpIHtcbiAgICAgICAgY29uc3QgYWxsRGVzdGluYXRpb25zID0gXyhtYXJjaERhdGEpLm1hcCgncHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMnKS5mbGF0dGVuKCkudW5pcUJ5KFxuICAgICAgICAgICAgZGVzdGluYXRpb25EYXRhID0+IGRlc3RpbmF0aW9uRGF0YS5kZXN0aW5hdGlvbi5pZCkudmFsdWUoKTtcblxuICAgICAgICAvLyBBc3NpZ24gYml0dmFsdWUgdG8gZWFjaCBkZXN0aW5hdGlvbiwgZXF1YWwgdG8gdGhlIHN1bSBvZiBlYWNoIHZhbGlkIG1hcmNoIHdoZXJlIHRoZSB2YWx1ZSBmb3IgZWFjaCBpcyAoMl5tYXJjaGluZGV4KVxuICAgICAgICBfLmVhY2goYWxsRGVzdGluYXRpb25zLCAoZGVzdGluYXRpb24pID0+IHtcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uLmJpdHZhbHVlID0gXy5yZWR1Y2UobWFyY2hEYXRhLCAoYml0dmFsdWUsIGRhdGEsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKF8uZmluZChkYXRhLnByaW9yaXRpemVkRGVzdGluYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25EYXRhID0+IGRlc3RpbmF0aW9uRGF0YS5kZXN0aW5hdGlvbi5pZCA9PT0gZGVzdGluYXRpb24uZGVzdGluYXRpb24uaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBiaXR2YWx1ZSArPSAyICoqIGluZGV4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYml0dmFsdWVcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBGaW5kIGFsbCBwYWlycyBvZiByZWdpb25zXG4gICAgICAgIGNvbnN0IGFsbFBhaXJzID0gdGhpcy5nZXREZXN0aW5hdGlvbkNvbWJpbmF0aW9ucyhhbGxEZXN0aW5hdGlvbnMpO1xuXG4gICAgICAgIC8vIEtlZXAgYWxsIHRoYXQgPT0gMl5tYXJjaGxlbiAtMVxuICAgICAgICBjb25zdCBhbGxNYXJjaGVkTWFzayA9ICgyICoqIG1hcmNoRGF0YS5sZW5ndGgpIC0gMTtcbiAgICAgICAgY29uc3QgYWxsTWFyY2hlZFBhaXJzID0gXy5maWx0ZXIoYWxsUGFpcnMsIHBhaXIgPT4gKHBhaXJbMF0uYml0dmFsdWUgfCBwYWlyWzFdLmJpdHZhbHVlKSA9PT0gYWxsTWFyY2hlZE1hc2spO1xuXG4gICAgICAgIC8vIEZpbmQgYmVzdCBwcmlvcml0eSBpbiBhbGwgcGFpcnNcbiAgICAgICAgY29uc3QgYmVzdFByaW9yaXR5ID0gXyhhbGxNYXJjaGVkUGFpcnMpLmZsYXR0ZW4oKS5tYXAoJ3ByaW9yaXR5JykudW5pcSgpLnNvcnQoKS5maXJzdCgpO1xuXG4gICAgICAgIC8vIFJlamVjdCBhbnkgdGhhdCBkbyBub3QgaGF2ZSB0aGF0IG1heCBwcmlvcml0eVxuICAgICAgICBjb25zdCBhbGxNYXJjaGVkV2l0aEJlc3RQcmlvcml0eSA9IF8uZmlsdGVyKGFsbE1hcmNoZWRQYWlycyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWlyID0+IHBhaXJbMF0ucHJpb3JpdHkgPT09IGJlc3RQcmlvcml0eSB8fCBwYWlyWzFdLnByaW9yaXR5ID09PSBiZXN0UHJpb3JpdHkpO1xuXG4gICAgICAgIC8vIEdyb3VwIHRoZW0gYnkgcHJpb3JpdHkgYW5kIHRha2UgYmVzdCBncm91cFxuICAgICAgICBjb25zdCBncm91cGVkUGFpcnNCeVByaW9yaXR5ID0gXy5ncm91cEJ5KGFsbE1hcmNoZWRXaXRoQmVzdFByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaXIgPT4gcGFpclswXS5wcmlvcml0eSArIHBhaXJbMV0ucHJpb3JpdHkpO1xuICAgICAgICByZXR1cm4gZ3JvdXBlZFBhaXJzQnlQcmlvcml0eVtfKGdyb3VwZWRQYWlyc0J5UHJpb3JpdHkpLmtleXMoKS5zb3J0KCkuZmlyc3QoKV07XG4gICAgfVxuXG4gICAgc3RhdGljIGdldERlc3RpbmF0aW9uQ29tYmluYXRpb25zKGRlc3RpbmF0aW9ucykge1xuICAgICAgICBpZiAoZGVzdGluYXRpb25zLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbWJpbmF0aW9ucyA9IFtdO1xuICAgICAgICBfLmVhY2goXy5yYW5nZSgwLCBkZXN0aW5hdGlvbnMubGVuZ3RoIC0gMSksIChpbmRleCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaGVhZCA9IF8ubnRoKGRlc3RpbmF0aW9ucywgaW5kZXgpO1xuICAgICAgICAgICAgY29uc3QgdGFpbCA9IF8uZHJvcChkZXN0aW5hdGlvbnMsIGluZGV4ICsgMSk7XG4gICAgICAgICAgICBjb21iaW5hdGlvbnMucHVzaC5hcHBseShjb21iaW5hdGlvbnMsIF8ubWFwKHRhaWwsIGRlc3RpbmF0aW9uID0+IFtoZWFkLCBkZXN0aW5hdGlvbl0pKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb21iaW5hdGlvbnM7XG4gICAgfVxuXG4gICAgc3RhdGljIGNhbGN1bGF0ZVBpZWNlc1RvUGFpcnMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhLCBwYWlycykge1xuXG4gICAgICAgIGNvbnN0IG51bUxlZ2lvbnNNYXJjaGluZyA9IF8ucmVkdWNlKG1hcmNoRGF0YSwgKHN1bSwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIGRhdGEubnVtTGVnaW9ucztcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgcmV0dXJuIF8ubWFwKHBhaXJzLCBwYWlyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0ID0ge1xuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYWlyWzBdLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiBwYWlyWzBdLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIG51bUxlZ2lvbnM6IHBhaXJbMF0uZGVzdGluYXRpb24uZ2V0TGVnaW9ucygpLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBudW1BdXhpbGlhOiBwYWlyWzBdLmRlc3RpbmF0aW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGxlYWRlcjogcGFpclswXS5kZXN0aW5hdGlvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICBwaWVjZXNGcm9tUmVnaW9uOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgc2Vjb25kID0ge1xuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYWlyWzFdLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiBwYWlyWzFdLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIG51bUxlZ2lvbnM6IHBhaXJbMV0uZGVzdGluYXRpb24uZ2V0TGVnaW9ucygpLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBudW1BdXhpbGlhOiBwYWlyWzFdLmRlc3RpbmF0aW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGxlYWRlcjogcGFpclsxXS5kZXN0aW5hdGlvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICBwaWVjZXNGcm9tUmVnaW9uOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgXy5lYWNoKG1hcmNoRGF0YSwgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgZmlyc3QucGllY2VzRnJvbVJlZ2lvbltkYXRhLm1hcmNoLnJlZ2lvbi5pZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBkYXRhLm1hcmNoLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgbnVtTGVnaW9uczogMCxcbiAgICAgICAgICAgICAgICAgICAgbnVtQXV4aWxpYTogMCxcbiAgICAgICAgICAgICAgICAgICAgaGFyYXNzZWRBdXhpbGlhOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWFkZXI6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzZWNvbmQucGllY2VzRnJvbVJlZ2lvbltkYXRhLm1hcmNoLnJlZ2lvbi5pZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBkYXRhLm1hcmNoLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgbnVtTGVnaW9uczogMCxcbiAgICAgICAgICAgICAgICAgICAgbnVtQXV4aWxpYTogMCxcbiAgICAgICAgICAgICAgICAgICAgaGFyYXNzZWRBdXhpbGlhOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWFkZXI6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBudW1MZWdpb25zQXRUYXJnZXRzID0gZmlyc3QubnVtTGVnaW9ucyArIHNlY29uZC5udW1MZWdpb25zO1xuICAgICAgICAgICAgY29uc3QgdG90YWxMZWdpb25zID0gbnVtTGVnaW9uc01hcmNoaW5nICsgbnVtTGVnaW9uc0F0VGFyZ2V0cztcbiAgICAgICAgICAgIGNvbnN0IGlkZWFsRmlyc3RMZWdpb25Hcm91cCA9IE1hdGguZmxvb3IodG90YWxMZWdpb25zIC8gMik7XG4gICAgICAgICAgICBjb25zdCBpZGVhbFNlY29uZExlZ2lvbkdyb3VwID0gdG90YWxMZWdpb25zIC0gaWRlYWxGaXJzdExlZ2lvbkdyb3VwO1xuXG4gICAgICAgICAgICBjb25zdCBncm91cGVkQnlDaG9pY2UgPSBfKG1hcmNoRGF0YSkubWFwKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3REZXN0ID0gXy5maW5kKGRhdGEucHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmNoRGVzdCA9PiBtYXJjaERlc3QuZGVzdGluYXRpb24uaWQgPT09IHBhaXJbMF0uZGVzdGluYXRpb24uaWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZERlc3QgPSBfLmZpbmQoZGF0YS5wcmlvcml0aXplZERlc3RpbmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmNoRGVzdCA9PiBtYXJjaERlc3QuZGVzdGluYXRpb24uaWQgPT09IHBhaXJbMV0uZGVzdGluYXRpb24uaWQpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYm90aFRvb0ZhclRvU3BsaXQgPSBmaXJzdERlc3QgJiYgc2Vjb25kRGVzdCAmJiAoZmlyc3REZXN0LmRpc3RhbmNlID09PSAzICYmIHNlY29uZERlc3QuZGlzdGFuY2UgPT09IDMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvb01hbnlMb3NzZXNUb1NwbGl0ID0gZmlyc3REZXN0ICYmIHNlY29uZERlc3QgJiYgKGZpcnN0RGVzdC5oYXJhc3NtZW50TG9zc2VzICsgc2Vjb25kRGVzdC5oYXJhc3NtZW50TG9zc2VzKSA+IGRhdGEubnVtQXV4aWxpYTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0RGVzdCxcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kRGVzdCxcbiAgICAgICAgICAgICAgICAgICAgY2FuU3BsaXQ6ICFib3RoVG9vRmFyVG9TcGxpdCAmJiAhdG9vTWFueUxvc3Nlc1RvU3BsaXRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5ncm91cEJ5KChkYXRhV2l0aERlc3RzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKChkYXRhV2l0aERlc3RzLmZpcnN0RGVzdCAmJiAhZGF0YVdpdGhEZXN0cy5zZWNvbmREZXN0KSB8fCAoZGF0YVdpdGhEZXN0cy5zZWNvbmREZXN0ICYmICFkYXRhV2l0aERlc3RzLmZpcnN0RGVzdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdvbmUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJ2JvdGgnO1xuICAgICAgICAgICAgfSkudmFsdWUoKTtcblxuICAgICAgICAgICAgLy8gT25seSBvbmUgcGxhY2UgdG8gZ28sIHNvIGdvXG4gICAgICAgICAgICBfLmVhY2goZ3JvdXBlZEJ5Q2hvaWNlLm9uZSwgY2hvaWNlRGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gY2hvaWNlRGF0YS5maXJzdERlc3QgPyBmaXJzdCA6IHNlY29uZDtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXREZXN0ID0gY2hvaWNlRGF0YS5maXJzdERlc3QgfHwgY2hvaWNlRGF0YS5zZWNvbmREZXN0O1xuICAgICAgICAgICAgICAgIHRhcmdldC5udW1MZWdpb25zICs9IGNob2ljZURhdGEuZGF0YS5udW1MZWdpb25zO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bUFycml2aW5nQXV4aWxpYSA9IGNob2ljZURhdGEuZGF0YS5udW1BdXhpbGlhIC0gdGFyZ2V0RGVzdC5oYXJhc3NtZW50TG9zc2VzO1xuICAgICAgICAgICAgICAgIHRhcmdldC5udW1BdXhpbGlhICs9IG51bUFycml2aW5nQXV4aWxpYTtcbiAgICAgICAgICAgICAgICB0YXJnZXQubGVhZGVyID0gY2hvaWNlRGF0YS5kYXRhLmxlYWRlcjtcbiAgICAgICAgICAgICAgICBjb25zdCByZWdpb25EYXRhID0gdGFyZ2V0LnBpZWNlc0Zyb21SZWdpb25bY2hvaWNlRGF0YS5kYXRhLm1hcmNoLnJlZ2lvbi5pZF07XG4gICAgICAgICAgICAgICAgcmVnaW9uRGF0YS5udW1MZWdpb25zID0gY2hvaWNlRGF0YS5kYXRhLm51bUxlZ2lvbnM7XG4gICAgICAgICAgICAgICAgcmVnaW9uRGF0YS5udW1BdXhpbGlhID0gbnVtQXJyaXZpbmdBdXhpbGlhO1xuICAgICAgICAgICAgICAgIHJlZ2lvbkRhdGEuaGFyYXNzZWRBdXhpbGlhICs9IHRhcmdldERlc3QuaGFyYXNzbWVudExvc3NlcztcbiAgICAgICAgICAgICAgICByZWdpb25EYXRhLmxlYWRlciA9IGNob2ljZURhdGEuZGF0YS5sZWFkZXI7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUGFydGl0aW9uIGdyZWVkaWx5LCBsZWdpb25zLCBicmluZ2luZyBhdXhpbGlhIHRvIGRpZSBpZiBuZWVkZWRcbiAgICAgICAgICAgIF8uZWFjaChfKGdyb3VwZWRCeUNob2ljZS5ib3RoKS5zb3J0QnkoY2hvaWNlRGF0YSA9PiBjaG9pY2VEYXRhLmRhdGEubnVtTGVnaW9ucykucmV2ZXJzZSgpLnZhbHVlKCksXG4gICAgICAgICAgICAgICAgICAgY2hvaWNlRGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgIC8vIExlZ2lvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JkZXJlZCA9IF8oW2ZpcnN0LCBzZWNvbmRdKS5zb3J0QnkoJ251bUxlZ2lvbnMnKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBfLmZpcnN0KG9yZGVyZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclRhcmdldCA9IF8ubGFzdChvcmRlcmVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RGVzdCA9IChmaXJzdC5kZXN0aW5hdGlvbi5pZCA9PT0gY2hvaWNlRGF0YS5maXJzdERlc3QuZGVzdGluYXRpb24uaWQpID8gY2hvaWNlRGF0YS5maXJzdERlc3QgOiBjaG9pY2VEYXRhLnNlY29uZERlc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyRGVzdCA9IChmaXJzdC5kZXN0aW5hdGlvbi5pZCA9PT0gY2hvaWNlRGF0YS5maXJzdERlc3QuZGVzdGluYXRpb24uaWQpID8gY2hvaWNlRGF0YS5zZWNvbmREZXN0IDogY2hvaWNlRGF0YS5maXJzdERlc3Q7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaG9pY2VEYXRhLmNhblNwbGl0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQubnVtTGVnaW9ucyArPSBjaG9pY2VEYXRhLmRhdGEubnVtTGVnaW9ucztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bUFycml2aW5nQXV4aWxpYSA9IGNob2ljZURhdGEuZGF0YS5udW1BdXhpbGlhIC0gdGFyZ2V0RGVzdC5oYXJhc3NtZW50TG9zc2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lm51bUF1eGlsaWEgKz0gbnVtQXJyaXZpbmdBdXhpbGlhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmxlYWRlciA9IGNob2ljZURhdGEuZGF0YS5sZWFkZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWdpb25EYXRhID0gdGFyZ2V0LnBpZWNlc0Zyb21SZWdpb25bY2hvaWNlRGF0YS5kYXRhLm1hcmNoLnJlZ2lvbi5pZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25EYXRhLm51bUxlZ2lvbnMgKz0gY2hvaWNlRGF0YS5kYXRhLm51bUxlZ2lvbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25EYXRhLm51bUF1eGlsaWEgKz0gbnVtQXJyaXZpbmdBdXhpbGlhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uRGF0YS5oYXJhc3NlZEF1eGlsaWEgKz0gdGFyZ2V0RGVzdC5oYXJhc3NtZW50TG9zc2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uRGF0YS5sZWFkZXIgPSBjaG9pY2VEYXRhLmRhdGEubGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlRGF0YS5wbGFjZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtVG9GaXJzdCA9IG90aGVyVGFyZ2V0Lm51bUxlZ2lvbnMgPT09IGlkZWFsU2Vjb25kTGVnaW9uR3JvdXAgPyBjaG9pY2VEYXRhLmRhdGEubnVtTGVnaW9ucyA6IE1hdGgubWluKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlYWxGaXJzdExlZ2lvbkdyb3VwIC0gdGFyZ2V0Lm51bUxlZ2lvbnMsIGNob2ljZURhdGEuZGF0YS5udW1MZWdpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nID0gY2hvaWNlRGF0YS5kYXRhLm51bUxlZ2lvbnMgLSBudW1Ub0ZpcnN0O1xuICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQubnVtTGVnaW9ucyArPSBudW1Ub0ZpcnN0O1xuICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQucGllY2VzRnJvbVJlZ2lvbltjaG9pY2VEYXRhLmRhdGEubWFyY2gucmVnaW9uLmlkXS5udW1MZWdpb25zID0gbnVtVG9GaXJzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldERlc3QuaGFyYXNzbWVudExvc3NlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5waWVjZXNGcm9tUmVnaW9uW2Nob2ljZURhdGEuZGF0YS5tYXJjaC5yZWdpb24uaWRdLmhhcmFzc2VkQXV4aWxpYSA9IHRhcmdldERlc3QuaGFyYXNzbWVudExvc3NlcztcbiAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVGFyZ2V0Lm51bUxlZ2lvbnMgKz0gcmVtYWluaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJUYXJnZXQucGllY2VzRnJvbVJlZ2lvbltjaG9pY2VEYXRhLmRhdGEubWFyY2gucmVnaW9uLmlkXS5udW1MZWdpb25zID0gcmVtYWluaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyRGVzdC5oYXJhc3NtZW50TG9zc2VzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVGFyZ2V0LnBpZWNlc0Zyb21SZWdpb25bY2hvaWNlRGF0YS5kYXRhLm1hcmNoLnJlZ2lvbi5pZF0uaGFyYXNzZWRBdXhpbGlhID0gb3RoZXJEZXN0LmhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUGFydGl0aW9uIGdyZWVkaWx5IEF1eGlsaWEsIGFuZCBwbGFjZSBMZWFkZXJcbiAgICAgICAgICAgIF8uZWFjaChfKGdyb3VwZWRCeUNob2ljZS5ib3RoKS5zb3J0QnkoY2hvaWNlRGF0YSA9PiBjaG9pY2VEYXRhLmRhdGEubnVtQXV4aWxpYSkucmV2ZXJzZSgpLnZhbHVlKCksXG4gICAgICAgICAgICAgICAgICAgY2hvaWNlRGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgIGlmICghY2hvaWNlRGF0YS5jYW5TcGxpdCAmJiBjaG9pY2VEYXRhLnBsYWNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgIC8vIExlZ2lvbnMgd2Uga25vdyBleGFjdGx5IGhvdyBtYW55IHNvIHdlIGNhbiBqdXN0IGRvIHRoZW0uXG4gICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyZWQgPSBfKFtmaXJzdCwgc2Vjb25kXSkuc29ydEJ5KCdudW1BdXhpbGlhJykudmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gXy5maXJzdChvcmRlcmVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RGVzdCA9IChmaXJzdC5kZXN0aW5hdGlvbi5pZCA9PT0gY2hvaWNlRGF0YS5maXJzdERlc3QuZGVzdGluYXRpb24uaWQpID8gY2hvaWNlRGF0YS5maXJzdERlc3QgOiBjaG9pY2VEYXRhLnNlY29uZERlc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyVGFyZ2V0ID0gXy5sYXN0KG9yZGVyZWQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgIC8vIFdlJ3ZlIHBsYWNlZCBsZWdpb25zIHRvIHRoZSBiZXN0IG9mIG91ciBhYmlsaXR5IHNvIHdlIGdvIGFoZWFkIGFuZCBwbGFjZSB0aGUgbGVhZGVyIGlmIGhlIGhhc24ndCBhbHJlYWR5IGdvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaXJzdC5sZWFkZXIgJiYgIXNlY29uZC5sZWFkZXIgJiYgY2hvaWNlRGF0YS5kYXRhLmxlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxlYWRlclRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdC5udW1MZWdpb25zID09PSBzZWNvbmQubnVtTGVnaW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYWRlclRhcmdldCA9IGNob2ljZURhdGEuZmlyc3REZXN0LmRpc3RhbmNlID4gY2hvaWNlRGF0YS5zZWNvbmREZXN0LmRpc3RhbmNlID8gZmlyc3QgOiBzZWNvbmQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFkZXJUYXJnZXQgPSBmaXJzdC5udW1MZWdpb25zID4gc2Vjb25kLm51bUxlZ2lvbnMgPyBmaXJzdCA6IHNlY29uZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYWRlclRhcmdldC5sZWFkZXIgPSBjaG9pY2VEYXRhLmRhdGEubGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhZGVyVGFyZ2V0LnBpZWNlc0Zyb21SZWdpb25bY2hvaWNlRGF0YS5kYXRhLm1hcmNoLnJlZ2lvbi5pZF0ubGVhZGVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXREZXN0LmhhcmFzc21lbnRMb3NzZXMgPiAwICYmIGxlYWRlclRhcmdldC5waWVjZXNGcm9tUmVnaW9uW2Nob2ljZURhdGEuZGF0YS5tYXJjaC5yZWdpb24uaWRdLm51bUF1eGlsaWEgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFkZXJUYXJnZXQucGllY2VzRnJvbVJlZ2lvbltjaG9pY2VEYXRhLmRhdGEubWFyY2gucmVnaW9uLmlkXS5oYXJhc3NlZEF1eGlsaWEgPSB0YXJnZXREZXN0LmhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1BcnJpdmluZ0F1eGlsaWEgPSBjaG9pY2VEYXRhLmRhdGEubnVtQXV4aWxpYSAtICh0YXJnZXREZXN0LmhhcmFzc21lbnRMb3NzZXMgKyBvdGhlclRhcmdldC5waWVjZXNGcm9tUmVnaW9uW2Nob2ljZURhdGEuZGF0YS5tYXJjaC5yZWdpb24uaWRdLmhhcmFzc2VkQXV4aWxpYSk7XG4gICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5udW1BdXhpbGlhICs9IG51bUFycml2aW5nQXV4aWxpYTtcbiAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnBpZWNlc0Zyb21SZWdpb25bY2hvaWNlRGF0YS5kYXRhLm1hcmNoLnJlZ2lvbi5pZF0ubnVtQXV4aWxpYSArPSBudW1BcnJpdmluZ0F1eGlsaWE7XG4gICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEZpeCB0aGUgYXV4aWxpYSBhcyBiZXN0IHdlIGNhbiB0byBhbiBldmVuIHBhcnRpdGlvblxuICAgICAgICAgICAgbGV0IGltYmFsYW5jZSA9IE1hdGguYWJzKGZpcnN0Lm51bUF1eGlsaWEgLSBzZWNvbmQubnVtQXV4aWxpYSk7XG4gICAgICAgICAgICBpZiAoaW1iYWxhbmNlID4gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJpZ2dlciA9IF8oW2ZpcnN0LCBzZWNvbmRdKS5zb3J0QnkoJ251bUF1eGlsaWEnKS5sYXN0KCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXJlZFJlZ2lvblBpZWNlcyA9IF8oYmlnZ2VyLnBpZWNlc0Zyb21SZWdpb24pLnJlamVjdCh7bnVtQXV4aWxpYTogMH0pLnNvcnRCeShcbiAgICAgICAgICAgICAgICAgICAgJ251bUF1eGlsaWEnKS5yZXZlcnNlKCkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdHRhYmxlID0gXyhvcmRlcmVkUmVnaW9uUGllY2VzKS5maWx0ZXIocmVnaW9uUGllY2VzID0+IF8uZmluZChncm91cGVkQnlDaG9pY2UuYm90aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2VEYXRhID0+IGNob2ljZURhdGEuZGF0YS5tYXJjaC5yZWdpb24uaWQgPT09IHJlZ2lvblBpZWNlcy5yZWdpb25JZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlRGF0YS5jYW5TcGxpdCkpLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHNwbGl0dGFibGUsIChyZWdpb25QaWVjZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hvaWNlRGF0YSA9IF8uZmluZChncm91cGVkQnlDaG9pY2UuYm90aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2VEYXRhID0+IGNob2ljZURhdGEuZGF0YS5tYXJjaC5yZWdpb24uaWQgPT09IHJlZ2lvblBpZWNlcy5yZWdpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNtYWxsZXIgPSAoZmlyc3QuZGVzdGluYXRpb24uaWQgPT09IGJpZ2dlci5kZXN0aW5hdGlvbi5pZCkgPyBzZWNvbmQgOiBmaXJzdDtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckRlc3QgPSAoZmlyc3QuZGVzdGluYXRpb24uaWQgPT09IGJpZ2dlci5kZXN0aW5hdGlvbi5pZCkgPyBjaG9pY2VEYXRhLnNlY29uZERlc3QgOiBjaG9pY2VEYXRhLmZpcnN0RGVzdDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFyYXNzbWVudExvc3NlcyA9IChzbWFsbGVyLnBpZWNlc0Zyb21SZWdpb25bcmVnaW9uUGllY2VzLnJlZ2lvbklkXS5oYXJhc3NlZEF1eGlsaWEgPyAwIDogb3RoZXJEZXN0LmhhcmFzc21lbnRMb3NzZXMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNUb01vdmUgPSBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oaW1iYWxhbmNlLCByZWdpb25QaWVjZXMubnVtQXV4aWxpYSAtIGhhcmFzc21lbnRMb3NzZXMpIC8gMik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpZWNlc1RvTW92ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpZ2dlci5udW1BdXhpbGlhIC09IChwaWVjZXNUb01vdmUgKyBoYXJhc3NtZW50TG9zc2VzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvblBpZWNlcy5udW1BdXhpbGlhIC09IHBpZWNlc1RvTW92ZSArIGhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbWFsbGVyLm51bUF1eGlsaWEgKz0gcGllY2VzVG9Nb3ZlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc21hbGxlci5waWVjZXNGcm9tUmVnaW9uW3JlZ2lvblBpZWNlcy5yZWdpb25JZF0ubnVtQXV4aWxpYSArPSBwaWVjZXNUb01vdmU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFyYXNzbWVudExvc3Nlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtYWxsZXIucGllY2VzRnJvbVJlZ2lvbltyZWdpb25QaWVjZXMucmVnaW9uSWRdLmhhcmFzc2VkQXV4aWxpYSArPSBoYXJhc3NtZW50TG9zc2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWJhbGFuY2UgPSBNYXRoLmFicyhmaXJzdC5udW1BdXhpbGlhIC0gc2Vjb25kLm51bUF1eGlsaWEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGltYmFsYW5jZSA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW2ZpcnN0LCBzZWNvbmRdO1xuXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgc3RhdGljIGRldGVybWluZUJhdHRsZUxvc3NlcyhzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaERhdGEsIHBvcHVsYXRlZFBhaXJzKSB7XG4gICAgICAgIF8uZWFjaChwb3B1bGF0ZWRQYWlycywgKHBhaXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGV0ZXJtaW5lQmF0dGxlTG9zc2VzRm9yVGFyZ2V0KHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSwgcGFpclswXSk7XG4gICAgICAgICAgICB0aGlzLmRldGVybWluZUJhdHRsZUxvc3Nlc0ZvclRhcmdldChzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaERhdGEsIHBhaXJbMV0pO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIHN0YXRpYyBkZXRlcm1pbmVCYXR0bGVMb3NzZXNGb3JUYXJnZXRzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSwgdGFyZ2V0cykge1xuICAgICAgICBfLmVhY2godGFyZ2V0cywgKHRhcmdldCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kZXRlcm1pbmVCYXR0bGVMb3NzZXNGb3JUYXJnZXQoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhLCB0YXJnZXQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZGV0ZXJtaW5lQmF0dGxlTG9zc2VzRm9yVGFyZ2V0KHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSwgdGFyZ2V0KSB7XG4gICAgICAgIGNvbnN0IGRlZmVuZGluZ1BpZWNlcyA9IHRoaXMuZ2V0U2ltdWxhdGlvbkRlZmVuZGVyUGllY2VzKHN0YXRlLCB0YXJnZXQpO1xuICAgICAgICB0YXJnZXQubG9zc2VzID0gUm9tYW5VdGlscy5nZXRXb3JzdExvc3Nlc0ZvckFsbEVuZW15SW5pdGlhdGVkQmF0dGxlc0luUmVnaW9uKHN0YXRlLCB0YXJnZXQuZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZW5kaW5nUGllY2VzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0U2ltdWxhdGlvbkRlZmVuZGVyUGllY2VzKHN0YXRlLCBkZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gXyhkZXN0RGF0YS5waWVjZXNGcm9tUmVnaW9uKS5tYXAoKHJlZ2lvbkRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3JlZ2lvbkRhdGEucmVnaW9uSWRdO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGllY2VzVG9Nb3ZlRm9yUmVnaW9uKHJlZ2lvbiwgcmVnaW9uRGF0YSk7XG4gICAgICAgIH0pLmZsYXR0ZW4oKS5jb25jYXQoc3RhdGUucmVnaW9uc0J5SWRbZGVzdERhdGEuZGVzdGluYXRpb24uaWRdLmdldFBpZWNlc0ZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQaWVjZXNUb01vdmVGb3JSZWdpb24ocmVnaW9uLCByZWdpb25EYXRhKSB7XG4gICAgICAgIGNvbnN0IGF1eGlsaWEgPSBfLnRha2UocmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyksIHJlZ2lvbkRhdGEubnVtQXV4aWxpYSk7XG4gICAgICAgIGNvbnN0IGxlZ2lvbnMgPSBfLnRha2UocmVnaW9uLmdldExlZ2lvbnMoKSwgcmVnaW9uRGF0YS5udW1MZWdpb25zKTtcbiAgICAgICAgY29uc3QgbGVhZGVyID0gcmVnaW9uRGF0YS5sZWFkZXIgPyBbcmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpXSA6IFtdO1xuICAgICAgICByZXR1cm4gXy5jb25jYXQoYXV4aWxpYSwgbGVnaW9ucywgbGVhZGVyKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0TWFyY2hUb1R3b01hcmNoZXMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhKSB7XG4gICAgICAgIGNvbnN0IHBhaXJzID0gdGhpcy5nZXREZXN0aW5hdGlvblBhaXJzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSk7XG4gICAgICAgIGNvbnN0IHBvcHVsYXRlZFBhaXJzID0gdGhpcy5jYWxjdWxhdGVQaWVjZXNUb1BhaXJzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSwgcGFpcnMpO1xuICAgICAgICB0aGlzLmRldGVybWluZUJhdHRsZUxvc3NlcyhzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaERhdGEsIHBvcHVsYXRlZFBhaXJzKTtcbiAgICAgICAgY29uc3QgZmluYWxEZXN0aW5hdGlvblBhaXIgPSBfKHBvcHVsYXRlZFBhaXJzKS5zb3J0QnkoKHBhaXIpID0+IHBhaXJbMF0ubG9zc2VzICsgcGFpclsxXS5sb3NzZXMpLmZpcnN0KCk7XG4gICAgICAgIGlmICghZmluYWxEZXN0aW5hdGlvblBhaXIpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1hcmNoZXMgPSBfKGZpbmFsRGVzdGluYXRpb25QYWlyKS5tYXAoZGVzdERhdGEgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF8oZGVzdERhdGEucGllY2VzRnJvbVJlZ2lvbikubWFwKChyZWdpb25EYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVnaW9uID0gc3RhdGUucmVnaW9uc0J5SWRbcmVnaW9uRGF0YS5yZWdpb25JZF07XG4gICAgICAgICAgICAgICAgY29uc3QgcGllY2VzID0gdGhpcy5nZXRQaWVjZXNUb01vdmVGb3JSZWdpb24ocmVnaW9uLCByZWdpb25EYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAocGllY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREZXN0aW5hdGlvbjogZGVzdERhdGEuZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VEYXRhOiByZWdpb25EYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgICAgICB9KS5mbGF0dGVuKCkuZ3JvdXBCeShncm91cERhdGEgPT4gZ3JvdXBEYXRhLnJlZ2lvbi5pZCkubWFwKChyZWdpb25EYXRhLCByZWdpb25JZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWdpb246IHN0YXRlLnJlZ2lvbnNCeUlkW3JlZ2lvbklkXSxcbiAgICAgICAgICAgICAgICBncm91cHM6IF8ubWFwKHJlZ2lvbkRhdGEsICdncm91cCcpLFxuICAgICAgICAgICAgfVxuICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIF8uZWFjaChtYXJjaGVzLCAobWFyY2gpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmNoUmVzdWx0ID0gXy5maW5kKG1hcmNoRGF0YSwgZW50cnkgPT4gZW50cnkubWFyY2gucmVnaW9uLmlkID09PSBtYXJjaC5yZWdpb24uaWQpO1xuICAgICAgICAgICAgbWFyY2guY29zdCA9IG1hcmNoUmVzdWx0Lm1hcmNoLmNvc3Q7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBtYXJjaGVzO1xuXG4gICAgfVxuXG5cbiAgICBzdGF0aWMgY2FuR29Ub0Rlc3RpbmF0aW9uKGRlc3RpbmF0aW9uLCBtYXJjaERhdGEpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChkZXN0aW5hdGlvbi5wb3NzaWJsZU1hcmNoZXMsXG4gICAgICAgICAgICAgICAgICAgICAgcG9zc2libGVNYXJjaCA9PiBwb3NzaWJsZU1hcmNoLm1hcmNoRGF0YS5tYXJjaC5yZWdpb24uaWQgPT09IG1hcmNoRGF0YS5tYXJjaC5yZWdpb24uaWQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRNYXJjaFRvT25lTWFyY2hlcyhzdGF0ZSwgbW9kaWZpZXJzLCBtYXJjaERhdGEpIHtcbiAgICAgICAgY29uc3QgYWxsTGVnaW9uc0FuZExlYWRlckluTWFyY2hSZWdpb25zID0gXy5yZWR1Y2UobWFyY2hEYXRhLCAoc3VtLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIChkYXRhLm51bUxlZ2lvbnMgKyAoZGF0YS5sZWFkZXIgPyAxIDogMCkpO1xuICAgICAgICAgICAgfSwgMCkgPT09ICgxMiAtIHN0YXRlLnJvbWFucy5vZmZNYXBMZWdpb25zKCkpICsgKHN0YXRlLnJvbWFucy5hdmFpbGFibGVMZWFkZXIoKSA/IDAgOiAxKTtcblxuICAgICAgICBpZiAoIWFsbExlZ2lvbnNBbmRMZWFkZXJJbk1hcmNoUmVnaW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVxdWlyZWRNYXJjaGVzID0gXy5maWx0ZXIobWFyY2hEYXRhLCBkYXRhID0+IGRhdGEubnVtTGVnaW9ucyA+IDAgfHwgZGF0YS5sZWFkZXIpO1xuXG4gICAgICAgIGlmIChtb2RpZmllcnMubGltaXRlZCAmJiByZXF1aXJlZE1hcmNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29zdCA9IF8ucmVkdWNlKHJlcXVpcmVkTWFyY2hlcywgKHN1bSwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHN1bSArIGRhdGEubWFyY2guY29zdDtcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYgKCFtb2RpZmllcnMuZnJlZSAmJiBzdGF0ZS5yb21hbnMucmVzb3VyY2VzKCkgPCBjb3N0KSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3NzaWJsZURlc3RpbmF0aW9ucyA9IF8ocmVxdWlyZWRNYXJjaGVzKS5yZWR1Y2UoKGRlc3RpbmF0aW9ucywgZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFyY2hEZXN0aW5hdGlvbnMgPSBkYXRhLnByaW9yaXRpemVkRGVzdGluYXRpb25zO1xuICAgICAgICAgICAgcmV0dXJuIGRlc3RpbmF0aW9ucy5sZW5ndGggPT09IDAgPyBtYXJjaERlc3RpbmF0aW9ucyA6IF8uaW50ZXJzZWN0aW9uQnkoZGVzdGluYXRpb25zLCBtYXJjaERlc3RpbmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3REYXRhID0+IGRlc3REYXRhLmRlc3RpbmF0aW9uLmlkKTtcbiAgICAgICAgfSwgW10pO1xuXG4gICAgICAgIGlmIChwb3NzaWJsZURlc3RpbmF0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvcHVsYXRlZERlc3RpbmF0aW9ucyA9IHRoaXMuY2FsY3VsYXRlUGllY2VzVG9EZXN0aW5hdGlvbnMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlRGVzdGluYXRpb25zKTtcbiAgICAgICAgdGhpcy5kZXRlcm1pbmVCYXR0bGVMb3NzZXNGb3JUYXJnZXRzKHN0YXRlLCBtb2RpZmllcnMsIG1hcmNoRGF0YSwgcG9wdWxhdGVkRGVzdGluYXRpb25zKTtcbiAgICAgICAgY29uc3QgYWN0dWFsRGVzdGluYXRpb24gPSBfKHBvcHVsYXRlZERlc3RpbmF0aW9ucykuc29ydEJ5KCdsb3NzZXMnKS5maXJzdCgpO1xuICAgICAgICBpZiAoIWFjdHVhbERlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXJjaGVzID0gXyhhY3R1YWxEZXN0aW5hdGlvbi5waWVjZXNGcm9tUmVnaW9uKS5tYXAoKHJlZ2lvbkRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lvbiA9IHN0YXRlLnJlZ2lvbnNCeUlkW3JlZ2lvbkRhdGEucmVnaW9uSWRdO1xuICAgICAgICAgICAgY29uc3QgcGllY2VzID0gdGhpcy5nZXRQaWVjZXNUb01vdmVGb3JSZWdpb24ocmVnaW9uLCByZWdpb25EYXRhKTtcbiAgICAgICAgICAgIGlmIChwaWVjZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICBncm91cHM6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREZXN0aW5hdGlvbjogYWN0dWFsRGVzdGluYXRpb24uZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZURhdGE6IHJlZ2lvbkRhdGEsXG4gICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG5cbiAgICAgICAgXy5lYWNoKG1hcmNoZXMsIChtYXJjaCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFyY2hSZXN1bHQgPSBfLmZpbmQobWFyY2hEYXRhLCBlbnRyeSA9PiBlbnRyeS5tYXJjaC5yZWdpb24uaWQgPT09IG1hcmNoLnJlZ2lvbi5pZCk7XG4gICAgICAgICAgICBtYXJjaC5jb3N0ID0gbWFyY2hSZXN1bHQubWFyY2guY29zdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG1vZGlmaWVycy5mcmVlID8gbWFyY2hlcyA6IF8ucmVkdWNlKG1hcmNoZXMsIChhY2N1bXVsYXRvciwgbWFyY2gpID0+IHtcbiAgICAgICAgICAgIGlmIChhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgPj0gbWFyY2guY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSBtYXJjaC5jb3N0O1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLm1hcmNoZXMucHVzaChtYXJjaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3JcbiAgICAgICAgfSwge3Jlc291cmNlc1JlbWFpbmluZzogc3RhdGUucm9tYW5zLnJlc291cmNlcygpLCBtYXJjaGVzOiBbXX0pLm1hcmNoZXM7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgY2FsY3VsYXRlUGllY2VzVG9EZXN0aW5hdGlvbnMoc3RhdGUsIG1vZGlmaWVycywgbWFyY2hEYXRhLCBkZXN0aW5hdGlvbnMpIHtcblxuICAgICAgICByZXR1cm4gXyhkZXN0aW5hdGlvbnMpLm1hcCgoZGVzdERhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHtcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdERhdGEuZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IGRlc3REYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIG51bUxlZ2lvbnM6IGRlc3REYXRhLmRlc3RpbmF0aW9uLmdldExlZ2lvbnMoKS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgbnVtQXV4aWxpYTogZGVzdERhdGEuZGVzdGluYXRpb24uZ2V0V2FyYmFuZHNPckF1eGlsaWFGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgbGVhZGVyOiBkZXN0RGF0YS5kZXN0aW5hdGlvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICBwaWVjZXNGcm9tUmVnaW9uOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgXy5lYWNoKG1hcmNoRGF0YSwgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RGVzdERhdGEgPSBfLmZpbmQoZGF0YS5wcmlvcml0aXplZERlc3RpbmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJjaERlc3QgPT4gbWFyY2hEZXN0LmRlc3RpbmF0aW9uLmlkID09PSB0YXJnZXQuZGVzdGluYXRpb24uaWQpO1xuICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0RGVzdERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXJnZXQubnVtTGVnaW9ucyArPSBkYXRhLm51bUxlZ2lvbnM7XG4gICAgICAgICAgICAgICAgdGFyZ2V0Lm51bUF1eGlsaWEgKz0gZGF0YS5udW1BdXhpbGlhIC0gdGFyZ2V0RGVzdERhdGEuaGFyYXNzbWVudExvc3NlcztcbiAgICAgICAgICAgICAgICB0YXJnZXQubGVhZGVyID0gZGF0YS5sZWFkZXI7XG5cbiAgICAgICAgICAgICAgICB0YXJnZXQucGllY2VzRnJvbVJlZ2lvbltkYXRhLm1hcmNoLnJlZ2lvbi5pZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBkYXRhLm1hcmNoLnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgbnVtTGVnaW9uczogZGF0YS5udW1MZWdpb25zLFxuICAgICAgICAgICAgICAgICAgICBudW1BdXhpbGlhOiBkYXRhLm51bUF1eGlsaWEgLSB0YXJnZXREZXN0RGF0YS5oYXJhc3NtZW50TG9zc2VzLFxuICAgICAgICAgICAgICAgICAgICBoYXJhc3NlZEF1eGlsaWE6IHRhcmdldERlc3REYXRhLmhhcmFzc21lbnRMb3NzZXMsXG4gICAgICAgICAgICAgICAgICAgIGxlYWRlcjogZGF0YS5sZWFkZXJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgICAgIH0pLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldE1hcmNoaW5nUGllY2VzKHJlZ2lvbikge1xuICAgICAgICBjb25zdCBsZWdpb25zID0gcmVnaW9uLmdldExlZ2lvbnMoKTtcbiAgICAgICAgY29uc3QgbGVhZGVyID0gcmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICBjb25zdCBhdXhpbGlhID0gcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyk7XG5cbiAgICAgICAgbGV0IG51bUF1eGlsaWFUb01hcmNoID0gMDtcbiAgICAgICAgaWYgKGF1eGlsaWEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgbnVtSW5pdGlhbE1hcmNoZWRQaWVjZXMgPSBsZWdpb25zLmxlbmd0aCArIChsZWFkZXIgPyAxIDogMCkgKyAxO1xuICAgICAgICAgICAgY29uc3QgbWF4RW5lbXlNYXJnaW5BZnRlck1hcmNoID0gcmVnaW9uLmdldE1heEVuZW15Q29udHJvbGxpbmdNYXJnaW4oXG4gICAgICAgICAgICAgICAgICAgIEZhY3Rpb25JRHMuUk9NQU5TKSArIG51bUluaXRpYWxNYXJjaGVkUGllY2VzO1xuICAgICAgICAgICAgaWYgKG1heEVuZW15TWFyZ2luQWZ0ZXJNYXJjaCA+IDApIHtcbiAgICAgICAgICAgICAgICBudW1BdXhpbGlhVG9NYXJjaCA9IGF1eGlsaWEubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbnVtQXV4aWxpYVRvTWFyY2ggPSBNYXRoLm1pbihNYXRoLmFicyhtYXhFbmVteU1hcmdpbkFmdGVyTWFyY2ggLSAxKSwgYXV4aWxpYS5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF8obGVnaW9ucykuY29uY2F0KFtsZWFkZXJdLCBfLnRha2UoYXV4aWxpYSwgbnVtQXV4aWxpYVRvTWFyY2gpKS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgcHJpb3JpdGl6ZU1hcmNoRGVzdGluYXRpb25zKHN0YXRlLCBtYXJjaGVzLCBwcmlvcml0aXplZEZhY3Rpb25zLCB0aHJlYXRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgbWFyY2hSZWdpb25JZHMgPSBfLm1hcChtYXJjaGVzLCBtYXJjaCA9PiBtYXJjaC5yZWdpb24uaWQpO1xuXG4gICAgICAgIHJldHVybiBfKG1hcmNoZXMpLm1hcCgobWFyY2gpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmNoaW5nUGllY2VzID0gdGhpcy5nZXRNYXJjaGluZ1BpZWNlcyhtYXJjaC5yZWdpb24pO1xuICAgICAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWREZXN0aW5hdGlvbnMgPSBfKG1hcmNoLmRlc3RpbmF0aW9ucykubWFwKGRlc3RpbmF0aW9uID0+IHtcblxuICAgICAgICAgICAgICAgIGlmIChfLmluZGV4T2YobWFyY2hSZWdpb25JZHMsIGRlc3RpbmF0aW9uKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoRGF0YSA9IHRoaXMuZ2V0QmVzdERlc3RpbmF0aW9uUGF0aChzdGF0ZSwgbWFyY2hpbmdQaWVjZXMsIG1hcmNoLnJlZ2lvbiwgZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgICAgIGlmICghcGF0aERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5ID0gXy5yZWR1Y2UoRmFjdGlvbklEcywgKHByaW9yaXR5LCBmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3RpbmF0aW9uLm51bUFsbGllc0FuZENpdGFkZWxzRm9yRmFjdGlvbihmYWN0aW9uSWQpIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmlvcml0eTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5SW5kZXggPSB0aGlzLmdldFByaW9yaXR5SW5kZXgocHJpb3JpdGl6ZWRGYWN0aW9ucywgZmFjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByaW9yaXR5SW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdQcmlvcml0eSA9IDEwICsgcHJpb3JpdHlJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKG5ld1ByaW9yaXR5LCBwcmlvcml0eSk7XG5cbiAgICAgICAgICAgICAgICB9LCA5OSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocHJpb3JpdHkgPT09IDk5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aERhdGEucGF0aCxcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IHBhdGhEYXRhLmRpc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICBoYXJhc3NtZW50TG9zc2VzOiBwYXRoRGF0YS5oYXJhc3NtZW50TG9zc2VzLFxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5zb3J0QnkoJ3ByaW9yaXR5JykuZ3JvdXBCeSgncHJpb3JpdHknKS5tYXAoXy5zaHVmZmxlKS5mbGF0dGVuKCkudmFsdWUoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtYXJjaCxcbiAgICAgICAgICAgICAgICBudW1MZWdpb25zOiBtYXJjaC5yZWdpb24uZ2V0TGVnaW9ucygpLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBudW1BdXhpbGlhOiBfLmZpbHRlcihtYXJjaGluZ1BpZWNlcywge3R5cGU6ICdhdXhpbGlhJ30pLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBsZWFkZXI6IG1hcmNoLnJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKSxcbiAgICAgICAgICAgICAgICB0aHJlYXQ6IF8uaW5kZXhPZih0aHJlYXRSZWdpb25JZHMsIG1hcmNoLnJlZ2lvbi5pZCkgPj0gMCxcbiAgICAgICAgICAgICAgICBwcmlvcml0aXplZERlc3RpbmF0aW9uc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS52YWx1ZSgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQcmlvcml0eUluZGV4KHByaW9yaXRpemVkRmFjdGlvbnMsIGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXy5maW5kSW5kZXgoXy52YWx1ZXMocHJpb3JpdGl6ZWRGYWN0aW9ucyksIChmYWN0aW9ucykgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF8uZmluZChmYWN0aW9ucywge2lkOiBmYWN0aW9uSWR9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEVuZW15RmFjdGlvblByaW9yaXR5KHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldEdlcm1hbnMgPSBzdGF0ZS5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdLm51bUFsbGllZFRyaWJlc0FuZENpdGFkZWxzUGxhY2VkKCkgPj0gMjtcbiAgICAgICAgbGV0IHByaW9yaXR5RmFjdGlvbnMgPSBfKFtGYWN0aW9uSURzLkFSVkVSTkksIEZhY3Rpb25JRHMuQkVMR0FFLCBGYWN0aW9uSURzLkFFRFVJXSkubWFwKFxuICAgICAgICAgICAgaWQgPT4gc3RhdGUuZmFjdGlvbnNCeUlkW2lkXSkubWFwKChmYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2aWN0b3J5TWFyZ2luID0gZmFjdGlvbi52aWN0b3J5TWFyZ2luKHN0YXRlKTtcbiAgICAgICAgICAgIGlmICh2aWN0b3J5TWFyZ2luIDwgMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bZmFjdGlvbi5pZF07XG4gICAgICAgICAgICBjb25zdCBwcmlvcml0eSA9ICdhJyArICg5OSAtIHZpY3RvcnlNYXJnaW4pICsgJy0nICsgKHBsYXllci5pc05vblBsYXllciA/ICdiJyA6ICdhJyk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IGZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHlcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLnZhbHVlKCk7XG5cbiAgICAgICAgaWYgKHRhcmdldEdlcm1hbnMpIHtcbiAgICAgICAgICAgIHByaW9yaXR5RmFjdGlvbnMucHVzaCh7aWQ6IEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLCBwcmlvcml0eTogJ2InfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByb2xsID0gXy5yYW5kb20oMSwgNik7XG4gICAgICAgIGlmIChyb2xsIDwgNSkge1xuICAgICAgICAgICAgcHJpb3JpdHlGYWN0aW9ucy5wdXNoLmFwcGx5KHByaW9yaXR5RmFjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyhzdGF0ZS5mYWN0aW9ucykucmVqZWN0KGZhY3Rpb24gPT4gZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaW9yaXR5ID0gJ2MnICsgKDk5IC0gZmFjdGlvbi5udW1BbGxpZWRUcmliZXNBbmRDaXRhZGVsc1BsYWNlZCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZhY3Rpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNvcnRCeSgncHJpb3JpdHknKS52YWx1ZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHByaW9yaXR5RmFjdGlvbnMucHVzaC5hcHBseShwcmlvcml0eUZhY3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8oc3RhdGUuZmFjdGlvbnMpLnJlamVjdChmYWN0aW9uID0+IGZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb24uaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdHkgPSBwbGF5ZXIuaXNOb25QbGF5ZXIgPyAnZCcgOiAnYyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zb3J0QnkoJ3ByaW9yaXR5JykudmFsdWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gXy5ncm91cEJ5KF8udW5pcUJ5KHByaW9yaXR5RmFjdGlvbnMsICdpZCcpLCAncHJpb3JpdHknKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgd2FzQnJpdGFubmlhTWFyY2gobWFyY2hlcykge1xuICAgICAgICByZXR1cm4gXy5maW5kKG1hcmNoZXMsXG4gICAgICAgICAgICAgICAgICAgICAgbWFyY2ggPT4gKG1hcmNoLnJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLkJSSVRBTk5JQSB8fCBtYXJjaC50YXJnZXREZXN0aW5hdGlvbi5pZCA9PT0gUmVnaW9uSURzLkJSSVRBTk5JQSkpO1xuICAgIH1cblxuICAgIHN0YXRpYyBwYXlGb3JNYXJjaEFuZEhpZGUoc3RhdGUsIG1vZGlmaWVycywgbWFyY2gsIGFscmVhZHlNYXJjaGVkQnlJZCA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHJvbWFucyA9IHN0YXRlLnJvbWFucztcblxuICAgICAgICBpZiAoIWFscmVhZHlNYXJjaGVkQnlJZFttYXJjaC5yZWdpb24uaWRdKSB7XG4gICAgICAgICAgICBhbHJlYWR5TWFyY2hlZEJ5SWRbbWFyY2gucmVnaW9uLmlkXSA9IHRydWU7XG4gICAgICAgICAgICBpZiAocm9tYW5zLnJlc291cmNlcygpIDwgbWFyY2guY29zdCAmJiAhbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghbW9kaWZpZXJzLmZyZWUpIHtcbiAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsIGNvdW50OiBtYXJjaC5jb3N0fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBIaWRlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiByb21hbnMuaWQsXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBtYXJjaC5yZWdpb24uaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEJlc3REZXN0aW5hdGlvblBhdGhzKHN0YXRlLCBtYXJjaGluZ1BpZWNlcywgc3RhcnRSZWdpb24sIGRlc3RpbmF0aW9ucykge1xuICAgICAgICByZXR1cm4gXyhkZXN0aW5hdGlvbnMpLm1hcChcbiAgICAgICAgICAgIChkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJlc3REZXN0aW5hdGlvblBhdGgoc3RhdGUsIG1hcmNoaW5nUGllY2VzLCBzdGFydFJlZ2lvbiwgZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEJlc3REZXN0aW5hdGlvblBhdGgoc3RhdGUsIG1hcmNoaW5nUGllY2VzLCBzdGFydFJlZ2lvbiwgZGVzdGluYXRpb24pIHtcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXAubWVhc3VyZURpc3RhbmNlVG9SZWdpb24oc3RhdGUsIHN0YXJ0UmVnaW9uLmlkLCBkZXN0aW5hdGlvbi5pZCk7XG4gICAgICAgIGlmIChkaXN0YW5jZSA8IDIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgcGF0aDogW3N0YXJ0UmVnaW9uLmlkLCBkZXN0aW5hdGlvbi5pZF0sXG4gICAgICAgICAgICAgICAgaGFyYXNzbWVudExvc3NlczogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJlc3RQYXRoID0gXyhNYXAuZmluZFBhdGhzVG9SZWdpb24oc3RhdGUsIHN0YXJ0UmVnaW9uLmlkLCBkZXN0aW5hdGlvbi5pZCwgMykpLnJlamVjdChcbiAgICAgICAgICAgIChwYXRoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hcmNoLmlzSW52YWxpZE1hcmNoUGF0aChzdGF0ZSwgcGF0aCk7XG4gICAgICAgICAgICB9KS5tYXAoXG4gICAgICAgICAgICAocGF0aCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaGFyYXNzbWVudExvc3NlcyA9IF8ocGF0aCkuc2xpY2UoMSwgcGF0aC5sZW5ndGggLSAxKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkID0+IHN0YXRlLnJlZ2lvbnNCeUlkW3JlZ2lvbklkXSkucmVkdWNlKChzdW0sIHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZWdpb25Mb3NzZXMgPSB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuQVJWRVJOSSwgcmVnaW9uKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFyYXNzbWVudExvc3NlcyhzdGF0ZSwgRmFjdGlvbklEcy5CRUxHQUUsIHJlZ2lvbikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuQUVEVUksIHJlZ2lvbikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLCByZWdpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgcmVnaW9uTG9zc2VzO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgICAgICAgaWYgKGhhcmFzc21lbnRMb3NzZXMgPiAocGF0aC5sZW5ndGggLSAyKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgbnVtQXV4aWxpYSA9IF8uY291bnRCeShtYXJjaGluZ1BpZWNlcywgJ3R5cGUnKS5hdXhpbGlhIHx8IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoaGFyYXNzbWVudExvc3NlcyAmJiBudW1BdXhpbGlhIDwgaGFyYXNzbWVudExvc3Nlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IHBhdGgubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgaGFyYXNzbWVudExvc3Nlc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNvbXBhY3QoKS5vcmRlckJ5KFsnaGFyYXNzbWVudExvc3NlcycsICdkaXN0YW5jZSddKS5maXJzdCgpO1xuXG4gICAgICAgIGlmICghYmVzdFBhdGgpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgIHBhdGg6IGJlc3RQYXRoLnBhdGgsXG4gICAgICAgICAgICBkaXN0YW5jZTogYmVzdFBhdGguZGlzdGFuY2UsXG4gICAgICAgICAgICBoYXJhc3NtZW50TG9zc2VzOiBiZXN0UGF0aC5oYXJhc3NtZW50TG9zc2VzXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHN0YXRpYyBoYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBmYWN0aW9uSWQsIHJlZ2lvbikge1xuICAgICAgICBsZXQgbG9zc2VzID0gMDtcbiAgICAgICAgY29uc3QgbnVtSGlkZGVuRW5lbWllcyA9IHJlZ2lvbi5nZXRIaWRkZW5QaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkubGVuZ3RoO1xuICAgICAgICBpZiAobnVtSGlkZGVuRW5lbWllcyA+PSAzKSB7XG4gICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF07XG4gICAgICAgICAgICBpZiAocGxheWVyLndpbGxIYXJhc3MoRmFjdGlvbklEcy5ST01BTlMpKSB7XG4gICAgICAgICAgICAgICAgbG9zc2VzID0gTWF0aC5mbG9vcihudW1IaWRkZW5FbmVtaWVzIC8gMyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxvc3NlcztcbiAgICB9XG5cblxufVxuXG5leHBvcnQgZGVmYXVsdCBSb21hbk1hcmNoXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuTWFyY2guanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBOzs7Ozs7O0FBRUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFFQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFGQTtBQU9BO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBRkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFPQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBS0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 144 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _romanBuild = __webpack_require__(53);\n\nvar _romanBuild2 = _interopRequireDefault(_romanBuild);\n\nvar _rally = __webpack_require__(29);\n\nvar _rally2 = _interopRequireDefault(_rally);\n\nvar _removeResources = __webpack_require__(4);\n\nvar _removeResources2 = _interopRequireDefault(_removeResources);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _romanScout = __webpack_require__(54);\n\nvar _romanScout2 = _interopRequireDefault(_romanScout);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Checkpoints = {\n    PRE_RECRUIT_SPECIAL_CHECK: 'pre-recruit-special'\n};\n\nvar RomanRecruit = function () {\n    function RomanRecruit() {\n        _classCallCheck(this, RomanRecruit);\n    }\n\n    _createClass(RomanRecruit, null, [{\n        key: 'recruit',\n        value: function recruit(state, modifiers) {\n            var turn = state.turnHistory.getCurrentTurn();\n            if (!turn.getCheckpoint(Checkpoints.PRE_RECRUIT_SPECIAL_CHECK)) {\n                if (modifiers.canDoSpecial()) {\n                    modifiers.context.didPreRecruitSpecial = _romanBuild2.default.build(state, modifiers);\n                }\n                turn.markCheckpoint(Checkpoints.PRE_BATTLE_SPECIAL_CHECK);\n            }\n\n            var executableRallyRegions = this.getExecutableRallyRegions(state, modifiers);\n            if (!this.isRallyEffective(state, executableRallyRegions)) {\n                if (modifiers.context.didPreRecruitSpecial) {\n                    turn.rollbackPriorSpecialAbility();\n                }\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.RECRUIT);\n            _lodash2.default.each(executableRallyRegions, function (rallyRegion) {\n                if (!modifiers.free && rallyRegion.cost > 0 && !rallyRegion.inSupplyLine) {\n                    _removeResources2.default.execute(state, { factionId: state.romans.id, count: rallyRegion.cost });\n                }\n                _rally2.default.execute(state, { faction: state.romans, regionResult: rallyRegion });\n            });\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n\n            var didSpecial = modifiers.context.didPreRecruitSpecial;\n            if (modifiers.canDoSpecial() && !didSpecial) {\n                didSpecial = _romanScout2.default.scout(state, modifiers);\n            }\n\n            return didSpecial ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'getAllyRegions',\n        value: function getAllyRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.ROMANS,\n                regions: regions\n            });\n            var allyRegions = (0, _lodash2.default)(rallyRegionResults).filter({ canAddAlly: true }).shuffle().value();\n            _lodash2.default.each(allyRegions, function (regionResult) {\n                regionResult.addAlly = true;\n            });\n            return _lodash2.default.take(allyRegions, state.romans.availableAlliedTribes().length);\n        }\n    }, {\n        key: 'getAuxiliaRegions',\n        value: function getAuxiliaRegions(state, modifiers, ralliedRegionIds) {\n            var regions = _lodash2.default.filter(state.regions, function (region) {\n                return _lodash2.default.indexOf(ralliedRegionIds, region.id) < 0;\n            });\n            var rallyRegionResults = _rally2.default.test(state, {\n                factionId: _factionIds2.default.ROMANS,\n                regions: regions\n            });\n\n            // Order by supply line\n\n            var auxiliaRemaining = state.romans.availableAuxilia().length;\n            _lodash2.default.each(rallyRegionResults, function (regionResult) {\n                regionResult.addNumAuxilia = Math.min(regionResult.canAddNumAuxilia, auxiliaRemaining);\n                auxiliaRemaining -= regionResult.addNumAuxilia;\n                if (auxiliaRemaining === 0) {\n                    return false;\n                }\n            });\n\n            return (0, _lodash2.default)(rallyRegionResults).filter(function (result) {\n                return result.addNumAuxilia > 0;\n            }).shuffle().value();\n        }\n    }, {\n        key: 'isRallyEffective',\n        value: function isRallyEffective(state, executableRallyRegions) {\n            var romans = state.romans;\n            var numAlliesAdded = false;\n            var numPiecesAdded = 0;\n            _lodash2.default.each(executableRallyRegions, function (regionResult) {\n\n                if (regionResult.addAlly && romans.availableAlliedTribes().length > 0) {\n                    numAlliesAdded += 1;\n                    numPiecesAdded += 1;\n                    return;\n                }\n\n                numPiecesAdded += regionResult.addNumAuxilia;\n            });\n            return numAlliesAdded >= 2 || numPiecesAdded >= 3;\n        }\n    }, {\n        key: 'getExecutableRallyRegions',\n        value: function getExecutableRallyRegions(state, modifiers, faction) {\n            var ralliedRegions = [];\n            var allyRegions = this.getAllyRegions(state, modifiers, ralliedRegions);\n            ralliedRegions.push.apply(ralliedRegions, _lodash2.default.map(allyRegions, function (rallyRegion) {\n                return rallyRegion.region.id;\n            }));\n            var auxiliaRegions = this.getAuxiliaRegions(state, modifiers, ralliedRegions);\n\n            var allRegions = (0, _lodash2.default)(allyRegions).concat(auxiliaRegions).value();\n\n            _lodash2.default.each(allRegions, function (regionResult) {\n                var agreementsForSupplyLine = regionResult.region.getAgreementsNeededForSupplyLine(_factionIds2.default.ROMANS);\n                if (agreementsForSupplyLine.length === 0) {\n                    regionResult.inSupplyLine = true;\n                }\n                regionResult.agreementsNeeded = agreementsForSupplyLine;\n            });\n\n            var affordableRegions = modifiers.free ? allRegions : _lodash2.default.reduce(allRegions, function (accumulator, rallyRegion) {\n                if (accumulator.resourcesRemaining >= rallyRegion.cost) {\n                    accumulator.resourcesRemaining -= rallyRegion.cost;\n                    accumulator.rallies.push(rallyRegion);\n                }\n                return accumulator;\n            }, { resourcesRemaining: state.romans.resources(), rallies: [] }).rallies;\n\n            return modifiers.limited ? _lodash2.default.take(affordableRegions, 1) : affordableRegions;\n        }\n    }]);\n\n    return RomanRecruit;\n}();\n\nexports.default = RomanRecruit;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuUmVjcnVpdC5qcz9jYjJmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IENvbW1hbmRJRHMgZnJvbSAnLi4vLi4vY29uZmlnL2NvbW1hbmRJZHMnO1xuaW1wb3J0IFJvbWFuQnVpbGQgZnJvbSAnZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hbkJ1aWxkJztcbmltcG9ydCBSYWxseSBmcm9tICcuLi8uLi9jb21tYW5kcy9yYWxseSc7XG5pbXBvcnQgUmVtb3ZlUmVzb3VyY2VzIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9yZW1vdmVSZXNvdXJjZXMnO1xuaW1wb3J0IEZhY3Rpb25BY3Rpb25zIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9mYWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgUm9tYW5TY291dCBmcm9tICdmYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuU2NvdXQnO1xuXG5jb25zdCBDaGVja3BvaW50cyA9IHtcbiAgICBQUkVfUkVDUlVJVF9TUEVDSUFMX0NIRUNLOiAncHJlLXJlY3J1aXQtc3BlY2lhbCdcbn07XG5cblxuY2xhc3MgUm9tYW5SZWNydWl0IHtcbiAgICBzdGF0aWMgcmVjcnVpdChzdGF0ZSwgbW9kaWZpZXJzKSB7XG4gICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpO1xuICAgICAgICBpZiAoIXR1cm4uZ2V0Q2hlY2twb2ludChDaGVja3BvaW50cy5QUkVfUkVDUlVJVF9TUEVDSUFMX0NIRUNLKSkge1xuICAgICAgICAgICAgaWYobW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpKSB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLmNvbnRleHQuZGlkUHJlUmVjcnVpdFNwZWNpYWwgPSBSb21hbkJ1aWxkLmJ1aWxkKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHVybi5tYXJrQ2hlY2twb2ludChDaGVja3BvaW50cy5QUkVfQkFUVExFX1NQRUNJQUxfQ0hFQ0spO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZXhlY3V0YWJsZVJhbGx5UmVnaW9ucyA9IHRoaXMuZ2V0RXhlY3V0YWJsZVJhbGx5UmVnaW9ucyhzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmFsbHlFZmZlY3RpdmUoc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpKSB7XG4gICAgICAgICAgICBpZihtb2RpZmllcnMuY29udGV4dC5kaWRQcmVSZWNydWl0U3BlY2lhbCkge1xuICAgICAgICAgICAgICAgIHR1cm4ucm9sbGJhY2tQcmlvclNwZWNpYWxBYmlsaXR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLnN0YXJ0Q29tbWFuZChDb21tYW5kSURzLlJFQ1JVSVQpO1xuICAgICAgICBfLmVhY2goZXhlY3V0YWJsZVJhbGx5UmVnaW9ucywgKHJhbGx5UmVnaW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoIW1vZGlmaWVycy5mcmVlICYmIHJhbGx5UmVnaW9uLmNvc3QgPiAwICYmICFyYWxseVJlZ2lvbi5pblN1cHBseUxpbmUpIHtcbiAgICAgICAgICAgICAgICBSZW1vdmVSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb25JZDogc3RhdGUucm9tYW5zLmlkLCBjb3VudDogcmFsbHlSZWdpb24uY29zdH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUmFsbHkuZXhlY3V0ZShzdGF0ZSwge2ZhY3Rpb246IHN0YXRlLnJvbWFucywgcmVnaW9uUmVzdWx0OiByYWxseVJlZ2lvbn0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBzdGF0ZS50dXJuSGlzdG9yeS5nZXRDdXJyZW50VHVybigpLmNvbW1pdENvbW1hbmQoKTtcblxuICAgICAgICBsZXQgZGlkU3BlY2lhbCA9IG1vZGlmaWVycy5jb250ZXh0LmRpZFByZVJlY3J1aXRTcGVjaWFsO1xuICAgICAgICBpZiAobW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmICFkaWRTcGVjaWFsKSB7XG4gICAgICAgICAgICBkaWRTcGVjaWFsID0gUm9tYW5TY291dC5zY291dChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaWRTcGVjaWFsID8gRmFjdGlvbkFjdGlvbnMuQ09NTUFORF9BTkRfU1BFQ0lBTCA6IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuUk9NQU5TLFxuICAgICAgICAgICAgcmVnaW9uczogcmVnaW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWxseVJlZ2lvbnMgPSBfKHJhbGx5UmVnaW9uUmVzdWx0cykuZmlsdGVyKHtjYW5BZGRBbGx5OiB0cnVlfSkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgICAgIF8uZWFjaChhbGx5UmVnaW9ucywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZEFsbHkgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF8udGFrZShhbGx5UmVnaW9ucywgc3RhdGUucm9tYW5zLmF2YWlsYWJsZUFsbGllZFRyaWJlcygpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEF1eGlsaWFSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25JZHMpIHtcbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8uZmlsdGVyKHN0YXRlLnJlZ2lvbnMsIHJlZ2lvbiA9PiBfLmluZGV4T2YocmFsbGllZFJlZ2lvbklkcywgcmVnaW9uLmlkKSA8IDApO1xuICAgICAgICBjb25zdCByYWxseVJlZ2lvblJlc3VsdHMgPSBSYWxseS50ZXN0KHN0YXRlLCB7XG4gICAgICAgICAgICBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuUk9NQU5TLFxuICAgICAgICAgICAgcmVnaW9uczogcmVnaW9uc1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIE9yZGVyIGJ5IHN1cHBseSBsaW5lXG5cbiAgICAgICAgbGV0IGF1eGlsaWFSZW1haW5pbmcgPSBzdGF0ZS5yb21hbnMuYXZhaWxhYmxlQXV4aWxpYSgpLmxlbmd0aDtcbiAgICAgICAgXy5lYWNoKHJhbGx5UmVnaW9uUmVzdWx0cywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFkZE51bUF1eGlsaWEgPSBNYXRoLm1pbihyZWdpb25SZXN1bHQuY2FuQWRkTnVtQXV4aWxpYSwgYXV4aWxpYVJlbWFpbmluZyk7XG4gICAgICAgICAgICBhdXhpbGlhUmVtYWluaW5nIC09IHJlZ2lvblJlc3VsdC5hZGROdW1BdXhpbGlhO1xuICAgICAgICAgICAgaWYoYXV4aWxpYVJlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIF8ocmFsbHlSZWdpb25SZXN1bHRzKS5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5hZGROdW1BdXhpbGlhID4gMCkuc2h1ZmZsZSgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzUmFsbHlFZmZlY3RpdmUoc3RhdGUsIGV4ZWN1dGFibGVSYWxseVJlZ2lvbnMpIHtcbiAgICAgICAgY29uc3Qgcm9tYW5zID0gc3RhdGUucm9tYW5zO1xuICAgICAgICBsZXQgbnVtQWxsaWVzQWRkZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IG51bVBpZWNlc0FkZGVkID0gMDtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgZXhlY3V0YWJsZVJhbGx5UmVnaW9ucywgKHJlZ2lvblJlc3VsdCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvblJlc3VsdC5hZGRBbGx5ICYmIHJvbWFucy5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bUFsbGllc0FkZGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIG51bVBpZWNlc0FkZGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBudW1QaWVjZXNBZGRlZCArPSByZWdpb25SZXN1bHQuYWRkTnVtQXV4aWxpYTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbnVtQWxsaWVzQWRkZWQgPj0gMiB8fCBudW1QaWVjZXNBZGRlZCA+PSAzO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRFeGVjdXRhYmxlUmFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIGZhY3Rpb24pIHtcbiAgICAgICAgY29uc3QgcmFsbGllZFJlZ2lvbnMgPSBbXTtcbiAgICAgICAgY29uc3QgYWxseVJlZ2lvbnMgPSB0aGlzLmdldEFsbHlSZWdpb25zKHN0YXRlLCBtb2RpZmllcnMsIHJhbGxpZWRSZWdpb25zKTtcbiAgICAgICAgcmFsbGllZFJlZ2lvbnMucHVzaC5hcHBseShyYWxsaWVkUmVnaW9ucywgXy5tYXAoYWxseVJlZ2lvbnMsIHJhbGx5UmVnaW9uID0+IHJhbGx5UmVnaW9uLnJlZ2lvbi5pZCkpO1xuICAgICAgICBjb25zdCBhdXhpbGlhUmVnaW9ucyA9IHRoaXMuZ2V0QXV4aWxpYVJlZ2lvbnMoc3RhdGUsIG1vZGlmaWVycywgcmFsbGllZFJlZ2lvbnMpO1xuXG4gICAgICAgIGNvbnN0IGFsbFJlZ2lvbnMgPSBfKGFsbHlSZWdpb25zKS5jb25jYXQoYXV4aWxpYVJlZ2lvbnMpLnZhbHVlKCk7XG5cbiAgICAgICAgXy5lYWNoKGFsbFJlZ2lvbnMsIChyZWdpb25SZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFncmVlbWVudHNGb3JTdXBwbHlMaW5lID0gcmVnaW9uUmVzdWx0LnJlZ2lvbi5nZXRBZ3JlZW1lbnRzTmVlZGVkRm9yU3VwcGx5TGluZShGYWN0aW9uSURzLlJPTUFOUyk7XG4gICAgICAgICAgICBpZiAoYWdyZWVtZW50c0ZvclN1cHBseUxpbmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmluU3VwcGx5TGluZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWdpb25SZXN1bHQuYWdyZWVtZW50c05lZWRlZCA9IGFncmVlbWVudHNGb3JTdXBwbHlMaW5lO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBhZmZvcmRhYmxlUmVnaW9ucyA9IG1vZGlmaWVycy5mcmVlID8gYWxsUmVnaW9ucyA6IF8ucmVkdWNlKGFsbFJlZ2lvbnMsIChhY2N1bXVsYXRvciwgcmFsbHlSZWdpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChhY2N1bXVsYXRvci5yZXNvdXJjZXNSZW1haW5pbmcgPj0gcmFsbHlSZWdpb24uY29zdCkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJlc291cmNlc1JlbWFpbmluZyAtPSByYWxseVJlZ2lvbi5jb3N0O1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yLnJhbGxpZXMucHVzaChyYWxseVJlZ2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3JcbiAgICAgICAgfSwge3Jlc291cmNlc1JlbWFpbmluZzogc3RhdGUucm9tYW5zLnJlc291cmNlcygpLCByYWxsaWVzOiBbXX0pLnJhbGxpZXM7XG5cbiAgICAgICAgcmV0dXJuIG1vZGlmaWVycy5saW1pdGVkID8gXy50YWtlKGFmZm9yZGFibGVSZWdpb25zLCAxKSA6IGFmZm9yZGFibGVSZWdpb25zO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBSb21hblJlY3J1aXRcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5SZWNydWl0LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUlBOzs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 145 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _commandIds = __webpack_require__(2);\n\nvar _commandIds2 = _interopRequireDefault(_commandIds);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _seize = __webpack_require__(166);\n\nvar _seize2 = _interopRequireDefault(_seize);\n\nvar _addResources = __webpack_require__(20);\n\nvar _addResources2 = _interopRequireDefault(_addResources);\n\nvar _arverniRally = __webpack_require__(67);\n\nvar _arverniRally2 = _interopRequireDefault(_arverniRally);\n\nvar _belgaeRally = __webpack_require__(70);\n\nvar _belgaeRally2 = _interopRequireDefault(_belgaeRally);\n\nvar _disperseTribe = __webpack_require__(63);\n\nvar _disperseTribe2 = _interopRequireDefault(_disperseTribe);\n\nvar _factionActions = __webpack_require__(3);\n\nvar _factionActions2 = _interopRequireDefault(_factionActions);\n\nvar _romanBuild = __webpack_require__(53);\n\nvar _romanBuild2 = _interopRequireDefault(_romanBuild);\n\nvar _romanScout = __webpack_require__(54);\n\nvar _romanScout2 = _interopRequireDefault(_romanScout);\n\nvar _turnContext = __webpack_require__(19);\n\nvar _turnContext2 = _interopRequireDefault(_turnContext);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RomanSeize = function () {\n    function RomanSeize() {\n        _classCallCheck(this, RomanSeize);\n    }\n\n    _createClass(RomanSeize, null, [{\n        key: 'seize',\n        value: function seize(state, modifiers) {\n            var _this = this;\n\n            var executableSeizes = this.getExecutableSeizes(state, modifiers);\n            if (executableSeizes.length === 0) {\n                return false;\n            }\n\n            state.turnHistory.getCurrentTurn().startCommand(_commandIds2.default.SEIZE);\n            _lodash2.default.each(executableSeizes, function (seize) {\n                if (seize.willDisperse) {\n                    var tribe = (0, _lodash2.default)(seize.region.getSubduedTribes()).sortBy(function (tribe) {\n                        return tribe.isCity;\n                    }).first();\n                    _disperseTribe2.default.execute(state, { factionId: _factionIds2.default.ROMANS, tribeId: tribe.id });\n\n                    _lodash2.default.each([_factionIds2.default.ARVERNI, _factionIds2.default.BELGAE], function (factionId) {\n                        var canRally = _lodash2.default.random(1, 6) < 4;\n\n                        if (canRally) {\n                            _this.handleRally(state, factionId, seize);\n                        }\n                    });\n                }\n\n                _addResources2.default.execute(state, { factionId: _factionIds2.default.ROMANS, count: seize.resourcesGained + (seize.willDisperse ? 6 : 0) });\n\n                if (seize.harassmentLosses > 0) {\n                    throw Error('Should not have harassment lossses!');\n                }\n            });\n\n            state.turnHistory.getCurrentTurn().commitCommand();\n            modifiers.context.seizeRegions = _lodash2.default.map(executableSeizes, function (seize) {\n                return seize.region.id;\n            });\n            var usedSpecialAbility = modifiers.canDoSpecial() && _romanBuild2.default.build(state, modifiers) || _romanScout2.default.scout(state, modifiers);\n            return usedSpecialAbility ? _factionActions2.default.COMMAND_AND_SPECIAL : _factionActions2.default.COMMAND;\n        }\n    }, {\n        key: 'handleRally',\n        value: function handleRally(state, factionId, seize) {\n            // ASK PLAYER\n\n            var regions = (0, _lodash2.default)(seize.region.adjacent).reject(function (adjacent) {\n                return adjacent.devastated();\n            }).map('id').value();\n            if (factionId === _factionIds2.default.ARVERNI) {\n                var turn = state.turnHistory.currentTurn;\n                turn.pushContext(new _turnContext2.default({ currentFactionId: _factionIds2.default.ARVERNI, free: true, noSpecial: true, allowedRegions: regions }));\n                _arverniRally2.default.rally(state, turn.getContext());\n                turn.popContext();\n            } else if (factionId === _factionIds2.default.BELGAE) {\n                var _turn = state.turnHistory.currentTurn;\n                _turn.pushContext(new _turnContext2.default({ currentFactionId: _factionIds2.default.BELGAE, free: true, noSpecial: true, allowedRegions: regions }));\n                _belgaeRally2.default.rally(state, _turn.getContext());\n                _turn.popContext();\n            }\n        }\n\n        // static handleHarassment(state, seize) {\n        //     _.each(_.concat(state.currentCard().initiativeOrder, [FactionIDs.GERMANIC_TRIBES]), factionId=> {\n        //         // ASK PLAYER\n        //         if(factionId === FactionIDs.ROMANS) {\n        //             return;\n        //         }\n        //\n        //         const numHiddenWarbands = seize.region.getHiddenWarbandsOrAuxiliaForFaction(factionId).length;\n        //         if(numHiddenWarbands < 3) {\n        //             return;\n        //         }\n        //\n        //         const player = state.playersByFaction[factionId];\n        //         if(player.willHarass(FactionIDs.ROMANS)) {\n        //             const losses = Math.floor(numHiddenWarbands / 3);\n        //\n        //         }\n        //     });\n        // }\n\n    }, {\n        key: 'getExecutableSeizes',\n        value: function getExecutableSeizes(state, modifiers) {\n            var possibleSeizes = (0, _lodash2.default)(_seize2.default.test(state)).filter({ harassmentLosses: 0 }).shuffle().value();\n            var dispersalSeize = this.getDispersalSeize(state, modifiers, possibleSeizes);\n            if (dispersalSeize) {\n                dispersalSeize.willDisperse = true;\n            }\n            return (0, _lodash2.default)([dispersalSeize]).concat(possibleSeizes).compact().uniqBy(function (seize) {\n                return seize.region.id;\n            }).value();\n        }\n    }, {\n        key: 'getDispersalSeize',\n        value: function getDispersalSeize(state, modifiers, possibleSeizes) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(possibleSeizes).map(function (seize) {\n                var priority = 'z';\n                if (!seize.canDisperse) {\n                    return;\n                }\n                var hasPlayerPieces = _lodash2.default.find(_factionIds2.default, function (factionId) {\n                    return factionId !== _factionIds2.default.ROMANS && !state.playersByFaction[factionId].isNonPlayer && seize.region.getPiecesForFaction(factionId).length > 0;\n                });\n\n                if (hasPlayerPieces) {\n                    priority = 'a';\n                } else if (seize.region.group === _regionGroups2.default.BELGICA) {\n                    priority = 'b';\n                } else if (_lodash2.default.find(_this2.getFactionsWithHighestVictoryMargin(state), function (factionId) {\n                    return seize.region.getPiecesForFaction(factionId).length > 0;\n                })) {\n                    priority = 'c';\n                }\n\n                return {\n                    seize: seize,\n                    priority: priority\n                };\n            }).compact().sortBy('priority').groupBy('priority').map(_lodash2.default.shuffle).flatten().map('seize').first();\n        }\n    }, {\n        key: 'getFactionsWithHighestVictoryMargin',\n        value: function getFactionsWithHighestVictoryMargin(state) {\n            return _lodash2.default.reduce([_factionIds2.default.BELGAE, _factionIds2.default.ARVERNI, _factionIds2.default.AEDUI], function (accumulator, factionId) {\n                var factionVictoryMargin = state.factionsById[factionId].victoryMargin(state);\n                if (factionVictoryMargin > accumulator.victoryMargin) {\n                    accumulator.victoryMargin = factionVictoryMargin;\n                    accumulator.factions = [factionId];\n                } else if (factionVictoryMargin === accumulator.victoryMargin) {\n                    accumulator.factions.push(factionId);\n                }\n                return accumulator;\n            }, { victoryMargin: -99, factions: [] });\n        }\n    }]);\n\n    return RomanSeize;\n}();\n\nexports.default = RomanSeize;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2JvdHMvcm9tYW5zL3JvbWFuU2VpemUuanM/ZWUzMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBDb21tYW5kSURzIGZyb20gJy4uLy4uL2NvbmZpZy9jb21tYW5kSWRzJztcbmltcG9ydCBSZWdpb25Hcm91cHMgZnJvbSAnZmFsbGluZ3NreS9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBTZWl6ZSBmcm9tICcuLi8uLi9jb21tYW5kcy9yb21hbnMvc2VpemUnO1xuaW1wb3J0IEFkZFJlc291cmNlcyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvYWRkUmVzb3VyY2VzJztcbmltcG9ydCBBcnZlcm5pUmFsbHkgZnJvbSAnZmFsbGluZ3NreS9ib3RzL2FydmVybmkvYXJ2ZXJuaVJhbGx5JztcbmltcG9ydCBCZWxnYWVSYWxseSBmcm9tICdmYWxsaW5nc2t5L2JvdHMvYmVsZ2FlL2JlbGdhZVJhbGx5JztcbmltcG9ydCBEaXNwZXJzZVRyaWJlIGZyb20gJ2ZhbGxpbmdza3kvYWN0aW9ucy9kaXNwZXJzZVRyaWJlJztcbmltcG9ydCBGYWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi8uLi9jb21tb24vZmFjdGlvbkFjdGlvbnMnO1xuaW1wb3J0IFJvbWFuQnVpbGQgZnJvbSAnZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hbkJ1aWxkJztcbmltcG9ydCBSb21hblNjb3V0IGZyb20gJ2ZhbGxpbmdza3kvYm90cy9yb21hbnMvcm9tYW5TY291dCc7XG5pbXBvcnQgVHVybkNvbnRleHQgZnJvbSAnY29tbW9uL3R1cm5Db250ZXh0JztcblxuXG5jbGFzcyBSb21hblNlaXplIHtcbiAgICBzdGF0aWMgc2VpemUoc3RhdGUsIG1vZGlmaWVycykge1xuICAgICAgICBjb25zdCBleGVjdXRhYmxlU2VpemVzID0gdGhpcy5nZXRFeGVjdXRhYmxlU2VpemVzKHN0YXRlLCBtb2RpZmllcnMpO1xuICAgICAgICBpZihleGVjdXRhYmxlU2VpemVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5zdGFydENvbW1hbmQoQ29tbWFuZElEcy5TRUlaRSk7XG4gICAgICAgIF8uZWFjaChleGVjdXRhYmxlU2VpemVzLCAoc2VpemUpID0+IHtcbiAgICAgICAgICAgIGlmKHNlaXplLndpbGxEaXNwZXJzZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyaWJlID0gXyhzZWl6ZS5yZWdpb24uZ2V0U3ViZHVlZFRyaWJlcygpKS5zb3J0QnkodHJpYmU9PnRyaWJlLmlzQ2l0eSkuZmlyc3QoKTtcbiAgICAgICAgICAgICAgICBEaXNwZXJzZVRyaWJlLmV4ZWN1dGUoc3RhdGUsIHsgZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOUywgdHJpYmVJZDogdHJpYmUuaWR9KTtcblxuICAgICAgICAgICAgICAgIF8uZWFjaChbRmFjdGlvbklEcy5BUlZFUk5JLCBGYWN0aW9uSURzLkJFTEdBRV0sIChmYWN0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FuUmFsbHkgPSBfLnJhbmRvbSgxLDYpIDwgNDtcblxuICAgICAgICAgICAgICAgICAgICBpZihjYW5SYWxseSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSYWxseShzdGF0ZSwgZmFjdGlvbklkLCBzZWl6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBBZGRSZXNvdXJjZXMuZXhlY3V0ZShzdGF0ZSwgeyBmYWN0aW9uSWQ6IEZhY3Rpb25JRHMuUk9NQU5TLCBjb3VudDogc2VpemUucmVzb3VyY2VzR2FpbmVkICsgKHNlaXplLndpbGxEaXNwZXJzZSA/IDYgOiAwKX0pO1xuXG4gICAgICAgICAgICBpZihzZWl6ZS5oYXJhc3NtZW50TG9zc2VzID4gMCApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignU2hvdWxkIG5vdCBoYXZlIGhhcmFzc21lbnQgbG9zc3NlcyEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc3RhdGUudHVybkhpc3RvcnkuZ2V0Q3VycmVudFR1cm4oKS5jb21taXRDb21tYW5kKCk7XG4gICAgICAgIG1vZGlmaWVycy5jb250ZXh0LnNlaXplUmVnaW9ucyA9IF8ubWFwKGV4ZWN1dGFibGVTZWl6ZXMsIHNlaXplPT4gc2VpemUucmVnaW9uLmlkKTtcbiAgICAgICAgY29uc3QgdXNlZFNwZWNpYWxBYmlsaXR5ID0gbW9kaWZpZXJzLmNhbkRvU3BlY2lhbCgpICYmIFJvbWFuQnVpbGQuYnVpbGQoc3RhdGUsIG1vZGlmaWVycykgfHwgUm9tYW5TY291dC5zY291dChzdGF0ZSwgbW9kaWZpZXJzKTtcbiAgICAgICAgcmV0dXJuIHVzZWRTcGVjaWFsQWJpbGl0eSA/IEZhY3Rpb25BY3Rpb25zLkNPTU1BTkRfQU5EX1NQRUNJQUwgOiBGYWN0aW9uQWN0aW9ucy5DT01NQU5EO1xuICAgIH1cblxuICAgIHN0YXRpYyBoYW5kbGVSYWxseShzdGF0ZSwgZmFjdGlvbklkLCBzZWl6ZSkge1xuICAgICAgICAvLyBBU0sgUExBWUVSXG5cbiAgICAgICAgY29uc3QgcmVnaW9ucyA9IF8oc2VpemUucmVnaW9uLmFkamFjZW50KS5yZWplY3QoYWRqYWNlbnQgPT4gYWRqYWNlbnQuZGV2YXN0YXRlZCgpKS5tYXAoJ2lkJykudmFsdWUoKTtcbiAgICAgICAgaWYoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkFSVkVSTkkpIHtcbiAgICAgICAgICAgIGNvbnN0IHR1cm4gPSBzdGF0ZS50dXJuSGlzdG9yeS5jdXJyZW50VHVybjtcbiAgICAgICAgICAgIHR1cm4ucHVzaENvbnRleHQobmV3IFR1cm5Db250ZXh0KHtjdXJyZW50RmFjdGlvbklkOiBGYWN0aW9uSURzLkFSVkVSTkksIGZyZWU6IHRydWUsIG5vU3BlY2lhbDogdHJ1ZSwgYWxsb3dlZFJlZ2lvbnM6IHJlZ2lvbnN9KSk7XG4gICAgICAgICAgICBBcnZlcm5pUmFsbHkucmFsbHkoc3RhdGUsIHR1cm4uZ2V0Q29udGV4dCgpKTtcbiAgICAgICAgICAgIHR1cm4ucG9wQ29udGV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYoZmFjdGlvbklkID09PSBGYWN0aW9uSURzLkJFTEdBRSkge1xuICAgICAgICAgICAgY29uc3QgdHVybiA9IHN0YXRlLnR1cm5IaXN0b3J5LmN1cnJlbnRUdXJuO1xuICAgICAgICAgICAgdHVybi5wdXNoQ29udGV4dChuZXcgVHVybkNvbnRleHQoe2N1cnJlbnRGYWN0aW9uSWQ6IEZhY3Rpb25JRHMuQkVMR0FFLCBmcmVlOiB0cnVlLCBub1NwZWNpYWw6IHRydWUsIGFsbG93ZWRSZWdpb25zOiByZWdpb25zfSkpO1xuICAgICAgICAgICAgQmVsZ2FlUmFsbHkucmFsbHkoc3RhdGUsIHR1cm4uZ2V0Q29udGV4dCgpKTtcbiAgICAgICAgICAgIHR1cm4ucG9wQ29udGV4dCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gc3RhdGljIGhhbmRsZUhhcmFzc21lbnQoc3RhdGUsIHNlaXplKSB7XG4gICAgLy8gICAgIF8uZWFjaChfLmNvbmNhdChzdGF0ZS5jdXJyZW50Q2FyZCgpLmluaXRpYXRpdmVPcmRlciwgW0ZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTXSksIGZhY3Rpb25JZD0+IHtcbiAgICAvLyAgICAgICAgIC8vIEFTSyBQTEFZRVJcbiAgICAvLyAgICAgICAgIGlmKGZhY3Rpb25JZCA9PT0gRmFjdGlvbklEcy5ST01BTlMpIHtcbiAgICAvLyAgICAgICAgICAgICByZXR1cm47XG4gICAgLy8gICAgICAgICB9XG4gICAgLy9cbiAgICAvLyAgICAgICAgIGNvbnN0IG51bUhpZGRlbldhcmJhbmRzID0gc2VpemUucmVnaW9uLmdldEhpZGRlbldhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihmYWN0aW9uSWQpLmxlbmd0aDtcbiAgICAvLyAgICAgICAgIGlmKG51bUhpZGRlbldhcmJhbmRzIDwgMykge1xuICAgIC8vICAgICAgICAgICAgIHJldHVybjtcbiAgICAvLyAgICAgICAgIH1cbiAgICAvL1xuICAgIC8vICAgICAgICAgY29uc3QgcGxheWVyID0gc3RhdGUucGxheWVyc0J5RmFjdGlvbltmYWN0aW9uSWRdO1xuICAgIC8vICAgICAgICAgaWYocGxheWVyLndpbGxIYXJhc3MoRmFjdGlvbklEcy5ST01BTlMpKSB7XG4gICAgLy8gICAgICAgICAgICAgY29uc3QgbG9zc2VzID0gTWF0aC5mbG9vcihudW1IaWRkZW5XYXJiYW5kcyAvIDMpO1xuICAgIC8vXG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH0pO1xuICAgIC8vIH1cblxuICAgIHN0YXRpYyBnZXRFeGVjdXRhYmxlU2VpemVzKHN0YXRlLCBtb2RpZmllcnMpIHtcbiAgICAgICAgY29uc3QgcG9zc2libGVTZWl6ZXMgPSBfKFNlaXplLnRlc3Qoc3RhdGUpKS5maWx0ZXIoe2hhcmFzc21lbnRMb3NzZXM6IDB9KS5zaHVmZmxlKCkudmFsdWUoKTtcbiAgICAgICAgY29uc3QgZGlzcGVyc2FsU2VpemUgPSB0aGlzLmdldERpc3BlcnNhbFNlaXplKHN0YXRlLCBtb2RpZmllcnMsIHBvc3NpYmxlU2VpemVzKTtcbiAgICAgICAgaWYoZGlzcGVyc2FsU2VpemUpIHtcbiAgICAgICAgICAgIGRpc3BlcnNhbFNlaXplLndpbGxEaXNwZXJzZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF8oW2Rpc3BlcnNhbFNlaXplXSkuY29uY2F0KHBvc3NpYmxlU2VpemVzKS5jb21wYWN0KCkudW5pcUJ5KHNlaXplPT5zZWl6ZS5yZWdpb24uaWQpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldERpc3BlcnNhbFNlaXplKHN0YXRlLCBtb2RpZmllcnMsIHBvc3NpYmxlU2VpemVzKSB7XG4gICAgICAgIHJldHVybiBfKHBvc3NpYmxlU2VpemVzKS5tYXAoKHNlaXplKSA9PiB7XG4gICAgICAgICAgICBsZXQgcHJpb3JpdHkgPSAneic7XG4gICAgICAgICAgICBpZiAoIXNlaXplLmNhbkRpc3BlcnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGFzUGxheWVyUGllY2VzID0gXy5maW5kKEZhY3Rpb25JRHMsIGZhY3Rpb25JZCA9PiBmYWN0aW9uSWQgIT09IEZhY3Rpb25JRHMuUk9NQU5TICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFzdGF0ZS5wbGF5ZXJzQnlGYWN0aW9uW2ZhY3Rpb25JZF0uaXNOb25QbGF5ZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VpemUucmVnaW9uLmdldFBpZWNlc0ZvckZhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0aW9uSWQpLmxlbmd0aCA+IDApO1xuXG4gICAgICAgICAgICBpZiAoaGFzUGxheWVyUGllY2VzKSB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZWl6ZS5yZWdpb24uZ3JvdXAgPT09IFJlZ2lvbkdyb3Vwcy5CRUxHSUNBKSB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHkgPSAnYic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChfLmZpbmQodGhpcy5nZXRGYWN0aW9uc1dpdGhIaWdoZXN0VmljdG9yeU1hcmdpbihzdGF0ZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkID0+IHNlaXplLnJlZ2lvbi5nZXRQaWVjZXNGb3JGYWN0aW9uKGZhY3Rpb25JZCkubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eSA9ICdjJztcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNlaXplLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KS5jb21wYWN0KCkuc29ydEJ5KCdwcmlvcml0eScpLmdyb3VwQnkoJ3ByaW9yaXR5JykubWFwKF8uc2h1ZmZsZSkuZmxhdHRlbigpLm1hcCgnc2VpemUnKS5maXJzdCgpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRGYWN0aW9uc1dpdGhIaWdoZXN0VmljdG9yeU1hcmdpbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXy5yZWR1Y2UoW0ZhY3Rpb25JRHMuQkVMR0FFLCBGYWN0aW9uSURzLkFSVkVSTkksIEZhY3Rpb25JRHMuQUVEVUldLCAoYWNjdW11bGF0b3IsIGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmFjdGlvblZpY3RvcnlNYXJnaW4gPSBzdGF0ZS5mYWN0aW9uc0J5SWRbZmFjdGlvbklkXS52aWN0b3J5TWFyZ2luKHN0YXRlKTtcbiAgICAgICAgICAgIGlmIChmYWN0aW9uVmljdG9yeU1hcmdpbiA+IGFjY3VtdWxhdG9yLnZpY3RvcnlNYXJnaW4pIHtcbiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci52aWN0b3J5TWFyZ2luID0gZmFjdGlvblZpY3RvcnlNYXJnaW47XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IuZmFjdGlvbnMgPSBbZmFjdGlvbklkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZhY3Rpb25WaWN0b3J5TWFyZ2luID09PSBhY2N1bXVsYXRvci52aWN0b3J5TWFyZ2luKSB7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IuZmFjdGlvbnMucHVzaChmYWN0aW9uSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgICAgICB9LCB7dmljdG9yeU1hcmdpbjogLTk5LCBmYWN0aW9uczogW119KTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUm9tYW5TZWl6ZVxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9ib3RzL3JvbWFucy9yb21hblNlaXplLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFFQTs7Ozs7OztBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 146 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _subornResults = __webpack_require__(147);\n\nvar _subornResults2 = _interopRequireDefault(_subornResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Suborn = function (_Command) {\n    _inherits(Suborn, _Command);\n\n    function Suborn() {\n        _classCallCheck(this, Suborn);\n\n        return _possibleConstructorReturn(this, (Suborn.__proto__ || Object.getPrototypeOf(Suborn)).apply(this, arguments));\n    }\n\n    _createClass(Suborn, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            return (0, _lodash2.default)(state.regionsById).filter(function (region) {\n                return (0, _lodash2.default)(region.piecesByFaction()[_factionIds2.default.AEDUI]).filter(function (piece) {\n                    return piece.type === 'warband' && !piece.revealed();\n                }).value().length > 0;\n            }).map(function (region) {\n                var canPlaceAlly = region.subduedTribesForFaction(_factionIds2.default.AEDUI).length > 0;\n\n                var factionsWithAlliesToRemove = (0, _lodash2.default)(region.tribes).map(function (tribe) {\n                    if (tribe.isAllied() && tribe.alliedFactionId() !== _factionIds2.default.AEDUI) {\n                        return tribe.alliedFactionId();\n                    }\n                }).compact().uniq().value();\n\n                var factionsWithMobilePiecesToRemove = (0, _lodash2.default)(region.piecesByFaction()).map(function (pieces, factionId) {\n                    if (factionId === _factionIds2.default.AEDUI) {\n                        return;\n                    }\n                    var grouped = _lodash2.default.groupBy(pieces, 'type');\n                    if (grouped.warband || grouped.auxilia) {\n                        return factionId;\n                    }\n                }).compact().uniq().value();\n\n                return new _subornResults2.default({\n                    region: region,\n                    canPlaceAlly: canPlaceAlly,\n                    alliedFactions: factionsWithAlliesToRemove,\n                    mobileFactions: factionsWithMobilePiecesToRemove\n                });\n            }).value();\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {}\n    }]);\n\n    return Suborn;\n}(_command2.default);\n\nexports.default = Suborn;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3N1Ym9ybi5qcz8wYTVhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgU3Vib3JuUmVzdWx0cyBmcm9tICcuL3N1Ym9yblJlc3VsdHMnO1xuXG5jbGFzcyBTdWJvcm4gZXh0ZW5kcyBDb21tYW5kIHtcbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnNCeUlkKS5maWx0ZXIoXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8ocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuQUVEVUldKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGllY2UudHlwZSA9PT0gJ3dhcmJhbmQnICYmICFwaWVjZS5yZXZlYWxlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkudmFsdWUoKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfSkubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhblBsYWNlQWxseSA9IHJlZ2lvbi5zdWJkdWVkVHJpYmVzRm9yRmFjdGlvbihGYWN0aW9uSURzLkFFRFVJKS5sZW5ndGggPiAwO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbnNXaXRoQWxsaWVzVG9SZW1vdmUgPSBfKHJlZ2lvbi50cmliZXMpLm1hcChcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHRyaWJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJpYmUuaXNBbGxpZWQoKSAmJiB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSAhPT0gRmFjdGlvbklEcy5BRURVSSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkuY29tcGFjdCgpLnVuaXEoKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjdGlvbnNXaXRoTW9iaWxlUGllY2VzVG9SZW1vdmUgPSBfKHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKSkubWFwKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocGllY2VzLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWN0aW9uSWQgPT09IEZhY3Rpb25JRHMuQUVEVUkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBncm91cGVkID0gXy5ncm91cEJ5KHBpZWNlcywgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncm91cGVkLndhcmJhbmQgfHwgZ3JvdXBlZC5hdXhpbGlhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkuY29tcGFjdCgpLnVuaXEoKS52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdWJvcm5SZXN1bHRzKFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblBsYWNlQWxseTogY2FuUGxhY2VBbGx5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsaWVkRmFjdGlvbnM6IGZhY3Rpb25zV2l0aEFsbGllc1RvUmVtb3ZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9iaWxlRmFjdGlvbnM6IGZhY3Rpb25zV2l0aE1vYmlsZVBpZWNlc1RvUmVtb3ZlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZG9FeGVjdXRlKHN0YXRlLCBhcmdzKSB7XG5cbiAgICB9XG59XG5leHBvcnQgZGVmYXVsdCBTdWJvcm47XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3N1Ym9ybi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7OztBQUVBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 147 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SubornResults = function () {\n    function SubornResults(definition) {\n        _classCallCheck(this, SubornResults);\n\n        this.region = definition.region;\n        this.canPlaceAlly = definition.canPlaceAlly;\n        this.alliedFactions = definition.alliedFactions;\n        this.mobileFactions = definition.mobileFactions;\n        this.priority = definition.priority;\n    }\n\n    _createClass(SubornResults, [{\n        key: 'logResults',\n        value: function logResults() {\n            console.log('*** Aedui Suborn in region ' + this.region.name + (this.priority ? ' with priority ' + this.priority : ''));\n            if (this.canPlaceAlly) {\n                console.log('Can result in Ally placed');\n            }\n            if (this.alliedFactions.length > 0) {\n                console.log('Can result in Ally removal from possible factions: ' + _lodash2.default.join(this.alliedFactions));\n            }\n            if (this.mobileFactions.length > 0) {\n                console.log('Can result in Warband/Auxilia removal from possible factions: ' + _lodash2.default.join(this.mobileFactions));\n            }\n        }\n    }]);\n\n    return SubornResults;\n}();\n\nexports.default = SubornResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3N1Ym9yblJlc3VsdHMuanM/NmQzMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi8uLi9saWIvbG9kYXNoJztcblxuY2xhc3MgU3Vib3JuUmVzdWx0cyB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IGRlZmluaXRpb24ucmVnaW9uO1xuICAgICAgICB0aGlzLmNhblBsYWNlQWxseSA9IGRlZmluaXRpb24uY2FuUGxhY2VBbGx5O1xuICAgICAgICB0aGlzLmFsbGllZEZhY3Rpb25zID0gZGVmaW5pdGlvbi5hbGxpZWRGYWN0aW9ucztcbiAgICAgICAgdGhpcy5tb2JpbGVGYWN0aW9ucyA9IGRlZmluaXRpb24ubW9iaWxlRmFjdGlvbnM7XG4gICAgICAgIHRoaXMucHJpb3JpdHkgPSBkZWZpbml0aW9uLnByaW9yaXR5O1xuICAgIH1cblxuICAgIGxvZ1Jlc3VsdHMoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQWVkdWkgU3Vib3JuIGluIHJlZ2lvbiAnICsgdGhpcy5yZWdpb24ubmFtZSArICh0aGlzLnByaW9yaXR5ID8gJyB3aXRoIHByaW9yaXR5ICcgKyB0aGlzLnByaW9yaXR5IDogJycpKTtcbiAgICAgICAgaWYgKHRoaXMuY2FuUGxhY2VBbGx5KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIHJlc3VsdCBpbiBBbGx5IHBsYWNlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFsbGllZEZhY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDYW4gcmVzdWx0IGluIEFsbHkgcmVtb3ZhbCBmcm9tIHBvc3NpYmxlIGZhY3Rpb25zOiAnICsgXy5qb2luKHRoaXMuYWxsaWVkRmFjdGlvbnMpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tb2JpbGVGYWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIHJlc3VsdCBpbiBXYXJiYW5kL0F1eGlsaWEgcmVtb3ZhbCBmcm9tIHBvc3NpYmxlIGZhY3Rpb25zOiAnICsgXy5qb2luKHRoaXMubW9iaWxlRmFjdGlvbnMpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU3Vib3JuUmVzdWx0cztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYWVkdWkvc3Vib3JuUmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 148 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _tradeResults = __webpack_require__(149);\n\nvar _tradeResults2 = _interopRequireDefault(_tradeResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Trade = function (_Command) {\n    _inherits(Trade, _Command);\n\n    function Trade() {\n        _classCallCheck(this, Trade);\n\n        return _possibleConstructorReturn(this, (Trade.__proto__ || Object.getPrototypeOf(Trade)).apply(this, arguments));\n    }\n\n    _createClass(Trade, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var regionResults = (0, _lodash2.default)(state.regionsById).map(function (region) {\n                var totalAedui = 0;\n                var totalAeduiWithRoman = 0;\n\n                var counted = _lodash2.default.countBy(region.piecesByFaction()[_factionIds2.default.AEDUI], 'type');\n                totalAedui += (counted.alliedtribe || 0) + (counted.citadel || 0);\n\n                var isAeduiControlled = region.controllingFactionId() === _factionIds2.default.AEDUI;\n                if (isAeduiControlled) {\n                    totalAedui += _lodash2.default.filter(region.tribes, function (tribe) {\n                        return tribe.isSubdued();\n                    }).length;\n\n                    totalAeduiWithRoman = (totalAedui + _lodash2.default.filter(region.piecesByFaction()[_factionIds2.default.ROMANS], function (piece) {\n                        return piece.type === 'alliedtribe';\n                    }).length) * 2;\n                }\n\n                return new _tradeResults2.default({\n                    region: region,\n                    totalAedui: totalAedui,\n                    totalAeduiWithRoman: totalAeduiWithRoman\n                });\n            }).filter(function (regionResult) {\n                return regionResult.totalAedui > 0 || regionResult.totalAeduiWithRoman > 0;\n            }).value();\n\n            _lodash2.default.each(regionResults, function (regionResult) {\n                var agreementsForSupplyLine = regionResult.region.getAgreementsNeededForSupplyLine(_factionIds2.default.AEDUI);\n                if (agreementsForSupplyLine.length === 0) {\n                    regionResult.inSupplyLine = true;\n                }\n                regionResult.agreementsNeeded = agreementsForSupplyLine;\n            });\n\n            return regionResults;\n        }\n    }]);\n\n    return Trade;\n}(_command2.default);\n\nexports.default = Trade;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3RyYWRlLmpzPzJiODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZCBmcm9tICcuLi9jb21tYW5kJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBUcmFkZVJlc3VsdHMgZnJvbSAnLi90cmFkZVJlc3VsdHMnO1xuXG5jbGFzcyBUcmFkZSBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCByZWdpb25SZXN1bHRzID0gXyhzdGF0ZS5yZWdpb25zQnlJZCkubWFwKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlZ2lvbikge1xuICAgICAgICAgICAgICAgIGxldCB0b3RhbEFlZHVpID0gMDtcbiAgICAgICAgICAgICAgICBsZXQgdG90YWxBZWR1aVdpdGhSb21hbiA9IDA7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudGVkID0gXy5jb3VudEJ5KHJlZ2lvbi5waWVjZXNCeUZhY3Rpb24oKVtGYWN0aW9uSURzLkFFRFVJXSwgJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICB0b3RhbEFlZHVpICs9IChjb3VudGVkLmFsbGllZHRyaWJlIHx8IDApICsgKGNvdW50ZWQuY2l0YWRlbCB8fCAwKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGlzQWVkdWlDb250cm9sbGVkID0gcmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuQUVEVUk7XG4gICAgICAgICAgICAgICAgaWYgKGlzQWVkdWlDb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQWVkdWkgKz0gXy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb24udHJpYmVzLCBmdW5jdGlvbiAodHJpYmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpYmUuaXNTdWJkdWVkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgdG90YWxBZWR1aVdpdGhSb21hbiA9ICh0b3RhbEFlZHVpICsgXy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuUk9NQU5TXSwgZnVuY3Rpb24gKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZS50eXBlID09PSAnYWxsaWVkdHJpYmUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmxlbmd0aCkgKiAyO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVHJhZGVSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEFlZHVpLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEFlZHVpV2l0aFJvbWFuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5maWx0ZXIoXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVnaW9uUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvblJlc3VsdC50b3RhbEFlZHVpID4gMCB8fCByZWdpb25SZXN1bHQudG90YWxBZWR1aVdpdGhSb21hbiA+IDA7XG4gICAgICAgICAgICB9KS52YWx1ZSgpO1xuXG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHJlZ2lvblJlc3VsdHMsIGZ1bmN0aW9uIChyZWdpb25SZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZSA9IHJlZ2lvblJlc3VsdC5yZWdpb24uZ2V0QWdyZWVtZW50c05lZWRlZEZvclN1cHBseUxpbmUoRmFjdGlvbklEcy5BRURVSSk7XG4gICAgICAgICAgICAgICAgaWYgKGFncmVlbWVudHNGb3JTdXBwbHlMaW5lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZWdpb25SZXN1bHQuaW5TdXBwbHlMaW5lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVnaW9uUmVzdWx0LmFncmVlbWVudHNOZWVkZWQgPSBhZ3JlZW1lbnRzRm9yU3VwcGx5TGluZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZWdpb25SZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVHJhZGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3RyYWRlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 149 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n     value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TradeResults = function TradeResults(definition) {\n     _classCallCheck(this, TradeResults);\n\n     this.region = definition.region;\n     this.totalAedui = definition.totalAedui;\n     this.totalAeduiWithRoman = definition.totalAeduiWithRoman;\n};\n\nexports.default = TradeResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FlZHVpL3RyYWRlUmVzdWx0cy5qcz9lZGQyIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFRyYWRlUmVzdWx0cyB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgIHRoaXMudG90YWxBZWR1aSA9IGRlZmluaXRpb24udG90YWxBZWR1aTtcbiAgICAgICAgIHRoaXMudG90YWxBZWR1aVdpdGhSb21hbiA9IGRlZmluaXRpb24udG90YWxBZWR1aVdpdGhSb21hbjtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRyYWRlUmVzdWx0cztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYWVkdWkvdHJhZGVSZXN1bHRzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 150 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _devastateRegion = __webpack_require__(92);\n\nvar _devastateRegion2 = _interopRequireDefault(_devastateRegion);\n\nvar _devastateResults = __webpack_require__(151);\n\nvar _devastateResults2 = _interopRequireDefault(_devastateResults);\n\nvar _losses = __webpack_require__(25);\n\nvar _losses2 = _interopRequireDefault(_losses);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Devastate = function (_Command) {\n    _inherits(Devastate, _Command);\n\n    function Devastate() {\n        _classCallCheck(this, Devastate);\n\n        return _possibleConstructorReturn(this, (Devastate.__proto__ || Object.getPrototypeOf(Devastate)).apply(this, arguments));\n    }\n\n    _createClass(Devastate, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            var leaderRegion = this.findLeaderRegion(state);\n            if (!leaderRegion) {\n                return false;\n            }\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            var isVercingetorix = leader && !leader.isSuccessor();\n            var validRegionIds = isVercingetorix ? (0, _lodash2.default)(leaderRegion.adjacent).concat([leaderRegion]).map('id').value() : [leaderRegion];\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var isValidRegion = _lodash2.default.indexOf(validRegionIds, region.id) >= 0;\n                var arverniControlled = region.controllingFactionId() === _factionIds2.default.ARVERNI;\n\n                if (region.devastated() || !isValidRegion || !arverniControlled) {\n                    return;\n                }\n\n                var removals = _this2.calculateRemovals(state, region);\n\n                return new _devastateResults2.default({\n                    region: region,\n                    removedArverni: removals[_factionIds2.default.ARVERNI].piecesToRemove,\n                    removedBelgae: removals[_factionIds2.default.BELGAE].piecesToRemove,\n                    removedAedui: removals[_factionIds2.default.AEDUI].piecesToRemove,\n                    removedRomans: removals[_factionIds2.default.ROMANS].piecesToRemove,\n                    removedGermanic: removals[_factionIds2.default.GERMANIC_TRIBES].piecesToRemove\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            var devastation = args.devastation;\n            console.log('*** Arverni Devastating region ' + devastation.region.name);\n            _devastateRegion2.default.execute(state, { regionId: devastation.region.id });\n\n            var removals = this.calculateRemovals(state, devastation.region);\n            _lodash2.default.each(removals, function (removalData, factionId) {\n                if (removalData.piecesToRemove.length > 0) {\n                    _removePieces2.default.execute(state, {\n                        regionId: devastation.region.id,\n                        factionId: factionId,\n                        pieces: removalData.piecesToRemove\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'calculateRemovals',\n        value: function calculateRemovals(state, region) {\n            return (0, _lodash2.default)(state.factions).map(function (faction) {\n                var mobilePieces = _lodash2.default.reject(region.getMobilePiecesForFaction(faction.id), { type: 'leader' });\n                var numPiecesToRemove = mobilePieces.length === 0 ? 0 : Math.floor(mobilePieces.length / (faction.id === _factionIds2.default.ARVERNI ? 4 : 3));\n                var piecesToRemove = _lodash2.default.take(_losses2.default.orderPiecesForRemoval(state, mobilePieces, false), numPiecesToRemove);\n                return {\n                    id: faction.id,\n                    piecesToRemove: piecesToRemove\n                };\n            }).keyBy('id').value();\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            });\n        }\n    }]);\n\n    return Devastate;\n}(_command2.default);\n\nexports.default = Devastate;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZGV2YXN0YXRlLmpzPzkwOGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZCBmcm9tICcuLi9jb21tYW5kJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uLy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBSZW1vdmVQaWVjZXMgZnJvbSAnLi4vLi4vYWN0aW9ucy9yZW1vdmVQaWVjZXMnO1xuaW1wb3J0IERldmFzdGF0ZVJlZ2lvbiBmcm9tICcuLi8uLi9hY3Rpb25zL2RldmFzdGF0ZVJlZ2lvbic7XG5pbXBvcnQgRGV2YXN0YXRlUmVzdWx0cyBmcm9tICcuL2RldmFzdGF0ZVJlc3VsdHMnO1xuaW1wb3J0IExvc3NlcyBmcm9tICdmYWxsaW5nc2t5L3V0aWwvbG9zc2VzJztcblxuY2xhc3MgRGV2YXN0YXRlIGV4dGVuZHMgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IGxlYWRlclJlZ2lvbiA9IHRoaXMuZmluZExlYWRlclJlZ2lvbihzdGF0ZSk7XG4gICAgICAgIGlmICghbGVhZGVyUmVnaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVhZGVyID0gbGVhZGVyUmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5BUlZFUk5JKTtcbiAgICAgICAgY29uc3QgaXNWZXJjaW5nZXRvcml4ID0gbGVhZGVyICYmICFsZWFkZXIuaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgY29uc3QgdmFsaWRSZWdpb25JZHMgPSBpc1ZlcmNpbmdldG9yaXggPyBfKGxlYWRlclJlZ2lvbi5hZGphY2VudCkuY29uY2F0KFtsZWFkZXJSZWdpb25dKS5tYXAoJ2lkJykudmFsdWUoKSA6IFtsZWFkZXJSZWdpb25dO1xuXG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkUmVnaW9uID0gXy5pbmRleE9mKHZhbGlkUmVnaW9uSWRzLCByZWdpb24uaWQpID49IDA7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJ2ZXJuaUNvbnRyb2xsZWQgPSByZWdpb24uY29udHJvbGxpbmdGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5BUlZFUk5JO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbi5kZXZhc3RhdGVkKCkgfHwgIWlzVmFsaWRSZWdpb24gfHwgIWFydmVybmlDb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZW1vdmFscyA9IHRoaXMuY2FsY3VsYXRlUmVtb3ZhbHMoc3RhdGUsIHJlZ2lvbik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERldmFzdGF0ZVJlc3VsdHMoXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWRBcnZlcm5pOiByZW1vdmFsc1tGYWN0aW9uSURzLkFSVkVSTkldLnBpZWNlc1RvUmVtb3ZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZEJlbGdhZTogcmVtb3ZhbHNbRmFjdGlvbklEcy5CRUxHQUVdLnBpZWNlc1RvUmVtb3ZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZEFlZHVpOiByZW1vdmFsc1tGYWN0aW9uSURzLkFFRFVJXS5waWVjZXNUb1JlbW92ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWRSb21hbnM6IHJlbW92YWxzW0ZhY3Rpb25JRHMuUk9NQU5TXS5waWVjZXNUb1JlbW92ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWRHZXJtYW5pYzogcmVtb3ZhbHNbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdLnBpZWNlc1RvUmVtb3ZlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvRXhlY3V0ZShzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBkZXZhc3RhdGlvbiA9IGFyZ3MuZGV2YXN0YXRpb247XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogQXJ2ZXJuaSBEZXZhc3RhdGluZyByZWdpb24gJyArIGRldmFzdGF0aW9uLnJlZ2lvbi5uYW1lKTtcbiAgICAgICAgRGV2YXN0YXRlUmVnaW9uLmV4ZWN1dGUoc3RhdGUsIHsgcmVnaW9uSWQ6IGRldmFzdGF0aW9uLnJlZ2lvbi5pZCB9KTtcblxuICAgICAgICBjb25zdCByZW1vdmFscyA9IHRoaXMuY2FsY3VsYXRlUmVtb3ZhbHMoc3RhdGUsIGRldmFzdGF0aW9uLnJlZ2lvbik7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHJlbW92YWxzLCAocmVtb3ZhbERhdGEsIGZhY3Rpb25JZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmKHJlbW92YWxEYXRhLnBpZWNlc1RvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlUGllY2VzLmV4ZWN1dGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBkZXZhc3RhdGlvbi5yZWdpb24uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBmYWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiByZW1vdmFsRGF0YS5waWVjZXNUb1JlbW92ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGNhbGN1bGF0ZVJlbW92YWxzKHN0YXRlLCByZWdpb24pIHtcbiAgICAgICAgcmV0dXJuIF8oc3RhdGUuZmFjdGlvbnMpLm1hcChcbiAgICAgICAgICAgIChmYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9iaWxlUGllY2VzID0gXy5yZWplY3QocmVnaW9uLmdldE1vYmlsZVBpZWNlc0ZvckZhY3Rpb24oZmFjdGlvbi5pZCksIHt0eXBlOiAnbGVhZGVyJ30pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bVBpZWNlc1RvUmVtb3ZlID0gbW9iaWxlUGllY2VzLmxlbmd0aCA9PT0gMCA/IDAgOiBNYXRoLmZsb29yKG1vYmlsZVBpZWNlcy5sZW5ndGggLyAoZmFjdGlvbi5pZCA9PT0gRmFjdGlvbklEcy5BUlZFUk5JID8gNCA6IDMpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwaWVjZXNUb1JlbW92ZSA9IF8udGFrZShMb3NzZXMub3JkZXJQaWVjZXNGb3JSZW1vdmFsKHN0YXRlLCBtb2JpbGVQaWVjZXMsIGZhbHNlKSwgbnVtUGllY2VzVG9SZW1vdmUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBmYWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICBwaWVjZXNUb1JlbW92ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmtleUJ5KCdpZCcpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGZpbmRMZWFkZXJSZWdpb24oc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZChcbiAgICAgICAgICAgIHN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5BUlZFUk5JKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBEZXZhc3RhdGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZGV2YXN0YXRlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 151 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DevastateResults = function DevastateResults(definition) {\n    _classCallCheck(this, DevastateResults);\n\n    this.region = definition.region;\n    this.removedArverni = definition.removedArverni;\n    this.removedBelgae = definition.removedBelgae;\n    this.removedAedui = definition.removedAedui;\n    this.removedRomans = definition.removedRomans;\n    this.removedGermanic = definition.removedGermanic;\n};\n\nexports.default = DevastateResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZGV2YXN0YXRlUmVzdWx0cy5qcz8zN2MyIl0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgRGV2YXN0YXRlUmVzdWx0cyB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IGRlZmluaXRpb24ucmVnaW9uO1xuICAgICAgICB0aGlzLnJlbW92ZWRBcnZlcm5pID0gZGVmaW5pdGlvbi5yZW1vdmVkQXJ2ZXJuaTtcbiAgICAgICAgdGhpcy5yZW1vdmVkQmVsZ2FlID0gZGVmaW5pdGlvbi5yZW1vdmVkQmVsZ2FlO1xuICAgICAgICB0aGlzLnJlbW92ZWRBZWR1aSA9IGRlZmluaXRpb24ucmVtb3ZlZEFlZHVpO1xuICAgICAgICB0aGlzLnJlbW92ZWRSb21hbnMgPSBkZWZpbml0aW9uLnJlbW92ZWRSb21hbnM7XG4gICAgICAgIHRoaXMucmVtb3ZlZEdlcm1hbmljID0gZGVmaW5pdGlvbi5yZW1vdmVkR2VybWFuaWM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBEZXZhc3RhdGVSZXN1bHRzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9hcnZlcm5pL2RldmFzdGF0ZVJlc3VsdHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 152 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _removePieces = __webpack_require__(8);\n\nvar _removePieces2 = _interopRequireDefault(_removePieces);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _entreatResults = __webpack_require__(153);\n\nvar _entreatResults2 = _interopRequireDefault(_entreatResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Entreat = function (_Command) {\n    _inherits(Entreat, _Command);\n\n    function Entreat() {\n        _classCallCheck(this, Entreat);\n\n        return _possibleConstructorReturn(this, (Entreat.__proto__ || Object.getPrototypeOf(Entreat)).apply(this, arguments));\n    }\n\n    _createClass(Entreat, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            var leaderRegion = this.findLeaderRegion(state);\n            if (!leaderRegion) {\n                return false;\n            }\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            var isVercingetorix = leader && !leader.isSuccessor();\n            var validRegionIds = isVercingetorix ? (0, _lodash2.default)(leaderRegion.adjacent).concat([leaderRegion]).map('id').value() : [leaderRegion];\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var isValidRegion = _lodash2.default.indexOf(validRegionIds, region.id) >= 0;\n                var hiddenArverni = region.getHiddenPiecesForFaction(_factionIds2.default.ARVERNI).length > 0;\n\n                if (!isValidRegion || !hiddenArverni) {\n                    return;\n                }\n\n                var _calculateEffects = _this2.calculateEffects(region),\n                    replaceableAllyFactions = _calculateEffects.replaceableAllyFactions,\n                    replaceableMobileFactions = _calculateEffects.replaceableMobileFactions;\n\n                if (replaceableAllyFactions.length === 0 && replaceableMobileFactions.length === 0) {\n                    return;\n                }\n\n                return new _entreatResults2.default({\n                    cost: 1,\n                    region: region,\n                    replaceableAllyFactions: replaceableAllyFactions,\n                    replaceableMobileFactions: replaceableMobileFactions\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'doExecute',\n        value: function doExecute(state, args) {\n            var arverni = state.arverni;\n            var entreat = args.entreat;\n            console.log('*** Arverni Entreating region ' + entreat.region.name);\n\n            if (entreat.allyToReplace) {\n                var tribeId = entreat.allyToReplace.tribeId;\n                _removePieces2.default.execute(state, {\n                    regionId: entreat.region.id,\n                    factionId: entreat.allyToReplace.factionId,\n                    pieces: [entreat.allyToReplace]\n                });\n\n                if (arverni.availableAlliedTribes().length > 0) {\n                    _placeAlliedTribe2.default.execute(state, {\n                        regionId: entreat.region.id,\n                        factionId: arverni.id,\n                        tribeId: tribeId\n                    });\n                }\n            }\n\n            if (entreat.mobileToReplace) {\n                _removePieces2.default.execute(state, {\n                    regionId: entreat.region.id,\n                    factionId: entreat.mobileToReplace.factionId,\n                    pieces: [entreat.mobileToReplace]\n                });\n\n                if (arverni.availableWarbands().length > 0) {\n                    _placeWarbands2.default.execute(state, {\n                        regionId: entreat.region.id,\n                        factionId: arverni.id,\n                        count: 1\n                    });\n                }\n            }\n        }\n    }, {\n        key: 'calculateEffects',\n        value: function calculateEffects(region) {\n            var arverniControlled = region.controllingFactionId() === _factionIds2.default.ARVERNI;\n            var replaceableAllyFactions = arverniControlled ? (0, _lodash2.default)(region.pieces()).filter({ type: 'alliedtribe' }).reject({ factionId: _factionIds2.default.ROMANS }).reject({ factionId: _factionIds2.default.ARVERNI }).map('factionId').uniq().value() : [];\n            var replaceableMobileFactions = (0, _lodash2.default)(region.pieces()).filter(function (piece) {\n                return piece.type === 'warband' || piece.type === 'auxilia';\n            }).map('factionId').reject({ factionId: _factionIds2.default.ARVERNI }).uniq().value();\n            return {\n                replaceableAllyFactions: replaceableAllyFactions,\n                replaceableMobileFactions: replaceableMobileFactions\n            };\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return region.getLeaderForFaction(_factionIds2.default.ARVERNI);\n            });\n        }\n    }]);\n\n    return Entreat;\n}(_command2.default);\n\nexports.default = Entreat;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZW50cmVhdC5qcz9hNGE4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi8uLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgUmVtb3ZlUGllY2VzIGZyb20gJy4uLy4uL2FjdGlvbnMvcmVtb3ZlUGllY2VzJztcbmltcG9ydCBQbGFjZUFsbGllZFRyaWJlIGZyb20gJy4uLy4uL2FjdGlvbnMvcGxhY2VBbGxpZWRUcmliZSc7XG5pbXBvcnQgUGxhY2VXYXJiYW5kcyBmcm9tICcuLi8uLi9hY3Rpb25zL3BsYWNlV2FyYmFuZHMnO1xuaW1wb3J0IEVudHJlYXRSZXN1bHRzIGZyb20gJy4vZW50cmVhdFJlc3VsdHMnO1xuXG5jbGFzcyBFbnRyZWF0IGV4dGVuZHMgQ29tbWFuZCB7XG5cbiAgICBzdGF0aWMgZG9UZXN0KHN0YXRlLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IGxlYWRlclJlZ2lvbiA9IHRoaXMuZmluZExlYWRlclJlZ2lvbihzdGF0ZSk7XG4gICAgICAgIGlmICghbGVhZGVyUmVnaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVhZGVyID0gbGVhZGVyUmVnaW9uLmdldExlYWRlckZvckZhY3Rpb24oRmFjdGlvbklEcy5BUlZFUk5JKTtcbiAgICAgICAgY29uc3QgaXNWZXJjaW5nZXRvcml4ID0gbGVhZGVyICYmICFsZWFkZXIuaXNTdWNjZXNzb3IoKTtcbiAgICAgICAgY29uc3QgdmFsaWRSZWdpb25JZHMgPSBpc1ZlcmNpbmdldG9yaXggPyBfKGxlYWRlclJlZ2lvbi5hZGphY2VudCkuY29uY2F0KFtsZWFkZXJSZWdpb25dKS5tYXAoJ2lkJykudmFsdWUoKSA6IFtsZWFkZXJSZWdpb25dO1xuXG4gICAgICAgIHJldHVybiBfKHN0YXRlLnJlZ2lvbnMpLm1hcChcbiAgICAgICAgICAgIChyZWdpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkUmVnaW9uID0gXy5pbmRleE9mKHZhbGlkUmVnaW9uSWRzLCByZWdpb24uaWQpID49IDA7XG4gICAgICAgICAgICAgICAgY29uc3QgaGlkZGVuQXJ2ZXJuaSA9IHJlZ2lvbi5nZXRIaWRkZW5QaWVjZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSkubGVuZ3RoID4gMDtcblxuICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZFJlZ2lvbiB8fCAhaGlkZGVuQXJ2ZXJuaSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgeyByZXBsYWNlYWJsZUFsbHlGYWN0aW9ucywgcmVwbGFjZWFibGVNb2JpbGVGYWN0aW9ucyB9ID0gdGhpcy5jYWxjdWxhdGVFZmZlY3RzKHJlZ2lvbik7XG5cbiAgICAgICAgICAgICAgICBpZihyZXBsYWNlYWJsZUFsbHlGYWN0aW9ucy5sZW5ndGggPT09IDAgJiYgcmVwbGFjZWFibGVNb2JpbGVGYWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRW50cmVhdFJlc3VsdHMoXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc3Q6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlYWJsZUFsbHlGYWN0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VhYmxlTW9iaWxlRmFjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvRXhlY3V0ZShzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBhcnZlcm5pID0gc3RhdGUuYXJ2ZXJuaTtcbiAgICAgICAgY29uc3QgZW50cmVhdCA9IGFyZ3MuZW50cmVhdDtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBBcnZlcm5pIEVudHJlYXRpbmcgcmVnaW9uICcgKyBlbnRyZWF0LnJlZ2lvbi5uYW1lKTtcblxuICAgICAgICBpZihlbnRyZWF0LmFsbHlUb1JlcGxhY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyaWJlSWQgPSBlbnRyZWF0LmFsbHlUb1JlcGxhY2UudHJpYmVJZDtcbiAgICAgICAgICAgIFJlbW92ZVBpZWNlcy5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IGVudHJlYXQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBlbnRyZWF0LmFsbHlUb1JlcGxhY2UuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBbZW50cmVhdC5hbGx5VG9SZXBsYWNlXVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYoYXJ2ZXJuaS5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IGVudHJlYXQucmVnaW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiBhcnZlcm5pLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpYmVJZDogdHJpYmVJZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGVudHJlYXQubW9iaWxlVG9SZXBsYWNlKSB7XG4gICAgICAgICAgICBSZW1vdmVQaWVjZXMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBlbnRyZWF0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogZW50cmVhdC5tb2JpbGVUb1JlcGxhY2UuZmFjdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VzOiBbZW50cmVhdC5tb2JpbGVUb1JlcGxhY2VdXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihhcnZlcm5pLmF2YWlsYWJsZVdhcmJhbmRzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIFBsYWNlV2FyYmFuZHMuZXhlY3V0ZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbklkOiBlbnRyZWF0LnJlZ2lvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogYXJ2ZXJuaS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGNhbGN1bGF0ZUVmZmVjdHMocmVnaW9uKSB7XG4gICAgICAgIGNvbnN0IGFydmVybmlDb250cm9sbGVkID0gcmVnaW9uLmNvbnRyb2xsaW5nRmFjdGlvbklkKCkgPT09IEZhY3Rpb25JRHMuQVJWRVJOSTtcbiAgICAgICAgY29uc3QgcmVwbGFjZWFibGVBbGx5RmFjdGlvbnMgPSBhcnZlcm5pQ29udHJvbGxlZCA/IF8ocmVnaW9uLnBpZWNlcygpKS5maWx0ZXIoe3R5cGUgOiAnYWxsaWVkdHJpYmUnfSkucmVqZWN0KHtmYWN0aW9uSWQgOiBGYWN0aW9uSURzLlJPTUFOU30pLnJlamVjdCh7ZmFjdGlvbklkIDogRmFjdGlvbklEcy5BUlZFUk5JfSkubWFwKCdmYWN0aW9uSWQnKS51bmlxKCkudmFsdWUoKSA6IFtdO1xuICAgICAgICBjb25zdCByZXBsYWNlYWJsZU1vYmlsZUZhY3Rpb25zID0gXyhyZWdpb24ucGllY2VzKCkpLmZpbHRlcihwaWVjZT0+KHBpZWNlLnR5cGUgPT09ICd3YXJiYW5kJyB8fCBwaWVjZS50eXBlID09PSAnYXV4aWxpYScpKS5tYXAoJ2ZhY3Rpb25JZCcpLnJlamVjdCh7ZmFjdGlvbklkIDogRmFjdGlvbklEcy5BUlZFUk5JfSkudW5pcSgpLnZhbHVlKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXBsYWNlYWJsZUFsbHlGYWN0aW9ucyxcbiAgICAgICAgICAgIHJlcGxhY2VhYmxlTW9iaWxlRmFjdGlvbnNcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kTGVhZGVyUmVnaW9uKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfLmZpbmQoXG4gICAgICAgICAgICBzdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQVJWRVJOSSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRW50cmVhdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYXJ2ZXJuaS9lbnRyZWF0LmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQUFBO0FBQUE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBSUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 153 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EntreatResults = function EntreatResults(definition) {\n    _classCallCheck(this, EntreatResults);\n\n    this.cost = definition.cost;\n    this.region = definition.region;\n    this.replaceableAllyFactions = definition.replaceableAllyFactions;\n    this.replaceableMobileFactions = definition.replaceableMobileFactions;\n    this.canReplaceAlly = this.replaceableAllyFactions.length > 0;\n    this.canReplaceMobile = this.replaceableMobileFactions.length > 0;\n\n    this.allyToReplace = definition.allyToReplace;\n    this.mobileToReplace = definition.mobileToReplace;\n};\n\nexports.default = EntreatResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZW50cmVhdFJlc3VsdHMuanM/NjdhZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIEVudHJlYXRSZXN1bHRzIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMuY29zdCA9IGRlZmluaXRpb24uY29zdDtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5yZXBsYWNlYWJsZUFsbHlGYWN0aW9ucyA9IGRlZmluaXRpb24ucmVwbGFjZWFibGVBbGx5RmFjdGlvbnM7XG4gICAgICAgIHRoaXMucmVwbGFjZWFibGVNb2JpbGVGYWN0aW9ucyA9IGRlZmluaXRpb24ucmVwbGFjZWFibGVNb2JpbGVGYWN0aW9ucztcbiAgICAgICAgdGhpcy5jYW5SZXBsYWNlQWxseSA9IHRoaXMucmVwbGFjZWFibGVBbGx5RmFjdGlvbnMubGVuZ3RoID4gMDtcbiAgICAgICAgdGhpcy5jYW5SZXBsYWNlTW9iaWxlID0gdGhpcy5yZXBsYWNlYWJsZU1vYmlsZUZhY3Rpb25zLmxlbmd0aCA+IDA7XG5cbiAgICAgICAgdGhpcy5hbGx5VG9SZXBsYWNlID0gZGVmaW5pdGlvbi5hbGx5VG9SZXBsYWNlO1xuICAgICAgICB0aGlzLm1vYmlsZVRvUmVwbGFjZSA9IGRlZmluaXRpb24ubW9iaWxlVG9SZXBsYWNlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRW50cmVhdFJlc3VsdHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2FydmVybmkvZW50cmVhdFJlc3VsdHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 154 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BattleResults = function () {\n    function BattleResults(definition) {\n        _classCallCheck(this, BattleResults);\n\n        this.region = definition.region;\n        this.cost = definition.cost;\n\n        this.attackingFaction = definition.attackingFaction;\n        this.defendingFaction = definition.defendingFaction;\n        this.attackingPieces = definition.attackingPieces;\n        this.defendingPieces = definition.defendingPieces;\n\n        this.canAmbush = definition.canAmbush;\n        this.canEnlistGermans = definition.canEnlistGermans;\n        this.defenderCanRetreat = definition.defenderCanRetreat;\n        this.defenderCanGuaranteeSafeRetreat = definition.defenderCanGuaranteeSafeRetreat;\n        this.defenderCanCounterattack = definition.defenderCanCounterattack;\n\n        this.defenderLosses = definition.defenderLosses;\n\n        this.worstCaseRetreatDefenderResults = definition.worstCaseRetreatDefenderResults;\n        this.worstCaseNoRetreatDefenderResults = definition.worstCaseNoRetreatDefenderResults;\n        this.worstCaseDefenderLosses = definition.worstCaseDefenderLosses;\n        this.worstCaseAttackerLosses = definition.worstCaseAttackerLosses;\n        this.worstCaseCounterattackResults = definition.worstCaseCounterattackResults;\n\n        this.willAmbush = definition.willAmbush;\n        this.willEnlistGermans = definition.willEnlistGermans;\n        this.willBesiege = definition.willBesiege;\n        this.willApplyGermanicHorse = definition.willApplyGermanicHorse;\n        this.willApplyBalearicSlingers = definition.willApplyBalearicSlingers;\n\n        this.paid = definition.paid;\n        this.handledBalearicSlingers = definition.handledBalearicSlingers;\n        this.handledMassedGallicArchers = definition.handledMassedGallicArchers;\n        this.willRetreat = definition.willRetreat;\n        this.retreated = definition.retreated;\n        this.besieged = definition.besieged;\n        this.calculatedDefenderResults = definition.calculatedDefenderResults;\n        this.committedDefenderResults = definition.committedDefenderResults;\n        this.complete = definition.complete;\n    }\n\n    _createClass(BattleResults, [{\n        key: 'mostDefenderLosses',\n        value: function mostDefenderLosses() {\n            return this.defenderCanGuaranteeSafeRetreat && !this.canAmbush ? this.defenderLosses.retreat : this.defenderLosses.normal;\n        }\n    }, {\n        key: 'willCauseLeaderRemoval',\n        value: function willCauseLeaderRemoval() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willCauseRemovalOfPieceOfType('leader', ambush);\n        }\n    }, {\n        key: 'willCauseAllyRemoval',\n        value: function willCauseAllyRemoval() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willCauseRemovalOfPieceOfType('alliedtribe', ambush);\n        }\n    }, {\n        key: 'willCauseCitadelRemoval',\n        value: function willCauseCitadelRemoval() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willCauseRemovalOfPieceOfType('citadel', ambush);\n        }\n    }, {\n        key: 'willCauseLegionRemoval',\n        value: function willCauseLegionRemoval() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willCauseRemovalOfPieceOfType('legion', ambush);\n        }\n    }, {\n        key: 'willCauseRemovalOfPieceOfType',\n        value: function willCauseRemovalOfPieceOfType(type, ambush) {\n            var foundWithoutRetreat = _lodash2.default.find(this.worstCaseNoRetreatDefenderResults.ambush.targets, { type: type });\n            var foundWithRetreat = true;\n            if (!ambush && this.defenderCanRetreat) {\n                foundWithRetreat = _lodash2.default.find(this.worstCaseRetreatDefenderResults.targets, { type: type });\n            }\n            return foundWithoutRetreat && foundWithRetreat;\n        }\n    }, {\n        key: 'willInflictLossAgainstLeader',\n        value: function willInflictLossAgainstLeader() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willInflictLossAgainstPieceOfType('leader', ambush);\n        }\n    }, {\n        key: 'willInflictLossAgainstAlly',\n        value: function willInflictLossAgainstAlly() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willInflictLossAgainstPieceOfType('alliedtribe', ambush);\n        }\n    }, {\n        key: 'willInflictLossAgainstCitadel',\n        value: function willInflictLossAgainstCitadel() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willInflictLossAgainstPieceOfType('citadel', ambush);\n        }\n    }, {\n        key: 'willInflictLossAgainstLegion',\n        value: function willInflictLossAgainstLegion() {\n            var ambush = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            return this.willInflictLossAgainstPieceOfType('legion', ambush);\n        }\n    }, {\n        key: 'willInflictCounterattackLossAgainstLegion',\n        value: function willInflictCounterattackLossAgainstLegion() {\n            return this.willInflictLossAgainstPieceOfType('legion', false, true);\n        }\n    }, {\n        key: 'willInflictLossAgainstPieceOfType',\n        value: function willInflictLossAgainstPieceOfType(type, ambush) {\n            var counterattack = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n            // Make this more clever\n            var inflictedLoss = true;\n            var pieces = counterattack ? this.attackingPieces : this.defendingPieces;\n            var normalOrderedLossTargets = (0, _lodash2.default)(pieces).sortBy(function (piece) {\n                var prefix = void 0;\n\n                if (piece.type === 'alliedtribe' || piece.type === 'fort' || piece.type === 'citadel') {\n                    prefix = 'b';\n                } else {\n                    prefix = 'a';\n                }\n\n                return prefix + (piece.type === type ? 2 : 1);\n            }).take(counterattack ? this.worstCaseAttackerLosses.normal : this.defenderLosses.normal).value();\n\n            inflictedLoss = inflictedLoss && !_lodash2.default.isUndefined(_lodash2.default.find(normalOrderedLossTargets, { type: type }));\n\n            if (this.defenderCanRetreat && !counterattack && !ambush) {\n                var retreatOrderedLossTargets = (0, _lodash2.default)(pieces).sortBy(function (piece) {\n                    var prefix = void 0;\n\n                    if (piece.type === 'alliedtribe' || piece.type === 'fort' || piece.type === 'citadel') {\n                        prefix = 'a';\n                    } else {\n                        prefix = 'b';\n                    }\n\n                    return prefix + (piece.type === type ? 2 : 1);\n                }).take(this.defenderLosses.retreat).value();\n                inflictedLoss = inflictedLoss && !_lodash2.default.isUndefined(_lodash2.default.find(retreatOrderedLossTargets, { type: type }));\n            }\n\n            return inflictedLoss;\n        }\n    }, {\n        key: 'getNumLossesAgainstPiecesOfType',\n        value: function getNumLossesAgainstPiecesOfType(type) {\n            var ambush = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n            var rollsFail = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n            var normalResults = this.calcNumLossesAgainstPiecesOfType(type, ambush, false, rollsFail);\n            var worstResults = normalResults;\n            if (normalResults.length > 0 && this.defenderCanRetreat && !ambush) {\n                var retreatResults = this.calcNumLossesAgainstPiecesOfType(type, false, true, rollsFail);\n                if (retreatResults[0].numLosses < normalResults[0].numLosses) {\n                    worstResults = retreatResults;\n                }\n            }\n\n            return worstResults;\n        }\n    }, {\n        key: 'calcNumLossesAgainstPiecesOfType',\n        value: function calcNumLossesAgainstPiecesOfType(type) {\n            var ambush = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n            var _this = this;\n\n            var retreat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n            var rollsFail = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n            var leader = _lodash2.default.find(this.defendingPieces, { type: 'leader' });\n            var hasCaesar = leader && leader.factionId === _factionIds2.default.ROMANS && !leader.isSuccessor();\n\n            var normalOrderedLossTargets = (0, _lodash2.default)(this.defendingPieces).sortBy(function (piece) {\n                var prefix = void 0;\n\n                if (piece.type === 'alliedtribe' || piece.type === 'fort' || piece.type === 'citadel') {\n                    prefix = retreat ? 'a' : 'b';\n                } else {\n                    prefix = retreat ? 'b' : 'a';\n                }\n\n                return prefix + (piece.type === type ? 2 : 1);\n            }).take(retreat ? this.defenderLosses.retreat : this.defenderLosses.normal).value();\n\n            var index = _lodash2.default.findIndex(normalOrderedLossTargets, { type: type });\n\n            var noLosses = false;\n            var noLossesAfterFirst = false;\n\n            if (!rollsFail && (!ambush || hasCaesar)) {\n                if (index > 0) {\n                    var earlierPieces = _lodash2.default.take(normalOrderedLossTargets, index);\n                    if (_lodash2.default.find(earlierPieces, { canRoll: true })) {\n                        noLosses = true;\n                    }\n                }\n\n                if (index === 0 && normalOrderedLossTargets[0].canRoll) {\n                    noLossesAfterFirst = true;\n                }\n            }\n\n            return (0, _lodash2.default)(this.defendingPieces).map(function (piece, pieceIndex) {\n                if (piece.type !== type) {\n                    return;\n                }\n\n                var numLosses = pieceIndex < (retreat ? _this.defenderLosses.retreat : _this.defenderLosses.normal) ? 1 : 0;\n                if (noLosses) {\n                    numLosses = 0;\n                } else if (noLossesAfterFirst && pieceIndex > index) {\n                    numLosses = 0;\n                } else if (noLossesAfterFirst && pieceIndex === index) {\n                    numLosses = _this.defenderLosses.normal - pieceIndex;\n                }\n\n                return {\n                    piece: piece,\n                    numLosses: numLosses\n                };\n            }).compact().value();\n        }\n    }, {\n        key: 'logResults',\n        value: function logResults() {\n            console.log('*** Battle - ' + this.attackingFaction.name + ' attacks ' + this.defendingFaction.name + ' in region ' + this.region.name);\n            console.log('    *** Normal Possibilities ***');\n            console.log('    With retreat ' + this.defendingFaction.name + ' will lose the following ' + this.worstCaseRetreatDefenderResults.targets.length + ' pieces');\n            _logging2.default.logPieces(this.worstCaseRetreatDefenderResults.targets);\n            console.log('    Without retreat ' + this.defendingFaction.name + ' will lose the following ' + this.worstCaseNoRetreatDefenderResults.normal.targets.length + ' pieces');\n            _logging2.default.logPieces(this.worstCaseNoRetreatDefenderResults.normal.targets);\n            console.log('    If counterattacked ' + this.attackingFaction.name + ' will lose the following ' + this.worstCaseAttackerLosses.normal + ' pieces');\n            _logging2.default.logPieces(this.worstCaseCounterattackResults.normal.targets);\n            if (this.canAmbush) {\n                console.log('    *** Ambush Possibilities ***');\n                console.log('    ' + this.defendingFaction.name + ' will lose the following ' + this.worstCaseNoRetreatDefenderResults.ambush.targets.length + ' pieces');\n                _logging2.default.logPieces(this.worstCaseNoRetreatDefenderResults.ambush.targets);\n                console.log('    If counterattacked ' + this.attackingFaction.name + ' will lose the following ' + this.worstCaseAttackerLosses.ambush + ' pieces');\n                _logging2.default.logPieces(this.worstCaseCounterattackResults.ambush.targets);\n            }\n        }\n    }]);\n\n    return BattleResults;\n}();\n\nexports.default = BattleResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2JhdHRsZVJlc3VsdHMuanM/OTQzMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25JZHMnXG5pbXBvcnQgTG9nZ2luZyBmcm9tICcuLi91dGlsL2xvZ2dpbmcnO1xuXG5jbGFzcyBCYXR0bGVSZXN1bHRzIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMucmVnaW9uID0gZGVmaW5pdGlvbi5yZWdpb247XG4gICAgICAgIHRoaXMuY29zdCA9IGRlZmluaXRpb24uY29zdDtcblxuICAgICAgICB0aGlzLmF0dGFja2luZ0ZhY3Rpb24gPSBkZWZpbml0aW9uLmF0dGFja2luZ0ZhY3Rpb247XG4gICAgICAgIHRoaXMuZGVmZW5kaW5nRmFjdGlvbiA9IGRlZmluaXRpb24uZGVmZW5kaW5nRmFjdGlvbjtcbiAgICAgICAgdGhpcy5hdHRhY2tpbmdQaWVjZXMgPSBkZWZpbml0aW9uLmF0dGFja2luZ1BpZWNlcztcbiAgICAgICAgdGhpcy5kZWZlbmRpbmdQaWVjZXMgPSBkZWZpbml0aW9uLmRlZmVuZGluZ1BpZWNlcztcblxuICAgICAgICB0aGlzLmNhbkFtYnVzaCA9IGRlZmluaXRpb24uY2FuQW1idXNoO1xuICAgICAgICB0aGlzLmNhbkVubGlzdEdlcm1hbnMgPSBkZWZpbml0aW9uLmNhbkVubGlzdEdlcm1hbnM7XG4gICAgICAgIHRoaXMuZGVmZW5kZXJDYW5SZXRyZWF0ID0gZGVmaW5pdGlvbi5kZWZlbmRlckNhblJldHJlYXQ7XG4gICAgICAgIHRoaXMuZGVmZW5kZXJDYW5HdWFyYW50ZWVTYWZlUmV0cmVhdCA9IGRlZmluaXRpb24uZGVmZW5kZXJDYW5HdWFyYW50ZWVTYWZlUmV0cmVhdDtcbiAgICAgICAgdGhpcy5kZWZlbmRlckNhbkNvdW50ZXJhdHRhY2sgPSBkZWZpbml0aW9uLmRlZmVuZGVyQ2FuQ291bnRlcmF0dGFjaztcblxuICAgICAgICB0aGlzLmRlZmVuZGVyTG9zc2VzID0gZGVmaW5pdGlvbi5kZWZlbmRlckxvc3NlcztcblxuICAgICAgICB0aGlzLndvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHMgPSBkZWZpbml0aW9uLndvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHM7XG4gICAgICAgIHRoaXMud29yc3RDYXNlTm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzID0gZGVmaW5pdGlvbi53b3JzdENhc2VOb1JldHJlYXREZWZlbmRlclJlc3VsdHM7XG4gICAgICAgIHRoaXMud29yc3RDYXNlRGVmZW5kZXJMb3NzZXMgPSBkZWZpbml0aW9uLndvcnN0Q2FzZURlZmVuZGVyTG9zc2VzO1xuICAgICAgICB0aGlzLndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzID0gZGVmaW5pdGlvbi53b3JzdENhc2VBdHRhY2tlckxvc3NlcztcbiAgICAgICAgdGhpcy53b3JzdENhc2VDb3VudGVyYXR0YWNrUmVzdWx0cyA9IGRlZmluaXRpb24ud29yc3RDYXNlQ291bnRlcmF0dGFja1Jlc3VsdHM7XG5cbiAgICAgICAgdGhpcy53aWxsQW1idXNoID0gZGVmaW5pdGlvbi53aWxsQW1idXNoO1xuICAgICAgICB0aGlzLndpbGxFbmxpc3RHZXJtYW5zID0gZGVmaW5pdGlvbi53aWxsRW5saXN0R2VybWFucztcbiAgICAgICAgdGhpcy53aWxsQmVzaWVnZSA9IGRlZmluaXRpb24ud2lsbEJlc2llZ2U7XG4gICAgICAgIHRoaXMud2lsbEFwcGx5R2VybWFuaWNIb3JzZSA9IGRlZmluaXRpb24ud2lsbEFwcGx5R2VybWFuaWNIb3JzZTtcbiAgICAgICAgdGhpcy53aWxsQXBwbHlCYWxlYXJpY1NsaW5nZXJzID0gZGVmaW5pdGlvbi53aWxsQXBwbHlCYWxlYXJpY1NsaW5nZXJzO1xuXG4gICAgICAgIHRoaXMucGFpZCA9IGRlZmluaXRpb24ucGFpZDtcbiAgICAgICAgdGhpcy5oYW5kbGVkQmFsZWFyaWNTbGluZ2VycyA9IGRlZmluaXRpb24uaGFuZGxlZEJhbGVhcmljU2xpbmdlcnM7XG4gICAgICAgIHRoaXMuaGFuZGxlZE1hc3NlZEdhbGxpY0FyY2hlcnMgPSBkZWZpbml0aW9uLmhhbmRsZWRNYXNzZWRHYWxsaWNBcmNoZXJzO1xuICAgICAgICB0aGlzLndpbGxSZXRyZWF0ID0gZGVmaW5pdGlvbi53aWxsUmV0cmVhdDtcbiAgICAgICAgdGhpcy5yZXRyZWF0ZWQgPSBkZWZpbml0aW9uLnJldHJlYXRlZDtcbiAgICAgICAgdGhpcy5iZXNpZWdlZCA9IGRlZmluaXRpb24uYmVzaWVnZWQ7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlZERlZmVuZGVyUmVzdWx0cyA9IGRlZmluaXRpb24uY2FsY3VsYXRlZERlZmVuZGVyUmVzdWx0cztcbiAgICAgICAgdGhpcy5jb21taXR0ZWREZWZlbmRlclJlc3VsdHMgPSBkZWZpbml0aW9uLmNvbW1pdHRlZERlZmVuZGVyUmVzdWx0cztcbiAgICAgICAgdGhpcy5jb21wbGV0ZSA9IGRlZmluaXRpb24uY29tcGxldGU7XG4gICAgfVxuXG4gICAgbW9zdERlZmVuZGVyTG9zc2VzKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuZGVmZW5kZXJDYW5HdWFyYW50ZWVTYWZlUmV0cmVhdCAmJiAhdGhpcy5jYW5BbWJ1c2gpID8gdGhpcy5kZWZlbmRlckxvc3Nlcy5yZXRyZWF0IDogdGhpcy5kZWZlbmRlckxvc3Nlcy5ub3JtYWw7XG4gICAgfVxuXG4gICAgd2lsbENhdXNlTGVhZGVyUmVtb3ZhbChhbWJ1c2ggPSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53aWxsQ2F1c2VSZW1vdmFsT2ZQaWVjZU9mVHlwZSgnbGVhZGVyJywgYW1idXNoKTtcbiAgICB9XG5cbiAgICB3aWxsQ2F1c2VBbGx5UmVtb3ZhbChhbWJ1c2ggPSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53aWxsQ2F1c2VSZW1vdmFsT2ZQaWVjZU9mVHlwZSgnYWxsaWVkdHJpYmUnLCBhbWJ1c2gpO1xuICAgIH1cblxuICAgIHdpbGxDYXVzZUNpdGFkZWxSZW1vdmFsKGFtYnVzaCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndpbGxDYXVzZVJlbW92YWxPZlBpZWNlT2ZUeXBlKCdjaXRhZGVsJywgYW1idXNoKTtcbiAgICB9XG5cbiAgICB3aWxsQ2F1c2VMZWdpb25SZW1vdmFsKGFtYnVzaCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndpbGxDYXVzZVJlbW92YWxPZlBpZWNlT2ZUeXBlKCdsZWdpb24nLCBhbWJ1c2gpO1xuICAgIH1cblxuICAgIHdpbGxDYXVzZVJlbW92YWxPZlBpZWNlT2ZUeXBlKHR5cGUsIGFtYnVzaCkge1xuICAgICAgICBjb25zdCBmb3VuZFdpdGhvdXRSZXRyZWF0ID0gXy5maW5kKHRoaXMud29yc3RDYXNlTm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzLmFtYnVzaC50YXJnZXRzLCB7dHlwZTogdHlwZX0pO1xuICAgICAgICBsZXQgZm91bmRXaXRoUmV0cmVhdCA9IHRydWU7XG4gICAgICAgIGlmICghYW1idXNoICYmIHRoaXMuZGVmZW5kZXJDYW5SZXRyZWF0KSB7XG4gICAgICAgICAgICBmb3VuZFdpdGhSZXRyZWF0ID0gXy5maW5kKHRoaXMud29yc3RDYXNlUmV0cmVhdERlZmVuZGVyUmVzdWx0cy50YXJnZXRzLCB7dHlwZTogdHlwZX0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmb3VuZFdpdGhvdXRSZXRyZWF0ICYmIGZvdW5kV2l0aFJldHJlYXQ7XG4gICAgfVxuXG4gICAgd2lsbEluZmxpY3RMb3NzQWdhaW5zdExlYWRlcihhbWJ1c2ggPSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53aWxsSW5mbGljdExvc3NBZ2FpbnN0UGllY2VPZlR5cGUoJ2xlYWRlcicsIGFtYnVzaCk7XG4gICAgfVxuXG4gICAgd2lsbEluZmxpY3RMb3NzQWdhaW5zdEFsbHkoYW1idXNoID0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lsbEluZmxpY3RMb3NzQWdhaW5zdFBpZWNlT2ZUeXBlKCdhbGxpZWR0cmliZScsIGFtYnVzaCk7XG4gICAgfVxuXG4gICAgd2lsbEluZmxpY3RMb3NzQWdhaW5zdENpdGFkZWwoYW1idXNoID0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lsbEluZmxpY3RMb3NzQWdhaW5zdFBpZWNlT2ZUeXBlKCdjaXRhZGVsJywgYW1idXNoKTtcbiAgICB9XG5cbiAgICB3aWxsSW5mbGljdExvc3NBZ2FpbnN0TGVnaW9uKGFtYnVzaCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndpbGxJbmZsaWN0TG9zc0FnYWluc3RQaWVjZU9mVHlwZSgnbGVnaW9uJywgYW1idXNoKTtcbiAgICB9XG5cbiAgICB3aWxsSW5mbGljdENvdW50ZXJhdHRhY2tMb3NzQWdhaW5zdExlZ2lvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lsbEluZmxpY3RMb3NzQWdhaW5zdFBpZWNlT2ZUeXBlKCdsZWdpb24nLCBmYWxzZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgd2lsbEluZmxpY3RMb3NzQWdhaW5zdFBpZWNlT2ZUeXBlKHR5cGUsIGFtYnVzaCwgY291bnRlcmF0dGFjayA9IGZhbHNlKSB7XG4gICAgICAgIC8vIE1ha2UgdGhpcyBtb3JlIGNsZXZlclxuICAgICAgICBsZXQgaW5mbGljdGVkTG9zcyA9IHRydWU7XG4gICAgICAgIGNvbnN0IHBpZWNlcyA9IGNvdW50ZXJhdHRhY2sgPyB0aGlzLmF0dGFja2luZ1BpZWNlcyA6IHRoaXMuZGVmZW5kaW5nUGllY2VzO1xuICAgICAgICBjb25zdCBub3JtYWxPcmRlcmVkTG9zc1RhcmdldHMgPSBfKHBpZWNlcykuc29ydEJ5KChwaWVjZSkgPT4ge1xuICAgICAgICAgICAgbGV0IHByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2ZvcnQnIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9ICdiJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9ICdhJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIChwaWVjZS50eXBlID09PSB0eXBlID8gMiA6IDEpO1xuICAgICAgICB9KS50YWtlKGNvdW50ZXJhdHRhY2sgPyB0aGlzLndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLm5vcm1hbCA6IHRoaXMuZGVmZW5kZXJMb3NzZXMubm9ybWFsKS52YWx1ZSgpO1xuXG4gICAgICAgIGluZmxpY3RlZExvc3MgPSBpbmZsaWN0ZWRMb3NzICYmICFfLmlzVW5kZWZpbmVkKF8uZmluZChub3JtYWxPcmRlcmVkTG9zc1RhcmdldHMsIHt0eXBlOiB0eXBlfSkpO1xuXG4gICAgICAgIGlmICh0aGlzLmRlZmVuZGVyQ2FuUmV0cmVhdCAmJiAhY291bnRlcmF0dGFjayAmJiAhYW1idXNoKSB7XG4gICAgICAgICAgICBjb25zdCByZXRyZWF0T3JkZXJlZExvc3NUYXJnZXRzID0gXyhwaWVjZXMpLnNvcnRCeSgocGllY2UpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJlZml4O1xuXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2ZvcnQnIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgICAgICBwcmVmaXggPSAnYSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcmVmaXggPSAnYic7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIChwaWVjZS50eXBlID09PSB0eXBlID8gMiA6IDEpO1xuICAgICAgICAgICAgfSkudGFrZSh0aGlzLmRlZmVuZGVyTG9zc2VzLnJldHJlYXQpLnZhbHVlKCk7XG4gICAgICAgICAgICBpbmZsaWN0ZWRMb3NzID0gaW5mbGljdGVkTG9zcyAmJiAhXy5pc1VuZGVmaW5lZChfLmZpbmQocmV0cmVhdE9yZGVyZWRMb3NzVGFyZ2V0cywge3R5cGU6IHR5cGV9KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW5mbGljdGVkTG9zcztcbiAgICB9XG5cbiAgICBnZXROdW1Mb3NzZXNBZ2FpbnN0UGllY2VzT2ZUeXBlKHR5cGUsIGFtYnVzaCA9IGZhbHNlLCByb2xsc0ZhaWwgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCBub3JtYWxSZXN1bHRzID0gdGhpcy5jYWxjTnVtTG9zc2VzQWdhaW5zdFBpZWNlc09mVHlwZSh0eXBlLCBhbWJ1c2gsIGZhbHNlLCByb2xsc0ZhaWwpO1xuICAgICAgICBsZXQgd29yc3RSZXN1bHRzID0gbm9ybWFsUmVzdWx0cztcbiAgICAgICAgaWYobm9ybWFsUmVzdWx0cy5sZW5ndGggPiAwICYmIHRoaXMuZGVmZW5kZXJDYW5SZXRyZWF0ICYmICFhbWJ1c2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHJldHJlYXRSZXN1bHRzID0gdGhpcy5jYWxjTnVtTG9zc2VzQWdhaW5zdFBpZWNlc09mVHlwZSh0eXBlLCBmYWxzZSwgdHJ1ZSwgcm9sbHNGYWlsKTtcbiAgICAgICAgICAgIGlmKHJldHJlYXRSZXN1bHRzWzBdLm51bUxvc3NlcyA8IG5vcm1hbFJlc3VsdHNbMF0ubnVtTG9zc2VzKSB7XG4gICAgICAgICAgICAgICAgd29yc3RSZXN1bHRzID0gcmV0cmVhdFJlc3VsdHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gd29yc3RSZXN1bHRzO1xuICAgIH1cblxuICAgIGNhbGNOdW1Mb3NzZXNBZ2FpbnN0UGllY2VzT2ZUeXBlKHR5cGUsIGFtYnVzaD1mYWxzZSwgcmV0cmVhdD1mYWxzZSwgcm9sbHNGYWlsID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgbGVhZGVyID0gXy5maW5kKHRoaXMuZGVmZW5kaW5nUGllY2VzLCB7dHlwZSA6ICdsZWFkZXInfSk7XG4gICAgICAgIGNvbnN0IGhhc0NhZXNhciA9IGxlYWRlciAmJiBsZWFkZXIuZmFjdGlvbklkID09PSBGYWN0aW9uSURzLlJPTUFOUyAmJiAhbGVhZGVyLmlzU3VjY2Vzc29yKCk7XG5cbiAgICAgICAgY29uc3Qgbm9ybWFsT3JkZXJlZExvc3NUYXJnZXRzID0gXyh0aGlzLmRlZmVuZGluZ1BpZWNlcykuc29ydEJ5KChwaWVjZSkgPT4ge1xuICAgICAgICAgICAgbGV0IHByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09ICdhbGxpZWR0cmliZScgfHwgcGllY2UudHlwZSA9PT0gJ2ZvcnQnIHx8IHBpZWNlLnR5cGUgPT09ICdjaXRhZGVsJykge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9IHJldHJlYXQgPyAnYScgOidiJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9IHJldHJlYXQgPyAnYicgOidhJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIChwaWVjZS50eXBlID09PSB0eXBlID8gMiA6IDEpO1xuICAgICAgICB9KS50YWtlKHJldHJlYXQgPyB0aGlzLmRlZmVuZGVyTG9zc2VzLnJldHJlYXQgOiB0aGlzLmRlZmVuZGVyTG9zc2VzLm5vcm1hbCkudmFsdWUoKTtcblxuICAgICAgICBjb25zdCBpbmRleCA9IF8uZmluZEluZGV4KG5vcm1hbE9yZGVyZWRMb3NzVGFyZ2V0cywge3R5cGU6dHlwZX0pO1xuXG4gICAgICAgIGxldCBub0xvc3NlcyA9IGZhbHNlO1xuICAgICAgICBsZXQgbm9Mb3NzZXNBZnRlckZpcnN0ID0gZmFsc2U7XG5cbiAgICAgICAgaWYoIXJvbGxzRmFpbCAmJiAoIWFtYnVzaCB8fCBoYXNDYWVzYXIpKSB7XG4gICAgICAgICAgICBpZihpbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlYXJsaWVyUGllY2VzID0gXy50YWtlKG5vcm1hbE9yZGVyZWRMb3NzVGFyZ2V0cywgaW5kZXgpO1xuICAgICAgICAgICAgICAgIGlmIChfLmZpbmQoZWFybGllclBpZWNlcywge2NhblJvbGw6IHRydWV9KSkge1xuICAgICAgICAgICAgICAgICAgICBub0xvc3NlcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihpbmRleCA9PT0gMCAmJiBub3JtYWxPcmRlcmVkTG9zc1RhcmdldHNbMF0uY2FuUm9sbCkge1xuICAgICAgICAgICAgICAgIG5vTG9zc2VzQWZ0ZXJGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gXyh0aGlzLmRlZmVuZGluZ1BpZWNlcykubWFwKChwaWVjZSwgcGllY2VJbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYocGllY2UudHlwZSAhPT0gdHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IG51bUxvc3NlcyA9IHBpZWNlSW5kZXggPCAocmV0cmVhdCA/IHRoaXMuZGVmZW5kZXJMb3NzZXMucmV0cmVhdCA6IHRoaXMuZGVmZW5kZXJMb3NzZXMubm9ybWFsKSA/IDEgOiAwO1xuICAgICAgICAgICAgaWYobm9Mb3NzZXMpIHtcbiAgICAgICAgICAgICAgICBudW1Mb3NzZXMgPSAwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKG5vTG9zc2VzQWZ0ZXJGaXJzdCAmJiBwaWVjZUluZGV4ID4gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBudW1Mb3NzZXMgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihub0xvc3Nlc0FmdGVyRmlyc3QgJiYgcGllY2VJbmRleCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBudW1Mb3NzZXMgPSB0aGlzLmRlZmVuZGVyTG9zc2VzLm5vcm1hbCAtIHBpZWNlSW5kZXg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGllY2UsXG4gICAgICAgICAgICAgICAgbnVtTG9zc2VzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNvbXBhY3QoKS52YWx1ZSgpO1xuICAgIH1cblxuICAgIGxvZ1Jlc3VsdHMoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgJyoqKiBCYXR0bGUgLSAnICsgdGhpcy5hdHRhY2tpbmdGYWN0aW9uLm5hbWUgKyAnIGF0dGFja3MgJyArIHRoaXMuZGVmZW5kaW5nRmFjdGlvbi5uYW1lICsgJyBpbiByZWdpb24gJyArIHRoaXMucmVnaW9uLm5hbWUpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAgICoqKiBOb3JtYWwgUG9zc2liaWxpdGllcyAqKionKTtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAnICAgIFdpdGggcmV0cmVhdCAnICsgdGhpcy5kZWZlbmRpbmdGYWN0aW9uLm5hbWUgKyAnIHdpbGwgbG9zZSB0aGUgZm9sbG93aW5nICcgKyB0aGlzLndvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHMudGFyZ2V0cy5sZW5ndGggKyAnIHBpZWNlcycpO1xuICAgICAgICBMb2dnaW5nLmxvZ1BpZWNlcyh0aGlzLndvcnN0Q2FzZVJldHJlYXREZWZlbmRlclJlc3VsdHMudGFyZ2V0cyk7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgJyAgICBXaXRob3V0IHJldHJlYXQgJyArIHRoaXMuZGVmZW5kaW5nRmFjdGlvbi5uYW1lICsgJyB3aWxsIGxvc2UgdGhlIGZvbGxvd2luZyAnICsgdGhpcy53b3JzdENhc2VOb1JldHJlYXREZWZlbmRlclJlc3VsdHMubm9ybWFsLnRhcmdldHMubGVuZ3RoICsgJyBwaWVjZXMnKTtcbiAgICAgICAgTG9nZ2luZy5sb2dQaWVjZXModGhpcy53b3JzdENhc2VOb1JldHJlYXREZWZlbmRlclJlc3VsdHMubm9ybWFsLnRhcmdldHMpO1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICcgICAgSWYgY291bnRlcmF0dGFja2VkICcgKyB0aGlzLmF0dGFja2luZ0ZhY3Rpb24ubmFtZSArICcgd2lsbCBsb3NlIHRoZSBmb2xsb3dpbmcgJyArIHRoaXMud29yc3RDYXNlQXR0YWNrZXJMb3NzZXMubm9ybWFsICsgJyBwaWVjZXMnKTtcbiAgICAgICAgTG9nZ2luZy5sb2dQaWVjZXModGhpcy53b3JzdENhc2VDb3VudGVyYXR0YWNrUmVzdWx0cy5ub3JtYWwudGFyZ2V0cyk7XG4gICAgICAgIGlmICh0aGlzLmNhbkFtYnVzaCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyAgICAqKiogQW1idXNoIFBvc3NpYmlsaXRpZXMgKioqJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAnICAgICcgKyB0aGlzLmRlZmVuZGluZ0ZhY3Rpb24ubmFtZSArICcgd2lsbCBsb3NlIHRoZSBmb2xsb3dpbmcgJyArIHRoaXMud29yc3RDYXNlTm9SZXRyZWF0RGVmZW5kZXJSZXN1bHRzLmFtYnVzaC50YXJnZXRzLmxlbmd0aCArICcgcGllY2VzJyk7XG4gICAgICAgICAgICBMb2dnaW5nLmxvZ1BpZWNlcyh0aGlzLndvcnN0Q2FzZU5vUmV0cmVhdERlZmVuZGVyUmVzdWx0cy5hbWJ1c2gudGFyZ2V0cyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAnICAgIElmIGNvdW50ZXJhdHRhY2tlZCAnICsgdGhpcy5hdHRhY2tpbmdGYWN0aW9uLm5hbWUgKyAnIHdpbGwgbG9zZSB0aGUgZm9sbG93aW5nICcgKyB0aGlzLndvcnN0Q2FzZUF0dGFja2VyTG9zc2VzLmFtYnVzaCArICcgcGllY2VzJyk7XG4gICAgICAgICAgICBMb2dnaW5nLmxvZ1BpZWNlcyh0aGlzLndvcnN0Q2FzZUNvdW50ZXJhdHRhY2tSZXN1bHRzLmFtYnVzaC50YXJnZXRzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmF0dGxlUmVzdWx0cztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvYmF0dGxlUmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBREE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 155 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EnlistResults = function EnlistResults(definition) {\n    _classCallCheck(this, EnlistResults);\n\n    this.region = definition.region;\n    this.germanicPieces = definition.germanicPieces;\n    this.enemyFactions = definition.enemyFactions;\n};\n\nexports.default = EnlistResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2JlbGdhZS9lbmxpc3RSZXN1bHRzLmpzP2Q3ZjMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5jbGFzcyBFbmxpc3RSZXN1bHRzIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMucmVnaW9uID0gZGVmaW5pdGlvbi5yZWdpb247XG4gICAgICAgIHRoaXMuZ2VybWFuaWNQaWVjZXMgPSBkZWZpbml0aW9uLmdlcm1hbmljUGllY2VzO1xuICAgICAgICB0aGlzLmVuZW15RmFjdGlvbnMgPSBkZWZpbml0aW9uLmVuZW15RmFjdGlvbnM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFbmxpc3RSZXN1bHRzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9iZWxnYWUvZW5saXN0UmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 156 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RampageResults = function RampageResults(definition) {\n    _classCallCheck(this, RampageResults);\n\n    this.region = definition.region;\n    this.hiddenWarbands = definition.hiddenWarbands;\n    this.enemyFactions = definition.enemyFactions;\n    this.chosenFaction = definition.chosenFaction;\n    this.priority = definition.priority;\n    this.count = definition.count;\n    this.agreeingFactionId = definition.agreeingFactionId;\n};\n\nexports.default = RampageResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2JlbGdhZS9yYW1wYWdlUmVzdWx0cy5qcz8yNjI2Il0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgUmFtcGFnZVJlc3VsdHMge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5oaWRkZW5XYXJiYW5kcyA9IGRlZmluaXRpb24uaGlkZGVuV2FyYmFuZHM7XG4gICAgICAgIHRoaXMuZW5lbXlGYWN0aW9ucyA9IGRlZmluaXRpb24uZW5lbXlGYWN0aW9ucztcbiAgICAgICAgdGhpcy5jaG9zZW5GYWN0aW9uID0gZGVmaW5pdGlvbi5jaG9zZW5GYWN0aW9uO1xuICAgICAgICB0aGlzLnByaW9yaXR5ID0gZGVmaW5pdGlvbi5wcmlvcml0eTtcbiAgICAgICAgdGhpcy5jb3VudCA9IGRlZmluaXRpb24uY291bnQ7XG4gICAgICAgIHRoaXMuYWdyZWVpbmdGYWN0aW9uSWQgPSBkZWZpbml0aW9uLmFncmVlaW5nRmFjdGlvbklkO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmFtcGFnZVJlc3VsdHM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL2JlbGdhZS9yYW1wYWdlUmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 157 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _logging = __webpack_require__(30);\n\nvar _logging2 = _interopRequireDefault(_logging);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MarchResults = function () {\n    function MarchResults(definition) {\n        _classCallCheck(this, MarchResults);\n\n        this.cost = definition.cost;\n        this.region = definition.region;\n        this.faction = definition.faction;\n        this.mobilePieces = definition.mobilePieces;\n        this.adjacentDestinations = definition.adjacentDestinations;\n        this.destinations = definition.destinations;\n        this.priority = definition.priority;\n    }\n\n    _createClass(MarchResults, [{\n        key: 'logResults',\n        value: function logResults() {\n            console.log('*** March - ' + this.faction.name + ' can march from region ' + this.region.name + (this.priority ? ' with priority ' + this.priority : ''));\n            console.log('Mobile pieces available: ');\n            _logging2.default.logPieces(this.mobilePieces);\n            console.log('Possible destinations: ' + _lodash2.default.join(this.destinations));\n        }\n    }]);\n\n    return MarchResults;\n}();\n\nexports.default = MarchResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL21hcmNoUmVzdWx0cy5qcz8yOTU0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IExvZ2dpbmcgZnJvbSAnLi4vdXRpbC9sb2dnaW5nJztcblxuY2xhc3MgTWFyY2hSZXN1bHRzIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMuY29zdCA9IGRlZmluaXRpb24uY29zdDtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5mYWN0aW9uID0gZGVmaW5pdGlvbi5mYWN0aW9uO1xuICAgICAgICB0aGlzLm1vYmlsZVBpZWNlcyA9IGRlZmluaXRpb24ubW9iaWxlUGllY2VzO1xuICAgICAgICB0aGlzLmFkamFjZW50RGVzdGluYXRpb25zID0gZGVmaW5pdGlvbi5hZGphY2VudERlc3RpbmF0aW9ucztcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvbnMgPSBkZWZpbml0aW9uLmRlc3RpbmF0aW9ucztcbiAgICAgICAgdGhpcy5wcmlvcml0eSA9IGRlZmluaXRpb24ucHJpb3JpdHk7XG4gICAgfVxuXG4gICAgbG9nUmVzdWx0cygpIHtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKiBNYXJjaCAtICcgKyB0aGlzLmZhY3Rpb24ubmFtZSArICcgY2FuIG1hcmNoIGZyb20gcmVnaW9uICcgKyB0aGlzLnJlZ2lvbi5uYW1lICsgKHRoaXMucHJpb3JpdHkgPyAnIHdpdGggcHJpb3JpdHkgJyArIHRoaXMucHJpb3JpdHkgOiAnJykpO1xuICAgICAgICBjb25zb2xlLmxvZygnTW9iaWxlIHBpZWNlcyBhdmFpbGFibGU6ICcpO1xuICAgICAgICBMb2dnaW5nLmxvZ1BpZWNlcyh0aGlzLm1vYmlsZVBpZWNlcyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQb3NzaWJsZSBkZXN0aW5hdGlvbnM6ICcgKyBfLmpvaW4odGhpcy5kZXN0aW5hdGlvbnMpKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1hcmNoUmVzdWx0cztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9tYXJjaFJlc3VsdHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 158 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RaidResults = function () {\n    function RaidResults(definition) {\n        _classCallCheck(this, RaidResults);\n\n        this.region = definition.region;\n        this.faction = definition.faction;\n        this.raidableFactions = definition.raidableFactions;\n        this.priority = definition.priority;\n        this.resourcesGained = 0;\n    }\n\n    _createClass(RaidResults, [{\n        key: 'logResults',\n        value: function logResults() {\n            console.log('*** Raid - ' + this.faction.name + ' is raiding in region ' + this.region.name + (this.priority ? ' with priority ' + this.priority : ''));\n            if (this.raidableFactions.length > 0) {\n                console.log('Can raid ' + _lodash2.default.join(this.raidableFactions));\n            } else {\n                console.log('Can not raid any specific factions');\n            }\n        }\n    }]);\n\n    return RaidResults;\n}();\n\nexports.default = RaidResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JhaWRSZXN1bHRzLmpzPzIxYjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5cbmNsYXNzIFJhaWRSZXN1bHRzIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIHRoaXMucmVnaW9uID0gZGVmaW5pdGlvbi5yZWdpb247XG4gICAgICAgIHRoaXMuZmFjdGlvbiA9IGRlZmluaXRpb24uZmFjdGlvbjtcbiAgICAgICAgdGhpcy5yYWlkYWJsZUZhY3Rpb25zID0gZGVmaW5pdGlvbi5yYWlkYWJsZUZhY3Rpb25zO1xuICAgICAgICB0aGlzLnByaW9yaXR5ID0gZGVmaW5pdGlvbi5wcmlvcml0eTtcbiAgICAgICAgdGhpcy5yZXNvdXJjZXNHYWluZWQgPSAwO1xuICAgIH1cblxuICAgIGxvZ1Jlc3VsdHMoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogUmFpZCAtICcgKyB0aGlzLmZhY3Rpb24ubmFtZSArICcgaXMgcmFpZGluZyBpbiByZWdpb24gJyArIHRoaXMucmVnaW9uLm5hbWUgKyAodGhpcy5wcmlvcml0eSA/ICcgd2l0aCBwcmlvcml0eSAnICsgdGhpcy5wcmlvcml0eSA6ICcnKSk7XG4gICAgICAgIGlmICh0aGlzLnJhaWRhYmxlRmFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhbiByYWlkICcgKyBfLmpvaW4odGhpcy5yYWlkYWJsZUZhY3Rpb25zKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIG5vdCByYWlkIGFueSBzcGVjaWZpYyBmYWN0aW9ucycpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSYWlkUmVzdWx0cztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9yYWlkUmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7O0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 159 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RallyRegionResults = function () {\n    function RallyRegionResults(definition) {\n        _classCallCheck(this, RallyRegionResults);\n\n        this.region = definition.region;\n        this.faction = definition.faction;\n        this.cost = definition.cost;\n        this.inSupplyLine = definition.inSupplyLine;\n        this.canAddCitadel = definition.canAddCitadel;\n        this.canAddAlly = definition.canAddAlly;\n        this.canAddNumWarbands = definition.canAddNumWarbands;\n        this.canAddNumAuxilia = definition.canAddNumAuxilia;\n        this.addAlly = definition.addAlly;\n        this.addCitadel = definition.addCitadel;\n        this.addNumWarbands = definition.addNumWarbands;\n        this.addNumAuxilia = definition.addNumAuxilia;\n    }\n\n    _createClass(RallyRegionResults, [{\n        key: 'logResults',\n        value: function logResults() {\n            console.log('*** ' + (this.faction.id === _factionIds2.default.ROMANS ? 'Recruit' : 'Rally') + ' - ' + this.faction.name + ' is ' + (this.faction.id === _factionIds2.default.ROMANS ? 'recruiting' : 'rallying') + ' in region ' + this.region.name + ' for cost ' + this.cost);\n            console.log('Results in ' + (this.addAlly ? '1' : 'no') + ' Ally added, ' + (this.addCitadel ? '1' : 'no') + ' Citadel added, ' + this.addNumWarbands + 'x Warbands added' + this.addNumAuxilia + 'x Auxilia added');\n        }\n    }]);\n\n    return RallyRegionResults;\n}();\n\nexports.default = RallyRegionResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JhbGx5UmVnaW9uUmVzdWx0cy5qcz82MjU1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGYWN0aW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL2ZhY3Rpb25JZHMnO1xuXG5jbGFzcyBSYWxseVJlZ2lvblJlc3VsdHMge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5mYWN0aW9uID0gZGVmaW5pdGlvbi5mYWN0aW9uO1xuICAgICAgICB0aGlzLmNvc3QgPSBkZWZpbml0aW9uLmNvc3Q7XG4gICAgICAgIHRoaXMuaW5TdXBwbHlMaW5lID0gZGVmaW5pdGlvbi5pblN1cHBseUxpbmU7XG4gICAgICAgIHRoaXMuY2FuQWRkQ2l0YWRlbCA9IGRlZmluaXRpb24uY2FuQWRkQ2l0YWRlbDtcbiAgICAgICAgdGhpcy5jYW5BZGRBbGx5ID0gZGVmaW5pdGlvbi5jYW5BZGRBbGx5O1xuICAgICAgICB0aGlzLmNhbkFkZE51bVdhcmJhbmRzID0gZGVmaW5pdGlvbi5jYW5BZGROdW1XYXJiYW5kcztcbiAgICAgICAgdGhpcy5jYW5BZGROdW1BdXhpbGlhID0gZGVmaW5pdGlvbi5jYW5BZGROdW1BdXhpbGlhO1xuICAgICAgICB0aGlzLmFkZEFsbHkgPSBkZWZpbml0aW9uLmFkZEFsbHk7XG4gICAgICAgIHRoaXMuYWRkQ2l0YWRlbCA9IGRlZmluaXRpb24uYWRkQ2l0YWRlbDtcbiAgICAgICAgdGhpcy5hZGROdW1XYXJiYW5kcyA9IGRlZmluaXRpb24uYWRkTnVtV2FyYmFuZHM7XG4gICAgICAgIHRoaXMuYWRkTnVtQXV4aWxpYSA9IGRlZmluaXRpb24uYWRkTnVtQXV4aWxpYTtcbiAgICB9XG5cbiAgICBsb2dSZXN1bHRzKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnKioqICcgKyAodGhpcy5mYWN0aW9uLmlkID09PSBGYWN0aW9uSURzLlJPTUFOUyA/ICdSZWNydWl0JyA6ICdSYWxseScpICsgJyAtICcgKyB0aGlzLmZhY3Rpb24ubmFtZSArICcgaXMgJyArICh0aGlzLmZhY3Rpb24uaWQgPT09IEZhY3Rpb25JRHMuUk9NQU5TID8gJ3JlY3J1aXRpbmcnIDogJ3JhbGx5aW5nJykgKyAnIGluIHJlZ2lvbiAnICsgdGhpcy5yZWdpb24ubmFtZSArICcgZm9yIGNvc3QgJyArIHRoaXMuY29zdCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgJ1Jlc3VsdHMgaW4gJyArICh0aGlzLmFkZEFsbHkgPyAnMScgOiAnbm8nICkgKyAnIEFsbHkgYWRkZWQsICcgK1xuICAgICAgICAgICAgKHRoaXMuYWRkQ2l0YWRlbCA/ICcxJyA6ICdubycgKSArICcgQ2l0YWRlbCBhZGRlZCwgJyArXG4gICAgICAgICAgICB0aGlzLmFkZE51bVdhcmJhbmRzICsgJ3ggV2FyYmFuZHMgYWRkZWQnICtcbiAgICAgICAgICAgIHRoaXMuYWRkTnVtQXV4aWxpYSArICd4IEF1eGlsaWEgYWRkZWQnKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJhbGx5UmVnaW9uUmVzdWx0cztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9yYWxseVJlZ2lvblJlc3VsdHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7Ozs7OztBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBS0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 160 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _besiegeResults = __webpack_require__(161);\n\nvar _besiegeResults2 = _interopRequireDefault(_besiegeResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Besiege = function (_Command) {\n    _inherits(Besiege, _Command);\n\n    function Besiege() {\n        _classCallCheck(this, Besiege);\n\n        return _possibleConstructorReturn(this, (Besiege.__proto__ || Object.getPrototypeOf(Besiege)).apply(this, arguments));\n    }\n\n    _createClass(Besiege, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var battles = args.battles;\n            if (!battles) {\n                return [];\n            }\n\n            return (0, _lodash2.default)(battles).map(function (battle) {\n                if (_lodash2.default.find(battle.attackingPieces, { type: 'legion' }) < 0) {\n                    return;\n                }\n\n                var willRemoveExtraAlly = _lodash2.default.find(battle.getNumLossesAgainstPiecesOfType('alliedtribe'), { numLosses: 0 });\n                var willRemoveExtraCitadel = _lodash2.default.find(battle.getNumLossesAgainstPiecesOfType('citadel'), function (citadel) {\n                    return citadel.numLosses < 3;\n                });\n\n                if (!willRemoveExtraAlly && !willRemoveExtraCitadel) {\n                    return;\n                }\n\n                return new _besiegeResults2.default({\n                    battle: battle,\n                    willRemoveExtraAlly: willRemoveExtraAlly,\n                    willRemoveExtraCitadel: willRemoveExtraCitadel\n                });\n            }).compact().value();\n        }\n    }]);\n\n    return Besiege;\n}(_command2.default);\n\nexports.default = Besiege;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9iZXNpZWdlLmpzP2VlZmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgQ29tbWFuZCBmcm9tICcuLi9jb21tYW5kJztcbmltcG9ydCBCZXNpZWdlUmVzdWx0cyBmcm9tICcuL2Jlc2llZ2VSZXN1bHRzJztcblxuY2xhc3MgQmVzaWVnZSBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICBjb25zdCBiYXR0bGVzID0gYXJncy5iYXR0bGVzO1xuICAgICAgICBpZiAoIWJhdHRsZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfKGJhdHRsZXMpLm1hcCgoYmF0dGxlKSA9PiB7XG4gICAgICAgICAgICBpZihfLmZpbmQoYmF0dGxlLmF0dGFja2luZ1BpZWNlcywge3R5cGUgOiAnbGVnaW9uJ30pIDwgMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgd2lsbFJlbW92ZUV4dHJhQWxseSA9IF8uZmluZChiYXR0bGUuZ2V0TnVtTG9zc2VzQWdhaW5zdFBpZWNlc09mVHlwZSgnYWxsaWVkdHJpYmUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge251bUxvc3NlczogMH0pO1xuICAgICAgICAgICAgY29uc3Qgd2lsbFJlbW92ZUV4dHJhQ2l0YWRlbCA9IF8uZmluZChiYXR0bGUuZ2V0TnVtTG9zc2VzQWdhaW5zdFBpZWNlc09mVHlwZSgnY2l0YWRlbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXRhZGVsID0+IGNpdGFkZWwubnVtTG9zc2VzIDwgMyk7XG5cbiAgICAgICAgICAgIGlmICghd2lsbFJlbW92ZUV4dHJhQWxseSAmJiAhd2lsbFJlbW92ZUV4dHJhQ2l0YWRlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBCZXNpZWdlUmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgYmF0dGxlOiBiYXR0bGUsXG4gICAgICAgICAgICAgICAgd2lsbFJlbW92ZUV4dHJhQWxseSxcbiAgICAgICAgICAgICAgICB3aWxsUmVtb3ZlRXh0cmFDaXRhZGVsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEJlc2llZ2U7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9iZXNpZWdlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 161 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BesiegeResults = function BesiegeResults(definition) {\n    _classCallCheck(this, BesiegeResults);\n\n    this.region = definition.region;\n    this.battle = definition.battle;\n\n    this.willRemoveExtraAlly = definition.willRemoveExtraAlly;\n    this.willRemoveExtraCitadel = definition.willRemoveExtraCitadel;\n};\n\nexports.default = BesiegeResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9iZXNpZWdlUmVzdWx0cy5qcz8xOWY4Il0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgQmVzaWVnZVJlc3VsdHMge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5iYXR0bGUgPSBkZWZpbml0aW9uLmJhdHRsZTtcblxuICAgICAgICB0aGlzLndpbGxSZW1vdmVFeHRyYUFsbHkgPSBkZWZpbml0aW9uLndpbGxSZW1vdmVFeHRyYUFsbHk7XG4gICAgICAgIHRoaXMud2lsbFJlbW92ZUV4dHJhQ2l0YWRlbCA9IGRlZmluaXRpb24ud2lsbFJlbW92ZUV4dHJhQ2l0YWRlbDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEJlc2llZ2VSZXN1bHRzXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9iZXNpZWdlUmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 162 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _buildResults = __webpack_require__(163);\n\nvar _buildResults2 = _interopRequireDefault(_buildResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Build = function (_Command) {\n    _inherits(Build, _Command);\n\n    function Build() {\n        _classCallCheck(this, Build);\n\n        return _possibleConstructorReturn(this, (Build.__proto__ || Object.getPrototypeOf(Build)).apply(this, arguments));\n    }\n\n    _createClass(Build, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var leaderRegion = _this2.findLeaderRegion(state);\n                if (!leaderRegion) {\n                    return;\n                }\n\n                if (!_this2.withinRangeOfLeader(region, leaderRegion)) {\n                    return;\n                }\n\n                var hasAlly = region.getAlliesForFaction(_factionIds2.default.ROMANS);\n                var agreementsNeeded = hasAlly ? [] : region.getAgreementsNeededForSupplyLine(_factionIds2.default.ROMANS);\n                var canPlaceFort = !region.getFort() && state.romans.availableForts().length > 0;\n                var romanControlMargin = region.controllingMarginByFaction()[_factionIds2.default.ROMANS];\n                var requiresFortForControl = canPlaceFort && romanControlMargin === 0;\n\n                var canRemoveAlly = _lodash2.default.find(region.tribes, function (tribe) {\n                    return tribe.isAllied() && tribe.alliedFactionId() !== _factionIds2.default.ROMANS;\n                }) && (romanControlMargin > 0 || requiresFortForControl);\n\n                var canPlaceAlly = region.subduedTribesForFaction(_factionIds2.default.ROMANS).length > 0 && (romanControlMargin > 0 || requiresFortForControl);\n\n                if (!canPlaceFort && !canRemoveAlly && !canPlaceAlly) {\n                    return;\n                }\n\n                return new _buildResults2.default({\n                    region: region,\n                    agreementsNeeded: agreementsNeeded,\n                    canPlaceFort: canPlaceFort,\n                    canRemoveAlly: canRemoveAlly,\n                    canPlaceAlly: canPlaceAlly\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'withinRangeOfLeader',\n        value: function withinRangeOfLeader(region, leaderRegion) {\n            var leader = leaderRegion.getLeaderForFaction(_factionIds2.default.ROMANS);\n\n            return region.id === leaderRegion.id || !leader.isSuccessor() && _lodash2.default.find(leaderRegion.adjacent, function (adjacent) {\n                return region.id === adjacent.id;\n            });\n        }\n    }, {\n        key: 'findLeaderRegion',\n        value: function findLeaderRegion(state) {\n            return _lodash2.default.find(state.regions, function (region) {\n                return _lodash2.default.find(region.piecesByFaction()[_factionIds2.default.ROMANS], { type: 'leader' });\n            });\n        }\n    }]);\n\n    return Build;\n}(_command2.default);\n\nexports.default = Build;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9idWlsZC5qcz8zNDIwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBCdWlsZFJlc3VsdHMgZnJvbSAnLi9idWlsZFJlc3VsdHMnO1xuXG5jbGFzcyBCdWlsZCBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGVhZGVyUmVnaW9uID0gdGhpcy5maW5kTGVhZGVyUmVnaW9uKHN0YXRlKTtcbiAgICAgICAgICAgIGlmICghbGVhZGVyUmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMud2l0aGluUmFuZ2VPZkxlYWRlcihyZWdpb24sIGxlYWRlclJlZ2lvbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGhhc0FsbHkgPSByZWdpb24uZ2V0QWxsaWVzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyk7XG4gICAgICAgICAgICBjb25zdCBhZ3JlZW1lbnRzTmVlZGVkID0gaGFzQWxseSA/IFtdIDogcmVnaW9uLmdldEFncmVlbWVudHNOZWVkZWRGb3JTdXBwbHlMaW5lKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICAgIGNvbnN0IGNhblBsYWNlRm9ydCA9ICFyZWdpb24uZ2V0Rm9ydCgpICYmIHN0YXRlLnJvbWFucy5hdmFpbGFibGVGb3J0cygpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBjb25zdCByb21hbkNvbnRyb2xNYXJnaW4gPSByZWdpb24uY29udHJvbGxpbmdNYXJnaW5CeUZhY3Rpb24oKVtGYWN0aW9uSURzLlJPTUFOU107XG4gICAgICAgICAgICBjb25zdCByZXF1aXJlc0ZvcnRGb3JDb250cm9sID0gY2FuUGxhY2VGb3J0ICYmIHJvbWFuQ29udHJvbE1hcmdpbiA9PT0gMDtcblxuICAgICAgICAgICAgY29uc3QgY2FuUmVtb3ZlQWxseSA9IF8uZmluZChyZWdpb24udHJpYmVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmliZSA9PiB0cmliZS5pc0FsbGllZCgpICYmIHRyaWJlLmFsbGllZEZhY3Rpb25JZCgpICE9PSBGYWN0aW9uSURzLlJPTUFOUykgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocm9tYW5Db250cm9sTWFyZ2luID4gMCB8fCByZXF1aXJlc0ZvcnRGb3JDb250cm9sKTtcblxuICAgICAgICAgICAgY29uc3QgY2FuUGxhY2VBbGx5ID0gcmVnaW9uLnN1YmR1ZWRUcmliZXNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuUk9NQU5TKS5sZW5ndGggPiAwICYmIChyb21hbkNvbnRyb2xNYXJnaW4gPiAwIHx8IHJlcXVpcmVzRm9ydEZvckNvbnRyb2wpO1xuXG4gICAgICAgICAgICBpZiAoIWNhblBsYWNlRm9ydCAmJiAhY2FuUmVtb3ZlQWxseSAmJiAhY2FuUGxhY2VBbGx5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbmV3IEJ1aWxkUmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFncmVlbWVudHNOZWVkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuUGxhY2VGb3J0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhblJlbW92ZUFsbHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuUGxhY2VBbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9KS5jb21wYWN0KCkudmFsdWUoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgd2l0aGluUmFuZ2VPZkxlYWRlcihyZWdpb24sIGxlYWRlclJlZ2lvbikge1xuICAgICAgICBjb25zdCBsZWFkZXIgPSBsZWFkZXJSZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyk7XG5cbiAgICAgICAgcmV0dXJuIHJlZ2lvbi5pZCA9PT0gbGVhZGVyUmVnaW9uLmlkIHx8ICghbGVhZGVyLmlzU3VjY2Vzc29yKCkgJiZcbiAgICAgICAgICAgICAgIF8uZmluZChsZWFkZXJSZWdpb24uYWRqYWNlbnQsIGFkamFjZW50ID0+IHJlZ2lvbi5pZCA9PT0gYWRqYWNlbnQuaWQpKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZmluZExlYWRlclJlZ2lvbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXy5maW5kKHN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBfLmZpbmQocmVnaW9uLnBpZWNlc0J5RmFjdGlvbigpW0ZhY3Rpb25JRHMuUk9NQU5TXSwge3R5cGU6ICdsZWFkZXInfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQnVpbGQ7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9idWlsZC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7Ozs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQVFBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 163 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BuildResults = function BuildResults(definition) {\n    _classCallCheck(this, BuildResults);\n\n    this.region = definition.region;\n    this.agreementsNeeded = definition.agreementsNeeded;\n    this.canPlaceFort = definition.canPlaceFort;\n    this.canRemoveAlly = definition.canRemoveAlly;\n    this.canPlaceAlly = definition.canPlaceAlly;\n    this.requiresFortForControl = definition.requiresFortForControl;\n};\n\nexports.default = BuildResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9idWlsZFJlc3VsdHMuanM/ZDUyOSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBCdWlsZFJlc3VsdHMge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5hZ3JlZW1lbnRzTmVlZGVkID0gZGVmaW5pdGlvbi5hZ3JlZW1lbnRzTmVlZGVkO1xuICAgICAgICB0aGlzLmNhblBsYWNlRm9ydCA9IGRlZmluaXRpb24uY2FuUGxhY2VGb3J0O1xuICAgICAgICB0aGlzLmNhblJlbW92ZUFsbHkgPSBkZWZpbml0aW9uLmNhblJlbW92ZUFsbHk7XG4gICAgICAgIHRoaXMuY2FuUGxhY2VBbGx5ID0gZGVmaW5pdGlvbi5jYW5QbGFjZUFsbHk7XG4gICAgICAgIHRoaXMucmVxdWlyZXNGb3J0Rm9yQ29udHJvbCA9IGRlZmluaXRpb24ucmVxdWlyZXNGb3J0Rm9yQ29udHJvbDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEJ1aWxkUmVzdWx0c1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9yb21hbnMvYnVpbGRSZXN1bHRzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 164 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _scoutResults = __webpack_require__(165);\n\nvar _scoutResults2 = _interopRequireDefault(_scoutResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Scout = function (_Command) {\n    _inherits(Scout, _Command);\n\n    function Scout() {\n        _classCallCheck(this, Scout);\n\n        return _possibleConstructorReturn(this, (Scout.__proto__ || Object.getPrototypeOf(Scout)).apply(this, arguments));\n    }\n\n    _createClass(Scout, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            return (0, _lodash2.default)(state.regions).filter(function (region) {\n                return region.getWarbandsOrAuxiliaForFaction(_factionIds2.default.ROMANS).length > 0;\n            }).map(function (region) {\n                var moveRegions = region.id === _regionIds2.default.BRITANNIA ? [] : _lodash2.default.reject(region.adjacent, { id: _regionIds2.default.BRITANNIA });\n                return new _scoutResults2.default({\n                    region: region,\n                    moveRegions: moveRegions\n                });\n            }).value();\n        }\n    }]);\n\n    return Scout;\n}(_command2.default);\n\nexports.default = Scout;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zY291dC5qcz9iNjhiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJ2ZhbGxpbmdza3kvY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBTY291dFJlc3VsdHMgZnJvbSAnLi9zY291dFJlc3VsdHMnO1xuXG5jbGFzcyBTY291dCBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5maWx0ZXIocmVnaW9uPT4gcmVnaW9uLmdldFdhcmJhbmRzT3JBdXhpbGlhRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoID4gMCkubWFwKChyZWdpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1vdmVSZWdpb25zID0gcmVnaW9uLmlkID09PSBSZWdpb25JRHMuQlJJVEFOTklBID8gW10gOiBfLnJlamVjdChyZWdpb24uYWRqYWNlbnQsIHtpZDogUmVnaW9uSURzLkJSSVRBTk5JQX0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBTY291dFJlc3VsdHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlUmVnaW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSkudmFsdWUoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNjb3V0O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9jb21tYW5kcy9yb21hbnMvc2NvdXQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7Ozs7Ozs7Ozs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 165 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ScoutResults = function ScoutResults(definition) {\n    _classCallCheck(this, ScoutResults);\n\n    this.region = definition.region;\n    this.moveRegions = definition.moveRegions;\n};\n\nexports.default = ScoutResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zY291dFJlc3VsdHMuanM/NWZkOSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTY291dFJlc3VsdHMge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgdGhpcy5yZWdpb24gPSBkZWZpbml0aW9uLnJlZ2lvbjtcbiAgICAgICAgdGhpcy5tb3ZlUmVnaW9ucyA9IGRlZmluaXRpb24ubW92ZVJlZ2lvbnM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTY291dFJlc3VsdHNcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29tbWFuZHMvcm9tYW5zL3Njb3V0UmVzdWx0cy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 166 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _command = __webpack_require__(9);\n\nvar _command2 = _interopRequireDefault(_command);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _seizeResults = __webpack_require__(167);\n\nvar _seizeResults2 = _interopRequireDefault(_seizeResults);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Seize = function (_Command) {\n    _inherits(Seize, _Command);\n\n    function Seize() {\n        _classCallCheck(this, Seize);\n\n        return _possibleConstructorReturn(this, (Seize.__proto__ || Object.getPrototypeOf(Seize)).apply(this, arguments));\n    }\n\n    _createClass(Seize, null, [{\n        key: 'doTest',\n        value: function doTest(state, args) {\n            var _this2 = this;\n\n            return (0, _lodash2.default)(state.regions).map(function (region) {\n                var romanPieces = region.getPiecesForFaction(_factionIds2.default.ROMANS);\n                if (romanPieces.length === 0) {\n                    return false;\n                }\n\n                var numAllies = region.getAlliesForFaction(_factionIds2.default.ROMANS).length;\n                var numSubdued = region.getSubduedTribes().length;\n\n                if (numAllies === 0 && numSubdued === 0) {\n                    return false;\n                }\n\n                var harassmentLosses = _this2.harassmentLosses(state, _factionIds2.default.ARVERNI, region) + _this2.harassmentLosses(state, _factionIds2.default.BELGAE, region) + _this2.harassmentLosses(state, _factionIds2.default.AEDUI, region) + _this2.harassmentLosses(state, _factionIds2.default.GERMANIC_TRIBES, region);\n\n                return new _seizeResults2.default({\n                    region: region,\n                    resourcesGained: region.devastated() ? 0 : (numAllies + numSubdued) * 2,\n                    canDisperse: numSubdued > 0 && state.romans.hasAvailableDispersalTokens(),\n                    harassmentLosses: harassmentLosses\n\n                });\n            }).compact().value();\n        }\n    }, {\n        key: 'harassmentLosses',\n        value: function harassmentLosses(state, factionId, region) {\n            var losses = 0;\n            var numHiddenEnemies = region.getHiddenPiecesForFaction(factionId).length;\n            if (numHiddenEnemies >= 3) {\n                var player = state.playersByFaction[factionId];\n                if (player.willHarass(_factionIds2.default.ROMANS)) {\n                    losses = Math.floor(numHiddenEnemies / 3);\n                }\n            }\n            return losses;\n        }\n    }]);\n\n    return Seize;\n}(_command2.default);\n\nexports.default = Seize;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zZWl6ZS5qcz84YjhiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IENvbW1hbmQgZnJvbSAnLi4vY29tbWFuZCc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBTZWl6ZVJlc3VsdHMgZnJvbSAnLi9zZWl6ZVJlc3VsdHMnO1xuXG5jbGFzcyBTZWl6ZSBleHRlbmRzIENvbW1hbmQge1xuXG4gICAgc3RhdGljIGRvVGVzdChzdGF0ZSwgYXJncykge1xuICAgICAgICByZXR1cm4gXyhzdGF0ZS5yZWdpb25zKS5tYXAoKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgcm9tYW5QaWVjZXMgPSByZWdpb24uZ2V0UGllY2VzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUyk7XG4gICAgICAgICAgICBpZiAocm9tYW5QaWVjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBudW1BbGxpZXMgPSByZWdpb24uZ2V0QWxsaWVzRm9yRmFjdGlvbihGYWN0aW9uSURzLlJPTUFOUykubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgbnVtU3ViZHVlZCA9IHJlZ2lvbi5nZXRTdWJkdWVkVHJpYmVzKCkubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZiAobnVtQWxsaWVzID09PSAwICYmIG51bVN1YmR1ZWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGhhcmFzc21lbnRMb3NzZXMgPSB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuQVJWRVJOSSwgcmVnaW9uKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBGYWN0aW9uSURzLkJFTEdBRSwgcmVnaW9uKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXJhc3NtZW50TG9zc2VzKHN0YXRlLCBGYWN0aW9uSURzLkFFRFVJLCByZWdpb24pICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIEZhY3Rpb25JRHMuR0VSTUFOSUNfVFJJQkVTLCByZWdpb24pO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNlaXplUmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlc0dhaW5lZDogcmVnaW9uLmRldmFzdGF0ZWQoKSA/IDAgOiAobnVtQWxsaWVzICsgbnVtU3ViZHVlZCkgKiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkRpc3BlcnNlOiBudW1TdWJkdWVkID4gMCAmJiBzdGF0ZS5yb21hbnMuaGFzQXZhaWxhYmxlRGlzcGVyc2FsVG9rZW5zKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFyYXNzbWVudExvc3Nlc1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGhhcmFzc21lbnRMb3NzZXMoc3RhdGUsIGZhY3Rpb25JZCwgcmVnaW9uKSB7XG4gICAgICAgIGxldCBsb3NzZXMgPSAwO1xuICAgICAgICBjb25zdCBudW1IaWRkZW5FbmVtaWVzID0gcmVnaW9uLmdldEhpZGRlblBpZWNlc0ZvckZhY3Rpb24oZmFjdGlvbklkKS5sZW5ndGg7XG4gICAgICAgIGlmIChudW1IaWRkZW5FbmVtaWVzID49IDMpIHtcbiAgICAgICAgICAgIGNvbnN0IHBsYXllciA9IHN0YXRlLnBsYXllcnNCeUZhY3Rpb25bZmFjdGlvbklkXTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXIud2lsbEhhcmFzcyhGYWN0aW9uSURzLlJPTUFOUykpIHtcbiAgICAgICAgICAgICAgICBsb3NzZXMgPSBNYXRoLmZsb29yKG51bUhpZGRlbkVuZW1pZXMgLyAzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbG9zc2VzO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VpemU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zZWl6ZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7Ozs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 167 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SeizeResults = function SeizeResults(definition) {\n    _classCallCheck(this, SeizeResults);\n\n    this.region = definition.region;\n    this.resourcesGained = definition.resourcesGained;\n    this.harassmentLosses = definition.harassmentLosses;\n    this.canDisperse = definition.canDisperse;\n};\n\nexports.default = SeizeResults;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zZWl6ZVJlc3VsdHMuanM/ODcwMCJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIFNlaXplUmVzdWx0cyB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IGRlZmluaXRpb24ucmVnaW9uO1xuICAgICAgICB0aGlzLnJlc291cmNlc0dhaW5lZCA9IGRlZmluaXRpb24ucmVzb3VyY2VzR2FpbmVkO1xuICAgICAgICB0aGlzLmhhcmFzc21lbnRMb3NzZXMgPSBkZWZpbml0aW9uLmhhcmFzc21lbnRMb3NzZXM7XG4gICAgICAgIHRoaXMuY2FuRGlzcGVyc2UgPSBkZWZpbml0aW9uLmNhbkRpc3BlcnNlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VpemVSZXN1bHRzXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2NvbW1hbmRzL3JvbWFucy9zZWl6ZVJlc3VsdHMuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 168 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SupplyLines = function () {\n    function SupplyLines() {\n        _classCallCheck(this, SupplyLines);\n    }\n\n    _createClass(SupplyLines, null, [{\n        key: 'populateSupplyLines',\n        value: function populateSupplyLines(regionsById, targetRegionId) {\n            var _this = this;\n\n            var supplyLinesByRegionId = {};\n            _lodash2.default.each(regionsById, function (region) {\n                if (!region.inPlay()) {\n                    return;\n                }\n\n                if (_lodash2.default.indexOf(_lodash2.default.map(region.adjacent, 'id'), targetRegionId) >= 0) {\n                    return;\n                }\n\n                _this.findPathsToRegion(supplyLinesByRegionId, regionsById, region.id, targetRegionId);\n            });\n            _lodash2.default.each(supplyLinesByRegionId, function (supplyLines, regionId) {\n                var updatedSupplyLines = (0, _lodash2.default)(supplyLines).map(function (supplyLine) {\n                    var dereferenced = (0, _lodash2.default)(supplyLine).tail().map(function (lineSegmentRegionId) {\n                        return regionsById[lineSegmentRegionId];\n                    }).value();\n                    return dereferenced;\n                }).sortBy('length').value();\n                regionsById[regionId].supplyLines = updatedSupplyLines;\n            });\n        }\n    }, {\n        key: 'findPathsToRegion',\n        value: function findPathsToRegion(supplyLinesByRegionId, regionsById, regionId, cisalpinaId) {\n            supplyLinesByRegionId[regionId] = [];\n            var visited = [regionId];\n            this.depthFirst(supplyLinesByRegionId, regionsById, cisalpinaId, visited);\n        }\n    }, {\n        key: 'depthFirst',\n        value: function depthFirst(supplyLinesByRegionId, regionsById, cisalpinaId, visited) {\n            var _this2 = this;\n\n            var adjacentRegions = regionsById[_lodash2.default.last(visited)].adjacent;\n\n            _lodash2.default.each(adjacentRegions, function (region) {\n                if (_lodash2.default.indexOf(visited, region.id) >= 0) {\n                    return;\n                }\n\n                if (region.id === cisalpinaId) {\n                    supplyLinesByRegionId[_lodash2.default.first(visited)].push(_lodash2.default.clone(visited));\n                    return false;\n                }\n            });\n\n            _lodash2.default.each(adjacentRegions, function (region) {\n                if (_lodash2.default.indexOf(visited, region.id) >= 0 || _lodash2.default.intersection(_lodash2.default.initial(visited), _lodash2.default.map(region.adjacent, 'id')).length > 0 || _lodash2.default.indexOf(_lodash2.default.map(adjacentRegions, 'id'), cisalpinaId) >= 0 && _lodash2.default.indexOf(_lodash2.default.map(region.adjacent, 'id'), cisalpinaId) >= 0 || region.id === cisalpinaId) {\n                    return;\n                }\n                visited.push(region.id);\n                _this2.depthFirst(supplyLinesByRegionId, regionsById, cisalpinaId, visited);\n                visited.pop();\n            });\n        }\n    }]);\n\n    return SupplyLines;\n}();\n\nexports.default = SupplyLines;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2NvbmZpZy9zdXBwbHlMaW5lcy5qcz82NjUzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuXG5jbGFzcyBTdXBwbHlMaW5lcyB7XG5cbiAgICBzdGF0aWMgcG9wdWxhdGVTdXBwbHlMaW5lcyggcmVnaW9uc0J5SWQsIHRhcmdldFJlZ2lvbklkICkge1xuICAgICAgICBjb25zdCBzdXBwbHlMaW5lc0J5UmVnaW9uSWQgPSB7fTtcbiAgICAgICAgXy5lYWNoKHJlZ2lvbnNCeUlkLCAocmVnaW9uKSA9PiB7XG4gICAgICAgICAgICBpZighcmVnaW9uLmluUGxheSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZigoXy5pbmRleE9mKF8ubWFwKHJlZ2lvbi5hZGphY2VudCwgJ2lkJyksIHRhcmdldFJlZ2lvbklkKSA+PSAwICkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZmluZFBhdGhzVG9SZWdpb24oc3VwcGx5TGluZXNCeVJlZ2lvbklkLCByZWdpb25zQnlJZCwgcmVnaW9uLmlkLCB0YXJnZXRSZWdpb25JZCk7XG4gICAgICAgIH0pO1xuICAgICAgICBfLmVhY2goc3VwcGx5TGluZXNCeVJlZ2lvbklkLCBmdW5jdGlvbiAoc3VwcGx5TGluZXMsIHJlZ2lvbklkKSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkU3VwcGx5TGluZXMgPV8oc3VwcGx5TGluZXMpLm1hcChmdW5jdGlvbihzdXBwbHlMaW5lKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVyZWZlcmVuY2VkID0gXyhzdXBwbHlMaW5lKS50YWlsKCkubWFwKGZ1bmN0aW9uKGxpbmVTZWdtZW50UmVnaW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbnNCeUlkW2xpbmVTZWdtZW50UmVnaW9uSWRdO1xuICAgICAgICAgICAgICAgIH0gKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkZXJlZmVyZW5jZWQ7XG4gICAgICAgICAgICB9KS5zb3J0QnkoJ2xlbmd0aCcpLnZhbHVlKCk7XG4gICAgICAgICAgICByZWdpb25zQnlJZFtyZWdpb25JZF0uc3VwcGx5TGluZXMgPSB1cGRhdGVkU3VwcGx5TGluZXM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kUGF0aHNUb1JlZ2lvbihzdXBwbHlMaW5lc0J5UmVnaW9uSWQsIHJlZ2lvbnNCeUlkLCByZWdpb25JZCwgY2lzYWxwaW5hSWQpIHtcbiAgICAgICAgc3VwcGx5TGluZXNCeVJlZ2lvbklkW3JlZ2lvbklkXSA9IFtdO1xuICAgICAgICBjb25zdCB2aXNpdGVkID0gW3JlZ2lvbklkXTtcbiAgICAgICAgdGhpcy5kZXB0aEZpcnN0KHN1cHBseUxpbmVzQnlSZWdpb25JZCwgcmVnaW9uc0J5SWQsIGNpc2FscGluYUlkLCB2aXNpdGVkKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZGVwdGhGaXJzdChzdXBwbHlMaW5lc0J5UmVnaW9uSWQsIHJlZ2lvbnNCeUlkLCBjaXNhbHBpbmFJZCwgdmlzaXRlZCkge1xuICAgICAgICBjb25zdCBhZGphY2VudFJlZ2lvbnMgPSByZWdpb25zQnlJZFtfLmxhc3QodmlzaXRlZCldLmFkamFjZW50O1xuXG4gICAgICAgIF8uZWFjaChhZGphY2VudFJlZ2lvbnMsIGZ1bmN0aW9uKHJlZ2lvbikge1xuICAgICAgICAgICAgaWYoXy5pbmRleE9mKHZpc2l0ZWQsIHJlZ2lvbi5pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYocmVnaW9uLmlkID09PSBjaXNhbHBpbmFJZCkge1xuICAgICAgICAgICAgICAgIHN1cHBseUxpbmVzQnlSZWdpb25JZFtfLmZpcnN0KHZpc2l0ZWQpXS5wdXNoKF8uY2xvbmUodmlzaXRlZCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgXy5lYWNoKGFkamFjZW50UmVnaW9ucywgKHJlZ2lvbikgPT4ge1xuICAgICAgICAgICAgaWYgKF8uaW5kZXhPZih2aXNpdGVkLCByZWdpb24uaWQpID49IDAgfHxcbiAgICAgICAgICAgICAgICBfLmludGVyc2VjdGlvbihfLmluaXRpYWwodmlzaXRlZCksIF8ubWFwKHJlZ2lvbi5hZGphY2VudCwgJ2lkJykpLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgICAgICAoXy5pbmRleE9mKF8ubWFwKGFkamFjZW50UmVnaW9ucywgJ2lkJyksIGNpc2FscGluYUlkKSA+PSAwICYmIF8uaW5kZXhPZihfLm1hcChyZWdpb24uYWRqYWNlbnQsICdpZCcpLCBjaXNhbHBpbmFJZCkgPj0gMCkgfHxcbiAgICAgICAgICAgICAgICByZWdpb24uaWQgPT09IGNpc2FscGluYUlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlzaXRlZC5wdXNoKHJlZ2lvbi5pZCk7XG4gICAgICAgICAgICB0aGlzLmRlcHRoRmlyc3Qoc3VwcGx5TGluZXNCeVJlZ2lvbklkLCByZWdpb25zQnlJZCwgY2lzYWxwaW5hSWQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgdmlzaXRlZC5wb3AoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTdXBwbHlMaW5lcztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvY29uZmlnL3N1cHBseUxpbmVzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTs7Ozs7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 169 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _fallingSkyFaction = __webpack_require__(38);\n\nvar _fallingSkyFaction2 = _interopRequireDefault(_fallingSkyFaction);\n\nvar _regions = __webpack_require__(46);\n\nvar _regions2 = _interopRequireDefault(_regions);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Aedui = function (_FallingSkyFaction) {\n    _inherits(Aedui, _FallingSkyFaction);\n\n    function Aedui() {\n        _classCallCheck(this, Aedui);\n\n        var definition = {\n            id: _factionIds2.default.AEDUI,\n            name: 'Aedui',\n            numWarbands: 20,\n            numAlliedTribes: 6,\n            numCitadels: 2\n        };\n\n        return _possibleConstructorReturn(this, (Aedui.__proto__ || Object.getPrototypeOf(Aedui)).call(this, definition));\n    }\n\n    _createClass(Aedui, [{\n        key: 'victoryMargin',\n        value: function victoryMargin(state) {\n            var _this2 = this;\n\n            var maxOtherPlaced = 0;\n            _lodash2.default.each(state.factionsById, function (faction, factionId) {\n                if (factionId === _this2.id || factionId === 'Germanic Tribes') {\n                    return;\n                }\n\n                maxOtherPlaced = Math.max(maxOtherPlaced, faction.numAlliedTribesAndCitadelsPlaced());\n            });\n\n            return this.numAlliedTribesAndCitadelsPlaced() - maxOtherPlaced;\n        }\n    }, {\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return region.id === _regions2.default.AEDUI;\n        }\n    }]);\n\n    return Aedui;\n}(_fallingSkyFaction2.default);\n\nexports.default = Aedui;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2FlZHVpLmpzPzUwOWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQgRmFsbGluZ1NreUZhY3Rpb24gZnJvbSAnLi9mYWxsaW5nU2t5RmFjdGlvbic7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uL2NvbmZpZy9yZWdpb25zJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgQWVkdWkgZXh0ZW5kcyBGYWxsaW5nU2t5RmFjdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgY29uc3QgZGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgIGlkOiBGYWN0aW9uSURzLkFFRFVJLFxuICAgICAgICAgICAgbmFtZTogJ0FlZHVpJyxcbiAgICAgICAgICAgIG51bVdhcmJhbmRzOiAyMCxcbiAgICAgICAgICAgIG51bUFsbGllZFRyaWJlczogNixcbiAgICAgICAgICAgIG51bUNpdGFkZWxzOiAyXG4gICAgICAgIH07XG5cbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxuXG4gICAgdmljdG9yeU1hcmdpbihzdGF0ZSkge1xuICAgICAgICBsZXQgbWF4T3RoZXJQbGFjZWQgPSAwO1xuICAgICAgICBfLmVhY2goc3RhdGUuZmFjdGlvbnNCeUlkLCAoZmFjdGlvbiwgZmFjdGlvbklkKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZhY3Rpb25JZCA9PT0gdGhpcy5pZCB8fCBmYWN0aW9uSWQgPT09ICdHZXJtYW5pYyBUcmliZXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtYXhPdGhlclBsYWNlZCA9IE1hdGgubWF4KG1heE90aGVyUGxhY2VkLCBmYWN0aW9uLm51bUFsbGllZFRyaWJlc0FuZENpdGFkZWxzUGxhY2VkKCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubnVtQWxsaWVkVHJpYmVzQW5kQ2l0YWRlbHNQbGFjZWQoKSAtIG1heE90aGVyUGxhY2VkO1xuICAgIH1cblxuICAgIGlzSG9tZVJlZ2lvbihyZWdpb24pIHtcbiAgICAgICAgcmV0dXJuIHJlZ2lvbi5pZCA9PT0gUmVnaW9uSURzLkFFRFVJO1xuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBBZWR1aTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvZmFjdGlvbnMvYWVkdWkuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQUZBO0FBVUE7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFJQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 170 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _fallingSkyFaction = __webpack_require__(38);\n\nvar _fallingSkyFaction2 = _interopRequireDefault(_fallingSkyFaction);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Arverni = function (_FallingSkyFaction) {\n    _inherits(Arverni, _FallingSkyFaction);\n\n    function Arverni() {\n        _classCallCheck(this, Arverni);\n\n        var definition = {\n            id: _factionIds2.default.ARVERNI,\n            name: 'Arverni',\n            numWarbands: 35,\n            numAlliedTribes: 10,\n            numCitadels: 3,\n            hasLeader: true,\n            leaderName: 'Vercingetorix'\n        };\n        return _possibleConstructorReturn(this, (Arverni.__proto__ || Object.getPrototypeOf(Arverni)).call(this, definition));\n    }\n\n    _createClass(Arverni, [{\n        key: 'victoryMargin',\n        value: function victoryMargin(state) {\n            var romans = state.factionsById[_factionIds2.default.ROMANS];\n            var offMapLegionMargin = romans.offMapLegions() - 6;\n            var alliesAndCitadelsMargin = this.numAlliedTribesAndCitadelsPlaced() - 8;\n            return Math.min(offMapLegionMargin, alliesAndCitadelsMargin);\n        }\n    }, {\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return region.id === _regionIds2.default.ARVERNI;\n        }\n    }]);\n\n    return Arverni;\n}(_fallingSkyFaction2.default);\n\nexports.default = Arverni;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2FydmVybmkuanM/MTQ3YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFsbGluZ1NreUZhY3Rpb24gZnJvbSAnLi9mYWxsaW5nU2t5RmFjdGlvbic7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuXG5jbGFzcyBBcnZlcm5pIGV4dGVuZHMgRmFsbGluZ1NreUZhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBjb25zdCBkZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgaWQ6IEZhY3Rpb25JRHMuQVJWRVJOSSxcbiAgICAgICAgICAgIG5hbWU6ICdBcnZlcm5pJyxcbiAgICAgICAgICAgIG51bVdhcmJhbmRzOiAzNSxcbiAgICAgICAgICAgIG51bUFsbGllZFRyaWJlczogMTAsXG4gICAgICAgICAgICBudW1DaXRhZGVsczogMyxcbiAgICAgICAgICAgIGhhc0xlYWRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGxlYWRlck5hbWU6ICdWZXJjaW5nZXRvcml4J1xuICAgICAgICB9O1xuICAgICAgICBzdXBlcihkZWZpbml0aW9uKTtcbiAgICB9XG5cbiAgICB2aWN0b3J5TWFyZ2luKHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHJvbWFucyA9IHN0YXRlLmZhY3Rpb25zQnlJZFtGYWN0aW9uSURzLlJPTUFOU107XG4gICAgICAgIGNvbnN0IG9mZk1hcExlZ2lvbk1hcmdpbiA9IHJvbWFucy5vZmZNYXBMZWdpb25zKCkgLSA2O1xuICAgICAgICBjb25zdCBhbGxpZXNBbmRDaXRhZGVsc01hcmdpbiA9IHRoaXMubnVtQWxsaWVkVHJpYmVzQW5kQ2l0YWRlbHNQbGFjZWQoKSAtIDg7XG4gICAgICAgIHJldHVybiBNYXRoLm1pbihvZmZNYXBMZWdpb25NYXJnaW4sIGFsbGllc0FuZENpdGFkZWxzTWFyZ2luKTtcbiAgICB9XG5cbiAgICBpc0hvbWVSZWdpb24ocmVnaW9uKSB7XG4gICAgICAgIHJldHVybiByZWdpb24uaWQgPT09IFJlZ2lvbklEcy5BUlZFUk5JO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXJ2ZXJuaTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvZmFjdGlvbnMvYXJ2ZXJuaS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFEQTtBQVdBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 171 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _fallingSkyFaction = __webpack_require__(38);\n\nvar _fallingSkyFaction2 = _interopRequireDefault(_fallingSkyFaction);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Belgae = function (_FallingSkyFaction) {\n    _inherits(Belgae, _FallingSkyFaction);\n\n    function Belgae() {\n        _classCallCheck(this, Belgae);\n\n        var definition = {\n            id: _factionIds2.default.BELGAE,\n            name: 'Belgae',\n            numWarbands: 25,\n            numAlliedTribes: 10,\n            numCitadels: 1,\n            hasLeader: true,\n            leaderName: 'Ambiorix'\n        };\n        return _possibleConstructorReturn(this, (Belgae.__proto__ || Object.getPrototypeOf(Belgae)).call(this, definition));\n    }\n\n    _createClass(Belgae, [{\n        key: 'victoryMargin',\n        value: function victoryMargin(state) {\n            return _lodash2.default.reduce(state.getControlledRegionsForFaction(_factionIds2.default.BELGAE), function (sum, region) {\n                var controlValue = region.controlValue;\n                _lodash2.default.each(region.tribes, function (tribe) {\n                    if (tribe.isDispersed() && tribe.id !== _tribeIds2.default.SUEBI_NORTH && tribe.id !== _tribeIds2.default.SUEBI_SOUTH) {\n                        controlValue -= 1;\n                    }\n                });\n\n                return sum + controlValue;\n            }, 0) + this.numAlliedTribesAndCitadelsPlaced() - 15;\n        }\n    }, {\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return region.group === _regionGroups2.default.BELGICA;\n        }\n    }]);\n\n    return Belgae;\n}(_fallingSkyFaction2.default);\n\nexports.default = Belgae;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2JlbGdhZS5qcz8wNGUwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IEZhbGxpbmdTa3lGYWN0aW9uIGZyb20gJy4vZmFsbGluZ1NreUZhY3Rpb24nO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBUcmliZUlEcyBmcm9tICcuLi9jb25maWcvdHJpYmVJZHMnO1xuXG5jbGFzcyBCZWxnYWUgZXh0ZW5kcyBGYWxsaW5nU2t5RmFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IGRlZmluaXRpb24gPSB7XG4gICAgICAgICAgICBpZDogRmFjdGlvbklEcy5CRUxHQUUsXG4gICAgICAgICAgICBuYW1lOiAnQmVsZ2FlJyxcbiAgICAgICAgICAgIG51bVdhcmJhbmRzOiAyNSxcbiAgICAgICAgICAgIG51bUFsbGllZFRyaWJlczogMTAsXG4gICAgICAgICAgICBudW1DaXRhZGVsczogMSxcbiAgICAgICAgICAgIGhhc0xlYWRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGxlYWRlck5hbWU6ICdBbWJpb3JpeCdcbiAgICAgICAgfTtcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgfVxuXG4gICAgdmljdG9yeU1hcmdpbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gXy5yZWR1Y2Uoc3RhdGUuZ2V0Q29udHJvbGxlZFJlZ2lvbnNGb3JGYWN0aW9uKEZhY3Rpb25JRHMuQkVMR0FFKSwgZnVuY3Rpb24gKHN1bSwgcmVnaW9uKSB7XG4gICAgICAgICAgICBsZXQgY29udHJvbFZhbHVlID0gcmVnaW9uLmNvbnRyb2xWYWx1ZTtcbiAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICByZWdpb24udHJpYmVzLCBmdW5jdGlvbiAodHJpYmUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyaWJlLmlzRGlzcGVyc2VkKCkgJiYgdHJpYmUuaWQgIT09IFRyaWJlSURzLlNVRUJJX05PUlRIICYmIHRyaWJlLmlkICE9PSBUcmliZUlEcy5TVUVCSV9TT1VUSCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbFZhbHVlIC09IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHN1bSArIGNvbnRyb2xWYWx1ZTtcbiAgICAgICAgfSwgMCkgKyB0aGlzLm51bUFsbGllZFRyaWJlc0FuZENpdGFkZWxzUGxhY2VkKCkgLSAxNTtcbiAgICB9XG5cbiAgICBpc0hvbWVSZWdpb24ocmVnaW9uKSB7XG4gICAgICAgIHJldHVybiByZWdpb24uZ3JvdXAgPT09IFJlZ2lvbkdyb3Vwcy5CRUxHSUNBO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmVsZ2FlXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2JlbGdhZS5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFEQTtBQVdBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 172 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _fallingSkyFaction = __webpack_require__(38);\n\nvar _fallingSkyFaction2 = _interopRequireDefault(_fallingSkyFaction);\n\nvar _regionGroups = __webpack_require__(14);\n\nvar _regionGroups2 = _interopRequireDefault(_regionGroups);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GermanicTribes = function (_FallingSkyFaction) {\n    _inherits(GermanicTribes, _FallingSkyFaction);\n\n    function GermanicTribes() {\n        _classCallCheck(this, GermanicTribes);\n\n        var definition = {\n            id: _factionIds2.default.GERMANIC_TRIBES,\n            name: 'Germans',\n            numWarbands: 15,\n            numAlliedTribes: 6,\n            numCitadels: 0\n        };\n        return _possibleConstructorReturn(this, (GermanicTribes.__proto__ || Object.getPrototypeOf(GermanicTribes)).call(this, definition));\n    }\n\n    _createClass(GermanicTribes, [{\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return region.group === _regionGroups2.default.GERMANIA;\n        }\n    }]);\n\n    return GermanicTribes;\n}(_fallingSkyFaction2.default);\n\nexports.default = GermanicTribes;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL2dlcm1hbmljVHJpYmVzLmpzP2JiOWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZhbGxpbmdTa3lGYWN0aW9uIGZyb20gJy4vZmFsbGluZ1NreUZhY3Rpb24nO1xuaW1wb3J0IFJlZ2lvbkdyb3VwcyBmcm9tICcuLi9jb25maWcvcmVnaW9uR3JvdXBzJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcblxuY2xhc3MgR2VybWFuaWNUcmliZXMgZXh0ZW5kcyBGYWxsaW5nU2t5RmFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IGRlZmluaXRpb24gPSB7XG4gICAgICAgICAgICBpZDogRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVMsXG4gICAgICAgICAgICBuYW1lOiAnR2VybWFucycsXG4gICAgICAgICAgICBudW1XYXJiYW5kczogMTUsXG4gICAgICAgICAgICBudW1BbGxpZWRUcmliZXM6IDYsXG4gICAgICAgICAgICBudW1DaXRhZGVsczogMFxuICAgICAgICB9O1xuICAgICAgICBzdXBlcihkZWZpbml0aW9uKTtcbiAgICB9XG5cbiAgICBpc0hvbWVSZWdpb24ocmVnaW9uKSB7XG4gICAgICAgIHJldHVybiByZWdpb24uZ3JvdXAgPT09IFJlZ2lvbkdyb3Vwcy5HRVJNQU5JQTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdlcm1hbmljVHJpYmVzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9mYWN0aW9ucy9nZXJtYW5pY1RyaWJlcy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQURBO0FBU0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 173 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _fallingSkyFaction = __webpack_require__(38);\n\nvar _fallingSkyFaction2 = _interopRequireDefault(_fallingSkyFaction);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _auxilia = __webpack_require__(180);\n\nvar _auxilia2 = _interopRequireDefault(_auxilia);\n\nvar _placeAuxilia = __webpack_require__(32);\n\nvar _placeAuxilia2 = _interopRequireDefault(_placeAuxilia);\n\nvar _placeLegions = __webpack_require__(49);\n\nvar _placeLegions2 = _interopRequireDefault(_placeLegions);\n\nvar _returnFallenLegions = __webpack_require__(93);\n\nvar _returnFallenLegions2 = _interopRequireDefault(_returnFallenLegions);\n\nvar _fort = __webpack_require__(182);\n\nvar _fort2 = _interopRequireDefault(_fort);\n\nvar _legion = __webpack_require__(184);\n\nvar _legion2 = _interopRequireDefault(_legion);\n\nvar _senateApprovalStates = __webpack_require__(37);\n\nvar _changeSenateApproval = __webpack_require__(91);\n\nvar _changeSenateApproval2 = _interopRequireDefault(_changeSenateApproval);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Romans = function (_FallingSkyFaction) {\n    _inherits(Romans, _FallingSkyFaction);\n\n    function Romans() {\n        _classCallCheck(this, Romans);\n\n        var definition = {\n            id: _factionIds2.default.ROMANS,\n            name: 'Romans',\n            numWarbands: 0,\n            numAlliedTribes: 6,\n            numCitadels: 0,\n            hasLeader: true,\n            leaderName: 'Julius Caesar',\n            passResources: 2\n        };\n\n        var _this = _possibleConstructorReturn(this, (Romans.__proto__ || Object.getPrototypeOf(Romans)).call(this, definition));\n\n        _this.availableAuxilia = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(20), function () {\n            return new _auxilia2.default({ factionId: definition.id });\n        }));\n\n        _this.availableForts = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(6), function () {\n            return new _fort2.default({ factionId: definition.id });\n        }));\n\n        _this.availableLegions = _knockout2.default.observableArray(_lodash2.default.map(_lodash2.default.range(12), function () {\n            return new _legion2.default({ factionId: definition.id });\n        }));\n\n        _this.availableDispersalTokens = _knockout2.default.observable(4);\n\n        _this.senateApprovalState = _knockout2.default.observable();\n        _this.senateFirm = _knockout2.default.observable();\n\n        _this.uproarLegions = _knockout2.default.observableArray();\n        _this.intrigueLegions = _knockout2.default.observableArray();\n        _this.adulationLegions = _knockout2.default.observableArray();\n        _this.fallenLegions = _knockout2.default.observableArray();\n\n        _this.senateApprovalText = _knockout2.default.pureComputed(function () {\n            return (_this.senateFirm() ? 'Firm ' : '') + _senateApprovalStates.SenateApprovalStateNames[_this.senateApprovalState()];\n        });\n\n        _this.offMapLegions = _knockout2.default.pureComputed(function () {\n            return _this.availableLegions().length + _this.fallenLegions().length + _this.adulationLegions().length + _this.intrigueLegions().length + _this.uproarLegions().length;\n        });\n        return _this;\n    }\n\n    _createClass(Romans, [{\n        key: 'victoryMargin',\n        value: function victoryMargin(state) {\n            return this.victoryScore(state) - 15;\n        }\n    }, {\n        key: 'victoryScore',\n        value: function victoryScore(state) {\n            return _lodash2.default.reduce(state.tribes, function (sum, tribe) {\n                if (tribe.isDispersed() || tribe.isSubdued() || tribe.isAllied() && tribe.alliedFactionId() === _factionIds2.default.ROMANS) {\n                    return sum + 1;\n                }\n                return sum;\n            }, 0);\n        }\n    }, {\n        key: 'isHomeRegion',\n        value: function isHomeRegion(region) {\n            return region.id === _regionIds2.default.PROVINCIA;\n        }\n    }, {\n        key: 'setSenateApproval',\n        value: function setSenateApproval(state) {\n            this.senateApprovalState(state);\n        }\n    }, {\n        key: 'hasAvailableAuxilia',\n        value: function hasAvailableAuxilia(count) {\n            return count <= this.availableAuxilia().length;\n        }\n    }, {\n        key: 'removeAuxilia',\n        value: function removeAuxilia(count) {\n            return this.availableAuxilia.splice(0, count);\n        }\n    }, {\n        key: 'returnAuxilia',\n        value: function returnAuxilia(auxilia) {\n            _lodash2.default.each(auxilia, function (piece) {\n                piece.revealed(false);\n            });\n            this.availableAuxilia.push.apply(this.availableAuxilia, auxilia);\n        }\n    }, {\n        key: 'hasAvailableForts',\n        value: function hasAvailableForts() {\n            return this.availableForts().length > 0;\n        }\n    }, {\n        key: 'removeFort',\n        value: function removeFort() {\n            return this.availableForts.pop();\n        }\n    }, {\n        key: 'returnFort',\n        value: function returnFort(fort) {\n            this.availableForts.push(fort);\n        }\n    }, {\n        key: 'initializeLegionTrack',\n        value: function initializeLegionTrack(state, count) {\n            var legionData = this.removeLegions(count);\n            var legions = legionData.legions;\n\n            if (state === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                this.uproarLegions.push.apply(this.uproarLegions, legions);\n            }\n            if (state === _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                this.intrigueLegions.push.apply(this.intrigueLegions, legions);\n            }\n            if (state === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                this.adulationLegions.push.apply(this.adulationLegions, legions);\n            }\n        }\n    }, {\n        key: 'hasAvailableLegions',\n        value: function hasAvailableLegions(count) {\n            var availableCount = this.availableLegions().length;\n\n            if (this.senateApprovalState() >= _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                availableCount += this.uproarLegions().length;\n            }\n            if (this.senateApprovalState() >= _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                availableCount += this.intrigueLegions().length;\n            }\n            if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                availableCount += this.adulationLegions().length;\n            }\n            return count <= availableCount;\n        }\n    }, {\n        key: 'getLegionsFromFallen',\n        value: function getLegionsFromFallen(count) {\n            return this.fallenLegions.splice(0, count);\n        }\n    }, {\n        key: 'removeLegions',\n        value: function removeLegions(count) {\n            var removedLegions = [];\n            var sourceCounts = {};\n            var numLeft = count;\n            var currentNumToRemove = 0;\n            if (this.availableLegions().length > 0) {\n                currentNumToRemove = Math.min(this.availableLegions().length, numLeft);\n                removedLegions.push.apply(removedLegions, this.availableLegions.splice(0, currentNumToRemove));\n                numLeft -= currentNumToRemove;\n            }\n            if (numLeft && this.senateApprovalState() >= _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                currentNumToRemove = Math.min(this.uproarLegions().length, numLeft);\n                if (currentNumToRemove > 0) {\n                    sourceCounts[_senateApprovalStates.SenateApprovalStates.UPROAR] = currentNumToRemove;\n                    removedLegions.push.apply(removedLegions, this.uproarLegions.splice(0, currentNumToRemove));\n                    numLeft -= currentNumToRemove;\n                }\n            }\n            if (numLeft && this.senateApprovalState() >= _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                currentNumToRemove = Math.min(this.intrigueLegions().length, numLeft);\n                if (currentNumToRemove > 0) {\n                    sourceCounts[_senateApprovalStates.SenateApprovalStates.INTRIGUE] = currentNumToRemove;\n                    removedLegions.push.apply(removedLegions, this.intrigueLegions.splice(0, currentNumToRemove));\n                    numLeft -= currentNumToRemove;\n                }\n            }\n            if (numLeft && this.senateApprovalState() >= _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                currentNumToRemove = Math.min(this.adulationLegions().length, numLeft);\n                if (currentNumToRemove > 0) {\n                    sourceCounts[_senateApprovalStates.SenateApprovalStates.ADULATION] = currentNumToRemove;\n                    removedLegions.push.apply(removedLegions, this.adulationLegions.splice(0, currentNumToRemove));\n                    numLeft -= currentNumToRemove;\n                }\n            }\n            return {\n                legions: removedLegions,\n                sourceCounts: sourceCounts\n            };\n        }\n    }, {\n        key: 'returnLegions',\n        value: function returnLegions(legions, track) {\n            if (track === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                this.uproarLegions.push.apply(this.uproarLegions, legions);\n            } else if (track === _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                this.intrigueLegions.push.apply(this.intrigueLegions, legions);\n            } else if (track === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                this.adulationLegions.push.apply(this.adulationLegions, legions);\n            } else {\n                this.fallenLegions.push.apply(this.fallenLegions, legions);\n            }\n        }\n    }, {\n        key: 'hasAvailableDispersalTokens',\n        value: function hasAvailableDispersalTokens() {\n            return this.availableDispersalTokens() > 0;\n        }\n    }, {\n        key: 'removeDispersalToken',\n        value: function removeDispersalToken() {\n            this.availableDispersalTokens(this.availableDispersalTokens() - 1);\n        }\n    }, {\n        key: 'returnDispersalToken',\n        value: function returnDispersalToken() {\n            this.availableDispersalTokens(this.availableDispersalTokens() + 1);\n        }\n    }, {\n        key: 'adjustSenateApproval',\n        value: function adjustSenateApproval(state) {\n            var romanVictory = this.victoryScore(state);\n            var currentSenateApproval = this.senateApprovalState();\n\n            var newSenateApprovalFromVictoryMargin = null;\n            if (romanVictory < 10) {\n                newSenateApprovalFromVictoryMargin = _senateApprovalStates.SenateApprovalStates.UPROAR;\n            } else if (romanVictory < 13) {\n                newSenateApprovalFromVictoryMargin = _senateApprovalStates.SenateApprovalStates.INTRIGUE;\n            } else {\n                newSenateApprovalFromVictoryMargin = _senateApprovalStates.SenateApprovalStates.ADULATION;\n            }\n\n            var newSenateApproval = currentSenateApproval;\n            var newFirm = this.senateFirm();\n\n            if (newSenateApprovalFromVictoryMargin > currentSenateApproval) {\n                if (this.fallenLegions().length > 0) {\n                    console.log('No change in approval due to fallen legions');\n                } else if (currentSenateApproval === _senateApprovalStates.SenateApprovalStates.UPROAR && this.senateFirm()) {\n                    newFirm = false;\n                } else {\n                    newSenateApproval = currentSenateApproval + 1;\n                }\n            } else if (currentSenateApproval === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                newFirm = true;\n            } else if (currentSenateApproval === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                newFirm = true;\n            } else if (newSenateApprovalFromVictoryMargin < currentSenateApproval) {\n                if (currentSenateApproval === _senateApprovalStates.SenateApprovalStates.ADULATION && this.senateFirm()) {\n                    newFirm = false;\n                } else {\n                    newSenateApproval = currentSenateApproval - 1;\n                }\n            }\n\n            if (newSenateApproval !== currentSenateApproval || newFirm !== this.senateFirm()) {\n                _changeSenateApproval2.default.execute(state, { approvalState: newSenateApproval, isFirm: newFirm });\n                this.logSenateApproval();\n            }\n        }\n    }, {\n        key: 'returnLegionsFromFallen',\n        value: function returnLegionsFromFallen(state) {\n            var args = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { spring: false };\n\n            var spring = args.spring;\n            var numFallenLegions = this.fallenLegions().length;\n            var numRemaining = spring ? 0 : Math.floor(numFallenLegions / 2.0);\n            var returning = numFallenLegions - numRemaining;\n\n            if (returning > 0) {\n                _returnFallenLegions2.default.execute(state, { count: returning });\n            }\n        }\n    }, {\n        key: 'returnLegionsToTracks',\n        value: function returnLegionsToTracks(legions) {\n            if (this.adulationLegions().length < 4) {\n                var numSlots = 4 - this.adulationLegions().length;\n                var numToReturn = Math.min(numSlots, legions.length);\n                this.adulationLegions.push.apply(this.adulationLegions, legions.splice(0, numToReturn));\n            }\n            if (legions.length > 0 && this.intrigueLegions().length < 4) {\n                var _numSlots = 4 - this.intrigueLegions().length;\n                var _numToReturn = Math.min(_numSlots, legions.length);\n                this.intrigueLegions.push.apply(this.intrigueLegions, legions.splice(0, _numToReturn));\n            }\n            if (legions.length > 0 && this.uproarLegions().length < 4) {\n                var _numSlots2 = 4 - this.uproarLegions().length;\n                var _numToReturn2 = Math.min(_numSlots2, legions.length);\n                this.uproarLegions.push.apply(this.uproarLegions, legions.splice(0, _numToReturn2));\n            }\n        }\n    }, {\n        key: 'placeWinterLegions',\n        value: function placeWinterLegions(state) {\n            var _this2 = this;\n\n            var numToPlace = _lodash2.default.reduce(_senateApprovalStates.SenateApprovalStates, function (sum, approvalState) {\n                if (_this2.senateApprovalState() < approvalState) {\n                    return sum;\n                }\n\n                if (approvalState === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                    return sum + _this2.uproarLegions().length;\n                } else if (approvalState === _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                    return sum + _this2.intrigueLegions().length;\n                } else if (approvalState === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                    return sum + _this2.adulationLegions().length;\n                }\n            }, 0);\n\n            if (numToPlace > 0) {\n                _placeLegions2.default.execute(state, {\n                    factionId: _factionIds2.default.ROMANS,\n                    regionId: _regionIds2.default.PROVINCIA,\n                    count: numToPlace\n                });\n            }\n        }\n    }, {\n        key: 'placeWinterAuxilia',\n        value: function placeWinterAuxilia(state) {\n            var provincia = state.regionsById[_regionIds2.default.PROVINCIA];\n            var leaderInProvincia = _lodash2.default.find(provincia.piecesByFaction[_factionIds2.default.ROMANS], { type: 'leader' });\n            if (leaderInProvincia && this.availableAuxilia().length > 0) {\n                if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                    _placeAuxilia2.default.execute(state, {\n                        factionId: this.id,\n                        regionId: provincia.id,\n                        count: Math.min(3, this.availableAuxilia().length)\n                    });\n                } else if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                    _placeAuxilia2.default.execute(state, {\n                        factionId: this.id,\n                        regionId: provincia.id,\n                        count: Math.min(4, this.availableAuxilia().length)\n                    });\n                } else if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                    _placeAuxilia2.default.execute(state, {\n                        factionId: this.id,\n                        regionId: provincia.id,\n                        count: Math.min(5, this.availableAuxilia().length)\n                    });\n                }\n            }\n        }\n    }, {\n        key: 'logSenateApproval',\n        value: function logSenateApproval() {\n            var approvalText = 'Senate is in a state of ';\n            if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.ADULATION) {\n                if (this.senateFirm()) {\n                    approvalText += 'firm adulation';\n                } else {\n                    approvalText += 'adulation';\n                }\n            } else if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.INTRIGUE) {\n                approvalText += 'intrigue';\n            }\n            if (this.senateApprovalState() === _senateApprovalStates.SenateApprovalStates.UPROAR) {\n                if (this.senateFirm()) {\n                    approvalText += 'firm uproar';\n                } else {\n                    approvalText += 'uproar';\n                }\n            }\n            console.log(approvalText);\n        }\n    }, {\n        key: 'logState',\n        value: function logState(state) {\n            console.log('*** ' + this.name + ' Faction ***');\n            if (state) {\n                console.log('    Victory Margin: ' + this.victoryMargin(state));\n            }\n            console.log('    Resources: ' + this.resources());\n            console.log('    Available Leader: ' + (this.availableLeader() ? this.availableLeader().toString() : 'None'));\n            console.log('    Available Forts: ' + this.availableForts().length);\n            console.log('    Available Allies: ' + this.availableAlliedTribes().length);\n            console.log('    Available Auxilia: ' + this.availableAuxilia().length);\n            console.log('    Senate Approval: ' + this.senateApprovalState() + (this.senateFirm() ? ' Firm' : ''));\n            console.log('    Uproar Legions: ' + this.uproarLegions().length);\n            console.log('    Intrigue Legions: ' + this.intrigueLegions().length);\n            console.log('    Adulation Legions: ' + this.adulationLegions().length);\n            console.log('    Fallen Legions: ' + this.fallenLegions().length);\n        }\n    }]);\n\n    return Romans;\n}(_fallingSkyFaction2.default);\n\nexports.default = Romans;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTczLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL3JvbWFucy5qcz83MzEwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4uLy4uL2xpYi9sb2Rhc2gnO1xuaW1wb3J0IGtvIGZyb20gJy4uLy4uL2xpYi9rbm9ja291dCc7XG5pbXBvcnQgRmFsbGluZ1NreUZhY3Rpb24gZnJvbSAnLi9mYWxsaW5nU2t5RmFjdGlvbic7XG5pbXBvcnQgUmVnaW9uSURzIGZyb20gJy4uL2NvbmZpZy9yZWdpb25JZHMnO1xuaW1wb3J0IEZhY3Rpb25JRHMgZnJvbSAnLi4vY29uZmlnL2ZhY3Rpb25JZHMnO1xuaW1wb3J0IEF1eGlsaWEgZnJvbSAnLi4vcGllY2VzL2F1eGlsaWEnO1xuaW1wb3J0IFBsYWNlQXV4aWxpYSBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcGxhY2VBdXhpbGlhJztcbmltcG9ydCBQbGFjZUxlZ2lvbnMgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL3BsYWNlTGVnaW9ucyc7XG5pbXBvcnQgUmV0dXJuRmFsbGVuTGVnaW9ucyBmcm9tICdmYWxsaW5nc2t5L2FjdGlvbnMvcmV0dXJuRmFsbGVuTGVnaW9ucyc7XG5pbXBvcnQgRm9ydCBmcm9tICcuLi9waWVjZXMvZm9ydCc7XG5pbXBvcnQgTGVnaW9uIGZyb20gJy4uL3BpZWNlcy9sZWdpb24nO1xuaW1wb3J0IHtTZW5hdGVBcHByb3ZhbFN0YXRlcywgU2VuYXRlQXBwcm92YWxTdGF0ZU5hbWVzfSBmcm9tICdmYWxsaW5nc2t5L2NvbmZpZy9zZW5hdGVBcHByb3ZhbFN0YXRlcyc7XG5pbXBvcnQgQ2hhbmdlU2VuYXRlQXBwcm92YWwgZnJvbSAnZmFsbGluZ3NreS9hY3Rpb25zL2NoYW5nZVNlbmF0ZUFwcHJvdmFsJztcblxuXG5jbGFzcyBSb21hbnMgZXh0ZW5kcyBGYWxsaW5nU2t5RmFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IGRlZmluaXRpb24gPSB7XG4gICAgICAgICAgICBpZDogRmFjdGlvbklEcy5ST01BTlMsXG4gICAgICAgICAgICBuYW1lOiAnUm9tYW5zJyxcbiAgICAgICAgICAgIG51bVdhcmJhbmRzOiAwLFxuICAgICAgICAgICAgbnVtQWxsaWVkVHJpYmVzOiA2LFxuICAgICAgICAgICAgbnVtQ2l0YWRlbHM6IDAsXG4gICAgICAgICAgICBoYXNMZWFkZXI6IHRydWUsXG4gICAgICAgICAgICBsZWFkZXJOYW1lOiAnSnVsaXVzIENhZXNhcicsXG4gICAgICAgICAgICBwYXNzUmVzb3VyY2VzOiAyXG4gICAgICAgIH07XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlQXV4aWxpYSA9IGtvLm9ic2VydmFibGVBcnJheShcbiAgICAgICAgICAgIF8ubWFwKFxuICAgICAgICAgICAgICAgIF8ucmFuZ2UoMjApLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQXV4aWxpYSh7ZmFjdGlvbklkOiBkZWZpbml0aW9uLmlkfSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlRm9ydHMgPSBrby5vYnNlcnZhYmxlQXJyYXkoXG4gICAgICAgICAgICBfLm1hcChcbiAgICAgICAgICAgICAgICBfLnJhbmdlKDYpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ydCh7ZmFjdGlvbklkOiBkZWZpbml0aW9uLmlkfSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlTGVnaW9ucyA9IGtvLm9ic2VydmFibGVBcnJheShcbiAgICAgICAgICAgIF8ubWFwKFxuICAgICAgICAgICAgICAgIF8ucmFuZ2UoMTIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTGVnaW9uKHtmYWN0aW9uSWQ6IGRlZmluaXRpb24uaWR9KTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy5hdmFpbGFibGVEaXNwZXJzYWxUb2tlbnMgPSBrby5vYnNlcnZhYmxlKDQpO1xuXG4gICAgICAgIHRoaXMuc2VuYXRlQXBwcm92YWxTdGF0ZSA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5zZW5hdGVGaXJtID0ga28ub2JzZXJ2YWJsZSgpO1xuXG4gICAgICAgIHRoaXMudXByb2FyTGVnaW9ucyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmludHJpZ3VlTGVnaW9ucyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmFkdWxhdGlvbkxlZ2lvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgICAgICAgdGhpcy5mYWxsZW5MZWdpb25zID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XG5cbiAgICAgICAgdGhpcy5zZW5hdGVBcHByb3ZhbFRleHQgPSBrby5wdXJlQ29tcHV0ZWQoKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnNlbmF0ZUZpcm0oKSA/ICdGaXJtICcgOiAnJykgKyBTZW5hdGVBcHByb3ZhbFN0YXRlTmFtZXNbdGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCldO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9mZk1hcExlZ2lvbnMgPSBrby5wdXJlQ29tcHV0ZWQoXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlTGVnaW9ucygpLmxlbmd0aCArXG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFsbGVuTGVnaW9ucygpLmxlbmd0aCArXG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWR1bGF0aW9uTGVnaW9ucygpLmxlbmd0aCArXG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW50cmlndWVMZWdpb25zKCkubGVuZ3RoICtcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cHJvYXJMZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmljdG9yeU1hcmdpbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy52aWN0b3J5U2NvcmUoc3RhdGUpIC0gMTU7XG4gICAgfVxuXG4gICAgdmljdG9yeVNjb3JlKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiBfLnJlZHVjZShcbiAgICAgICAgICAgIHN0YXRlLnRyaWJlcywgZnVuY3Rpb24gKHN1bSwgdHJpYmUpIHtcbiAgICAgICAgICAgICAgICBpZiAodHJpYmUuaXNEaXNwZXJzZWQoKSB8fCB0cmliZS5pc1N1YmR1ZWQoKSB8fCAodHJpYmUuaXNBbGxpZWQoKSAmJiB0cmliZS5hbGxpZWRGYWN0aW9uSWQoKSA9PT0gRmFjdGlvbklEcy5ST01BTlMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgaXNIb21lUmVnaW9uKHJlZ2lvbikge1xuICAgICAgICByZXR1cm4gcmVnaW9uLmlkID09PSBSZWdpb25JRHMuUFJPVklOQ0lBO1xuICAgIH1cblxuICAgIHNldFNlbmF0ZUFwcHJvdmFsKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuc2VuYXRlQXBwcm92YWxTdGF0ZShzdGF0ZSk7XG4gICAgfVxuXG4gICAgaGFzQXZhaWxhYmxlQXV4aWxpYShjb3VudCkge1xuICAgICAgICByZXR1cm4gY291bnQgPD0gdGhpcy5hdmFpbGFibGVBdXhpbGlhKCkubGVuZ3RoO1xuICAgIH1cblxuICAgIHJlbW92ZUF1eGlsaWEoY291bnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlQXV4aWxpYS5zcGxpY2UoMCwgY291bnQpO1xuICAgIH1cblxuICAgIHJldHVybkF1eGlsaWEoYXV4aWxpYSkge1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICBhdXhpbGlhLCBmdW5jdGlvbiAocGllY2UpIHtcbiAgICAgICAgICAgICAgICBwaWVjZS5yZXZlYWxlZChmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hdmFpbGFibGVBdXhpbGlhLnB1c2guYXBwbHkodGhpcy5hdmFpbGFibGVBdXhpbGlhLCBhdXhpbGlhKTtcbiAgICB9XG5cbiAgICBoYXNBdmFpbGFibGVGb3J0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlRm9ydHMoKS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHJlbW92ZUZvcnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF2YWlsYWJsZUZvcnRzLnBvcCgpO1xuICAgIH1cblxuICAgIHJldHVybkZvcnQoZm9ydCkge1xuICAgICAgICB0aGlzLmF2YWlsYWJsZUZvcnRzLnB1c2goZm9ydCk7XG4gICAgfVxuXG4gICAgaW5pdGlhbGl6ZUxlZ2lvblRyYWNrKHN0YXRlLCBjb3VudCkge1xuICAgICAgICBjb25zdCBsZWdpb25EYXRhID0gdGhpcy5yZW1vdmVMZWdpb25zKGNvdW50KTtcbiAgICAgICAgY29uc3QgbGVnaW9ucyA9IGxlZ2lvbkRhdGEubGVnaW9ucztcblxuICAgICAgICBpZiAoc3RhdGUgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLlVQUk9BUikge1xuICAgICAgICAgICAgdGhpcy51cHJvYXJMZWdpb25zLnB1c2guYXBwbHkodGhpcy51cHJvYXJMZWdpb25zLCBsZWdpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFKSB7XG4gICAgICAgICAgICB0aGlzLmludHJpZ3VlTGVnaW9ucy5wdXNoLmFwcGx5KHRoaXMuaW50cmlndWVMZWdpb25zLCBsZWdpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTikge1xuICAgICAgICAgICAgdGhpcy5hZHVsYXRpb25MZWdpb25zLnB1c2guYXBwbHkodGhpcy5hZHVsYXRpb25MZWdpb25zLCBsZWdpb25zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc0F2YWlsYWJsZUxlZ2lvbnMoY291bnQpIHtcbiAgICAgICAgbGV0IGF2YWlsYWJsZUNvdW50ID0gdGhpcy5hdmFpbGFibGVMZWdpb25zKCkubGVuZ3RoO1xuXG4gICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA+PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5VUFJPQVIpIHtcbiAgICAgICAgICAgIGF2YWlsYWJsZUNvdW50ICs9IHRoaXMudXByb2FyTGVnaW9ucygpLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCkgPj0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuSU5UUklHVUUpIHtcbiAgICAgICAgICAgIGF2YWlsYWJsZUNvdW50ICs9IHRoaXMuaW50cmlndWVMZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuQURVTEFUSU9OKSB7XG4gICAgICAgICAgICBhdmFpbGFibGVDb3VudCArPSB0aGlzLmFkdWxhdGlvbkxlZ2lvbnMoKS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvdW50IDw9IGF2YWlsYWJsZUNvdW50O1xuICAgIH1cblxuICAgIGdldExlZ2lvbnNGcm9tRmFsbGVuKGNvdW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZhbGxlbkxlZ2lvbnMuc3BsaWNlKDAsIGNvdW50KTtcbiAgICB9XG5cbiAgICByZW1vdmVMZWdpb25zKGNvdW50KSB7XG4gICAgICAgIGNvbnN0IHJlbW92ZWRMZWdpb25zID0gW107XG4gICAgICAgIGNvbnN0IHNvdXJjZUNvdW50cyA9IHt9O1xuICAgICAgICBsZXQgbnVtTGVmdCA9IGNvdW50O1xuICAgICAgICBsZXQgY3VycmVudE51bVRvUmVtb3ZlID0gMDtcbiAgICAgICAgaWYgKHRoaXMuYXZhaWxhYmxlTGVnaW9ucygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGN1cnJlbnROdW1Ub1JlbW92ZSA9IE1hdGgubWluKHRoaXMuYXZhaWxhYmxlTGVnaW9ucygpLmxlbmd0aCwgbnVtTGVmdCk7XG4gICAgICAgICAgICByZW1vdmVkTGVnaW9ucy5wdXNoLmFwcGx5KHJlbW92ZWRMZWdpb25zLCB0aGlzLmF2YWlsYWJsZUxlZ2lvbnMuc3BsaWNlKDAsIGN1cnJlbnROdW1Ub1JlbW92ZSkpO1xuICAgICAgICAgICAgbnVtTGVmdCAtPSBjdXJyZW50TnVtVG9SZW1vdmU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG51bUxlZnQgJiYgdGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCkgPj0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICBjdXJyZW50TnVtVG9SZW1vdmUgPSBNYXRoLm1pbih0aGlzLnVwcm9hckxlZ2lvbnMoKS5sZW5ndGgsIG51bUxlZnQpO1xuICAgICAgICAgICAgaWYoY3VycmVudE51bVRvUmVtb3ZlID4gMCkge1xuICAgICAgICAgICAgICAgIHNvdXJjZUNvdW50c1tTZW5hdGVBcHByb3ZhbFN0YXRlcy5VUFJPQVJdID0gY3VycmVudE51bVRvUmVtb3ZlO1xuICAgICAgICAgICAgICAgIHJlbW92ZWRMZWdpb25zLnB1c2guYXBwbHkocmVtb3ZlZExlZ2lvbnMsIHRoaXMudXByb2FyTGVnaW9ucy5zcGxpY2UoMCwgY3VycmVudE51bVRvUmVtb3ZlKSk7XG4gICAgICAgICAgICAgICAgbnVtTGVmdCAtPSBjdXJyZW50TnVtVG9SZW1vdmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG51bUxlZnQgJiYgdGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCkgPj0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuSU5UUklHVUUpIHtcbiAgICAgICAgICAgIGN1cnJlbnROdW1Ub1JlbW92ZSA9IE1hdGgubWluKHRoaXMuaW50cmlndWVMZWdpb25zKCkubGVuZ3RoLCBudW1MZWZ0KTtcbiAgICAgICAgICAgIGlmKGN1cnJlbnROdW1Ub1JlbW92ZSA+IDApIHtcbiAgICAgICAgICAgICAgICBzb3VyY2VDb3VudHNbU2VuYXRlQXBwcm92YWxTdGF0ZXMuSU5UUklHVUVdID0gY3VycmVudE51bVRvUmVtb3ZlO1xuICAgICAgICAgICAgICAgIHJlbW92ZWRMZWdpb25zLnB1c2guYXBwbHkocmVtb3ZlZExlZ2lvbnMsIHRoaXMuaW50cmlndWVMZWdpb25zLnNwbGljZSgwLCBjdXJyZW50TnVtVG9SZW1vdmUpKTtcbiAgICAgICAgICAgICAgICBudW1MZWZ0IC09IGN1cnJlbnROdW1Ub1JlbW92ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobnVtTGVmdCAmJiB0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA+PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5BRFVMQVRJT04pIHtcbiAgICAgICAgICAgIGN1cnJlbnROdW1Ub1JlbW92ZSA9IE1hdGgubWluKHRoaXMuYWR1bGF0aW9uTGVnaW9ucygpLmxlbmd0aCwgbnVtTGVmdCk7XG4gICAgICAgICAgICBpZihjdXJyZW50TnVtVG9SZW1vdmUgPiAwKSB7XG4gICAgICAgICAgICAgICAgc291cmNlQ291bnRzW1NlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTl0gPSBjdXJyZW50TnVtVG9SZW1vdmU7XG4gICAgICAgICAgICAgICAgcmVtb3ZlZExlZ2lvbnMucHVzaC5hcHBseShyZW1vdmVkTGVnaW9ucywgdGhpcy5hZHVsYXRpb25MZWdpb25zLnNwbGljZSgwLCBjdXJyZW50TnVtVG9SZW1vdmUpKTtcbiAgICAgICAgICAgICAgICBudW1MZWZ0IC09IGN1cnJlbnROdW1Ub1JlbW92ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVnaW9uczogcmVtb3ZlZExlZ2lvbnMsXG4gICAgICAgICAgICBzb3VyY2VDb3VudHNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm5MZWdpb25zKGxlZ2lvbnMsIHRyYWNrKSB7XG4gICAgICAgIGlmICh0cmFjayA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICB0aGlzLnVwcm9hckxlZ2lvbnMucHVzaC5hcHBseSh0aGlzLnVwcm9hckxlZ2lvbnMsIGxlZ2lvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRyYWNrID09PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5JTlRSSUdVRSkge1xuICAgICAgICAgICAgdGhpcy5pbnRyaWd1ZUxlZ2lvbnMucHVzaC5hcHBseSh0aGlzLmludHJpZ3VlTGVnaW9ucywgbGVnaW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHJhY2sgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTikge1xuICAgICAgICAgICAgdGhpcy5hZHVsYXRpb25MZWdpb25zLnB1c2guYXBwbHkodGhpcy5hZHVsYXRpb25MZWdpb25zLCBsZWdpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmFsbGVuTGVnaW9ucy5wdXNoLmFwcGx5KHRoaXMuZmFsbGVuTGVnaW9ucywgbGVnaW9ucyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYXNBdmFpbGFibGVEaXNwZXJzYWxUb2tlbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF2YWlsYWJsZURpc3BlcnNhbFRva2VucygpID4gMDtcbiAgICB9XG5cbiAgICByZW1vdmVEaXNwZXJzYWxUb2tlbigpIHtcbiAgICAgICAgdGhpcy5hdmFpbGFibGVEaXNwZXJzYWxUb2tlbnModGhpcy5hdmFpbGFibGVEaXNwZXJzYWxUb2tlbnMoKSAtIDEpO1xuICAgIH1cblxuICAgIHJldHVybkRpc3BlcnNhbFRva2VuKCkge1xuICAgICAgICB0aGlzLmF2YWlsYWJsZURpc3BlcnNhbFRva2Vucyh0aGlzLmF2YWlsYWJsZURpc3BlcnNhbFRva2VucygpICsgMSk7XG4gICAgfVxuXG4gICAgYWRqdXN0U2VuYXRlQXBwcm92YWwoc3RhdGUpIHtcbiAgICAgICAgY29uc3Qgcm9tYW5WaWN0b3J5ID0gdGhpcy52aWN0b3J5U2NvcmUoc3RhdGUpO1xuICAgICAgICBjb25zdCBjdXJyZW50U2VuYXRlQXBwcm92YWwgPSB0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKTtcblxuICAgICAgICBsZXQgbmV3U2VuYXRlQXBwcm92YWxGcm9tVmljdG9yeU1hcmdpbiA9IG51bGw7XG4gICAgICAgIGlmIChyb21hblZpY3RvcnkgPCAxMCkge1xuICAgICAgICAgICAgbmV3U2VuYXRlQXBwcm92YWxGcm9tVmljdG9yeU1hcmdpbiA9IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLlVQUk9BUjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyb21hblZpY3RvcnkgPCAxMykge1xuICAgICAgICAgICAgbmV3U2VuYXRlQXBwcm92YWxGcm9tVmljdG9yeU1hcmdpbiA9IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3U2VuYXRlQXBwcm92YWxGcm9tVmljdG9yeU1hcmdpbiA9IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBuZXdTZW5hdGVBcHByb3ZhbCA9IGN1cnJlbnRTZW5hdGVBcHByb3ZhbDtcbiAgICAgICAgbGV0IG5ld0Zpcm0gPSB0aGlzLnNlbmF0ZUZpcm0oKTtcblxuICAgICAgICBpZiAobmV3U2VuYXRlQXBwcm92YWxGcm9tVmljdG9yeU1hcmdpbiA+IGN1cnJlbnRTZW5hdGVBcHByb3ZhbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmFsbGVuTGVnaW9ucygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gY2hhbmdlIGluIGFwcHJvdmFsIGR1ZSB0byBmYWxsZW4gbGVnaW9ucycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudFNlbmF0ZUFwcHJvdmFsID09PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5VUFJPQVIgJiYgdGhpcy5zZW5hdGVGaXJtKCkpIHtcbiAgICAgICAgICAgICAgICBuZXdGaXJtID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdTZW5hdGVBcHByb3ZhbCA9IGN1cnJlbnRTZW5hdGVBcHByb3ZhbCArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudFNlbmF0ZUFwcHJvdmFsID09PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5BRFVMQVRJT04pIHtcbiAgICAgICAgICAgIG5ld0Zpcm0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRTZW5hdGVBcHByb3ZhbCA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICBuZXdGaXJtID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChuZXdTZW5hdGVBcHByb3ZhbEZyb21WaWN0b3J5TWFyZ2luIDwgY3VycmVudFNlbmF0ZUFwcHJvdmFsKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFNlbmF0ZUFwcHJvdmFsID09PSBTZW5hdGVBcHByb3ZhbFN0YXRlcy5BRFVMQVRJT04gJiYgdGhpcy5zZW5hdGVGaXJtKCkpIHtcbiAgICAgICAgICAgICAgICBuZXdGaXJtID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdTZW5hdGVBcHByb3ZhbCA9IGN1cnJlbnRTZW5hdGVBcHByb3ZhbCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3U2VuYXRlQXBwcm92YWwgIT09IGN1cnJlbnRTZW5hdGVBcHByb3ZhbCB8fCBuZXdGaXJtICE9PSB0aGlzLnNlbmF0ZUZpcm0oKSkge1xuICAgICAgICAgICAgQ2hhbmdlU2VuYXRlQXBwcm92YWwuZXhlY3V0ZShzdGF0ZSwge2FwcHJvdmFsU3RhdGU6IG5ld1NlbmF0ZUFwcHJvdmFsLCBpc0Zpcm06IG5ld0Zpcm19KTtcbiAgICAgICAgICAgIHRoaXMubG9nU2VuYXRlQXBwcm92YWwoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybkxlZ2lvbnNGcm9tRmFsbGVuKHN0YXRlLCBhcmdzID0ge3NwcmluZzogZmFsc2V9KSB7XG4gICAgICAgIGNvbnN0IHNwcmluZyA9IGFyZ3Muc3ByaW5nO1xuICAgICAgICBjb25zdCBudW1GYWxsZW5MZWdpb25zID0gdGhpcy5mYWxsZW5MZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCBudW1SZW1haW5pbmcgPSBzcHJpbmcgPyAwIDogTWF0aC5mbG9vcihudW1GYWxsZW5MZWdpb25zIC8gMi4wKTtcbiAgICAgICAgY29uc3QgcmV0dXJuaW5nID0gbnVtRmFsbGVuTGVnaW9ucyAtIG51bVJlbWFpbmluZztcblxuICAgICAgICBpZihyZXR1cm5pbmcgPiAwKSB7XG4gICAgICAgICAgICBSZXR1cm5GYWxsZW5MZWdpb25zLmV4ZWN1dGUoc3RhdGUsIHtjb3VudDogcmV0dXJuaW5nfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm5MZWdpb25zVG9UcmFja3MobGVnaW9ucykge1xuICAgICAgICBpZiAodGhpcy5hZHVsYXRpb25MZWdpb25zKCkubGVuZ3RoIDwgNCkge1xuICAgICAgICAgICAgY29uc3QgbnVtU2xvdHMgPSA0IC0gdGhpcy5hZHVsYXRpb25MZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgbnVtVG9SZXR1cm4gPSBNYXRoLm1pbihudW1TbG90cywgbGVnaW9ucy5sZW5ndGgpO1xuICAgICAgICAgICAgdGhpcy5hZHVsYXRpb25MZWdpb25zLnB1c2guYXBwbHkodGhpcy5hZHVsYXRpb25MZWdpb25zLCBsZWdpb25zLnNwbGljZSgwLCBudW1Ub1JldHVybikpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZWdpb25zLmxlbmd0aCA+IDAgJiYgdGhpcy5pbnRyaWd1ZUxlZ2lvbnMoKS5sZW5ndGggPCA0KSB7XG4gICAgICAgICAgICBjb25zdCBudW1TbG90cyA9IDQgLSB0aGlzLmludHJpZ3VlTGVnaW9ucygpLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IG51bVRvUmV0dXJuID0gTWF0aC5taW4obnVtU2xvdHMsIGxlZ2lvbnMubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuaW50cmlndWVMZWdpb25zLnB1c2guYXBwbHkodGhpcy5pbnRyaWd1ZUxlZ2lvbnMsIGxlZ2lvbnMuc3BsaWNlKDAsIG51bVRvUmV0dXJuKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlZ2lvbnMubGVuZ3RoID4gMCAmJiB0aGlzLnVwcm9hckxlZ2lvbnMoKS5sZW5ndGggPCA0KSB7XG4gICAgICAgICAgICBjb25zdCBudW1TbG90cyA9IDQgLSB0aGlzLnVwcm9hckxlZ2lvbnMoKS5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBudW1Ub1JldHVybiA9IE1hdGgubWluKG51bVNsb3RzLCBsZWdpb25zLmxlbmd0aCk7XG4gICAgICAgICAgICB0aGlzLnVwcm9hckxlZ2lvbnMucHVzaC5hcHBseSh0aGlzLnVwcm9hckxlZ2lvbnMsIGxlZ2lvbnMuc3BsaWNlKDAsIG51bVRvUmV0dXJuKSk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIHBsYWNlV2ludGVyTGVnaW9ucyhzdGF0ZSkge1xuICAgICAgICBjb25zdCBudW1Ub1BsYWNlID0gXy5yZWR1Y2UoU2VuYXRlQXBwcm92YWxTdGF0ZXMsIChzdW0sIGFwcHJvdmFsU3RhdGUpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA8IGFwcHJvdmFsU3RhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VtO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXBwcm92YWxTdGF0ZSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHRoaXMudXByb2FyTGVnaW9ucygpLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFwcHJvdmFsU3RhdGUgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHRoaXMuaW50cmlndWVMZWdpb25zKCkubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXBwcm92YWxTdGF0ZSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuQURVTEFUSU9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIHRoaXMuYWR1bGF0aW9uTGVnaW9ucygpLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgaWYgKG51bVRvUGxhY2UgPiAwKSB7XG4gICAgICAgICAgICBQbGFjZUxlZ2lvbnMuZXhlY3V0ZShzdGF0ZSwge1xuICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogRmFjdGlvbklEcy5ST01BTlMsXG4gICAgICAgICAgICAgICAgcmVnaW9uSWQ6IFJlZ2lvbklEcy5QUk9WSU5DSUEsXG4gICAgICAgICAgICAgICAgY291bnQ6IG51bVRvUGxhY2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwbGFjZVdpbnRlckF1eGlsaWEoc3RhdGUpIHtcbiAgICAgICAgY29uc3QgcHJvdmluY2lhID0gc3RhdGUucmVnaW9uc0J5SWRbUmVnaW9uSURzLlBST1ZJTkNJQV07XG4gICAgICAgIGNvbnN0IGxlYWRlckluUHJvdmluY2lhID0gXy5maW5kKHByb3ZpbmNpYS5waWVjZXNCeUZhY3Rpb25bRmFjdGlvbklEcy5ST01BTlNdLCB7dHlwZTogJ2xlYWRlcid9KTtcbiAgICAgICAgaWYgKGxlYWRlckluUHJvdmluY2lhICYmIHRoaXMuYXZhaWxhYmxlQXV4aWxpYSgpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICAgICAgUGxhY2VBdXhpbGlhLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcHJvdmluY2lhLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogTWF0aC5taW4oMywgdGhpcy5hdmFpbGFibGVBdXhpbGlhKCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCkgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFKSB7XG4gICAgICAgICAgICAgICAgUGxhY2VBdXhpbGlhLmV4ZWN1dGUoc3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgZmFjdGlvbklkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgICAgICByZWdpb25JZDogcHJvdmluY2lhLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogTWF0aC5taW4oNCwgdGhpcy5hdmFpbGFibGVBdXhpbGlhKCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZW5hdGVBcHByb3ZhbFN0YXRlKCkgPT09IFNlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTikge1xuICAgICAgICAgICAgICAgIFBsYWNlQXV4aWxpYS5leGVjdXRlKHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgICAgIGZhY3Rpb25JZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uSWQ6IHByb3ZpbmNpYS5pZCxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IE1hdGgubWluKDUsIHRoaXMuYXZhaWxhYmxlQXV4aWxpYSgpLmxlbmd0aClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvZ1NlbmF0ZUFwcHJvdmFsKCkge1xuICAgICAgICBsZXQgYXBwcm92YWxUZXh0ID0gJ1NlbmF0ZSBpcyBpbiBhIHN0YXRlIG9mICc7XG4gICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuQURVTEFUSU9OKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZW5hdGVGaXJtKCkpIHtcbiAgICAgICAgICAgICAgICBhcHByb3ZhbFRleHQgKz0gJ2Zpcm0gYWR1bGF0aW9uJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwcHJvdmFsVGV4dCArPSAnYWR1bGF0aW9uJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuSU5UUklHVUUpIHtcbiAgICAgICAgICAgIGFwcHJvdmFsVGV4dCArPSAnaW50cmlndWUnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSA9PT0gU2VuYXRlQXBwcm92YWxTdGF0ZXMuVVBST0FSKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZW5hdGVGaXJtKCkpIHtcbiAgICAgICAgICAgICAgICBhcHByb3ZhbFRleHQgKz0gJ2Zpcm0gdXByb2FyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwcHJvdmFsVGV4dCArPSAndXByb2FyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhhcHByb3ZhbFRleHQpO1xuICAgIH1cblxuICAgIGxvZ1N0YXRlKHN0YXRlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKiogJyArIHRoaXMubmFtZSArICcgRmFjdGlvbiAqKionKTtcbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnICAgIFZpY3RvcnkgTWFyZ2luOiAnICsgdGhpcy52aWN0b3J5TWFyZ2luKHN0YXRlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJyAgICBSZXNvdXJjZXM6ICcgKyB0aGlzLnJlc291cmNlcygpKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBBdmFpbGFibGUgTGVhZGVyOiAnICsgKHRoaXMuYXZhaWxhYmxlTGVhZGVyKCkgPyB0aGlzLmF2YWlsYWJsZUxlYWRlcigpLnRvU3RyaW5nKCkgOiAnTm9uZScpKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBBdmFpbGFibGUgRm9ydHM6ICcgKyB0aGlzLmF2YWlsYWJsZUZvcnRzKCkubGVuZ3RoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBBdmFpbGFibGUgQWxsaWVzOiAnICsgdGhpcy5hdmFpbGFibGVBbGxpZWRUcmliZXMoKS5sZW5ndGgpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAgIEF2YWlsYWJsZSBBdXhpbGlhOiAnICsgdGhpcy5hdmFpbGFibGVBdXhpbGlhKCkubGVuZ3RoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBTZW5hdGUgQXBwcm92YWw6ICcgKyB0aGlzLnNlbmF0ZUFwcHJvdmFsU3RhdGUoKSArICh0aGlzLnNlbmF0ZUZpcm0oKSA/ICcgRmlybScgOiAnJykpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAgIFVwcm9hciBMZWdpb25zOiAnICsgdGhpcy51cHJvYXJMZWdpb25zKCkubGVuZ3RoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBJbnRyaWd1ZSBMZWdpb25zOiAnICsgdGhpcy5pbnRyaWd1ZUxlZ2lvbnMoKS5sZW5ndGgpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAgIEFkdWxhdGlvbiBMZWdpb25zOiAnICsgdGhpcy5hZHVsYXRpb25MZWdpb25zKCkubGVuZ3RoKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgICBGYWxsZW4gTGVnaW9uczogJyArIHRoaXMuZmFsbGVuTGVnaW9ucygpLmxlbmd0aCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSb21hbnM7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L2ZhY3Rpb25zL3JvbWFucy5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFFQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFDQTtBQUZBO0FBQ0E7QUFZQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBcERBO0FBcURBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 174 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar BalearicSlingersDeclaration = function (_PlayerInteraction) {\n    _inherits(BalearicSlingersDeclaration, _PlayerInteraction);\n\n    function BalearicSlingersDeclaration(definition) {\n        _classCallCheck(this, BalearicSlingersDeclaration);\n\n        definition.type = 'BalearicSlingersDeclaration';\n\n        var _this = _possibleConstructorReturn(this, (BalearicSlingersDeclaration.__proto__ || Object.getPrototypeOf(BalearicSlingersDeclaration)).call(this, definition));\n\n        _this.regionId = definition.regionId;\n        _this.defendingFactionId = definition.defendingFactionId;\n        return _this;\n    }\n\n    return BalearicSlingersDeclaration;\n}(_playerInteraction2.default);\n\nexports.default = BalearicSlingersDeclaration;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9iYWxlYXJpY1NsaW5nZXJzRGVjbGFyYXRpb24uanM/Y2IwNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgQmFsZWFyaWNTbGluZ2Vyc0RlY2xhcmF0aW9uIGV4dGVuZHMgUGxheWVySW50ZXJhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ0JhbGVhcmljU2xpbmdlcnNEZWNsYXJhdGlvbic7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gZGVmaW5pdGlvbi5yZWdpb25JZDtcbiAgICAgICAgdGhpcy5kZWZlbmRpbmdGYWN0aW9uSWQgPSBkZWZpbml0aW9uLmRlZmVuZGluZ0ZhY3Rpb25JZDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEJhbGVhcmljU2xpbmdlcnNEZWNsYXJhdGlvbjtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL2JhbGVhcmljU2xpbmdlcnNEZWNsYXJhdGlvbi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUZBO0FBQ0E7QUFFQTtBQUNBO0FBSkE7QUFLQTtBQUNBOzs7O0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 175 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GermanicHorseDeclaration = function (_PlayerInteraction) {\n    _inherits(GermanicHorseDeclaration, _PlayerInteraction);\n\n    function GermanicHorseDeclaration(definition) {\n        _classCallCheck(this, GermanicHorseDeclaration);\n\n        definition.type = 'GermanicHorseDeclaration';\n\n        var _this = _possibleConstructorReturn(this, (GermanicHorseDeclaration.__proto__ || Object.getPrototypeOf(GermanicHorseDeclaration)).call(this, definition));\n\n        _this.regionId = definition.regionId;\n        return _this;\n    }\n\n    return GermanicHorseDeclaration;\n}(_playerInteraction2.default);\n\nexports.default = GermanicHorseDeclaration;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9nZXJtYW5pY0hvcnNlRGVjbGFyYXRpb24uanM/ZWVlMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgR2VybWFuaWNIb3JzZURlY2xhcmF0aW9uIGV4dGVuZHMgUGxheWVySW50ZXJhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ0dlcm1hbmljSG9yc2VEZWNsYXJhdGlvbic7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gZGVmaW5pdGlvbi5yZWdpb25JZDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdlcm1hbmljSG9yc2VEZWNsYXJhdGlvbjtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL2dlcm1hbmljSG9yc2VEZWNsYXJhdGlvbi5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUZBO0FBQ0E7QUFFQTtBQUhBO0FBSUE7QUFDQTs7OztBQUVBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 176 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Losses = function (_PlayerInteraction) {\n    _inherits(Losses, _PlayerInteraction);\n\n    function Losses(definition) {\n        _classCallCheck(this, Losses);\n\n        definition.type = 'Losses';\n\n        // This part is for the request\n        var _this = _possibleConstructorReturn(this, (Losses.__proto__ || Object.getPrototypeOf(Losses)).call(this, definition));\n\n        _this.ambush = false;\n        _this.retreated = false;\n        _this.balearicSlingers = false;\n        _this.massedGallicArchers = false;\n        _this.regionId = definition.regionId;\n        _this.losses = definition.losses;\n\n        // This part is for the response\n        _this.caesarCanCounterattack = false;\n        _this.removed = definition.removed;\n        return _this;\n    }\n\n    return Losses;\n}(_playerInteraction2.default);\n\nexports.default = Losses;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9sb3NzZXMuanM/NzJjNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgTG9zc2VzIGV4dGVuZHMgUGxheWVySW50ZXJhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ0xvc3Nlcyc7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuXG4gICAgICAgIC8vIFRoaXMgcGFydCBpcyBmb3IgdGhlIHJlcXVlc3RcbiAgICAgICAgdGhpcy5hbWJ1c2ggPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXRyZWF0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5iYWxlYXJpY1NsaW5nZXJzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWFzc2VkR2FsbGljQXJjaGVycyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlZ2lvbklkID0gZGVmaW5pdGlvbi5yZWdpb25JZDtcbiAgICAgICAgdGhpcy5sb3NzZXMgPSBkZWZpbml0aW9uLmxvc3NlcztcblxuICAgICAgICAvLyBUaGlzIHBhcnQgaXMgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICB0aGlzLmNhZXNhckNhbkNvdW50ZXJhdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZW1vdmVkID0gZGVmaW5pdGlvbi5yZW1vdmVkO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9zc2VzO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvbG9zc2VzLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFKQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFkQTtBQWVBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 177 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Retreat = function (_PlayerInteraction) {\n    _inherits(Retreat, _PlayerInteraction);\n\n    function Retreat(definition) {\n        _classCallCheck(this, Retreat);\n\n        definition.type = 'Retreat';\n\n        var _this = _possibleConstructorReturn(this, (Retreat.__proto__ || Object.getPrototypeOf(Retreat)).call(this, definition));\n\n        _this.regionId = definition.regionId;\n        return _this;\n    }\n\n    return Retreat;\n}(_playerInteraction2.default);\n\nexports.default = Retreat;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9yZXRyZWF0LmpzP2RmYjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsYXllckludGVyYWN0aW9uIGZyb20gJ2NvbW1vbi9wbGF5ZXJJbnRlcmFjdGlvbic7XG5cbmNsYXNzIFJldHJlYXQgZXh0ZW5kcyBQbGF5ZXJJbnRlcmFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICBkZWZpbml0aW9uLnR5cGUgPSAnUmV0cmVhdCc7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuXG4gICAgICAgIHRoaXMucmVnaW9uSWQgPSBkZWZpbml0aW9uLnJlZ2lvbklkO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmV0cmVhdDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvaW50ZXJhY3Rpb25zL3JldHJlYXQuanMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFGQTtBQUNBO0FBR0E7QUFKQTtBQUtBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 178 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _playerInteraction = __webpack_require__(18);\n\nvar _playerInteraction2 = _interopRequireDefault(_playerInteraction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RetreatDeclaration = function (_PlayerInteraction) {\n    _inherits(RetreatDeclaration, _PlayerInteraction);\n\n    function RetreatDeclaration(definition) {\n        _classCallCheck(this, RetreatDeclaration);\n\n        definition.type = 'RetreatDeclaration';\n\n        var _this = _possibleConstructorReturn(this, (RetreatDeclaration.__proto__ || Object.getPrototypeOf(RetreatDeclaration)).call(this, definition));\n\n        _this.regionId = definition.regionId;\n        return _this;\n    }\n\n    return RetreatDeclaration;\n}(_playerInteraction2.default);\n\nexports.default = RetreatDeclaration;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L2ludGVyYWN0aW9ucy9yZXRyZWF0RGVjbGFyYXRpb24uanM/MDI1ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVySW50ZXJhY3Rpb24gZnJvbSAnY29tbW9uL3BsYXllckludGVyYWN0aW9uJztcblxuY2xhc3MgUmV0cmVhdERlY2xhcmF0aW9uIGV4dGVuZHMgUGxheWVySW50ZXJhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcbiAgICAgICAgZGVmaW5pdGlvbi50eXBlID0gJ1JldHJlYXREZWNsYXJhdGlvbic7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuXG4gICAgICAgIHRoaXMucmVnaW9uSWQgPSBkZWZpbml0aW9uLnJlZ2lvbklkO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmV0cmVhdERlY2xhcmF0aW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9pbnRlcmFjdGlvbnMvcmV0cmVhdERlY2xhcmF0aW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRkE7QUFDQTtBQUdBO0FBSkE7QUFLQTtBQUNBOzs7O0FBRUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 179 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar AlliedTribe = function (_FactionPiece) {\n    _inherits(AlliedTribe, _FactionPiece);\n\n    function AlliedTribe(definition) {\n        _classCallCheck(this, AlliedTribe);\n\n        definition.type = 'alliedtribe';\n\n        var _this = _possibleConstructorReturn(this, (AlliedTribe.__proto__ || Object.getPrototypeOf(AlliedTribe)).call(this, definition));\n\n        _this.tribeId = null;\n        return _this;\n    }\n\n    _createClass(AlliedTribe, [{\n        key: 'identifier',\n        value: function identifier() {\n            return _get(AlliedTribe.prototype.__proto__ || Object.getPrototypeOf(AlliedTribe.prototype), 'identifier', this).call(this) + '|' + (this.tribeId || '');\n        }\n    }]);\n\n    return AlliedTribe;\n}(_factionPiece2.default);\n\nexports.default = AlliedTribe;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9hbGxpZWRUcmliZS5qcz9iODA0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGYWN0aW9uUGllY2UgZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3Rpb25QaWVjZSc7XG5cbmNsYXNzIEFsbGllZFRyaWJlIGV4dGVuZHMgRmFjdGlvblBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdhbGxpZWR0cmliZSc7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgICAgICB0aGlzLnRyaWJlSWQgPSBudWxsO1xuICAgIH1cblxuICAgIGlkZW50aWZpZXIoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5pZGVudGlmaWVyKCkgKyAnfCcgKyAodGhpcy50cmliZUlkIHx8ICcnKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFsbGllZFRyaWJlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9waWVjZXMvYWxsaWVkVHJpYmUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRkE7QUFDQTtBQUVBO0FBSEE7QUFJQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 180 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Auxilia = function (_FactionPiece) {\n    _inherits(Auxilia, _FactionPiece);\n\n    function Auxilia(definition) {\n        _classCallCheck(this, Auxilia);\n\n        definition.type = 'auxilia';\n        definition.isMobile = true;\n\n        var _this = _possibleConstructorReturn(this, (Auxilia.__proto__ || Object.getPrototypeOf(Auxilia)).call(this, definition));\n\n        _this.revealed = _knockout2.default.observable();\n        _this.scouted = _knockout2.default.observable();\n        _this.status = _knockout2.default.pureComputed(function () {\n            return _this.revealed() ? 'revealed' : 'hidden';\n        });\n        return _this;\n    }\n\n    _createClass(Auxilia, [{\n        key: 'identifier',\n        value: function identifier() {\n            return _get(Auxilia.prototype.__proto__ || Object.getPrototypeOf(Auxilia.prototype), 'identifier', this).call(this) + '|' + this.status();\n        }\n    }]);\n\n    return Auxilia;\n}(_factionPiece2.default);\n\nexports.default = Auxilia;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9hdXhpbGlhLmpzPzNlODUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGtvIGZyb20gJy4uLy4uL2xpYi9rbm9ja291dCc7XG5pbXBvcnQgRmFjdGlvblBpZWNlIGZyb20gJy4uLy4uL2NvbW1vbi9mYWN0aW9uUGllY2UnO1xuXG5jbGFzcyBBdXhpbGlhIGV4dGVuZHMgRmFjdGlvblBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdhdXhpbGlhJztcbiAgICAgICAgZGVmaW5pdGlvbi5pc01vYmlsZSA9IHRydWU7XG5cbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG5cbiAgICAgICAgdGhpcy5yZXZlYWxlZCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5zY291dGVkID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IGtvLnB1cmVDb21wdXRlZCgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXZlYWxlZCgpID8gJ3JldmVhbGVkJyA6ICdoaWRkZW4nO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZGVudGlmaWVyKCkge1xuICAgICAgICByZXR1cm4gc3VwZXIuaWRlbnRpZmllcigpICsgJ3wnICsgdGhpcy5zdGF0dXMoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEF1eGlsaWE7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L3BpZWNlcy9hdXhpbGlhLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7Ozs7Ozs7Ozs7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVdBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 181 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Citadel = function (_FactionPiece) {\n    _inherits(Citadel, _FactionPiece);\n\n    function Citadel(definition) {\n        _classCallCheck(this, Citadel);\n\n        definition.type = 'citadel';\n        definition.canRoll = true;\n\n        var _this = _possibleConstructorReturn(this, (Citadel.__proto__ || Object.getPrototypeOf(Citadel)).call(this, definition));\n\n        _this.tribeId = null;\n        return _this;\n    }\n\n    _createClass(Citadel, [{\n        key: 'identifier',\n        value: function identifier() {\n            return _get(Citadel.prototype.__proto__ || Object.getPrototypeOf(Citadel.prototype), 'identifier', this).call(this) + '|' + (this.tribeId || '');\n        }\n    }]);\n\n    return Citadel;\n}(_factionPiece2.default);\n\nexports.default = Citadel;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9jaXRhZGVsLmpzP2U0NTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGtvIGZyb20gJy4uLy4uL2xpYi9rbm9ja291dCc7XG5pbXBvcnQgRmFjdGlvblBpZWNlIGZyb20gJy4uLy4uL2NvbW1vbi9mYWN0aW9uUGllY2UnO1xuXG5jbGFzcyBDaXRhZGVsIGV4dGVuZHMgRmFjdGlvblBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICdjaXRhZGVsJztcbiAgICAgICAgZGVmaW5pdGlvbi5jYW5Sb2xsID0gdHJ1ZTtcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG5cbiAgICAgICAgdGhpcy50cmliZUlkID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZGVudGlmaWVyKCkge1xuICAgICAgICByZXR1cm4gc3VwZXIuaWRlbnRpZmllcigpICsgJ3wnICsgKHRoaXMudHJpYmVJZCB8fCAnJyk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDaXRhZGVsO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9waWVjZXMvY2l0YWRlbC5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFJQTtBQUxBO0FBTUE7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 182 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Fort = function (_FactionPiece) {\n    _inherits(Fort, _FactionPiece);\n\n    function Fort(definition) {\n        _classCallCheck(this, Fort);\n\n        definition.type = 'fort';\n        definition.canRoll = true;\n        return _possibleConstructorReturn(this, (Fort.__proto__ || Object.getPrototypeOf(Fort)).call(this, definition));\n    }\n\n    return Fort;\n}(_factionPiece2.default);\n\nexports.default = Fort;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9mb3J0LmpzPzYyZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZhY3Rpb25QaWVjZSBmcm9tICcuLi8uLi9jb21tb24vZmFjdGlvblBpZWNlJztcblxuY2xhc3MgRm9ydCBleHRlbmRzIEZhY3Rpb25QaWVjZSB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICBkZWZpbml0aW9uLnR5cGUgPSAnZm9ydCc7XG4gICAgICAgIGRlZmluaXRpb24uY2FuUm9sbCA9IHRydWU7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRm9ydDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvcGllY2VzL2ZvcnQuanMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 183 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Leader = function (_FactionPiece) {\n    _inherits(Leader, _FactionPiece);\n\n    function Leader(definition) {\n        _classCallCheck(this, Leader);\n\n        definition.type = 'leader';\n        definition.isMobile = true;\n        definition.canRoll = true;\n\n        var _this = _possibleConstructorReturn(this, (Leader.__proto__ || Object.getPrototypeOf(Leader)).call(this, definition));\n\n        _this.name = definition.name;\n        _this.isSuccessor = _knockout2.default.observable(false);\n        return _this;\n    }\n\n    _createClass(Leader, [{\n        key: 'toString',\n        value: function toString() {\n            var value = this.name;\n            if (this.isSuccessor()) {\n                value += '\\'s Successor';\n            }\n            return value;\n        }\n    }]);\n\n    return Leader;\n}(_factionPiece2.default);\n\nexports.default = Leader;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9sZWFkZXIuanM/ZDk5MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQga28gZnJvbSAnLi4vLi4vbGliL2tub2Nrb3V0JztcbmltcG9ydCBGYWN0aW9uUGllY2UgZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3Rpb25QaWVjZSc7XG5cbmNsYXNzIExlYWRlciBleHRlbmRzIEZhY3Rpb25QaWVjZSB7XG4gICAgY29uc3RydWN0b3IoZGVmaW5pdGlvbikge1xuICAgICAgICBkZWZpbml0aW9uLnR5cGUgPSAnbGVhZGVyJztcbiAgICAgICAgZGVmaW5pdGlvbi5pc01vYmlsZSA9IHRydWU7XG4gICAgICAgIGRlZmluaXRpb24uY2FuUm9sbCA9IHRydWU7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgICAgICB0aGlzLm5hbWUgPSBkZWZpbml0aW9uLm5hbWU7XG4gICAgICAgIHRoaXMuaXNTdWNjZXNzb3IgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcbiAgICB9XG5cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5uYW1lO1xuICAgICAgICBpZiAodGhpcy5pc1N1Y2Nlc3NvcigpKSB7XG4gICAgICAgICAgICB2YWx1ZSArPSAnXFwncyBTdWNjZXNzb3InO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExlYWRlcjtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvcGllY2VzL2xlYWRlci5qcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFJQTtBQUNBO0FBTkE7QUFPQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 184 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Legion = function (_FactionPiece) {\n    _inherits(Legion, _FactionPiece);\n\n    function Legion(definition) {\n        _classCallCheck(this, Legion);\n\n        definition.type = 'legion';\n        definition.isMobile = true;\n        definition.canRoll = true;\n        return _possibleConstructorReturn(this, (Legion.__proto__ || Object.getPrototypeOf(Legion)).call(this, definition));\n    }\n\n    return Legion;\n}(_factionPiece2.default);\n\nexports.default = Legion;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy9sZWdpb24uanM/MzMwZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRmFjdGlvblBpZWNlIGZyb20gJy4uLy4uL2NvbW1vbi9mYWN0aW9uUGllY2UnO1xuXG5jbGFzcyBMZWdpb24gZXh0ZW5kcyBGYWN0aW9uUGllY2Uge1xuICAgIGNvbnN0cnVjdG9yKGRlZmluaXRpb24pIHtcblxuICAgICAgICBkZWZpbml0aW9uLnR5cGUgPSAnbGVnaW9uJztcbiAgICAgICAgZGVmaW5pdGlvbi5pc01vYmlsZSA9IHRydWU7XG4gICAgICAgIGRlZmluaXRpb24uY2FuUm9sbCA9IHRydWU7XG4gICAgICAgIHN1cGVyKGRlZmluaXRpb24pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGVnaW9uO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9waWVjZXMvbGVnaW9uLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7Ozs7QUFFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 185 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _factionPiece = __webpack_require__(24);\n\nvar _factionPiece2 = _interopRequireDefault(_factionPiece);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Warband = function (_FactionPiece) {\n    _inherits(Warband, _FactionPiece);\n\n    function Warband(definition) {\n        _classCallCheck(this, Warband);\n\n        definition.type = 'warband';\n        definition.isMobile = true;\n\n        var _this = _possibleConstructorReturn(this, (Warband.__proto__ || Object.getPrototypeOf(Warband)).call(this, definition));\n\n        _this.revealed = _knockout2.default.observable();\n        _this.scouted = _knockout2.default.observable();\n        _this.status = _knockout2.default.pureComputed(function () {\n            return _this.scouted() ? 'scouted' : _this.revealed() ? 'revealed' : 'hidden';\n        });\n        return _this;\n    }\n\n    _createClass(Warband, [{\n        key: 'identifier',\n        value: function identifier() {\n            return _get(Warband.prototype.__proto__ || Object.getPrototypeOf(Warband.prototype), 'identifier', this).call(this) + '|' + this.status();\n        }\n    }]);\n\n    return Warband;\n}(_factionPiece2.default);\n\nexports.default = Warband;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3BpZWNlcy93YXJiYW5kLmpzP2FkNDMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGtvIGZyb20gJy4uLy4uL2xpYi9rbm9ja291dCc7XG5pbXBvcnQgRmFjdGlvblBpZWNlIGZyb20gJy4uLy4uL2NvbW1vbi9mYWN0aW9uUGllY2UnO1xuXG5jbGFzcyBXYXJiYW5kIGV4dGVuZHMgRmFjdGlvblBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7XG4gICAgICAgIGRlZmluaXRpb24udHlwZSA9ICd3YXJiYW5kJztcbiAgICAgICAgZGVmaW5pdGlvbi5pc01vYmlsZSA9IHRydWU7XG5cbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG5cbiAgICAgICAgdGhpcy5yZXZlYWxlZCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5zY291dGVkID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IGtvLnB1cmVDb21wdXRlZCgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY291dGVkKCkgPyAnc2NvdXRlZCcgOiB0aGlzLnJldmVhbGVkKCkgPyAncmV2ZWFsZWQnIDogJ2hpZGRlbic7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlkZW50aWZpZXIoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5pZGVudGlmaWVyKCkgKyAnfCcgKyB0aGlzLnN0YXR1cygpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgV2FyYmFuZDtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvcGllY2VzL3dhcmJhbmQuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7OztBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBV0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 186 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _actionHistory = __webpack_require__(58);\n\nvar _actionHistory2 = _interopRequireDefault(_actionHistory);\n\nvar _turnHistory = __webpack_require__(62);\n\nvar _turnHistory2 = _interopRequireDefault(_turnHistory);\n\nvar _gameState = __webpack_require__(59);\n\nvar _gameState2 = _interopRequireDefault(_gameState);\n\nvar _factions = __webpack_require__(74);\n\nvar _factions2 = _interopRequireDefault(_factions);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _tribes = __webpack_require__(57);\n\nvar _tribes2 = _interopRequireDefault(_tribes);\n\nvar _regions = __webpack_require__(46);\n\nvar _regions2 = _interopRequireDefault(_regions);\n\nvar _sequenceOfPlay = __webpack_require__(61);\n\nvar _sequenceOfPlay2 = _interopRequireDefault(_sequenceOfPlay);\n\nvar _aeduiBot = __webpack_require__(65);\n\nvar _aeduiBot2 = _interopRequireDefault(_aeduiBot);\n\nvar _arverniBot = __webpack_require__(66);\n\nvar _arverniBot2 = _interopRequireDefault(_arverniBot);\n\nvar _romanBot = __webpack_require__(72);\n\nvar _romanBot2 = _interopRequireDefault(_romanBot);\n\nvar _belgaeBot = __webpack_require__(68);\n\nvar _belgaeBot2 = _interopRequireDefault(_belgaeBot);\n\nvar _germanicBot = __webpack_require__(71);\n\nvar _germanicBot2 = _interopRequireDefault(_germanicBot);\n\nvar _capabilities = __webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar FallingSkyGameState = function (_GameState) {\n    _inherits(FallingSkyGameState, _GameState);\n\n    function FallingSkyGameState() {\n        var _this$playersByFactio;\n\n        _classCallCheck(this, FallingSkyGameState);\n\n        var _this = _possibleConstructorReturn(this, (FallingSkyGameState.__proto__ || Object.getPrototypeOf(FallingSkyGameState)).call(this));\n\n        _this.factions = _factions2.default.generateFactions();\n        _this.factionsById = _lodash2.default.keyBy(_this.factions, 'id');\n        _this.aedui = _this.factionsById[_factionIds2.default.AEDUI];\n        _this.arverni = _this.factionsById[_factionIds2.default.ARVERNI];\n        _this.belgae = _this.factionsById[_factionIds2.default.BELGAE];\n        _this.germanic = _this.factionsById[_factionIds2.default.GERMANIC_TRIBES];\n        _this.romans = _this.factionsById[_factionIds2.default.ROMANS];\n\n        _this.tribes = _tribes2.default.generateTribes();\n        _this.tribesById = _lodash2.default.keyBy(_this.tribes, 'id');\n\n        _this.regions = _regions2.default.generateRegions(_this.tribesById);\n        _this.regionsById = _lodash2.default.keyBy(_this.regions, 'id');\n\n        _this.playersByFaction = (_this$playersByFactio = {}, _defineProperty(_this$playersByFactio, _factionIds2.default.ARVERNI, new _arverniBot2.default()), _defineProperty(_this$playersByFactio, _factionIds2.default.AEDUI, new _aeduiBot2.default()), _defineProperty(_this$playersByFactio, _factionIds2.default.ROMANS, new _romanBot2.default()), _defineProperty(_this$playersByFactio, _factionIds2.default.BELGAE, new _belgaeBot2.default()), _defineProperty(_this$playersByFactio, _factionIds2.default.GERMANIC_TRIBES, new _germanicBot2.default()), _this$playersByFactio);\n\n        _this.sequenceOfPlay = new _sequenceOfPlay2.default(_this, {\n            factions: [_factionIds2.default.ROMANS, _factionIds2.default.ARVERNI, _factionIds2.default.AEDUI, _factionIds2.default.BELGAE]\n        });\n\n        _this.turnHistory = new _turnHistory2.default(_this);\n        _this.actionHistory = new _actionHistory2.default(_this);\n        _this.capabilities = _knockout2.default.observableArray([]);\n        _this.capabilitiesById = _knockout2.default.pureComputed(function () {\n            return _lodash2.default.keyBy(_this.capabilities(), 'id');\n        });\n\n        _this.deck = _knockout2.default.observableArray();\n        _this.discard = _knockout2.default.observableArray();\n        _this.currentCard = _knockout2.default.observable();\n        _this.upcomingCard = _knockout2.default.observable();\n        _this.frost = _knockout2.default.observable();\n\n        _this.yearsRemaining = _knockout2.default.observable();\n        _this.isLastYear = _knockout2.default.pureComputed(function () {\n            return _this.yearsRemaining() === 0;\n        });\n        _this.gameEnded = _knockout2.default.observable();\n        _this.victor = _knockout2.default.observable();\n        return _this;\n    }\n\n    _createClass(FallingSkyGameState, [{\n        key: 'setDeck',\n        value: function setDeck(deck) {\n            this.deck(deck);\n        }\n    }, {\n        key: 'setYearsRemaining',\n        value: function setYearsRemaining(years) {\n            this.yearsRemaining(years);\n        }\n    }, {\n        key: 'startYear',\n        value: function startYear() {\n            this.yearsRemaining(this.yearsRemaining() - 1);\n        }\n    }, {\n        key: 'undoYear',\n        value: function undoYear() {\n            this.yearsRemaining(this.yearsRemaining() + 1);\n        }\n    }, {\n        key: 'cloneGameState',\n        value: function cloneGameState(state) {}\n    }, {\n        key: 'serializeGameState',\n        value: function serializeGameState(state) {}\n    }, {\n        key: 'loadGameState',\n        value: function loadGameState(state) {}\n    }, {\n        key: 'addCapability',\n        value: function addCapability(capability) {\n            this.capabilities.push(capability);\n        }\n    }, {\n        key: 'removeCapability',\n        value: function removeCapability(capabilityId) {\n            this.capabilities.remove(function (item) {\n                return item.id === capabilityId;\n            });\n        }\n    }, {\n        key: 'hasShadedCapability',\n        value: function hasShadedCapability(capabilityId, factionId) {\n            var capability = this.capabilitiesById()[capabilityId];\n            return capability && capability.state === _capabilities.CapabilityStates.SHADED && (!factionId || capability.factionId === factionId);\n        }\n    }, {\n        key: 'hasUnshadedCapability',\n        value: function hasUnshadedCapability(capabilityId, factionId) {\n            var capability = this.capabilitiesById()[capabilityId];\n            return capability && capability.state === _capabilities.CapabilityStates.UNSHADED && (!factionId || capability.factionId === factionId);\n        }\n    }, {\n        key: 'getControlledRegionsForFaction',\n        value: function getControlledRegionsForFaction(factionId) {\n            return (0, _lodash2.default)(this.regions).filter(function (region) {\n                return region.isControlledByFaction(factionId);\n            }).value();\n        }\n    }, {\n        key: 'logState',\n        value: function logState() {\n            var _this2 = this;\n\n            _lodash2.default.each(this.factions, function (faction) {\n                faction.logState(_this2);\n                console.log('');\n            });\n            _lodash2.default.each(this.regions, function (region) {\n                region.logState();\n            });\n            this.sequenceOfPlay.logState();\n            console.log('');\n            console.log('Deck Remaining: ' + this.deck().length);\n            console.log('Discarded: ' + this.discard().length);\n            if (this.currentCard()) {\n                console.log('Current Card: ');\n                console.log('    ' + this.currentCard().toString());\n            }\n            if (this.upcomingCard()) {\n                console.log('Upcoming Card: ');\n                console.log('    ' + this.upcomingCard().toString());\n            }\n        }\n    }]);\n\n    return FallingSkyGameState;\n}(_gameState2.default);\n\nexports.default = FallingSkyGameState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3N0YXRlL2ZhbGxpbmdTa3lHYW1lU3RhdGUuanM/NDA0MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICcuLi8uLi9saWIvbG9kYXNoJztcbmltcG9ydCBrbyBmcm9tICcuLi8uLi9saWIva25vY2tvdXQnO1xuaW1wb3J0IEFjdGlvbkhpc3RvcnkgZnJvbSAnLi4vLi4vY29tbW9uL2FjdGlvbkhpc3RvcnknO1xuaW1wb3J0IFR1cm5IaXN0b3J5IGZyb20gJy4uLy4uL2NvbW1vbi90dXJuSGlzdG9yeSc7XG5pbXBvcnQgR2FtZVN0YXRlIGZyb20gJy4uLy4uL2NvbW1vbi9nYW1lU3RhdGUnO1xuaW1wb3J0IEZhY3Rpb25zIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9ucyc7XG5pbXBvcnQgRmFjdGlvbklEcyBmcm9tICcuLi9jb25maWcvZmFjdGlvbklkcyc7XG5pbXBvcnQgVHJpYmVzIGZyb20gJy4uL2NvbmZpZy90cmliZXMnO1xuaW1wb3J0IFJlZ2lvbnMgZnJvbSAnLi4vY29uZmlnL3JlZ2lvbnMnO1xuaW1wb3J0IFNlcXVlbmNlT2ZQbGF5IGZyb20gJy4uLy4uL2NvbW1vbi9zZXF1ZW5jZU9mUGxheSc7XG5pbXBvcnQgQWVkdWlCb3QgZnJvbSAnLi4vYm90cy9hZWR1aS9hZWR1aUJvdCc7XG5pbXBvcnQgQXJ2ZXJuaUJvdCBmcm9tICcuLi9ib3RzL2FydmVybmkvYXJ2ZXJuaUJvdCc7XG5pbXBvcnQgUm9tYW5Cb3QgZnJvbSAnLi4vYm90cy9yb21hbnMvcm9tYW5Cb3QnO1xuaW1wb3J0IEJlbGdhZUJvdCBmcm9tICcuLi9ib3RzL2JlbGdhZS9iZWxnYWVCb3QnO1xuaW1wb3J0IEdlcm1hbmljQm90IGZyb20gJy4uL2JvdHMvZ2VybWFuaWMvZ2VybWFuaWNCb3QnO1xuaW1wb3J0IHtDYXBhYmlsaXR5U3RhdGVzfSBmcm9tICcuLi9jb25maWcvY2FwYWJpbGl0aWVzJztcblxuY2xhc3MgRmFsbGluZ1NreUdhbWVTdGF0ZSBleHRlbmRzIEdhbWVTdGF0ZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5mYWN0aW9ucyA9IEZhY3Rpb25zLmdlbmVyYXRlRmFjdGlvbnMoKTtcbiAgICAgICAgdGhpcy5mYWN0aW9uc0J5SWQgPSBfLmtleUJ5KHRoaXMuZmFjdGlvbnMsICdpZCcpO1xuICAgICAgICB0aGlzLmFlZHVpID0gdGhpcy5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5BRURVSV07XG4gICAgICAgIHRoaXMuYXJ2ZXJuaSA9IHRoaXMuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuQVJWRVJOSV07XG4gICAgICAgIHRoaXMuYmVsZ2FlID0gdGhpcy5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5CRUxHQUVdO1xuICAgICAgICB0aGlzLmdlcm1hbmljID0gdGhpcy5mYWN0aW9uc0J5SWRbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdO1xuICAgICAgICB0aGlzLnJvbWFucyA9IHRoaXMuZmFjdGlvbnNCeUlkW0ZhY3Rpb25JRHMuUk9NQU5TXTtcblxuXG4gICAgICAgIHRoaXMudHJpYmVzID0gVHJpYmVzLmdlbmVyYXRlVHJpYmVzKCk7XG4gICAgICAgIHRoaXMudHJpYmVzQnlJZCA9IF8ua2V5QnkodGhpcy50cmliZXMsICdpZCcpO1xuXG4gICAgICAgIHRoaXMucmVnaW9ucyA9IFJlZ2lvbnMuZ2VuZXJhdGVSZWdpb25zKHRoaXMudHJpYmVzQnlJZCk7XG4gICAgICAgIHRoaXMucmVnaW9uc0J5SWQgPSBfLmtleUJ5KHRoaXMucmVnaW9ucywgJ2lkJyk7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXJzQnlGYWN0aW9uID0ge1xuICAgICAgICAgICAgW0ZhY3Rpb25JRHMuQVJWRVJOSV06IG5ldyBBcnZlcm5pQm90KCksXG4gICAgICAgICAgICBbRmFjdGlvbklEcy5BRURVSV06IG5ldyBBZWR1aUJvdCgpLFxuICAgICAgICAgICAgW0ZhY3Rpb25JRHMuUk9NQU5TXTogbmV3IFJvbWFuQm90KCksXG4gICAgICAgICAgICBbRmFjdGlvbklEcy5CRUxHQUVdOiBuZXcgQmVsZ2FlQm90KCksXG4gICAgICAgICAgICBbRmFjdGlvbklEcy5HRVJNQU5JQ19UUklCRVNdOiBuZXcgR2VybWFuaWNCb3QoKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2VxdWVuY2VPZlBsYXkgPSBuZXcgU2VxdWVuY2VPZlBsYXkodGhpcyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmYWN0aW9uczogW0ZhY3Rpb25JRHMuUk9NQU5TLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFjdGlvbklEcy5BUlZFUk5JLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFjdGlvbklEcy5BRURVSSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhY3Rpb25JRHMuQkVMR0FFXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50dXJuSGlzdG9yeSA9IG5ldyBUdXJuSGlzdG9yeSh0aGlzKTtcbiAgICAgICAgdGhpcy5hY3Rpb25IaXN0b3J5ID0gbmV3IEFjdGlvbkhpc3RvcnkodGhpcyk7XG4gICAgICAgIHRoaXMuY2FwYWJpbGl0aWVzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtdKTtcbiAgICAgICAgdGhpcy5jYXBhYmlsaXRpZXNCeUlkID0ga28ucHVyZUNvbXB1dGVkKCgpPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF8ua2V5QnkodGhpcy5jYXBhYmlsaXRpZXMoKSwgJ2lkJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZGVjayA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgICAgICB0aGlzLmRpc2NhcmQgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q2FyZCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy51cGNvbWluZ0NhcmQgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgICAgIHRoaXMuZnJvc3QgPSBrby5vYnNlcnZhYmxlKCk7XG5cbiAgICAgICAgdGhpcy55ZWFyc1JlbWFpbmluZyA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5pc0xhc3RZZWFyID0ga28ucHVyZUNvbXB1dGVkKCgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnllYXJzUmVtYWluaW5nKCkgPT09IDA7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdhbWVFbmRlZCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy52aWN0b3IgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgc2V0RGVjayhkZWNrKSB7XG4gICAgICAgIHRoaXMuZGVjayhkZWNrKTtcbiAgICB9XG5cbiAgICBzZXRZZWFyc1JlbWFpbmluZyh5ZWFycykge1xuICAgICAgICB0aGlzLnllYXJzUmVtYWluaW5nKHllYXJzKTtcbiAgICB9XG5cbiAgICBzdGFydFllYXIoKSB7XG4gICAgICAgIHRoaXMueWVhcnNSZW1haW5pbmcodGhpcy55ZWFyc1JlbWFpbmluZygpIC0gMSk7XG4gICAgfVxuXG4gICAgdW5kb1llYXIoKSB7XG4gICAgICAgIHRoaXMueWVhcnNSZW1haW5pbmcodGhpcy55ZWFyc1JlbWFpbmluZygpICsgMSk7XG4gICAgfVxuXG4gICAgY2xvbmVHYW1lU3RhdGUoc3RhdGUpIHtcblxuICAgIH1cblxuICAgIHNlcmlhbGl6ZUdhbWVTdGF0ZShzdGF0ZSkge1xuXG4gICAgfVxuXG4gICAgbG9hZEdhbWVTdGF0ZShzdGF0ZSkge1xuXG4gICAgfVxuXG4gICAgYWRkQ2FwYWJpbGl0eShjYXBhYmlsaXR5KSB7XG4gICAgICAgIHRoaXMuY2FwYWJpbGl0aWVzLnB1c2goY2FwYWJpbGl0eSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlQ2FwYWJpbGl0eShjYXBhYmlsaXR5SWQpIHtcbiAgICAgICAgdGhpcy5jYXBhYmlsaXRpZXMucmVtb3ZlKCBmdW5jdGlvbihpdGVtKSB7IHJldHVybiBpdGVtLmlkID09PSBjYXBhYmlsaXR5SWQ7IH0pO1xuICAgIH1cblxuICAgIGhhc1NoYWRlZENhcGFiaWxpdHkoY2FwYWJpbGl0eUlkLCBmYWN0aW9uSWQpIHtcbiAgICAgICAgY29uc3QgY2FwYWJpbGl0eSA9IHRoaXMuY2FwYWJpbGl0aWVzQnlJZCgpW2NhcGFiaWxpdHlJZF07XG4gICAgICAgIHJldHVybiBjYXBhYmlsaXR5ICYmXG4gICAgICAgICAgICAgICBjYXBhYmlsaXR5LnN0YXRlID09PSBDYXBhYmlsaXR5U3RhdGVzLlNIQURFRCAmJlxuICAgICAgICAgICAgICAgKCFmYWN0aW9uSWQgfHwgY2FwYWJpbGl0eS5mYWN0aW9uSWQgPT09IGZhY3Rpb25JZCk7XG4gICAgfVxuXG4gICAgaGFzVW5zaGFkZWRDYXBhYmlsaXR5KGNhcGFiaWxpdHlJZCwgZmFjdGlvbklkKSB7XG4gICAgICAgIGNvbnN0IGNhcGFiaWxpdHkgPSB0aGlzLmNhcGFiaWxpdGllc0J5SWQoKVtjYXBhYmlsaXR5SWRdO1xuICAgICAgICByZXR1cm4gY2FwYWJpbGl0eSAmJlxuICAgICAgICAgICAgICAgY2FwYWJpbGl0eS5zdGF0ZSA9PT0gQ2FwYWJpbGl0eVN0YXRlcy5VTlNIQURFRCAmJlxuICAgICAgICAgICAgICAgKCFmYWN0aW9uSWQgfHwgY2FwYWJpbGl0eS5mYWN0aW9uSWQgPT09IGZhY3Rpb25JZCk7XG4gICAgfVxuXG4gICAgZ2V0Q29udHJvbGxlZFJlZ2lvbnNGb3JGYWN0aW9uKGZhY3Rpb25JZCkge1xuICAgICAgICByZXR1cm4gXyh0aGlzLnJlZ2lvbnMpLmZpbHRlcihmdW5jdGlvbihyZWdpb24pIHtcbiAgICAgICAgICAgIHJldHVybiByZWdpb24uaXNDb250cm9sbGVkQnlGYWN0aW9uKGZhY3Rpb25JZCk7XG4gICAgICAgIH0pLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgbG9nU3RhdGUoKSB7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgIHRoaXMuZmFjdGlvbnMsIChmYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgZmFjdGlvbi5sb2dTdGF0ZSh0aGlzKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgdGhpcy5yZWdpb25zLCBmdW5jdGlvbiAocmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmVnaW9uLmxvZ1N0YXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZU9mUGxheS5sb2dTdGF0ZSgpO1xuICAgICAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdEZWNrIFJlbWFpbmluZzogJyArIHRoaXMuZGVjaygpLmxlbmd0aCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdEaXNjYXJkZWQ6ICcgKyB0aGlzLmRpc2NhcmQoKS5sZW5ndGgpO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q2FyZCgpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ3VycmVudCBDYXJkOiAnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgICAgJyArIHRoaXMuY3VycmVudENhcmQoKS50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51cGNvbWluZ0NhcmQoKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1VwY29taW5nIENhcmQ6ICcpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyAgICAnICsgdGhpcy51cGNvbWluZ0NhcmQoKS50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBGYWxsaW5nU2t5R2FtZVN0YXRlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmFsbGluZ3NreS9zdGF0ZS9mYWxsaW5nU2t5R2FtZVN0YXRlLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUVBO0FBREE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcERBO0FBcURBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7OztBQUlBOzs7QUFJQTs7O0FBSUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFHQTs7O0FBRUE7QUFDQTtBQUNBO0FBR0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUlBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 187 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _regions = __webpack_require__(46);\n\nvar _regions2 = _interopRequireDefault(_regions);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _tribes = __webpack_require__(57);\n\nvar _tribes2 = _interopRequireDefault(_tribes);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar FallingSkyVassal = function () {\n  function FallingSkyVassal() {\n    _classCallCheck(this, FallingSkyVassal);\n\n    // define regions\n\n    this.regions = {\n      AED: {\n        key: \"AED\",\n        name: \"Aedui\",\n        modname: \"Celctica (Aedui)\",\n        ally: 1,\n        citadel: 1,\n        id: _regionIds2.default.AEDUI\n      },\n      ARV: {\n        key: \"ARV\",\n        name: \"Arverni\",\n        modname: \"Celtica (Arverni, Cadurci, Volcae)\",\n        ally: 3,\n        citadel: 1,\n        id: _regionIds2.default.ARVERNI\n      },\n      ATR: {\n        key: \"ATR\",\n        name: \"Atrebates\",\n        modname: \"Belcica (Atrebates, Bellovaci, Remi)\",\n        ally: 3,\n        citadel: 0,\n        id: _regionIds2.default.ATREBATES\n      },\n      BIT: {\n        key: \"BIT\",\n        name: \"Bituriges\",\n        modname: \"Celtica (Bituriges)\",\n        ally: 1,\n        citadel: 1,\n        id: _regionIds2.default.BITURIGES\n      },\n      CAT: {\n        key: \"CAT\",\n        name: \"Britannia\",\n        modname: \"Britannia\",\n        ally: 1,\n        citadel: 0,\n        id: _regionIds2.default.BRITANNIA\n      },\n      CAR: {\n        key: \"CAR\",\n        name: \"Carnutes\",\n        modname: \"Celtica (Aulerci, Carnutes)\",\n        ally: 2,\n        citadel: 1,\n        id: _regionIds2.default.CARNUTES\n      },\n      HEL: {\n        key: \"HEL\",\n        name: \"Provincia\",\n        modname: \"Provincia\",\n        ally: 1,\n        citadel: 0,\n        id: _regionIds2.default.PROVINCIA\n      },\n      MAN: {\n        key: \"MAN\",\n        name: \"Mandubii\",\n        modname: \"Celtica (Senones, Mandubii, Lingones)\",\n        ally: 3,\n        citadel: 1,\n        id: _regionIds2.default.MANDUBII\n      },\n      MOR: {\n        key: \"MOR\",\n        name: \"Morini\",\n        modname: \"Belgica (Morini, Menapii)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.MORINI\n      },\n      NER: {\n        key: \"NER\",\n        name: \"Nervii\",\n        modname: \"Belgica (Nervii)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.NERVII\n      },\n      PIC: {\n        key: \"PIC\",\n        name: \"Pictones\",\n        modname: \"Celctica (Pictones, Santones)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.PICTONES\n      },\n      SEQ: {\n        key: \"SEQ\",\n        name: \"Sequani\",\n        modname: \"Celtica (Sequani, Helvetii)\",\n        ally: 2,\n        citadel: 1,\n        id: _regionIds2.default.SEQUANI\n      },\n      SUG: {\n        key: \"SUG\",\n        name: \"Sugambri\",\n        modname: \"Germania (Sugambri, Suebi)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.SUGAMBRI\n      },\n      TRE: {\n        key: \"TRE\",\n        name: \"Treveri\",\n        modname: \"Celtica (Treveri)\",\n        ally: 1,\n        citadel: 0,\n        id: _regionIds2.default.TREVERI\n      },\n      UBI: {\n        key: \"UBI\",\n        name: \"Ubii\",\n        modname: \"Germania (Ubii, Suebi)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.UBII\n      },\n      VEN: {\n        key: \"VEN\",\n        name: \"Veneti\",\n        modname: \"Celtica (Veneti, Namnetes)\",\n        ally: 2,\n        citadel: 0,\n        id: _regionIds2.default.VENETI\n      }\n    };\n\n    // define tribes\n\n    this.tribes = [{\n      x: 2519,\n      y: 1588,\n      id: _tribeIds2.default.AEDUI\n    }, {\n      x: 2414,\n      y: 1978,\n      id: _tribeIds2.default.ARVERNI\n    }, {\n      x: 2073,\n      y: 593,\n      id: _tribeIds2.default.ATREBATES\n    }, {\n      x: 1848,\n      y: 1022,\n      id: _tribeIds2.default.AULERCI\n    }, {\n      x: 2266,\n      y: 723,\n      id: _tribeIds2.default.BELLOVACI\n    }, {\n      x: 2112,\n      y: 1436,\n      id: _tribeIds2.default.BITURIGES\n    }, {\n      x: 2146,\n      y: 2205,\n      id: _tribeIds2.default.CADURCI\n    }, {\n      x: 1784,\n      y: 1260,\n      id: _tribeIds2.default.CARNUTES\n    }, {\n      x: 1418,\n      y: 227,\n      id: _tribeIds2.default.CATUVELLAUNI\n    }, {\n      x: 3076,\n      y: 293,\n      id: _tribeIds2.default.EBURONES\n    }, {\n      x: 3403,\n      y: 1492,\n      id: _tribeIds2.default.HELVETII\n    }, {\n      x: 2784,\n      y: 2252,\n      id: _tribeIds2.default.HELVII\n    }, {\n      x: 2783,\n      y: 1197,\n      id: _tribeIds2.default.LINGONES\n    }, {\n      x: 2507,\n      y: 1156,\n      id: _tribeIds2.default.MANDUBII\n    }, {\n      x: 2527,\n      y: 213,\n      id: _tribeIds2.default.MENAPII\n    }, {\n      x: 2167,\n      y: 383,\n      id: _tribeIds2.default.MORINI\n    }, {\n      x: 1199,\n      y: 1188,\n      id: _tribeIds2.default.NAMNETES\n    }, {\n      x: 2675,\n      y: 381,\n      id: _tribeIds2.default.NERVII\n    }, {\n      x: 1338,\n      y: 1576,\n      id: _tribeIds2.default.PICTONES\n    }, {\n      x: 2651,\n      y: 758,\n      id: _tribeIds2.default.REMI\n    }, {\n      x: 1515,\n      y: 1748,\n      id: _tribeIds2.default.SANTONES\n    }, {\n      x: 2325,\n      y: 1095,\n      id: _tribeIds2.default.SENONES\n    }, {\n      x: 3042,\n      y: 1491,\n      id: _tribeIds2.default.SEQUANI\n    }, {\n      x: 3622,\n      y: 216,\n      id: _tribeIds2.default.SUEBI_NORTH\n    }, {\n      x: 3601,\n      y: 1259,\n      id: _tribeIds2.default.SUEBI_SOUTH\n    }, {\n      x: 3330,\n      y: 216,\n      id: _tribeIds2.default.SUGAMBRI\n    }, {\n      x: 3061,\n      y: 683,\n      id: _tribeIds2.default.TREVERI\n    }, {\n      x: 3657,\n      y: 765,\n      id: _tribeIds2.default.UBII\n    }, {\n      x: 931,\n      y: 1127,\n      id: _tribeIds2.default.VENETI\n    }, {\n      x: 1893,\n      y: 2406,\n      id: _tribeIds2.default.VOLCAE\n    }];\n  }\n\n  _createClass(FallingSkyVassal, [{\n    key: 'tribeId',\n    value: function tribeId(x, y) {\n      for (var i = 0; i < this.tribes.length; i++) {\n        if (this.tribes[i].x == x && this.tribes[i].y == y) return this.tribes[i].id;\n      }throw 'Could not find valid tribe for location ' + x + ', ' + y;\n    }\n  }]);\n\n  return FallingSkyVassal;\n}();\n\nexports.default = FallingSkyVassal;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3Zhc3NhbC9mYWxsaW5nU2t5VmFzc2FsLmpzPzAyNDMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQga28gZnJvbSAnLi4vLi4vbGliL2tub2Nrb3V0JztcblxuaW1wb3J0IFJlZ2lvbnMgZnJvbSAnLi4vY29uZmlnL3JlZ2lvbnMnO1xuaW1wb3J0IFJlZ2lvbklEcyBmcm9tICcuLi9jb25maWcvcmVnaW9uSWRzJztcbmltcG9ydCBUcmliZXMgZnJvbSAnLi4vY29uZmlnL3RyaWJlcyc7XG5pbXBvcnQgVHJpYmVJRHMgZnJvbSAnLi4vY29uZmlnL3RyaWJlSWRzJztcblxuY2xhc3MgRmFsbGluZ1NreVZhc3NhbCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuXG4gICAgLy8gZGVmaW5lIHJlZ2lvbnNcblxuICAgIHRoaXMucmVnaW9ucyA9IHtcbiAgICAgIEFFRDoge1xuICAgICAgICBrZXk6IFwiQUVEXCIsXG4gICAgICAgIG5hbWU6IFwiQWVkdWlcIixcbiAgICAgICAgbW9kbmFtZTogXCJDZWxjdGljYSAoQWVkdWkpXCIsXG4gICAgICAgIGFsbHk6IDEsXG4gICAgICAgIGNpdGFkZWw6IDEsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuQUVEVUlcbiAgICAgIH0sXG4gICAgICBBUlY6IHtcbiAgICAgICAga2V5OiBcIkFSVlwiLFxuICAgICAgICBuYW1lOiBcIkFydmVybmlcIixcbiAgICAgICAgbW9kbmFtZTogXCJDZWx0aWNhIChBcnZlcm5pLCBDYWR1cmNpLCBWb2xjYWUpXCIsXG4gICAgICAgIGFsbHk6IDMsXG4gICAgICAgIGNpdGFkZWw6IDEsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuQVJWRVJOSVxuICAgICAgfSxcbiAgICAgIEFUUjoge1xuICAgICAgICBrZXk6IFwiQVRSXCIsXG4gICAgICAgIG5hbWU6IFwiQXRyZWJhdGVzXCIsXG4gICAgICAgIG1vZG5hbWU6IFwiQmVsY2ljYSAoQXRyZWJhdGVzLCBCZWxsb3ZhY2ksIFJlbWkpXCIsXG4gICAgICAgIGFsbHk6IDMsXG4gICAgICAgIGNpdGFkZWw6IDAsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuQVRSRUJBVEVTXG4gICAgICB9LFxuICAgICAgQklUOiB7XG4gICAgICAgIGtleTogXCJCSVRcIixcbiAgICAgICAgbmFtZTogXCJCaXR1cmlnZXNcIixcbiAgICAgICAgbW9kbmFtZTogXCJDZWx0aWNhIChCaXR1cmlnZXMpXCIsXG4gICAgICAgIGFsbHk6IDEsXG4gICAgICAgIGNpdGFkZWw6IDEsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuQklUVVJJR0VTXG4gICAgICB9LFxuICAgICAgQ0FUOiB7XG4gICAgICAgIGtleTogXCJDQVRcIixcbiAgICAgICAgbmFtZTogXCJCcml0YW5uaWFcIixcbiAgICAgICAgbW9kbmFtZTogXCJCcml0YW5uaWFcIixcbiAgICAgICAgYWxseTogMSxcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5CUklUQU5OSUFcbiAgICAgIH0sXG4gICAgICBDQVI6IHtcbiAgICAgICAga2V5OiBcIkNBUlwiLFxuICAgICAgICBuYW1lOiBcIkNhcm51dGVzXCIsXG4gICAgICAgIG1vZG5hbWU6IFwiQ2VsdGljYSAoQXVsZXJjaSwgQ2FybnV0ZXMpXCIsXG4gICAgICAgIGFsbHk6IDIsXG4gICAgICAgIGNpdGFkZWw6IDEsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuQ0FSTlVURVNcbiAgICAgIH0sXG4gICAgICBIRUw6IHtcbiAgICAgICAga2V5OiBcIkhFTFwiLFxuICAgICAgICBuYW1lOiBcIlByb3ZpbmNpYVwiLFxuICAgICAgICBtb2RuYW1lOiBcIlByb3ZpbmNpYVwiLFxuICAgICAgICBhbGx5OiAxLFxuICAgICAgICBjaXRhZGVsOiAwLFxuICAgICAgICBpZDogUmVnaW9uSURzLlBST1ZJTkNJQVxuICAgICAgfSxcbiAgICAgIE1BTjoge1xuICAgICAgICBrZXk6IFwiTUFOXCIsXG4gICAgICAgIG5hbWU6IFwiTWFuZHViaWlcIixcbiAgICAgICAgbW9kbmFtZTogXCJDZWx0aWNhIChTZW5vbmVzLCBNYW5kdWJpaSwgTGluZ29uZXMpXCIsXG4gICAgICAgIGFsbHk6IDMsXG4gICAgICAgIGNpdGFkZWw6IDEsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuTUFORFVCSUlcbiAgICAgIH0sXG4gICAgICBNT1I6IHtcbiAgICAgICAga2V5OiBcIk1PUlwiLFxuICAgICAgICBuYW1lOiBcIk1vcmluaVwiLFxuICAgICAgICBtb2RuYW1lOiBcIkJlbGdpY2EgKE1vcmluaSwgTWVuYXBpaSlcIixcbiAgICAgICAgYWxseTogMixcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5NT1JJTklcbiAgICAgIH0sXG4gICAgICBORVI6IHtcbiAgICAgICAga2V5OiBcIk5FUlwiLFxuICAgICAgICBuYW1lOiBcIk5lcnZpaVwiLFxuICAgICAgICBtb2RuYW1lOiBcIkJlbGdpY2EgKE5lcnZpaSlcIixcbiAgICAgICAgYWxseTogMixcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5ORVJWSUlcbiAgICAgIH0sXG4gICAgICBQSUM6IHtcbiAgICAgICAga2V5OiBcIlBJQ1wiLFxuICAgICAgICBuYW1lOiBcIlBpY3RvbmVzXCIsXG4gICAgICAgIG1vZG5hbWU6IFwiQ2VsY3RpY2EgKFBpY3RvbmVzLCBTYW50b25lcylcIixcbiAgICAgICAgYWxseTogMixcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5QSUNUT05FU1xuICAgICAgfSxcbiAgICAgIFNFUToge1xuICAgICAgICBrZXk6IFwiU0VRXCIsXG4gICAgICAgIG5hbWU6IFwiU2VxdWFuaVwiLFxuICAgICAgICBtb2RuYW1lOiBcIkNlbHRpY2EgKFNlcXVhbmksIEhlbHZldGlpKVwiLFxuICAgICAgICBhbGx5OiAyLFxuICAgICAgICBjaXRhZGVsOiAxLFxuICAgICAgICBpZDogUmVnaW9uSURzLlNFUVVBTklcbiAgICAgIH0sXG4gICAgICBTVUc6IHtcbiAgICAgICAga2V5OiBcIlNVR1wiLFxuICAgICAgICBuYW1lOiBcIlN1Z2FtYnJpXCIsXG4gICAgICAgIG1vZG5hbWU6IFwiR2VybWFuaWEgKFN1Z2FtYnJpLCBTdWViaSlcIixcbiAgICAgICAgYWxseTogMixcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5TVUdBTUJSSVxuICAgICAgfSxcbiAgICAgIFRSRToge1xuICAgICAgICBrZXk6IFwiVFJFXCIsXG4gICAgICAgIG5hbWU6IFwiVHJldmVyaVwiLFxuICAgICAgICBtb2RuYW1lOiBcIkNlbHRpY2EgKFRyZXZlcmkpXCIsXG4gICAgICAgIGFsbHk6IDEsXG4gICAgICAgIGNpdGFkZWw6IDAsXG4gICAgICAgIGlkOiBSZWdpb25JRHMuVFJFVkVSSVxuICAgICAgfSxcbiAgICAgIFVCSToge1xuICAgICAgICBrZXk6IFwiVUJJXCIsXG4gICAgICAgIG5hbWU6IFwiVWJpaVwiLFxuICAgICAgICBtb2RuYW1lOiBcIkdlcm1hbmlhIChVYmlpLCBTdWViaSlcIixcbiAgICAgICAgYWxseTogMixcbiAgICAgICAgY2l0YWRlbDogMCxcbiAgICAgICAgaWQ6IFJlZ2lvbklEcy5VQklJXG4gICAgICB9LFxuICAgICAgVkVOOiB7XG4gICAgICAgIGtleTogXCJWRU5cIixcbiAgICAgICAgbmFtZTogXCJWZW5ldGlcIixcbiAgICAgICAgbW9kbmFtZTogXCJDZWx0aWNhIChWZW5ldGksIE5hbW5ldGVzKVwiLFxuICAgICAgICBhbGx5OiAyLFxuICAgICAgICBjaXRhZGVsOiAwLFxuICAgICAgICBpZDogUmVnaW9uSURzLlZFTkVUSVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBkZWZpbmUgdHJpYmVzXG5cbiAgICB0aGlzLnRyaWJlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgeDogMjUxOSxcbiAgICAgICAgeTogMTU4OCxcbiAgICAgICAgaWQ6IFRyaWJlSURzLkFFRFVJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAyNDE0LFxuICAgICAgICB5OiAxOTc4LFxuICAgICAgICBpZDogVHJpYmVJRHMuQVJWRVJOSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMjA3MyxcbiAgICAgICAgeTogNTkzLFxuICAgICAgICBpZDogVHJpYmVJRHMuQVRSRUJBVEVTXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAxODQ4LFxuICAgICAgICB5OiAxMDIyLFxuICAgICAgICBpZDogVHJpYmVJRHMuQVVMRVJDSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMjI2NixcbiAgICAgICAgeTogNzIzLFxuICAgICAgICBpZDogVHJpYmVJRHMuQkVMTE9WQUNJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAyMTEyLFxuICAgICAgICB5OiAxNDM2LFxuICAgICAgICBpZDogVHJpYmVJRHMuQklUVVJJR0VTXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAyMTQ2LFxuICAgICAgICB5OiAyMjA1LFxuICAgICAgICBpZDogVHJpYmVJRHMuQ0FEVVJDSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMTc4NCxcbiAgICAgICAgeTogMTI2MCxcbiAgICAgICAgaWQ6IFRyaWJlSURzLkNBUk5VVEVTXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAxNDE4LFxuICAgICAgICB5OiAyMjcsXG4gICAgICAgIGlkOiBUcmliZUlEcy5DQVRVVkVMTEFVTklcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDMwNzYsXG4gICAgICAgIHk6IDI5MyxcbiAgICAgICAgaWQ6IFRyaWJlSURzLkVCVVJPTkVTXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAzNDAzLFxuICAgICAgICB5OiAxNDkyLFxuICAgICAgICBpZDogVHJpYmVJRHMuSEVMVkVUSUlcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDI3ODQsXG4gICAgICAgIHk6IDIyNTIsXG4gICAgICAgIGlkOiBUcmliZUlEcy5IRUxWSUlcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDI3ODMsXG4gICAgICAgIHk6IDExOTcsXG4gICAgICAgIGlkOiBUcmliZUlEcy5MSU5HT05FU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMjUwNyxcbiAgICAgICAgeTogMTE1NixcbiAgICAgICAgaWQ6IFRyaWJlSURzLk1BTkRVQklJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAyNTI3LFxuICAgICAgICB5OiAyMTMsXG4gICAgICAgIGlkOiBUcmliZUlEcy5NRU5BUElJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAyMTY3LFxuICAgICAgICB5OiAzODMsXG4gICAgICAgIGlkOiBUcmliZUlEcy5NT1JJTklcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDExOTksXG4gICAgICAgIHk6IDExODgsXG4gICAgICAgIGlkOiBUcmliZUlEcy5OQU1ORVRFU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMjY3NSxcbiAgICAgICAgeTogMzgxLFxuICAgICAgICBpZDogVHJpYmVJRHMuTkVSVklJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAxMzM4LFxuICAgICAgICB5OiAxNTc2LFxuICAgICAgICBpZDogVHJpYmVJRHMuUElDVE9ORVNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDI2NTEsXG4gICAgICAgIHk6IDc1OCxcbiAgICAgICAgaWQ6IFRyaWJlSURzLlJFTUlcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDE1MTUsXG4gICAgICAgIHk6IDE3NDgsXG4gICAgICAgIGlkOiBUcmliZUlEcy5TQU5UT05FU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMjMyNSxcbiAgICAgICAgeTogMTA5NSxcbiAgICAgICAgaWQ6IFRyaWJlSURzLlNFTk9ORVNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHg6IDMwNDIsXG4gICAgICAgIHk6IDE0OTEsXG4gICAgICAgIGlkOiBUcmliZUlEcy5TRVFVQU5JXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAzNjIyLFxuICAgICAgICB5OiAyMTYsXG4gICAgICAgIGlkOiBUcmliZUlEcy5TVUVCSV9OT1JUSFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMzYwMSxcbiAgICAgICAgeTogMTI1OSxcbiAgICAgICAgaWQ6IFRyaWJlSURzLlNVRUJJX1NPVVRIXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAzMzMwLFxuICAgICAgICB5OiAyMTYsXG4gICAgICAgIGlkOiBUcmliZUlEcy5TVUdBTUJSSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMzA2MSxcbiAgICAgICAgeTogNjgzLFxuICAgICAgICBpZDogVHJpYmVJRHMuVFJFVkVSSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogMzY1NyxcbiAgICAgICAgeTogNzY1LFxuICAgICAgICBpZDogVHJpYmVJRHMuVUJJSVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgeDogOTMxLFxuICAgICAgICB5OiAxMTI3LFxuICAgICAgICBpZDogVHJpYmVJRHMuVkVORVRJXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB4OiAxODkzLFxuICAgICAgICB5OiAyNDA2LFxuICAgICAgICBpZDogVHJpYmVJRHMuVk9MQ0FFXG4gICAgICB9XG4gICAgXTtcbiAgfVxuXG4gIHRyaWJlSWQoeCwgeSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50cmliZXMubGVuZ3RoOyBpKyspXG4gICAgICBpZiAodGhpcy50cmliZXNbaV0ueCA9PSB4ICYmIHRoaXMudHJpYmVzW2ldLnkgPT0geSlcbiAgICAgICAgcmV0dXJuIHRoaXMudHJpYmVzW2ldLmlkO1xuXG4gICAgdGhyb3cgJ0NvdWxkIG5vdCBmaW5kIHZhbGlkIHRyaWJlIGZvciBsb2NhdGlvbiAnICsgeCArICcsICcgKyB5O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZhbGxpbmdTa3lWYXNzYWw7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9mYWxsaW5nc2t5L3Zhc3NhbC9mYWxsaW5nU2t5VmFzc2FsLmpzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUNBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUF6SEE7QUFDQTtBQWtJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUtBOzs7Ozs7QUFHQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 188 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = __webpack_require__(0);\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _knockout = __webpack_require__(12);\n\nvar _knockout2 = _interopRequireDefault(_knockout);\n\nvar _actionHistory = __webpack_require__(58);\n\nvar _actionHistory2 = _interopRequireDefault(_actionHistory);\n\nvar _turnHistory = __webpack_require__(62);\n\nvar _turnHistory2 = _interopRequireDefault(_turnHistory);\n\nvar _gameState = __webpack_require__(59);\n\nvar _gameState2 = _interopRequireDefault(_gameState);\n\nvar _fallingSkyGameState = __webpack_require__(186);\n\nvar _fallingSkyGameState2 = _interopRequireDefault(_fallingSkyGameState);\n\nvar _factions = __webpack_require__(74);\n\nvar _factions2 = _interopRequireDefault(_factions);\n\nvar _factionIds = __webpack_require__(1);\n\nvar _factionIds2 = _interopRequireDefault(_factionIds);\n\nvar _tribes = __webpack_require__(57);\n\nvar _tribes2 = _interopRequireDefault(_tribes);\n\nvar _tribeIds = __webpack_require__(23);\n\nvar _tribeIds2 = _interopRequireDefault(_tribeIds);\n\nvar _regions = __webpack_require__(46);\n\nvar _regions2 = _interopRequireDefault(_regions);\n\nvar _regionIds = __webpack_require__(5);\n\nvar _regionIds2 = _interopRequireDefault(_regionIds);\n\nvar _sequenceOfPlay = __webpack_require__(61);\n\nvar _sequenceOfPlay2 = _interopRequireDefault(_sequenceOfPlay);\n\nvar _aeduiBot = __webpack_require__(65);\n\nvar _aeduiBot2 = _interopRequireDefault(_aeduiBot);\n\nvar _arverniBot = __webpack_require__(66);\n\nvar _arverniBot2 = _interopRequireDefault(_arverniBot);\n\nvar _romanBot = __webpack_require__(72);\n\nvar _romanBot2 = _interopRequireDefault(_romanBot);\n\nvar _belgaeBot = __webpack_require__(68);\n\nvar _belgaeBot2 = _interopRequireDefault(_belgaeBot);\n\nvar _germanicBot = __webpack_require__(71);\n\nvar _germanicBot2 = _interopRequireDefault(_germanicBot);\n\nvar _humanPlayer = __webpack_require__(80);\n\nvar _humanPlayer2 = _interopRequireDefault(_humanPlayer);\n\nvar _capabilities = __webpack_require__(6);\n\nvar _placeWarbands = __webpack_require__(15);\n\nvar _placeWarbands2 = _interopRequireDefault(_placeWarbands);\n\nvar _placeAlliedTribe = __webpack_require__(13);\n\nvar _placeAlliedTribe2 = _interopRequireDefault(_placeAlliedTribe);\n\nvar _placeCitadel = __webpack_require__(33);\n\nvar _placeCitadel2 = _interopRequireDefault(_placeCitadel);\n\nvar _placeLeader = __webpack_require__(48);\n\nvar _placeLeader2 = _interopRequireDefault(_placeLeader);\n\nvar _placeAuxilia = __webpack_require__(32);\n\nvar _placeAuxilia2 = _interopRequireDefault(_placeAuxilia);\n\nvar _placeFort = __webpack_require__(47);\n\nvar _placeFort2 = _interopRequireDefault(_placeFort);\n\nvar _placeLegions = __webpack_require__(49);\n\nvar _placeLegions2 = _interopRequireDefault(_placeLegions);\n\nvar _revealPieces = __webpack_require__(16);\n\nvar _revealPieces2 = _interopRequireDefault(_revealPieces);\n\nvar _disperseTribe = __webpack_require__(63);\n\nvar _disperseTribe2 = _interopRequireDefault(_disperseTribe);\n\nvar _senateApprovalStates = __webpack_require__(37);\n\nvar _senateApprovalStates2 = _interopRequireDefault(_senateApprovalStates);\n\nvar _fallingSkyVassal = __webpack_require__(187);\n\nvar _fallingSkyVassal2 = _interopRequireDefault(_fallingSkyVassal);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar FallingSkyVassalGameState = function (_FallingSkyGameState) {\n  _inherits(FallingSkyVassalGameState, _FallingSkyGameState);\n\n  function FallingSkyVassalGameState(json) {\n    _classCallCheck(this, FallingSkyVassalGameState);\n\n    // utility variables\n\n    var _this = _possibleConstructorReturn(this, (FallingSkyVassalGameState.__proto__ || Object.getPrototypeOf(FallingSkyVassalGameState)).call(this));\n\n    var startIndex = void 0;\n    var endIndex = void 0;\n    var pieceName = void 0;\n    var zone = void 0;\n    var p = void 0;\n    var z = void 0;\n\n    _this.vassal = new _fallingSkyVassal2.default();\n\n    // the current action (state of the state machine)\n\n    _this.action = json.action;\n\n    // set human players\n\n    if (!json.npaedui) _this.playersByFaction[_factionIds2.default.AEDUI] = new _humanPlayer2.default({ factionId: _factionIds2.default.AEDUI });\n    if (!json.npaverni) _this.playersByFaction[_factionIds2.default.ARVERNI] = new _humanPlayer2.default({ factionId: _factionIds2.default.ARVERNI });\n    if (!json.npbelgic) _this.playersByFaction[_factionIds2.default.BELGAE] = new _humanPlayer2.default({ factionId: _factionIds2.default.BELGAE });\n    if (!json.nproman) _this.playersByFaction[_factionIds2.default.ROMANS] = new _humanPlayer2.default({ factionId: _factionIds2.default.ROMANS });\n\n    // resources\n\n    var eligible = [];\n    var ineligible = [];\n    var passed = [];\n\n    for (z = 0; z < json.zones.length; z++) {\n      zone = json.zones[z];\n      for (p = 0; p < zone.pieces.length; p++) {\n        pieceName = zone.pieces[p].name;\n\n        // Aedui Resources\n        if (pieceName.startsWith('Aedui Resources (')) _this.aedui.setResources(parseInt(zone.name));\n        // Aedui Eligibility\n        if (pieceName.startsWith('Aedui Eligibility')) {\n          if (zone.name === 'Eligible Factions') eligible.push(_factionIds2.default.AEDUI);else if (zone.name === 'Pass') passed.push(_factionIds2.default.AEDUI);else ineligible.push(_factionIds2.default.AEDUI);\n        }\n        // Arverni Resources\n        if (pieceName.startsWith('Averni Resources (')) _this.arverni.setResources(parseInt(zone.name));\n        // Arverni Eligibility\n        if (pieceName.startsWith('Averni Eligibility')) {\n          if (zone.name === 'Eligible Factions') eligible.push(_factionIds2.default.ARVERNI);else if (zone.name === 'Pass') passed.push(_factionIds2.default.ARVERNI);else ineligible.push(_factionIds2.default.ARVERNI);\n        }\n        // Belgic Resources\n        if (pieceName.startsWith('Belgic Resources (')) _this.belgae.setResources(parseInt(zone.name));\n        // Belgic Eligibility\n        if (pieceName.startsWith('Belgic Eligibility')) {\n          if (zone.name === 'Eligible Factions') eligible.push(_factionIds2.default.BELGAE);else if (zone.name === 'Pass') passed.push(_factionIds2.default.BELGAE);else ineligible.push(_factionIds2.default.BELGAE);\n        }\n        // Roman Resources\n        if (pieceName.startsWith('Roman Resources (')) _this.romans.setResources(parseInt(zone.name));\n        // Roman Eligibility\n        if (pieceName.startsWith('Roman Eligibility')) {\n          if (zone.name === 'Eligible Factions') eligible.push(_factionIds2.default.ROMANS);else if (zone.name === 'Pass') passed.push(_factionIds2.default.ROMANS);else ineligible.push(_factionIds2.default.ROMANS);\n        }\n      }\n    }\n\n    _this.sequenceOfPlay.eligibleFactions(eligible);\n    _this.sequenceOfPlay.ineligibleFactions(ineligible);\n    _this.sequenceOfPlay.passedFactions(passed);\n\n    // go through regions to count pieces\n\n    for (var key in _this.vassal.regions) {\n      var vassalregion = _this.vassal.regions[key];\n\n      for (z = 0; z < json.zones.length; z++) {\n        zone = json.zones[z];\n\n        // is zone a Region?\n\n        if (zone.name === vassalregion.modname) {\n          // init region\n          var region = _this.regionsById[vassalregion.id];\n          var aeduiCount = {\n            warbands: 0,\n            revealedwarbands: 0\n          };\n          var arverniCount = {\n            warbands: 0,\n            revealedwarbands: 0\n          };\n          var belgaeCount = {\n            warbands: 0,\n            revealedwarbands: 0\n          };\n          var germanicCount = {\n            warbands: 0,\n            revealedwarbands: 0\n          };\n          var romanCount = {\n            auxilia: 0,\n            revealedauxilia: 0,\n            legion: 0\n          };\n\n          // special case, citadel of Aedui\n\n          // special case, citadel of Arverni\n\n          for (p = 0; p < zone.pieces.length; p++) {\n            var _pieceName = zone.pieces[p].name;\n            var pieceX = zone.pieces[p].x;\n            var pieceY = zone.pieces[p].y;\n\n            // Aedui\n            if (_pieceName === 'Aedui Warband') aeduiCount.warbands++;\n            if (_pieceName === 'Aedui Warband Revealed') {\n              aeduiCount.warbands++;\n              aeduiCount.revealedwarbands++;\n            }\n            if (_pieceName === 'Aedui Ally') _placeAlliedTribe2.default.execute(_this, { factionId: _this.aedui.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) });\n            if (_pieceName == 'Aedui Citadel') _placeCitadel2.default.execute(_this, { factionId: _this.aedui.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) }, false);\n\n            // Arverni\n            if (_pieceName == 'Vercingetorix' || _pieceName == 'Arverni Successor') {\n              _placeLeader2.default.execute(_this, { factionId: _this.arverni.id, regionId: region.id });\n              if (_pieceName == 'Arverni Successor') {\n                var arverniLeader = region.getLeaderForFaction(_this.arverni.id);\n                arverniLeader.isSuccessor(true);\n              }\n            }\n            if (_pieceName === 'Arverni Warband') arverniCount.warbands++;\n            if (_pieceName === 'Arverni Warband Revealed') {\n              arverniCount.warbands++;\n              arverniCount.revealedwarbands++;\n            }\n            if (_pieceName === 'Arverni Ally') _placeAlliedTribe2.default.execute(_this, { factionId: _this.arverni.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) });\n            if (_pieceName == 'Averni Citadel') _placeCitadel2.default.execute(_this, { factionId: _this.arverni.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) }, false);\n\n            // Belgae\n            if (_pieceName == 'Ambiorix' || _pieceName == 'Belgic Successor') {\n              _placeLeader2.default.execute(_this, { factionId: _this.belgae.id, regionId: region.id });\n              if (_pieceName == 'Belgic Successor') {\n                var belgicLeader = region.getLeaderForFaction(_this.belgae.id);\n                belgicLeader.isSuccessor(true);\n              }\n            }\n            if (_pieceName === 'Belgic Warband') belgaeCount.warbands++;\n            if (_pieceName === 'Belgic Warband Revealed') {\n              belgaeCount.warbands++;\n              belgaeCount.revealedwarbands++;\n            }\n            if (_pieceName === 'Belgic Ally') _placeAlliedTribe2.default.execute(_this, { factionId: _this.belgae.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) });\n            if (_pieceName == 'Belgic Citadel') _placeCitadel2.default.execute(_this, { factionId: _this.belgae.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) }, false);\n\n            // Germanic\n            if (_pieceName === 'Germanic Warband') germanicCount.warbands++;\n            if (_pieceName === 'Germanic Warband Revealed') {\n              germanicCount.warbands++;\n              germanicCount.revealedwarbands++;\n            }\n            if (_pieceName === 'Germanic Ally') _placeAlliedTribe2.default.execute(_this, { factionId: _this.germanic.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) });\n\n            // Roman\n            if (_pieceName == 'Caesar' || _pieceName == 'Roman Successor') {\n              _placeLeader2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id });\n              if (_pieceName == 'Roman Successor') {\n                var romanLeader = region.getLeaderForFaction(_this.romans.id);\n                romanLeader.isSuccessor(true);\n              }\n            }\n            if (_pieceName === 'Roman Auxilia') romanCount.auxilia++;\n            if (_pieceName === 'Roman Auxilia Revealed') {\n              romanCount.auxilia++;\n              romanCount.revealedauxilia++;\n            }\n            if (_pieceName === 'Roman Legion') romanCount.legion++;\n            if (_pieceName === 'Roman Ally') _placeAlliedTribe2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id, tribeId: _this.vassal.tribeId(pieceX, pieceY) });\n            if (_pieceName == 'Roman Fort') _placeFort2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id });\n\n            // TODO: dispersed tribe\n            // TODO: gathering tribe\n            // TODO: devastated\n            // TODO: Colony added\n          }\n\n          // apply counts\n\n          if (aeduiCount.warbands > 0) _placeWarbands2.default.execute(_this, { factionId: _this.aedui.id, regionId: region.id, count: aeduiCount.warbands });\n          if (aeduiCount.revealedwarbands > 0) _revealPieces2.default.execute(_this, { factionId: _this.aedui.id, regionId: region.id, count: aeduiCount.revealedwarbands });\n          if (arverniCount.warbands > 0) _placeWarbands2.default.execute(_this, { factionId: _this.arverni.id, regionId: region.id, count: arverniCount.warbands });\n          if (arverniCount.revealedwarbands > 0) _revealPieces2.default.execute(_this, { factionId: _this.arverni.id, regionId: region.id, count: arverniCount.revealedwarbands });\n          if (belgaeCount.warbands > 0) _placeWarbands2.default.execute(_this, { factionId: _this.belgae.id, regionId: region.id, count: belgaeCount.warbands });\n          if (belgaeCount.revealedwarbands > 0) _revealPieces2.default.execute(_this, { factionId: _this.belgae.id, regionId: region.id, count: belgaeCount.revealedwarbands });\n          if (germanicCount.warbands > 0) _placeWarbands2.default.execute(_this, { factionId: _this.germanic.id, regionId: region.id, count: germanicCount.warbands });\n          if (germanicCount.revealedwarbands > 0) _revealPieces2.default.execute(_this, { factionId: _this.germanic.id, regionId: region.id, count: germanicCount.revealedwarbands });\n\n          if (romanCount.auxilia > 0) _placeAuxilia2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id, count: romanCount.auxilia });\n          if (romanCount.revealedauxilia > 0) _revealPieces2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id, count: romanCount.revealedauxilia });\n          if (romanCount.legion > 0) _placeLegions2.default.execute(_this, { factionId: _this.romans.id, regionId: region.id, count: romanCount.legion });\n        }\n      }\n    }\n\n    // process other zones\n\n    var romanLegionsTrack = 0;\n    var romanLegionsFallen = 0;\n    for (z = 0; z < json.zones.length; z++) {\n      zone = json.zones[z];\n      console.log('OTHER ZONE: ' + zone.name);\n\n      for (p = 0; p < zone.pieces.length; p++) {\n        var _pieceName2 = zone.pieces[p].name;\n\n        if (zone.name == 'Upcoming') {\n          // TODO: upcoming card\n          // game.upcomingcard = {name: pieceName, num: parseInt(pieceName.substring(0, 2))};\n          // if (game.upcomingcard.name.endsWith(' - Winter'))\n          //   game.frost = true;\n        }\n\n        if (zone.name == 'Current') {\n          // TODO: current card\n          // game.currentcard = {name: pieceName, num: parseInt(pieceName.substring(0, 2))};\n          // if (game.currentcard.name.endsWith(' - Winter'))\n          //   game.winter = true;\n        }\n\n        if (zone.name == 'Senate - Uproar') if (_pieceName2 == 'Roman Senate') {\n          console.log('UPROAR');\n          _this.romans.setSenateApproval(_senateApprovalStates2.default.UPROAR);\n        }\n        if (zone.name == 'Senate - Intrigue') if (_pieceName2 == 'Roman Senate') _this.romans.setSenateApproval(_senateApprovalStates2.default.INTRIGUE);\n        if (zone.name == 'Senate - Adulation') if (_pieceName2 == 'Roman Senate') _this.romans.setSenateApproval(_senateApprovalStates2.default.ADULATION);\n        if (zone.name == 'Legions') if (_pieceName2 == 'Roman Legion') romanLegionsTrack++;\n        if (zone.name == 'Fallen Legions') if (_pieceName2 == 'Roman Legion') romanLegionsFallen++;\n      }\n    }\n    console.log('legion track: ' + romanLegionsTrack);\n    if (romanLegionsTrack > 0) _this.romans.initializeLegionTrack(_senateApprovalStates2.default.ADULATION, romanLegionsTrack > 4 ? 4 : romanLegionsTrack);\n    romanLegionsTrack -= 4;\n    if (romanLegionsTrack > 0) _this.romans.initializeLegionTrack(_senateApprovalStates2.default.INTRIGUE, romanLegionsTrack > 4 ? 4 : romanLegionsTrack);\n    romanLegionsTrack -= 4;\n    if (romanLegionsTrack > 0) _this.romans.initializeLegionTrack(_senateApprovalStates2.default.UPROAR, romanLegionsTrack);\n\n    console.log('fallen: ' + romanLegionsFallen);\n    _this.romans.returnLegions(_this.romans.availableLegions().splice(0, romanLegionsFallen));\n\n    // process offboard\n\n    _this.numberDiscards = 0;\n    _this.numberDeck = 0;\n\n    for (p = 0; p < json.offboard.length; p++) {\n      pieceName = json.offboard[p].name;\n\n      if (pieceName.indexOf(' Capability **') > -1) {}\n      // TODO: Capabilities\n      // var cardName = pieceName.substring(0, pieceName.indexOf(' **'));\n      // var cardNumber = parseInt(pieceName.substring(0, 2));\n      // var shadedCapability = pieceName.indexOf('** Shaded ') > -1;\n      // var cap = {card: cardName, num: cardNumber, shaded: shadedCapability}; \n      // game.capabilities.push(cap);\n      // console.log('Capability: ', cap);\n\n\n      // number of cards on the discard pile\n      if (pieceName.indexOf(' Cards in Discard') > -1) {\n        // record the number of cards in the discard pile\n        startIndex = pieceName.indexOf('(') + 1;\n        endIndex = pieceName.indexOf(' C');\n        _this.numberDiscards = parseInt(pieceName.substring(startIndex, endIndex));\n      }\n\n      // number of cards on the draw deck\n      if (pieceName.indexOf(' Cards Remaining in Deck') > -1) {\n        // record the number of cards in the discard pile\n        startIndex = pieceName.indexOf('(') + 1;\n        endIndex = pieceName.indexOf(' C');\n        _this.numberDeck = parseInt(pieceName.substring(startIndex, endIndex));\n      }\n    }\n\n    // determine number of cards used (for scenario)\n\n    _this.totalCards = _this.numberDiscards + _this.numberDeck; // TODO: plus current + upcoming\n\n    console.log('CARDS = ', _this.totalCards);\n    return _this;\n  }\n\n  _createClass(FallingSkyVassalGameState, [{\n    key: 'toJSON',\n    value: function toJSON() {\n      return \"{}\";\n    }\n\n    // UTILITIES\n\n\n  }]);\n\n  return FallingSkyVassalGameState;\n}(_fallingSkyGameState2.default);\n\nexports.default = FallingSkyVassalGameState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3NyYy9mYWxsaW5nc2t5L3Zhc3NhbC9mYWxsaW5nU2t5VmFzc2FsR2FtZVN0YXRlLmpzPzQ2MmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnLi4vLi4vbGliL2xvZGFzaCc7XG5pbXBvcnQga28gZnJvbSAnLi4vLi4vbGliL2tub2Nrb3V0JztcbmltcG9ydCBBY3Rpb25IaXN0b3J5IGZyb20gJy4uLy4uL2NvbW1vbi9hY3Rpb25IaXN0b3J5JztcbmltcG9ydCBUdXJuSGlzdG9yeSBmcm9tICcuLi8uLi9jb21tb24vdHVybkhpc3RvcnknO1xuaW1wb3J0IEdhbWVTdGF0ZSBmcm9tICcuLi8uLi9jb21tb24vZ2FtZVN0YXRlJztcbmltcG9ydCBGYWxsaW5nU2t5R2FtZVN0YXRlIGZyb20gJ2ZhbGxpbmdza3kvc3RhdGUvZmFsbGluZ1NreUdhbWVTdGF0ZSc7XG5pbXBvcnQgRmFjdGlvbnMgZnJvbSAnLi4vY29uZmlnL2ZhY3Rpb25zJztcbmltcG9ydCBGYWN0aW9uSURzIGZyb20gJy4uL2NvbmZpZy9mYWN0aW9uSWRzJztcbmltcG9ydCBUcmliZXMgZnJvbSAnLi4vY29uZmlnL3RyaWJlcyc7XG5pbXBvcnQgVHJpYmVJRHMgZnJvbSAnLi4vY29uZmlnL3RyaWJlSWRzJztcbmltcG9ydCBSZWdpb25zIGZyb20gJy4uL2NvbmZpZy9yZWdpb25zJztcbmltcG9ydCBSZWdpb25JRHMgZnJvbSAnLi4vY29uZmlnL3JlZ2lvbklkcyc7XG5pbXBvcnQgU2VxdWVuY2VPZlBsYXkgZnJvbSAnLi4vLi4vY29tbW9uL3NlcXVlbmNlT2ZQbGF5JztcbmltcG9ydCBBZWR1aUJvdCBmcm9tICcuLi9ib3RzL2FlZHVpL2FlZHVpQm90JztcbmltcG9ydCBBcnZlcm5pQm90IGZyb20gJy4uL2JvdHMvYXJ2ZXJuaS9hcnZlcm5pQm90JztcbmltcG9ydCBSb21hbkJvdCBmcm9tICcuLi9ib3RzL3JvbWFucy9yb21hbkJvdCc7XG5pbXBvcnQgQmVsZ2FlQm90IGZyb20gJy4uL2JvdHMvYmVsZ2FlL2JlbGdhZUJvdCc7XG5pbXBvcnQgR2VybWFuaWNCb3QgZnJvbSAnLi4vYm90cy9nZXJtYW5pYy9nZXJtYW5pY0JvdCc7XG5pbXBvcnQgSHVtYW5QbGF5ZXIgZnJvbSAnZmFsbGluZ3NreS9wbGF5ZXIvaHVtYW5QbGF5ZXInO1xuaW1wb3J0IHtDYXBhYmlsaXR5U3RhdGVzfSBmcm9tICcuLi9jb25maWcvY2FwYWJpbGl0aWVzJztcblxuaW1wb3J0IFBsYWNlV2FyYmFuZHMgZnJvbSAnLi4vYWN0aW9ucy9wbGFjZVdhcmJhbmRzJztcbmltcG9ydCBQbGFjZUFsbGllZFRyaWJlIGZyb20gJy4uL2FjdGlvbnMvcGxhY2VBbGxpZWRUcmliZSc7XG5pbXBvcnQgUGxhY2VDaXRhZGVsIGZyb20gJy4uL2FjdGlvbnMvcGxhY2VDaXRhZGVsJztcbmltcG9ydCBQbGFjZUxlYWRlciBmcm9tICcuLi9hY3Rpb25zL3BsYWNlTGVhZGVyJztcbmltcG9ydCBQbGFjZUF1eGlsaWEgZnJvbSAnLi4vYWN0aW9ucy9wbGFjZUF1eGlsaWEnO1xuaW1wb3J0IFBsYWNlRm9ydCBmcm9tICcuLi9hY3Rpb25zL3BsYWNlRm9ydCc7XG5pbXBvcnQgUGxhY2VMZWdpb25zIGZyb20gJy4uL2FjdGlvbnMvcGxhY2VMZWdpb25zJztcbmltcG9ydCBSZXZlYWxQaWVjZXMgZnJvbSAnLi4vYWN0aW9ucy9yZXZlYWxQaWVjZXMnO1xuXG5pbXBvcnQgRGlzcGVyc2VUcmliZSBmcm9tICcuLi9hY3Rpb25zL2Rpc3BlcnNlVHJpYmUnO1xuaW1wb3J0IFNlbmF0ZUFwcHJvdmFsU3RhdGVzIGZyb20gJy4uL2NvbmZpZy9zZW5hdGVBcHByb3ZhbFN0YXRlcyc7XG5cbmltcG9ydCBGYWxsaW5nU2t5VmFzc2FsIGZyb20gJy4vZmFsbGluZ1NreVZhc3NhbCc7XG5cbmNsYXNzIEZhbGxpbmdTa3lWYXNzYWxHYW1lU3RhdGUgZXh0ZW5kcyBGYWxsaW5nU2t5R2FtZVN0YXRlIHtcbiAgY29uc3RydWN0b3IoanNvbikge1xuICAgIHN1cGVyKCk7XG5cbiAgICAvLyB1dGlsaXR5IHZhcmlhYmxlc1xuXG4gICAgbGV0IHN0YXJ0SW5kZXg7XG4gICAgbGV0IGVuZEluZGV4O1xuICAgIGxldCBwaWVjZU5hbWU7XG4gICAgbGV0IHpvbmU7XG4gICAgbGV0IHA7XG4gICAgbGV0IHo7XG5cbiAgICB0aGlzLnZhc3NhbCA9IG5ldyBGYWxsaW5nU2t5VmFzc2FsKCk7XG5cbiAgICAvLyB0aGUgY3VycmVudCBhY3Rpb24gKHN0YXRlIG9mIHRoZSBzdGF0ZSBtYWNoaW5lKVxuXG4gICAgdGhpcy5hY3Rpb24gPSBqc29uLmFjdGlvbjtcblxuICAgIC8vIHNldCBodW1hbiBwbGF5ZXJzXG5cbiAgICBpZiAoIWpzb24ubnBhZWR1aSlcbiAgICAgIHRoaXMucGxheWVyc0J5RmFjdGlvbltGYWN0aW9uSURzLkFFRFVJXSA9IG5ldyBIdW1hblBsYXllcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkFFRFVJfSk7XG4gICAgaWYgKCFqc29uLm5wYXZlcm5pKVxuICAgICAgdGhpcy5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuQVJWRVJOSV0gPSBuZXcgSHVtYW5QbGF5ZXIoe2ZhY3Rpb25JZDogRmFjdGlvbklEcy5BUlZFUk5JfSk7XG4gICAgaWYgKCFqc29uLm5wYmVsZ2ljKVxuICAgICAgdGhpcy5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuQkVMR0FFXSA9IG5ldyBIdW1hblBsYXllcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLkJFTEdBRX0pO1xuICAgIGlmICghanNvbi5ucHJvbWFuKVxuICAgICAgdGhpcy5wbGF5ZXJzQnlGYWN0aW9uW0ZhY3Rpb25JRHMuUk9NQU5TXSA9IG5ldyBIdW1hblBsYXllcih7ZmFjdGlvbklkOiBGYWN0aW9uSURzLlJPTUFOU30pO1xuICAgIFxuICAgIC8vIHJlc291cmNlc1xuXG4gICAgY29uc3QgZWxpZ2libGUgPSBbXTtcbiAgICBjb25zdCBpbmVsaWdpYmxlID0gW107XG4gICAgY29uc3QgcGFzc2VkID0gW107XG5cbiAgICBmb3IgKHogPSAwOyB6IDwganNvbi56b25lcy5sZW5ndGg7IHorKykge1xuICAgICAgem9uZSA9IGpzb24uem9uZXNbel07XG4gICAgICBmb3IgKHAgPSAwOyBwIDwgem9uZS5waWVjZXMubGVuZ3RoOyBwKyspIHtcbiAgICAgICAgcGllY2VOYW1lID0gem9uZS5waWVjZXNbcF0ubmFtZTtcblxuICAgICAgICAvLyBBZWR1aSBSZXNvdXJjZXNcbiAgICAgICAgaWYgKHBpZWNlTmFtZS5zdGFydHNXaXRoKCdBZWR1aSBSZXNvdXJjZXMgKCcpKVxuICAgICAgICAgIHRoaXMuYWVkdWkuc2V0UmVzb3VyY2VzKHBhcnNlSW50KHpvbmUubmFtZSkpO1xuICAgICAgICAvLyBBZWR1aSBFbGlnaWJpbGl0eVxuICAgICAgICBpZiAocGllY2VOYW1lLnN0YXJ0c1dpdGgoJ0FlZHVpIEVsaWdpYmlsaXR5JykpIHtcbiAgICAgICAgICBpZiAoem9uZS5uYW1lID09PSAnRWxpZ2libGUgRmFjdGlvbnMnKVxuICAgICAgICAgICAgZWxpZ2libGUucHVzaChGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgICBlbHNlIGlmICh6b25lLm5hbWUgPT09ICdQYXNzJylcbiAgICAgICAgICAgIHBhc3NlZC5wdXNoKEZhY3Rpb25JRHMuQUVEVUkpO1xuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIGluZWxpZ2libGUucHVzaChGYWN0aW9uSURzLkFFRFVJKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBcnZlcm5pIFJlc291cmNlc1xuICAgICAgICBpZiAocGllY2VOYW1lLnN0YXJ0c1dpdGgoJ0F2ZXJuaSBSZXNvdXJjZXMgKCcpKVxuICAgICAgICAgIHRoaXMuYXJ2ZXJuaS5zZXRSZXNvdXJjZXMocGFyc2VJbnQoem9uZS5uYW1lKSk7XG4gICAgICAgIC8vIEFydmVybmkgRWxpZ2liaWxpdHlcbiAgICAgICAgaWYgKHBpZWNlTmFtZS5zdGFydHNXaXRoKCdBdmVybmkgRWxpZ2liaWxpdHknKSkge1xuICAgICAgICAgIGlmICh6b25lLm5hbWUgPT09ICdFbGlnaWJsZSBGYWN0aW9ucycpXG4gICAgICAgICAgICBlbGlnaWJsZS5wdXNoKEZhY3Rpb25JRHMuQVJWRVJOSSk7XG4gICAgICAgICAgZWxzZSBpZiAoem9uZS5uYW1lID09PSAnUGFzcycpXG4gICAgICAgICAgICBwYXNzZWQucHVzaChGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIGluZWxpZ2libGUucHVzaChGYWN0aW9uSURzLkFSVkVSTkkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJlbGdpYyBSZXNvdXJjZXNcbiAgICAgICAgaWYgKHBpZWNlTmFtZS5zdGFydHNXaXRoKCdCZWxnaWMgUmVzb3VyY2VzICgnKSlcbiAgICAgICAgICB0aGlzLmJlbGdhZS5zZXRSZXNvdXJjZXMocGFyc2VJbnQoem9uZS5uYW1lKSk7XG4gICAgICAgIC8vIEJlbGdpYyBFbGlnaWJpbGl0eVxuICAgICAgICBpZiAocGllY2VOYW1lLnN0YXJ0c1dpdGgoJ0JlbGdpYyBFbGlnaWJpbGl0eScpKSB7XG4gICAgICAgICAgaWYgKHpvbmUubmFtZSA9PT0gJ0VsaWdpYmxlIEZhY3Rpb25zJylcbiAgICAgICAgICAgIGVsaWdpYmxlLnB1c2goRmFjdGlvbklEcy5CRUxHQUUpO1xuICAgICAgICAgIGVsc2UgaWYgKHpvbmUubmFtZSA9PT0gJ1Bhc3MnKVxuICAgICAgICAgICAgcGFzc2VkLnB1c2goRmFjdGlvbklEcy5CRUxHQUUpO1xuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIGluZWxpZ2libGUucHVzaChGYWN0aW9uSURzLkJFTEdBRSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUm9tYW4gUmVzb3VyY2VzXG4gICAgICAgIGlmIChwaWVjZU5hbWUuc3RhcnRzV2l0aCgnUm9tYW4gUmVzb3VyY2VzICgnKSlcbiAgICAgICAgICB0aGlzLnJvbWFucy5zZXRSZXNvdXJjZXMocGFyc2VJbnQoem9uZS5uYW1lKSk7XG4gICAgICAgIC8vIFJvbWFuIEVsaWdpYmlsaXR5XG4gICAgICAgIGlmIChwaWVjZU5hbWUuc3RhcnRzV2l0aCgnUm9tYW4gRWxpZ2liaWxpdHknKSkge1xuICAgICAgICAgIGlmICh6b25lLm5hbWUgPT09ICdFbGlnaWJsZSBGYWN0aW9ucycpXG4gICAgICAgICAgICBlbGlnaWJsZS5wdXNoKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICBlbHNlIGlmICh6b25lLm5hbWUgPT09ICdQYXNzJylcbiAgICAgICAgICAgIHBhc3NlZC5wdXNoKEZhY3Rpb25JRHMuUk9NQU5TKTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBpbmVsaWdpYmxlLnB1c2goRmFjdGlvbklEcy5ST01BTlMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXF1ZW5jZU9mUGxheS5lbGlnaWJsZUZhY3Rpb25zKGVsaWdpYmxlKTtcbiAgICB0aGlzLnNlcXVlbmNlT2ZQbGF5LmluZWxpZ2libGVGYWN0aW9ucyhpbmVsaWdpYmxlKTtcbiAgICB0aGlzLnNlcXVlbmNlT2ZQbGF5LnBhc3NlZEZhY3Rpb25zKHBhc3NlZCk7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHJlZ2lvbnMgdG8gY291bnQgcGllY2VzXG5cbiAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy52YXNzYWwucmVnaW9ucykge1xuICAgICAgbGV0IHZhc3NhbHJlZ2lvbiA9IHRoaXMudmFzc2FsLnJlZ2lvbnNba2V5XTtcblxuICAgICAgZm9yICh6ID0gMDsgeiA8IGpzb24uem9uZXMubGVuZ3RoOyB6KyspIHtcbiAgICAgICAgem9uZSA9IGpzb24uem9uZXNbel07XG5cbiAgICAgICAgLy8gaXMgem9uZSBhIFJlZ2lvbj9cblxuICAgICAgICBpZiAoem9uZS5uYW1lID09PSB2YXNzYWxyZWdpb24ubW9kbmFtZSkge1xuICAgICAgICAgIC8vIGluaXQgcmVnaW9uXG4gICAgICAgICAgbGV0IHJlZ2lvbiA9IHRoaXMucmVnaW9uc0J5SWRbdmFzc2FscmVnaW9uLmlkXTtcbiAgICAgICAgICBsZXQgYWVkdWlDb3VudCA9IHtcbiAgICAgICAgICAgIHdhcmJhbmRzOiAwLFxuICAgICAgICAgICAgcmV2ZWFsZWR3YXJiYW5kczogMFxuICAgICAgICAgIH07XG4gICAgICAgICAgbGV0IGFydmVybmlDb3VudCA9IHtcbiAgICAgICAgICAgIHdhcmJhbmRzOiAwLFxuICAgICAgICAgICAgcmV2ZWFsZWR3YXJiYW5kczogMFxuICAgICAgICAgIH07XG4gICAgICAgICAgbGV0IGJlbGdhZUNvdW50ID0ge1xuICAgICAgICAgICAgd2FyYmFuZHM6IDAsXG4gICAgICAgICAgICByZXZlYWxlZHdhcmJhbmRzOiAwXG4gICAgICAgICAgfTtcbiAgICAgICAgICBsZXQgZ2VybWFuaWNDb3VudCA9IHtcbiAgICAgICAgICAgIHdhcmJhbmRzOiAwLFxuICAgICAgICAgICAgcmV2ZWFsZWR3YXJiYW5kczogMFxuICAgICAgICAgIH07XG4gICAgICAgICAgbGV0IHJvbWFuQ291bnQgPSB7XG4gICAgICAgICAgICBhdXhpbGlhOiAwLFxuICAgICAgICAgICAgcmV2ZWFsZWRhdXhpbGlhOiAwLFxuICAgICAgICAgICAgbGVnaW9uOiAwXG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBzcGVjaWFsIGNhc2UsIGNpdGFkZWwgb2YgQWVkdWlcblxuICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZSwgY2l0YWRlbCBvZiBBcnZlcm5pXG5cbiAgICAgICAgICBmb3IgKHAgPSAwOyBwIDwgem9uZS5waWVjZXMubGVuZ3RoOyBwKyspIHtcbiAgICAgICAgICAgIGxldCBwaWVjZU5hbWUgPSB6b25lLnBpZWNlc1twXS5uYW1lO1xuICAgICAgICAgICAgbGV0IHBpZWNlWCA9IHpvbmUucGllY2VzW3BdLng7XG4gICAgICAgICAgICBsZXQgcGllY2VZID0gem9uZS5waWVjZXNbcF0ueTtcblxuICAgICAgICAgICAgLy8gQWVkdWlcbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdBZWR1aSBXYXJiYW5kJylcbiAgICAgICAgICAgICAgYWVkdWlDb3VudC53YXJiYW5kcysrO1xuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PT0gJ0FlZHVpIFdhcmJhbmQgUmV2ZWFsZWQnKSB7XG4gICAgICAgICAgICAgIGFlZHVpQ291bnQud2FyYmFuZHMrKztcbiAgICAgICAgICAgICAgYWVkdWlDb3VudC5yZXZlYWxlZHdhcmJhbmRzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnQWVkdWkgQWxseScpXG4gICAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZSh0aGlzLCB7ZmFjdGlvbklkOiB0aGlzLmFlZHVpLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCB0cmliZUlkOiB0aGlzLnZhc3NhbC50cmliZUlkKHBpZWNlWCwgcGllY2VZKX0pO1xuICBcdFx0XHRcdFx0aWYgKHBpZWNlTmFtZSA9PSAnQWVkdWkgQ2l0YWRlbCcpXG4gICAgICAgICAgICAgIFBsYWNlQ2l0YWRlbC5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYWVkdWkuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIHRyaWJlSWQ6IHRoaXMudmFzc2FsLnRyaWJlSWQocGllY2VYLCBwaWVjZVkpfSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAvLyBBcnZlcm5pXG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09ICdWZXJjaW5nZXRvcml4JyB8fCBwaWVjZU5hbWUgPT0gJ0FydmVybmkgU3VjY2Vzc29yJykge1xuICAgICAgICAgICAgICBQbGFjZUxlYWRlci5leGVjdXRlKHRoaXMsIHsgZmFjdGlvbklkOiB0aGlzLmFydmVybmkuaWQsIHJlZ2lvbklkOiByZWdpb24uaWR9KTtcbiAgICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PSAnQXJ2ZXJuaSBTdWNjZXNzb3InKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJ2ZXJuaUxlYWRlciA9IHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuYXJ2ZXJuaS5pZCk7XG4gICAgICAgICAgICAgICAgYXJ2ZXJuaUxlYWRlci5pc1N1Y2Nlc3Nvcih0cnVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PT0gJ0FydmVybmkgV2FyYmFuZCcpXG4gICAgICAgICAgICAgIGFydmVybmlDb3VudC53YXJiYW5kcysrO1xuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PT0gJ0FydmVybmkgV2FyYmFuZCBSZXZlYWxlZCcpIHtcbiAgICAgICAgICAgICAgYXJ2ZXJuaUNvdW50LndhcmJhbmRzKys7XG4gICAgICAgICAgICAgIGFydmVybmlDb3VudC5yZXZlYWxlZHdhcmJhbmRzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnQXJ2ZXJuaSBBbGx5JylcbiAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYXJ2ZXJuaS5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgdHJpYmVJZDogdGhpcy52YXNzYWwudHJpYmVJZChwaWVjZVgsIHBpZWNlWSl9KTtcbiAgXHRcdFx0XHRcdGlmIChwaWVjZU5hbWUgPT0gJ0F2ZXJuaSBDaXRhZGVsJylcbiAgICAgICAgICAgICAgUGxhY2VDaXRhZGVsLmV4ZWN1dGUodGhpcywge2ZhY3Rpb25JZDogdGhpcy5hcnZlcm5pLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCB0cmliZUlkOiB0aGlzLnZhc3NhbC50cmliZUlkKHBpZWNlWCwgcGllY2VZKX0sIGZhbHNlKTtcblxuICAgICAgICAgICAgLy8gQmVsZ2FlXG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09ICdBbWJpb3JpeCcgfHwgcGllY2VOYW1lID09ICdCZWxnaWMgU3VjY2Vzc29yJykge1xuICAgICAgICAgICAgICBQbGFjZUxlYWRlci5leGVjdXRlKHRoaXMsIHsgZmFjdGlvbklkOiB0aGlzLmJlbGdhZS5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZH0pO1xuICAgICAgICAgICAgICBpZiAocGllY2VOYW1lID09ICdCZWxnaWMgU3VjY2Vzc29yJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlbGdpY0xlYWRlciA9IHJlZ2lvbi5nZXRMZWFkZXJGb3JGYWN0aW9uKHRoaXMuYmVsZ2FlLmlkKTtcbiAgICAgICAgICAgICAgICBiZWxnaWNMZWFkZXIuaXNTdWNjZXNzb3IodHJ1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdCZWxnaWMgV2FyYmFuZCcpXG4gICAgICAgICAgICAgIGJlbGdhZUNvdW50LndhcmJhbmRzKys7XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnQmVsZ2ljIFdhcmJhbmQgUmV2ZWFsZWQnKSB7XG4gICAgICAgICAgICAgIGJlbGdhZUNvdW50LndhcmJhbmRzKys7XG4gICAgICAgICAgICAgIGJlbGdhZUNvdW50LnJldmVhbGVkd2FyYmFuZHMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdCZWxnaWMgQWxseScpXG4gICAgICAgICAgICAgIFBsYWNlQWxsaWVkVHJpYmUuZXhlY3V0ZSh0aGlzLCB7ZmFjdGlvbklkOiB0aGlzLmJlbGdhZS5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgdHJpYmVJZDogdGhpcy52YXNzYWwudHJpYmVJZChwaWVjZVgsIHBpZWNlWSl9KTtcbiAgXHRcdFx0XHRcdGlmIChwaWVjZU5hbWUgPT0gJ0JlbGdpYyBDaXRhZGVsJylcbiAgICAgICAgICAgICAgUGxhY2VDaXRhZGVsLmV4ZWN1dGUodGhpcywge2ZhY3Rpb25JZDogdGhpcy5iZWxnYWUuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIHRyaWJlSWQ6IHRoaXMudmFzc2FsLnRyaWJlSWQocGllY2VYLCBwaWVjZVkpfSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAvLyBHZXJtYW5pY1xuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PT0gJ0dlcm1hbmljIFdhcmJhbmQnKVxuICAgICAgICAgICAgICBnZXJtYW5pY0NvdW50LndhcmJhbmRzKys7XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnR2VybWFuaWMgV2FyYmFuZCBSZXZlYWxlZCcpIHtcbiAgICAgICAgICAgICAgZ2VybWFuaWNDb3VudC53YXJiYW5kcysrO1xuICAgICAgICAgICAgICBnZXJtYW5pY0NvdW50LnJldmVhbGVkd2FyYmFuZHMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdHZXJtYW5pYyBBbGx5JylcbiAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuZ2VybWFuaWMuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIHRyaWJlSWQ6IHRoaXMudmFzc2FsLnRyaWJlSWQocGllY2VYLCBwaWVjZVkpfSk7XG5cbiAgICAgICAgICAgIC8vIFJvbWFuXG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09ICdDYWVzYXInIHx8IHBpZWNlTmFtZSA9PSAnUm9tYW4gU3VjY2Vzc29yJykge1xuICAgICAgICAgICAgICBQbGFjZUxlYWRlci5leGVjdXRlKHRoaXMsIHsgZmFjdGlvbklkOiB0aGlzLnJvbWFucy5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZH0pO1xuICAgICAgICAgICAgICBpZiAocGllY2VOYW1lID09ICdSb21hbiBTdWNjZXNzb3InKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9tYW5MZWFkZXIgPSByZWdpb24uZ2V0TGVhZGVyRm9yRmFjdGlvbih0aGlzLnJvbWFucy5pZCk7XG4gICAgICAgICAgICAgICAgcm9tYW5MZWFkZXIuaXNTdWNjZXNzb3IodHJ1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdSb21hbiBBdXhpbGlhJylcbiAgICAgICAgICAgICAgcm9tYW5Db3VudC5hdXhpbGlhKys7XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnUm9tYW4gQXV4aWxpYSBSZXZlYWxlZCcpIHtcbiAgICAgICAgICAgICAgcm9tYW5Db3VudC5hdXhpbGlhKys7XG4gICAgICAgICAgICAgIHJvbWFuQ291bnQucmV2ZWFsZWRhdXhpbGlhKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGllY2VOYW1lID09PSAnUm9tYW4gTGVnaW9uJylcbiAgICAgICAgICAgICAgcm9tYW5Db3VudC5sZWdpb24rKztcbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT09ICdSb21hbiBBbGx5JylcbiAgICAgICAgICAgICAgUGxhY2VBbGxpZWRUcmliZS5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMucm9tYW5zLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCB0cmliZUlkOiB0aGlzLnZhc3NhbC50cmliZUlkKHBpZWNlWCwgcGllY2VZKX0pO1xuICBcdFx0XHRcdFx0aWYgKHBpZWNlTmFtZSA9PSAnUm9tYW4gRm9ydCcpXG4gICAgICAgICAgICAgIFBsYWNlRm9ydC5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMucm9tYW5zLmlkLCByZWdpb25JZDogcmVnaW9uLmlkfSk7XG5cbiAgICAgICAgICAgIC8vIFRPRE86IGRpc3BlcnNlZCB0cmliZVxuICAgICAgICAgICAgLy8gVE9ETzogZ2F0aGVyaW5nIHRyaWJlXG4gICAgICAgICAgICAvLyBUT0RPOiBkZXZhc3RhdGVkXG4gICAgICAgICAgICAvLyBUT0RPOiBDb2xvbnkgYWRkZWRcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBhcHBseSBjb3VudHNcblxuICAgICAgICAgIGlmIChhZWR1aUNvdW50LndhcmJhbmRzID4gMCkgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYWVkdWkuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIGNvdW50OiBhZWR1aUNvdW50LndhcmJhbmRzfSk7XG4gICAgICAgICAgaWYgKGFlZHVpQ291bnQucmV2ZWFsZWR3YXJiYW5kcyA+IDApIFJldmVhbFBpZWNlcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYWVkdWkuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIGNvdW50OiBhZWR1aUNvdW50LnJldmVhbGVkd2FyYmFuZHN9KTtcbiAgICAgICAgICBpZiAoYXJ2ZXJuaUNvdW50LndhcmJhbmRzID4gMCkgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYXJ2ZXJuaS5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgY291bnQ6IGFydmVybmlDb3VudC53YXJiYW5kc30pO1xuICAgICAgICAgIGlmIChhcnZlcm5pQ291bnQucmV2ZWFsZWR3YXJiYW5kcyA+IDApIFJldmVhbFBpZWNlcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYXJ2ZXJuaS5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgY291bnQ6IGFydmVybmlDb3VudC5yZXZlYWxlZHdhcmJhbmRzfSk7XG4gICAgICAgICAgaWYgKGJlbGdhZUNvdW50LndhcmJhbmRzID4gMCkgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYmVsZ2FlLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCBjb3VudDogYmVsZ2FlQ291bnQud2FyYmFuZHN9KTtcbiAgICAgICAgICBpZiAoYmVsZ2FlQ291bnQucmV2ZWFsZWR3YXJiYW5kcyA+IDApIFJldmVhbFBpZWNlcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuYmVsZ2FlLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCBjb3VudDogYmVsZ2FlQ291bnQucmV2ZWFsZWR3YXJiYW5kc30pO1xuICAgICAgICAgIGlmIChnZXJtYW5pY0NvdW50LndhcmJhbmRzID4gMCkgUGxhY2VXYXJiYW5kcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuZ2VybWFuaWMuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIGNvdW50OiBnZXJtYW5pY0NvdW50LndhcmJhbmRzfSk7XG4gICAgICAgICAgaWYgKGdlcm1hbmljQ291bnQucmV2ZWFsZWR3YXJiYW5kcyA+IDApIFJldmVhbFBpZWNlcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMuZ2VybWFuaWMuaWQsIHJlZ2lvbklkOiByZWdpb24uaWQsIGNvdW50OiBnZXJtYW5pY0NvdW50LnJldmVhbGVkd2FyYmFuZHN9KTtcblxuICAgICAgICAgIGlmIChyb21hbkNvdW50LmF1eGlsaWEgPiAwKSBQbGFjZUF1eGlsaWEuZXhlY3V0ZSh0aGlzLCB7ZmFjdGlvbklkOiB0aGlzLnJvbWFucy5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgY291bnQ6IHJvbWFuQ291bnQuYXV4aWxpYX0pO1xuICAgICAgICAgIGlmIChyb21hbkNvdW50LnJldmVhbGVkYXV4aWxpYSA+IDApIFJldmVhbFBpZWNlcy5leGVjdXRlKHRoaXMsIHtmYWN0aW9uSWQ6IHRoaXMucm9tYW5zLmlkLCByZWdpb25JZDogcmVnaW9uLmlkLCBjb3VudDogcm9tYW5Db3VudC5yZXZlYWxlZGF1eGlsaWF9KTtcbiAgICAgICAgICBpZiAocm9tYW5Db3VudC5sZWdpb24gPiAwKSBQbGFjZUxlZ2lvbnMuZXhlY3V0ZSh0aGlzLCB7ZmFjdGlvbklkOiB0aGlzLnJvbWFucy5pZCwgcmVnaW9uSWQ6IHJlZ2lvbi5pZCwgY291bnQ6IHJvbWFuQ291bnQubGVnaW9ufSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBwcm9jZXNzIG90aGVyIHpvbmVzXG5cbiAgICBsZXQgcm9tYW5MZWdpb25zVHJhY2sgPSAwO1xuICAgIGxldCByb21hbkxlZ2lvbnNGYWxsZW4gPSAwO1xuICAgIGZvciAoeiA9IDA7IHogPCBqc29uLnpvbmVzLmxlbmd0aDsgeisrKSB7XG4gICAgICAgIHpvbmUgPSBqc29uLnpvbmVzW3pdO1xuICAgICAgICBjb25zb2xlLmxvZygnT1RIRVIgWk9ORTogJyArIHpvbmUubmFtZSk7XG5cbiAgICAgICAgZm9yIChwID0gMDsgcCA8IHpvbmUucGllY2VzLmxlbmd0aDsgcCsrKSB7XG4gICAgICAgICAgbGV0IHBpZWNlTmFtZSA9IHpvbmUucGllY2VzW3BdLm5hbWU7XG5cbiAgICAgICAgICBpZiAoem9uZS5uYW1lID09ICdVcGNvbWluZycpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHVwY29taW5nIGNhcmRcbiAgICAgICAgICAgIC8vIGdhbWUudXBjb21pbmdjYXJkID0ge25hbWU6IHBpZWNlTmFtZSwgbnVtOiBwYXJzZUludChwaWVjZU5hbWUuc3Vic3RyaW5nKDAsIDIpKX07XG4gICAgICAgICAgICAvLyBpZiAoZ2FtZS51cGNvbWluZ2NhcmQubmFtZS5lbmRzV2l0aCgnIC0gV2ludGVyJykpXG4gICAgICAgICAgICAvLyAgIGdhbWUuZnJvc3QgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh6b25lLm5hbWUgPT0gJ0N1cnJlbnQnKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBjdXJyZW50IGNhcmRcbiAgICAgICAgICAgIC8vIGdhbWUuY3VycmVudGNhcmQgPSB7bmFtZTogcGllY2VOYW1lLCBudW06IHBhcnNlSW50KHBpZWNlTmFtZS5zdWJzdHJpbmcoMCwgMikpfTtcbiAgICAgICAgICAgIC8vIGlmIChnYW1lLmN1cnJlbnRjYXJkLm5hbWUuZW5kc1dpdGgoJyAtIFdpbnRlcicpKVxuICAgICAgICAgICAgLy8gICBnYW1lLndpbnRlciA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHpvbmUubmFtZSA9PSAnU2VuYXRlIC0gVXByb2FyJylcbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT0gJ1JvbWFuIFNlbmF0ZScpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VQUk9BUicpO1xuICAgICAgICAgICAgICB0aGlzLnJvbWFucy5zZXRTZW5hdGVBcHByb3ZhbChTZW5hdGVBcHByb3ZhbFN0YXRlcy5VUFJPQVIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGlmICh6b25lLm5hbWUgPT0gJ1NlbmF0ZSAtIEludHJpZ3VlJylcbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT0gJ1JvbWFuIFNlbmF0ZScpXG4gICAgICAgICAgICAgIHRoaXMucm9tYW5zLnNldFNlbmF0ZUFwcHJvdmFsKFNlbmF0ZUFwcHJvdmFsU3RhdGVzLklOVFJJR1VFKTtcbiAgICAgICAgICBpZiAoem9uZS5uYW1lID09ICdTZW5hdGUgLSBBZHVsYXRpb24nKVxuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PSAnUm9tYW4gU2VuYXRlJylcbiAgICAgICAgICAgICAgdGhpcy5yb21hbnMuc2V0U2VuYXRlQXBwcm92YWwoU2VuYXRlQXBwcm92YWxTdGF0ZXMuQURVTEFUSU9OKTtcbiAgICAgICAgICBpZiAoem9uZS5uYW1lID09ICdMZWdpb25zJylcbiAgICAgICAgICAgIGlmIChwaWVjZU5hbWUgPT0gJ1JvbWFuIExlZ2lvbicpXG4gICAgICAgICAgICAgIHJvbWFuTGVnaW9uc1RyYWNrKys7XG4gICAgICAgICAgaWYgKHpvbmUubmFtZSA9PSAnRmFsbGVuIExlZ2lvbnMnKVxuICAgICAgICAgICAgaWYgKHBpZWNlTmFtZSA9PSAnUm9tYW4gTGVnaW9uJylcbiAgICAgICAgICAgICAgcm9tYW5MZWdpb25zRmFsbGVuKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2coJ2xlZ2lvbiB0cmFjazogJyArIHJvbWFuTGVnaW9uc1RyYWNrKTtcbiAgICBpZiAocm9tYW5MZWdpb25zVHJhY2sgPiAwKVxuICAgICAgdGhpcy5yb21hbnMuaW5pdGlhbGl6ZUxlZ2lvblRyYWNrKFNlbmF0ZUFwcHJvdmFsU3RhdGVzLkFEVUxBVElPTiwgcm9tYW5MZWdpb25zVHJhY2sgPiA0ID8gNCA6IHJvbWFuTGVnaW9uc1RyYWNrKTtcbiAgICByb21hbkxlZ2lvbnNUcmFjayAtPSA0O1xuICAgIGlmIChyb21hbkxlZ2lvbnNUcmFjayA+IDApXG4gICAgICB0aGlzLnJvbWFucy5pbml0aWFsaXplTGVnaW9uVHJhY2soU2VuYXRlQXBwcm92YWxTdGF0ZXMuSU5UUklHVUUsIHJvbWFuTGVnaW9uc1RyYWNrID4gNCA/IDQgOiByb21hbkxlZ2lvbnNUcmFjayk7XG4gICAgcm9tYW5MZWdpb25zVHJhY2sgLT0gNDtcbiAgICBpZiAocm9tYW5MZWdpb25zVHJhY2sgPiAwKVxuICAgICAgdGhpcy5yb21hbnMuaW5pdGlhbGl6ZUxlZ2lvblRyYWNrKFNlbmF0ZUFwcHJvdmFsU3RhdGVzLlVQUk9BUiwgcm9tYW5MZWdpb25zVHJhY2spO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdmYWxsZW46ICcgKyByb21hbkxlZ2lvbnNGYWxsZW4pO1xuICAgIHRoaXMucm9tYW5zLnJldHVybkxlZ2lvbnModGhpcy5yb21hbnMuYXZhaWxhYmxlTGVnaW9ucygpLnNwbGljZSgwLCByb21hbkxlZ2lvbnNGYWxsZW4pKTtcblxuICAgIC8vIHByb2Nlc3Mgb2ZmYm9hcmRcblxuICAgIHRoaXMubnVtYmVyRGlzY2FyZHMgPSAwO1xuICAgIHRoaXMubnVtYmVyRGVjayA9IDA7XG5cbiAgICBmb3IgKHAgPSAwOyBwIDwganNvbi5vZmZib2FyZC5sZW5ndGg7IHArKykge1xuICAgICAgcGllY2VOYW1lID0ganNvbi5vZmZib2FyZFtwXS5uYW1lO1xuXG4gICAgICBpZiAocGllY2VOYW1lLmluZGV4T2YoJyBDYXBhYmlsaXR5ICoqJykgPiAtMSkge1xuICAgICAgICAvLyBUT0RPOiBDYXBhYmlsaXRpZXNcbiAgICAgICAgLy8gdmFyIGNhcmROYW1lID0gcGllY2VOYW1lLnN1YnN0cmluZygwLCBwaWVjZU5hbWUuaW5kZXhPZignICoqJykpO1xuICAgICAgICAvLyB2YXIgY2FyZE51bWJlciA9IHBhcnNlSW50KHBpZWNlTmFtZS5zdWJzdHJpbmcoMCwgMikpO1xuICAgICAgICAvLyB2YXIgc2hhZGVkQ2FwYWJpbGl0eSA9IHBpZWNlTmFtZS5pbmRleE9mKCcqKiBTaGFkZWQgJykgPiAtMTtcbiAgICAgICAgLy8gdmFyIGNhcCA9IHtjYXJkOiBjYXJkTmFtZSwgbnVtOiBjYXJkTnVtYmVyLCBzaGFkZWQ6IHNoYWRlZENhcGFiaWxpdHl9OyBcbiAgICAgICAgLy8gZ2FtZS5jYXBhYmlsaXRpZXMucHVzaChjYXApO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2FwYWJpbGl0eTogJywgY2FwKTtcbiAgICAgIH1cblxuICAgICAgLy8gbnVtYmVyIG9mIGNhcmRzIG9uIHRoZSBkaXNjYXJkIHBpbGVcbiAgICAgIGlmIChwaWVjZU5hbWUuaW5kZXhPZignIENhcmRzIGluIERpc2NhcmQnKSA+IC0xKSB7XG4gICAgICAgIC8vIHJlY29yZCB0aGUgbnVtYmVyIG9mIGNhcmRzIGluIHRoZSBkaXNjYXJkIHBpbGVcbiAgICAgICAgc3RhcnRJbmRleCA9IHBpZWNlTmFtZS5pbmRleE9mKCcoJykgKyAxO1xuICAgICAgICBlbmRJbmRleCA9IHBpZWNlTmFtZS5pbmRleE9mKCcgQycpO1xuICAgICAgICB0aGlzLm51bWJlckRpc2NhcmRzID0gcGFyc2VJbnQocGllY2VOYW1lLnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBudW1iZXIgb2YgY2FyZHMgb24gdGhlIGRyYXcgZGVja1xuICAgICAgaWYgKHBpZWNlTmFtZS5pbmRleE9mKCcgQ2FyZHMgUmVtYWluaW5nIGluIERlY2snKSA+IC0xKSB7XG4gICAgICAgIC8vIHJlY29yZCB0aGUgbnVtYmVyIG9mIGNhcmRzIGluIHRoZSBkaXNjYXJkIHBpbGVcbiAgICAgICAgc3RhcnRJbmRleCA9IHBpZWNlTmFtZS5pbmRleE9mKCcoJykgKyAxO1xuICAgICAgICBlbmRJbmRleCA9IHBpZWNlTmFtZS5pbmRleE9mKCcgQycpO1xuICAgICAgICB0aGlzLm51bWJlckRlY2sgPSBwYXJzZUludChwaWVjZU5hbWUuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZGV0ZXJtaW5lIG51bWJlciBvZiBjYXJkcyB1c2VkIChmb3Igc2NlbmFyaW8pXG4gICAgXG4gICAgdGhpcy50b3RhbENhcmRzID0gdGhpcy5udW1iZXJEaXNjYXJkcyArIHRoaXMubnVtYmVyRGVjazsgLy8gVE9ETzogcGx1cyBjdXJyZW50ICsgdXBjb21pbmdcblxuICAgIGNvbnNvbGUubG9nKCdDQVJEUyA9ICcsIHRoaXMudG90YWxDYXJkcyk7XG4gIH1cblxuICB0b0pTT04oKSB7XG4gICAgcmV0dXJuIFwie31cIjtcbiAgfVxuXG4gIC8vIFVUSUxJVElFU1xuXG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRmFsbGluZ1NreVZhc3NhbEdhbWVTdGF0ZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZhbGxpbmdza3kvdmFzc2FsL2ZhbGxpbmdTa3lWYXNzYWxHYW1lU3RhdGUuanMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUNBO0FBQ0E7OztBQUFBO0FBQ0E7OztBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBQ0E7OztBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFKQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBWQTtBQXFWQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBR0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 189 */
/***/ (function(module, exports) {

eval("module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLyh3ZWJwYWNrKS9idWlsZGluL21vZHVsZS5qcz9jM2MyIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XHJcblx0aWYoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcclxuXHRcdG1vZHVsZS5kZXByZWNhdGUgPSBmdW5jdGlvbigpIHt9O1xyXG5cdFx0bW9kdWxlLnBhdGhzID0gW107XHJcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcclxuXHRcdGlmKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJsb2FkZWRcIiwge1xyXG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHJldHVybiBtb2R1bGUubDtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImlkXCIsIHtcclxuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcclxuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XHJcblx0fVxyXG5cdHJldHVybiBtb2R1bGU7XHJcbn07XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL21vZHVsZS5qc1xuLy8gbW9kdWxlIGlkID0gMTg5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 190 */
/***/ (function(module, exports) {

eval("module.exports = require(\"fs\");//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZnNcIj8yZTA5Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImZzXCIpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiZnNcIlxuLy8gbW9kdWxlIGlkID0gMTkwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),
/* 191 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(82);


/***/ })
/******/ ]);